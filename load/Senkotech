{"status":200,"content":"LS0tIEBkaWFnbm9zdGljIGRpc2FibGUKbG9jYWwgYml0X2JhbmQsIGJpdF9ibm90LCBiaXRfYm9yLCBiaXRfYnhvciwgYml0X2xzaGlmdCwgYml0X3RvaGV4ID0gYml0LmJhbmQsIGJpdC5ibm90LCBiaXQuYm9yLCBiaXQuYnhvciwgYml0LmxzaGlmdCwgYml0LnRvaGV4Owpsb2NhbCBhYnNmLCBjZWlsLCBjb3NmLCBmbG9vciwgZm1vZGYsIG1heGYsIG1pbmYsIHJhZGYsIHNpbmYsIHNxcnRmID0gbWF0aC5hYnMsIG1hdGguY2VpbCwgbWF0aC5jb3MsIG1hdGguZmxvb3IsIG1hdGguZm1vZCwgbWF0aC5tYXgsIG1hdGgubWluLCBtYXRoLnJhZCwgbWF0aC5zaW4sIG1hdGguc3FydDsKbG9jYWwgc3RyaW5nX2ZpbmQsIGYsIHN0cmluZ19nbWF0Y2gsIHN0cmluZ19nc3ViLCBzdHJsZW4sIHRvbG93ZXIsIHN0cmluZ19tYXRjaCwgc3RyaW5nX3N1YiwgdG91cHBlciA9IHN0cmluZy5maW5kLCBzdHJpbmcuZm9ybWF0LCBzdHJpbmcuZ21hdGNoLCBzdHJpbmcuZ3N1Yiwgc3RyaW5nLmxlbiwgc3RyaW5nLmxvd2VyLCBzdHJpbmcubWF0Y2gsIHN0cmluZy5zdWIsIHN0cmluZy51cHBlcjsKbG9jYWwgY2xlYXIsIG1lcmdlLCB0YWJsZV9pbnNlcnQsIHRhYmxlX3JlbW92ZSwgdGFibGVfc29ydCA9IHRhYmxlLmNsZWFyLCB0YWJsZS5jb25jYXQsIHRhYmxlLmluc2VydCwgdGFibGUucmVtb3ZlLCB0YWJsZS5zb3J0OwoKbG9jYWwgY2xpZW50X2NhbWVyYV9hbmdsZXMsIGNsaWVudF9jb2xvcl9sb2csIGNsaWVudF9jcmVhdGVfaW50ZXJmYWNlLCBjbGllbnRfY3VycmVudF90aHJlYXQsIGNsaWVudF9kZWxheV9jYWxsLCBjbGllbnRfZXJyb3JfbG9nLCBjbGllbnRfZXhlYywgY2xpZW50X2V5ZV9wb3NpdGlvbiwgY2xpZW50X2ZpbmRfc2lnbmF0dXJlLCBjbGllbnRfa2V5X3N0YXRlLCBjbGllbnRfbG9nLCBjbGllbnRfcmFuZG9tX2Zsb2F0LCBjbGllbnRfcmFuZG9tX2ludCwgY2xpZW50X3JlZ2lzdGVyX2VzcF9mbGFnLCBjbGllbnRfc2NhbGVfZGFtYWdlLCBjbGllbnRfc2NyZWVuX3NpemUsIGNsaWVudF9zZXRfZXZlbnRfY2FsbGJhY2ssIGNsaWVudF9zeXN0ZW1fdGltZSwgY2xpZW50X3RpbWVzdGFtcCwgY2xpZW50X3RyYWNlX2J1bGxldCwgY2xpZW50X3RyYWNlX2xpbmUsIGNsaWVudF91bml4X3RpbWUsIGNsaWVudF91bnNldF9ldmVudF9jYWxsYmFjaywgY2xpZW50X3VzZXJpZF90b19lbnRpbmRleCA9IGNsaWVudC5jYW1lcmFfYW5nbGVzLCBjbGllbnQuY29sb3JfbG9nLCBjbGllbnQuY3JlYXRlX2ludGVyZmFjZSwgY2xpZW50LmN1cnJlbnRfdGhyZWF0LCBjbGllbnQuZGVsYXlfY2FsbCwgY2xpZW50LmVycm9yX2xvZywgY2xpZW50LmV4ZWMsIGNsaWVudC5leWVfcG9zaXRpb24sIGNsaWVudC5maW5kX3NpZ25hdHVyZSwgY2xpZW50LmtleV9zdGF0ZSwgY2xpZW50LmxvZywgY2xpZW50LnJhbmRvbV9mbG9hdCwgY2xpZW50LnJhbmRvbV9pbnQsIGNsaWVudC5yZWdpc3Rlcl9lc3BfZmxhZywgY2xpZW50LnNjYWxlX2RhbWFnZSwgY2xpZW50LnNjcmVlbl9zaXplLCBjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrLCBjbGllbnQuc3lzdGVtX3RpbWUsIGNsaWVudC50aW1lc3RhbXAsIGNsaWVudC50cmFjZV9idWxsZXQsIGNsaWVudC50cmFjZV9saW5lLCBjbGllbnQudW5peF90aW1lLCBjbGllbnQudW5zZXRfZXZlbnRfY2FsbGJhY2ssIGNsaWVudC51c2VyaWRfdG9fZW50aW5kZXg7CmxvY2FsIGRhdGFiYXNlX3JlYWQsIGRhdGFiYXNlX3dyaXRlID0gZGF0YWJhc2UucmVhZCwgZGF0YWJhc2Uud3JpdGU7CmxvY2FsIGVudGl0eV9nZXRfY2xhc3NuYW1lLCBlbnRpdHlfZ2V0X2VzcF9kYXRhLCBlbnRpdHlfZ2V0X2dhbWVfcnVsZXMsIGVudGl0eV9nZXRfbG9jYWxfcGxheWVyLCBlbnRpdHlfZ2V0X29yaWdpbiwgZW50aXR5X2dldF9wbGF5ZXJfbmFtZSwgZW50aXR5X2dldF9wbGF5ZXJfcmVzb3VyY2UsIGVudGl0eV9nZXRfcGxheWVyX3dlYXBvbiwgZW50aXR5X2dldF9wbGF5ZXJzLCBlbnRpdHlfZ2V0X3Byb3AsIGVudGl0eV9oaXRib3hfcG9zaXRpb24sIGVudGl0eV9pc19hbGl2ZSwgZW50aXR5X2lzX2Rvcm1hbnQsIGVudGl0eV9pc19lbmVteSwgZW50aXR5X3NldF9wcm9wID0gZW50aXR5LmdldF9jbGFzc25hbWUsIGVudGl0eS5nZXRfZXNwX2RhdGEsIGVudGl0eS5nZXRfZ2FtZV9ydWxlcywgZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIsIGVudGl0eS5nZXRfb3JpZ2luLCBlbnRpdHkuZ2V0X3BsYXllcl9uYW1lLCBlbnRpdHkuZ2V0X3BsYXllcl9yZXNvdXJjZSwgZW50aXR5LmdldF9wbGF5ZXJfd2VhcG9uLCBlbnRpdHkuZ2V0X3BsYXllcnMsIGVudGl0eS5nZXRfcHJvcCwgZW50aXR5LmhpdGJveF9wb3NpdGlvbiwgZW50aXR5LmlzX2FsaXZlLCBlbnRpdHkuaXNfZG9ybWFudCwgZW50aXR5LmlzX2VuZW15LCBlbnRpdHkuc2V0X3Byb3A7CmxvY2FsIGdsb2JhbHNfY2hva2VkY29tbWFuZHMsIGdsb2JhbHNfY3VydGltZSwgZ2xvYmFsc19mcmFtZXRpbWUsIGdsb2JhbHNfcmVhbHRpbWUsIGdsb2JhbHNfdGlja2NvdW50LCBnbG9iYWxzX3RpY2tpbnRlcnZhbCA9IGdsb2JhbHMuY2hva2VkY29tbWFuZHMsIGdsb2JhbHMuY3VydGltZSwgZ2xvYmFscy5mcmFtZXRpbWUsIGdsb2JhbHMucmVhbHRpbWUsIGdsb2JhbHMudGlja2NvdW50LCBnbG9iYWxzLnRpY2tpbnRlcnZhbDsKbG9jYWwganNvbl9wYXJzZSwganNvbl9zdHJpbmdpZnkgPSBqc29uLnBhcnNlLCBqc29uLnN0cmluZ2lmeTsKbG9jYWwgcGFub3JhbWFfbG9hZHN0cmluZywgcGFub3JhbWFfb3BlbiA9IHBhbm9yYW1hLmxvYWRzdHJpbmcsIHBhbm9yYW1hLm9wZW47CmxvY2FsIHJlbmRlcmVyX2NpcmNsZV9vdXRsaW5lLCByZW5kZXJlcl9pbmRpY2F0b3IsIHJlbmRlcmVyX2xpbmUsIHJlbmRlcmVyX2xvYWRfc3ZnLCByZW5kZXJlcl9tZWFzdXJlX3RleHQsIHJlbmRlcmVyX3JlY3RhbmdsZSwgcmVuZGVyZXJfdGV4dCwgcmVuZGVyZXJfdGV4dHVyZSwgcmVuZGVyZXJfdHJpYW5nbGUsIHJlbmRlcmVyX3dvcmxkX3RvX3NjcmVlbiA9IHJlbmRlcmVyLmNpcmNsZV9vdXRsaW5lLCByZW5kZXJlci5pbmRpY2F0b3IsIHJlbmRlcmVyLmxpbmUsIHJlbmRlcmVyLmxvYWRfc3ZnLCByZW5kZXJlci5tZWFzdXJlX3RleHQsIHJlbmRlcmVyLnJlY3RhbmdsZSwgcmVuZGVyZXIudGV4dCwgcmVuZGVyZXIudGV4dHVyZSwgcmVuZGVyZXIudHJpYW5nbGUsIHJlbmRlcmVyLndvcmxkX3RvX3NjcmVlbjsKbG9jYWwgdWlfZ2V0LCB1aV9pc19tZW51X29wZW4sIHVpX21vdXNlX3Bvc2l0aW9uLCB1aV9uYW1lLCB1aV9uZXdfYnV0dG9uLCB1aV9uZXdfY2hlY2tib3gsIHVpX25ld19jb2xvcl9waWNrZXIsIHVpX25ld19jb21ib2JveCwgdWlfbmV3X2hvdGtleSwgdWlfbmV3X2xhYmVsLCB1aV9uZXdfbGlzdGJveCwgdWlfbmV3X211bHRpc2VsZWN0LCB1aV9uZXdfc2xpZGVyLCB1aV9uZXdfc3RyaW5nLCB1aV9uZXdfdGV4dGJveCwgdWlfcmVmZXJlbmNlLCB1aV9zZXQsIHVpX3NldF9jYWxsYmFjaywgdWlfc2V0X2VuYWJsZWQsIHVpX3NldF92aXNpYmxlLCB1aV90eXBlLCB1aV91cGRhdGUgPSB1aS5nZXQsIHVpLmlzX21lbnVfb3BlbiwgdWkubW91c2VfcG9zaXRpb24sIHVpLm5hbWUsIHVpLm5ld19idXR0b24sIHVpLm5ld19jaGVja2JveCwgdWkubmV3X2NvbG9yX3BpY2tlciwgdWkubmV3X2NvbWJvYm94LCB1aS5uZXdfaG90a2V5LCB1aS5uZXdfbGFiZWwsIHVpLm5ld19saXN0Ym94LCB1aS5uZXdfbXVsdGlzZWxlY3QsIHVpLm5ld19zbGlkZXIsIHVpLm5ld19zdHJpbmcsIHVpLm5ld190ZXh0Ym94LCB1aS5yZWZlcmVuY2UsIHVpLnNldCwgdWkuc2V0X2NhbGxiYWNrLCB1aS5zZXRfZW5hYmxlZCwgdWkuc2V0X3Zpc2libGUsIHVpLnR5cGUsIHVpLnVwZGF0ZTsKCmxvY2FsIHRvdGlja3MsIHZ0YWJsZV9iaW5kLCB2dGFibGVfdGh1bmsgPSB0b3RpY2tzLCB2dGFibGVfYmluZCwgdnRhYmxlX3RodW5rOwotLS0gQGRpYWdub3N0aWMgZW5hYmxlCgpsb2NhbCBmdW5jdGlvbiBMUEhfTk9fVklSVFVBTElaRSguLi4pCiAgICByZXR1cm4gLi4uOwplbmQKCi0tLSBwYWNrYWdlcwpsb2NhbCBmZmkgPSByZXF1aXJlICJmZmkiOwpsb2NhbCB2ZWN0b3IgPSByZXF1aXJlICJ2ZWN0b3IiOwoKbG9jYWwgYmFzZTY0ID0gcmVxdWlyZSAiZ2FtZXNlbnNlL2Jhc2U2NCI7CmxvY2FsIGNsaXBib2FyZCA9IHJlcXVpcmUgImdhbWVzZW5zZS9jbGlwYm9hcmQiOwpsb2NhbCBjX2VudGl0eSA9IHJlcXVpcmUgImdhbWVzZW5zZS9lbnRpdHkiOwpsb2NhbCBjX3dlYXBvbiA9IHJlcXVpcmUgImdhbWVzZW5zZS9jc2dvX3dlYXBvbnMiOwoKLS0tIGRlZmluZXMKbG9jYWwgT0JFWCA9IG9iZXhfZmV0Y2ggfj0gbmlsCiAgICBhbmQgb2JleF9mZXRjaCgpIG9yIHsKICAgICAgICB1c2VybmFtZSA9ICJ1c2VyIiwKICAgICAgICBidWlsZCA9ICJVc2VyIiwKICAgICAgICBkaXNjb3JkID0gInVua25vd24iCiAgICB9OwoKbG9jYWwgTFVBX05BTUUgPSAiU2Vua29UZWNoIjsKbG9jYWwgTFVBX1VQREFURV9XQVMgPSAxNjk0NDI3ODgyOwoKbG9jYWwgVVNFUiA9IE9CRVgudXNlcm5hbWU7Cgpsb2NhbCBCVUlMRCA9IE9CRVguYnVpbGQ7CmxvY2FsIEJVSUxEX0NPTE9SOwoKaWYgQlVJTEQgPT0gIlVzZXIiIHRoZW4KICAgIEJVSUxEID0gIlN0YWJsZSI7CmVuZAoKaWYgQlVJTEQgPT0gIkRlYnVnIiB0aGVuCiAgICBCVUlMRCA9ICJUd2lsaWdodCI7CmVuZAoKaWYgQlVJTEQgPT0gIlByaXZhdGUiIHRoZW4KICAgIEJVSUxEID0gIkluc2lkZXJzIjsKICAgIEJVSUxEX0NPTE9SID0gIjI0YmZhNWZmIjsKZW5kCgotLS0gY29uc3RhbnRzCmxvY2FsIFBMQVlFUl9GTEFHUyA9IHsKICAgIEZMX09OR1JPVU5EID0gYml0X2xzaGlmdCgxLCAwKSwKICAgIEZMX0ZST1pFTiAgID0gYml0X2xzaGlmdCgxLCA1KQp9OwoKbG9jYWwgRVNQX0ZMQUdTID0gewogICAgSElUID0gYml0X2xzaGlmdCgxLCAxMSkKfTsKCi0tLSBlbnVtZXJhdGlvbnMKbG9jYWwgZV9zdGF0ZW1lbnQgPSB7CiAgICBbMF0gID0gIk1haW4iLAogICAgWzFdICA9ICJTdGFuZGluZyIsCiAgICBbMl0gID0gIk1vdmluZyIsCiAgICBbM10gID0gIlNsb3ctbW90aW9uIiwKICAgIFs0XSAgPSAiQ3JvdWNoZWQiLAogICAgWzVdICA9ICJNb3ZlLWNyb3VjaGVkIiwKICAgIFs2XSAgPSAiQWlyYm9ybmUiLAogICAgWzddICA9ICJBaXJib3JuZS1jcm91Y2hlZCIsCiAgICBbOF0gID0gIkRlZmVuc2l2ZSIsCiAgICBbOV0gID0gIkZha2UgTGFnIgp9OwoKbG9jYWwgZV9ob3RrZXlfbW9kZSA9IHsKICAgIFswXSA9ICJBbHdheXMgb24iLAogICAgWzFdID0gIk9uIGhvdGtleSIsCiAgICBbMl0gPSAiVG9nZ2xlIiwKICAgIFszXSA9ICJPZmYgaG90a2V5Igp9OwoKLS0tIGRlY2xhcmF0aW9ucwpsb2NhbCBmdW5jdGlvbiBEVU1NWSgpIGVuZAoKbG9jYWwgZnVuY3Rpb24gdTgocykKICAgIHJldHVybiBzdHJpbmdfZ3N1YihzLCAiW1wxMjgtXDE5MV0iLCAiIik7CmVuZAoKbG9jYWwgZnVuY3Rpb24gY2xhbXAoeCwgbWluLCBtYXgpCiAgICByZXR1cm4gbWF4ZihtaW4sIG1pbmYoeCwgbWF4KSk7CmVuZAoKbG9jYWwgZnVuY3Rpb24gbGVycChhLCBiLCB0KQogICAgcmV0dXJuIGEgKyB0ICogKGIgLSBhKTsKZW5kCgpsb2NhbCBmdW5jdGlvbiBzaWduKHgpCiAgICBpZiB4ID4gMCB0aGVuIHJldHVybiAxIGVuZAogICAgaWYgeCA8IDAgdGhlbiByZXR1cm4gLTEgZW5kCgogICAgcmV0dXJuIDA7CmVuZAoKbG9jYWwgZnVuY3Rpb24gcm91bmQoeCkKICAgIGlmIHggPCAwIHRoZW4KICAgICAgICByZXR1cm4gY2VpbCh4IC0gMC41KTsKICAgIGVuZAoKICAgIHJldHVybiBmbG9vcih4ICsgMC41KTsKZW5kCgpsb2NhbCBmdW5jdGlvbiBlbXB0eShsaXN0KQogICAgcmV0dXJuIG5leHQobGlzdCkgPT0gbmlsOwplbmQKCmxvY2FsIGZ1bmN0aW9uIHRhYmxlX2tleXMobGlzdCkKICAgIGxvY2FsIGtleXMgPSB7IH07CgogICAgZm9yIGssIHYgaW4gcGFpcnMobGlzdCkgZG8KICAgICAgICBrZXlzW3ZdID0gazsKICAgIGVuZAoKICAgIHJldHVybiBrZXlzOwplbmQKCi0tLSB3b3Jrc3BhY2UKbG9jYWwgYXNzZXRzID0geyB9Owpsb2NhbCB1dGlscyA9IHsgfTsKCmxvY2FsIHNvZnR3YXJlID0geyB9Owpsb2NhbCBkYiA9IHsgfTsKCmxvY2FsIGlpbnB1dCA9IHsgfTsKbG9jYWwgaWVuZ2luZWNsaWVudCA9IHsgfTsKbG9jYWwgaWNsaWVudHN0YXRlID0geyB9Owpsb2NhbCBpZW5naW5lc291bmQgPSB7IH07CmxvY2FsIGluZXRjaGFubmVsID0geyB9OwoKbG9jYWwgbW90aW9uID0geyB9Owpsb2NhbCBkZWNvcmF0aW9ucyA9IHsgfTsKbG9jYWwgbGVnX21vdmVtZW50ID0geyB9OwoKbG9jYWwgZXhwbG9pdCA9IHsgfTsKbG9jYWwgbG9jYWxwbGF5ZXIgPSB7IH07CmxvY2FsIHN0YXRlbWVudCA9IHsgfTsKCmxvY2FsIG1lbnUgPSB7IH07CmxvY2FsIHRoZW1lID0geyB9Owpsb2NhbCBzZXR0aW5ncyA9IHsgfTsKbG9jYWwgb3ZlcnJpZGUgPSB7IH07Cgpsb2NhbCBob21lID0geyB9Owpsb2NhbCBwcm9maWxlID0geyB9Owpsb2NhbCBhbnRpYWltYm90ID0geyB9Owpsb2NhbCB2aXN1YWxpemF0aW9uID0geyB9OwoKbG9jYWwgY29ycmVjdGlvbiA9IHsgfTsKCmxvY2FsIGFuZ2xlcyA9IHsgfTsKbG9jYWwgYW50aWJydXRlZm9yY2UgPSB7IH07Cgpsb2NhbCB5YXdfZGlyZWN0aW9uID0geyB9Owpsb2NhbCBtYW51YWxfZGlyZWN0aW9uID0geyB9OwoKbG9jYWwgYXZvaWRfYmFja3N0YWIgPSB7IH07CmxvY2FsIHNhZmVfaGVhZCA9IHsgfTsKCmxvY2FsIGJyZWFrX2xjID0geyB9Owpsb2NhbCBkZWZlbnNpdmUgPSB7IH07Cgpsb2NhbCBpbmRpY2F0ZV9zdGF0ZSA9IHsgfTsKbG9jYWwgY29ubmVjdGlvbl9pbmZvID0geyB9OwoKbG9jYWwgZHJvcF9ncmVuYWRlcyA9IHsgfTsKbG9jYWwgcXVpY2tfbGFkZGVyX21vdmUgPSB7IH07CmxvY2FsIGhpdHNvdW5kID0geyB9Owpsb2NhbCBhbmltYXRpb25fYnJlYWtlcnMgPSB7IH07CgpmZmkuY2RlZiBbWwogICAgdHlwZWRlZiBzdHJ1Y3QgewogICAgICAgIGZsb2F0IHg7CiAgICAgICAgZmxvYXQgeTsKICAgICAgICBmbG9hdCB6OwogICAgfSB2ZWN0b3JfdDsKCiAgICB0eXBlZGVmIHN0cnVjdCB7CiAgICAgICAgdm9pZCAgICAgKnZmcHRyOwogICAgICAgIGludCAgICAgIGNvbW1hbmRfbnVtYmVyOwogICAgICAgIGludCAgICAgIHRpY2tjb3VudDsKICAgICAgICB2ZWN0b3JfdCB2aWV3YW5nbGVzOwogICAgICAgIHZlY3Rvcl90IGFpbWRpcmVjdGlvbjsKICAgICAgICBmbG9hdCAgICBmb3J3YXJkbW92ZTsKICAgICAgICBmbG9hdCAgICBzaWRlbW92ZTsKICAgICAgICBmbG9hdCAgICB1cG1vdmU7CiAgICAgICAgaW50ICAgICAgYnV0dG9uczsKICAgICAgICB1aW50OF90ICBpbXB1bHNlOwogICAgICAgIGludCAgICAgIHdlYXBvbnNlbGVjdDsKICAgICAgICBpbnQgICAgICB3ZWFwb25zdWJ0eXBlOwogICAgICAgIGludCAgICAgIHJhbmRvbV9zZWVkOwogICAgICAgIHNob3J0ICAgIG1vdXNlZHg7CiAgICAgICAgc2hvcnQgICAgbW91c2VkeTsKICAgICAgICBib29sICAgICBoYXNiZWVucHJlZGljdGVkOwogICAgICAgIHZlY3Rvcl90IGhlYWRhbmdsZXM7CiAgICAgICAgdmVjdG9yX3QgaGVhZG9mZnNldDsKICAgICAgICBjaGFyCSBwYWRfMHg0Q1sweDE4XTsKICAgIH0gY3VzZXJjbWRfdDsKCiAgICB0eXBlZGVmIHN0cnVjdCB7CiAgICAgICAgY2hhciAgIHBhZF8wMDAwWzI0XTsgICAgICAgICAgICAgICAgICAgIC8vMHgwMDAwCiAgICAgICAgaW50ICAgIG1fbk91dFNlcXVlbmNlTnI7ICAgICAgICAgICAgICAgIC8vMHgwMDE4CiAgICAgICAgaW50ICAgIG1fbkluU2VxdWVuY2VOcjsgICAgICAgICAgICAgICAgIC8vMHgwMDFDCiAgICAgICAgaW50ICAgIG1fbk91dFNlcXVlbmNlTnJBY2s7ICAgICAgICAgICAgIC8vMHgwMDIwCiAgICAgICAgaW50ICAgIG1fbk91dFJlbGlhYmxlU3RhdGU7ICAgICAgICAgICAgIC8vMHgwMDI0CiAgICAgICAgaW50ICAgIG1fbkluUmVsaWFibGVTdGF0ZTsgICAgICAgICAgICAgIC8vMHgwMDI4CiAgICAgICAgaW50ICAgIG1fbkNob2tlZFBhY2tldHM7ICAgICAgICAgICAgICAgIC8vMHgwMDJDCiAgICAgICAgY2hhciAgIHBhZF8wMDMwWzEwOF07ICAgICAgICAgICAgICAgICAgIC8vMHgwMDMwCiAgICAgICAgaW50ICAgIG1fU29ja2V0OyAgICAgICAgICAgICAgICAgICAgICAgIC8vMHgwMDlDCiAgICAgICAgaW50ICAgIG1fU3RyZWFtU29ja2V0OyAgICAgICAgICAgICAgICAgIC8vMHgwMEEwCiAgICAgICAgaW50ICAgIG1fTWF4UmVsaWFibGVQYXlsb2FkU2l6ZTsgICAgICAgIC8vMHgwMEE0CiAgICAgICAgY2hhciAgIHBhZF8wMEE4WzEwMF07ICAgICAgICAgICAgICAgICAgIC8vMHgwMEE4CiAgICAgICAgZmxvYXQgIGxhc3RfcmVjZWl2ZWQ7ICAgICAgICAgICAgICAgICAgIC8vMHgwMTBDCiAgICAgICAgZmxvYXQgIGNvbm5lY3RfdGltZTsgICAgICAgICAgICAgICAgICAgIC8vMHgwMTEwCiAgICAgICAgY2hhciAgIHBhZF8wMTE0WzRdOyAgICAgICAgICAgICAgICAgICAgIC8vMHgwMTE0CiAgICAgICAgaW50ICAgIG1fUmF0ZTsgICAgICAgICAgICAgICAgICAgICAgICAgIC8vMHgwMTE4CiAgICAgICAgY2hhciAgIHBhZF8wMTFDWzRdOyAgICAgICAgICAgICAgICAgICAgIC8vMHgwMTFDCiAgICAgICAgZmxvYXQgIG1fZkNsZWFyVGltZTsgICAgICAgICAgICAgICAgICAgIC8vMHgwMTIwCiAgICAgICAgY2hhciAgIHBhZF8wMTI0WzE2Njg4XTsgICAgICAgICAgICAgICAgIC8vMHgwMTI0CiAgICAgICAgY2hhciAgIG1fTmFtZVszMl07ICAgICAgICAgICAgICAgICAgICAgIC8vMHg0MjU0CiAgICAgICAgc2l6ZV90IG1fQ2hhbGxlbmdlTnI7ICAgICAgICAgICAgICAgICAgIC8vMHg0Mjc0CiAgICAgICAgZmxvYXQgIG1fZmxUaW1lb3V0OyAgICAgICAgICAgICAgICAgICAgIC8vMHg0Mjc4CiAgICAgICAgY2hhciAgIHBhZF80MjdDWzMyXTsgICAgICAgICAgICAgICAgICAgIC8vMHg0MjdDCiAgICAgICAgZmxvYXQgIG1fZmxJbnRlcnBvbGF0aW9uQW1vdW50OyAgICAgICAgIC8vMHg0MjlDCiAgICAgICAgZmxvYXQgIG1fZmxSZW1vdGVGcmFtZVRpbWU7ICAgICAgICAgICAgIC8vMHg0MkEwCiAgICAgICAgZmxvYXQgIG1fZmxSZW1vdGVGcmFtZVRpbWVTdGREZXZpYXRpb247IC8vMHg0MkE0CiAgICAgICAgaW50ICAgIG1fbk1heFJvdXRhYmxlUGF5bG9hZFNpemU7ICAgICAgIC8vMHg0MkE4CiAgICAgICAgaW50ICAgIG1fblNwbGl0UGFja2V0U2VxdWVuY2U7ICAgICAgICAgIC8vMHg0MkFDCiAgICAgICAgY2hhciAgIHBhZF80MkIwWzQwXTsgICAgICAgICAgICAgICAgICAgIC8vMHg0MkIwCiAgICAgICAgYm9vbCAgIG1fYklzVmFsdmVEUzsgICAgICAgICAgICAgICAgICAgIC8vMHg0MkQ4CiAgICAgICAgY2hhciAgIHBhZF80MkQ5WzY1XTsgICAgICAgICAgICAgICAgICAgIC8vMHg0MkQ5CiAgICB9IGluZXRjaGFubmVsX3Q7CgogICAgdHlwZWRlZiBzdHJ1Y3QgewogICAgICAgIGNoYXIgICAgICAgICAgcGFkMFsweDlDXTsgICAgICAgICAgICAgICAgLy8gMHgwMDAwCiAgICAgICAgaW5ldGNoYW5uZWxfdCAqcE5ldENoYW5uZWw7ICAgICAgICAgICAgICAvLyAweDAwOUMKICAgICAgICBpbnQgICAgICAgICAgIGlDaGFsbGVuZ2VOcjsgICAgICAgICAgICAgIC8vIDB4MDBBMAogICAgICAgIGNoYXIgICAgICAgICAgcGFkMVsweDY0XTsgICAgICAgICAgICAgICAgLy8gMHgwMEE0CiAgICAgICAgaW50ICAgICAgICAgICBpU2lnbm9uU3RhdGU7ICAgICAgICAgICAgICAvLyAweDAxMDgKICAgICAgICBjaGFyICAgICAgICAgIHBhZDJbMHg4XTsgICAgICAgICAgICAgICAgIC8vIDB4MDEwQwogICAgICAgIGZsb2F0ICAgICAgICAgZmxOZXh0Q21kVGltZTsgICAgICAgICAgICAgLy8gMHgwMTE0CiAgICAgICAgaW50ICAgICAgICAgICBuU2VydmVyQ291bnQ7ICAgICAgICAgICAgICAvLyAweDAxMTgKICAgICAgICBpbnQgICAgICAgICAgIGlDdXJyZW50U2VxdWVuY2U7ICAgICAgICAgIC8vIDB4MDExQwogICAgICAgIGNoYXIgICAgICAgICAgcGFkM1sweDU0XTsgICAgICAgICAgICAgICAgLy8gMHgwMTIwCiAgICAgICAgaW50ICAgICAgICAgICBpRGVsdGFUaWNrOyAgICAgICAgICAgICAgICAvLyAweDAxNzQKICAgICAgICBib29sICAgICAgICAgIGJQYXVzZWQ7ICAgICAgICAgICAgICAgICAgIC8vIDB4MDE3OAogICAgICAgIGNoYXIgICAgICAgICAgcGFkNFsweDddOyAgICAgICAgICAgICAgICAgLy8gMHgwMTc5CiAgICAgICAgaW50ICAgICAgICAgICBpVmlld0VudGl0eTsgICAgICAgICAgICAgICAvLyAweDAxODAKICAgICAgICBpbnQgICAgICAgICAgIGlQbGF5ZXJTbG90OyAgICAgICAgICAgICAgIC8vIDB4MDE4NAogICAgICAgIGNoYXIgICAgICAgICAgc3pMZXZlbE5hbWVbMjYwXTsgICAgICAgICAgLy8gMHgwMTg4CiAgICAgICAgY2hhciAgICAgICAgICBzekxldmVsTmFtZVNob3J0WzgwXTsgICAgICAvLyAweDAyOEMKICAgICAgICBjaGFyICAgICAgICAgIHN6TWFwR3JvdXBOYW1lWzgwXTsgICAgICAgIC8vIDB4MDJEQwogICAgICAgIGNoYXIgICAgICAgICAgc3pMYXN0TGV2ZWxOYW1lU2hvcnRbODBdOyAgLy8gMHgwMzJDCiAgICAgICAgY2hhciAgICAgICAgICBwYWQ1WzB4Q107ICAgICAgICAgICAgICAgICAvLyAweDAzN0MKICAgICAgICBpbnQgICAgICAgICAgIG5NYXhDbGllbnRzOyAgICAgICAgICAgICAgIC8vIDB4MDM4OAogICAgICAgIGNoYXIgICAgICAgICAgcGFkNlsweDQ5OENdOyAgICAgICAgICAgICAgLy8gMHgwMzhDCiAgICAgICAgZmxvYXQgICAgICAgICBmbExhc3RTZXJ2ZXJUaWNrVGltZTsgICAgICAvLyAweDREMTgKICAgICAgICBib29sICAgICAgICAgIGJJblNpbXVsYXRpb247ICAgICAgICAgICAgIC8vIDB4NEQxQwogICAgICAgIGNoYXIgICAgICAgICAgcGFkN1sweDNdOyAgICAgICAgICAgICAgICAgLy8gMHg0RDFECiAgICAgICAgaW50ICAgICAgICAgICBpT2xkVGlja2NvdW50OyAgICAgICAgICAgICAvLyAweDREMjAKICAgICAgICBmbG9hdCAgICAgICAgIGZsVGlja1JlbWFpbmRlcjsgICAgICAgICAgIC8vIDB4NEQyNAogICAgICAgIGZsb2F0ICAgICAgICAgZmxGcmFtZVRpbWU7ICAgICAgICAgICAgICAgLy8gMHg0RDI4CiAgICAgICAgaW50ICAgICAgICAgICBpTGFzdE91dGdvaW5nQ29tbWFuZDsgICAgICAvLyAweDREMkMKICAgICAgICBpbnQgICAgICAgICAgIG5DaG9rZWRDb21tYW5kczsgICAgICAgICAgIC8vIDB4NEQzMAogICAgICAgIGludCAgICAgICAgICAgaUxhc3RDb21tYW5kQWNrOyAgICAgICAgICAgLy8gMHg0RDM0CiAgICAgICAgaW50ICAgICAgICAgICBpQ29tbWFuZEFjazsgICAgICAgICAgICAgICAvLyAweDREMzgKICAgICAgICBpbnQgICAgICAgICAgIGlTb3VuZFNlcXVlbmNlOyAgICAgICAgICAgIC8vIDB4NEQzQwogICAgICAgIGNoYXIgICAgICAgICAgcGFkOFsweDUwXTsgICAgICAgICAgICAgICAgLy8gMHg0RDQwCiAgICAgICAgdmVjdG9yX3QgICAgICBhbmdWaWV3UG9pbnQ7ICAgICAgICAgICAgICAvLyAweDREOTAKICAgICAgICBjaGFyICAgICAgICAgIHBhZDlbMHhEMF07ICAgICAgICAgICAgICAgIC8vIDB4NEQ5QwogICAgICAgIHZvaWQqICAgICAgICAgcEV2ZW50czsgICAgICAgICAgICAgICAgICAgLy8gMHg0RTZDCiAgICB9IGljbGllbnRzdGF0ZV90OwpdXTsKCi0tLSByZWdpb24gYXNzZXRzCmRvCiAgICBhc3NldHMuc3ZnID0gewogICAgICAgIGljb25zID0gewogICAgICAgICAgICBhbHQgPSBbWwogICAgICAgICAgICAgICAgPHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNzcuNTc2NyAxMTAuMTVDNzcuNTc2NyAxMTAuMTUgNzIuODU4OCAxMDMuMjE3IDczLjQ0NDUgOTIuMTc4MUM2MC4wOTkyIDk3LjI0MzYgNTYuMzI1NiAxMDYuOTk1IDUxLjYwMzEgMTIxLjc0NUM0Ni45OTYgMTMxLjUyMSA0Mi43ODg4IDEzMy42NDYgMzMuMzAzNiAxMzMuMzM5QzE4LjIyNjkgMTMyLjEyNSAxMi44OTU1IDEyNC44NTQgMTIuMDUyNSAxMDguOTkxQzExLjkzNzkgMTA2LjgzMyAxMi4wNDU2IDEwNC41MTYgMTIuMDUyNSAxMDIuMDM0QzEyLjM5MTIgOTkuNTYzNCAxMi4zNDY5IDk2LjgwNTQgMTIuNzk1OSA5NC40OTcxQzEzLjQxMjYgOTEuMzI3IDE0LjE3MSA4OC42NzcyIDE1LjAwNDEgODUuODAxQzIzLjc3NSA1NS41MTkgNDUuNzk1NCA0MS4xNTE4IDg0LjY2MDQgMzQuNzg0Mkw3OS45Mzc5IDQxLjc0MUw3Ni4zOTYgNTEuMDE2OEw3My40NDQ1IDYwLjI5MjZMNzEuNjczNiA2OS41Njg0VjczLjYyNjZMNzIuMjYzOSA3OC4yNjQ1TDcyLjg1NDIgNzkuNDIzOUw3NC4wMzQ4IDgwLjAwMzdMNzUuODA1NyA3OS40MjM5TDc5LjkzNzkgNzUuOTQ1NUw4NC42NjA0IDcwLjE0ODFMODkuMzgyOCA2My4xOTEzTDkzLjUxNSA1Ni4yMzQ1TDk3LjA1NjcgNDkuMjc3NkwxMDAuMDA4IDQwLjU4MTZDMTAzLjMwMyAyNC43NzEyIDEwMy45NjQgMTUuNDAwNCAxMDAuNTk5IDBDMTM0LjA5MSAxNS42IDE0Ny4zMTYgMzAuOTgxMiAxNTkuNjI5IDcxLjg4NzRDMTYyLjg2NSA2OS4yMTQ2IDE2My44MiA2Ny40MDg4IDE2NC4zNTEgNjMuNzcxQzE3Ny41NTIgODIuMDAwNiAxODEuMTUxIDkzLjg4NDEgMTc5LjY5OSAxMTEuODg5TDE3OC41MTkgMTI0LjY0M0MxNzMuMDQ1IDE1MC40ODIgMTY1LjkxOCAxNTguOTg3IDE1MS45NTUgMTcxLjYwMkMxMzEuMzUyIDE4OS40MzIgMTE2LjIxOSAxOTMuOTI5IDgyLjI5OTEgMTkxLjMxM0w3NC42MjUxIDE4OS41NzRMNjYuOTUxMSAxODYuNjc1TDYxLjA0NzkgMTgzLjc3N0M1MS40MTUyIDE3OC41ODkgNDcuNDcxIDE1Ny42ODggNzQuNjI1MSAxNTYuNTI5QzgxLjc3MDkgMTU2LjIyNCA4NS43NjkgMTU2LjA3OSA4Ny43ODExIDE1Ni4wMzFMOTMuNTE1IDE1NS4zNjlMMTAzLjU1IDE1Mi40NzFMMTEwLjYzNCAxNDguOTkyTDExNS45NDcgMTQ1LjUxNEwxMjIuNDQgMTQwLjg3NkMxMDQuODE5IDEzNi4xMzQgOTYuNzAwNiAxMzEuNzAyIDkxLjc0NCAxMTQuMjA4QzkxLjEzNjcgMTA3LjYxNSA5MS4xNjkgMTAzLjc5NiA5MS43NDQgOTYuODE2Qzg0LjAxMTQgMTAwLjc0NyA3Ny41NzY3IDExMC4xNSA3Ny41NzY3IDExMC4xNVoiIGZpbGw9IndoaXRlIi8+CiAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNzggMTMyQzgxLjMxMzcgMTMyIDg0IDEyOS4zMTQgODQgMTI2Qzg0IDEyMi42ODYgODEuMzEzNyAxMjAgNzggMTIwQzc0LjY4NjMgMTIwIDcyIDEyMi42ODYgNzIgMTI2QzcyIDEyOS4zMTQgNzQuNjg2MyAxMzIgNzggMTMyWiIgZmlsbD0id2hpdGUiLz4KICAgICAgICAgICAgICAgIDwvc3ZnPgogICAgICAgICAgICBdXQogICAgICAgIH0sCgogICAgICAgIGFycm93cyA9IHsKICAgICAgICAgICAgcmVuZXdlZCA9IFtbCiAgICAgICAgICAgICAgICA8c3ZnIHdpZHRoPSI0MiIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDQyIDQ4IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgICAgICAgICAgICAgPHBhdGggZD0iTTQuNSA0Ni41TDM5IDI3QzQwLjcyMTMgMjUuOTg5OCA0MC43MjMgMjMuNTA3IDM5IDIyLjVMNC41IDEuNUMyLjA4NzA2IDAuMDg5OTMxMyAwLjA2MzE1NjggMi4xODAzOSAxLjUgNC41TDEyLjM3OTYgMjMuMTc5OEMxMi44NzkzIDIzLjk4NjYgMTIuODgwMyAyNC45ODcxIDEyLjM4MjMgMjUuNzk0OEwxLjUgNDMuNUMwLjA2Nzk0MDIgNDUuODIyNiAyLjA5IDQ3LjkxNSA0LjUgNDYuNVoiIGZpbGw9IndoaXRlIi8+CiAgICAgICAgICAgICAgICA8L3N2Zz4KICAgICAgICAgICAgXV0KICAgICAgICB9CiAgICB9OwoKICAgIGFzc2V0cy5zaWduYXR1cmVzID0gewogICAgICAgIGlpbnB1dCA9IHsKICAgICAgICAgICAgImNsaWVudC5kbGwiLAogICAgICAgICAgICAiXHhCOVx4Q0NceENDXHhDQ1x4Q0NceDhCXHg0MFx4MzhceEZGXHhEMFx4ODRceEMwXHgwRlx4ODUiLAogICAgICAgICAgICAxCiAgICAgICAgfQogICAgfTsKZW5kCgotLS0gcmVnaW9uIHV0aWxzCmRvCiAgICBsb2NhbCBqcyA9IHBhbm9yYW1hX2xvYWRzdHJpbmcgW1sKICAgICAgICBjb25zdCBNT05USF9OQU1FUyA9IFsKICAgICAgICAgICAgIkphbnVhcnkiLCAiRmVicnVhcnkiLCAiTWFyY2giLAogICAgICAgICAgICAiQXByaWwiLCAiTWF5IiwgIkp1bmUiLAogICAgICAgICAgICAiSnVseSIsICJBdWd1c3QiLCAiU2VwdGVtYmVyIiwKICAgICAgICAgICAgIk9jdG9iZXIiLCAiTm92ZW1iZXIiLCAiRGVjZW1iZXIiCiAgICAgICAgXTsKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgbmV3X2RhdGUodGltZXN0YW1wKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERhdGUodGltZXN0YW1wKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGdldF9tb250aF9uYW1lKG1vbnRoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gTU9OVEhfTkFNRVNbbW9udGhdOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgXV0oKTsKCiAgICBmdW5jdGlvbiB1dGlscy5pc19vZGQoeCkKICAgICAgICByZXR1cm4gYml0X2JhbmQoeCwgMSkgfj0gMDsKICAgIGVuZAoKICAgIGZ1bmN0aW9uIHV0aWxzLnRvX2hleChyLCBnLCBiLCBhKQogICAgICAgIHJldHVybiBmKCIlMDJ4JTAyeCUwMnglMDJ4IiwgciwgZywgYiwgYSk7CiAgICBlbmQKCiAgICBmdW5jdGlvbiB1dGlscy5mcm9tX2hleChoZXgpCiAgICAgICAgaGV4ID0gc3RyaW5nLmdzdWIoaGV4LCAiIyIsICIiKTsKCiAgICAgICAgbG9jYWwgciA9IHRvbnVtYmVyKHN0cmluZy5zdWIoaGV4LCAxLCAyKSwgMTYpOwogICAgICAgIGxvY2FsIGcgPSB0b251bWJlcihzdHJpbmcuc3ViKGhleCwgMywgNCksIDE2KTsKICAgICAgICBsb2NhbCBiID0gdG9udW1iZXIoc3RyaW5nLnN1YihoZXgsIDUsIDYpLCAxNik7CiAgICAgICAgbG9jYWwgYSA9IHRvbnVtYmVyKHN0cmluZy5zdWIoaGV4LCA3LCA4KSwgMTYpOwoKICAgICAgICByZXR1cm4gciwgZywgYiwgYSBvciAyNTU7CiAgICBlbmQKCiAgICBmdW5jdGlvbiB1dGlscy5ub3JtYWxpemUoeCwgbWluLCBtYXgpCiAgICAgICAgbG9jYWwgZGVsdGEgPSBtYXggLSBtaW47CgogICAgICAgIHdoaWxlIHggPCBtaW4gZG8KICAgICAgICAgICAgeCA9IHggKyBkZWx0YTsKICAgICAgICBlbmQKCiAgICAgICAgd2hpbGUgeCA+IG1heCBkbwogICAgICAgICAgICB4ID0geCAtIGRlbHRhOwogICAgICAgIGVuZAoKICAgICAgICByZXR1cm4geDsKICAgIGVuZAoKICAgIGZ1bmN0aW9uIHV0aWxzLm5vcm1hbGl6ZV95YXcoeCkKICAgICAgICByZXR1cm4gdXRpbHMubm9ybWFsaXplKHgsIC0xODAsIDE4MCk7CiAgICBlbmQKCiAgICBmdW5jdGlvbiB1dGlscy5uZXdfZGF0ZSh0aW1lc3RhbXApCiAgICAgICAgcmV0dXJuIGpzLm5ld19kYXRlKHRpbWVzdGFtcCk7CiAgICBlbmQKCiAgICBmdW5jdGlvbiB1dGlscy5nZXRfbW9udGhfbmFtZShtb250aCkKICAgICAgICByZXR1cm4ganMuZ2V0X21vbnRoX25hbWUobW9udGgpOwogICAgZW5kCgogICAgZnVuY3Rpb24gdXRpbHMubWVhc3VyZV90aW1lKHRpbWUpCiAgICAgICAgbG9jYWwgaG91cnMgPSBmbG9vcih0aW1lIC8gMzYwMCk7CiAgICAgICAgbG9jYWwgbWludXRlcyA9IGZsb29yKHRpbWUgLyA2MCkgJSA2MDsKICAgICAgICBsb2NhbCBzZWNvbmRzID0gdGltZSAlIDYwOwoKICAgICAgICByZXR1cm4gaG91cnMsIG1pbnV0ZXMsIHNlY29uZHM7CiAgICBlbmQKCiAgICBmdW5jdGlvbiB1dGlscy5nZXRfZXllX3Bvc2l0aW9uKGVudCkKICAgICAgICBsb2NhbCB4MSwgeTEsIHoxID0gZW50aXR5X2dldF9vcmlnaW4oZW50KTsKICAgICAgICBpZiB4MSA9PSBuaWwgdGhlbiByZXR1cm4gZW5kCgogICAgICAgIGxvY2FsIHgyLCB5MiwgejIgPSBlbnRpdHlfZ2V0X3Byb3AoZW50LCAibV92ZWNWaWV3T2Zmc2V0Iik7CiAgICAgICAgaWYgeDIgPT0gbmlsIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICByZXR1cm4geDEgKyB4MiwgeTEgKyB5MiwgejEgKyB6MjsKICAgIGVuZAoKICAgIGZ1bmN0aW9uIHV0aWxzLmdldF9wbGF5ZXJfd2VhcG9ucyhlbnQpCiAgICAgICAgbG9jYWwgd2VhcG9ucyA9IHsgfTsKCiAgICAgICAgZm9yIGkgPSAwLCA2MyBkbwogICAgICAgICAgICBsb2NhbCB3ZWFwb24gPSBlbnRpdHlfZ2V0X3Byb3AoZW50LCAibV9oTXlXZWFwb25zIiwgaSk7CgogICAgICAgICAgICBpZiB3ZWFwb24gPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIGdvdG8gY29udGludWU7CiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgd2VhcG9uc1sjd2VhcG9ucyArIDFdID0gd2VhcG9uOwogICAgICAgICAgICA6OmNvbnRpbnVlOjoKICAgICAgICBlbmQKCiAgICAgICAgcmV0dXJuIHdlYXBvbnM7CiAgICBlbmQKCiAgICBmdW5jdGlvbiB1dGlscy5maW5kX3NpZ25hdHVyZShtb2R1bGVfbmFtZSwgcGF0dGVybiwgb2Zmc2V0KQogICAgICAgIGxvY2FsIG1hdGNoID0gY2xpZW50X2ZpbmRfc2lnbmF0dXJlKG1vZHVsZV9uYW1lLCBwYXR0ZXJuKTsKCiAgICAgICAgaWYgbWF0Y2ggPT0gbmlsIHRoZW4KICAgICAgICAgICAgcmV0dXJuIG5pbDsKICAgICAgICBlbmQKCiAgICAgICAgaWYgb2Zmc2V0IH49IG5pbCB0aGVuCiAgICAgICAgICAgIGxvY2FsIGFkZHJlc3MgPSBmZmkuY2FzdCgiY2hhcioiLCBtYXRjaCk7CiAgICAgICAgICAgIGFkZHJlc3MgPSBhZGRyZXNzICsgb2Zmc2V0OwoKICAgICAgICAgICAgcmV0dXJuIGFkZHJlc3M7CiAgICAgICAgZW5kCgogICAgICAgIHJldHVybiBtYXRjaDsKICAgIGVuZAplbmQKCi0tLSByZWdpb24gc29mdHdhcmUKZG8KICAgIHNvZnR3YXJlLnJhZ2UgPSB7CiAgICAgICAgd2VhcG9uID0gewogICAgICAgICAgICB3ZWFwb25fdHlwZSA9IHVpX3JlZmVyZW5jZSgiUmFnZSIsICJXZWFwb24gdHlwZSIsICJXZWFwb24gdHlwZSIpCiAgICAgICAgfSwKCiAgICAgICAgYWltYm90ID0gewogICAgICAgICAgICBlbmFibGVkID0geyB1aV9yZWZlcmVuY2UoIlJhZ2UiLCAiQWltYm90IiwgIkVuYWJsZWQiKSB9LAogICAgICAgICAgICB0YXJnZXRfc2VsZWN0aW9uID0gdWlfcmVmZXJlbmNlKCJSYWdlIiwgIkFpbWJvdCIsICJUYXJnZXQgc2VsZWN0aW9uIiksCiAgICAgICAgICAgIG1pbmltdW1fZGFtYWdlID0gdWlfcmVmZXJlbmNlKCJSYWdlIiwgIkFpbWJvdCIsICJNaW5pbXVtIGRhbWFnZSIpLAogICAgICAgICAgICBtaW5pbXVtX2RhbWFnZV9vdmVycmlkZSA9IHsgdWlfcmVmZXJlbmNlKCJSYWdlIiwgIkFpbWJvdCIsICJNaW5pbXVtIGRhbWFnZSBvdmVycmlkZSIpIH0sCiAgICAgICAgICAgIHByZWZlcl9zYWZlX3BvaW50ID0gdWlfcmVmZXJlbmNlKCJSYWdlIiwgIkFpbWJvdCIsICJQcmVmZXIgc2FmZSBwb2ludCIpLAogICAgICAgICAgICBmb3JjZV9zYWZlX3BvaW50ID0gdWlfcmVmZXJlbmNlKCJSYWdlIiwgIkFpbWJvdCIsICJGb3JjZSBzYWZlIHBvaW50IiksCiAgICAgICAgICAgIGZvcmNlX2JvZHlfYWltID0gdWlfcmVmZXJlbmNlKCJSYWdlIiwgIkFpbWJvdCIsICJGb3JjZSBib2R5IGFpbSIpLAogICAgICAgICAgICBkb3VibGVfdGFwID0geyB1aV9yZWZlcmVuY2UoIlJhZ2UiLCAiQWltYm90IiwgIkRvdWJsZSB0YXAiKSB9CiAgICAgICAgfSwKCiAgICAgICAgb3RoZXIgPSB7CiAgICAgICAgICAgIHF1aWNrX3BlZWtfYXNzaXN0ID0geyB1aV9yZWZlcmVuY2UoIlJhZ2UiLCAiT3RoZXIiLCAiUXVpY2sgcGVlayBhc3Npc3QiKSB9LAogICAgICAgICAgICBkdWNrX3BlZWtfYXNzaXN0ID0gdWlfcmVmZXJlbmNlKCJSYWdlIiwgIk90aGVyIiwgIkR1Y2sgcGVlayBhc3Npc3QiKQogICAgICAgIH0KICAgIH07CgogICAgc29mdHdhcmUuYWEgPSB7CiAgICAgICAgYW5nbGVzID0gewogICAgICAgICAgICBlbmFibGVkID0gdWlfcmVmZXJlbmNlKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiRW5hYmxlZCIpLAogICAgICAgICAgICBwaXRjaCA9IHsgdWlfcmVmZXJlbmNlKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiUGl0Y2giKSB9LAogICAgICAgICAgICB5YXdfYmFzZSA9IHVpX3JlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIllhdyBiYXNlIiksCiAgICAgICAgICAgIHlhdyA9IHsgdWlfcmVmZXJlbmNlKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiWWF3IikgfSwKICAgICAgICAgICAgeWF3X2ppdHRlciA9IHsgdWlfcmVmZXJlbmNlKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiWWF3IGppdHRlciIpIH0sCiAgICAgICAgICAgIGJvZHlfeWF3ID0geyB1aV9yZWZlcmVuY2UoIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJCb2R5IHlhdyIpIH0sCiAgICAgICAgICAgIGZyZWVzdGFuZGluZ19ib2R5X3lhdyA9IHVpX3JlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIkZyZWVzdGFuZGluZyBib2R5IHlhdyIpLAogICAgICAgICAgICBlZGdlX3lhdyA9IHVpX3JlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIkVkZ2UgeWF3IiksCiAgICAgICAgICAgIGZyZWVzdGFuZGluZyA9IHsgdWlfcmVmZXJlbmNlKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiRnJlZXN0YW5kaW5nIikgfSwKICAgICAgICAgICAgcm9sbCA9IHVpX3JlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIlJvbGwiKQogICAgICAgIH0sCgogICAgICAgIGZha2VsYWcgPSB7CiAgICAgICAgICAgIGVuYWJsZWQgPSB7IHVpX3JlZmVyZW5jZSgiQUEiLCAiRmFrZSBsYWciLCAiRW5hYmxlZCIpIH0sCiAgICAgICAgICAgIGFtb3VudCA9IHVpX3JlZmVyZW5jZSgiQUEiLCAiRmFrZSBsYWciLCAiQW1vdW50IiksCiAgICAgICAgICAgIHZhcmlhbmNlID0gdWlfcmVmZXJlbmNlKCJBQSIsICJGYWtlIGxhZyIsICJWYXJpYW5jZSIpLAogICAgICAgICAgICBsaW1pdCA9IHVpX3JlZmVyZW5jZSgiQUEiLCAiRmFrZSBsYWciLCAiTGltaXQiKQogICAgICAgIH0sCgogICAgICAgIG90aGVyID0gewogICAgICAgICAgICBzbG93X21vdGlvbiA9IHsgdWlfcmVmZXJlbmNlKCJBQSIsICJPdGhlciIsICJTbG93IG1vdGlvbiIpIH0sCiAgICAgICAgICAgIGxlZ19tb3ZlbWVudCA9IHVpX3JlZmVyZW5jZSgiQUEiLCAiT3RoZXIiLCAiTGVnIG1vdmVtZW50IiksCiAgICAgICAgICAgIG9uX3Nob3RfYW50aWFpbSA9IHsgdWlfcmVmZXJlbmNlKCJBQSIsICJPdGhlciIsICJPbiBzaG90IGFudGktYWltIikgfSwKICAgICAgICAgICAgZmFrZV9wZWVrID0geyB1aV9yZWZlcmVuY2UoIkFBIiwgIk90aGVyIiwgIkZha2UgcGVlayIpIH0KICAgICAgICB9CiAgICB9OwoKICAgIHNvZnR3YXJlLnZpc3VhbHMgPSB7CiAgICAgICAgY29sb3JlZF9tb2RlbHMgPSB7CiAgICAgICAgICAgIGxvY2FsX3BsYXllcl90cmFuc3BhcmVuY3kgPXVpX3JlZmVyZW5jZSgiVmlzdWFscyIsICJDb2xvcmVkIG1vZGVscyIsICJMb2NhbCBwbGF5ZXIgdHJhbnNwYXJlbmN5IikKICAgICAgICB9CiAgICB9OwoKICAgIHNvZnR3YXJlLm1pc2MgPSB7CiAgICAgICAgbWlzY2VsbGFuZW91cyA9IHsKICAgICAgICAgICAgY2xhbl90YWdfc3BhbW1lciA9IHsgdWlfcmVmZXJlbmNlKCJNaXNjIiwgIk1pc2NlbGxhbmVvdXMiLCAiQ2xhbiB0YWcgc3BhbW1lciIpIH0sCiAgICAgICAgICAgIHBpbmdfc3Bpa2UgPSB7IHVpX3JlZmVyZW5jZSgiTWlzYyIsICJNaXNjZWxsYW5lb3VzIiwgIlBpbmcgc3Bpa2UiKSB9CiAgICAgICAgfSwKCiAgICAgICAgc2V0dGluZ3MgPSB7CiAgICAgICAgICAgIG1lbnVfY29sb3IgPSB1aV9yZWZlcmVuY2UoIk1pc2MiLCAiU2V0dGluZ3MiLCAiTWVudSBjb2xvciIpLAogICAgICAgICAgICBkcGlfc2NhbGUgPSB1aV9yZWZlcmVuY2UoIk1pc2MiLCAiU2V0dGluZ3MiLCAiRFBJIHNjYWxlIiksCiAgICAgICAgICAgIHN2X21heHVzcmNtZHByb2Nlc3N0aWNrcyA9IHVpX3JlZmVyZW5jZSgiTWlzYyIsICJTZXR0aW5ncyIsICJzdl9tYXh1c3JjbWRwcm9jZXNzdGlja3MyIikKICAgICAgICB9CiAgICB9OwoKICAgIGZ1bmN0aW9uIHNvZnR3YXJlLmlzX2RvdWJsZV90YXAoKQogICAgICAgIHJldHVybiB1aV9nZXQoc29mdHdhcmUucmFnZS5haW1ib3QuZG91YmxlX3RhcFsxXSkKICAgICAgICAgICAgYW5kIHVpX2dldChzb2Z0d2FyZS5yYWdlLmFpbWJvdC5kb3VibGVfdGFwWzJdKTsKICAgIGVuZAoKICAgIGZ1bmN0aW9uIHNvZnR3YXJlLmlzX21pbmltdW1fZGFtYWdlKCkKICAgICAgICByZXR1cm4gdWlfZ2V0KHNvZnR3YXJlLnJhZ2UuYWltYm90Lm1pbmltdW1fZGFtYWdlX292ZXJyaWRlWzFdKQogICAgICAgICAgICBhbmQgdWlfZ2V0KHNvZnR3YXJlLnJhZ2UuYWltYm90Lm1pbmltdW1fZGFtYWdlX292ZXJyaWRlWzJdKTsKICAgIGVuZAoKICAgIGZ1bmN0aW9uIHNvZnR3YXJlLmlzX3F1aWNrX3BlZWtfYXNzaXN0KCkKICAgICAgICByZXR1cm4gdWlfZ2V0KHNvZnR3YXJlLnJhZ2Uub3RoZXIucXVpY2tfcGVla19hc3Npc3RbMV0pCiAgICAgICAgICAgIGFuZCB1aV9nZXQoc29mdHdhcmUucmFnZS5vdGhlci5xdWlja19wZWVrX2Fzc2lzdFsyXSk7CiAgICBlbmQKCiAgICBmdW5jdGlvbiBzb2Z0d2FyZS5pc19vbl9zaG90X2FudGlhaW0oKQogICAgICAgIHJldHVybiB1aV9nZXQoc29mdHdhcmUuYWEub3RoZXIub25fc2hvdF9hbnRpYWltWzFdKQogICAgICAgICAgICBhbmQgdWlfZ2V0KHNvZnR3YXJlLmFhLm90aGVyLm9uX3Nob3RfYW50aWFpbVsyXSk7CiAgICBlbmQKCiAgICBmdW5jdGlvbiBzb2Z0d2FyZS5pc19zbG93X21vdGlvbigpCiAgICAgICAgcmV0dXJuIHVpX2dldChzb2Z0d2FyZS5hYS5vdGhlci5zbG93X21vdGlvblsxXSkKICAgICAgICAgICAgYW5kIHVpX2dldChzb2Z0d2FyZS5hYS5vdGhlci5zbG93X21vdGlvblsyXSk7CiAgICBlbmQKCiAgICBmdW5jdGlvbiBzb2Z0d2FyZS5nZXRfY29sb3IoKQogICAgICAgIHJldHVybiB1aV9nZXQoc29mdHdhcmUubWlzYy5zZXR0aW5ncy5tZW51X2NvbG9yKTsKICAgIGVuZAoKICAgIGZ1bmN0aW9uIHNvZnR3YXJlLmdldF9kcGlfc2NhbGUoKQogICAgICAgIGxvY2FsIHZhbHVlID0gdWlfZ2V0KHNvZnR3YXJlLm1pc2Muc2V0dGluZ3MuZHBpX3NjYWxlKTsKICAgICAgICBsb2NhbCB1bml0ID0gc3RyaW5nX21hdGNoKHZhbHVlLCAiKCVkKyklJSIpOwoKICAgICAgICByZXR1cm4gdW5pdCAqIDAuMDE7CiAgICBlbmQKZW5kCgotLS0gcmVnaW9uIGRiCmRvCiAgICBsb2NhbCBEQl9LRVkgPSAibWUuc2Vua290ZWNoIjsKCiAgICBsb2NhbCBkYXRhID0gZGF0YWJhc2VfcmVhZChEQl9LRVkpIG9yIHsgfTsKCiAgICBmdW5jdGlvbiBkYi5nZXQoa2V5KQogICAgICAgIHJldHVybiBkYXRhW2tleV07CiAgICBlbmQKCiAgICBmdW5jdGlvbiBkYi5zZXQoa2V5LCB2YWx1ZSkKICAgICAgICBkYXRhW2tleV0gPSB2YWx1ZTsKICAgIGVuZAoKICAgIGZ1bmN0aW9uIGRiLnNhdmUoa2V5KQogICAgICAgIGlmIGtleSB+PSBuaWwgdGhlbgogICAgICAgICAgICBsb2NhbCBvX2RhdGEgPSBkYXRhYmFzZV9yZWFkKERCX0tFWSkgb3IgeyB9OwoKICAgICAgICAgICAgb19kYXRhW2tleV0gPSBkYXRhW2tleV07CiAgICAgICAgICAgIGRhdGFiYXNlX3dyaXRlKERCX0tFWSwgb19kYXRhKTsKCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKCiAgICAgICAgZGF0YWJhc2Vfd3JpdGUoREJfS0VZLCBkYXRhKTsKICAgIGVuZAoKICAgIGZ1bmN0aW9uIGRiLmVyYXNlKCkKICAgICAgICBkYXRhYmFzZV93cml0ZShEQl9LRVksIG5pbCk7CiAgICAgICAgZGF0YSA9IG5pbDsKICAgIGVuZAoKICAgIGZ1bmN0aW9uIGRiLnNodXRkb3duKCkKICAgICAgICBkYi5zYXZlKCk7CiAgICBlbmQKZW5kCgotLS0gbmFtZXNwYWNlIGlpbnB1dApkbwogICAgLS0tIGh0dHBzOi8vZ2l0bGFiLmNvbS9LaXR0ZW5Qb3BvL2NzZ28tMjAxOC1zb3VyY2UvLS9ibG9iL21haW4vZ2FtZS9jbGllbnQvaWlucHV0LmgKCiAgICBsb2NhbCBhZGRyZXNzID0gdXRpbHMuZmluZF9zaWduYXR1cmUodW5wYWNrKGFzc2V0cy5zaWduYXR1cmVzLmlpbnB1dCkpOwogICAgbG9jYWwgaWZhY2UgPSBmZmkuY2FzdCgidWludHB0cl90KioqIiwgYWRkcmVzcylbMF07CgogICAgbG9jYWwgbmF0aXZlX0dldFVzZXJDbWQgPSBmZmkuY2FzdCgiY3VzZXJjbWRfdCooX190aGlzY2FsbCopKHZvaWQqLCBpbnQgblNsb3QsIGludCBzZXF1ZW5jZV9udW1iZXIpIiwgaWZhY2VbMF1bOF0pOwogICAgbG9jYWwgbmF0aXZlX0NBTV9Jc1RoaXJkUGVyc29uID0gZmZpLmNhc3QoImJvb2woX190aGlzY2FsbCopKHZvaWQqLCBpbnQgblNsb3QpIiwgaWZhY2VbMF1bMzJdKTsKCiAgICBmdW5jdGlvbiBpaW5wdXQuZ2V0X3VzZXJjbWQoc2xvdCwgY29tbWFuZF9udW1iZXIpCiAgICAgICAgaWYgY29tbWFuZF9udW1iZXIgPT0gMCB0aGVuCiAgICAgICAgICAgIHJldHVybiBuaWw7CiAgICAgICAgZW5kCgogICAgICAgIHJldHVybiBuYXRpdmVfR2V0VXNlckNtZChpZmFjZSwgc2xvdCwgY29tbWFuZF9udW1iZXIpOwogICAgZW5kCgogICAgZnVuY3Rpb24gaWlucHV0LmlzX3RoaXJkX3BlcnNvbihzbG90KQogICAgICAgIHNsb3QgPSBzbG90IG9yIC0xOwoKICAgICAgICByZXR1cm4gbmF0aXZlX0NBTV9Jc1RoaXJkUGVyc29uKGlmYWNlLCBzbG90KTsKICAgIGVuZAplbmQKCi0tLSByZWdpb24gaXZlbmdpbmVjbGllbnQKZG8KICAgIC0tLSBodHRwczovL2dpdGxhYi5jb20vS2l0dGVuUG9wby9jc2dvLTIwMTgtc291cmNlLy0vYmxvYi9tYWluL3B1YmxpYy9lbmdpbmUvSUVuZ2luZVNvdW5kLmgKCiAgICBsb2NhbCBuYXRpdmVfSXNJbkdhbWUgPSB2dGFibGVfYmluZCgiZW5naW5lLmRsbCIsICJWRW5naW5lQ2xpZW50MDE0IiwgMjAsICJib29sKF9fdGhpc2NhbGwqKSh2b2lkKikiKTsKICAgIGxvY2FsIG5hdGl2ZV9Jc0Nvbm5lY3RlZCA9IHZ0YWJsZV9iaW5kKCJlbmdpbmUuZGxsIiwgIlZFbmdpbmVDbGllbnQwMTQiLCAyMSwgImJvb2woX190aGlzY2FsbCopKHZvaWQqKSIpOwogICAgbG9jYWwgbmF0aXZlX0dldFRpbWVzY2FsZSA9IHZ0YWJsZV9iaW5kKCJlbmdpbmUuZGxsIiwgIlZFbmdpbmVDbGllbnQwMTQiLCA5MSwgImZsb2F0KF9fdGhpc2NhbGwqKSh2b2lkKikiKTsKCiAgICBmdW5jdGlvbiBpZW5naW5lY2xpZW50LmlzX2luX2dhbWUoKQogICAgICAgIHJldHVybiBuYXRpdmVfSXNJbkdhbWUoKTsKICAgIGVuZAoKICAgIGZ1bmN0aW9uIGllbmdpbmVjbGllbnQuaXNfY29ubmVjdGVkKCkKICAgICAgICByZXR1cm4gbmF0aXZlX0lzQ29ubmVjdGVkKCk7CiAgICBlbmQKCiAgICBmdW5jdGlvbiBpZW5naW5lY2xpZW50LmdldF90aW1lc2NhbGUoKQogICAgICAgIHJldHVybiBuYXRpdmVfR2V0VGltZXNjYWxlKCk7CiAgICBlbmQKZW5kCgotLS0gcmVnaW9uIGljbGllbnRzdGF0ZQpkbwogICAgbG9jYWwgZW5naW5lID0gY2xpZW50X2NyZWF0ZV9pbnRlcmZhY2UoImVuZ2luZS5kbGwiLCAiVkVuZ2luZUNsaWVudDAxNCIpOwogICAgbG9jYWwgaWZhY2UgPSBmZmkuY2FzdCgidm9pZCoqKiIsIGVuZ2luZSlbMF07CgogICAgbG9jYWwgYWRkcmVzcyA9IGZmaS5jYXN0KCJ1aW50cHRyX3QiLCBpZmFjZVsxMl0pICsgMHgxMDsKCiAgICBmdW5jdGlvbiBpY2xpZW50c3RhdGUuZ2V0KCkKICAgICAgICByZXR1cm4gZmZpLmNhc3QoImljbGllbnRzdGF0ZV90KioqIiwgYWRkcmVzcylbMF1bMF07CiAgICBlbmQKZW5kCgotLS0gcmVnaW9uIGllbmdpbmVzb3VuZApkbwogICAgLS0tIGh0dHBzOi8vZ2l0bGFiLmNvbS9LaXR0ZW5Qb3BvL2NzZ28tMjAxOC1zb3VyY2UvLS9ibG9iL21haW4vcHVibGljL2VuZ2luZS9JRW5naW5lU291bmQuaAogICAgbG9jYWwgUElUQ0hfTk9STSA9IDEwMDsKCiAgICBsb2NhbCBuYXRpdmVfRW1pdEFtYmllbnRTb3VuZCA9IHZ0YWJsZV9iaW5kKCJlbmdpbmUuZGxsIiwgIklFbmdpbmVTb3VuZENsaWVudDAwMyIsIDEyLCAiaW50KF9fdGhpc2NhbGwqKSh2b2lkKiwgY29uc3QgY2hhciAqcFNhbXBsZSwgZmxvYXQgZmxWb2x1bWUsIGludCBpUGl0Y2gsIGludCBmbGFncywgZmxvYXQgc291bmR0aW1lKSIpOwogICAgbG9jYWwgbmF0aXZlX0lzU291bmRTdGlsbFBsYXlpbmcgPSB2dGFibGVfYmluZCgiZW5naW5lLmRsbCIsICJJRW5naW5lU291bmRDbGllbnQwMDMiLCAxNSwgImJvb2woX190aGlzY2FsbCopKHZvaWQqLCBpbnQgZ3VpZCkiKTsKICAgIGxvY2FsIG5hdGl2ZV9TdG9wU291bmRCeUd1aWQgPSB2dGFibGVfYmluZCgiZW5naW5lLmRsbCIsICJJRW5naW5lU291bmRDbGllbnQwMDMiLCAxNiwgInZvaWQoX190aGlzY2FsbCopKHZvaWQqLCBpbnQgZ3VpZCwgYm9vbCBiRm9yY2VTeW5jKSIpOwoKICAgIGxvY2FsIHBsYXlkYXRhID0geyB9OwoKICAgIGZ1bmN0aW9uIGllbmdpbmVzb3VuZC5lbWl0X2FtYmllbnRfc291bmQoc2FtcGxlLCB2b2x1bWUsIHBpdGNoLCBmbGFncywgc291bmR0aW1lKQogICAgICAgIHBpdGNoID0gcGl0Y2ggb3IgUElUQ0hfTk9STTsKICAgICAgICBmbGFncyA9IGZsYWdzIG9yIDA7CiAgICAgICAgc291bmR0aW1lID0gc291bmR0aW1lIG9yIDAuMDsKCiAgICAgICAgcmV0dXJuIG5hdGl2ZV9FbWl0QW1iaWVudFNvdW5kKHNhbXBsZSwgdm9sdW1lLCBwaXRjaCwgZmxhZ3MsIHNvdW5kdGltZSk7CiAgICBlbmQKCiAgICBmdW5jdGlvbiBpZW5naW5lc291bmQuaXNfc291bmRfc3RpbGxfcGxheWluZyhndWlkKQogICAgICAgIHJldHVybiBuYXRpdmVfSXNTb3VuZFN0aWxsUGxheWluZyhndWlkKTsKICAgIGVuZAoKICAgIGZ1bmN0aW9uIGllbmdpbmVzb3VuZC5zdG9wX3NvdW5kX2J5X2d1aWQoZ3VpZCwgZm9yY2Vfc3luYykKICAgICAgICBmb3JjZV9zeW5jID0gZm9yY2Vfc3luYyBvciBmYWxzZTsKCiAgICAgICAgcmV0dXJuIG5hdGl2ZV9TdG9wU291bmRCeUd1aWQoZ3VpZCwgZm9yY2Vfc3luYyk7CiAgICBlbmQKCiAgICBmdW5jdGlvbiBpZW5naW5lc291bmQucGxheXNvdW5kKHNhbXBsZSwgdm9sdW1lLCBwaXRjaCwgZmxhZ3MsIHNvdW5kdGltZSkKICAgICAgICBsb2NhbCBsYXN0X2d1aWQgPSBwbGF5ZGF0YVtzYW1wbGVdIG9yIDA7CgogICAgICAgIGlmIGllbmdpbmVzb3VuZC5pc19zb3VuZF9zdGlsbF9wbGF5aW5nKGxhc3RfZ3VpZCkgdGhlbgogICAgICAgICAgICBpZW5naW5lc291bmQuc3RvcF9zb3VuZF9ieV9ndWlkKGxhc3RfZ3VpZCk7CiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIGd1aWQgPSBpZW5naW5lc291bmQuZW1pdF9hbWJpZW50X3NvdW5kKHNhbXBsZSwgdm9sdW1lLCBwaXRjaCwgZmxhZ3MsIHNvdW5kdGltZSk7CiAgICAgICAgcGxheWRhdGFbc2FtcGxlXSA9IGd1aWQ7CgogICAgICAgIHJldHVybiBndWlkOwogICAgZW5kCmVuZAoKLS0tIHJlZ2lvbiBpbmV0Y2hhbm5lbApkbwogICAgbG9jYWwgbmF0aXZlX0dldFRpbWUgPSB2dGFibGVfdGh1bmsoMiwgImZsb2F0KF9fdGhpc2NhbGwqKSh2b2lkKikiKTsKICAgIGxvY2FsIG5hdGl2ZV9Jc0xvb3BCYWNrID0gdnRhYmxlX3RodW5rKDYsICJib29sKF9fdGhpc2NhbGwqKSh2b2lkKikiKTsKICAgIGxvY2FsIG5hdGl2ZV9HZXRMYXRlbmN5ID0gdnRhYmxlX3RodW5rKDksICJmbG9hdChfX3RoaXNjYWxsKikodm9pZCosIGludCBmbG93KSIpOwogICAgbG9jYWwgbmF0aXZlX0dldEF2Z0xhdGVuY3kgPSB2dGFibGVfdGh1bmsoMTAsICJmbG9hdChfX3RoaXNjYWxsKikodm9pZCosIGludCBmbG93KSIpOwogICAgbG9jYWwgbmF0aXZlX0dldEF2Z1BhY2tldHMgPSB2dGFibGVfdGh1bmsoMTQsICJmbG9hdChfX3RoaXNjYWxsKikodm9pZCosIGludCBmbG93KSIpOwoKICAgIGxvY2FsIGNsaWVudHN0YXRlID0gaWNsaWVudHN0YXRlLmdldCgpOwoKICAgIGZ1bmN0aW9uIGluZXRjaGFubmVsLmdldCgpCiAgICAgICAgcmV0dXJuIGNsaWVudHN0YXRlLnBOZXRDaGFubmVsOwogICAgZW5kCgogICAgZnVuY3Rpb24gaW5ldGNoYW5uZWwuZ2V0X3RpbWUobmV0Y2hhbm5lbCkKICAgICAgICByZXR1cm4gbmF0aXZlX0dldFRpbWUobmV0Y2hhbm5lbCk7CiAgICBlbmQKCiAgICBmdW5jdGlvbiBpbmV0Y2hhbm5lbC5pc19sb29wYmFjayhuZXRjaGFubmVsKQogICAgICAgIHJldHVybiBuYXRpdmVfSXNMb29wQmFjayhuZXRjaGFubmVsKTsKICAgIGVuZAoKICAgIGZ1bmN0aW9uIGluZXRjaGFubmVsLmdldF9sYXRlbmN5KG5ldGNoYW5uZWwsIGZsb3cpCiAgICAgICAgcmV0dXJuIG5hdGl2ZV9HZXRMYXRlbmN5KG5ldGNoYW5uZWwsIGZsb3cpOwogICAgZW5kCgogICAgZnVuY3Rpb24gaW5ldGNoYW5uZWwuZ2V0X2F2Z19sYXRlbmN5KG5ldGNoYW5uZWwsIGZsb3cpCiAgICAgICAgcmV0dXJuIG5hdGl2ZV9HZXRBdmdMYXRlbmN5KG5ldGNoYW5uZWwsIGZsb3cpOwogICAgZW5kCgogICAgZnVuY3Rpb24gaW5ldGNoYW5uZWwuZ2V0X2F2Z19wYWNrZXRzKG5ldGNoYW5uZWwsIGZsb3cpCiAgICAgICAgcmV0dXJuIG5hdGl2ZV9HZXRBdmdQYWNrZXRzKG5ldGNoYW5uZWwsIGZsb3cpOwogICAgZW5kCmVuZAoKLS0tIHJlZ2lvbiBtb3Rpb24KZG8KICAgIGxvY2FsIGZ1bmN0aW9uIGxpbmVhcih0LCBiLCBjLCBkKQogICAgICAgIHJldHVybiBjICogdCAvIGQgKyBiOwogICAgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gZ2V0X2RlbHRhdGltZSgpCiAgICAgICAgcmV0dXJuIGdsb2JhbHNfZnJhbWV0aW1lKCkgLyBpZW5naW5lY2xpZW50LmdldF90aW1lc2NhbGUoKTsKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIHNvbHZlKGVhc2luZ19mbiwgcHJldiwgbmV3LCBjbG9jaywgZHVyYXRpb24pCiAgICAgICAgaWYgY2xvY2sgPD0gMCB0aGVuIHJldHVybiBuZXcgZW5kCiAgICAgICAgaWYgY2xvY2sgPj0gZHVyYXRpb24gdGhlbiByZXR1cm4gbmV3IGVuZAoKICAgICAgICBwcmV2ID0gZWFzaW5nX2ZuKGNsb2NrLCBwcmV2LCBuZXcgLSBwcmV2LCBkdXJhdGlvbik7CgogICAgICAgIGlmIHR5cGUocHJldikgPT0gIm51bWJlciIgdGhlbgogICAgICAgICAgICBpZiBhYnNmKG5ldyAtIHByZXYpIDwgMC4wMDEgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIG5ldzsKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCByZW1haW5kZXIgPSBmbW9kZihwcmV2LCAxLjApOwoKICAgICAgICAgICAgaWYgcmVtYWluZGVyIDwgMC4wMDEgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIGZsb29yKHByZXYpOwogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIHJlbWFpbmRlciA+IDAuOTk5IHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBjZWlsKHByZXYpOwogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgcmV0dXJuIHByZXY7CiAgICBlbmQKCiAgICBmdW5jdGlvbiBtb3Rpb24uaW50ZXJwKGEsIGIsIHQsIGVhc2luZ19mbikKICAgICAgICBlYXNpbmdfZm4gPSBlYXNpbmdfZm4gb3IgbGluZWFyOwoKICAgICAgICBpZiB0eXBlKGIpID09ICJib29sZWFuIiB0aGVuCiAgICAgICAgICAgIGIgPSBiIGFuZCAxIG9yIDA7CiAgICAgICAgZW5kCgogICAgICAgIHJldHVybiBzb2x2ZShlYXNpbmdfZm4sIGEsIGIsIGdldF9kZWx0YXRpbWUoKSwgdCk7CiAgICBlbmQKZW5kCgotLS0gcmVnaW9uIGRlY29yYXRpb25zCmRvCiAgICBsb2NhbCB0b2hleCA9IHV0aWxzLnRvX2hleDsKICAgIGxvY2FsIEhBTEZfUEkgPSBtYXRoLnBpIC8gMjsKCiAgICBMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICAgICAgZnVuY3Rpb24gZGVjb3JhdGlvbnMud2F2ZShzLCBjbG9jaywgcjEsIGcxLCBiMSwgYTEsIHIyLCBnMiwgYjIsIGEyKQogICAgICAgICAgICBsb2NhbCBidWZmZXIgPSB7IH07CgogICAgICAgICAgICBsb2NhbCBsZW4gPSBzdHJsZW4odTgocykpOwogICAgICAgICAgICBsb2NhbCBkaXYgPSAxIC8gKGxlbiAtIDEpOwoKICAgICAgICAgICAgbG9jYWwgYWRkX3IgPSByMiAtIHIxOwogICAgICAgICAgICBsb2NhbCBhZGRfZyA9IGcyIC0gZzE7CiAgICAgICAgICAgIGxvY2FsIGFkZF9iID0gYjIgLSBiMTsKICAgICAgICAgICAgbG9jYWwgYWRkX2EgPSBhMiAtIGExOwoKICAgICAgICAgICAgZm9yIGNoYXIgaW4gc3RyaW5nX2dtYXRjaChzLCAiLltcMTI4LVwxOTFdKiIpIGRvCiAgICAgICAgICAgICAgICBsb2NhbCB0ID0gY2xvY2s7IGRvCiAgICAgICAgICAgICAgICAgICAgdCA9IHQgJSAyOwoKICAgICAgICAgICAgICAgICAgICBpZiB0ID4gMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHQgPSAyIC0gdDsKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGxvY2FsIHIgPSByMSArIGFkZF9yICogdDsKICAgICAgICAgICAgICAgIGxvY2FsIGcgPSBnMSArIGFkZF9nICogdDsKICAgICAgICAgICAgICAgIGxvY2FsIGIgPSBiMSArIGFkZF9iICogdDsKICAgICAgICAgICAgICAgIGxvY2FsIGEgPSBhMSArIGFkZF9hICogdDsKCiAgICAgICAgICAgICAgICBidWZmZXJbI2J1ZmZlciArIDFdID0gIlxhIjsKICAgICAgICAgICAgICAgIGJ1ZmZlclsjYnVmZmVyICsgMV0gPSB0b2hleChyLCBnLCBiLCBhKTsKICAgICAgICAgICAgICAgIGJ1ZmZlclsjYnVmZmVyICsgMV0gPSBjaGFyOwoKICAgICAgICAgICAgICAgIGNsb2NrID0gY2xvY2sgKyBkaXY7CiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuIG1lcmdlKGJ1ZmZlcik7CiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIGRlY29yYXRpb25zLmZhZGUocywgcGN0LCByMSwgZzEsIGIxLCBhMSwgcjIsIGcyLCBiMiwgYTIpCiAgICAgICAgICAgIGxvY2FsIGJ1ZmZlciA9IHsgfTsKCiAgICAgICAgICAgIGxvY2FsIGxlbiA9IHN0cmxlbih1OChzKSk7CiAgICAgICAgICAgIGxvY2FsIGRpdiA9IDEgLyAobGVuIC0gMSk7CgogICAgICAgICAgICBsb2NhbCBhZGRfciA9IHIyIC0gcjE7CiAgICAgICAgICAgIGxvY2FsIGFkZF9nID0gZzIgLSBnMTsKICAgICAgICAgICAgbG9jYWwgYWRkX2IgPSBiMiAtIGIxOwogICAgICAgICAgICBsb2NhbCBhZGRfYSA9IGEyIC0gYTE7CgogICAgICAgICAgICBsb2NhbCBjbG9jayA9IDA7CiAgICAgICAgICAgIGxvY2FsIHRyYW5zZm9ybSA9IHNpbmY7CgogICAgICAgICAgICBpZiBwY3QgPCAwIHRoZW4KICAgICAgICAgICAgICAgIHRyYW5zZm9ybSA9IGNvc2Y7CiAgICAgICAgICAgICAgICBwY3QgPSBwY3QgKyAxOwogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIHBjdCA9PSAwIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBtZXJnZSB7ICJcYSIsIHV0aWxzLnRvX2hleChyMiwgZzIsIGIyLCBhMiksIHMgfTsKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBwY3QgPT0gMSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gbWVyZ2UgeyAiXGEiLCB1dGlscy50b19oZXgocjEsIGcxLCBiMSwgYTEpLCBzIH07CiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgZm9yIGNoYXIgaW4gc3RyaW5nX2dtYXRjaChzLCAiLltcMTI4LVwxOTFdKiIpIGRvCiAgICAgICAgICAgICAgICBsb2NhbCB0ID0gdHJhbnNmb3JtKEhBTEZfUEkgKiAoMSAtIGNsb2NrICogcGN0KSAqICgxIC0gcGN0ICogcGN0KSk7CgogICAgICAgICAgICAgICAgbG9jYWwgciA9IHIxICsgYWRkX3IgKiB0OwogICAgICAgICAgICAgICAgbG9jYWwgZyA9IGcxICsgYWRkX2cgKiB0OwogICAgICAgICAgICAgICAgbG9jYWwgYiA9IGIxICsgYWRkX2IgKiB0OwogICAgICAgICAgICAgICAgbG9jYWwgYSA9IGExICsgYWRkX2EgKiB0OwoKICAgICAgICAgICAgICAgIGJ1ZmZlclsjYnVmZmVyICsgMV0gPSAiXGEiOwogICAgICAgICAgICAgICAgYnVmZmVyWyNidWZmZXIgKyAxXSA9IHRvaGV4KHIsIGcsIGIsIGEpOwogICAgICAgICAgICAgICAgYnVmZmVyWyNidWZmZXIgKyAxXSA9IGNoYXI7CgogICAgICAgICAgICAgICAgY2xvY2sgPSBjbG9jayArIGRpdjsKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICByZXR1cm4gbWVyZ2UoYnVmZmVyKTsKICAgICAgICBlbmQKICAgIGVuZCkoKTsKZW5kCgotLS0gcmVnaW9uIGxlZ19tb3ZlbWVudApkbwogICAgbG9jYWwgSU5fRk9SV0FSRCAgID0gYml0X2xzaGlmdCgxLCAzKTsKICAgIGxvY2FsIElOX0JBQ0sgICAgICA9IGJpdF9sc2hpZnQoMSwgNCk7CiAgICBsb2NhbCBJTl9NT1ZFTEVGVCAgPSBiaXRfbHNoaWZ0KDEsIDkpOwogICAgbG9jYWwgSU5fTU9WRVJJR0hUID0gYml0X2xzaGlmdCgxLCAxMCk7CgogICAgZnVuY3Rpb24gbGVnX21vdmVtZW50LmFsd2F5c19zbGlkZShjbWQpCiAgICAgICAgY21kLmJ1dHRvbnMgPSBiaXRfYm9yKGNtZC5idXR0b25zLCBjbWQuZm9yd2FyZG1vdmUgPiAwIGFuZCBJTl9CQUNLIG9yIElOX0ZPUldBUkQpOwogICAgICAgIGNtZC5idXR0b25zID0gYml0X2JvcihjbWQuYnV0dG9ucywgY21kLnNpZGVtb3ZlID4gMCBhbmQgSU5fTU9WRVJJR0hUIG9yIElOX01PVkVMRUZUKTsKICAgICAgICBjbWQuYnV0dG9ucyA9IGJpdF9iYW5kKGNtZC5idXR0b25zLCBiaXRfYm5vdChjbWQuZm9yd2FyZG1vdmUgPiAwIGFuZCBJTl9GT1JXQVJEIG9yIElOX0JBQ0spKTsKICAgICAgICBjbWQuYnV0dG9ucyA9IGJpdF9iYW5kKGNtZC5idXR0b25zLCBiaXRfYm5vdChjbWQuc2lkZW1vdmUgPiAwIGFuZCBJTl9NT1ZFTEVGVCBvciBJTl9NT1ZFUklHSFQpKTsKICAgIGVuZAoKICAgIGZ1bmN0aW9uIGxlZ19tb3ZlbWVudC5uZXZlcl9zbGlkZShjbWQpCiAgICAgICAgY21kLmJ1dHRvbnMgPSBiaXRfYmFuZChjbWQuYnV0dG9ucywgYml0X2Jub3QoSU5fRk9SV0FSRCkpOwogICAgICAgIGNtZC5idXR0b25zID0gYml0X2JhbmQoY21kLmJ1dHRvbnMsIGJpdF9ibm90KElOX0JBQ0spKTsKICAgICAgICBjbWQuYnV0dG9ucyA9IGJpdF9iYW5kKGNtZC5idXR0b25zLCBiaXRfYm5vdChJTl9NT1ZFTEVGVCkpOwogICAgICAgIGNtZC5idXR0b25zID0gYml0X2JhbmQoY21kLmJ1dHRvbnMsIGJpdF9ibm90KElOX01PVkVSSUdIVCkpOwogICAgZW5kCmVuZAoKLS0tIHJlZ2lvbiBleHBsb2l0CmRvCiAgICBsb2NhbCBMQUdfQ09NUEVOU0FUSU9OX1RFTEVQT1JURURfRElTVEFOQ0VfU1FSID0gNjQgKiA2NDsKCiAgICBsb2NhbCBkYXRhID0gewogICAgICAgIG9sZF9vcmlnaW4gPSB2ZWN0b3IoKSwKICAgICAgICBvbGRfc2ltdGltZSA9IDAuMCwKCiAgICAgICAgc2hpZnQgPSBmYWxzZSwKICAgICAgICBicmVha2luZ19sYyA9IGZhbHNlLAoKICAgICAgICBkZWZlbnNpdmUgPSB7CiAgICAgICAgICAgIGJlZ2luID0gMCwKICAgICAgICAgICAgZHVyYXRpb24gPSAwCiAgICAgICAgfSwKCiAgICAgICAgbGFnY29tcGVuc2F0aW9uID0gewogICAgICAgICAgICBkaXN0YW5jZSA9IDAuMCwKICAgICAgICAgICAgdGVsZXBvcnQgPSBmYWxzZQogICAgICAgIH0KICAgIH07CgogICAgbG9jYWwgZnVuY3Rpb24gdXBkYXRlX3RpY2tiYXNlKG1lKQogICAgICAgIGxvY2FsIG5ldCA9IGluZXRjaGFubmVsLmdldCgpOwogICAgICAgIGlmIG5ldCA9PSBuaWwgdGhlbiByZXR1cm4gZW5kCgogICAgICAgIGxvY2FsIHRpY2tjb3VudCA9IGdsb2JhbHMuc2VydmVydGlja2NvdW50KCk7CiAgICAgICAgbG9jYWwgbV9uVGlja0Jhc2UgPSBlbnRpdHlfZ2V0X3Byb3AobWUsICJtX25UaWNrQmFzZSIpOwoKICAgICAgICBsb2NhbCBpbmdvaW5nID0gaW5ldGNoYW5uZWwuZ2V0X2F2Z19sYXRlbmN5KG5ldCwgMCk7CiAgICAgICAgdGlja2NvdW50ID0gdGlja2NvdW50ICsgdG90aWNrcyhpbmdvaW5nICogMC42Nyk7CgogICAgICAgIGRhdGEuc2hpZnQgPSB0aWNrY291bnQgPiBtX25UaWNrQmFzZTsKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIHVwZGF0ZV9kZWZlbnNpdmUodGljaykKICAgICAgICBkYXRhLmJyZWFraW5nX2xjID0gdHJ1ZTsKCiAgICAgICAgZGF0YS5kZWZlbnNpdmUuYmVnaW4gPSBnbG9iYWxzX3RpY2tjb3VudCgpOwogICAgICAgIGRhdGEuZGVmZW5zaXZlLmR1cmF0aW9uID0gdGljazsKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIHVwZGF0ZV90ZWxlcG9ydChvbGRfb3JpZ2luLCBuZXdfb3JpZ2luKQogICAgICAgIGxvY2FsIGRlbHRhID0gbmV3X29yaWdpbiAtIG9sZF9vcmlnaW47CiAgICAgICAgbG9jYWwgZGlzdGFuY2UgPSBkZWx0YTpsZW5ndGhzcXIoKTsKCiAgICAgICAgbG9jYWwgaXNfdGVsZXBvcnQgPSBkaXN0YW5jZSA+IExBR19DT01QRU5TQVRJT05fVEVMRVBPUlRFRF9ESVNUQU5DRV9TUVI7CgogICAgICAgIGRhdGEuYnJlYWtpbmdfbGMgPSBpc190ZWxlcG9ydDsKCiAgICAgICAgZGF0YS5sYWdjb21wZW5zYXRpb24uZGlzdGFuY2UgPSBkaXN0YW5jZTsKICAgICAgICBkYXRhLmxhZ2NvbXBlbnNhdGlvbi50ZWxlcG9ydCA9IGlzX3RlbGVwb3J0OwogICAgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gdXBkYXRlX2xhZ2NvbXBlbnNhdGlvbihtZSkKICAgICAgICBsb2NhbCBvbGRfb3JpZ2luID0gZGF0YS5vbGRfb3JpZ2luOwogICAgICAgIGxvY2FsIG9sZF9zaW10aW1lID0gZGF0YS5vbGRfc2ltdGltZTsKCiAgICAgICAgbG9jYWwgb3JpZ2luID0gdmVjdG9yKGVudGl0eV9nZXRfb3JpZ2luKG1lKSk7CiAgICAgICAgbG9jYWwgc2ltdGltZSA9IHRvdGlja3MoZW50aXR5X2dldF9wcm9wKG1lLCAibV9mbFNpbXVsYXRpb25UaW1lIikpOwoKICAgICAgICBpZiBvbGRfc2ltdGltZSB+PSBuaWwgdGhlbgogICAgICAgICAgICBsb2NhbCBkZWx0YSA9IHNpbXRpbWUgLSBvbGRfc2ltdGltZTsKCiAgICAgICAgICAgIGlmIGRlbHRhIDwgMCBvciBkZWx0YSA+IDAgYW5kIGRlbHRhIDw9IDY0IHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIHRpY2sgPSBkZWx0YSAtIDE7CgogICAgICAgICAgICAgICAgdXBkYXRlX3RlbGVwb3J0KG9sZF9vcmlnaW4sIG9yaWdpbik7CgogICAgICAgICAgICAgICAgaWYgZGVsdGEgPCAwIHRoZW4KICAgICAgICAgICAgICAgICAgICB1cGRhdGVfZGVmZW5zaXZlKGFic2YodGljaykpOwogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBkYXRhLm9sZF9vcmlnaW4gPSBvcmlnaW47CiAgICAgICAgZGF0YS5vbGRfc2ltdGltZSA9IHNpbXRpbWU7CiAgICBlbmQKCiAgICBmdW5jdGlvbiBleHBsb2l0LmdldCgpCiAgICAgICAgcmV0dXJuIGRhdGE7CiAgICBlbmQKCiAgICBmdW5jdGlvbiBleHBsb2l0LnNldHVwX2NvbW1hbmQoKQogICAgICAgIGxvY2FsIG1lID0gZW50aXR5X2dldF9sb2NhbF9wbGF5ZXIoKTsKCiAgICAgICAgdXBkYXRlX3RpY2tiYXNlKG1lKTsKICAgIGVuZAoKICAgIGZ1bmN0aW9uIGV4cGxvaXQubmV0X3VwZGF0ZSgpCiAgICAgICAgbG9jYWwgbWUgPSBlbnRpdHlfZ2V0X2xvY2FsX3BsYXllcigpOwoKICAgICAgICBpZiBtZSA9PSBuaWwgdGhlbgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgZW5kCgogICAgICAgIHVwZGF0ZV9sYWdjb21wZW5zYXRpb24obWUpOwogICAgZW5kCgogICAgZnVuY3Rpb24gZXhwbG9pdC5mcmFtZSgpCiAgICAgICAgaWYgbm90IGxvY2FscGxheWVyLmlzX2FpcmJvcm5lIHRoZW4KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCByLCBnLCBiLCBhID0gMjU1LCAwLCA1MCwgMjU1OwoKICAgICAgICBpZiBkYXRhLmJyZWFraW5nX2xjIHRoZW4KICAgICAgICAgICAgciwgZywgYiwgYSA9IDI1NSwgMjU1LCAyNTUsIDIwMDsKICAgICAgICBlbmQKCiAgICAgICAgcmVuZGVyZXJfaW5kaWNhdG9yKHIsIGcsIGIsIGEsICJMQyIpOwogICAgZW5kCmVuZAoKLS0tIHJlZ2lvbiBsb2NhbHBsYXllcgpkbwogICAgbG9jYWwgTU9WSU5HX0xJTUlUID0gMS4xICogMy4zOwogICAgbG9jYWwgRFVDS19QRUVLX0xJTUlUID0gMC40NTsKCiAgICBsb2NhbCBwcmVfZmxhZ3MgPSAwOwogICAgbG9jYWwgcG9zdF9mbGFncyA9IDA7CgogICAgbG9jYWwgZnVuY3Rpb24gZ2V0X2JvZHlfeWF3KGFuaW1zdGF0ZSkKICAgICAgICBsb2NhbCBib2R5X3lhdyA9IGFuaW1zdGF0ZS5leWVfYW5nbGVzX3kgLSBhbmltc3RhdGUuZ29hbF9mZWV0X3lhdzsKICAgICAgICBib2R5X3lhdyA9IHV0aWxzLm5vcm1hbGl6ZV95YXcoYm9keV95YXcpOwoKICAgICAgICByZXR1cm4gYm9keV95YXc7CiAgICBlbmQKCiAgICBsb2NhbHBsYXllci5mbGFncyA9IDA7CiAgICBsb2NhbHBsYXllci5wYWNrZXRzID0gMDsKCiAgICBsb2NhbHBsYXllci5ib2R5X3lhdyA9IDA7CiAgICBsb2NhbHBsYXllci5kdWNrX2Ftb3VudCA9IDA7CgogICAgbG9jYWxwbGF5ZXIubW92ZXR5cGUgPSAwOwogICAgbG9jYWxwbGF5ZXIudmVsb2NpdHkgPSAwOwoKICAgIGxvY2FscGxheWVyLmlzX2Zyb3plbiA9IGZhbHNlOwogICAgbG9jYWxwbGF5ZXIuaXNfb25ncm91bmQgPSBmYWxzZTsKICAgIGxvY2FscGxheWVyLmlzX2Nyb3VjaGVkID0gZmFsc2U7CgogICAgbG9jYWxwbGF5ZXIuaXNfbW92aW5nID0gZmFsc2U7CiAgICBsb2NhbHBsYXllci5pc19sYW5kaW5nID0gZmFsc2U7CiAgICBsb2NhbHBsYXllci5pc19haXJib3JuZSA9IGZhbHNlOwoKICAgIGZ1bmN0aW9uIGxvY2FscGxheWVyLnByZV9wcmVkaWN0X2NvbW1hbmQoZSkKICAgICAgICBsb2NhbCBtZSA9IGVudGl0eV9nZXRfbG9jYWxfcGxheWVyKCk7CiAgICAgICAgcHJlX2ZsYWdzID0gZW50aXR5X2dldF9wcm9wKG1lLCAibV9mRmxhZ3MiKTsKICAgIGVuZAoKICAgIGZ1bmN0aW9uIGxvY2FscGxheWVyLnByZWRpY3RfY29tbWFuZChlKQogICAgICAgIGxvY2FsIG1lID0gZW50aXR5X2dldF9sb2NhbF9wbGF5ZXIoKTsKICAgICAgICBwb3N0X2ZsYWdzID0gZW50aXR5X2dldF9wcm9wKG1lLCAibV9mRmxhZ3MiKTsKICAgIGVuZAoKICAgIGZ1bmN0aW9uIGxvY2FscGxheWVyLm5ldF91cGRhdGUoKQogICAgICAgIGxvY2FsIG1lID0gZW50aXR5X2dldF9sb2NhbF9wbGF5ZXIoKTsKICAgICAgICBpZiBtZSA9PSBuaWwgdGhlbiByZXR1cm4gZW5kCgogICAgICAgIGxvY2FsIG15X2RhdGEgPSBjX2VudGl0eShtZSk7CiAgICAgICAgaWYgbXlfZGF0YSA9PSBuaWwgdGhlbiByZXR1cm4gZW5kCgogICAgICAgIGxvY2FsIGFuaW1zdGF0ZSA9IGNfZW50aXR5LmdldF9hbmltX3N0YXRlKG15X2RhdGEpOwogICAgICAgIGlmIGFuaW1zdGF0ZSA9PSBuaWwgdGhlbiByZXR1cm4gZW5kCgogICAgICAgIGxvY2FsIGNob2tlZGNvbW1hbmRzID0gZ2xvYmFsc19jaG9rZWRjb21tYW5kcygpOwoKICAgICAgICBsb2NhbCBtX2ZGbGFncyA9IGVudGl0eV9nZXRfcHJvcChtZSwgIm1fZkZsYWdzIik7CiAgICAgICAgbG9jYWwgbV9tb3ZldHlwZSA9IGVudGl0eV9nZXRfcHJvcChtZSwgIm1fbW92ZXR5cGUiKTsKICAgICAgICBsb2NhbCBtX2ZsRHVja0Ftb3VudCA9IGVudGl0eV9nZXRfcHJvcChtZSwgIm1fZmxEdWNrQW1vdW50Iik7CgogICAgICAgIGxvY2FscGxheWVyLmZsYWdzID0gbV9mRmxhZ3M7CiAgICAgICAgbG9jYWxwbGF5ZXIubW92ZXR5cGUgPSBtX21vdmV0eXBlOwogICAgICAgIGxvY2FscGxheWVyLnZlbG9jaXR5ID0gYW5pbXN0YXRlLm1fdmVsb2NpdHk7CgogICAgICAgIGlmIGNob2tlZGNvbW1hbmRzID09IDAgdGhlbgogICAgICAgICAgICBsb2NhbHBsYXllci5wYWNrZXRzID0gbG9jYWxwbGF5ZXIucGFja2V0cyArIDE7CgogICAgICAgICAgICBsb2NhbHBsYXllci5ib2R5X3lhdyA9IGdldF9ib2R5X3lhdyhhbmltc3RhdGUpOwogICAgICAgICAgICBsb2NhbHBsYXllci5kdWNrX2Ftb3VudCA9IG1fZmxEdWNrQW1vdW50OwogICAgICAgIGVuZAoKICAgICAgICBsb2NhbHBsYXllci5pc19mcm96ZW4gPSBiaXRfYmFuZChtX2ZGbGFncywgUExBWUVSX0ZMQUdTLkZMX0ZST1pFTikgfj0gMDsKICAgICAgICBsb2NhbHBsYXllci5pc19vbmdyb3VuZCA9IGFuaW1zdGF0ZS5vbl9ncm91bmQ7CiAgICAgICAgbG9jYWxwbGF5ZXIuaXNfY3JvdWNoZWQgPSBsb2NhbHBsYXllci5kdWNrX2Ftb3VudCA+IERVQ0tfUEVFS19MSU1JVDsKCiAgICAgICAgbG9jYWxwbGF5ZXIuaXNfbW92aW5nID0gbG9jYWxwbGF5ZXIudmVsb2NpdHkgPiBNT1ZJTkdfTElNSVQ7CiAgICAgICAgbG9jYWxwbGF5ZXIuaXNfbGFuZGluZyA9IGFuaW1zdGF0ZS5oaXRfaW5fZ3JvdW5kX2FuaW1hdGlvbjsKICAgICAgICBsb2NhbHBsYXllci5pc19haXJib3JuZSA9IGJpdF9iYW5kKHByZV9mbGFncywgcG9zdF9mbGFncywgUExBWUVSX0ZMQUdTLkZMX09OR1JPVU5EKSA9PSAwOwogICAgZW5kCmVuZAoKLS0tIHJlZ2lvbiBzdGF0ZW1lbnQKZG8KICAgIGxvY2FsIGxpc3QgPSB7IH07CgogICAgbG9jYWwgZnVuY3Rpb24gYWRkKHN0YXRlKQogICAgICAgIGxpc3RbI2xpc3QgKyAxXSA9IHN0YXRlOwogICAgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gdXBkYXRlX29uZ3JvdW5kKCkKICAgICAgICBpZiBsb2NhbHBsYXllci5pc19tb3ZpbmcgdGhlbgogICAgICAgICAgICBhZGQgIk1vdmluZyI7CgogICAgICAgICAgICBpZiBsb2NhbHBsYXllci5pc19jcm91Y2hlZCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgbG9jYWxwbGF5ZXIuaXNfYWlyYm9ybmUgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIHNvZnR3YXJlLmlzX3Nsb3dfbW90aW9uKCkgdGhlbgogICAgICAgICAgICAgICAgYWRkICJTbG93LW1vdGlvbiI7CiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICBhZGQgIlN0YW5kaW5nIjsKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIHVwZGF0ZV9jcm91Y2hlZCgpCiAgICAgICAgaWYgbm90IGxvY2FscGxheWVyLmlzX2Nyb3VjaGVkIHRoZW4KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICBhZGQgIkNyb3VjaGVkIjsKCiAgICAgICAgaWYgbG9jYWxwbGF5ZXIuaXNfbW92aW5nIHRoZW4KICAgICAgICAgICAgYWRkICJNb3ZlLWNyb3VjaGVkIjsKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIHVwZGF0ZV9haXJib3JuZSgpCiAgICAgICAgaWYgbm90IGxvY2FscGxheWVyLmlzX2FpcmJvcm5lIHRoZW4KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICBhZGQgIkFpcmJvcm5lIjsKCiAgICAgICAgaWYgbG9jYWxwbGF5ZXIuaXNfY3JvdWNoZWQgdGhlbgogICAgICAgICAgICBhZGQgIkFpcmJvcm5lLWNyb3VjaGVkIjsKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIHVwZGF0ZV9leHBsb2l0KCkKICAgICAgICBpZiBleHBsb2l0LmdldCgpLnNoaWZ0IHRoZW4KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICBhZGQgIkZha2UgTGFnIjsKICAgIGVuZAoKICAgIGZ1bmN0aW9uIHN0YXRlbWVudC5nZXQoKQogICAgICAgIHJldHVybiBsaXN0OwogICAgZW5kCgogICAgZnVuY3Rpb24gc3RhdGVtZW50LmFkZChzdGF0ZSkKICAgICAgICBhZGQoc3RhdGUpOwogICAgZW5kCgogICAgZnVuY3Rpb24gc3RhdGVtZW50LnNldHVwX2NvbW1hbmQoKQogICAgICAgIGNsZWFyKGxpc3QpOwoKICAgICAgICB1cGRhdGVfb25ncm91bmQoKTsKICAgICAgICB1cGRhdGVfY3JvdWNoZWQoKTsKICAgICAgICB1cGRhdGVfYWlyYm9ybmUoKTsKICAgICAgICB1cGRhdGVfZXhwbG9pdCgpOwogICAgZW5kCmVuZAoKLS0tIHJlZ2lvbiBtZW51CmRvCiAgICBsb2NhbCBpdGVtcyA9IHsgfTsKICAgIGxvY2FsIHJlY29yZHMgPSB7IH07CgogICAgbG9jYWwgY2FsbGJhY2tzID0geyB9OwoKICAgIGxvY2FsIGZ1bmN0aW9uIGdldF92YWx1ZShyZWYpCiAgICAgICAgbG9jYWwgdmFsdWUgPSB7IHBjYWxsKHVpX2dldCwgcmVmKSB9OwogICAgICAgIGlmIG5vdCB2YWx1ZVsxXSB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgcmV0dXJuIHVucGFjayh2YWx1ZSwgMik7CiAgICBlbmQKCiAgICBsb2NhbCBmdW5jdGlvbiBnZXRfa2V5cyh2YWx1ZSkKICAgICAgICBpZiB0eXBlKHZhbHVlWzFdKSA9PSAidGFibGUiIHRoZW4KICAgICAgICAgICAgcmV0dXJuIHRhYmxlX2tleXModmFsdWVbMV0pOwogICAgICAgIGVuZAoKICAgICAgICByZXR1cm4geyB9OwogICAgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gdXBkYXRlX2l0ZW1zKCkKICAgICAgICBmb3IgaSA9IDEsICNjYWxsYmFja3MgZG8KICAgICAgICAgICAgY2FsbGJhY2tzW2ldKCk7CiAgICAgICAgZW5kCgogICAgICAgIGZvciBpID0gMSwgI2l0ZW1zIGRvCiAgICAgICAgICAgIGxvY2FsIGl0ZW0gPSBpdGVtc1tpXTsKCiAgICAgICAgICAgIHVpX3NldF92aXNpYmxlKGl0ZW0ucmVmLCBpdGVtLmlzX3Zpc2libGUpOwogICAgICAgICAgICBpdGVtLmlzX3Zpc2libGUgPSBmYWxzZTsKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGxvY2FsIGNfaXRlbSA9IHsgfTsgZG8KICAgICAgICBmdW5jdGlvbiBjX2l0ZW06bmV3KCkKICAgICAgICAgICAgcmV0dXJuIHNldG1ldGF0YWJsZSh7IH0sIHNlbGYpOwogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBjX2l0ZW06aW5pdCgpCiAgICAgICAgICAgIGxvY2FsIGZ1bmN0aW9uIGNhbGxiYWNrKHJlZikKICAgICAgICAgICAgICAgIHNlbGY6dXBkYXRlX3ZhbHVlKHJlZik7CiAgICAgICAgICAgICAgICBzZWxmOmludm9rZV9jYWxsYmFjayhyZWYpOwoKICAgICAgICAgICAgICAgIHVwZGF0ZV9pdGVtcygpOwogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHVpX3NldF9jYWxsYmFjayhzZWxmLnJlZiwgY2FsbGJhY2spOwogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBjX2l0ZW06Z2V0KCkKICAgICAgICAgICAgcmV0dXJuIHVucGFjayhzZWxmLnZhbHVlKTsKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gY19pdGVtOnNldCguLi4pCiAgICAgICAgICAgIGxvY2FsIHJlZiA9IHNlbGYucmVmOwoKICAgICAgICAgICAgdWlfc2V0KHJlZiwgLi4uKTsKICAgICAgICAgICAgc2VsZjp1cGRhdGVfdmFsdWUocmVmKTsKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gY19pdGVtOmhhdmVfa2V5KGtleSkKICAgICAgICAgICAgcmV0dXJuIHNlbGYua2V5c1trZXldIH49IG5pbDsKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gY19pdGVtOnJhd2dldCgpCiAgICAgICAgICAgIHJldHVybiB1aV9nZXQoc2VsZi5yZWYpOwogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBjX2l0ZW06cmVzZXQoKQogICAgICAgICAgICBwY2FsbCh1aV9zZXQsIHNlbGYucmVmLCB1bnBhY2soc2VsZi5kZWZhdWx0KSk7CiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIGNfaXRlbTpyZWNvcmQodGFiLCBuYW1lKQogICAgICAgICAgICBpZiByZWNvcmRzW3RhYl0gPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIHJlY29yZHNbdGFiXSA9IHsgfTsKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBzZWxmLmlzX3JlY29yZGVkID0gdHJ1ZTsKICAgICAgICAgICAgcmVjb3Jkc1t0YWJdW25hbWVdID0gc2VsZjsKCiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBjX2l0ZW06c2F2ZSgpCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmlzX3JlY29yZGVkIHRoZW4KICAgICAgICAgICAgICAgIGNsaWVudF9lcnJvcl9sb2coIlVuYWJsZSB0byBzYXZlIHVucmVjb3JkZWQgZWxlbWVudCIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHNlbGYuaXNfc2F2ZWQgPSB0cnVlOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gY19pdGVtOmRpc3BsYXkoKQogICAgICAgICAgICBzZWxmLmlzX3Zpc2libGUgPSB0cnVlOwogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBjX2l0ZW06c2V0X2NhbGxiYWNrKGNhbGxiYWNrKQogICAgICAgICAgICBzZWxmLmNhbGxiYWNrc1sjc2VsZi5jYWxsYmFja3MgKyAxXSA9IGNhbGxiYWNrOwogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBjX2l0ZW06dXBkYXRlX3ZhbHVlKHJlZikKICAgICAgICAgICAgbG9jYWwgdmFsdWUgPSB7IGdldF92YWx1ZShyZWYpIH07CiAgICAgICAgICAgIHNlbGYua2V5cyA9IGdldF9rZXlzKHZhbHVlKTsKCiAgICAgICAgICAgIHNlbGYudmFsdWUgPSB2YWx1ZTsKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gY19pdGVtOmludm9rZV9jYWxsYmFjayguLi4pCiAgICAgICAgICAgIGZvciBpID0gMSwgI3NlbGYuY2FsbGJhY2tzIGRvCiAgICAgICAgICAgICAgICBzZWxmLmNhbGxiYWNrc1tpXSguLi4pOwogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgY19pdGVtLl9faW5kZXggPSBjX2l0ZW07CiAgICBlbmQKCiAgICBmdW5jdGlvbiBtZW51Lm5ld19pdGVtKGZuLCAuLi4pCiAgICAgICAgbG9jYWwgcmVmID0gZm4oLi4uKTsKCiAgICAgICAgbG9jYWwgdmFsdWUgPSB7IGdldF92YWx1ZShyZWYpIH07CiAgICAgICAgbG9jYWwgdHlwZW9mID0gdWlfdHlwZShyZWYpOwoKICAgICAgICBsb2NhbCBpdGVtID0gY19pdGVtOm5ldygpOwoKICAgICAgICBpdGVtLnJlZiA9IHJlZjsKICAgICAgICBpdGVtLm5hbWUgPSBzZWxlY3QoMywgLi4uKTsKCiAgICAgICAgaXRlbS52YWx1ZSA9IHZhbHVlOwogICAgICAgIGl0ZW0uZGVmYXVsdCA9IHZhbHVlOwoKICAgICAgICBpdGVtLmtleXMgPSBnZXRfa2V5cyh2YWx1ZSk7CiAgICAgICAgaXRlbS5jYWxsYmFja3MgPSB7IH07CgogICAgICAgIGl0ZW0uaXNfc2F2ZWQgPSBmYWxzZTsKICAgICAgICBpdGVtLmlzX3Zpc2libGUgPSBmYWxzZTsKICAgICAgICBpdGVtLmlzX3JlY29yZGVkID0gZmFsc2U7CgogICAgICAgIGlmIHR5cGVvZiA9PSAiYnV0dG9uIiB0aGVuCiAgICAgICAgICAgIGl0ZW0uY2FsbGJhY2tzWyNpdGVtLmNhbGxiYWNrcyArIDFdID0gc2VsZWN0KDQsIC4uLik7CiAgICAgICAgZW5kCgogICAgICAgIGl0ZW06aW5pdCgpOwogICAgICAgIGl0ZW1zWyNpdGVtcyArIDFdID0gaXRlbTsKCiAgICAgICAgcmV0dXJuIGl0ZW07CiAgICBlbmQKCiAgICBmdW5jdGlvbiBtZW51LmdldF9pdGVtcygpCiAgICAgICAgcmV0dXJuIGl0ZW1zOwogICAgZW5kCgogICAgZnVuY3Rpb24gbWVudS5nZXRfcmVjb3JkcygpCiAgICAgICAgcmV0dXJuIHJlY29yZHM7CiAgICBlbmQKCiAgICBmdW5jdGlvbiBtZW51LnNldF9jYWxsYmFjayhjYWxsYmFjaykKICAgICAgICBjYWxsYmFja3NbI2NhbGxiYWNrcyArIDFdID0gY2FsbGJhY2s7CiAgICBlbmQKCiAgICBmdW5jdGlvbiBtZW51LnVwZGF0ZSgpCiAgICAgICAgdXBkYXRlX2l0ZW1zKCk7CiAgICBlbmQKZW5kCgotLS0gcmVnaW9uIHRoZW1lCmRvCiAgICBsb2NhbCBjYWxsYmFja3MgPSB7IH07CgogICAgbG9jYWwgZnVuY3Rpb24gaW52b2tlX2NhbGxiYWNrKCkKICAgICAgICBmb3IgaSA9IDEsICNjYWxsYmFja3MgZG8KICAgICAgICAgICAgY2FsbGJhY2tzW2ldKCk7CiAgICAgICAgZW5kCiAgICBlbmQKCiAgICB0aGVtZS5oZXggPSAiZmZmZmZmYzgiOwogICAgdGhlbWUuY29sb3IgPSB7IDI1NSwgMjU1LCAyNTUsIDIwMCB9OwoKICAgIGZ1bmN0aW9uIHRoZW1lLnJhd3NldChyLCBnLCBiLCBhKQogICAgICAgIHRoZW1lLmhleCA9IHV0aWxzLnRvX2hleChyLCBnLCBiLCBhKTsKICAgICAgICB0aGVtZS5jb2xvciA9IHsgciwgZywgYiwgYSB9OwoKICAgICAgICBpbnZva2VfY2FsbGJhY2soKTsKICAgIGVuZAoKICAgIGZ1bmN0aW9uIHRoZW1lLnNldChyZWYpCiAgICAgICAgdGhlbWUucmF3c2V0KHVpX2dldChyZWYpKTsKICAgIGVuZAoKICAgIGZ1bmN0aW9uIHRoZW1lLnVwZGF0ZSgpCiAgICAgICAgaW52b2tlX2NhbGxiYWNrKCk7CiAgICBlbmQKCiAgICBmdW5jdGlvbiB0aGVtZS5zZXRfZXZlbnRfY2FsbGJhY2soY2FsbGJhY2spCiAgICAgICAgY2FsbGJhY2tzWyNjYWxsYmFja3MgKyAxXSA9IGNhbGxiYWNrOwogICAgZW5kCgogICAgZnVuY3Rpb24gdGhlbWUubmV3X2xhYmVsKHRhYiwgY29udGFpbmVyLCBjYWxsYmFjaykKICAgICAgICBsb2NhbCByZWYgPSB1aV9uZXdfbGFiZWwodGFiLCBjb250YWluZXIsIGNhbGxiYWNrKCkpOwoKICAgICAgICB0aGVtZS5zZXRfZXZlbnRfY2FsbGJhY2soZnVuY3Rpb24oKQogICAgICAgICAgICB1aV9zZXQocmVmLCBjYWxsYmFjaygpKTsKICAgICAgICBlbmQpOwoKICAgICAgICByZXR1cm4gcmVmOwogICAgZW5kCgogICAgdGhlbWUuc2V0KHNvZnR3YXJlLm1pc2Muc2V0dGluZ3MubWVudV9jb2xvcik7CiAgICB1aV9zZXRfY2FsbGJhY2soc29mdHdhcmUubWlzYy5zZXR0aW5ncy5tZW51X2NvbG9yLCB0aGVtZS5zZXQpOwplbmQKCi0tLSByZWdpb24gc2V0dGluZ3MKZG8KICAgIGxvY2FsIERCX0xBU1RfU0FWRV9LRVkgPSAic2V0dGluZ3M6Omxhc3Rfc2F2ZSI7CgogICAgbG9jYWwgaXRlbXMgPSBtZW51LmdldF9pdGVtcygpOwogICAgbG9jYWwgcmVjb3JkcyA9IG1lbnUuZ2V0X3JlY29yZHMoKTsKCiAgICBsb2NhbCBsYXN0X3NhdmUgPSBkYi5nZXQoREJfTEFTVF9TQVZFX0tFWSk7CgogICAgbG9jYWwgZnVuY3Rpb24gZ2V0X3ZhbHVlKHJlZikKICAgICAgICBsb2NhbCB2YWx1ZSA9IHsgdWlfZ2V0KHJlZikgfTsKICAgICAgICBsb2NhbCB0eXBlb2YgPSB1aV90eXBlKHJlZik7CgogICAgICAgIGlmIHR5cGVvZiA9PSAiaG90a2V5IiB0aGVuCiAgICAgICAgICAgIGxvY2FsIG1vZGUgPSBlX2hvdGtleV9tb2RlW3ZhbHVlWzJdXTsKICAgICAgICAgICAgbG9jYWwga2V5ID0gdmFsdWVbM10gb3IgMDsKCiAgICAgICAgICAgIHJldHVybiB7IG1vZGUsIGtleSB9OwogICAgICAgIGVuZAoKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICBlbmQKCiAgICBsb2NhbCBmdW5jdGlvbiBleHBvcnQoc2F2ZV9hbGwpCiAgICAgICAgbG9jYWwgZGF0YSA9IHsgfTsKCiAgICAgICAgZm9yIGssIHYgaW4gcGFpcnMocmVjb3JkcykgZG8KICAgICAgICAgICAgbG9jYWwgdGFiID0geyB9OwoKICAgICAgICAgICAgZm9yIHgsIHkgaW4gcGFpcnModikgZG8KICAgICAgICAgICAgICAgIGxvY2FsIGl0ZW0gPSB5OwoKICAgICAgICAgICAgICAgIGlmIG5vdCBpdGVtLmlzX3NhdmVkIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2F2ZV9hbGwgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgdGFiW3hdID0gZ2V0X3ZhbHVlKHkucmVmKTsKICAgICAgICAgICAgICAgIDo6Y29udGludWU6OgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIG5vdCBlbXB0eSh0YWIpIHRoZW4KICAgICAgICAgICAgICAgIGRhdGFba10gPSB0YWI7CiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICByZXR1cm4gZGF0YTsKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIGxvYWQoZGF0YSwgdGFiKQogICAgICAgIGlmIGRhdGFbdGFiXSA9PSBuaWwgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgaWYgcmVjb3Jkc1t0YWJdID09IG5pbCB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgZm9yIGssIHYgaW4gcGFpcnMoZGF0YVt0YWJdKSBkbwogICAgICAgICAgICBsb2NhbCBpdGVtID0gcmVjb3Jkc1t0YWJdW2tdOwoKICAgICAgICAgICAgaWYgaXRlbSA9PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgZ290byBjb250aW51ZTsKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBwY2FsbCh1aV9zZXQsIGl0ZW0ucmVmLCB1bnBhY2sodikpOwogICAgICAgICAgICA6OmNvbnRpbnVlOjoKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIGltcG9ydChkYXRhKQogICAgICAgIGZvciBrIGluIHBhaXJzKGRhdGEpIGRvCiAgICAgICAgICAgIGxvYWQoZGF0YSwgayk7CiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBsb2NhbCBmdW5jdGlvbiByZXNldCgpCiAgICAgICAgZm9yIGkgPSAxLCAjaXRlbXMgZG8KICAgICAgICAgICAgbG9jYWwgaXRlbSA9IGl0ZW1zW2ldOwoKICAgICAgICAgICAgaWYgaXRlbS5pc19zYXZlZCB0aGVuCiAgICAgICAgICAgICAgICBpdGVtOnJlc2V0KCk7CiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCgogICAgZnVuY3Rpb24gc2V0dGluZ3Muc2h1dGRvd24oKQogICAgICAgIGRiLnNldChEQl9MQVNUX1NBVkVfS0VZLCBleHBvcnQodHJ1ZSkpOwogICAgZW5kCgogICAgZnVuY3Rpb24gc2V0dGluZ3MuZXhwb3J0KHNhdmVfYWxsKQogICAgICAgIHJldHVybiBleHBvcnQoc2F2ZV9hbGwpOwogICAgZW5kCgogICAgZnVuY3Rpb24gc2V0dGluZ3MuaW1wb3J0KGRhdGEpCiAgICAgICAgaW1wb3J0KGRhdGEpOwogICAgZW5kCgogICAgZnVuY3Rpb24gc2V0dGluZ3MubG9hZChkYXRhLCB0YWIpCiAgICAgICAgbG9hZChkYXRhLCB0YWIpOwogICAgZW5kCgogICAgZnVuY3Rpb24gc2V0dGluZ3MucmVzZXQoKQogICAgICAgIHJlc2V0KCk7CiAgICBlbmQKCiAgICBmdW5jdGlvbiBzZXR0aW5ncy5sb2FkX2xhc3Rfc2F2ZSgpCiAgICAgICAgaWYgbGFzdF9zYXZlID09IG5pbCB0aGVuCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKCiAgICAgICAgaW1wb3J0KGxhc3Rfc2F2ZSk7CiAgICBlbmQKZW5kCgotLS0gcmVnaW9uIG92ZXJyaWRlCmRvCiAgICBsb2NhbCBkYXRhID0geyB9OwoKICAgIGxvY2FsIGZ1bmN0aW9uIGdldF92YWx1ZShyZWYpCiAgICAgICAgbG9jYWwgdmFsdWUgPSB7IHVpX2dldChyZWYpIH07CiAgICAgICAgbG9jYWwgdHlwZW9mID0gdWlfdHlwZShyZWYpOwoKICAgICAgICBpZiB0eXBlb2YgPT0gImhvdGtleSIgdGhlbgogICAgICAgICAgICByZXR1cm4geyBlX2hvdGtleV9tb2RlW3ZhbHVlWzJdXSB9OwogICAgICAgIGVuZAoKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICBlbmQKCiAgICBmdW5jdGlvbiBvdmVycmlkZS5nZXQocmVmLCAuLi4pCiAgICAgICAgbG9jYWwgdmFsdWUgPSBkYXRhW3JlZl07CgogICAgICAgIGlmIHZhbHVlID09IG5pbCB0aGVuCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKCiAgICAgICAgcmV0dXJuIHVucGFjayh2YWx1ZSk7CiAgICBlbmQKCiAgICBmdW5jdGlvbiBvdmVycmlkZS5zZXQocmVmLCAuLi4pCiAgICAgICAgaWYgZGF0YVtyZWZdID09IG5pbCB0aGVuCiAgICAgICAgICAgIGRhdGFbcmVmXSA9IGdldF92YWx1ZShyZWYpOwogICAgICAgICAgICB1aV9zZXRfZW5hYmxlZChyZWYsIGZhbHNlKTsKICAgICAgICBlbmQKCiAgICAgICAgdWlfc2V0KHJlZiwgLi4uKTsKICAgIGVuZAoKICAgIGZ1bmN0aW9uIG92ZXJyaWRlLnVuc2V0KHJlZikKICAgICAgICBpZiBkYXRhW3JlZl0gPT0gbmlsIHRoZW4KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICB1aV9zZXQocmVmLCB1bnBhY2soZGF0YVtyZWZdKSk7CiAgICAgICAgdWlfc2V0X2VuYWJsZWQocmVmLCB0cnVlKTsKCiAgICAgICAgZGF0YVtyZWZdID0gbmlsOwogICAgZW5kCmVuZAoKLS0tIHJlZ2lvbiBob21lCmRvCiAgICBsb2NhbCBmdW5jdGlvbiBkaXNwbGF5X25hdGl2ZV9tZW51KHZpc2libGUpCiAgICAgICAgLS0gQW50aS1haW1ib3QgYW5nbGVzCiAgICAgICAgbG9jYWwgcGl0Y2hfdmFsID0gdWlfZ2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy5waXRjaFsxXSk7CiAgICAgICAgbG9jYWwgeWF3X3ZhbCA9IHVpX2dldChzb2Z0d2FyZS5hYS5hbmdsZXMueWF3WzFdKTsKICAgICAgICBsb2NhbCB5YXdfaml0dGVyX3ZhbCA9IHVpX2dldChzb2Z0d2FyZS5hYS5hbmdsZXMueWF3X2ppdHRlclsxXSk7CiAgICAgICAgbG9jYWwgYm9keV95YXdfdmFsID0gdWlfZ2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy5ib2R5X3lhd1sxXSk7CgogICAgICAgIHVpX3NldF92aXNpYmxlKHNvZnR3YXJlLmFhLmFuZ2xlcy5lbmFibGVkLCB2aXNpYmxlKTsKICAgICAgICB1aV9zZXRfdmlzaWJsZShzb2Z0d2FyZS5hYS5hbmdsZXMucGl0Y2hbMV0sIHZpc2libGUpOwogICAgICAgIHVpX3NldF92aXNpYmxlKHNvZnR3YXJlLmFhLmFuZ2xlcy55YXdfYmFzZSwgdmlzaWJsZSk7CiAgICAgICAgdWlfc2V0X3Zpc2libGUoc29mdHdhcmUuYWEuYW5nbGVzLnlhd1sxXSwgdmlzaWJsZSk7CiAgICAgICAgdWlfc2V0X3Zpc2libGUoc29mdHdhcmUuYWEuYW5nbGVzLmJvZHlfeWF3WzFdLCB2aXNpYmxlKTsKICAgICAgICB1aV9zZXRfdmlzaWJsZShzb2Z0d2FyZS5hYS5hbmdsZXMuZWRnZV95YXcsIHZpc2libGUpOwogICAgICAgIHVpX3NldF92aXNpYmxlKHNvZnR3YXJlLmFhLmFuZ2xlcy5mcmVlc3RhbmRpbmdbMV0sIHZpc2libGUpOwogICAgICAgIHVpX3NldF92aXNpYmxlKHNvZnR3YXJlLmFhLmFuZ2xlcy5mcmVlc3RhbmRpbmdbMl0sIHZpc2libGUpOwogICAgICAgIHVpX3NldF92aXNpYmxlKHNvZnR3YXJlLmFhLmFuZ2xlcy5yb2xsLCB2aXNpYmxlKTsKCiAgICAgICAgaWYgcGl0Y2hfdmFsID09ICJDdXN0b20iIHRoZW4KICAgICAgICAgICAgdWlfc2V0X3Zpc2libGUoc29mdHdhcmUuYWEuYW5nbGVzLnBpdGNoWzJdLCB2aXNpYmxlKTsKICAgICAgICBlbmQKCiAgICAgICAgaWYgeWF3X3ZhbCB+PSAiT2ZmIiB0aGVuCiAgICAgICAgICAgIHVpX3NldF92aXNpYmxlKHNvZnR3YXJlLmFhLmFuZ2xlcy55YXdbMl0sIHZpc2libGUpOwogICAgICAgICAgICB1aV9zZXRfdmlzaWJsZShzb2Z0d2FyZS5hYS5hbmdsZXMueWF3X2ppdHRlclsxXSwgdmlzaWJsZSk7CgogICAgICAgICAgICBpZiB5YXdfaml0dGVyX3ZhbCB+PSAiT2ZmIiB0aGVuCiAgICAgICAgICAgICAgICB1aV9zZXRfdmlzaWJsZShzb2Z0d2FyZS5hYS5hbmdsZXMueWF3X2ppdHRlclsyXSwgdmlzaWJsZSk7CiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBpZiBib2R5X3lhd192YWwgfj0gIk9mZiIgdGhlbgogICAgICAgICAgICBpZiBib2R5X3lhd192YWwgfj0gIk9wcG9zaXRlIiB0aGVuCiAgICAgICAgICAgICAgICB1aV9zZXRfdmlzaWJsZShzb2Z0d2FyZS5hYS5hbmdsZXMuYm9keV95YXdbMl0sIHZpc2libGUpOwogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHVpX3NldF92aXNpYmxlKHNvZnR3YXJlLmFhLmFuZ2xlcy5mcmVlc3RhbmRpbmdfYm9keV95YXcsIHZpc2libGUpOwogICAgICAgIGVuZAoKICAgICAgICAtLSBGYWtlIGxhZwogICAgICAgIHVpX3NldF92aXNpYmxlKHNvZnR3YXJlLmFhLmZha2VsYWcuZW5hYmxlZFsxXSwgdmlzaWJsZSk7CiAgICAgICAgdWlfc2V0X3Zpc2libGUoc29mdHdhcmUuYWEuZmFrZWxhZy5lbmFibGVkWzJdLCB2aXNpYmxlKTsKICAgICAgICB1aV9zZXRfdmlzaWJsZShzb2Z0d2FyZS5hYS5mYWtlbGFnLmFtb3VudCwgdmlzaWJsZSk7CiAgICAgICAgdWlfc2V0X3Zpc2libGUoc29mdHdhcmUuYWEuZmFrZWxhZy52YXJpYW5jZSwgdmlzaWJsZSk7CiAgICAgICAgdWlfc2V0X3Zpc2libGUoc29mdHdhcmUuYWEuZmFrZWxhZy5saW1pdCwgdmlzaWJsZSk7CgogICAgICAgIC0tIE90aGVyCiAgICAgICAgdWlfc2V0X3Zpc2libGUoc29mdHdhcmUuYWEub3RoZXIuc2xvd19tb3Rpb25bMV0sIHZpc2libGUpOwogICAgICAgIHVpX3NldF92aXNpYmxlKHNvZnR3YXJlLmFhLm90aGVyLnNsb3dfbW90aW9uWzJdLCB2aXNpYmxlKTsKICAgICAgICB1aV9zZXRfdmlzaWJsZShzb2Z0d2FyZS5hYS5vdGhlci5sZWdfbW92ZW1lbnQsIHZpc2libGUpOwogICAgICAgIHVpX3NldF92aXNpYmxlKHNvZnR3YXJlLmFhLm90aGVyLm9uX3Nob3RfYW50aWFpbVsxXSwgdmlzaWJsZSk7CiAgICAgICAgdWlfc2V0X3Zpc2libGUoc29mdHdhcmUuYWEub3RoZXIub25fc2hvdF9hbnRpYWltWzJdLCB2aXNpYmxlKTsKICAgICAgICB1aV9zZXRfdmlzaWJsZShzb2Z0d2FyZS5hYS5vdGhlci5mYWtlX3BlZWtbMV0sIHZpc2libGUpOwogICAgICAgIHVpX3NldF92aXNpYmxlKHNvZnR3YXJlLmFhLm90aGVyLmZha2VfcGVla1syXSwgdmlzaWJsZSk7CiAgICBlbmQKCiAgICBsb2NhbCBmdW5jdGlvbiBnZXRfbW9udGhfYW5kX2RheSh0aW1lc3RhbXApCiAgICAgICAgbG9jYWwgZGF0ZSA9IHV0aWxzLm5ld19kYXRlKHRpbWVzdGFtcCAqIDEwMDApOwoKICAgICAgICBsb2NhbCBtb250aF9uYW1lID0gdXRpbHMuZ2V0X21vbnRoX25hbWUoZGF0ZS5nZXRNb250aCgpKTsKICAgICAgICBsb2NhbCBkYXkgPSBkYXRlLmdldERhdGUoKTsKCiAgICAgICAgcmV0dXJuIG1lcmdlIHsgbW9udGhfbmFtZSwgIlx4MjAiLCBkYXkgfTsKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIGdldF9sYXN0X3VwZGF0ZV90aW1lKCkKICAgICAgICBsb2NhbCBkaWZmZXJlbmNlID0gY2xpZW50X3VuaXhfdGltZSgpIC0gTFVBX1VQREFURV9XQVM7CiAgICAgICAgbG9jYWwgaG91cnMsIG1pbnV0ZXMsIHNlY29uZHMgPSB1dGlscy5tZWFzdXJlX3RpbWUoZGlmZmVyZW5jZSk7CgogICAgICAgIGlmIGRpZmZlcmVuY2UgPCAwIHRoZW4KICAgICAgICAgICAgcmV0dXJuICJpbiBmdXR1cmUiOwogICAgICAgIGVuZAoKICAgICAgICBpZiBob3VycyA+PSAyNCB0aGVuCiAgICAgICAgICAgIGlmIGhvdXJzIDwgNDggdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuICJ5ZXN0ZXJkYXkiOwogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiBnZXRfbW9udGhfYW5kX2RheShMVUFfVVBEQVRFX1dBUyk7CiAgICAgICAgZW5kCgogICAgICAgIGlmIGhvdXJzID4gMCB0aGVuCiAgICAgICAgICAgIHJldHVybiBtZXJnZSB7IGhvdXJzLCAiXHgyMCIsICJob3VycyBhZ28iIH07CiAgICAgICAgZW5kCgogICAgICAgIGlmIG1pbnV0ZXMgPiAwIHRoZW4KICAgICAgICAgICAgcmV0dXJuIG1lcmdlIHsgbWludXRlcywgIlx4MjAiLCAibWludXRlcyBhZ28iIH07CiAgICAgICAgZW5kCgogICAgICAgIGlmIHNlY29uZHMgPiAwIHRoZW4KICAgICAgICAgICAgcmV0dXJuIG1lcmdlIHsgc2Vjb25kcywgIlx4MjAiLCAic2Vjb25kcyBhZ28iIH07CiAgICAgICAgZW5kCgogICAgICAgIHJldHVybiAibW9tZW50IGFnbyI7CiAgICBlbmQKCiAgICBob21lLmVuYWJsZWQgPSBtZW51Lm5ld19pdGVtKHVpX25ld19jaGVja2JveCwgIkFBIiwgIkZha2UgTGFnIiwgIlNlbmtvVGVjaMKwIikKICAgIDogcmVjb3JkKCJob21lIiwgImVuYWJsZWQiKTsKCiAgICBob21lLm5ld19saW5lX2JyZWFrID0gbWVudS5uZXdfaXRlbSh1aV9uZXdfbGFiZWwsICJBQSIsICJGYWtlIGxhZyIsIG1lcmdlIHsgIlxhMzAzMDMwZmYiLCAi4o6v4o6v4o6v4o6v4o6v4o6v4o6v4o6v4o6v4o6v4o6v4o6v4o6v4o6v4o6v4o6v4o6v4o6v4o6vIiB9KTsKCiAgICBob21lLnVzZXJuYW1lID0gbWVudS5uZXdfaXRlbSh0aGVtZS5uZXdfbGFiZWwsICJBQSIsICJGYWtlIGxhZyIsIGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCB1c2VybmFtZSA9IFVTRVI7CgogICAgICAgIGlmIHByb2ZpbGUuaGlkZV91c2VybmFtZSBhbmQgcHJvZmlsZS5oaWRlX3VzZXJuYW1lOmdldCgpIHRoZW4KICAgICAgICAgICAgdXNlcm5hbWUgPSAiwqtoaWRkZW7CuyI7CiAgICAgICAgZW5kCgogICAgICAgIHJldHVybiBtZXJnZSB7ICJXZWxjb21lIGJhY2sgYWdhaW4sICIsICJcYSIsIHRoZW1lLmhleCwgdXNlcm5hbWUsICJcYSIsICJmZmZmZmZjOCIsICIuIiB9OwogICAgZW5kKTsKCiAgICBob21lLmxhc3RfdXBkYXRlID0gbWVudS5uZXdfaXRlbSh0aGVtZS5uZXdfbGFiZWwsICJBQSIsICJGYWtlIGxhZyIsIGZ1bmN0aW9uKCkKICAgICAgICByZXR1cm4gbWVyZ2UgeyAiTGFzdCB1cGRhdGUgd2FzICIsICJcYSIsIHRoZW1lLmhleCwgZ2V0X2xhc3RfdXBkYXRlX3RpbWUoKSwgIlxhIiwgImZmZmZmZmM4IiwgIi4iIH07CiAgICBlbmQpOwoKICAgIGhvbWUuYnVpbGQgPSBtZW51Lm5ld19pdGVtKHRoZW1lLm5ld19sYWJlbCwgIkFBIiwgIkZha2UgbGFnIiwgZnVuY3Rpb24oKQogICAgICAgIHJldHVybiBtZXJnZSB7ICJZb3VyIGJ1aWxkIGlzICIsICJcYSIsIEJVSUxEX0NPTE9SIG9yIHRoZW1lLmhleCwgdG9sb3dlcihCVUlMRCksICJcYSIsICJmZmZmZmZjOCIsICIuIiB9OwogICAgZW5kKTsKCiAgICBob21lLmVuZF9saW5lX2JyZWFrID0gbWVudS5uZXdfaXRlbSh1aV9uZXdfbGFiZWwsICJBQSIsICJGYWtlIGxhZyIsIG1lcmdlIHsgIlxhMzAzMDMwZmYiLCAi4o6v4o6v4o6v4o6v4o6v4o6v4o6v4o6v4o6v4o6v4o6v4o6v4o6v4o6v4o6v4o6v4o6v4o6v4o6vIiB9KTsKCiAgICBob21lLnNlbGVjdGlvbiA9IG1lbnUubmV3X2l0ZW0odWlfbmV3X2NvbWJvYm94LCAiQUEiLCAiRmFrZSBMYWciLCBtZXJnZSB7ICJcbiIsICJob21lOjpzZWxlY3Rpb24iIH0sIHsKICAgICAgICAiLSBQcm9maWxlIiwKICAgICAgICAiLSBBaW1ib3QiLAogICAgICAgICItIEFudGktYWltYm90IiwKICAgICAgICAiLSBWaXN1YWxpc2F0aW9uIiwKICAgICAgICAiLSBNaXNjZWxsYW5lb3VzIgogICAgfSkKICAgIDogcmVjb3JkKCJob21lIiwgInNlbGVjdGlvbiIpOwoKICAgIGZ1bmN0aW9uIGhvbWUuc2h1dGRvd24oKQogICAgICAgIGRpc3BsYXlfbmF0aXZlX21lbnUodHJ1ZSk7CiAgICBlbmQKCiAgICBmdW5jdGlvbiBob21lLmZyYW1lKCkKICAgICAgICBkaXNwbGF5X25hdGl2ZV9tZW51KG5vdCBob21lLmVuYWJsZWQ6Z2V0KCkpOwogICAgZW5kCmVuZAoKLS0tIHJlZ2lvbiBwcm9maWxlCmRvCiAgICBsb2NhbCBQUk9GSUxFX0tFWSA9ICJTZW5rb1l3TzlKQXVYNDd4MVJHSUtqVFZsdkVVYU1EMm1mMDVXZ0ZidE5DZDhjcnppNkhQeVpzUTNMaHFwQisvPSIKCiAgICBsb2NhbCBwcmVmaXggPSBtZXJnZSB7ICItc2Vua290ZWNoLSIsICJceDIwIiB9OwoKICAgIGxvY2FsIGZ1bmN0aW9uIGZvcm0ocykKICAgICAgICByZXR1cm4gbWVyZ2UgeyBwcmVmaXgsIHMgfTsKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIHVuZm9ybShzKQogICAgICAgIGxvY2FsIHBhdHRlcm4gPSBwcmVmaXg6Z3N1YigiJVciLCAiJSUlMCIpOwogICAgICAgIHBhdHRlcm4gPSBtZXJnZSB7IHBhdHRlcm4sICIoLispIiB9OwoKICAgICAgICBsb2NhbCByZXN1bHQgPSBzdHJpbmdfbWF0Y2gocywgcGF0dGVybik7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIG5ld19wcm9maWxlX2RhdGEoKQogICAgICAgIGxvY2FsIGRhdGEgPSB7IH07CgogICAgICAgIGRhdGEuYXV0aG9yID0gVVNFUjsKICAgICAgICBkYXRhLml0ZW1zID0geyB9OwoKICAgICAgICByZXR1cm4gZGF0YTsKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIHBsYXlzb3VuZF9zdWNjZXNzKCkKICAgICAgICBpZW5naW5lc291bmQucGxheXNvdW5kKCJ1aVxcYmVlcGNsZWFyLndhdiIsIDAuNzUsIDI1MCk7CiAgICBlbmQKCiAgICBsb2NhbCBmdW5jdGlvbiBwbGF5c291bmRfZmFpbGVkKCkKICAgICAgICBpZW5naW5lc291bmQucGxheXNvdW5kKCJidXR0b25zXFx3ZWFwb25fY2FudF9idXkud2F2IiwgMC43NSwgMTU1KTsKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIHJlc2V0KCkKICAgICAgICBwcm9maWxlLnJlc2V0KCk7CiAgICAgICAgcGxheXNvdW5kX3N1Y2Nlc3MoKTsKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIGltcG9ydCgpCiAgICAgICAgbG9jYWwgdGV4dCA9IGNsaXBib2FyZC5nZXQoKTsKICAgICAgICB0ZXh0ID0gdW5mb3JtKHRleHQpOwoKICAgICAgICBpZiB0ZXh0ID09IG5pbCB0aGVuCiAgICAgICAgICAgIHByaW50KCJUaGlzIHByb2ZpbGUgaXMgbm90IHZhbGlkIik7CiAgICAgICAgICAgIHBsYXlzb3VuZF9mYWlsZWQoKTsKCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgc3VjY2VzcywgcmVzdWx0ID0gcGNhbGwoYmFzZTY0LmRlY29kZSwgdGV4dCwgUFJPRklMRV9LRVkpOwoKICAgICAgICBpZiBub3Qgc3VjY2VzcyB0aGVuCiAgICAgICAgICAgIHByaW50KCJUaGlzIHByb2ZpbGUgaGFzIGEgZGVjb2RpbmcgZmFpbHVyZSIpOwogICAgICAgICAgICBwbGF5c291bmRfZmFpbGVkKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKCiAgICAgICAgc3VjY2VzcywgcmVzdWx0ID0gcGNhbGwoanNvbl9wYXJzZSwgcmVzdWx0KTsKCiAgICAgICAgaWYgbm90IHN1Y2Nlc3MgdGhlbgogICAgICAgICAgICBwcmludCgiVGhlcmUgd2FzIGFuIHVucGFja2luZyBmYWlsdXJlIGluIHRoaXMgcHJvZmlsZSIpOwogICAgICAgICAgICBwbGF5c291bmRfZmFpbGVkKCk7CgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgZW5kCgogICAgICAgIGlmIHJlc3VsdC5pdGVtcyA9PSBuaWwgdGhlbgogICAgICAgICAgICBwcmludCgiVGhpcyBwcm9maWxlIGRvZXMgbm90IGhhdmUgYW55IHNldHRpbmdzIik7CiAgICAgICAgICAgIHBsYXlzb3VuZF9mYWlsZWQoKTsKCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKCiAgICAgICAgc2V0dGluZ3MuaW1wb3J0KHJlc3VsdC5pdGVtcyk7CiAgICAgICAgcGxheXNvdW5kX3N1Y2Nlc3MoKTsKCiAgICAgICAgcHJpbnQobWVyZ2UgeyAiSW1wb3J0ZWQgcHJvZmlsZSBieSAiLCByZXN1bHQuYXV0aG9yIH0pOwogICAgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gZXhwb3J0KCkKICAgICAgICBsb2NhbCBkYXRhID0gbmV3X3Byb2ZpbGVfZGF0YSgpOwogICAgICAgIGRhdGEuaXRlbXMgPSBzZXR0aW5ncy5leHBvcnQoKTsKCiAgICAgICAgbG9jYWwgdGV4dCA9IGpzb25fc3RyaW5naWZ5KGRhdGEpOwoKICAgICAgICB0ZXh0ID0gYmFzZTY0LmVuY29kZSh0ZXh0LCBQUk9GSUxFX0tFWSk7CiAgICAgICAgdGV4dCA9IGZvcm0odGV4dCk7CgogICAgICAgIGNsaXBib2FyZC5zZXQodGV4dCk7CiAgICAgICAgcGxheXNvdW5kX3N1Y2Nlc3MoKTsKCiAgICAgICAgcHJpbnQoIllvdXIgcHJvZmlsZSBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgZXhwb3J0ZWQgdG8gdGhlIGNsaXBib2FyZCIpOwogICAgZW5kCgogICAgcHJvZmlsZS5oaWRlX3VzZXJuYW1lID0gbWVudS5uZXdfaXRlbSh1aV9uZXdfY2hlY2tib3gsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiSGlkZSB1c2VybmFtZSIpCiAgICA6IHJlY29yZCgicHJvZmlsZSIsICJoaWRlX3VzZXJuYW1lIik7CgogICAgcHJvZmlsZS5pbXBvcnQgPSBtZW51Lm5ld19pdGVtKHVpX25ld19idXR0b24sICJBQSIsICJPdGhlciIsICJJbXBvcnQgZnJvbSBjbGlwYm9hcmQiLCBEVU1NWSk7CiAgICBwcm9maWxlLmV4cG9ydCA9IG1lbnUubmV3X2l0ZW0odWlfbmV3X2J1dHRvbiwgIkFBIiwgIk90aGVyIiwgIkV4cG9ydCB0byBjbGlwYm9hcmQiLCBEVU1NWSk7CiAgICBwcm9maWxlLnJlc2V0ID0gbWVudS5uZXdfaXRlbSh1aV9uZXdfYnV0dG9uLCAiQUEiLCAiT3RoZXIiLCAiUmVzZXQiLCBEVU1NWSk7CgogICAgcHJvZmlsZS5oaWRlX3VzZXJuYW1lOnNldF9jYWxsYmFjayh0aGVtZS51cGRhdGUpOwoKICAgIHByb2ZpbGUuZXhwb3J0OnNldF9jYWxsYmFjayhleHBvcnQpOwogICAgcHJvZmlsZS5pbXBvcnQ6c2V0X2NhbGxiYWNrKGltcG9ydCk7CiAgICBwcm9maWxlLnJlc2V0OnNldF9jYWxsYmFjayhyZXNldCk7CmVuZAoKLS0tIHJlZ2lvbiBhbnRpYWltYm90CmRvCiAgICBsb2NhbCBjdHggPSB7IH07CgogICAgbG9jYWwgZnVuY3Rpb24gbW9kaWZ5X3BpdGNoKCkKICAgICAgICBpZiBjdHgucGl0Y2ggPT0gIlVwICYgRG93biIgdGhlbgogICAgICAgICAgICBjdHgucGl0Y2ggPSAiQ3VzdG9tIjsKCiAgICAgICAgICAgIGlmIGN0eC5waXRjaF9vZmZzZXQgPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIGN0eC5waXRjaF9vZmZzZXQgPSA4OTsKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiB1dGlscy5pc19vZGQobG9jYWxwbGF5ZXIucGFja2V0cykgdGhlbgogICAgICAgICAgICAgICAgY3R4LnBpdGNoX29mZnNldCA9IC1jdHgucGl0Y2hfb2Zmc2V0OwogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKCiAgICAgICAgaWYgY3R4LnBpdGNoID09ICJBZGFwdGl2ZSIgdGhlbgogICAgICAgICAgICBjdHgucGl0Y2ggPSAiQ3VzdG9tIjsKCiAgICAgICAgICAgIGlmIGN0eC5waXRjaF9vZmZzZXQgPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIGN0eC5waXRjaF9vZmZzZXQgPSA0NTsKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBsb2NhbHBsYXllci5kdWNrX2Ftb3VudCA9PSAxLjAgdGhlbgogICAgICAgICAgICAgICAgY3R4LnBpdGNoX29mZnNldCA9IC1jdHgucGl0Y2hfb2Zmc2V0OwogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIG1vZGlmeV95YXcoKQogICAgICAgIGlmIGN0eC55YXcgPT0gIjE4MCBMUiIgdGhlbgogICAgICAgICAgICBjdHgueWF3ID0gIjE4MCI7CgogICAgICAgICAgICBpZiBjdHgueWF3X2xlZnQgPT0gbmlsIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICBpZiBjdHgueWF3X3JpZ2h0ID09IG5pbCB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgICAgIGlmIGN0eC55YXdfb2Zmc2V0ID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICBjdHgueWF3X29mZnNldCA9IDA7CiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgaW52ZXJ0ZWQgPSBsb2NhbHBsYXllci5ib2R5X3lhdyA8IDA7CgogICAgICAgICAgICBpZiBjdHgueWF3XzE4MGxyX21vZGUgPT0gIlN3aXRjaCBkZWxheSIgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgZGVsYXkgPSBjdHgueWF3X3N3aXRjaF9kZWxheTsKICAgICAgICAgICAgICAgIGxvY2FsIHRhcmdldCA9IGRlbGF5ICogMjsKCiAgICAgICAgICAgICAgICBpbnZlcnRlZCA9IChsb2NhbHBsYXllci5wYWNrZXRzICUgdGFyZ2V0KSA+PSBkZWxheTsKCiAgICAgICAgICAgICAgICBjdHguYm9keV95YXcgPSAiU3RhdGljIjsKICAgICAgICAgICAgICAgIGN0eC5ib2R5X3lhd19vZmZzZXQgPSBpbnZlcnRlZCBhbmQKICAgICAgICAgICAgICAgICAgICAxIG9yIC0xOwogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIHlhd19hZGQgPSBpbnZlcnRlZCBhbmQKICAgICAgICAgICAgICAgIGN0eC55YXdfcmlnaHQgb3IgY3R4Lnlhd19sZWZ0OwoKICAgICAgICAgICAgY3R4Lnlhd19vZmZzZXQgPSBjdHgueWF3X29mZnNldCArIHlhd19hZGQ7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIG1vZGlmeV9qaXR0ZXIoKQogICAgICAgIGlmIGN0eC5qaXR0ZXJfbW9kZSA9PSAiU3dpdGNoIiB0aGVuCiAgICAgICAgICAgIGlmIGN0eC5qaXR0ZXJfZnJvbSA9PSBuaWwgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgIGlmIGN0eC5qaXR0ZXJfdG8gPT0gbmlsIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICAgICAgY3R4LmppdHRlcl9vZmZzZXQgPSB1dGlscy5pc19vZGQobG9jYWxwbGF5ZXIucGFja2V0cykgYW5kCiAgICAgICAgICAgICAgICBjdHguaml0dGVyX3RvIG9yIGN0eC5qaXR0ZXJfZnJvbTsKCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKCiAgICAgICAgaWYgY3R4LmppdHRlcl9tb2RlID09ICJTd2F5IiB0aGVuCiAgICAgICAgICAgIGlmIGN0eC5qaXR0ZXJfZnJvbSA9PSBuaWwgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgIGlmIGN0eC5qaXR0ZXJfdG8gPT0gbmlsIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICAgICAgaWYgY3R4LmppdHRlcl9mcm9tID09IGN0eC5qaXR0ZXJfdG8gdGhlbgogICAgICAgICAgICAgICAgY3R4LmppdHRlcl9vZmZzZXQgPSBjdHguaml0dGVyX2Zyb207CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgdGljayA9IGdsb2JhbHNfdGlja2NvdW50KCk7CiAgICAgICAgICAgIGxvY2FsIGRlbHRhID0gY3R4LmppdHRlcl90byAtIGN0eC5qaXR0ZXJfZnJvbTsKCiAgICAgICAgICAgIGRlbHRhID0gZGVsdGEgKyBzaWduKGRlbHRhKTsKCiAgICAgICAgICAgIGxvY2FsIGFjY2VsZXJhdGUgPSB0aWNrICogZGVsdGEgKiBnbG9iYWxzX3RpY2tpbnRlcnZhbCgpOwogICAgICAgICAgICBhY2NlbGVyYXRlID0gYWNjZWxlcmF0ZSAqIDIuMDsKCiAgICAgICAgICAgIHRpY2sgPSB0aWNrICsgZmxvb3IoYWNjZWxlcmF0ZSk7CgogICAgICAgICAgICBsb2NhbCBqaXR0ZXJfYWRkID0gdGljayAlIGRlbHRhOwogICAgICAgICAgICBjdHguaml0dGVyX29mZnNldCA9IGN0eC5qaXR0ZXJfZnJvbSArIGppdHRlcl9hZGQ7CgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgZW5kCgogICAgICAgIGlmIGN0eC5qaXR0ZXJfcmFuZG9taXphdGlvbiB+PSBuaWwgdGhlbgogICAgICAgICAgICBsb2NhbCBvZmZzZXQgPSBjdHguaml0dGVyX3JhbmRvbWl6YXRpb247CiAgICAgICAgICAgIGlmIG9mZnNldCA8PSAwIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICAgICAgbG9jYWwgaml0dGVyX2FkZCA9IGNsaWVudF9yYW5kb21faW50KC1vZmZzZXQsIG9mZnNldCk7CiAgICAgICAgICAgIGN0eC5qaXR0ZXJfb2Zmc2V0ID0gY3R4LmppdHRlcl9vZmZzZXQgKyBqaXR0ZXJfYWRkOwogICAgICAgIGVuZAogICAgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gc2h1dGRvd24oKQogICAgICAgIG92ZXJyaWRlLnVuc2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy5waXRjaFsxXSk7CiAgICAgICAgb3ZlcnJpZGUudW5zZXQoc29mdHdhcmUuYWEuYW5nbGVzLnBpdGNoWzJdKTsKCiAgICAgICAgb3ZlcnJpZGUudW5zZXQoc29mdHdhcmUuYWEuYW5nbGVzLnlhd19iYXNlKTsKCiAgICAgICAgb3ZlcnJpZGUudW5zZXQoc29mdHdhcmUuYWEuYW5nbGVzLnlhd1sxXSk7CiAgICAgICAgb3ZlcnJpZGUudW5zZXQoc29mdHdhcmUuYWEuYW5nbGVzLnlhd1syXSk7CgogICAgICAgIG92ZXJyaWRlLnVuc2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy55YXdfaml0dGVyWzFdKTsKICAgICAgICBvdmVycmlkZS51bnNldChzb2Z0d2FyZS5hYS5hbmdsZXMueWF3X2ppdHRlclsyXSk7CgogICAgICAgIG92ZXJyaWRlLnVuc2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy5ib2R5X3lhd1sxXSk7CiAgICAgICAgb3ZlcnJpZGUudW5zZXQoc29mdHdhcmUuYWEuYW5nbGVzLmJvZHlfeWF3WzJdKTsKCiAgICAgICAgb3ZlcnJpZGUudW5zZXQoc29mdHdhcmUuYWEuYW5nbGVzLmZyZWVzdGFuZGluZ19ib2R5X3lhdyk7CgogICAgICAgIG92ZXJyaWRlLnVuc2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy5lZGdlX3lhdyk7CgogICAgICAgIG92ZXJyaWRlLnVuc2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy5mcmVlc3RhbmRpbmdbMV0pOwogICAgICAgIG92ZXJyaWRlLnVuc2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy5mcmVlc3RhbmRpbmdbMl0pOwoKICAgICAgICBvdmVycmlkZS51bnNldChzb2Z0d2FyZS5hYS5hbmdsZXMucm9sbCk7CiAgICBlbmQKCiAgICBsb2NhbCBmdW5jdGlvbiBzZXR1cCgpCiAgICAgICAgaWYgY3R4LnBpdGNoIH49IG5pbCB0aGVuCiAgICAgICAgICAgIG92ZXJyaWRlLnNldChzb2Z0d2FyZS5hYS5hbmdsZXMucGl0Y2hbMV0sIGN0eC5waXRjaCk7CiAgICAgICAgZW5kCgogICAgICAgIGlmIGN0eC55YXdfYmFzZSB+PSBuaWwgdGhlbgogICAgICAgICAgICBvdmVycmlkZS5zZXQoc29mdHdhcmUuYWEuYW5nbGVzLnlhd19iYXNlLCBjdHgueWF3X2Jhc2UpOwogICAgICAgIGVuZAoKICAgICAgICBpZiBjdHgueWF3IH49IG5pbCB0aGVuCiAgICAgICAgICAgIG92ZXJyaWRlLnNldChzb2Z0d2FyZS5hYS5hbmdsZXMueWF3WzFdLCBjdHgueWF3KTsKICAgICAgICBlbmQKCiAgICAgICAgaWYgY3R4LmJvZHlfeWF3IH49IG5pbCB0aGVuCiAgICAgICAgICAgIG92ZXJyaWRlLnNldChzb2Z0d2FyZS5hYS5hbmdsZXMuYm9keV95YXdbMV0sIGN0eC5ib2R5X3lhdyk7CiAgICAgICAgZW5kCgogICAgICAgIGlmIGN0eC5lZGdlX3lhdyB+PSBuaWwgdGhlbgogICAgICAgICAgICBvdmVycmlkZS5zZXQoc29mdHdhcmUuYWEuYW5nbGVzLmVkZ2VfeWF3LCBjdHguZWRnZV95YXcpOwogICAgICAgIGVuZAoKICAgICAgICBpZiBjdHguZnJlZXN0YW5kaW5nIH49IG5pbCB0aGVuCiAgICAgICAgICAgIG92ZXJyaWRlLnNldChzb2Z0d2FyZS5hYS5hbmdsZXMuZnJlZXN0YW5kaW5nWzFdLCBjdHguZnJlZXN0YW5kaW5nKTsKICAgICAgICAgICAgb3ZlcnJpZGUuc2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy5mcmVlc3RhbmRpbmdbMl0sIGN0eC5mcmVlc3RhbmRpbmcgYW5kCiAgICAgICAgICAgICAgICAiQWx3YXlzIG9uIiBvciAiT24gaG90a2V5Iik7CiAgICAgICAgZW5kCgogICAgICAgIGlmIGN0eC5yb2xsIH49IG5pbCB0aGVuCiAgICAgICAgICAgIG92ZXJyaWRlLnNldChzb2Z0d2FyZS5hYS5hbmdsZXMucm9sbCwgY3R4LnJvbGwpOwogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBwaXRjaF92YWx1ZSA9IHVpX2dldChzb2Z0d2FyZS5hYS5hbmdsZXMucGl0Y2hbMV0pOwogICAgICAgIGxvY2FsIHlhd192YWx1ZSA9IHVpX2dldChzb2Z0d2FyZS5hYS5hbmdsZXMueWF3WzFdKTsKICAgICAgICBsb2NhbCBib2R5X3lhd192YWx1ZSA9IHVpX2dldChzb2Z0d2FyZS5hYS5hbmdsZXMuYm9keV95YXdbMV0pOwoKICAgICAgICBpZiBwaXRjaF92YWx1ZSA9PSAiQ3VzdG9tIiB0aGVuCiAgICAgICAgICAgIGlmIGN0eC5waXRjaF9vZmZzZXQgfj0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIG92ZXJyaWRlLnNldChzb2Z0d2FyZS5hYS5hbmdsZXMucGl0Y2hbMl0sIGNsYW1wKGN0eC5waXRjaF9vZmZzZXQsIC04OSwgODkpKTsKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIGlmIHlhd192YWx1ZSB+PSAiT2ZmIiB0aGVuCiAgICAgICAgICAgIGlmIGN0eC55YXdfb2Zmc2V0IH49IG5pbCB0aGVuCiAgICAgICAgICAgICAgICBvdmVycmlkZS5zZXQoc29mdHdhcmUuYWEuYW5nbGVzLnlhd1syXSwgdXRpbHMubm9ybWFsaXplX3lhdyhjdHgueWF3X29mZnNldCkpOwogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIGN0eC55YXdfaml0dGVyIH49IG5pbCB0aGVuCiAgICAgICAgICAgICAgICBvdmVycmlkZS5zZXQoc29mdHdhcmUuYWEuYW5nbGVzLnlhd19qaXR0ZXJbMV0sIGN0eC55YXdfaml0dGVyKTsKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCB5YXdfaml0dGVyX3ZhbCA9IHVpX2dldChzb2Z0d2FyZS5hYS5hbmdsZXMueWF3X2ppdHRlclsxXSk7CgogICAgICAgICAgICBpZiB5YXdfaml0dGVyX3ZhbCB+PSAiT2ZmIiB0aGVuCiAgICAgICAgICAgICAgICBpZiBjdHguaml0dGVyX29mZnNldCB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgICAgIG92ZXJyaWRlLnNldChzb2Z0d2FyZS5hYS5hbmdsZXMueWF3X2ppdHRlclsyXSwgdXRpbHMubm9ybWFsaXplX3lhdyhjdHguaml0dGVyX29mZnNldCkpOwogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBpZiBib2R5X3lhd192YWx1ZSB+PSAiT2ZmIiB0aGVuCiAgICAgICAgICAgIGlmIGJvZHlfeWF3X3ZhbHVlIH49ICJPcHBvc2l0ZSIgdGhlbgogICAgICAgICAgICAgICAgaWYgY3R4LmJvZHlfeWF3X29mZnNldCB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgICAgIG92ZXJyaWRlLnNldChzb2Z0d2FyZS5hYS5hbmdsZXMuYm9keV95YXdbMl0sIHV0aWxzLm5vcm1hbGl6ZV95YXcoY3R4LmJvZHlfeWF3X29mZnNldCkpOwogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgY3R4LmZyZWVzdGFuZGluZ19ib2R5X3lhdyB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgb3ZlcnJpZGUuc2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy5mcmVlc3RhbmRpbmdfYm9keV95YXcsIGN0eC5mcmVlc3RhbmRpbmdfYm9keV95YXcpOwogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIHRoaW5rKGUpCiAgICAgICAgYnJlYWtfbGMudGhpbmsoZSk7CiAgICBlbmQKCiAgICBsb2NhbCBmdW5jdGlvbiB1cGRhdGUoZSkKICAgICAgICB5YXdfZGlyZWN0aW9uLnVwZGF0ZShjdHgpOwoKICAgICAgICBhbmdsZXMudXBkYXRlKGN0eCk7CgogICAgICAgIGlmIG1hbnVhbF9kaXJlY3Rpb24udXBkYXRlKGN0eCkgdGhlbgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgZW5kCgogICAgICAgIGRlZmVuc2l2ZS51cGRhdGUoY3R4KTsKCiAgICAgICAgc2FmZV9oZWFkLnVwZGF0ZShjdHgpOwogICAgICAgIGF2b2lkX2JhY2tzdGFiLnVwZGF0ZShjdHgpOwogICAgZW5kCgogICAgYW50aWFpbWJvdC5zZWxlY3Rpb24gPSBtZW51Lm5ld19pdGVtKHVpX25ld19jb21ib2JveCwgIkFBIiwgIkZha2UgTGFnIiwgbWVyZ2UgeyAiXG4iLCAiYW50aWFpbWJvdDo6c2VsZWN0aW9uIiB9LCB7CiAgICAgICAgIi0gTWFpbiIsCiAgICAgICAgIi0gQW5nbGVzIgogICAgfSkKICAgIDogcmVjb3JkKCJhYSIsICJhbnRpYWltYm90OjpzZWxlY3Rpb24iKTsKCiAgICBmdW5jdGlvbiBhbnRpYWltYm90LnNodXRkb3duKCkKICAgICAgICBzaHV0ZG93bigpOwogICAgZW5kCgogICAgZnVuY3Rpb24gYW50aWFpbWJvdC5zZXR1cF9jb21tYW5kKGUpCiAgICAgICAgY2xlYXIoY3R4KTsKICAgICAgICBzaHV0ZG93bigpOwoKICAgICAgICBpZiBub3QgaG9tZS5lbmFibGVkOmdldCgpIHRoZW4KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICB0aGluayhlKTsKICAgICAgICB1cGRhdGUoZSk7CgogICAgICAgIG1vZGlmeV9waXRjaCgpOwogICAgICAgIG1vZGlmeV95YXcoKTsKICAgICAgICBtb2RpZnlfaml0dGVyKCk7CgogICAgICAgIHNldHVwKCk7CiAgICBlbmQKZW5kCgotLS0gcmVnaW9uIHZpc3VhbGl6YXRpb24KZG8KICAgIHZpc3VhbGl6YXRpb24uc2VsZWN0aW9uID0gbWVudS5uZXdfaXRlbSh1aV9uZXdfY29tYm9ib3gsICJBQSIsICJGYWtlIExhZyIsIG1lcmdlIHsgIlxuIiwgInZpc3VhbGl6YXRpb246OnNlbGVjdGlvbiIgfSwgewogICAgICAgICItIE1haW4iCiAgICB9KQogICAgOiByZWNvcmQoImFhIiwgInZpc3VhbGl6YXRpb246OnNlbGVjdGlvbiIpOwoKICAgIHZpc3VhbGl6YXRpb24uY29sb3JfbGFiZWwgPSBtZW51Lm5ld19pdGVtKHVpX25ld19sYWJlbCwgIkFBIiwgIk90aGVyIiwgIkNvbG9yIik7CgogICAgdmlzdWFsaXphdGlvbi5jb2xvcl9waWNrZXIgPSBtZW51Lm5ld19pdGVtKHVpX25ld19jb2xvcl9waWNrZXIsICJBQSIsICJPdGhlciIsICJDb2xvciIsIHNvZnR3YXJlLmdldF9jb2xvcigpKQogICAgOiByZWNvcmQoImFhIiwgInZpc3VhbGl6YXRpb246OmNvbG9yX3BpY2tlciIpOwplbmQKCi0tLSByZWdpb24gY29ycmVjdGlvbgpkbwogICAgbG9jYWwgcmVjb3JkcyA9IHsgfTsKCiAgICBsb2NhbCBmdW5jdGlvbiBnZXRfc2VydmVyX3RpbWUocGxheWVyKQogICAgICAgIHJldHVybiBlbnRpdHlfZ2V0X3Byb3AocGxheWVyLCAibV9uVGlja0Jhc2UiKSAqIGdsb2JhbHNfdGlja2ludGVydmFsKCk7CiAgICBlbmQKCiAgICBsb2NhbCBmdW5jdGlvbiBnZXRfc2ltdWxhdGlvbl90aW1lKHBsYXllcikKICAgICAgICByZXR1cm4gZW50aXR5X2dldF9wcm9wKHBsYXllciwgIm1fZmxTaW11bGF0aW9uVGltZSIpOwogICAgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gbmV3X3JlY29yZCgpCiAgICAgICAgbG9jYWwgcmVjb3JkID0gewogICAgICAgICAgICBpc19zaW10aW1lX3VwZGF0ZSA9IGZhbHNlLAoKICAgICAgICAgICAgaXNfaml0dGVyaW5nID0gZmFsc2UsCiAgICAgICAgICAgIGlzX2ppdHRlcmluZ19wcmV2ID0gZmFsc2UsCgogICAgICAgICAgICBzZXJ2ZXJfdGljayA9IDAsCgogICAgICAgICAgICBwcmV2X3NpbXRpbWUgPSAwLAogICAgICAgICAgICBzaW10aW1lID0gMCwKCiAgICAgICAgICAgIHByZXZfZXllX3lhdyA9IDAsCiAgICAgICAgICAgIGV5ZV9hbmdsZXMgPSB2ZWN0b3IoKSwKCiAgICAgICAgICAgIHByZXZfcm90YXRpb24gPSAwLAogICAgICAgICAgICByb3RhdGlvbiA9IHZlY3RvcigpLAoKICAgICAgICAgICAgcHJldl9kZWx0YSA9IDAsCiAgICAgICAgICAgIGRlbHRhID0gMCwKCiAgICAgICAgICAgIGZha2VsYWdfdGlja3MgPSAwLAogICAgICAgICAgICBjaG9rZWRfdGlja3MgPSAwCiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIHJlY29yZDsKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIHVwZGF0ZV9yZWNvcmRzKHBsYXllcikKICAgICAgICByZWNvcmRzW3BsYXllcl0gPSByZWNvcmRzW3BsYXllcl0KICAgICAgICAgICAgb3IgbmV3X3JlY29yZCgpOwoKICAgICAgICBsb2NhbCByZWNvcmQgPSByZWNvcmRzW3BsYXllcl07CgogICAgICAgIGxvY2FsIHNpbXRpbWUgPSBnZXRfc2ltdWxhdGlvbl90aW1lKHBsYXllcik7CiAgICAgICAgbG9jYWwgc2VydmVyX3RpY2sgPSBnZXRfc2VydmVyX3RpbWUocGxheWVyKTsKCiAgICAgICAgbG9jYWwgcm90YXRpb24gPSB2ZWN0b3IoZW50aXR5X2dldF9wcm9wKHBsYXllciwgIm1fYW5nUm90YXRpb24iKSk7CiAgICAgICAgbG9jYWwgZXllX2FuZ2xlcyA9IHZlY3RvcihlbnRpdHlfZ2V0X3Byb3AocGxheWVyLCAibV9hbmdFeWVBbmdsZXMiKSk7CgogICAgICAgIHJlY29yZC5zZXJ2ZXJfdGljayA9IHNlcnZlcl90aWNrOwoKICAgICAgICByZWNvcmQub2xkX3NpbXRpbWUgPSByZWNvcmQuc2ltdGltZTsKICAgICAgICByZWNvcmQuc2ltdGltZSA9IHNpbXRpbWU7CgogICAgICAgIHJlY29yZC5pc19zaW10aW1lX3VwZGF0ZSA9IHJlY29yZC5zaW10aW1lIH49IHJlY29yZC5vbGRfc2ltdGltZTsKCiAgICAgICAgaWYgcmVjb3JkLmlzX3NpbXRpbWVfdXBkYXRlIHRoZW4KICAgICAgICAgICAgcmVjb3JkLmZha2VsYWdfdGlja3MgPSByZWNvcmQuY2hva2VkX3RpY2tzOwogICAgICAgICAgICByZWNvcmQuY2hva2VkX3RpY2tzID0gMDsKCiAgICAgICAgICAgIHJlY29yZC5wcmV2X2V5ZV95YXcgPSByZWNvcmQuZXllX2FuZ2xlcy55OwogICAgICAgICAgICByZWNvcmQuZXllX2FuZ2xlcyA9IGV5ZV9hbmdsZXM7CgogICAgICAgICAgICByZWNvcmQucHJldl9yb3RhdGlvbiA9IHJlY29yZC5yb3RhdGlvbi55OwogICAgICAgICAgICByZWNvcmQucm90YXRpb24gPSByb3RhdGlvbjsKCiAgICAgICAgICAgIHJlY29yZC5wcmV2X2RlbHRhID0gcmVjb3JkLmRlbHRhOwogICAgICAgICAgICByZWNvcmQuZGVsdGEgPSB1dGlscy5ub3JtYWxpemVfeWF3KHJlY29yZC5leWVfYW5nbGVzLnkgLSByZWNvcmQucHJldl9leWVfeWF3KTsKCiAgICAgICAgICAgIHJlY29yZC5pc19wcmV2X2ppdHRlcmluZyA9IHJlY29yZC5pc19qaXR0ZXJpbmc7CgogICAgICAgICAgICByZWNvcmQuaXNfaml0dGVyaW5nID0gKHJlY29yZC5kZWx0YSA+IDAgYW5kIHJlY29yZC5wcmV2X2RlbHRhIDwgMCkKICAgICAgICAgICAgICAgIG9yIChyZWNvcmQuZGVsdGEgPCAwIGFuZCByZWNvcmQucHJldl9kZWx0YSA+IDApOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmVjb3JkLmNob2tlZF90aWNrcyA9IHJlY29yZC5jaG9rZWRfdGlja3MgKyAxOwogICAgICAgIGVuZAogICAgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gcmVtb3ZlX2NvcnJlY3Rpb24ocGxheWVyKQogICAgICAgIHBsaXN0LnNldChwbGF5ZXIsICJGb3JjZSBib2R5IHlhdyIsIGZhbHNlKTsKICAgICAgICBwbGlzdC5zZXQocGxheWVyLCAiRm9yY2UgYm9keSB5YXcgdmFsdWUiLCAwKTsKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIHVwZGF0ZV9jb3JyZWN0aW9uKHBsYXllcikKICAgICAgICBsb2NhbCByZWNvcmQgPSByZWNvcmRzW3BsYXllcl07CiAgICAgICAgaWYgcmVjb3JkID09IG5pbCB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgbG9jYWwgdGlja2NvdW50ID0gZ2xvYmFsc190aWNrY291bnQoKTsKCiAgICAgICAgbG9jYWwgaml0dGVyX2ZpeCA9IGZhbHNlOwogICAgICAgIGxvY2FsIGppdHRlcl9zaWRlID0gLTE7CgogICAgICAgIGlmIHJlY29yZC5kZWx0YSA+IDAgdGhlbgogICAgICAgICAgICBqaXR0ZXJfc2lkZSA9IDE7CiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIHNlcnZlcl90aWNrID0gdG90aWNrcyhyZWNvcmQuc2VydmVyX3RpY2spOwogICAgICAgIGxvY2FsIGxhdGVuY3lfdGljayA9IHRvdGlja3MoY2xpZW50LnJlYWxfbGF0ZW5jeSgpKTsKCiAgICAgICAgbG9jYWwgYXJyaXZhbF90aWNrID0gc2VydmVyX3RpY2sgKyBsYXRlbmN5X3RpY2sgKyAxOwogICAgICAgIGxvY2FsIGN1cnJlbnRfdGljayA9IGFycml2YWxfdGljayAtIHNlcnZlcl90aWNrIC0gMTsKCiAgICAgICAgbG9jYWwgdGlja3NfdG9fcHJlZGljdF9iZWZvcmVfYXJyaXZhbCA9IG1hdGgubWluKG1hdGgubWF4KGFycml2YWxfdGljayAtIGN1cnJlbnRfdGljaywgMCkgKyAodGlja2NvdW50IC0gcmVjb3JkLnNlcnZlcl90aWNrKSwgOCk7CgogICAgICAgIGZvciB0aWNrID0gMSwgdGlja3NfdG9fcHJlZGljdF9iZWZvcmVfYXJyaXZhbCBkbwogICAgICAgICAgICBqaXR0ZXJfc2lkZSA9IC1qaXR0ZXJfc2lkZTsKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgYXZnX2JvZHlfeWF3ID0gKHV0aWxzLm5vcm1hbGl6ZV95YXcocmVjb3JkLmV5ZV9hbmdsZXMueSkgLSB1dGlscy5ub3JtYWxpemVfeWF3KHJlY29yZC5wcmV2X2V5ZV95YXcpKSAqIGppdHRlcl9zaWRlOwoKICAgICAgICBpZiByZWNvcmQuaXNfcHJldl9qaXR0ZXJpbmcgYW5kIHJlY29yZC5pc19qaXR0ZXJpbmcgdGhlbgogICAgICAgICAgICBsb2NhbCBhYnNfYm9keV95YXcgPSBtYXRoLmFicyhhdmdfYm9keV95YXcpOwogICAgICAgICAgICBqaXR0ZXJfZml4ID0gYWJzX2JvZHlfeWF3ID4gOCBhbmQgYWJzX2JvZHlfeWF3IDwgNjQ7CiAgICAgICAgZW5kCgogICAgICAgIHBsaXN0LnNldChwbGF5ZXIsICJGb3JjZSBib2R5IHlhdyIsIGppdHRlcl9maXgpOwogICAgICAgIHBsaXN0LnNldChwbGF5ZXIsICJGb3JjZSBib2R5IHlhdyB2YWx1ZSIsIGNsYW1wKGF2Z19ib2R5X3lhdywgLTYwLCA2MCkpOwogICAgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gc2h1dGRvd24oKQogICAgICAgIGxvY2FsIGVuZW1pZXMgPSBlbnRpdHkuZ2V0X3BsYXllcnModHJ1ZSk7CgogICAgICAgIGZvciBpID0gMSwgI2VuZW1pZXMgZG8KICAgICAgICAgICAgcmVtb3ZlX2NvcnJlY3Rpb24oZW5lbWllc1tpXSk7CiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBjb3JyZWN0aW9uLmVuYWJsZWQgPSBtZW51Lm5ld19pdGVtKHVpX25ld19jaGVja2JveCwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJKaXR0ZXIgY29ycmVjdGlvbiIpCiAgICA6IHJlY29yZCgiYWltYm90IiwgImNvcnJlY3Rpb246OmVuYWJsZWQiKQogICAgOiBzYXZlKCk7CgogICAgZnVuY3Rpb24gY29ycmVjdGlvbi5zaHV0ZG93bigpCiAgICAgICAgc2h1dGRvd24oKTsKICAgIGVuZAoKICAgIGZ1bmN0aW9uIGNvcnJlY3Rpb24ubmV0X3VwZGF0ZSgpCiAgICAgICAgaWYgbm90IGNvcnJlY3Rpb24uZW5hYmxlZDpnZXQoKSB0aGVuCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgZW5lbWllcyA9IGVudGl0eS5nZXRfcGxheWVycyh0cnVlKTsKCiAgICAgICAgZm9yIGkgPSAxLCAjZW5lbWllcyBkbwogICAgICAgICAgICBsb2NhbCBlbmVteSA9IGVuZW1pZXNbaV07CgogICAgICAgICAgICB1cGRhdGVfcmVjb3JkcyhlbmVteSk7CiAgICAgICAgICAgIHVwZGF0ZV9jb3JyZWN0aW9uKGVuZW15KTsKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGNvcnJlY3Rpb24uZW5hYmxlZDpzZXRfY2FsbGJhY2soZnVuY3Rpb24oaXRlbSkKICAgICAgICBpZiBub3QgdWkuZ2V0KGl0ZW0pIHRoZW4KICAgICAgICAgICAgc2h1dGRvd24oKTsKICAgICAgICBlbmQKICAgIGVuZCk7CmVuZAoKLS0tIHJlZ2lvbiBhbmdsZXMKZG8KICAgIGxvY2FsIGZ1bmN0aW9uIHNldF9jdXN0b21fbGlzdChjdHgsIGxpc3QpCiAgICAgICAgaWYgbGlzdC5waXRjaCB+PSBuaWwgdGhlbgogICAgICAgICAgICBjdHgucGl0Y2ggPSBsaXN0LnBpdGNoOmdldCgpOwogICAgICAgICAgICBjdHgucGl0Y2hfb2Zmc2V0ID0gbGlzdC5waXRjaF9vZmZzZXQ6Z2V0KCk7CiAgICAgICAgZW5kCgogICAgICAgIGlmIGxpc3QueWF3X2Jhc2Ugfj0gbmlsIHRoZW4KICAgICAgICAgICAgY3R4Lnlhd19iYXNlID0gbGlzdC55YXdfYmFzZTpnZXQoKTsKICAgICAgICBlbmQKCiAgICAgICAgY3R4LnlhdyA9IGxpc3QueWF3OmdldCgpOwogICAgICAgIGN0eC55YXdfb2Zmc2V0ID0gbGlzdC55YXdfb2Zmc2V0OmdldCgpOwoKICAgICAgICBpZiBjdHgueWF3ID09ICIxODAgTFIiIHRoZW4KICAgICAgICAgICAgY3R4Lnlhd19vZmZzZXQgPSAwOwogICAgICAgIGVuZAoKICAgICAgICBjdHgueWF3XzE4MGxyX21vZGUgPSBsaXN0Lnlhd18xODBscl9tb2RlOmdldCgpOwogICAgICAgIGN0eC55YXdfbGVmdCA9IGxpc3QueWF3X2xlZnQ6Z2V0KCk7CiAgICAgICAgY3R4Lnlhd19yaWdodCA9IGxpc3QueWF3X3JpZ2h0OmdldCgpOwogICAgICAgIGN0eC55YXdfc3dpdGNoX2RlbGF5ID0gbGlzdC55YXdfc3dpdGNoX2RlbGF5OmdldCgpOwoKICAgICAgICBjdHgueWF3X2ppdHRlciA9IGxpc3QueWF3X2ppdHRlcjpnZXQoKTsKICAgICAgICBjdHguaml0dGVyX21vZGUgPSBsaXN0LmppdHRlcl9tb2RlOmdldCgpOwogICAgICAgIGN0eC5qaXR0ZXJfb2Zmc2V0ID0gbGlzdC5qaXR0ZXJfb2Zmc2V0OmdldCgpOwogICAgICAgIGN0eC5qaXR0ZXJfcmFuZG9taXphdGlvbiA9IGxpc3Quaml0dGVyX3JhbmRvbWl6YXRpb246Z2V0KCk7CiAgICAgICAgY3R4LmppdHRlcl9mcm9tID0gbGlzdC5qaXR0ZXJfZnJvbTpnZXQoKTsKICAgICAgICBjdHguaml0dGVyX3RvID0gbGlzdC5qaXR0ZXJfdG86Z2V0KCk7CgogICAgICAgIGN0eC5ib2R5X3lhdyA9IGxpc3QuYm9keV95YXc6Z2V0KCk7CiAgICAgICAgY3R4LmJvZHlfeWF3X29mZnNldCA9IGxpc3QuYm9keV95YXdfb2Zmc2V0OmdldCgpOwogICAgICAgIGN0eC5mcmVlc3RhbmRpbmdfYm9keV95YXcgPSBsaXN0LmZyZWVzdGFuZGluZ19ib2R5X3lhdzpnZXQoKTsKICAgIGVuZAoKICAgIGFuZ2xlcy50eXBlID0gbWVudS5uZXdfaXRlbSh1aV9uZXdfY29tYm9ib3gsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQW50aS1haW1ib3QgdHlwZSIsIHsKICAgICAgICAiT2ZmIiwKICAgICAgICAiQ3VzdG9tIiwKICAgICAgICAiUmVjb21tZW5kZWQiCiAgICB9KQogICAgOiByZWNvcmQoImFhIiwgImFuZ2xlczo6dHlwZSIpCiAgICA6IHNhdmUoKTsKCiAgICBhbmdsZXMuY3VzdG9tID0geyB9OyBkbwogICAgICAgIGFuZ2xlcy5jdXN0b20uc3RhdGUgPSBtZW51Lm5ld19pdGVtKHVpX25ld19jb21ib2JveCwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJTdGF0ZSIsIHsgdW5wYWNrKGVfc3RhdGVtZW50LCAwKSB9KQogICAgICAgIDogcmVjb3JkKCJhYSIsICJjdXN0b206OnN0YXRlIik7CgogICAgICAgIGZvciBpID0gMCwgI2Vfc3RhdGVtZW50IGRvCiAgICAgICAgICAgIGxvY2FsIGxpc3QgPSB7IH07CiAgICAgICAgICAgIGxvY2FsIHN0YXRlID0gZV9zdGF0ZW1lbnRbaV07CgogICAgICAgICAgICBpZiBpIH49IDAgdGhlbgogICAgICAgICAgICAgICAgbGlzdC5lbmFibGVkID0gbWVudS5uZXdfaXRlbSh1aV9uZXdfY2hlY2tib3gsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCBtZXJnZSB7ICJFbmFibGUiLCAiXHgyMCIsIHN0YXRlIH0pCiAgICAgICAgICAgICAgICA6IHJlY29yZCgiYWEiLCBtZXJnZSB7ICJjdXN0b20iLCAiOjoiLCBzdGF0ZSwgIjo6IiwgImVuYWJsZWQiIH0pCiAgICAgICAgICAgICAgICA6IHNhdmUoKTsKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBpIH49IDEwIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIHBpdGNoX2xpc3QgPSB7ICJPZmYiLCAiRGVmYXVsdCIsICJVcCIsICJEb3duIiwgIk1pbmltYWwiLCAiUmFuZG9tIiwgIkN1c3RvbSIgfTsKCiAgICAgICAgICAgICAgICBpZiBzdGF0ZSA9PSAiRGVmZW5zaXZlIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgcGl0Y2hfbGlzdCA9IHsgIk9mZiIsICJEZWZhdWx0IiwgIlVwIiwgIkRvd24iLCAiTWluaW1hbCIsICJSYW5kb20iLCAiQ3VzdG9tIiwgIkFkYXB0aXZlIiwgIlVwICYgRG93biIgfTsKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGxpc3QucGl0Y2ggPSBtZW51Lm5ld19pdGVtKHVpX25ld19jb21ib2JveCwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsIG1lcmdlIHsgIlBpdGNoIiwgIlxuIiwgImN1c3RvbV8iLCAicGl0Y2hfIiwgc3RhdGUgfSwgcGl0Y2hfbGlzdCkKICAgICAgICAgICAgICAgIDogcmVjb3JkKCJhYSIsIG1lcmdlIHsgImN1c3RvbSIsICI6OiIsIHN0YXRlLCAiOjoiLCAicGl0Y2giIH0pCiAgICAgICAgICAgICAgICA6IHNhdmUoKTsKCiAgICAgICAgICAgICAgICBsaXN0LnBpdGNoX29mZnNldCA9IG1lbnUubmV3X2l0ZW0odWlfbmV3X3NsaWRlciwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsIG1lcmdlIHsgIlxuIiwgImN1c3RvbV8iLCAicGl0Y2hfb2Zmc2V0XyIsIHN0YXRlIH0sIC04OSwgODksIDAsIHRydWUsICLCsCIpCiAgICAgICAgICAgICAgICA6IHJlY29yZCgiYWEiLCBtZXJnZSB7ICJjdXN0b20iLCAiOjoiLCBzdGF0ZSwgIjo6IiwgInBpdGNoX29mZnNldCIgfSkKICAgICAgICAgICAgICAgIDogc2F2ZSgpOwoKICAgICAgICAgICAgICAgIGxpc3QueWF3X2Jhc2UgPSBtZW51Lm5ld19pdGVtKHVpX25ld19jb21ib2JveCwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsIG1lcmdlIHsgIllhdyBiYXNlIiwgIlxuIiwgImN1c3RvbV8iLCAieWF3X2Jhc2VfIiwgc3RhdGUgfSwgeyAiTG9jYWwgdmlldyIsICJBdCB0YXJnZXRzIiB9KQogICAgICAgICAgICAgICAgOiByZWNvcmQoImFhIiwgbWVyZ2UgeyAiY3VzdG9tIiwgIjo6Iiwgc3RhdGUsICI6OiIsICJ5YXdfYmFzZSIgfSkKICAgICAgICAgICAgICAgIDogc2F2ZSgpOwogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxpc3QueWF3ID0gbWVudS5uZXdfaXRlbSh1aV9uZXdfY29tYm9ib3gsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCBtZXJnZSB7ICJZYXciLCAiXG4iLCAiY3VzdG9tXyIsICJ5YXdfIiwgc3RhdGUgfSwgeyAiT2ZmIiwgIjE4MCIsICJTcGluIiwgIlN0YXRpYyIsICIxODAgWiIsICJDcm9zc2hhaXIiLCAiMTgwIExSIiB9KQogICAgICAgICAgICA6IHJlY29yZCgiYWEiLCBtZXJnZSB7ICJjdXN0b20iLCAiOjoiLCBzdGF0ZSwgIjo6IiwgInlhdyIgfSkKICAgICAgICAgICAgOiBzYXZlKCk7CgogICAgICAgICAgICBsaXN0Lnlhd19vZmZzZXQgPSBtZW51Lm5ld19pdGVtKHVpX25ld19zbGlkZXIsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCBtZXJnZSB7ICJcbiIsICJjdXN0b21fIiwgInlhd19vZmZzZXRfIiwgc3RhdGUgfSwgLTE4MCwgMTgwLCAwLCB0cnVlLCAiwrAiKQogICAgICAgICAgICA6IHJlY29yZCgiYWEiLCBtZXJnZSB7ICJjdXN0b20iLCAiOjoiLCBzdGF0ZSwgIjo6IiwgInlhd19vZmZzZXQiIH0pCiAgICAgICAgICAgIDogc2F2ZSgpOwoKICAgICAgICAgICAgbGlzdC55YXdfMTgwbHJfbW9kZSA9IG1lbnUubmV3X2l0ZW0odWlfbmV3X2NvbWJvYm94LCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgbWVyZ2UgeyAiXG4iLCAiY3VzdG9tXyIsICJ5YXdfMTgwbHJfbW9kZV8iLCBzdGF0ZSB9LCB7ICJTaWRlIGJhc2VkIiwgIlN3aXRjaCBkZWxheSIgfSkKICAgICAgICAgICAgOiByZWNvcmQoImFhIiwgbWVyZ2UgeyAiY3VzdG9tIiwgIjo6Iiwgc3RhdGUsICI6OiIsICJ5YXdfMTgwbHJfbW9kZSIgfSkKICAgICAgICAgICAgOiBzYXZlKCk7CgogICAgICAgICAgICBsaXN0Lnlhd19sZWZ0ID0gbWVudS5uZXdfaXRlbSh1aV9uZXdfc2xpZGVyLCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgbWVyZ2UgeyAiTGVmdCBvZmZzZXQiLCAiXG4iLCAiY3VzdG9tXyIsICJ5YXdfbGVmdF8iLCBzdGF0ZSB9LCAtMTgwLCAxODAsIDAsIHRydWUsICLCsCIpCiAgICAgICAgICAgIDogcmVjb3JkKCJhYSIsIG1lcmdlIHsgImN1c3RvbSIsICI6OiIsIHN0YXRlLCAiOjoiLCAieWF3X2xlZnQiIH0pCiAgICAgICAgICAgIDogc2F2ZSgpOwoKICAgICAgICAgICAgbGlzdC55YXdfcmlnaHQgPSBtZW51Lm5ld19pdGVtKHVpX25ld19zbGlkZXIsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCBtZXJnZSB7ICJSaWdodCBvZmZzZXQiLCAiXG4iLCAiY3VzdG9tXyIsICJ5YXdfcmlnaHRfIiwgc3RhdGUgfSwgLTE4MCwgMTgwLCAwLCB0cnVlLCAiwrAiKQogICAgICAgICAgICA6IHJlY29yZCgiYWEiLCBtZXJnZSB7ICJjdXN0b20iLCAiOjoiLCBzdGF0ZSwgIjo6IiwgInlhd19yaWdodCIgfSkKICAgICAgICAgICAgOiBzYXZlKCk7CgogICAgICAgICAgICBsaXN0Lnlhd19zd2l0Y2hfZGVsYXkgPSBtZW51Lm5ld19pdGVtKHVpX25ld19zbGlkZXIsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCBtZXJnZSB7ICJTd2l0Y2ggZGVsYXkiLCAiXG4iLCAiY3VzdG9tXyIsICJ5YXdfc3dpdGNoX2RlbGF5XyIsIHN0YXRlIH0sIDEsIDgsIDAsIHRydWUsICJ0IikKICAgICAgICAgICAgOiByZWNvcmQoImFhIiwgbWVyZ2UgeyAiY3VzdG9tIiwgIjo6Iiwgc3RhdGUsICI6OiIsICJ5YXdfc3dpdGNoX2RlbGF5IiB9KQogICAgICAgICAgICA6IHNhdmUoKTsKCgogICAgICAgICAgICBsaXN0Lnlhd19qaXR0ZXIgPSBtZW51Lm5ld19pdGVtKHVpX25ld19jb21ib2JveCwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsIG1lcmdlIHsgIllhdyBqaXR0ZXIiLCAiXG4iLCAiY3VzdG9tXyIsICJ5YXdfaml0dGVyXyIsIHN0YXRlIH0sIHsgIk9mZiIsICJPZmZzZXQiLCAiQ2VudGVyIiwgIlJhbmRvbSIsICJTa2l0dGVyIiB9KQogICAgICAgICAgICA6IHJlY29yZCgiYWEiLCBtZXJnZSB7ICJjdXN0b20iLCAiOjoiLCBzdGF0ZSwgIjo6IiwgInlhd19qaXR0ZXIiIH0pCiAgICAgICAgICAgIDogc2F2ZSgpOwoKICAgICAgICAgICAgbGlzdC5qaXR0ZXJfbW9kZSA9IG1lbnUubmV3X2l0ZW0odWlfbmV3X2NvbWJvYm94LCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgbWVyZ2UgeyAiXG4iLCAiY3VzdG9tXyIsICJqaXR0ZXJfbW9kZV8iLCBzdGF0ZSB9LCB7ICJEZWZhdWx0IiwgIlN3aXRjaCIsICJTd2F5IiB9KQogICAgICAgICAgICA6IHJlY29yZCgiYWEiLCBtZXJnZSB7ICJjdXN0b20iLCAiOjoiLCBzdGF0ZSwgIjo6IiwgImppdHRlcl9tb2RlIiB9KQogICAgICAgICAgICA6IHNhdmUoKTsKCiAgICAgICAgICAgIGxpc3Quaml0dGVyX29mZnNldCA9IG1lbnUubmV3X2l0ZW0odWlfbmV3X3NsaWRlciwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsIG1lcmdlIHsgIkppdHRlciBvZmZzZXQiLCAiXG4iLCAiY3VzdG9tXyIsICJqaXR0ZXJfb2Zmc2V0XyIsIHN0YXRlIH0sIC0xODAsIDE4MCwgMCwgdHJ1ZSwgIsKwIikKICAgICAgICAgICAgOiByZWNvcmQoImFhIiwgbWVyZ2UgeyAiY3VzdG9tIiwgIjo6Iiwgc3RhdGUsICI6OiIsICJqaXR0ZXJfb2Zmc2V0IiB9KQogICAgICAgICAgICA6IHNhdmUoKTsKCiAgICAgICAgICAgIGxpc3Quaml0dGVyX3JhbmRvbWl6YXRpb24gPSBtZW51Lm5ld19pdGVtKHVpX25ld19zbGlkZXIsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCBtZXJnZSB7ICJSYW5kb21pemF0aW9uIiwgIlxuIiwgImN1c3RvbV8iLCAiaml0dGVyX3JhbmRvbWl6YXRpb25fIiwgc3RhdGUgfSwgMCwgMTgwLCAwLCB0cnVlLCAiwrAiLCAxLCB7IFswXSA9ICJPZmYiIH0pCiAgICAgICAgICAgIDogcmVjb3JkKCJhYSIsIG1lcmdlIHsgImN1c3RvbSIsICI6OiIsIHN0YXRlLCAiOjoiLCAiaml0dGVyX3JhbmRvbWl6YXRpb24iIH0pCiAgICAgICAgICAgIDogc2F2ZSgpOwoKICAgICAgICAgICAgbGlzdC5qaXR0ZXJfZnJvbSA9IG1lbnUubmV3X2l0ZW0odWlfbmV3X3NsaWRlciwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsIG1lcmdlIHsgIkZyb20gb2Zmc2V0IiwgIlxuIiwgImN1c3RvbV8iLCAiaml0dGVyX2Zyb21fIiwgc3RhdGUgfSwgLTE4MCwgMTgwLCAwLCB0cnVlLCAiwrAiKQogICAgICAgICAgICA6IHJlY29yZCgiYWEiLCBtZXJnZSB7ICJjdXN0b20iLCAiOjoiLCBzdGF0ZSwgIjo6IiwgImppdHRlcl9mcm9tIiB9KQogICAgICAgICAgICA6IHNhdmUoKTsKCiAgICAgICAgICAgIGxpc3Quaml0dGVyX3RvID0gbWVudS5uZXdfaXRlbSh1aV9uZXdfc2xpZGVyLCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgbWVyZ2UgeyAiVG8gb2Zmc2V0IiwgIlxuIiwgImN1c3RvbV8iLCAiaml0dGVyX3RvXyIsIHN0YXRlIH0sIC0xODAsIDE4MCwgMCwgdHJ1ZSwgIsKwIikKICAgICAgICAgICAgOiByZWNvcmQoImFhIiwgbWVyZ2UgeyAiY3VzdG9tIiwgIjo6Iiwgc3RhdGUsICI6OiIsICJqaXR0ZXJfdG8iIH0pCiAgICAgICAgICAgIDogc2F2ZSgpOwoKCiAgICAgICAgICAgIGxpc3QuYm9keV95YXcgPSBtZW51Lm5ld19pdGVtKHVpX25ld19jb21ib2JveCwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsIG1lcmdlIHsgIkJvZHkgeWF3IiwgIlxuIiwgImN1c3RvbV8iLCAiYm9keV95YXdfIiwgc3RhdGUgfSwgeyAiT2ZmIiwgIk9wcG9zaXRlIiwgIkppdHRlciIsICJTdGF0aWMiIH0pCiAgICAgICAgICAgIDogcmVjb3JkKCJhYSIsIG1lcmdlIHsgImN1c3RvbSIsICI6OiIsIHN0YXRlLCAiOjoiLCAiYm9keV95YXciIH0pCiAgICAgICAgICAgIDogc2F2ZSgpOwoKICAgICAgICAgICAgbGlzdC5ib2R5X3lhd19vZmZzZXQgPSBtZW51Lm5ld19pdGVtKHVpX25ld19zbGlkZXIsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCBtZXJnZSB7ICJcbiIsICJjdXN0b21fIiwgImJvZHlfeWF3X29mZnNldF8iLCBzdGF0ZSB9LCAtMTgwLCAxODAsIDAsIHRydWUsICLCsCIpCiAgICAgICAgICAgIDogcmVjb3JkKCJhYSIsIG1lcmdlIHsgImN1c3RvbSIsICI6OiIsIHN0YXRlLCAiOjoiLCAiYm9keV95YXdfb2Zmc2V0IiB9KQogICAgICAgICAgICA6IHNhdmUoKTsKCiAgICAgICAgICAgIGxpc3QuZnJlZXN0YW5kaW5nX2JvZHlfeWF3ID0gbWVudS5uZXdfaXRlbSh1aV9uZXdfY2hlY2tib3gsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCBtZXJnZSB7ICJGcmVlc3RhbmRpbmcgYm9keSB5YXciLCAiXG4iLCAiY3VzdG9tXyIsICJmcmVlc3RhbmRpbmdfYm9keV95YXdfIiwgc3RhdGUgfSkKICAgICAgICAgICAgOiByZWNvcmQoImFhIiwgbWVyZ2UgeyAiY3VzdG9tIiwgIjo6Iiwgc3RhdGUsICI6OiIsICJmcmVlc3RhbmRpbmdfYm9keV95YXciIH0pCiAgICAgICAgICAgIDogc2F2ZSgpOwoKICAgICAgICAgICAgYW5nbGVzLmN1c3RvbVtzdGF0ZV0gPSBsaXN0OwogICAgICAgIGVuZAogICAgZW5kCgogICAgYW5nbGVzLnJlY29tbWVuZGVkID0gewogICAgICAgIFsiU3RhbmRpbmciXSA9IGZ1bmN0aW9uKGN0eCkKICAgICAgICAgICAgY3R4LnBpdGNoID0gIkRvd24iOwogICAgICAgICAgICBjdHgueWF3X2Jhc2UgPSAiQXQgdGFyZ2V0cyI7CgogICAgICAgICAgICBjdHgueWF3ID0gIjE4MCBMUiI7CiAgICAgICAgICAgIGN0eC55YXdfMTgwbHJfbW9kZSA9ICJTd2l0Y2ggZGVsYXkiOwoKICAgICAgICAgICAgY3R4Lnlhd19sZWZ0ID0gLTIxOwogICAgICAgICAgICBjdHgueWF3X3JpZ2h0ID0gMzk7CgogICAgICAgICAgICBjdHgueWF3X3N3aXRjaF9kZWxheSA9IDI7CgogICAgICAgICAgICBjdHgueWF3X2ppdHRlciA9ICJPZmYiOwoKICAgICAgICAgICAgY3R4LmJvZHlfeWF3ID0gIkppdHRlciI7CiAgICAgICAgICAgIGN0eC5ib2R5X3lhd19vZmZzZXQgPSAtMTsKCiAgICAgICAgICAgIGN0eC5mcmVlc3RhbmRpbmdfYm9keV95YXcgPSBmYWxzZTsKICAgICAgICBlbmQsCgogICAgICAgIFsiTW92aW5nIl0gPSBmdW5jdGlvbihjdHgpCiAgICAgICAgICAgIGN0eC5waXRjaCA9ICJEb3duIjsKICAgICAgICAgICAgY3R4Lnlhd19iYXNlID0gIkF0IHRhcmdldHMiOwoKICAgICAgICAgICAgY3R4LnlhdyA9ICIxODAgTFIiOwogICAgICAgICAgICBjdHgueWF3XzE4MGxyX21vZGUgPSAiU3dpdGNoIGRlbGF5IjsKCiAgICAgICAgICAgIGN0eC55YXdfbGVmdCA9IC0zMjsKICAgICAgICAgICAgY3R4Lnlhd19yaWdodCA9IDM3OwoKICAgICAgICAgICAgY3R4Lnlhd19zd2l0Y2hfZGVsYXkgPSAyOwoKICAgICAgICAgICAgY3R4Lnlhd19qaXR0ZXIgPSAiT2ZmIjsKCiAgICAgICAgICAgIGN0eC5ib2R5X3lhdyA9ICJKaXR0ZXIiOwogICAgICAgICAgICBjdHguYm9keV95YXdfb2Zmc2V0ID0gLTE7CgogICAgICAgICAgICBjdHguZnJlZXN0YW5kaW5nX2JvZHlfeWF3ID0gZmFsc2U7CiAgICAgICAgZW5kLAoKICAgICAgICBbIlNsb3ctbW90aW9uIl0gPSBmdW5jdGlvbihjdHgpCiAgICAgICAgICAgIGN0eC5waXRjaCA9ICJEb3duIjsKICAgICAgICAgICAgY3R4Lnlhd19iYXNlID0gIkF0IHRhcmdldHMiOwoKICAgICAgICAgICAgY3R4LnlhdyA9ICIxODAiOwogICAgICAgICAgICBjdHgueWF3X29mZnNldCA9IC0zOwoKICAgICAgICAgICAgY3R4Lnlhd19qaXR0ZXIgPSAiQ2VudGVyIjsKICAgICAgICAgICAgY3R4LmppdHRlcl9vZmZzZXQgPSAxOTsKCiAgICAgICAgICAgIGN0eC5ib2R5X3lhdyA9ICJKaXR0ZXIiOwogICAgICAgICAgICBjdHguYm9keV95YXdfb2Zmc2V0ID0gLTE7CgogICAgICAgICAgICBjdHguZnJlZXN0YW5kaW5nX2JvZHlfeWF3ID0gZmFsc2U7CiAgICAgICAgZW5kLAoKICAgICAgICBbIkNyb3VjaGVkIl0gPSBmdW5jdGlvbihjdHgpCiAgICAgICAgICAgIGN0eC5waXRjaCA9ICJEb3duIjsKICAgICAgICAgICAgY3R4Lnlhd19iYXNlID0gIkF0IHRhcmdldHMiOwoKICAgICAgICAgICAgY3R4LnlhdyA9ICIxODAgTFIiOwogICAgICAgICAgICBjdHgueWF3XzE4MGxyX21vZGUgPSAiU3dpdGNoIGRlbGF5IjsKCiAgICAgICAgICAgIGN0eC55YXdfbGVmdCA9IC0zMjsKICAgICAgICAgICAgY3R4Lnlhd19yaWdodCA9IDUwOwoKICAgICAgICAgICAgY3R4Lnlhd19zd2l0Y2hfZGVsYXkgPSAyOwoKICAgICAgICAgICAgY3R4Lnlhd19qaXR0ZXIgPSAiT2ZmIjsKCiAgICAgICAgICAgIGN0eC5ib2R5X3lhdyA9ICJKaXR0ZXIiOwogICAgICAgICAgICBjdHguYm9keV95YXdfb2Zmc2V0ID0gLTE7CgogICAgICAgICAgICBjdHguZnJlZXN0YW5kaW5nX2JvZHlfeWF3ID0gZmFsc2U7CiAgICAgICAgZW5kLAoKICAgICAgICBbIkFpcmJvcm5lIl0gPSBmdW5jdGlvbihjdHgpCiAgICAgICAgICAgIGN0eC5waXRjaCA9ICJEb3duIjsKICAgICAgICAgICAgY3R4Lnlhd19iYXNlID0gIkF0IHRhcmdldHMiOwoKICAgICAgICAgICAgY3R4LnlhdyA9ICIxODAiOwogICAgICAgICAgICBjdHgueWF3X29mZnNldCA9IDU7CgogICAgICAgICAgICBjdHgueWF3X2ppdHRlciA9ICJDZW50ZXIiOwogICAgICAgICAgICBjdHguaml0dGVyX29mZnNldCA9IDc3OwoKICAgICAgICAgICAgY3R4LmJvZHlfeWF3ID0gIkppdHRlciI7CiAgICAgICAgICAgIGN0eC5ib2R5X3lhd19vZmZzZXQgPSAtMTsKCiAgICAgICAgICAgIGN0eC5mcmVlc3RhbmRpbmdfYm9keV95YXcgPSBmYWxzZTsKICAgICAgICBlbmQsCgogICAgICAgIFsiQWlyYm9ybmUtY3JvdWNoZWQiXSA9IGZ1bmN0aW9uKGN0eCkKICAgICAgICAgICAgY3R4LnBpdGNoID0gIkRvd24iOwogICAgICAgICAgICBjdHgueWF3X2Jhc2UgPSAiQXQgdGFyZ2V0cyI7CgogICAgICAgICAgICBjdHgueWF3ID0gIjE4MCBMUiI7CiAgICAgICAgICAgIGN0eC55YXdfMTgwbHJfbW9kZSA9ICJTd2l0Y2ggZGVsYXkiOwoKICAgICAgICAgICAgY3R4Lnlhd19sZWZ0ID0gLTM1OwogICAgICAgICAgICBjdHgueWF3X3JpZ2h0ID0gNDc7CgogICAgICAgICAgICBjdHgueWF3X3N3aXRjaF9kZWxheSA9IDM7CgogICAgICAgICAgICBjdHgueWF3X2ppdHRlciA9ICJPZmYiOwoKICAgICAgICAgICAgY3R4LmJvZHlfeWF3ID0gIkppdHRlciI7CiAgICAgICAgICAgIGN0eC5ib2R5X3lhd19vZmZzZXQgPSAtMTsKCiAgICAgICAgICAgIGN0eC5mcmVlc3RhbmRpbmdfYm9keV95YXcgPSBmYWxzZTsKICAgICAgICBlbmQsCgogICAgICAgIFsiRGVmZW5zaXZlIl0gPSBmdW5jdGlvbihjdHgpCiAgICAgICAgICAgIGN0eC5waXRjaCA9ICJBZGFwdGl2ZSI7CiAgICAgICAgICAgIGN0eC5waXRjaF9vZmZzZXQgPSA0NTsKCiAgICAgICAgICAgIGN0eC55YXcgPSAiU3BpbiI7CiAgICAgICAgICAgIGN0eC55YXdfb2Zmc2V0ID0gNzc7CgogICAgICAgICAgICBjdHgueWF3X2ppdHRlciA9ICJPZmZzZXQiOwogICAgICAgICAgICBjdHguaml0dGVyX29mZnNldCA9IDE1OwoKICAgICAgICAgICAgY3R4LmJvZHlfeWF3ID0gIlN0YXRpYyI7CiAgICAgICAgICAgIGN0eC5ib2R5X3lhd19vZmZzZXQgPSAxMjA7CgogICAgICAgICAgICBjdHguZnJlZXN0YW5kaW5nX2JvZHlfeWF3ID0gZmFsc2U7CiAgICAgICAgZW5kCiAgICB9OwoKICAgIGZ1bmN0aW9uIGFuZ2xlcy5zZXQoY3R4LCBzdGF0ZSkKICAgICAgICBpZiBhbmdsZXMudHlwZTpnZXQoKSA9PSAiQ3VzdG9tIiB0aGVuCiAgICAgICAgICAgIGxvY2FsIGxpc3QgPSBhbmdsZXMuY3VzdG9tW3N0YXRlXTsKCiAgICAgICAgICAgIGlmIGxpc3Qgfj0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIC0tIGlmIG5vdCBlbmFibGVkIGluIG1lbnUKICAgICAgICAgICAgICAgIGlmIGxpc3QuZW5hYmxlZCB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBsaXN0LmVuYWJsZWQ6Z2V0KCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBzZXRfY3VzdG9tX2xpc3QoY3R4LCBsaXN0KTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBlbmQKCiAgICAgICAgaWYgYW5nbGVzLnR5cGU6Z2V0KCkgPT0gIlJlY29tbWVuZGVkIiB0aGVuCiAgICAgICAgICAgIGxvY2FsIGZuID0gYW5nbGVzLnJlY29tbWVuZGVkW3N0YXRlXTsKCiAgICAgICAgICAgIGlmIGZuIH49IG5pbCB0aGVuCiAgICAgICAgICAgICAgICBmbihjdHgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGVuZAoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICBlbmQKCiAgICBmdW5jdGlvbiBhbmdsZXMudXBkYXRlKGN0eCkKICAgICAgICBsb2NhbCBsaXN0ID0gc3RhdGVtZW50LmdldCgpOwoKICAgICAgICBmb3IgaSA9ICNsaXN0LCAxLCAtMSBkbwogICAgICAgICAgICBsb2NhbCBzdGF0ZSA9IGxpc3RbaV07CgogICAgICAgICAgICBpZiBhbmdsZXMuc2V0KGN0eCwgc3RhdGUpIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIGFuZ2xlcy5zZXQoY3R4LCAiTWFpbiIpOwogICAgZW5kCmVuZAoKLS0tIHJlZ2lvbiB5YXdfZGlyZWN0aW9uCmRvCiAgICB5YXdfZGlyZWN0aW9uLmVuYWJsZWQgPSBtZW51Lm5ld19pdGVtKHVpX25ld19jaGVja2JveCwgIkFBIiwgIk90aGVyIiwgIllhdyBkaXJlY3Rpb24iKQogICAgOiByZWNvcmQoImFhIiwgInlhd19kaXJlY3Rpb246OmVuYWJsZWQiKTsKCiAgICB5YXdfZGlyZWN0aW9uLmVkZ2VfeWF3ID0gbWVudS5uZXdfaXRlbSh1aV9uZXdfaG90a2V5LCAiQUEiLCAiT3RoZXIiLCBtZXJnZSB7ICIgwrsgIiwgIkVkZ2UgeWF3IiB9KQogICAgOiByZWNvcmQoImFhIiwgInlhd19kaXJlY3Rpb246OmVkZ2VfeWF3Iik7CgogICAgeWF3X2RpcmVjdGlvbi5mcmVlc3RhbmRpbmcgPSBtZW51Lm5ld19pdGVtKHVpX25ld19ob3RrZXksICJBQSIsICJPdGhlciIsIG1lcmdlIHsgIiDCuyAiLCAiRnJlZXN0YW5kaW5nIiB9KQogICAgOiByZWNvcmQoImFhIiwgInlhd19kaXJlY3Rpb246OmZyZWVzdGFuZGluZyIpOwoKICAgIHlhd19kaXJlY3Rpb24ub3B0aW9ucyA9IG1lbnUubmV3X2l0ZW0odWlfbmV3X211bHRpc2VsZWN0LCAiQUEiLCAiT3RoZXIiLCBtZXJnZSB7ICIgwrsgIiwgIk9wdGlvbnMiIH0sIHsgIkZyZWVzdGFuZGluZyBvbiBxdWljayBwZWVrIiB9KQogICAgOiByZWNvcmQoImFhIiwgInlhd19kaXJlY3Rpb246Om9wdGlvbnMiKTsKCiAgICBmdW5jdGlvbiB5YXdfZGlyZWN0aW9uLnVwZGF0ZShjdHgpCiAgICAgICAgaWYgbm90IHlhd19kaXJlY3Rpb24uZW5hYmxlZDpnZXQoKSB0aGVuCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKCiAgICAgICAgY3R4LmVkZ2VfeWF3ID0geWF3X2RpcmVjdGlvbi5lZGdlX3lhdzpyYXdnZXQoKTsKICAgICAgICBjdHguZnJlZXN0YW5kaW5nID0geWF3X2RpcmVjdGlvbi5mcmVlc3RhbmRpbmc6cmF3Z2V0KCk7CgogICAgICAgIGlmIHlhd19kaXJlY3Rpb24ub3B0aW9uczpoYXZlX2tleSgiRnJlZXN0YW5kaW5nIG9uIHF1aWNrIHBlZWsiKSB0aGVuCiAgICAgICAgICAgIGlmIHNvZnR3YXJlLmlzX3F1aWNrX3BlZWtfYXNzaXN0KCkgdGhlbgogICAgICAgICAgICAgICAgY3R4LmZyZWVzdGFuZGluZyA9IHRydWU7CiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS0tIHJlZ2lvbiBtYW51YWxfeWF3CmRvCiAgICBsb2NhbCBMRUZUICAgID0gMDsKICAgIGxvY2FsIFJJR0hUICAgPSAxOwogICAgbG9jYWwgRk9SV0FSRCA9IDI7CgogICAgbG9jYWwgaWR4OwogICAgbG9jYWwgZGF0YSA9IHsgfTsKCiAgICBsb2NhbCBkaXJlY3Rpb25zID0gewogICAgICAgIFtMRUZUXSAgICA9IC05MCwKICAgICAgICBbUklHSFRdICAgPSA5MCwKICAgICAgICBbRk9SV0FSRF0gPSAxODAKICAgIH07CgogICAgbG9jYWwgZnVuY3Rpb24gZ2V0X3ZhbHVlKHJlZikKICAgICAgICBsb2NhbCBwcmV2X2FjdGl2ZSA9IGRhdGFbcmVmXTsKICAgICAgICBsb2NhbCBhY3RpdmUsIG1vZGUsIGtleSA9IHVpX2dldChyZWYpOwoKICAgICAgICBpZiBwcmV2X2FjdGl2ZSA9PSBuaWwgdGhlbgogICAgICAgICAgICBkYXRhW3JlZl0gPSBhY3RpdmU7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKCiAgICAgICAgaWYgbW9kZSA9PSAwIHRoZW4gcmV0dXJuIGVuZAogICAgICAgIGlmIG1vZGUgPT0gMyB0aGVuIHJldHVybiBlbmQKICAgICAgICBpZiBrZXkgPT0gbmlsIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICBpZiBwcmV2X2FjdGl2ZSB+PSBhY3RpdmUgdGhlbgogICAgICAgICAgICBkYXRhW3JlZl0gPSBhY3RpdmU7CiAgICAgICAgICAgIHJldHVybiBhY3RpdmUsIG1vZGUsIGtleTsKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIHVwZGF0ZV9ob3RrZXkocmVmLCB2YWx1ZSkKICAgICAgICBsb2NhbCBhY3RpdmUsIG1vZGUgPSBnZXRfdmFsdWUocmVmKTsKICAgICAgICBpZiBhY3RpdmUgPT0gbmlsIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICBpZiBtb2RlID09IDEgdGhlbgogICAgICAgICAgICBpZiBub3QgYWN0aXZlIHRoZW4KICAgICAgICAgICAgICAgIGlkeCA9IG5pbDsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZHggPSB2YWx1ZTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICBpZiBtb2RlID09IDIgdGhlbgogICAgICAgICAgICBpZiBpZHggPT0gdmFsdWUgdGhlbgogICAgICAgICAgICAgICAgaWR4ID0gbmlsOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlkeCA9IHZhbHVlOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBsb2NhbCBmdW5jdGlvbiB1cGRhdGVfbGFiZWwoaXRlbSwgc3RhdGUpCiAgICAgICAgbG9jYWwgbmFtZSA9IGl0ZW0ubmFtZTsKCiAgICAgICAgaWYgc3RhdGUgdGhlbgogICAgICAgICAgICBsb2NhbCByLCBnLCBiLCBhID0gdW5wYWNrKHRoZW1lLmNvbG9yKTsKICAgICAgICAgICAgYSA9IGEgKiAoZ2xvYmFsc19yZWFsdGltZSgpICUgMSk7CgogICAgICAgICAgICBsb2NhbCBoZXggPSB1dGlscy50b19oZXgociwgZywgYiwgYSk7CiAgICAgICAgICAgIG5hbWUgPSBzdHJpbmdfZ3N1YihuYW1lLCAiwrsiLCBtZXJnZSB7ICJcYSIsIGhleCwgIiUxIiwgIlxhIiwgImZmZmZmZmM4IiB9KTsKICAgICAgICBlbmQKCiAgICAgICAgaXRlbTpzZXQobmFtZSk7CiAgICBlbmQKCiAgICBsb2NhbCBmdW5jdGlvbiB0aGluaygpCiAgICAgICAgaWYgZ2V0X3ZhbHVlKG1hbnVhbF9kaXJlY3Rpb24ucmVzZXRfbWFudWFsLmhvdGtleS5yZWYpIH49IG5pbCB0aGVuCiAgICAgICAgICAgIGlkeCA9IG5pbDsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICB1cGRhdGVfaG90a2V5KG1hbnVhbF9kaXJlY3Rpb24ubGVmdF9tYW51YWwuaG90a2V5LnJlZiwgTEVGVCk7CiAgICAgICAgdXBkYXRlX2hvdGtleShtYW51YWxfZGlyZWN0aW9uLnJpZ2h0X21hbnVhbC5ob3RrZXkucmVmLCBSSUdIVCk7CiAgICAgICAgdXBkYXRlX2hvdGtleShtYW51YWxfZGlyZWN0aW9uLmZvcndhcmRfbWFudWFsLmhvdGtleS5yZWYsIEZPUldBUkQpOwogICAgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gZHJhdyhvbGQsIG5ldykKICAgICAgICBpZiBuZXcgPT0gb2xkIHRoZW4KICAgICAgICAgICAgaWYgdWlfaXNfbWVudV9vcGVuKCkgdGhlbgogICAgICAgICAgICAgICAgaWYgbmV3ID09IExFRlQgdGhlbgogICAgICAgICAgICAgICAgICAgIHVwZGF0ZV9sYWJlbChtYW51YWxfZGlyZWN0aW9uLmxlZnRfbWFudWFsLmxhYmVsLCB0cnVlKTsKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIG5ldyA9PSBSSUdIVCB0aGVuCiAgICAgICAgICAgICAgICAgICAgdXBkYXRlX2xhYmVsKG1hbnVhbF9kaXJlY3Rpb24ucmlnaHRfbWFudWFsLmxhYmVsLCB0cnVlKTsKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIG5ldyA9PSBGT1JXQVJEIHRoZW4KICAgICAgICAgICAgICAgICAgICB1cGRhdGVfbGFiZWwobWFudWFsX2RpcmVjdGlvbi5mb3J3YXJkX21hbnVhbC5sYWJlbCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgZW5kCgogICAgICAgIHVwZGF0ZV9sYWJlbChtYW51YWxfZGlyZWN0aW9uLmxlZnRfbWFudWFsLmxhYmVsLCBmYWxzZSk7CiAgICAgICAgdXBkYXRlX2xhYmVsKG1hbnVhbF9kaXJlY3Rpb24ucmlnaHRfbWFudWFsLmxhYmVsLCBmYWxzZSk7CiAgICAgICAgdXBkYXRlX2xhYmVsKG1hbnVhbF9kaXJlY3Rpb24uZm9yd2FyZF9tYW51YWwubGFiZWwsIGZhbHNlKTsKICAgIGVuZAoKICAgIG1hbnVhbF9kaXJlY3Rpb24uZW5hYmxlZCA9IG1lbnUubmV3X2l0ZW0odWlfbmV3X2NoZWNrYm94LCAiQUEiLCAiT3RoZXIiLCAiTWFudWFsIGRpcmVjdGlvbiIpCiAgICA6IHJlY29yZCgiYWEiLCAibWFudWFsX2RpcmVjdGlvbjo6ZW5hYmxlZCIpOwoKICAgIG1hbnVhbF9kaXJlY3Rpb24ub3B0aW9ucyA9IG1lbnUubmV3X2l0ZW0odWlfbmV3X211bHRpc2VsZWN0LCAiQUEiLCAiT3RoZXIiLCBtZXJnZSB7ICIgwrsgIiwgIk9wdGlvbnMiLCAiXG4iLCAibWFudWFsX2RpcmVjdGlvbjo6b3B0aW9ucyIgfSwgewogICAgICAgICJEaXNhYmxlIHlhdyBtb2RpZmllcnMiLAogICAgICAgICJGcmVlc3RhbmRpbmcgYm9keSB5YXciCiAgICB9KQogICAgOiByZWNvcmQoImFhIiwgIm1hbnVhbF9kaXJlY3Rpb246Om9wdGlvbnMiKQogICAgOiBzYXZlKCk7CgogICAgbWFudWFsX2RpcmVjdGlvbi5sZWZ0X21hbnVhbCA9IHsKICAgICAgICBsYWJlbCA9IG1lbnUubmV3X2l0ZW0odWlfbmV3X2xhYmVsLCAiQUEiLCAiT3RoZXIiLCBtZXJnZSB7ICIgwrsgIiwgIkxlZnQgbWFudWFsIiB9KSwKCiAgICAgICAgaG90a2V5ID0gbWVudS5uZXdfaXRlbSh1aV9uZXdfaG90a2V5LCAiQUEiLCAiT3RoZXIiLCBtZXJnZSB7ICJcbiIsICJsZWZ0X21hbnVhbDo6aG90a2V5IiB9LCB0cnVlKQogICAgICAgIDogcmVjb3JkKCJhYSIsICJtYW51YWxfZGlyZWN0aW9uOjpsZWZ0X21hbnVhbDo6aG90a2V5IikKICAgIH07CgogICAgbWFudWFsX2RpcmVjdGlvbi5yaWdodF9tYW51YWwgPSB7CiAgICAgICAgbGFiZWwgPSBtZW51Lm5ld19pdGVtKHVpX25ld19sYWJlbCwgIkFBIiwgIk90aGVyIiwgbWVyZ2UgeyAiIMK7ICIsICJSaWdodCBtYW51YWwiIH0pLAoKICAgICAgICBob3RrZXkgPSBtZW51Lm5ld19pdGVtKHVpX25ld19ob3RrZXksICJBQSIsICJPdGhlciIsIG1lcmdlIHsgIlxuIiwgInJpZ2h0X21hbnVhbDo6aG90a2V5IiB9LCB0cnVlKQogICAgICAgIDogcmVjb3JkKCJhYSIsICJtYW51YWxfZGlyZWN0aW9uOjpyaWdodF9tYW51YWw6OmhvdGtleSIpCiAgICB9OwoKICAgIG1hbnVhbF9kaXJlY3Rpb24ucmVzZXRfbWFudWFsID0gewogICAgICAgIGxhYmVsID0gbWVudS5uZXdfaXRlbSh1aV9uZXdfbGFiZWwsICJBQSIsICJPdGhlciIsIG1lcmdlIHsgIiDCuyAiLCAiUmVzZXQgbWFudWFsIiB9KSwKCiAgICAgICAgaG90a2V5ID0gbWVudS5uZXdfaXRlbSh1aV9uZXdfaG90a2V5LCAiQUEiLCAiT3RoZXIiLCBtZXJnZSB7ICJcbiIsICJyZXNldF9tYW51YWw6OmhvdGtleSIgfSwgdHJ1ZSkKICAgICAgICA6IHJlY29yZCgiYWEiLCAibWFudWFsX2RpcmVjdGlvbjo6cmVzZXRfbWFudWFsOjpob3RrZXkiKQogICAgfTsKCiAgICBtYW51YWxfZGlyZWN0aW9uLmZvcndhcmRfbWFudWFsID0gewogICAgICAgIGxhYmVsID0gbWVudS5uZXdfaXRlbSh1aV9uZXdfbGFiZWwsICJBQSIsICJPdGhlciIsIG1lcmdlIHsgIiDCuyAiLCAiRm9yd2FyZCBtYW51YWwiIH0pLAoKICAgICAgICBob3RrZXkgPSBtZW51Lm5ld19pdGVtKHVpX25ld19ob3RrZXksICJBQSIsICJPdGhlciIsIG1lcmdlIHsgIlxuIiwgImZvcndhcmRfbWFudWFsOjpob3RrZXkiIH0sIHRydWUpCiAgICAgICAgOiByZWNvcmQoImFhIiwgIm1hbnVhbF9kaXJlY3Rpb246OmZvcndhcmRfbWFudWFsOjpob3RrZXkiKQogICAgfTsKCiAgICBmdW5jdGlvbiBtYW51YWxfZGlyZWN0aW9uLmdldCgpCiAgICAgICAgcmV0dXJuIGlkeDsKICAgIGVuZAoKICAgIGZ1bmN0aW9uIG1hbnVhbF9kaXJlY3Rpb24uZnJhbWUoKQogICAgICAgIGxvY2FsIG9sZCA9IGlkeDsKICAgICAgICB0aGluaygpOwoKICAgICAgICBsb2NhbCBuZXcgPSBpZHg7CiAgICAgICAgZHJhdyhvbGQsIG5ldyk7CiAgICBlbmQKCiAgICBmdW5jdGlvbiBtYW51YWxfZGlyZWN0aW9uLnVwZGF0ZShjdHgpCiAgICAgICAgaWYgaWR4ID09IG5pbCB0aGVuCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgb2Zmc2V0ID0gZGlyZWN0aW9uc1tpZHhdOwoKICAgICAgICBpZiBvZmZzZXQgPT0gbmlsIHRoZW4KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGVuZAoKICAgICAgICBpZiBjdHgueWF3X29mZnNldCA9PSBuaWwgdGhlbgogICAgICAgICAgICBjdHgueWF3X29mZnNldCA9IDA7CiAgICAgICAgZW5kCgogICAgICAgIGN0eC55YXdfYmFzZSA9ICJMb2NhbCB2aWV3IjsKICAgICAgICBjdHgueWF3X29mZnNldCA9IGN0eC55YXdfb2Zmc2V0ICsgb2Zmc2V0OwoKICAgICAgICBpZiBtYW51YWxfZGlyZWN0aW9uLm9wdGlvbnM6aGF2ZV9rZXkoIkRpc2FibGUgeWF3IG1vZGlmaWVycyIpIHRoZW4KICAgICAgICAgICAgY3R4LnlhdyA9ICIxODAiOwogICAgICAgICAgICBjdHgueWF3X29mZnNldCA9IG9mZnNldDsKCiAgICAgICAgICAgIGN0eC55YXdfaml0dGVyID0gIk9mZiI7CiAgICAgICAgZW5kCgogICAgICAgIGlmIG1hbnVhbF9kaXJlY3Rpb24ub3B0aW9uczpoYXZlX2tleSgiRnJlZXN0YW5kaW5nIGJvZHkgeWF3IikgdGhlbgogICAgICAgICAgICBjdHguYm9keV95YXcgPSAiU3RhdGljIjsKICAgICAgICAgICAgY3R4LmJvZHlfeWF3X29mZnNldCA9IDEyMDsKCiAgICAgICAgICAgIGN0eC5mcmVlc3RhbmRpbmdfYm9keV95YXcgPSB0cnVlOwogICAgICAgIGVuZAoKICAgICAgICBjdHguZWRnZV95YXcgPSBmYWxzZTsKICAgICAgICBjdHguZnJlZXN0YW5kaW5nID0gZmFsc2U7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgZW5kCmVuZAoKLS0tIHJlZ2lvbiBhdm9pZF9iYWNrc3RhYgpkbwogICAgbG9jYWwgQVZPSURfQkFDS1NUQUJfTUFYX0RJU1RBTkNFX1NRUiA9IDE5MiAqIDE5MjsKCiAgICBsb2NhbCBmdW5jdGlvbiBnZXRfZW5lbWllc193aXRoX2tuaWZlKCkKICAgICAgICBsb2NhbCBlbmVtaWVzID0gZW50aXR5X2dldF9wbGF5ZXJzKHRydWUpOwogICAgICAgIGlmIGVtcHR5KGVuZW1pZXMpIHRoZW4gcmV0dXJuIHsgfSBlbmQKCiAgICAgICAgbG9jYWwgbGlzdCA9IHsgfTsKCiAgICAgICAgZm9yIGkgPSAxLCAjZW5lbWllcyBkbwogICAgICAgICAgICBsb2NhbCBlbmVteSA9IGVuZW1pZXNbaV07CiAgICAgICAgICAgIGxvY2FsIHdwbiA9IGVudGl0eV9nZXRfcGxheWVyX3dlYXBvbihlbmVteSk7CgogICAgICAgICAgICBpZiB3cG4gPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIGdvdG8gY29udGludWU7CiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgd3BuX2NsYXNzID0gZW50aXR5X2dldF9jbGFzc25hbWUod3BuKTsKCiAgICAgICAgICAgIGlmIHdwbl9jbGFzcyA9PSAiQ0tuaWZlIiB0aGVuCiAgICAgICAgICAgICAgICBsaXN0WyNsaXN0ICsgMV0gPSBlbmVteTsKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICA6OmNvbnRpbnVlOjoKICAgICAgICBlbmQKCiAgICAgICAgcmV0dXJuIGxpc3Q7CiAgICBlbmQKCiAgICBsb2NhbCBmdW5jdGlvbiBnZXRfY2xvc2VzdF90YXJnZXQobWUpCiAgICAgICAgbG9jYWwgdGFyZ2V0cyA9IGdldF9lbmVtaWVzX3dpdGhfa25pZmUoKTsKICAgICAgICBpZiBlbXB0eSh0YXJnZXRzKSB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgbG9jYWwgYmVzdF9kZWx0YTsKICAgICAgICBsb2NhbCBiZXN0X3RhcmdldDsKCiAgICAgICAgbG9jYWwgbXlfb3JpZ2luID0gdmVjdG9yKGVudGl0eV9nZXRfb3JpZ2luKG1lKSk7CiAgICAgICAgbG9jYWwgYmVzdF9kaXN0YW5jZSA9IEFWT0lEX0JBQ0tTVEFCX01BWF9ESVNUQU5DRV9TUVI7CgogICAgICAgIGZvciBpID0gMSwgI3RhcmdldHMgZG8KICAgICAgICAgICAgbG9jYWwgdGFyZ2V0ID0gdGFyZ2V0c1tpXTsKCiAgICAgICAgICAgIGxvY2FsIG9yaWdpbiA9IHZlY3RvcihlbnRpdHlfZ2V0X29yaWdpbih0YXJnZXQpKTsKICAgICAgICAgICAgbG9jYWwgZGVsdGEgPSBvcmlnaW4gLSBteV9vcmlnaW47CgogICAgICAgICAgICBsb2NhbCBkaXN0YW5jZSA9IGRlbHRhOmxlbmd0aHNxcigpOwoKICAgICAgICAgICAgaWYgZGlzdGFuY2UgPCBiZXN0X2Rpc3RhbmNlIHRoZW4KICAgICAgICAgICAgICAgIGJlc3RfZGVsdGEgPSBkZWx0YTsKICAgICAgICAgICAgICAgIGJlc3RfdGFyZ2V0ID0gdGFyZ2V0OwoKICAgICAgICAgICAgICAgIGJlc3RfZGlzdGFuY2UgPSBkaXN0YW5jZTsKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIHJldHVybiBiZXN0X3RhcmdldCwgYmVzdF9kZWx0YTsKICAgIGVuZAoKICAgIGF2b2lkX2JhY2tzdGFiLmVuYWJsZWQgPSBtZW51Lm5ld19pdGVtKHVpX25ld19jaGVja2JveCwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJBdm9pZCBiYWNrc3RhYiIpCiAgICA6IHJlY29yZCgiYWEiLCAiYXZvaWRfYmFja3N0YWI6OmVuYWJsZWQiKQogICAgOiBzYXZlKCk7CgogICAgZnVuY3Rpb24gYXZvaWRfYmFja3N0YWIudXBkYXRlKGN0eCkKICAgICAgICBpZiBub3QgYXZvaWRfYmFja3N0YWIuZW5hYmxlZDpnZXQoKSB0aGVuCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgbWUgPSBlbnRpdHlfZ2V0X2xvY2FsX3BsYXllcigpOwogICAgICAgIGxvY2FsIHRhcmdldCwgZGVsdGEgPSBnZXRfY2xvc2VzdF90YXJnZXQobWUpOwoKICAgICAgICBpZiB0YXJnZXQgPT0gbmlsIHRoZW4gcmV0dXJuIGVuZAogICAgICAgIGlmIGRlbHRhID09IG5pbCB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgbG9jYWwgdmlldyA9IHZlY3RvcihjbGllbnRfY2FtZXJhX2FuZ2xlcygpKTsKICAgICAgICBsb2NhbCBhbmdsZSA9IHZlY3RvcihkZWx0YTphbmdsZXMoKSk7CgogICAgICAgIGxvY2FsIHlhdyA9IGFuZ2xlLnkgLSB2aWV3LnkgKyAxODA7CgogICAgICAgIGlmIGN0eC55YXdfb2Zmc2V0ID09IG5pbCB0aGVuCiAgICAgICAgICAgIGN0eC55YXdfb2Zmc2V0ID0gMDsKICAgICAgICBlbmQKCiAgICAgICAgY3R4Lnlhd19iYXNlID0gIkxvY2FsIHZpZXciOwogICAgICAgIGN0eC55YXdfb2Zmc2V0ID0gY3R4Lnlhd19vZmZzZXQgKyB5YXc7CgogICAgICAgIGN0eC5lZGdlX3lhdyA9IGZhbHNlOwogICAgICAgIGN0eC5mcmVlc3RhbmRpbmcgPSBmYWxzZTsKICAgIGVuZAplbmQKCi0tLSByZWdpb24gc2FmZV9oZWFkCmRvCiAgICBzYWZlX2hlYWQuZW5hYmxlZCA9IG1lbnUubmV3X2l0ZW0odWlfbmV3X2NoZWNrYm94LCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIlNhZmUgaGVhZCIpCiAgICA6IHJlY29yZCgiYWEiLCAic2FmZV9oZWFkOjplbmFibGVkIikKICAgIDogc2F2ZSgpOwoKICAgIGZ1bmN0aW9uIHNhZmVfaGVhZC51cGRhdGUoY3R4KQogICAgICAgIGlmIG5vdCBzYWZlX2hlYWQuZW5hYmxlZDpnZXQoKSB0aGVuCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgbWUgPSBlbnRpdHlfZ2V0X2xvY2FsX3BsYXllcigpOwogICAgICAgIGxvY2FsIHRocmVhZCA9IGNsaWVudF9jdXJyZW50X3RocmVhdCgpOwoKICAgICAgICBpZiB0aHJlYWQgPT0gbmlsIHRoZW4KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBlc3BfZGF0YSA9IGVudGl0eV9nZXRfZXNwX2RhdGEodGhyZWFkKTsKCiAgICAgICAgaWYgZXNwX2RhdGEgPT0gbmlsIHRoZW4KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICBpZiBiaXRfYmFuZChlc3BfZGF0YS5mbGFncywgRVNQX0ZMQUdTLkhJVCkgPT0gMCB0aGVuCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgbXlfZXllcyA9IHZlY3Rvcih1dGlscy5nZXRfZXllX3Bvc2l0aW9uKG1lKSk7CiAgICAgICAgbG9jYWwgdGhyZWFkX2V5ZXMgPSB2ZWN0b3IodXRpbHMuZ2V0X2V5ZV9wb3NpdGlvbih0aHJlYWQpKTsKCiAgICAgICAgbG9jYWwgZGVsdGEgPSBteV9leWVzIC0gdGhyZWFkX2V5ZXM7CgogICAgICAgIGlmIGRlbHRhLnogPCAyMCB0aGVuCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKCiAgICAgICAgY3R4LnBpdGNoID0gIkRlZmF1bHQiOwogICAgICAgIGN0eC55YXdfYmFzZSA9ICJBdCB0YXJnZXRzIjsKCiAgICAgICAgY3R4LnlhdyA9ICIxODAiOwogICAgICAgIGN0eC55YXdfb2Zmc2V0ID0gMjI7CgogICAgICAgIGN0eC55YXdfaml0dGVyID0gIk9mZiI7CgogICAgICAgIGN0eC5ib2R5X3lhdyA9ICJTdGF0aWMiOwogICAgICAgIGN0eC5ib2R5X3lhd19vZmZzZXQgPSAxMjA7CgogICAgICAgIGN0eC5mcmVlc3RhbmRpbmdfYm9keV95YXcgPSBmYWxzZTsKICAgIGVuZAplbmQKCi0tLSByZWdpb24gYnJlYWtfbGMKZG8KICAgIGxvY2FsIGZ1bmN0aW9uIGdldF9zdGF0ZSgpCiAgICAgICAgaWYgbG9jYWxwbGF5ZXIuaXNfYWlyYm9ybmUgdGhlbgogICAgICAgICAgICByZXR1cm4gIkFpcmJvcm5lIjsKICAgICAgICBlbmQKCiAgICAgICAgaWYgbG9jYWxwbGF5ZXIuaXNfY3JvdWNoZWQgdGhlbgogICAgICAgICAgICByZXR1cm4gIkNyb3VjaGVkIjsKICAgICAgICBlbmQKCiAgICAgICAgaWYgbG9jYWxwbGF5ZXIuaXNfbW92aW5nIHRoZW4KICAgICAgICAgICAgaWYgc29mdHdhcmUuaXNfc2xvd19tb3Rpb24oKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gIlNsb3ctbW90aW9uIjsKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICByZXR1cm4gIk1vdmluZyI7CiAgICAgICAgZW5kCgogICAgICAgIHJldHVybiAiU3RhbmRpbmciCiAgICBlbmQKCiAgICBicmVha19sYy5lbmFibGVkID0gbWVudS5uZXdfaXRlbSh1aV9uZXdfY2hlY2tib3gsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQnJlYWsgTEMiKQogICAgOiByZWNvcmQoImFhIiwgImJyZWFrX2xjOjplbmFibGVkIikKICAgIDogc2F2ZSgpOwoKICAgIGJyZWFrX2xjLnN0YXRlcyA9IG1lbnUubmV3X2l0ZW0odWlfbmV3X211bHRpc2VsZWN0LCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgbWVyZ2UgeyAiIMK7ICIsICJTdGF0ZXMiLCAiXG4iLCAiYnJlYWtfbGM6OnN0YXRlcyIgfSwgewogICAgICAgICJTdGFuZGluZyIsCiAgICAgICAgIk1vdmluZyIsCiAgICAgICAgIlNsb3ctbW90aW9uIiwKICAgICAgICAiQ3JvdWNoZWQiLAogICAgICAgICJBaXJib3JuZSIKICAgIH0pCiAgICA6IHJlY29yZCgiYWEiLCAiYnJlYWtfbGM6OnN0YXRlcyIpCiAgICA6IHNhdmUoKTsKCiAgICBmdW5jdGlvbiBicmVha19sYy50aGluayhlKQogICAgICAgIGlmIG5vdCBicmVha19sYy5lbmFibGVkOmdldCgpIHRoZW4KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICBpZiBub3QgZXhwbG9pdC5nZXQoKS5zaGlmdCB0aGVuCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgc3RhdGUgPSBnZXRfc3RhdGUoKTsKCiAgICAgICAgaWYgbm90IGJyZWFrX2xjLnN0YXRlczpoYXZlX2tleShzdGF0ZSkgdGhlbgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgZW5kCgogICAgICAgIGUuZm9yY2VfZGVmZW5zaXZlID0gMTsKICAgIGVuZAplbmQKCi0tLSByZWdpb24gZGVmZW5zaXZlCmRvCiAgICBsb2NhbCBmdW5jdGlvbiBnZXRfc3RhdGUoKQogICAgICAgIGlmIGxvY2FscGxheWVyLmlzX2FpcmJvcm5lIHRoZW4KICAgICAgICAgICAgcmV0dXJuICJBaXJib3JuZSI7CiAgICAgICAgZW5kCgogICAgICAgIGlmIGxvY2FscGxheWVyLmlzX2Nyb3VjaGVkIHRoZW4KICAgICAgICAgICAgcmV0dXJuICJDcm91Y2hlZCI7CiAgICAgICAgZW5kCgogICAgICAgIGlmIGxvY2FscGxheWVyLmlzX21vdmluZyB0aGVuCiAgICAgICAgICAgIGlmIHNvZnR3YXJlLmlzX3Nsb3dfbW90aW9uKCkgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuICJTbG93LW1vdGlvbiI7CiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuICJNb3ZpbmciOwogICAgICAgIGVuZAoKICAgICAgICByZXR1cm4gIlN0YW5kaW5nIgogICAgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gaXNfc3RhdGVfYWN0aXZlKCkKICAgICAgICBsb2NhbCBzdGF0ZSA9IGdldF9zdGF0ZSgpOwoKICAgICAgICBpZiBub3QgZGVmZW5zaXZlLnN0YXRlczpoYXZlX2tleShzdGF0ZSkgdGhlbgogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgZW5kCgogICAgICAgIHJldHVybiB0cnVlOwogICAgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gaXNfdGFyZ2V0X3ZhbGlkKCkKICAgICAgICBsb2NhbCB0aHJlYXQgPSBjbGllbnRfY3VycmVudF90aHJlYXQoKTsKCiAgICAgICAgaWYgdGhyZWF0ID09IG5pbCB0aGVuCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBwbGF5ZXJfcmVzb3VyY2UgPSBlbnRpdHlfZ2V0X3BsYXllcl9yZXNvdXJjZSgpOwogICAgICAgIGxvY2FsIG1faVBpbmcgPSBlbnRpdHlfZ2V0X3Byb3AocGxheWVyX3Jlc291cmNlLCAibV9pUGluZyIsIHRocmVhdCk7CgogICAgICAgIGlmIG1faVBpbmcgPT0gMCB0aGVuCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGVuZAoKICAgICAgICBpZiBtX2lQaW5nID4gZGVmZW5zaXZlLnBpbmdfdGFyZ2V0OmdldCgpIHRoZW4KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgZW5kCgogICAgICAgIHJldHVybiBmYWxzZTsKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIGlzX2V4cGxvaXRfYWN0aXZlKCkKICAgICAgICBpZiBzb2Z0d2FyZS5pc19kb3VibGVfdGFwKCkgdGhlbgogICAgICAgICAgICByZXR1cm4gZGVmZW5zaXZlLmV4cGxvaXQ6aGF2ZV9rZXkoIkRvdWJsZSB0YXAiKTsKICAgICAgICBlbmQKCiAgICAgICAgaWYgc29mdHdhcmUuaXNfb25fc2hvdF9hbnRpYWltKCkgdGhlbgogICAgICAgICAgICByZXR1cm4gZGVmZW5zaXZlLmV4cGxvaXQ6aGF2ZV9rZXkoIk9uIHNob3QgYW50aS1haW0iKTsKICAgICAgICBlbmQKCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gaXNfZGVmZW5zaXZlX2FjdGl2ZSgpCiAgICAgICAgbG9jYWwgZGF0YSA9IGV4cGxvaXQuZ2V0KCkuZGVmZW5zaXZlOwoKICAgICAgICBsb2NhbCB0aWNrID0gZ2xvYmFsc190aWNrY291bnQoKTsKICAgICAgICBsb2NhbCBzZW5zaXRpdml0eSA9IGRlZmVuc2l2ZS5zZW5zaXRpdml0eTpnZXQoKTsKCiAgICAgICAgbG9jYWwgZHVyYXRpb24gPSBkYXRhLmR1cmF0aW9uOwogICAgICAgIGR1cmF0aW9uID0gZHVyYXRpb24gKiAoc2Vuc2l0aXZpdHkgKiAwLjAxKTsKCiAgICAgICAgaWYgdGljayA+IChkYXRhLmJlZ2luICsgZHVyYXRpb24pIHRoZW4KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGVuZAoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIGVuZAoKICAgIGRlZmVuc2l2ZS5lbmFibGVkID0gbWVudS5uZXdfaXRlbSh1aV9uZXdfY2hlY2tib3gsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiRGVmZW5zaXZlIikKICAgIDogcmVjb3JkKCJhYSIsICJkZWZlbnNpdmU6OmVuYWJsZWQiKQogICAgOiBzYXZlKCk7CgogICAgZGVmZW5zaXZlLnN0YXRlcyA9IG1lbnUubmV3X2l0ZW0odWlfbmV3X211bHRpc2VsZWN0LCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgbWVyZ2UgeyAiIMK7ICIsICJTdGF0ZXMiLCAiXG4iLCAiZGVmZW5zaXZlOjpzdGF0ZXMiIH0sIHsKICAgICAgICAiU3RhbmRpbmciLAogICAgICAgICJNb3ZpbmciLAogICAgICAgICJTbG93LW1vdGlvbiIsCiAgICAgICAgIkNyb3VjaGVkIiwKICAgICAgICAiQWlyYm9ybmUiLAogICAgICAgICJPbiBwZWVrIgogICAgfSkKICAgIDogcmVjb3JkKCJhYSIsICJkZWZlbnNpdmU6OnN0YXRlcyIpCiAgICA6IHNhdmUoKTsKCiAgICBkZWZlbnNpdmUuZXhwbG9pdCA9IG1lbnUubmV3X2l0ZW0odWlfbmV3X211bHRpc2VsZWN0LCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgbWVyZ2UgeyAiIMK7ICIsICJFeHBsb2l0IiwgIlxuIiwgImRlZmVuc2l2ZTo6ZXhwbG9pdCIgfSwgewogICAgICAgICJPbiBzaG90IGFudGktYWltIiwKICAgICAgICAiRG91YmxlIHRhcCIKICAgIH0pCiAgICA6IHJlY29yZCgiYWEiLCAiZGVmZW5zaXZlOjpleHBsb2l0IikKICAgIDogc2F2ZSgpOwoKICAgIGRlZmVuc2l2ZS5zZW5zaXRpdml0eSA9IG1lbnUubmV3X2l0ZW0odWlfbmV3X3NsaWRlciwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsIG1lcmdlIHsgIiDCuyAiLCAiU2Vuc2l0aXZpdHkgKGR1cmF0aW9uKSIsICJcbiIsICJkZWZlbnNpdmU6OnNlbnNpdGl2aXR5IiB9LCAxLCAxMDAsIDEwMCwgdHJ1ZSwgIiUiKQogICAgOiByZWNvcmQoImFhIiwgImRlZmVuc2l2ZTo6c2Vuc2l0aXZpdHkiKQogICAgOiBzYXZlKCk7CgogICAgZGVmZW5zaXZlLnBpbmdfdGFyZ2V0ID0gbWVudS5uZXdfaXRlbSh1aV9uZXdfc2xpZGVyLCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgbWVyZ2UgeyAiIMK7ICIsICJQaW5nIHRhcmdldCAoZ3JlYXRlciB0aGFuKSIsICJcbiIsICJkZWZlbnNpdmU6OnBpbmdfdGFyZ2V0IiB9LCAwLCAyMDAsIDIwLCB0cnVlLCAibXMiKQogICAgOiByZWNvcmQoImFhIiwgImRlZmVuc2l2ZTo6cGluZ190YXJnZXQiKQogICAgOiBzYXZlKCk7CgogICAgZnVuY3Rpb24gZGVmZW5zaXZlLnVwZGF0ZShjdHgpCiAgICAgICAgaWYgbm90IGRlZmVuc2l2ZS5lbmFibGVkOmdldCgpIHRoZW4KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICBpZiBub3QgaXNfdGFyZ2V0X3ZhbGlkKCkgb3Igbm90IGlzX3N0YXRlX2FjdGl2ZSgpIHRoZW4KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICBpZiBub3QgaXNfZXhwbG9pdF9hY3RpdmUoKSBvciBub3QgaXNfZGVmZW5zaXZlX2FjdGl2ZSgpIHRoZW4KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICBhbmdsZXMuc2V0KGN0eCwgIkRlZmVuc2l2ZSIpOwogICAgZW5kCmVuZAoKLS0tIHJlZ2lvbiBpbmRpY2F0ZV9zdGF0ZQpkbwogICAgbG9jYWwgdHJhZGl0aW9uYWwgPSB7IH07IGRvCiAgICAgICAgbG9jYWwgbGFzdF9zdGF0ZSA9ICJTVEFURSI7CgogICAgICAgIGxvY2FsIGFscGhhID0gMC4wOwogICAgICAgIGxvY2FsIGFsaWduID0gMC4wOwoKICAgICAgICBsb2NhbCBzdGF0ZW1lbnRfYWxwaGEgPSAwLjA7CiAgICAgICAgbG9jYWwgc3RhdGVtZW50X3ZhbHVlID0gMC4wOwoKICAgICAgICBsb2NhbCBkbWdfYWxwaGEgPSAwLjA7CiAgICAgICAgbG9jYWwgZG1nX3ZhbHVlID0gMC4wOwoKICAgICAgICBsb2NhbCBkdF9hbHBoYSA9IDAuMDsKICAgICAgICBsb2NhbCBkdF92YWx1ZSA9IDAuMDsKCiAgICAgICAgbG9jYWwgb3NhYV9hbHBoYSA9IDAuMDsKICAgICAgICBsb2NhbCBvc2FhX3ZhbHVlID0gMC4wOwoKICAgICAgICBsb2NhbCBmc19hbHBoYSA9IDAuMDsKICAgICAgICBsb2NhbCBmc192YWx1ZSA9IDAuMDsKCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gZ2V0X3N0YXRlKCkKICAgICAgICAgICAgaWYgbG9jYWxwbGF5ZXIuaXNfZnJvemVuIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiAiRlJPWkVOIjsKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBsb2NhbHBsYXllci5pc19haXJib3JuZSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gIkFJUkJPUk5FIjsKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBsb2NhbHBsYXllci5pc19jcm91Y2hlZCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gIkNST1VDSCI7CiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgbG9jYWxwbGF5ZXIuaXNfbW92aW5nIHRoZW4KICAgICAgICAgICAgICAgIGlmIHNvZnR3YXJlLmlzX3Nsb3dfbW90aW9uKCkgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybiAiU0xPVy1NTyI7CiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICByZXR1cm4gIk1PVklORyI7CiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuICJTVEFORCI7CiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIGZ1bmN0aW9uIHVwZGF0ZV9nbG9iYWxfYW5pbWF0aW9ucygpCiAgICAgICAgICAgIGlmIGluZGljYXRlX3N0YXRlLnNlbGVjdGlvbjpnZXQoKSB+PSAiVHJhZGl0aW9uYWwiIHRoZW4KICAgICAgICAgICAgICAgIGFscGhhID0gbW90aW9uLmludGVycChhbHBoYSwgMC4wLCAwLjA1KTsKICAgICAgICAgICAgICAgIGFsaWduID0gbW90aW9uLmludGVycChhbGlnbiwgMS4wLCAwLjA1KTsKCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgbWUgPSBlbnRpdHlfZ2V0X2xvY2FsX3BsYXllcigpOwogICAgICAgICAgICBpZiBtZSA9PSBuaWwgdGhlbiByZXR1cm4gZW5kCgogICAgICAgICAgICBsb2NhbCB3cG4gPSBlbnRpdHlfZ2V0X3BsYXllcl93ZWFwb24obWUpOwogICAgICAgICAgICBsb2NhbCBtX2JJc1Njb3BlZCA9IGVudGl0eV9nZXRfcHJvcChtZSwgIm1fYklzU2NvcGVkIik7CgogICAgICAgICAgICBsb2NhbCB0YXJnZXRfYWxwaGEgPSAwLjA7CiAgICAgICAgICAgIGxvY2FsIHRhcmdldF9hbGlnbiA9IDAuMDsKCiAgICAgICAgICAgIGlmIGVudGl0eV9pc19hbGl2ZShtZSkgdGhlbgogICAgICAgICAgICAgICAgdGFyZ2V0X2FscGhhID0gMS4wOwogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIC0tIGlmIHdlYXBvbiBpcyBncmVuYWRlCgogICAgICAgICAgICBpZiB3cG4gfj0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIHdwbl9pbmZvID0gY193ZWFwb24od3BuKTsKCiAgICAgICAgICAgICAgICBpZiB3cG5faW5mby53ZWFwb25fdHlwZV9pbnQgPT0gOSB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgaW5kaWNhdGVfc3RhdGUudHJhbnNwYXJlbmN5OmhhdmVfa2V5KCJHcmVuYWRlIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRfYWxwaGEgPSAwLjI1OwogICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRfYWxpZ24gPSAwLjA7CiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBtX2JJc1Njb3BlZCA9PSAxIHRoZW4KICAgICAgICAgICAgICAgIGlmIGluZGljYXRlX3N0YXRlLnRyYW5zcGFyZW5jeTpoYXZlX2tleSgiU2NvcGVkIikgdGhlbgogICAgICAgICAgICAgICAgICAgIHRhcmdldF9hbHBoYSA9IDAuNzU7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X2FsaWduID0gMS4wOwogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgYWxwaGEgPSBtb3Rpb24uaW50ZXJwKGFscGhhLCB0YXJnZXRfYWxwaGEsIDAuMDUpOwogICAgICAgICAgICBhbGlnbiA9IG1vdGlvbi5pbnRlcnAoYWxpZ24sIHRhcmdldF9hbGlnbiwgMC4wNSk7CiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIGZ1bmN0aW9uIHVwZGF0ZV9mZWF0dXJlX2FuaW1hdGlvbnMoKQogICAgICAgICAgICBpZiBhbHBoYSA9PSAwLjAgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIHNoaWZ0ID0gZXhwbG9pdC5nZXQoKS5zaGlmdDsKICAgICAgICAgICAgbG9jYWwgc3RhdGUgPSBnZXRfc3RhdGUoKTsKCiAgICAgICAgICAgIHN0YXRlbWVudF9hbHBoYSA9IG1vdGlvbi5pbnRlcnAoc3RhdGVtZW50X2FscGhhLCB0cnVlLCAwLjA1KTsKICAgICAgICAgICAgc3RhdGVtZW50X3ZhbHVlID0gbW90aW9uLmludGVycChzdGF0ZW1lbnRfdmFsdWUsIHN0YXRlID09IGxhc3Rfc3RhdGUsIDAuMDc1KTsKCiAgICAgICAgICAgIGRtZ19hbHBoYSA9IG1vdGlvbi5pbnRlcnAoZG1nX2FscGhhLCBzb2Z0d2FyZS5pc19taW5pbXVtX2RhbWFnZSgpLCAwLjA1KTsKICAgICAgICAgICAgZG1nX3ZhbHVlID0gbW90aW9uLmludGVycChkbWdfdmFsdWUsIHRydWUsIDAuMDUpOwoKICAgICAgICAgICAgZHRfYWxwaGEgPSBtb3Rpb24uaW50ZXJwKGR0X2FscGhhLCBzb2Z0d2FyZS5pc19kb3VibGVfdGFwKCksIDAuMDUpOwogICAgICAgICAgICBkdF92YWx1ZSA9IG1vdGlvbi5pbnRlcnAoZHRfdmFsdWUsIHNoaWZ0LCAwLjA1KTsKCiAgICAgICAgICAgIG9zYWFfYWxwaGEgPSBtb3Rpb24uaW50ZXJwKG9zYWFfYWxwaGEsIHNvZnR3YXJlLmlzX29uX3Nob3RfYW50aWFpbSgpLCAwLjA1KTsKICAgICAgICAgICAgb3NhYV92YWx1ZSA9IG1vdGlvbi5pbnRlcnAob3NhYV92YWx1ZSwgc2hpZnQgb3IgZHRfYWxwaGEgPiAwLjAsIDAuMDUpOwoKICAgICAgICAgICAgZnNfYWxwaGEgPSBtb3Rpb24uaW50ZXJwKGZzX2FscGhhLCB1aV9nZXQoc29mdHdhcmUuYWEuYW5nbGVzLmZyZWVzdGFuZGluZ1syXSksIDAuMDUpOwogICAgICAgICAgICBmc192YWx1ZSA9IG1vdGlvbi5pbnRlcnAoZnNfdmFsdWUsIHVpX2dldChzb2Z0d2FyZS5hYS5hbmdsZXMuZnJlZXN0YW5kaW5nWzFdKSwgMC4wNSk7CgogICAgICAgICAgICBpZiBzdGF0ZW1lbnRfdmFsdWUgPCAwLjEgdGhlbgogICAgICAgICAgICAgICAgbGFzdF9zdGF0ZSA9IHN0YXRlOwogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gdHJhZGl0aW9uYWwudGhpbmsoKQogICAgICAgICAgICB1cGRhdGVfZ2xvYmFsX2FuaW1hdGlvbnMoKTsKICAgICAgICAgICAgdXBkYXRlX2ZlYXR1cmVfYW5pbWF0aW9ucygpOwogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiB0cmFkaXRpb25hbC5kcmF3KCkKICAgICAgICAgICAgaWYgYWxwaGEgPT0gMC4wIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBjbG9jayA9IGdsb2JhbHNfcmVhbHRpbWUoKSAqIDEuMjU7CgogICAgICAgICAgICBsb2NhbCBzY3JlZW4gPSB2ZWN0b3IoY2xpZW50X3NjcmVlbl9zaXplKCkpOwogICAgICAgICAgICBsb2NhbCBwb3NpdGlvbiA9IHNjcmVlbiAqIDAuNTsKCiAgICAgICAgICAgIGxvY2FsIHIwLCBnMCwgYjAsIGEwID0gNzEsIDcxLCA3MSwgMjU1OwogICAgICAgICAgICBsb2NhbCByMSwgZzEsIGIxLCBhMSA9IHZpc3VhbGl6YXRpb24uY29sb3JfcGlja2VyOmdldCgpOwoKICAgICAgICAgICAgYTEgPSBtYXhmKGExLCA1NSk7CiAgICAgICAgICAgIGEwID0gYTE7CgogICAgICAgICAgICBwb3NpdGlvbi54ID0gcG9zaXRpb24ueCArIHJvdW5kKDEwICogYWxpZ24pOwogICAgICAgICAgICBwb3NpdGlvbi55ID0gcG9zaXRpb24ueSArIDE4OwoKICAgICAgICAgICAgZG8KICAgICAgICAgICAgICAgIGxvY2FsIHRleHRfcG9zID0gcG9zaXRpb246Y2xvbmUoKTsKICAgICAgICAgICAgICAgIGxvY2FsIHRleHRfYWxwaGEgPSBhbHBoYTsKCiAgICAgICAgICAgICAgICBsb2NhbCB0ZXh0ID0gInNlbmtvdGVjaCI7CiAgICAgICAgICAgICAgICBsb2NhbCBmbGFncyA9ICJkYiI7CgogICAgICAgICAgICAgICAgbG9jYWwgciwgZywgYiwgYSA9IHIxLCBnMSwgYjEsIGExOwoKICAgICAgICAgICAgICAgIGxvY2FsIG1lYXN1cmUgPSB2ZWN0b3IocmVuZGVyZXJfbWVhc3VyZV90ZXh0KGZsYWdzLCB0ZXh0KSk7CiAgICAgICAgICAgICAgICBsb2NhbCBvZmZzZXQgPSAobWVhc3VyZS54ICogMC41KSAqICgxIC0gYWxpZ24pOwoKICAgICAgICAgICAgICAgIHRleHRfcG9zLnggPSByb3VuZCh0ZXh0X3Bvcy54IC0gb2Zmc2V0KTsKCiAgICAgICAgICAgICAgICB0ZXh0ID0gZGVjb3JhdGlvbnMud2F2ZSh0ZXh0LCBjbG9jaywgcjEsIGcxLCBiMSwgYTEgKiB0ZXh0X2FscGhhLCByMCwgZzAsIGIwLCBhMCAqIHRleHRfYWxwaGEpOwogICAgICAgICAgICAgICAgcmVuZGVyZXJfdGV4dCh0ZXh0X3Bvcy54LCB0ZXh0X3Bvcy55LCByLCBnLCBiLCBhICogYWxwaGEsIGZsYWdzLCAwLCB0ZXh0KTsKCiAgICAgICAgICAgICAgICBwb3NpdGlvbi55ID0gcG9zaXRpb24ueSArIG1lYXN1cmUueTsKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBzdGF0ZW1lbnRfYWxwaGEgPiAwLjAgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgdGV4dF9wb3MgPSBwb3NpdGlvbjpjbG9uZSgpOwogICAgICAgICAgICAgICAgbG9jYWwgdGV4dF9hbHBoYSA9IGFscGhhICogc3RhdGVtZW50X2FscGhhOwoKICAgICAgICAgICAgICAgIGxvY2FsIHRleHQgPSBsYXN0X3N0YXRlOwogICAgICAgICAgICAgICAgbG9jYWwgZmxhZ3MgPSAiLWQiOwoKICAgICAgICAgICAgICAgIGxvY2FsIHIsIGcsIGIsIGEgPSByMSwgZzEsIGIxLCBhMTsKCiAgICAgICAgICAgICAgICBsb2NhbCBtZWFzdXJlID0gdmVjdG9yKHJlbmRlcmVyX21lYXN1cmVfdGV4dChmbGFncywgdGV4dCkpOwogICAgICAgICAgICAgICAgbG9jYWwgb2Zmc2V0ID0gKG1lYXN1cmUueCAqIDAuNSkgKiAoMSAtIGFsaWduKTsKCiAgICAgICAgICAgICAgICB0ZXh0X3Bvcy54ID0gcm91bmQodGV4dF9wb3MueCAtIG9mZnNldCkgLSAxOwoKICAgICAgICAgICAgICAgIHRleHQgPSBkZWNvcmF0aW9ucy5mYWRlKHRleHQsIHN0YXRlbWVudF92YWx1ZSwgcjEsIGcxLCBiMSwgYTEgKiB0ZXh0X2FscGhhLCByMCwgZzAsIGIwLCBhMCAqIHRleHRfYWxwaGEpOwogICAgICAgICAgICAgICAgcmVuZGVyZXJfdGV4dCh0ZXh0X3Bvcy54LCB0ZXh0X3Bvcy55LCByLCBnLCBiLCBhICogdGV4dF9hbHBoYSwgZmxhZ3MsIDAsIHRleHQpOwoKICAgICAgICAgICAgICAgIHBvc2l0aW9uLnkgPSBwb3NpdGlvbi55ICsgcm91bmQobWVhc3VyZS55ICogc3RhdGVtZW50X2FscGhhKTsKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBkbWdfYWxwaGEgPiAwLjAgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgdGV4dF9wb3MgPSBwb3NpdGlvbjpjbG9uZSgpOwogICAgICAgICAgICAgICAgbG9jYWwgdGV4dF9hbHBoYSA9IGFscGhhICogZG1nX2FscGhhOwoKICAgICAgICAgICAgICAgIGxvY2FsIHRleHQgPSAiRE1HIjsKICAgICAgICAgICAgICAgIGxvY2FsIGZsYWdzID0gIi1kIjsKCiAgICAgICAgICAgICAgICBsb2NhbCByLCBnLCBiLCBhID0gcjEsIGcxLCBiMSwgYTE7CgogICAgICAgICAgICAgICAgbG9jYWwgbWVhc3VyZSA9IHZlY3RvcihyZW5kZXJlcl9tZWFzdXJlX3RleHQoZmxhZ3MsIHRleHQpKTsKICAgICAgICAgICAgICAgIGxvY2FsIG9mZnNldCA9IChtZWFzdXJlLnggKiAwLjUpICogKDEgLSBhbGlnbik7CgogICAgICAgICAgICAgICAgdGV4dF9wb3MueCA9IHJvdW5kKHRleHRfcG9zLnggLSBvZmZzZXQpIC0gMTsKCiAgICAgICAgICAgICAgICB0ZXh0ID0gZGVjb3JhdGlvbnMuZmFkZSh0ZXh0LCBkbWdfdmFsdWUsIHIxLCBnMSwgYjEsIGExICogdGV4dF9hbHBoYSwgcjAsIGcwLCBiMCwgYTAgKiB0ZXh0X2FscGhhKTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyX3RleHQodGV4dF9wb3MueCwgdGV4dF9wb3MueSwgciwgZywgYiwgYSAqIHRleHRfYWxwaGEsIGZsYWdzLCAwLCB0ZXh0KTsKCiAgICAgICAgICAgICAgICBwb3NpdGlvbi55ID0gcG9zaXRpb24ueSArIHJvdW5kKG1lYXN1cmUueSAqIGRtZ19hbHBoYSk7CiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgZHRfYWxwaGEgPiAwLjAgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgdGV4dF9wb3MgPSBwb3NpdGlvbjpjbG9uZSgpOwogICAgICAgICAgICAgICAgbG9jYWwgdGV4dF9hbHBoYSA9IGFscGhhICogZHRfYWxwaGE7CgogICAgICAgICAgICAgICAgbG9jYWwgdGV4dCA9ICJEVCI7CiAgICAgICAgICAgICAgICBsb2NhbCBmbGFncyA9ICItZCI7CgogICAgICAgICAgICAgICAgbG9jYWwgciwgZywgYiwgYSA9IHIxLCBnMSwgYjEsIGExOwoKICAgICAgICAgICAgICAgIGxvY2FsIG1lYXN1cmUgPSB2ZWN0b3IocmVuZGVyZXJfbWVhc3VyZV90ZXh0KGZsYWdzLCB0ZXh0KSk7CgogICAgICAgICAgICAgICAgbG9jYWwgcmFkaXVzID0gcm91bmQobWVhc3VyZS55ICogMC4zMyk7CiAgICAgICAgICAgICAgICBsb2NhbCB0aGlja25lc3MgPSByb3VuZChyYWRpdXMgKiAwLjI1KTsKCiAgICAgICAgICAgICAgICBsb2NhbCBnYXAgPSA0OwogICAgICAgICAgICAgICAgbG9jYWwgbWFyZ2luID0gcmFkaXVzICsgZ2FwOwoKICAgICAgICAgICAgICAgIGxvY2FsIG9mZnNldCA9IChtZWFzdXJlLnggKyBtYXJnaW4pICogKDAuNSkgKiAoMSAtIGFsaWduKTsKCiAgICAgICAgICAgICAgICB0ZXh0X3Bvcy54ID0gcm91bmQodGV4dF9wb3MueCAtIG9mZnNldCkgLSAxOwoKICAgICAgICAgICAgICAgIHRleHQgPSBkZWNvcmF0aW9ucy5mYWRlKHRleHQsIGR0X3ZhbHVlLCByMSwgZzEsIGIxLCBhMSAqIHRleHRfYWxwaGEsIHIwLCBnMCwgYjAsIGEwICogdGV4dF9hbHBoYSk7CiAgICAgICAgICAgICAgICByZW5kZXJlcl90ZXh0KHRleHRfcG9zLngsIHRleHRfcG9zLnksIHIsIGcsIGIsIGEgKiB0ZXh0X2FscGhhLCBmbGFncywgMCwgdGV4dCk7CgogICAgICAgICAgICAgICAgdGV4dF9wb3MueCA9IHRleHRfcG9zLnggKyBtZWFzdXJlLng7CiAgICAgICAgICAgICAgICByZW5kZXJlcl9jaXJjbGVfb3V0bGluZSh0ZXh0X3Bvcy54ICsgbWFyZ2luLCB0ZXh0X3Bvcy55ICsgbWVhc3VyZS55ICogMC41LCByLCBnLCBiLCBhICogdGV4dF9hbHBoYSwgcmFkaXVzLCAxODAsIGR0X3ZhbHVlLCB0aGlja25lc3MpOwoKICAgICAgICAgICAgICAgIHBvc2l0aW9uLnkgPSBwb3NpdGlvbi55ICsgcm91bmQobWVhc3VyZS55ICogZHRfYWxwaGEpOwogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIG9zYWFfYWxwaGEgPiAwLjAgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgdGV4dF9wb3MgPSBwb3NpdGlvbjpjbG9uZSgpOwogICAgICAgICAgICAgICAgbG9jYWwgdGV4dF9hbHBoYSA9IGFscGhhICogb3NhYV9hbHBoYTsKCiAgICAgICAgICAgICAgICBsb2NhbCB0ZXh0ID0gIk9TQUEiOwogICAgICAgICAgICAgICAgbG9jYWwgZmxhZ3MgPSAiLWQiOwoKICAgICAgICAgICAgICAgIGxvY2FsIHIsIGcsIGIsIGEgPSByMSwgZzEsIGIxLCBhMTsKCiAgICAgICAgICAgICAgICBsb2NhbCBtZWFzdXJlID0gdmVjdG9yKHJlbmRlcmVyX21lYXN1cmVfdGV4dChmbGFncywgdGV4dCkpOwogICAgICAgICAgICAgICAgbG9jYWwgb2Zmc2V0ID0gKG1lYXN1cmUueCAqIDAuNSkgKiAoMSAtIGFsaWduKTsKCiAgICAgICAgICAgICAgICB0ZXh0X3Bvcy54ID0gcm91bmQodGV4dF9wb3MueCAtIG9mZnNldCkgLSAxOwoKICAgICAgICAgICAgICAgIHRleHQgPSBkZWNvcmF0aW9ucy5mYWRlKHRleHQsIG9zYWFfdmFsdWUsIHIxLCBnMSwgYjEsIGExICogdGV4dF9hbHBoYSwgcjAsIGcwLCBiMCwgYTAgKiB0ZXh0X2FscGhhKTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyX3RleHQodGV4dF9wb3MueCwgdGV4dF9wb3MueSwgciwgZywgYiwgYSAqIHRleHRfYWxwaGEsIGZsYWdzLCAwLCB0ZXh0KTsKCiAgICAgICAgICAgICAgICBwb3NpdGlvbi55ID0gcG9zaXRpb24ueSArIHJvdW5kKG1lYXN1cmUueSAqIG9zYWFfYWxwaGEpOwogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIGZzX2FscGhhID4gMC4wIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIHRleHRfcG9zID0gcG9zaXRpb246Y2xvbmUoKTsKICAgICAgICAgICAgICAgIGxvY2FsIHRleHRfYWxwaGEgPSBhbHBoYSAqIGZzX2FscGhhOwoKICAgICAgICAgICAgICAgIGxvY2FsIHRleHQgPSAiRlMiOwogICAgICAgICAgICAgICAgbG9jYWwgZmxhZ3MgPSAiLWQiOwoKICAgICAgICAgICAgICAgIGxvY2FsIHIsIGcsIGIsIGEgPSByMSwgZzEsIGIxLCBhMTsKCiAgICAgICAgICAgICAgICBsb2NhbCBtZWFzdXJlID0gdmVjdG9yKHJlbmRlcmVyX21lYXN1cmVfdGV4dChmbGFncywgdGV4dCkpOwogICAgICAgICAgICAgICAgbG9jYWwgb2Zmc2V0ID0gKG1lYXN1cmUueCAqIDAuNSkgKiAoMSAtIGFsaWduKTsKCiAgICAgICAgICAgICAgICB0ZXh0X3Bvcy54ID0gcm91bmQodGV4dF9wb3MueCAtIG9mZnNldCkgLSAxOwoKICAgICAgICAgICAgICAgIHRleHQgPSBkZWNvcmF0aW9ucy5mYWRlKHRleHQsIGZzX3ZhbHVlLCByMSwgZzEsIGIxLCBhMSAqIHRleHRfYWxwaGEsIHIwLCBnMCwgYjAsIGEwICogdGV4dF9hbHBoYSk7CiAgICAgICAgICAgICAgICByZW5kZXJlcl90ZXh0KHRleHRfcG9zLngsIHRleHRfcG9zLnksIHIsIGcsIGIsIGEgKiB0ZXh0X2FscGhhLCBmbGFncywgMCwgdGV4dCk7CgogICAgICAgICAgICAgICAgcG9zaXRpb24ueSA9IHBvc2l0aW9uLnkgKyByb3VuZChtZWFzdXJlLnkgKiBmc19hbHBoYSk7CiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCgogICAgaW5kaWNhdGVfc3RhdGUuc2VsZWN0aW9uID0gbWVudS5uZXdfaXRlbSh1aV9uZXdfY29tYm9ib3gsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiSW5kaWNhdGUgc3RhdGUiLCB7CiAgICAgICAgIk9mZiIsCiAgICAgICAgIlRyYWRpdGlvbmFsIgogICAgfSkKICAgIDogcmVjb3JkKCJ2aXN1YWxzIiwgImluZGljYXRlX3N0YXRlOjpzZWxlY3Rpb24iKQogICAgOiBzYXZlKCk7CgogICAgaW5kaWNhdGVfc3RhdGUudHJhbnNwYXJlbmN5ID0gbWVudS5uZXdfaXRlbSh1aV9uZXdfbXVsdGlzZWxlY3QsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCBtZXJnZSB7ICIgwrsgIiwgIlRyYW5zcGFyZW5jeSIgfSwgewogICAgICAgICJHcmVuYWRlIiwKICAgICAgICAiU2NvcGVkIgogICAgfSkKICAgIDogcmVjb3JkKCJ2aXN1YWxzIiwgImluZGljYXRlX3N0YXRlOjp0cmFuc3BhcmVuY3kiKQogICAgOiBzYXZlKCk7CgogICAgZnVuY3Rpb24gaW5kaWNhdGVfc3RhdGUuZnJhbWUoKQogICAgICAgIGlmIG5vdCBpZW5naW5lY2xpZW50LmlzX2luX2dhbWUoKSB0aGVuCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKCiAgICAgICAgdHJhZGl0aW9uYWwudGhpbmsoKTsKICAgICAgICB0cmFkaXRpb25hbC5kcmF3KCk7CiAgICBlbmQKZW5kCgotLS0gcmVnaW9uIGNvbm5lY3Rpb25faW5mbwpkbwogICAgbG9jYWwgVElNRU9VVF9MSU1JVCA9IDAuNTsKCiAgICBsb2NhbCBmdW5jdGlvbiBnZXRfdGltZW91dCgpCiAgICAgICAgbG9jYWwgbmV0ID0gaW5ldGNoYW5uZWwuZ2V0KCk7CgogICAgICAgIGlmIG5ldCA9PSBuaWwgdGhlbgogICAgICAgICAgICByZXR1cm4gMC4wOwogICAgICAgIGVuZAoKICAgICAgICBpZiBpbmV0Y2hhbm5lbC5pc19sb29wYmFjayhuZXQpIHRoZW4KICAgICAgICAgICAgcmV0dXJuIDAuMDsKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgbmV0X3RpbWUgPSBpbmV0Y2hhbm5lbC5nZXRfdGltZShuZXQpOwogICAgICAgIGxvY2FsIHRpbWVvdXQgPSBuZXRfdGltZSAtIG5ldC5sYXN0X3JlY2VpdmVkOwoKICAgICAgICBpZiB0aW1lb3V0IDwgVElNRU9VVF9MSU1JVCB0aGVuCiAgICAgICAgICAgIHJldHVybiAwLjA7CiAgICAgICAgZW5kCgogICAgICAgIHJldHVybiB0aW1lb3V0OwogICAgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gZHJhdygpCiAgICAgICAgbG9jYWwgdGltZSA9IGdldF90aW1lb3V0KCk7CgogICAgICAgIGlmIHRpbWUgPT0gMC4wIHRoZW4KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBjbG9jayA9IGdsb2JhbHNfcmVhbHRpbWUoKTsKCiAgICAgICAgbG9jYWwgc2NyZWVuID0gdmVjdG9yKGNsaWVudF9zY3JlZW5fc2l6ZSgpKTsKICAgICAgICBsb2NhbCBwb3MgPSB2ZWN0b3Ioc2NyZWVuLnggKiAwLjUsIHNjcmVlbi55ICogMC4xNzUpOwoKICAgICAgICBsb2NhbCByMCwgZzAsIGIwLCBhMCA9IDcxLCA3MSwgNzEsIDI1NTsKICAgICAgICBsb2NhbCByMSwgZzEsIGIxLCBhMSA9IHZpc3VhbGl6YXRpb24uY29sb3JfcGlja2VyOmdldCgpOwoKICAgICAgICBhMSA9IG1heGYoYTEsIDU1KTsKICAgICAgICBhMCA9IGExOwoKICAgICAgICBsb2NhbCB0ZXh0ID0gZigiVGltZSB3aXRob3V0IGNvbm5lY3Rpb246ICUuMWZzIiwgdGltZSk7CiAgICAgICAgbG9jYWwgZmxhZ3MgPSAiZCI7CgogICAgICAgIGxvY2FsIG1lYXN1cmUgPSB2ZWN0b3IocmVuZGVyZXJfbWVhc3VyZV90ZXh0KGZsYWdzLCB0ZXh0KSk7CiAgICAgICAgcG9zLnggPSBwb3MueCAtIHJvdW5kKG1lYXN1cmUueCAqIDAuNSk7CgogICAgICAgIHRleHQgPSBkZWNvcmF0aW9ucy53YXZlKHRleHQsIGNsb2NrLCByMSwgZzEsIGIxLCBhMSwgcjAsIGcwLCBiMCwgYTApOwogICAgICAgIHJlbmRlcmVyX3RleHQocG9zLngsIHBvcy55LCByMSwgZzEsIGIxLCBhMSwgZmxhZ3MsIDAsIHRleHQpOwogICAgZW5kCgogICAgZnVuY3Rpb24gY29ubmVjdGlvbl9pbmZvLmZyYW1lKCkKICAgICAgICBkcmF3KCk7CiAgICBlbmQKZW5kCgotLS0gcmVnaW9uIGRyb3BfZ3JlbmFkZXMKZG8KICAgIGxvY2FsIGdyZW5hZGVfbGlzdCA9IHsKICAgICAgICAiU21va2UiLAogICAgICAgICJIaWdoIGV4cGxvc2l2ZSIsCiAgICAgICAgIk1vbG90b3YvSW5jZW5kaWFyeSIKICAgIH07CgogICAgbG9jYWwgcXVldWUgPSB7IH07CiAgICBsb2NhbCBwcmV2X3dwbjsKCiAgICBsb2NhbCBwcmV2X3ZhbHVlID0geyB1bnBhY2soZ3JlbmFkZV9saXN0KSB9OwoKICAgIGxvY2FsIGZ1bmN0aW9uIGlzX2FsbG93ZWRfY2xhc3MoaXRlbV9jbGFzcykKICAgICAgICBpZiBpdGVtX2NsYXNzID09ICJ3ZWFwb25fc21va2VncmVuYWRlIiB0aGVuCiAgICAgICAgICAgIHJldHVybiBkcm9wX2dyZW5hZGVzLnNlbGVjdGlvbjpoYXZlX2tleSgiU21va2UiKTsKICAgICAgICBlbmQKCiAgICAgICAgaWYgaXRlbV9jbGFzcyA9PSAid2VhcG9uX2hlZ3JlbmFkZSIgdGhlbgogICAgICAgICAgICByZXR1cm4gZHJvcF9ncmVuYWRlcy5zZWxlY3Rpb246aGF2ZV9rZXkoIkhpZ2ggZXhwbG9zaXZlIik7CiAgICAgICAgZW5kCgogICAgICAgIGlmIGl0ZW1fY2xhc3MgPT0gIndlYXBvbl9pbmNncmVuYWRlIiBvciBpdGVtX2NsYXNzID09ICJ3ZWFwb25fbW9sb3RvdiIgdGhlbgogICAgICAgICAgICByZXR1cm4gZHJvcF9ncmVuYWRlcy5zZWxlY3Rpb246aGF2ZV9rZXkoIk1vbG90b3YvSW5jZW5kaWFyeSIpOwogICAgICAgIGVuZAoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICBlbmQKCiAgICBsb2NhbCBmdW5jdGlvbiBpc193ZWFwb25fYWxsb3dlZCh3ZWFwb24pCiAgICAgICAgbG9jYWwgaW5mbyA9IGNfd2VhcG9uKHdlYXBvbik7CgogICAgICAgIGlmIGluZm8ud2VhcG9uX3R5cGVfaW50IH49IDkgdGhlbgogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgZW5kCgogICAgICAgIGlmIG5vdCBpc19hbGxvd2VkX2NsYXNzKGluZm8uaXRlbV9jbGFzcykgdGhlbgogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgZW5kCgogICAgICAgIHJldHVybiB0cnVlOwogICAgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gdXBkYXRlX3F1ZXVlKGVudCkKICAgICAgICBsb2NhbCB3ZWFwb25zID0gdXRpbHMuZ2V0X3BsYXllcl93ZWFwb25zKGVudCk7CgogICAgICAgIGZvciBpID0gMSwgI3dlYXBvbnMgZG8KICAgICAgICAgICAgbG9jYWwgd2VhcG9uID0gd2VhcG9uc1tpXTsKCiAgICAgICAgICAgIGlmIG5vdCBpc193ZWFwb25fYWxsb3dlZCh3ZWFwb24pIHRoZW4KICAgICAgICAgICAgICAgIGdvdG8gY29udGludWU7CiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcXVldWVbI3F1ZXVlICsgMV0gPSB3ZWFwb247CiAgICAgICAgICAgIDo6Y29udGludWU6OgogICAgICAgIGVuZAogICAgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gc2VsZWN0aW9uX2NhbGxiYWNrKGl0ZW0pCiAgICAgICAgbG9jYWwgbmV3X3ZhbHVlID0gdWlfZ2V0KGl0ZW0pOwoKICAgICAgICBpZiBlbXB0eShuZXdfdmFsdWUpIHRoZW4KICAgICAgICAgICAgdWlfc2V0KGl0ZW0sIHByZXZfdmFsdWUpOwogICAgICAgICAgICBkcm9wX2dyZW5hZGVzLnNlbGVjdGlvbjp1cGRhdGVfdmFsdWUoaXRlbSk7CgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgZW5kCgogICAgICAgIHByZXZfdmFsdWUgPSBuZXdfdmFsdWU7CiAgICBlbmQKCiAgICBkcm9wX2dyZW5hZGVzLmVuYWJsZWQgPSBtZW51Lm5ld19pdGVtKHVpX25ld19jaGVja2JveCwgIkFBIiwgIk90aGVyIiwgIkRyb3AgZ3JlbmFkZXMiKQogICAgOiByZWNvcmQoIm1pc2MiLCAiZHJvcF9ncmVuYWRlczo6ZW5hYmxlZCIpOwoKICAgIGRyb3BfZ3JlbmFkZXMuaG90a2V5ID0gbWVudS5uZXdfaXRlbSh1aV9uZXdfaG90a2V5LCAiQUEiLCAiT3RoZXIiLCBtZXJnZSB7ICJcbiIsICJkcm9wX2dyZW5hZGVzOjpob3RrZXkiIH0sIHRydWUpCiAgICA6IHJlY29yZCgibWlzYyIsICJkcm9wX2dyZW5hZGVzOjpob3RrZXkiKTsKCiAgICBkcm9wX2dyZW5hZGVzLnNlbGVjdGlvbiA9IG1lbnUubmV3X2l0ZW0odWlfbmV3X211bHRpc2VsZWN0LCAiQUEiLCAiT3RoZXIiLCBtZXJnZSB7ICIgwrsgIiwgIlNlbGVjdGlvbiIsICJcbiIsICJkcm9wX2dyZW5hZGVzOjpzZWxlY3Rpb24iIH0sIGdyZW5hZGVfbGlzdCkKICAgIDogcmVjb3JkKCJtaXNjIiwgImRyb3BfZ3JlbmFkZXM6OnNlbGVjdGlvbiIpOwoKICAgIGZ1bmN0aW9uIGRyb3BfZ3JlbmFkZXMuc2V0dXBfY29tbWFuZChlKQogICAgICAgIGlmIG5vdCBkcm9wX2dyZW5hZGVzLmVuYWJsZWQ6Z2V0KCkgdGhlbgogICAgICAgICAgICBjbGVhcihxdWV1ZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgbWUgPSBlbnRpdHlfZ2V0X2xvY2FsX3BsYXllcigpOwoKICAgICAgICBsb2NhbCB3cG4gPSBlbnRpdHlfZ2V0X3BsYXllcl93ZWFwb24obWUpOwogICAgICAgIGlmIHdwbiA9PSBuaWwgdGhlbiByZXR1cm4gZW5kCgogICAgICAgIGlmIGRyb3BfZ3JlbmFkZXMuaG90a2V5OnJhd2dldCgpIHRoZW4KICAgICAgICAgICAgY2xlYXIocXVldWUpOwogICAgICAgICAgICB1cGRhdGVfcXVldWUobWUpOwogICAgICAgIGVuZAoKICAgICAgICBpZiBlbXB0eShxdWV1ZSkgdGhlbgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIHdhbnRlZF93ZWFwb24gPSBxdWV1ZVsxXTsKCiAgICAgICAgaWYgd2FudGVkX3dlYXBvbiA9PSBuaWwgdGhlbgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgZW5kCgogICAgICAgIGlmIHdwbiA9PSB3YW50ZWRfd2VhcG9uIHRoZW4KICAgICAgICAgICAgbG9jYWwgcGl0Y2gsIHlhdyA9IGNsaWVudF9jYW1lcmFfYW5nbGVzKCk7CgogICAgICAgICAgICAtLSAwLjAwMDEgaXMgZm9yIG1ha2luZyBhIGRpZmZlcmVuY2UgaW4gcGl0Y2ggZm9yIHNrZWV0CiAgICAgICAgICAgIC0tIG90aGVyd2lzZSBpdCB3aWxsIG5vdCBkaXNhYmxlIGFudGlhaW0gYW5kIHdpbGwgbm90IHNldHVwIG91ciBhbmdsZXMKICAgICAgICAgICAgbG9jYWwgb2Zmc2V0ID0gMC4wMDAxOwoKICAgICAgICAgICAgaWYgcGl0Y2ggPiAwIHRoZW4KICAgICAgICAgICAgICAgIG9mZnNldCA9IC1vZmZzZXQ7CiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgZS55YXcgPSB5YXc7CiAgICAgICAgICAgIGUucGl0Y2ggPSBwaXRjaCArIG9mZnNldDsKCiAgICAgICAgICAgIGlmIHdwbiA9PSBwcmV2X3dwbiB0aGVuCiAgICAgICAgICAgICAgICBlLm5vX2Nob2tlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGUuYWxsb3dfc2VuZF9wYWNrZXQgPSB0cnVlOwoKICAgICAgICAgICAgICAgIGlmIGUuY2hva2VkY29tbWFuZHMgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgY2xpZW50X2V4ZWMoImRyb3AiKTsKICAgICAgICAgICAgICAgICAgICB0YWJsZV9yZW1vdmUocXVldWUsIDEpOwogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBlLndlYXBvbnNlbGVjdCA9IHdhbnRlZF93ZWFwb247CiAgICAgICAgcHJldl93cG4gPSB3cG47CiAgICBlbmQKCiAgICBkcm9wX2dyZW5hZGVzLnNlbGVjdGlvbjpzZXQocHJldl92YWx1ZSk7CiAgICBkcm9wX2dyZW5hZGVzLnNlbGVjdGlvbjpzZXRfY2FsbGJhY2soc2VsZWN0aW9uX2NhbGxiYWNrKTsKZW5kCgotLS0gcmVnaW9uIHF1aWNrX2xhZGRlcl9tb3ZlCmRvCiAgICBsb2NhbCBmdW5jdGlvbiBpc19vbl9sYWRkZXIoKQogICAgICAgIGlmIGxvY2FscGxheWVyLm1vdmV0eXBlIH49IDkgdGhlbgogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgZW5kCgogICAgICAgIGlmIGxvY2FscGxheWVyLmlzX29uZ3JvdW5kIHRoZW4KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGVuZAoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIGlzX3Rocm93aW5nX2dyZW5hZGUod3BuKQogICAgICAgIGxvY2FsIHdwbl9pbmZvID0gY193ZWFwb24od3BuKTsKCiAgICAgICAgaWYgd3BuX2luZm8ud2VhcG9uX3R5cGVfaW50IH49IDkgdGhlbgogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIG1fZlRocm93VGltZSA9IGVudGl0eV9nZXRfcHJvcCh3cG4sICJtX2ZUaHJvd1RpbWUiKTsKCiAgICAgICAgaWYgbV9mVGhyb3dUaW1lID09IDAgdGhlbgogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgZW5kCgogICAgICAgIHJldHVybiB0cnVlOwogICAgZW5kCgogICAgcXVpY2tfbGFkZGVyX21vdmUuZW5hYmxlZCA9IG1lbnUubmV3X2l0ZW0odWlfbmV3X2NoZWNrYm94LCAiQUEiLCAiT3RoZXIiLCAiUXVpY2sgbGFkZGVyIG1vdmUiKQogICAgOiByZWNvcmQoIm1pc2MiLCAicXVpY2tfbGFkZGVyX21vdmU6OmVuYWJsZWQiKTsKCiAgICBmdW5jdGlvbiBxdWlja19sYWRkZXJfbW92ZS5zZXR1cF9jb21tYW5kKGUpCiAgICAgICAgaWYgbm90IHF1aWNrX2xhZGRlcl9tb3ZlLmVuYWJsZWQ6Z2V0KCkgdGhlbgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIG1lID0gZW50aXR5X2dldF9sb2NhbF9wbGF5ZXIoKTsKCiAgICAgICAgaWYgbm90IGlzX29uX2xhZGRlcigpIHRoZW4KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCB3cG4gPSBlbnRpdHlfZ2V0X3BsYXllcl93ZWFwb24obWUpOwogICAgICAgIGlmIHdwbiA9PSBuaWwgdGhlbiByZXR1cm4gZW5kCgogICAgICAgIGlmIGlzX3Rocm93aW5nX2dyZW5hZGUod3BuKSB0aGVuCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgZm9yd2FyZCA9IHZlY3RvcihlbnRpdHlfZ2V0X3Byb3AobWUsICJtX3ZlY0xhZGRlck5vcm1hbCIpKTsKICAgICAgICBpZiBmb3J3YXJkOmxlbmd0aHNxcigpID09IDAgdGhlbiByZXR1cm4gZW5kCgogICAgICAgIGxvY2FsIHZpZXcgPSB2ZWN0b3IoY2xpZW50X2NhbWVyYV9hbmdsZXMoKSk7CiAgICAgICAgbG9jYWwgYW5nbGUgPSB2ZWN0b3IoZm9yd2FyZDphbmdsZXMoKSk7CgogICAgICAgIGxvY2FsIGRlbHRhX3lhdyA9IGFuZ2xlLnkgLSB2aWV3LnkgKyAxODA7CiAgICAgICAgbG9jYWwgZGVsdGFfcGl0Y2ggPSBhbmdsZS54IC0gdmlldy54OwoKICAgICAgICBkZWx0YV95YXcgPSB1dGlscy5ub3JtYWxpemVfeWF3KGRlbHRhX3lhdyk7CiAgICAgICAgZGVsdGFfcGl0Y2ggPSBjbGFtcChkZWx0YV9waXRjaCwgLTg5LCA4OSk7CgogICAgICAgIGxvY2FsIGFic195YXcgPSBhYnNmKGRlbHRhX3lhdyk7CgogICAgICAgIGxvY2FsIHBpdGNoID0gODk7CiAgICAgICAgbG9jYWwgeWF3X29mZnNldCA9IC05MDsKCiAgICAgICAgbG9jYWwgaXNfbG9va2luZ19kb3duID0gZGVsdGFfcGl0Y2ggPCAtNDU7CiAgICAgICAgbG9jYWwgaXNfbG9va2luZ190b19yaWdodCA9IGRlbHRhX3lhdyA+IDA7CgogICAgICAgIGxvY2FsIGlzX3NpZGVtb3ZlID0gZS5zaWRlbW92ZSA+IDA7CiAgICAgICAgbG9jYWwgaXNfZm9yd2FyZG1vdmUgPSBlLmZvcndhcmRtb3ZlID4gMDsKCiAgICAgICAgLS0gc2lkZXdheXMKICAgICAgICBpZiBhYnNfeWF3ID4gNzAgYW5kIGFic195YXcgPCAxMzUgdGhlbgogICAgICAgICAgICBpZiBlLmZvcndhcmRtb3ZlIH49IDAgb3IgZS5zaWRlbW92ZSA9PSAwIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBub3QgaXNfbG9va2luZ190b19yaWdodCB0aGVuCiAgICAgICAgICAgICAgICB5YXdfb2Zmc2V0ID0gLXlhd19vZmZzZXQ7CiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgaXNfbG9va2luZ190b19yaWdodCB0aGVuCiAgICAgICAgICAgICAgICBpc19zaWRlbW92ZSA9IG5vdCBpc19zaWRlbW92ZTsKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBlLmluX2JhY2sgPSBpc19zaWRlbW92ZSBhbmQgMSBvciAwOwogICAgICAgICAgICBlLmluX2ZvcndhcmQgPSBpc19zaWRlbW92ZSBhbmQgMCBvciAxOwoKICAgICAgICAgICAgaWYgaXNfbG9va2luZ190b19yaWdodCB0aGVuCiAgICAgICAgICAgICAgICBpc19zaWRlbW92ZSA9IG5vdCBpc19zaWRlbW92ZTsKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBlLmluX21vdmVsZWZ0ID0gaXNfc2lkZW1vdmUgYW5kIDEgb3IgMDsKICAgICAgICAgICAgZS5pbl9tb3ZlcmlnaHQgPSBpc19zaWRlbW92ZSBhbmQgMCBvciAxOwoKICAgICAgICAgICAgZS5waXRjaCA9IHBpdGNoOwogICAgICAgICAgICBlLnlhdyA9IHV0aWxzLm5vcm1hbGl6ZV95YXcoYW5nbGUueSArIHlhd19vZmZzZXQpOwoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICAtLSBzdHJhaWdodAogICAgICAgIGlmIGUuc2lkZW1vdmUgfj0gMCBvciBlLmZvcndhcmRtb3ZlID09IDAgdGhlbgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgZW5kCgogICAgICAgIGlmIG5vdCBpc19sb29raW5nX3RvX3JpZ2h0IHRoZW4KICAgICAgICAgICAgeWF3X29mZnNldCA9IC15YXdfb2Zmc2V0OwogICAgICAgIGVuZAoKICAgICAgICBpZiBub3QgaXNfbG9va2luZ19kb3duIHRoZW4KICAgICAgICAgICAgaXNfZm9yd2FyZG1vdmUgPSBub3QgaXNfZm9yd2FyZG1vdmU7CiAgICAgICAgZW5kCgogICAgICAgIGUuaW5fYmFjayA9IGlzX2ZvcndhcmRtb3ZlIGFuZCAwIG9yIDE7CiAgICAgICAgZS5pbl9mb3J3YXJkID0gaXNfZm9yd2FyZG1vdmUgYW5kIDEgb3IgMDsKCiAgICAgICAgaWYgbm90IGlzX2xvb2tpbmdfdG9fcmlnaHQgdGhlbgogICAgICAgICAgICBpc19mb3J3YXJkbW92ZSA9IG5vdCBpc19mb3J3YXJkbW92ZTsKICAgICAgICBlbmQKCiAgICAgICAgZS5pbl9tb3ZlbGVmdCA9IGlzX2ZvcndhcmRtb3ZlIGFuZCAxIG9yIDA7CiAgICAgICAgZS5pbl9tb3ZlcmlnaHQgPSBpc19mb3J3YXJkbW92ZSBhbmQgMCBvciAxOwoKICAgICAgICBlLnBpdGNoID0gcGl0Y2g7CiAgICAgICAgZS55YXcgPSB1dGlscy5ub3JtYWxpemVfeWF3KGFuZ2xlLnkgKyB5YXdfb2Zmc2V0KTsKICAgIGVuZAplbmQKCi0tLSByZWdpb24gaGl0c291bmQKZG8KICAgIGxvY2FsIHNvdW5kID0gInN1cnZpdmFsXFxwYXJhZHJvcF9pZGxlXzAxLndhdiI7CgogICAgbG9jYWwgZnVuY3Rpb24gcGxheXNvdW5kKCkKICAgICAgICBsb2NhbCB2b2x1bWUgPSBoaXRzb3VuZC52b2x1bWU6Z2V0KCkgKiAwLjAxOwogICAgICAgIGxvY2FsIHBpdGNoID0gaGl0c291bmQucGl0Y2g6Z2V0KCk7CgogICAgICAgIGllbmdpbmVzb3VuZC5wbGF5c291bmQoc291bmQsIHZvbHVtZSwgcGl0Y2gpOwogICAgZW5kCgogICAgaGl0c291bmQuZW5hYmxlZCA9IG1lbnUubmV3X2l0ZW0odWlfbmV3X2NoZWNrYm94LCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIkhpdCBzb3VuZCIpCiAgICA6IHJlY29yZCgibWlzYyIsICJoaXRzb3VuZDo6ZW5hYmxlZCIpOwoKICAgIGhpdHNvdW5kLnZvbHVtZSA9IG1lbnUubmV3X2l0ZW0odWlfbmV3X3NsaWRlciwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsIG1lcmdlIHsgIiDCuyAiLCAiVm9sdW1lIiwgIlxuIiwgImhpdHNvdW5kOjp2b2x1bWUiIH0sIDEsIDEwMCwgNTAsIHRydWUsICIlIikKICAgIDogcmVjb3JkKCJtaXNjIiwgImhpdHNvdW5kOjp2b2x1bWU6OnZvbHVtZSIpOwoKICAgIGhpdHNvdW5kLnBpdGNoID0gbWVudS5uZXdfaXRlbSh1aV9uZXdfc2xpZGVyLCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgbWVyZ2UgeyAiIMK7ICIsICJQaXRjaCIsICJcbiIsICJoaXRzb3VuZDo6cGl0Y2giIH0sIDUwLCAyNTAsIDEwMCwgdHJ1ZSwgIiUiKQogICAgOiByZWNvcmQoIm1pc2MiLCAiaGl0c291bmQ6OnBpdGNoIik7CgogICAgZnVuY3Rpb24gaGl0c291bmQucGxheWVyX2h1cnQoZSkKICAgICAgICBpZiBub3QgaGl0c291bmQuZW5hYmxlZDpnZXQoKSB0aGVuCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgbWUgPSBlbnRpdHlfZ2V0X2xvY2FsX3BsYXllcigpOwoKICAgICAgICBsb2NhbCB1c2VyaWQgPSBjbGllbnRfdXNlcmlkX3RvX2VudGluZGV4KGUudXNlcmlkKTsKICAgICAgICBpZiBtZSA9PSB1c2VyaWQgdGhlbiByZXR1cm4gZW5kCgogICAgICAgIGxvY2FsIGF0dGFja2VyID0gY2xpZW50X3VzZXJpZF90b19lbnRpbmRleChlLmF0dGFja2VyKTsKICAgICAgICBpZiBtZSB+PSBhdHRhY2tlciB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgcGxheXNvdW5kKCk7CiAgICBlbmQKZW5kCgotLS0gcmVnaW9uIGFuaW1hdGlvbl9icmVha2VycwpkbwogICAgYW5pbWF0aW9uX2JyZWFrZXJzLnNlbGVjdGlvbiA9IG1lbnUubmV3X2l0ZW0odWlfbmV3X211bHRpc2VsZWN0LCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIkFuaW1hdGlvbiBicmVha2VycyIsIHsgIk9uZ3JvdW5kIiwgIkFpcmJvcm5lIiwgIlF1aWNrIHBlZWsgYXNzaXN0IiwgIlBpdGNoIHplcm8gb24gbGFuZCIsICJSZW1vdmUgbGVhbiBhbmltYXRpb24iIH0pCiAgICA6IHJlY29yZCgibWlzYyIsICJhbmltYXRpb25fYnJlYWtlcnM6OnNlbGVjdGlvbiIpOwoKICAgIGFuaW1hdGlvbl9icmVha2Vycy5vbmdyb3VuZCA9IG1lbnUubmV3X2l0ZW0odWlfbmV3X2NvbWJvYm94LCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgbWVyZ2UgeyAiIMK7ICIsICJPbmdyb3VuZCBhbmltYXRpb25zIiB9LCB7ICJTdGF0aWMiLCAiSml0dGVyIiwgIldhbGtpbmciIH0pCiAgICA6IHJlY29yZCgibWlzYyIsICJhbmltYXRpb25fYnJlYWtlcnM6Om9uZ3JvdW5kIik7CgogICAgYW5pbWF0aW9uX2JyZWFrZXJzLmFpcmJvcm5lID0gbWVudS5uZXdfaXRlbSh1aV9uZXdfY29tYm9ib3gsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLG1lcmdlIHsgIiDCuyAiLCAiQWlyYm9ybmUgYW5pbWF0aW9ucyIgfSwgeyAiU3RhdGljIiwgIldhbGtpbmciIH0pCiAgICA6IHJlY29yZCgibWlzYyIsICJhbmltYXRpb25fYnJlYWtlcnM6OmFpcmJvcm5lIik7CgogICAgYW5pbWF0aW9uX2JyZWFrZXJzLnF1aWNrX3BlZWtfYXNzaXN0ID0gbWVudS5uZXdfaXRlbSh1aV9uZXdfY29tYm9ib3gsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCBtZXJnZSB7ICIgwrsgIiwgIlF1aWNrIHBlZWsgYXNzaXN0IiB9LCB7ICJPZmYiLCAiQWx3YXlzIHNsaWRlIiwgIk5ldmVyIHNsaWRlIiB9KQogICAgOiByZWNvcmQoIm1pc2MiLCAiYW5pbWF0aW9uX2JyZWFrZXJzOjpxdWlja19wZWVrX2Fzc2lzdCIpOwoKICAgIGxvY2FsIGZ1bmN0aW9uIHNodXRkb3duKCkKICAgICAgICBvdmVycmlkZS51bnNldChzb2Z0d2FyZS5hYS5vdGhlci5sZWdfbW92ZW1lbnQpOwogICAgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gdXBkYXRlX29uZ3JvdW5kX2FuaW1hdGlvbnMobWUpCiAgICAgICAgaWYgbm90IGFuaW1hdGlvbl9icmVha2Vycy5zZWxlY3Rpb246aGF2ZV9rZXkoIk9uZ3JvdW5kIikgdGhlbgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgZW5kCgogICAgICAgIGlmIG5vdCBsb2NhbHBsYXllci5pc19vbmdyb3VuZCB0aGVuCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgdmFsdWUgPSBhbmltYXRpb25fYnJlYWtlcnMub25ncm91bmQ6Z2V0KCk7CgogICAgICAgIGlmIHZhbHVlID09ICJTdGF0aWMiIHRoZW4KICAgICAgICAgICAgZW50aXR5X3NldF9wcm9wKG1lLCAibV9mbFBvc2VQYXJhbWV0ZXIiLCAxLCAwKTsKICAgICAgICAgICAgb3ZlcnJpZGUuc2V0KHNvZnR3YXJlLmFhLm90aGVyLmxlZ19tb3ZlbWVudCwgIkFsd2F5cyBzbGlkZSIpOwoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICBpZiB2YWx1ZSA9PSAiSml0dGVyIiB0aGVuCiAgICAgICAgICAgIGxvY2FsIHRpY2sgPSBnbG9iYWxzX3RpY2tjb3VudCgpOwogICAgICAgICAgICBsb2NhbCBjaG9rZSA9IGdsb2JhbHNfY2hva2VkY29tbWFuZHMoKTsKCiAgICAgICAgICAgIGxvY2FsIGRlbGF5ID0gNTsKCiAgICAgICAgICAgIGlmICh0aWNrICUgZGVsYXkgKiAyKSA+IGRlbGF5IHRoZW4KICAgICAgICAgICAgICAgIGlmIGNob2tlID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgZW50aXR5X3NldF9wcm9wKG1lLCAibV9mbFBvc2VQYXJhbWV0ZXIiLCAxLCAwKTsKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIG92ZXJyaWRlLnNldChzb2Z0d2FyZS5hYS5vdGhlci5sZWdfbW92ZW1lbnQsICJBbHdheXMgc2xpZGUiKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBvdmVycmlkZS5zZXQoc29mdHdhcmUuYWEub3RoZXIubGVnX21vdmVtZW50LCAiTmV2ZXIgc2xpZGUiKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICBpZiB2YWx1ZSA9PSAiV2Fsa2luZyIgdGhlbgogICAgICAgICAgICBlbnRpdHlfc2V0X3Byb3AobWUsICJtX2ZsUG9zZVBhcmFtZXRlciIsIDAsIDcpOwogICAgICAgICAgICBvdmVycmlkZS5zZXQoc29mdHdhcmUuYWEub3RoZXIubGVnX21vdmVtZW50LCAiTmV2ZXIgc2xpZGUiKTsKCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIHVwZGF0ZV9haXJib3JuZV9hbmltYXRpb25zKG1lKQogICAgICAgIGlmIG5vdCBhbmltYXRpb25fYnJlYWtlcnMuc2VsZWN0aW9uOmhhdmVfa2V5KCJBaXJib3JuZSIpIHRoZW4KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICBpZiBsb2NhbHBsYXllci5pc19vbmdyb3VuZCB0aGVuCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgdmFsdWUgPSBhbmltYXRpb25fYnJlYWtlcnMuYWlyYm9ybmU6Z2V0KCk7CgogICAgICAgIGlmIHZhbHVlID09ICJTdGF0aWMiIHRoZW4KICAgICAgICAgICAgZW50aXR5X3NldF9wcm9wKG1lLCAibV9mbFBvc2VQYXJhbWV0ZXIiLCAxLCA2KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICBpZiB2YWx1ZSA9PSAiV2Fsa2luZyIgdGhlbgogICAgICAgICAgICBsb2NhbCBteV9pbmZvID0gY19lbnRpdHkobWUpOwogICAgICAgICAgICBpZiBteV9pbmZvID09IG5pbCB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgICAgIGxvY2FsIGFuaW1fb3ZlcmxheSA9IG15X2luZm86Z2V0X2FuaW1fb3ZlcmxheSg2KTsKICAgICAgICAgICAgaWYgYW5pbV9vdmVybGF5ID09IG5pbCB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgICAgIGxvY2FsIG11bHQgPSAwLjUwOwogICAgICAgICAgICBsb2NhbCBjeWNsZSA9IGdsb2JhbHNfcmVhbHRpbWUoKSAqIG11bHQ7CgogICAgICAgICAgICBhbmltX292ZXJsYXkud2VpZ2h0ID0gMS4wOwogICAgICAgICAgICBhbmltX292ZXJsYXkuY3ljbGUgPSBjeWNsZSAlIDEuMDsKCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIHVwZGF0ZV9xdWlja19wZWVrX2FuaW1hdGlvbnMobWUsIGNtZCkKICAgICAgICBpZiBub3QgYW5pbWF0aW9uX2JyZWFrZXJzLnNlbGVjdGlvbjpoYXZlX2tleSgiUXVpY2sgcGVlayBhc3Npc3QiKSB0aGVuCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKCiAgICAgICAgaWYgbm90IHNvZnR3YXJlLmlzX3F1aWNrX3BlZWtfYXNzaXN0KCkgdGhlbgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIHZhbHVlID0gYW5pbWF0aW9uX2JyZWFrZXJzLnF1aWNrX3BlZWtfYXNzaXN0OmdldCgpOwoKICAgICAgICBpZiB2YWx1ZSA9PSAiT2ZmIiB0aGVuCiAgICAgICAgICAgIGxvY2FsIHRhcmdldCA9IHVpX2dldChzb2Z0d2FyZS5hYS5vdGhlci5sZWdfbW92ZW1lbnQpOwoKICAgICAgICAgICAgaWYgdGFyZ2V0ID09ICJOZXZlciBzbGlkZSIgdGhlbgogICAgICAgICAgICAgICAgbGVnX21vdmVtZW50Lm5ldmVyX3NsaWRlKGNtZCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICBpZiB2YWx1ZSA9PSAiQWx3YXlzIHNsaWRlIiB0aGVuCiAgICAgICAgICAgIGxlZ19tb3ZlbWVudC5hbHdheXNfc2xpZGUoY21kKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICBpZiB2YWx1ZSA9PSAiTmV2ZXIgc2xpZGUiIHRoZW4KICAgICAgICAgICAgbGVnX21vdmVtZW50Lm5ldmVyX3NsaWRlKGNtZCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIHVwZGF0ZV9sYW5kX2FuaW1hdGlvbnMobWUpCiAgICAgICAgaWYgbm90IGFuaW1hdGlvbl9icmVha2Vycy5zZWxlY3Rpb246aGF2ZV9rZXkoIlBpdGNoIHplcm8gb24gbGFuZCIpIHRoZW4KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICBpZiBsb2NhbHBsYXllci5pc19haXJib3JuZSB0aGVuCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKCiAgICAgICAgaWYgbm90IGxvY2FscGxheWVyLmlzX2xhbmRpbmcgdGhlbgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgZW5kCgogICAgICAgIGVudGl0eV9zZXRfcHJvcChtZSwgIm1fZmxQb3NlUGFyYW1ldGVyIiwgMC41LCAxMik7CiAgICBlbmQKCiAgICBsb2NhbCBmdW5jdGlvbiB1cGRhdGVfbGVhbl9hbmltYXRpb25zKG1lKQogICAgICAgIGlmIG5vdCBhbmltYXRpb25fYnJlYWtlcnMuc2VsZWN0aW9uOmhhdmVfa2V5KCJSZW1vdmUgbGVhbiBhbmltYXRpb24iKSB0aGVuCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBlbmQKCiAgICAgICAgZW50aXR5X3NldF9wcm9wKG1lLCAibV9mbFBvc2VQYXJhbWV0ZXIiLCAwLCAyKTsKICAgIGVuZAoKICAgIGZ1bmN0aW9uIGFuaW1hdGlvbl9icmVha2Vycy5zaHV0ZG93bigpCiAgICAgICAgc2h1dGRvd24oKTsKICAgIGVuZAoKICAgIGZ1bmN0aW9uIGFuaW1hdGlvbl9icmVha2Vycy5wcmVfcmVuZGVyKCkKICAgICAgICBpZiBub3QgaG9tZS5lbmFibGVkOmdldCgpIHRoZW4KICAgICAgICAgICAgc2h1dGRvd24oKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICBpZiBsb2NhbHBsYXllci5tb3ZldHlwZSB+PSAyIHRoZW4KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBtZSA9IGVudGl0eV9nZXRfbG9jYWxfcGxheWVyKCk7CiAgICAgICAgc2h1dGRvd24oKTsKCiAgICAgICAgdXBkYXRlX29uZ3JvdW5kX2FuaW1hdGlvbnMobWUpOwogICAgICAgIHVwZGF0ZV9haXJib3JuZV9hbmltYXRpb25zKG1lKTsKICAgICAgICB1cGRhdGVfbGFuZF9hbmltYXRpb25zKG1lKTsKICAgICAgICB1cGRhdGVfbGVhbl9hbmltYXRpb25zKG1lKTsKICAgIGVuZAoKICAgIGZ1bmN0aW9uIGFuaW1hdGlvbl9icmVha2Vycy5maW5pc2hfY29tbWFuZChlKQogICAgICAgIGlmIGxvY2FscGxheWVyLm1vdmV0eXBlIH49IDIgdGhlbgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIG1lID0gZW50aXR5X2dldF9sb2NhbF9wbGF5ZXIoKTsKICAgICAgICBsb2NhbCBjbWQgPSBpaW5wdXQuZ2V0X3VzZXJjbWQoMCwgZS5jb21tYW5kX251bWJlcik7CgogICAgICAgIHVwZGF0ZV9xdWlja19wZWVrX2FuaW1hdGlvbnMobWUsIGNtZCk7CiAgICBlbmQKZW5kCgotLS0gdGhyZWFkcwpsb2NhbCBmdW5jdGlvbiBtYWluKCkKICAgIHNldHRpbmdzLmxvYWRfbGFzdF9zYXZlKCk7CiAgICBtZW51LnVwZGF0ZSgpOwplbmQKCmxvY2FsIGZ1bmN0aW9uIG1lbnVfdXBkYXRlKCkKICAgIGhvbWUuZW5hYmxlZDpkaXNwbGF5KCk7CgogICAgaWYgbm90IGhvbWUuZW5hYmxlZDpnZXQoKSB0aGVuCiAgICAgICAgcmV0dXJuOwogICAgZW5kCgogICAgaG9tZS5uZXdfbGluZV9icmVhazpkaXNwbGF5KCk7CgogICAgaG9tZS51c2VybmFtZTpkaXNwbGF5KCk7CiAgICBob21lLmJ1aWxkOmRpc3BsYXkoKTsKICAgIGhvbWUubGFzdF91cGRhdGU6ZGlzcGxheSgpOwoKICAgIGhvbWUuZW5kX2xpbmVfYnJlYWs6ZGlzcGxheSgpOwoKICAgIGhvbWUuc2VsZWN0aW9uOmRpc3BsYXkoKTsKCiAgICBpZiBob21lLnNlbGVjdGlvbjpnZXQoKSA9PSAiLSBQcm9maWxlIiB0aGVuCiAgICAgICAgcHJvZmlsZS5oaWRlX3VzZXJuYW1lOmRpc3BsYXkoKTsKCiAgICAgICAgcHJvZmlsZS5pbXBvcnQ6ZGlzcGxheSgpOwogICAgICAgIHByb2ZpbGUuZXhwb3J0OmRpc3BsYXkoKTsKICAgICAgICBwcm9maWxlLnJlc2V0OmRpc3BsYXkoKTsKICAgIGVuZAoKICAgIGlmIGhvbWUuc2VsZWN0aW9uOmdldCgpID09ICItIEFpbWJvdCIgdGhlbgogICAgICAgIGNvcnJlY3Rpb24uZW5hYmxlZDpkaXNwbGF5KCk7CiAgICBlbmQKCiAgICBpZiBob21lLnNlbGVjdGlvbjpnZXQoKSA9PSAiLSBBbnRpLWFpbWJvdCIgdGhlbgogICAgICAgIC0tIE1haW4KICAgICAgICBhbnRpYWltYm90LnNlbGVjdGlvbjpkaXNwbGF5KCk7CgogICAgICAgIC0tIEZ1bmN0aW9uYWwKICAgICAgICBpZiBhbnRpYWltYm90LnNlbGVjdGlvbjpnZXQoKSA9PSAiLSBNYWluIiB0aGVuCiAgICAgICAgICAgIGF2b2lkX2JhY2tzdGFiLmVuYWJsZWQ6ZGlzcGxheSgpOwogICAgICAgICAgICBzYWZlX2hlYWQuZW5hYmxlZDpkaXNwbGF5KCk7CgogICAgICAgICAgICBicmVha19sYy5lbmFibGVkOmRpc3BsYXkoKTsKICAgICAgICAgICAgZGVmZW5zaXZlLmVuYWJsZWQ6ZGlzcGxheSgpOwoKICAgICAgICAgICAgaWYgYnJlYWtfbGMuZW5hYmxlZDpnZXQoKSB0aGVuCiAgICAgICAgICAgICAgICBicmVha19sYy5zdGF0ZXM6ZGlzcGxheSgpOwogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIGRlZmVuc2l2ZS5lbmFibGVkOmdldCgpIHRoZW4KICAgICAgICAgICAgICAgIGRlZmVuc2l2ZS5zdGF0ZXM6ZGlzcGxheSgpOwogICAgICAgICAgICAgICAgZGVmZW5zaXZlLmV4cGxvaXQ6ZGlzcGxheSgpOwogICAgICAgICAgICAgICAgZGVmZW5zaXZlLnNlbnNpdGl2aXR5OmRpc3BsYXkoKTsKICAgICAgICAgICAgICAgIGRlZmVuc2l2ZS5waW5nX3RhcmdldDpkaXNwbGF5KCk7CiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBpZiBhbnRpYWltYm90LnNlbGVjdGlvbjpnZXQoKSA9PSAiLSBBbmdsZXMiIHRoZW4KICAgICAgICAgICAgYW5nbGVzLnR5cGU6ZGlzcGxheSgpOwoKICAgICAgICAgICAgaWYgYW5nbGVzLnR5cGU6Z2V0KCkgPT0gIkN1c3RvbSIgdGhlbgogICAgICAgICAgICAgICAgYW5nbGVzLmN1c3RvbS5zdGF0ZTpkaXNwbGF5KCk7CgogICAgICAgICAgICAgICAgbG9jYWwgc3RhdGUgPSBhbmdsZXMuY3VzdG9tLnN0YXRlOmdldCgpOwogICAgICAgICAgICAgICAgbG9jYWwgbGlzdCA9IGFuZ2xlcy5jdXN0b21bc3RhdGVdOwoKICAgICAgICAgICAgICAgIGlmIGxpc3QuZW5hYmxlZCB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgICAgIGxpc3QuZW5hYmxlZDpkaXNwbGF5KCk7CgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBsaXN0LmVuYWJsZWQ6Z2V0KCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgbGlzdC5waXRjaCB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIHBpdGNoID0gbGlzdC5waXRjaDpnZXQoKTsKICAgICAgICAgICAgICAgICAgICBsaXN0LnBpdGNoOmRpc3BsYXkoKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgcGl0Y2ggPT0gIkN1c3RvbSIgb3IgcGl0Y2ggPT0gIkFkYXB0aXZlIiBvciBwaXRjaCA9PSAiVXAgJiBEb3duIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QucGl0Y2hfb2Zmc2V0OmRpc3BsYXkoKTsKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIGxpc3QueWF3X2Jhc2Ugfj0gbmlsIHRoZW4KICAgICAgICAgICAgICAgICAgICBsaXN0Lnlhd19iYXNlOmRpc3BsYXkoKTsKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGxvY2FsIHlhd192YWx1ZSA9IGxpc3QueWF3OmdldCgpOwogICAgICAgICAgICAgICAgbGlzdC55YXc6ZGlzcGxheSgpOwoKICAgICAgICAgICAgICAgIGlmIHlhd192YWx1ZSB+PSAiT2ZmIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgeWF3X3ZhbHVlID09ICIxODAgTFIiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbGlzdC55YXdfMTgwbHJfbW9kZTpkaXNwbGF5KCk7CgogICAgICAgICAgICAgICAgICAgICAgICBsaXN0Lnlhd19sZWZ0OmRpc3BsYXkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgbGlzdC55YXdfcmlnaHQ6ZGlzcGxheSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGlzdC55YXdfMTgwbHJfbW9kZTpnZXQoKSA9PSAiU3dpdGNoIGRlbGF5IiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0Lnlhd19zd2l0Y2hfZGVsYXk6ZGlzcGxheSgpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QueWF3X29mZnNldDpkaXNwbGF5KCk7CiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIGxpc3QueWF3X2ppdHRlcjpkaXNwbGF5KCk7CgogICAgICAgICAgICAgICAgICAgIGlmIGxpc3QueWF3X2ppdHRlcjpnZXQoKSB+PSAiT2ZmIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3Quaml0dGVyX21vZGU6ZGlzcGxheSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGlzdC5qaXR0ZXJfbW9kZTpnZXQoKSA9PSAiRGVmYXVsdCIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdC5qaXR0ZXJfb2Zmc2V0OmRpc3BsYXkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3Quaml0dGVyX3JhbmRvbWl6YXRpb246ZGlzcGxheSgpOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0LmppdHRlcl9mcm9tOmRpc3BsYXkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3Quaml0dGVyX3RvOmRpc3BsYXkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBsb2NhbCBib2R5X3lhdyA9IGxpc3QuYm9keV95YXc6Z2V0KCk7CiAgICAgICAgICAgICAgICBsaXN0LmJvZHlfeWF3OmRpc3BsYXkoKTsKCiAgICAgICAgICAgICAgICBpZiBib2R5X3lhdyB+PSAiT2ZmIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgYm9keV95YXcgfj0gIk9wcG9zaXRlIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QuYm9keV95YXdfb2Zmc2V0OmRpc3BsYXkoKTsKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgbGlzdC5mcmVlc3RhbmRpbmdfYm9keV95YXc6ZGlzcGxheSgpOwogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgOjpjb250aW51ZTo6CiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICAtLSBJbXBvcnRhbnQKICAgICAgICB5YXdfZGlyZWN0aW9uLmVuYWJsZWQ6ZGlzcGxheSgpOwogICAgICAgIG1hbnVhbF9kaXJlY3Rpb24uZW5hYmxlZDpkaXNwbGF5KCk7CgogICAgICAgIGlmIHlhd19kaXJlY3Rpb24uZW5hYmxlZDpnZXQoKSB0aGVuCiAgICAgICAgICAgIHlhd19kaXJlY3Rpb24uZWRnZV95YXc6ZGlzcGxheSgpOwogICAgICAgICAgICB5YXdfZGlyZWN0aW9uLmZyZWVzdGFuZGluZzpkaXNwbGF5KCk7CiAgICAgICAgICAgIHlhd19kaXJlY3Rpb24ub3B0aW9uczpkaXNwbGF5KCk7CiAgICAgICAgZW5kCgogICAgICAgIGlmIG1hbnVhbF9kaXJlY3Rpb24uZW5hYmxlZDpnZXQoKSB0aGVuCiAgICAgICAgICAgIG1hbnVhbF9kaXJlY3Rpb24ubGVmdF9tYW51YWwubGFiZWw6ZGlzcGxheSgpOwogICAgICAgICAgICBtYW51YWxfZGlyZWN0aW9uLmxlZnRfbWFudWFsLmhvdGtleTpkaXNwbGF5KCk7CgogICAgICAgICAgICBtYW51YWxfZGlyZWN0aW9uLnJpZ2h0X21hbnVhbC5sYWJlbDpkaXNwbGF5KCk7CiAgICAgICAgICAgIG1hbnVhbF9kaXJlY3Rpb24ucmlnaHRfbWFudWFsLmhvdGtleTpkaXNwbGF5KCk7CgogICAgICAgICAgICBtYW51YWxfZGlyZWN0aW9uLnJlc2V0X21hbnVhbC5sYWJlbDpkaXNwbGF5KCk7CiAgICAgICAgICAgIG1hbnVhbF9kaXJlY3Rpb24ucmVzZXRfbWFudWFsLmhvdGtleTpkaXNwbGF5KCk7CgogICAgICAgICAgICBtYW51YWxfZGlyZWN0aW9uLmZvcndhcmRfbWFudWFsLmxhYmVsOmRpc3BsYXkoKTsKICAgICAgICAgICAgbWFudWFsX2RpcmVjdGlvbi5mb3J3YXJkX21hbnVhbC5ob3RrZXk6ZGlzcGxheSgpOwoKICAgICAgICAgICAgbWFudWFsX2RpcmVjdGlvbi5vcHRpb25zOmRpc3BsYXkoKTsKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGlmIGhvbWUuc2VsZWN0aW9uOmdldCgpID09ICItIFZpc3VhbGlzYXRpb24iIHRoZW4KICAgICAgICB2aXN1YWxpemF0aW9uLnNlbGVjdGlvbjpkaXNwbGF5KCk7CgogICAgICAgIGlmIHZpc3VhbGl6YXRpb24uc2VsZWN0aW9uOmdldCgpID09ICItIE1haW4iIHRoZW4KICAgICAgICAgICAgaW5kaWNhdGVfc3RhdGUuc2VsZWN0aW9uOmRpc3BsYXkoKTsKCiAgICAgICAgICAgIGlmIGluZGljYXRlX3N0YXRlLnNlbGVjdGlvbjpnZXQoKSB+PSAiT2ZmIiB0aGVuCiAgICAgICAgICAgICAgICBpbmRpY2F0ZV9zdGF0ZS50cmFuc3BhcmVuY3k6ZGlzcGxheSgpOwogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgdmlzdWFsaXphdGlvbi5jb2xvcl9sYWJlbDpkaXNwbGF5KCk7CiAgICAgICAgdmlzdWFsaXphdGlvbi5jb2xvcl9waWNrZXI6ZGlzcGxheSgpOwogICAgZW5kCgogICAgaWYgaG9tZS5zZWxlY3Rpb246Z2V0KCkgPT0gIi0gTWlzY2VsbGFuZW91cyIgdGhlbgogICAgICAgIC0tIE1haW4KICAgICAgICBhbmltYXRpb25fYnJlYWtlcnMuc2VsZWN0aW9uOmRpc3BsYXkoKTsKICAgICAgICBoaXRzb3VuZC5lbmFibGVkOmRpc3BsYXkoKTsKCiAgICAgICAgLS0gRnVuY3Rpb25hbAogICAgICAgIGlmIGFuaW1hdGlvbl9icmVha2Vycy5zZWxlY3Rpb246aGF2ZV9rZXkoIk9uZ3JvdW5kIikgdGhlbgogICAgICAgICAgICBhbmltYXRpb25fYnJlYWtlcnMub25ncm91bmQ6ZGlzcGxheSgpOwogICAgICAgIGVuZAoKICAgICAgICBpZiBhbmltYXRpb25fYnJlYWtlcnMuc2VsZWN0aW9uOmhhdmVfa2V5KCJBaXJib3JuZSIpIHRoZW4KICAgICAgICAgICAgYW5pbWF0aW9uX2JyZWFrZXJzLmFpcmJvcm5lOmRpc3BsYXkoKTsKICAgICAgICBlbmQKCiAgICAgICAgaWYgYW5pbWF0aW9uX2JyZWFrZXJzLnNlbGVjdGlvbjpoYXZlX2tleSgiUXVpY2sgcGVlayBhc3Npc3QiKSB0aGVuCiAgICAgICAgICAgIGFuaW1hdGlvbl9icmVha2Vycy5xdWlja19wZWVrX2Fzc2lzdDpkaXNwbGF5KCk7CiAgICAgICAgZW5kCgogICAgICAgIGlmIGhpdHNvdW5kLmVuYWJsZWQ6Z2V0KCkgdGhlbgogICAgICAgICAgICBoaXRzb3VuZC52b2x1bWU6ZGlzcGxheSgpOwogICAgICAgICAgICBoaXRzb3VuZC5waXRjaDpkaXNwbGF5KCk7CiAgICAgICAgZW5kCgogICAgICAgIC0tIEltcG9ydGFudAogICAgICAgIGRyb3BfZ3JlbmFkZXMuZW5hYmxlZDpkaXNwbGF5KCk7CiAgICAgICAgZHJvcF9ncmVuYWRlcy5ob3RrZXk6ZGlzcGxheSgpOwoKICAgICAgICBxdWlja19sYWRkZXJfbW92ZS5lbmFibGVkOmRpc3BsYXkoKTsKCiAgICAgICAgaWYgZHJvcF9ncmVuYWRlcy5lbmFibGVkOmdldCgpIHRoZW4KICAgICAgICAgICAgZHJvcF9ncmVuYWRlcy5zZWxlY3Rpb246ZGlzcGxheSgpOwogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS0gc2h1dGRvd24KY2xpZW50X3NldF9ldmVudF9jYWxsYmFjaygic2h1dGRvd24iLCBhbmltYXRpb25fYnJlYWtlcnMuc2h1dGRvd24pOwpjbGllbnRfc2V0X2V2ZW50X2NhbGxiYWNrKCJzaHV0ZG93biIsIGNvcnJlY3Rpb24uc2h1dGRvd24pOwpjbGllbnRfc2V0X2V2ZW50X2NhbGxiYWNrKCJzaHV0ZG93biIsIGFudGlhaW1ib3Quc2h1dGRvd24pOwpjbGllbnRfc2V0X2V2ZW50X2NhbGxiYWNrKCJzaHV0ZG93biIsIHNldHRpbmdzLnNodXRkb3duKTsKY2xpZW50X3NldF9ldmVudF9jYWxsYmFjaygic2h1dGRvd24iLCBob21lLnNodXRkb3duKTsKY2xpZW50X3NldF9ldmVudF9jYWxsYmFjaygic2h1dGRvd24iLCBkYi5zaHV0ZG93bik7CgotLSBjb25maWdzCmNsaWVudF9zZXRfZXZlbnRfY2FsbGJhY2soInByZV9jb25maWdfc2F2ZSIsIGFudGlhaW1ib3Quc2h1dGRvd24pOwpjbGllbnRfc2V0X2V2ZW50X2NhbGxiYWNrKCJwcmVfY29uZmlnX3NhdmUiLCBzZXR0aW5ncy5zaHV0ZG93bik7CmNsaWVudF9zZXRfZXZlbnRfY2FsbGJhY2soInByZV9jb25maWdfc2F2ZSIsIGRiLnNodXRkb3duKTsKCi0tIGZpcmUgZXZlbnRzCmNsaWVudF9zZXRfZXZlbnRfY2FsbGJhY2soInBsYXllcl9odXJ0IiwgaGl0c291bmQucGxheWVyX2h1cnQpOwoKLS0gY3JlYXRlbW92ZQpjbGllbnRfc2V0X2V2ZW50X2NhbGxiYWNrKCJwcmVfcHJlZGljdF9jb21tYW5kIiwgbG9jYWxwbGF5ZXIucHJlX3ByZWRpY3RfY29tbWFuZCk7CmNsaWVudF9zZXRfZXZlbnRfY2FsbGJhY2soInByZWRpY3RfY29tbWFuZCIsIGxvY2FscGxheWVyLnByZWRpY3RfY29tbWFuZCk7CgpjbGllbnRfc2V0X2V2ZW50X2NhbGxiYWNrKCJzZXR1cF9jb21tYW5kIiwgZXhwbG9pdC5zZXR1cF9jb21tYW5kKTsKY2xpZW50X3NldF9ldmVudF9jYWxsYmFjaygic2V0dXBfY29tbWFuZCIsIHN0YXRlbWVudC5zZXR1cF9jb21tYW5kKTsKY2xpZW50X3NldF9ldmVudF9jYWxsYmFjaygic2V0dXBfY29tbWFuZCIsIGFudGlhaW1ib3Quc2V0dXBfY29tbWFuZCk7CmNsaWVudF9zZXRfZXZlbnRfY2FsbGJhY2soInNldHVwX2NvbW1hbmQiLCBxdWlja19sYWRkZXJfbW92ZS5zZXR1cF9jb21tYW5kKTsKY2xpZW50X3NldF9ldmVudF9jYWxsYmFjaygic2V0dXBfY29tbWFuZCIsIGRyb3BfZ3JlbmFkZXMuc2V0dXBfY29tbWFuZCk7CgpjbGllbnRfc2V0X2V2ZW50X2NhbGxiYWNrKCJmaW5pc2hfY29tbWFuZCIsIGFuaW1hdGlvbl9icmVha2Vycy5maW5pc2hfY29tbWFuZCk7CgotLSBmcmFtZSBzdGFnZSBub3RpZnkKY2xpZW50X3NldF9ldmVudF9jYWxsYmFjaygibmV0X3VwZGF0ZV9lbmQiLCBleHBsb2l0Lm5ldF91cGRhdGUpOwpjbGllbnRfc2V0X2V2ZW50X2NhbGxiYWNrKCJuZXRfdXBkYXRlX2VuZCIsIGxvY2FscGxheWVyLm5ldF91cGRhdGUpOwpjbGllbnRfc2V0X2V2ZW50X2NhbGxiYWNrKCJuZXRfdXBkYXRlX2VuZCIsIGNvcnJlY3Rpb24ubmV0X3VwZGF0ZSk7CgpjbGllbnRfc2V0X2V2ZW50X2NhbGxiYWNrKCJwcmVfcmVuZGVyIiwgYW5pbWF0aW9uX2JyZWFrZXJzLnByZV9yZW5kZXIpOwoKLS0gZHJhd2luZwpjbGllbnRfc2V0X2V2ZW50X2NhbGxiYWNrKCJwYWludF91aSIsIGhvbWUuZnJhbWUpOwpjbGllbnRfc2V0X2V2ZW50X2NhbGxiYWNrKCJwYWludF91aSIsIG1hbnVhbF9kaXJlY3Rpb24uZnJhbWUpOwpjbGllbnRfc2V0X2V2ZW50X2NhbGxiYWNrKCJwYWludF91aSIsIGluZGljYXRlX3N0YXRlLmZyYW1lKTsKCmNsaWVudF9zZXRfZXZlbnRfY2FsbGJhY2soInBhaW50IiwgZXhwbG9pdC5mcmFtZSk7CmNsaWVudF9zZXRfZXZlbnRfY2FsbGJhY2soInBhaW50IiwgY29ubmVjdGlvbl9pbmZvLmZyYW1lKTsKCi0tIG1lbnUKbWVudS5zZXRfY2FsbGJhY2sobWVudV91cGRhdGUpOwoKLS0gbWFpbgpjbGllbnRfZGVsYXlfY2FsbCgwLCBtYWluKTs="}