{"status":200,"content":"bG9jYWwgbG9hZGVyID0gewogICAgdXNlcm5hbWUgPSAiTW9uc3RyeSIKfQppZiBub3QgTFBIX09CRlVTQ0FURUQgdGhlbgogICAgTFBIX05PX1ZJUlRVQUxJWkUgPSBmdW5jdGlvbiguLi4pIHJldHVybiAuLi4gZW5kCmVuZApsb2NhbCByZXF1aXJlZCA9IHJlcXVpcmUKbG9jYWwgcHVpID0gcmVxdWlyZWQgJ2dhbWVzZW5zZS9wdWknIG9yIGVycm9yKCdmYWlsZGVkIHRvIGxvYWQgcHVpJykKbG9jYWwgYmFzZTY0ID0gcmVxdWlyZWQgJ2dhbWVzZW5zZS9iYXNlNjQnIG9yIGVycm9yKCdmYWlsZWQgdG8gbG9hZCBiYXNlNjQnKQpsb2NhbCBjbGlwYm9hcmQgPSByZXF1aXJlZCAiZ2FtZXNlbnNlL2NsaXBib2FyZCIgb3IgZXJyb3IoJ2ZhaWxlZCB0byBsb2FkIGNsaXBib2FyZCcpCmxvY2FsIHZlY3RvciA9IHJlcXVpcmVkICd2ZWN0b3InIG9yIGVycm9yKCdmYWlsZWQgdG8gbG9hZCB2ZWN0b3InKQpsb2NhbCBjX2VudGl0eSA9IHJlcXVpcmVkICJnYW1lc2Vuc2UvZW50aXR5IiBvciBlcnJvcignZmFpbGVkIHRvIGxvYWQgY19lbnRpdHknKQpsb2NhbCBjX3dlYXBvbiA9IHJlcXVpcmVkICJnYW1lc2Vuc2UvY3Nnb193ZWFwb25zIiBvciBlcnJvcignZmFpbGVkIHRvIGxvYWQgY3Nnb193ZWFwb25zJykKbG9jYWwgbXNncGFjayA9IHJlcXVpcmVkICdnYW1lc2Vuc2UvbXNncGFjaycgb3IgZXJyb3IoJ2ZhaWxlZCB0byBsb2FkIG1zZ3BhY2snKQpsb2NhbCBjX2VudGl0eSA9IHJlcXVpcmVkICdnYW1lc2Vuc2UvZW50aXR5JyBvciBlcnJvcignZmFpbGVkIHRvIGxvYWQgY19lbnRpdHknKQpsb2NhbCBzbW9vdGh5ID0gKGZ1bmN0aW9uKCkKICAgIGxvY2FsIGZ1bmN0aW9uIGVhc2UodCwgYiwgYywgZCkKICAgIHJldHVybiBjICogdCAvIGQgKyBiCmVuZAoKbG9jYWwgZnVuY3Rpb24gZ2V0X3RpbWVyKCkKICAgIC0tIHVzZSB5b3VyIG93biB0aW1lciBpbXBsZW1lbnRhdGlvbgogICAgcmV0dXJuIGdsb2JhbHMuZnJhbWV0aW1lKCkKZW5kCgpsb2NhbCBmdW5jdGlvbiBnZXRfdHlwZSh2YWx1ZSkKICAgIGxvY2FsIHZhbF90eXBlID0gdHlwZSh2YWx1ZSkKCiAgICBpZiB2YWxfdHlwZSA9PSAnYm9vbGVhbicgdGhlbgogICAgICAgIHZhbHVlID0gdmFsdWUgYW5kIDEgb3IgMAogICAgZW5kCgogICAgcmV0dXJuIHZhbF90eXBlCmVuZAoKbG9jYWwgZnVuY3Rpb24gY29weV90YWJsZXMoZGVzdGluYXRpb24sIGtleXNUYWJsZSwgdmFsdWVzVGFibGUpCiAgICB2YWx1ZXNUYWJsZSA9IHZhbHVlc1RhYmxlIG9yIGtleXNUYWJsZQogICAgbG9jYWwgbXQgPSBnZXRtZXRhdGFibGUoa2V5c1RhYmxlKQoKICAgIGlmIG10IGFuZCBnZXRtZXRhdGFibGUoZGVzdGluYXRpb24pID09IG5pbCB0aGVuCiAgICAgICAgc2V0bWV0YXRhYmxlKGRlc3RpbmF0aW9uLCBtdCkKICAgIGVuZAoKICAgIGZvciBrLHYgaW4gcGFpcnMoa2V5c1RhYmxlKSBkbwogICAgICAgIGlmIHR5cGUodikgPT0gJ3RhYmxlJyB0aGVuCiAgICAgICAgICAgIGRlc3RpbmF0aW9uW2tdID0gY29weV90YWJsZXMoeyB9LCB2LCB2YWx1ZXNUYWJsZVtrXSkKICAgICAgICBlbHNlCiAgICAgICAgICAgIGxvY2FsIHZhbHVlID0gdmFsdWVzVGFibGVba10KCiAgICAgICAgICAgIGlmIHR5cGUodmFsdWUpID09ICdib29sZWFuJyB0aGVuCiAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlIGFuZCAxIG9yIDAKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBkZXN0aW5hdGlvbltrXSA9IHZhbHVlCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICByZXR1cm4gZGVzdGluYXRpb24KZW5kCgpsb2NhbCBmdW5jdGlvbiByZXNvbHZlKGVhc2luZ19mbiwgcHJldmlvdXMsIG5ldywgY2xvY2ssIGR1cmF0aW9uKQogICAgaWYgdHlwZShuZXcpID09ICdib29sZWFuJyB0aGVuIG5ldyA9IG5ldyBhbmQgMSBvciAwIGVuZAogICAgaWYgdHlwZShwcmV2aW91cykgPT0gJ2Jvb2xlYW4nIHRoZW4gcHJldmlvdXMgPSBwcmV2aW91cyBhbmQgMSBvciAwIGVuZAoKICAgIGxvY2FsIHByZXZpb3VzID0gZWFzaW5nX2ZuKGNsb2NrLCBwcmV2aW91cywgbmV3IC0gcHJldmlvdXMsIGR1cmF0aW9uKQoKICAgIGlmIHR5cGUobmV3KSA9PSAnbnVtYmVyJyB0aGVuCiAgICAgICAgaWYgbWF0aC5hYnMobmV3LXByZXZpb3VzKSA8PSAuMDAxIHRoZW4KICAgICAgICAgICAgcHJldmlvdXMgPSBuZXcKICAgICAgICBlbmQKCiAgICAgICAgaWYgcHJldmlvdXMgJSAxIDwgLjAwMDEgdGhlbgogICAgICAgICAgICBwcmV2aW91cyA9IG1hdGguZmxvb3IocHJldmlvdXMpCiAgICAgICAgZWxzZWlmIHByZXZpb3VzICUgMSA+IC45OTk5IHRoZW4KICAgICAgICAgICAgcHJldmlvdXMgPSBtYXRoLmNlaWwocHJldmlvdXMpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICByZXR1cm4gcHJldmlvdXMKZW5kCgpsb2NhbCBmdW5jdGlvbiBwZXJmb3JtX2Vhc2luZyhudHlwZSwgZWFzaW5nX2ZuLCBwcmV2aW91cywgbmV3LCBjbG9jaywgZHVyYXRpb24pCiAgICBpZiBudHlwZSA9PSAndGFibGUnIHRoZW4KICAgICAgICBmb3IgaywgdiBpbiBwYWlycyhuZXcpIGRvCiAgICAgICAgICAgIHByZXZpb3VzW2tdID0gcHJldmlvdXNba10gb3IgdgogICAgICAgICAgICBwcmV2aW91c1trXSA9IHBlcmZvcm1fZWFzaW5nKAogICAgICAgICAgICAgICAgdHlwZSh2KSwgZWFzaW5nX2ZuLAogICAgICAgICAgICAgICAgcHJldmlvdXNba10sIHYsCiAgICAgICAgICAgICAgICBjbG9jaywgZHVyYXRpb24KICAgICAgICAgICAgKQogICAgICAgIGVuZAoKICAgICAgICByZXR1cm4gcHJldmlvdXMKICAgIGVuZAoKICAgIHJldHVybiByZXNvbHZlKGVhc2luZ19mbiwgcHJldmlvdXMsIG5ldywgY2xvY2ssIGR1cmF0aW9uKQplbmQKCmxvY2FsIGZ1bmN0aW9uIHVwZGF0ZShzZWxmLCBkdXJhdGlvbiwgdmFsdWUsIGVhc2luZykKICAgIGlmIHR5cGUodmFsdWUpID09ICdib29sZWFuJyB0aGVuCiAgICAgICAgdmFsdWUgPSB2YWx1ZSBhbmQgMSBvciAwCiAgICBlbmQKCiAgICBsb2NhbCBjbG9jayA9IGdldF90aW1lcigpCiAgICBsb2NhbCBkdXJhdGlvbiA9IGR1cmF0aW9uIG9yIC4xNQogICAgbG9jYWwgdmFsdWVfdHlwZSA9IGdldF90eXBlKHZhbHVlKQogICAgbG9jYWwgdGFyZ2V0X3R5cGUgPSBnZXRfdHlwZShzZWxmLnZhbHVlKQoKICAgIGFzc2VydCh2YWx1ZV90eXBlID09IHRhcmdldF90eXBlLCAndHlwZSBtaXNtYXRjaCcpCgogICAgaWYgc2VsZi52YWx1ZSA9PSB2YWx1ZSB0aGVuCiAgICAgICAgcmV0dXJuIHZhbHVlCiAgICBlbmQKCiAgICBpZiBjbG9jayA8PSAwIG9yIGNsb2NrID49IGR1cmF0aW9uIHRoZW4KICAgICAgICBpZiB0YXJnZXRfdHlwZSA9PSAndGFibGUnIHRoZW4KICAgICAgICAgICAgY29weV90YWJsZXMoc2VsZi52YWx1ZSwgdmFsdWUpCiAgICAgICAgZWxzZQogICAgICAgICAgICBzZWxmLnZhbHVlID0gdmFsdWUKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICBsb2NhbCBlYXNpbmcgPSBlYXNpbmcgb3Igc2VsZi5lYXNpbmcKCiAgICAgICAgc2VsZi52YWx1ZSA9IHBlcmZvcm1fZWFzaW5nKAogICAgICAgICAgICB0YXJnZXRfdHlwZSwgZWFzaW5nLAogICAgICAgICAgICBzZWxmLnZhbHVlLCB2YWx1ZSwKICAgICAgICAgICAgY2xvY2ssIGR1cmF0aW9uCiAgICAgICAgKQogICAgZW5kCgogICAgcmV0dXJuIHNlbGYudmFsdWUKZW5kCgpsb2NhbCBNID0gewogICAgX19tZXRhdGFibGUgPSBmYWxzZSwKICAgIF9fY2FsbCA9IHVwZGF0ZSwKCiAgICBfX2luZGV4ID0gewogICAgICAgIHVwZGF0ZSA9IHVwZGF0ZQogICAgfQp9CgpyZXR1cm4gZnVuY3Rpb24oZGVmYXVsdCwgZWFzaW5nX2ZuKQogICAgaWYgdHlwZShkZWZhdWx0KSA9PSAnYm9vbGVhbicgdGhlbgogICAgICAgIGRlZmF1bHQgPSBkZWZhdWx0IGFuZCAxIG9yIDAKICAgIGVuZAoKICAgIHJldHVybiBzZXRtZXRhdGFibGUoewogICAgICAgIHZhbHVlID0gZGVmYXVsdCBvciAwLAogICAgICAgIGVhc2luZyA9IGVhc2luZ19mbiBvciBlYXNlLAogICAgfSwgTSkKZW5kCmVuZCkoKQpsb2NhbCBhbnRpX2FpbV9zdGF0ZXMgPSB7IlN0YW5kaW5nIiwgIlJ1bm5pbmciLCAiU2xvd3dhbGsiLCAiRHVja2luZyIsICJBaXIiLCAiQWlyK0R1Y2siLCAiU2FmZSIsICdGYWtlbGFnJ30KbG9jYWwgdGVhbXMgPSB7IkNUIiwgIlQifQpsb2NhbCBjdXN0b21fYWEgPSB7fQpsb2NhbCBoZWxwZXJzID0ge30KbG9jYWwgeCx5ID0gY2xpZW50LnNjcmVlbl9zaXplKCkKbG9jYWwgcGxheWVyX3N0YXRlID0gMQpsb2NhbCBzeXN0ZW0gPSB7fQpsb2NhbCBzY3JlZW5fc2l6ZV94LCBzY3JlZW5fc2l6ZV95ID0gY2xpZW50LnNjcmVlbl9zaXplKCkKbG9jYWwgcHVpID0gcmVxdWlyZSAnZ2FtZXNlbnNlL3B1aScgb3IgZXJyb3IoJ2ZhaWxkZWQgdG8gbG9hZCBwdWknKQpsb2NhbCB2ZWN0b3IgPSByZXF1aXJlICJ2ZWN0b3IiCnN5c3RlbS5saXN0ID0ge30Kc3lzdGVtLndpbmRvd3MgPSB7fQpzeXN0ZW0uX19pbmRleCA9IHN5c3RlbQoKbG9jYWwgcmVmZXJlbmNlIGRvCiAgICAgICAgcmVmZXJlbmNlID0geyB9CgogICAgICAgIAogICAgICAgIHJlZmVyZW5jZS5mZCA9IHt1aS5yZWZlcmVuY2UoIlJhZ2UiLCAiT3RoZXIiLCAiRHVjayBwZWVrIGFzc2lzdCIpfQogICAgICAgIHJlZmVyZW5jZS5kdCA9IHt1aS5yZWZlcmVuY2UoIlJhZ2UiLCAiQWltYm90IiwgIkRvdWJsZSBUYXAiKX0KICAgICAgICByZWZlcmVuY2UuZHRfZmwgPSB1aS5yZWZlcmVuY2UoIlJhZ2UiLCAiQWltYm90IiwgIkRvdWJsZSB0YXAgZmFrZSBsYWcgbGltaXQiKQogICAgICAgIHJlZmVyZW5jZS5ocyA9IHt1aS5yZWZlcmVuY2UoIkFBIiwgIk90aGVyIiwgIk9uIHNob3QgYW50aS1haW0iKX0KICAgICAgICByZWZlcmVuY2UuY29sb3IgPSBwdWkucmVmZXJlbmNlKCdNaXNjJywgJ1NldHRpbmdzJywgJ01lbnUgY29sb3InKQogICAgICAgIHJlZmVyZW5jZS5kbWcxID0gdWkucmVmZXJlbmNlKCdSQUdFJywgJ0FpbWJvdCcsICdNaW5pbXVtIGRhbWFnZScpCiAgICAgICAgcmVmZXJlbmNlLmRtZyA9IHt1aS5yZWZlcmVuY2UoIlJhZ2UiLCAiQWltYm90IiwgIk1pbmltdW0gZGFtYWdlIG92ZXJyaWRlIil9CiAgICAgICAgcmVmZXJlbmNlLmZha2VkdWNrID0gdWkucmVmZXJlbmNlKCJSQUdFIiwgIk90aGVyIiwgIkR1Y2sgcGVlayBhc3Npc3QiKQogICAgICAgIHJlZmVyZW5jZS5sdWEgPSB1aS5yZWZlcmVuY2UoIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJFbmFibGVkIikKICAgICAgICByZWZlcmVuY2UuZm9yY2ViYWltID0gdWkucmVmZXJlbmNlKCJSQUdFIiwgIkFpbWJvdCIsICJGb3JjZSBib2R5IGFpbSIpCiAgICAgICAgcmVmZXJlbmNlLnBpdGNoID0ge3VpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgInBpdGNoIil9CiAgICAgICAgcmVmZXJlbmNlLnJvbGwgPSB1aS5yZWZlcmVuY2UoIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJyb2xsIikKICAgICAgICByZWZlcmVuY2UueWF3YmFzZSA9IHVpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIllhdyBiYXNlIikKICAgICAgICByZWZlcmVuY2UubG0gPSBwdWkucmVmZXJlbmNlKCJBQSIsIk90aGVyIiwiTGVnIG1vdmVtZW50IikKICAgICAgICByZWZlcmVuY2UueWF3ID0ge3VpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIllhdyIpfQogICAgICAgIHJlZmVyZW5jZS5mc2JvZHl5YXcgPSB1aS5yZWZlcmVuY2UoIkFBIiwgImFudGktYWltYm90IGFuZ2xlcyIsICJGcmVlc3RhbmRpbmcgYm9keSB5YXciKQogICAgICAgIHJlZmVyZW5jZS5lZGdleWF3ID0gdWkucmVmZXJlbmNlKCJBQSIsICJhbnRpLWFpbWJvdCBhbmdsZXMiLCAiRWRnZSB5YXciKQogICAgICAgIHJlZmVyZW5jZS55YXdqaXR0ZXIgPSB7dWkucmVmZXJlbmNlKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiWWF3IGppdHRlciIpfQogICAgICAgIHJlZmVyZW5jZS5ib2R5eWF3ID0ge3VpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIkJvZHkgeWF3Iil9CiAgICAgICAgcmVmZXJlbmNlLmZyZWVzdGFuZCA9IHt1aS5yZWZlcmVuY2UoIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJGcmVlc3RhbmRpbmciKX0KICAgICAgICByZWZlcmVuY2Uuc2xvdyA9IHt1aS5yZWZlcmVuY2UoIkFBIiwgIk90aGVyIiwgIlNsb3cgbW90aW9uIil9CiAgICAgICAgcmVmZXJlbmNlLmNvbnNvbGVhID0gcHVpLnJlZmVyZW5jZSgnTWlzYycsICdNaXNjZWxsYW5lb3VzJywgJ0RyYXcgY29uc29sZSBvdXRwdXQnKQogICAgICAgIHJlZmVyZW5jZS5mcCA9IHt1aS5yZWZlcmVuY2UoIkFBIiwgIk90aGVyIiwgIkZha2UgcGVlayIpfQogICAgICAgIHJlZmVyZW5jZS5lbmFibGUgPSB7dWkucmVmZXJlbmNlKCJBQSIsICJGYWtlIGxhZyIsICJFbmFibGVkIil9CiAgICAgICAgcmVmZXJlbmNlLmFtb3VudCA9IHVpLnJlZmVyZW5jZSgiQUEiLCAiRmFrZSBsYWciLCAiQW1vdW50IikKICAgICAgICByZWZlcmVuY2UudmFyaWFuY2UgPSB1aS5yZWZlcmVuY2UoIkFBIiwgIkZha2UgbGFnIiwgIlZhcmlhbmNlIikKICAgICAgICByZWZlcmVuY2UubGltaXQgPSB1aS5yZWZlcmVuY2UoIkFBIiwgIkZha2UgbGFnIiwgIkxpbWl0IikKCiAKZW5kCgpsb2NhbCB2YXJzID0geyB9CiAgICAgICAgcHVpLm1hY3Jvcy5kb3QgPSAnXHbigKIgIFxyJwogICAgCiAgICAgICAgbG9jYWwgZ3JvdXBfZmFrZWxhZyA9IHB1aS5ncm91cCgnQUEnLCAnRmFrZSBsYWcnKQogICAgICAgIGxvY2FsIGdyb3VwID0gcHVpLmdyb3VwKCdBQScsICdBbnRpLWFpbWJvdCBhbmdsZXMnKQogICAgICAgIGxvY2FsIGdyb3VwX290aGVyID0gcHVpLmdyb3VwKCJBQSIsICdPdGhlcicpCgogICAgICAgIGxvY2FsIHNlbGVjdGlvbiBkbwogICAgICAgICAgICB2YXJzLnNlbGVjdGlvbiA9IHsgfQogICAgCiAgICAgICAgICAgIHZhcnMuc2VsZWN0aW9uLmxhYmVsID0gZ3JvdXBfZmFrZWxhZzpsYWJlbCgnICAgICAgICAgICAgICAgICAgICAgIGFtcGhpYmlhJykKICAgIAogICAgICAgICAgICB2YXJzLnNlbGVjdGlvbi50YWIgPSBncm91cF9mYWtlbGFnOmNvbWJvYm94KCdcZjxkb3Q+U2VsZWN0aW9uJywgeyAnQW50aSBBaW0nLCAnVmlzdWFscycsICdNaXNjJywgJ0NvbmZpZ3MnIH0sIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgdmFycy5zZWxlY3Rpb24uYWFfdGFiID0gZ3JvdXBfZmFrZWxhZzpjb21ib2JveCgnXGY8ZG90PlRhYicsIHsgJ0FuZ2xlcycsICdGZWF0dXJlcycgfSwgZmFsc2UsIGZhbHNlKTpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdBbnRpIEFpbScgfSkKICAgIAogICAgICAgICAgICB2YXJzLnNlbGVjdGlvbi50YWJfbGFiZWwgPSBncm91cDpsYWJlbChzdHJpbmcuZm9ybWF0KCdcZjxkb3Q+ICVzJywgdmFycy5zZWxlY3Rpb24udGFiLnZhbHVlKSkKICAgIAogICAgICAgICAgICB2YXJzLnNlbGVjdGlvbi50YWI6c2V0X2NhbGxiYWNrKGZ1bmN0aW9uIChzZWxmKQogICAgICAgICAgICAgICAgdmFycy5zZWxlY3Rpb24udGFiX2xhYmVsOnNldChzdHJpbmcuZm9ybWF0KCdcZjxkb3Q+JXMnLCBzZWxmLnZhbHVlKSkKICAgICAgICAgICAgZW5kLCB0cnVlKQogICAgICAgIGVuZAogICAgCiAgICAgICAgbG9jYWwgYW50aWFpbSBkbwogICAgICAgICAgICB2YXJzLmFhID0geyB9CiAgICAKICAgICAgICAgICAgdmFycy5hYS5lbmNoYSA9IGdyb3VwOm11bHRpc2VsZWN0KCdcZjxkb3Q+RmVhdHVyZXMnLCAnTWFudWFsIEFBJywgJ0ZyZWVzdGFuZCcsICdBbmltYXRpb25zIEJyZWFrZXInLCAnRWRnZSBZYXcgRmFrZWR1Y2snLCAnQW50aS1CYWNrc3RhYicsICdGYXN0IExhZGRlciBNb3ZlJywgJ1N0YXRpYyBGcmVlc3RhbmQnLCAnU3RhdGljIE9uIFdhcm11cCcsICdCb21ic2l0ZSBFIEZpeCcpOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ0FudGkgQWltJyB9LCB7IHZhcnMuc2VsZWN0aW9uLmFhX3RhYiwgJ0ZlYXR1cmVzJyB9KQogICAgICAgICAgICB2YXJzLmFhLmdyb3VuZCA9IGdyb3VwOmNvbWJvYm94KCdcZjxkb3Q+T24gR3JvdW5kJywgeyAnRGlzYWJsZWQnLCAnU3RhdGljJywgJ1dhbGtpbmcnLCAnSml0dGVyJ30pOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ0FudGkgQWltJyB9LCB7IHZhcnMuc2VsZWN0aW9uLmFhX3RhYiwgJ0ZlYXR1cmVzJyB9LCB7dmFycy5hYS5lbmNoYSwgJ0FuaW1hdGlvbnMgQnJlYWtlcid9KQogICAgICAgICAgICB2YXJzLmFhLmFpciA9IGdyb3VwOmNvbWJvYm94KCdcZjxkb3Q+SW4gQWlyJywgeyAnRGlzYWJsZWQnLCAnU3RhdGljJywgJ1dhbGtpbmcnIH0pOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ0FudGkgQWltJyB9LCB7IHZhcnMuc2VsZWN0aW9uLmFhX3RhYiwgJ0ZlYXR1cmVzJyB9LCB7dmFycy5hYS5lbmNoYSwgJ0FuaW1hdGlvbnMgQnJlYWtlcid9KQoKICAgICAgICAgICAgdmFycy5hYS5tYW51YWxfbGVmdCA9IGdyb3VwOmhvdGtleSgnXGY8ZG90Pk1hbnVhbCBMZWZ0Jyk6ZGVwZW5kKHsgdmFycy5zZWxlY3Rpb24udGFiLCAnQW50aSBBaW0nIH0sIHsgdmFycy5zZWxlY3Rpb24uYWFfdGFiLCAnRmVhdHVyZXMnIH0sIHt2YXJzLmFhLmVuY2hhLCAnTWFudWFsIEFBJ30pCiAgICAgICAgICAgIHZhcnMuYWEubWFudWFsX3JpZ2h0ID0gZ3JvdXA6aG90a2V5KCdcZjxkb3Q+TWFudWFsIFJpZ2h0Jyk6ZGVwZW5kKHsgdmFycy5zZWxlY3Rpb24udGFiLCAnQW50aSBBaW0nIH0sIHsgdmFycy5zZWxlY3Rpb24uYWFfdGFiLCAnRmVhdHVyZXMnIH0sIHt2YXJzLmFhLmVuY2hhLCAnTWFudWFsIEFBJ30pCiAgICAgICAgICAgIHZhcnMuYWEuZnJlZXN0YW5kaW5nID0gZ3JvdXA6aG90a2V5KCdcZjxkb3Q+RnJlZXN0YW5kaW5nJyk6ZGVwZW5kKHsgdmFycy5zZWxlY3Rpb24udGFiLCAnQW50aSBBaW0nIH0sIHsgdmFycy5zZWxlY3Rpb24uYWFfdGFiLCAnRmVhdHVyZXMnIH0sIHt2YXJzLmFhLmVuY2hhLCAnRnJlZXN0YW5kJ30pCiAgICAKICAgICAgICBlbmQKICAgIAogICAgICAgIGxvY2FsIGFuZ2xlcyBkbwogICAgICAgICAgICB2YXJzLmFuZ2xlcyA9IHsgfQogICAgCiAgICAgICAgICAgIHZhcnMuYW5nbGVzLnR5cGUgPSBncm91cDpjb21ib2JveCgnXGY8ZG90Pk1vZGUnLCB7ICdCdWlsZGVyJywgJ1ByZXNldCcgfSk6ZGVwZW5kKHsgdmFycy5zZWxlY3Rpb24udGFiLCAnQW50aSBBaW0nIH0sIHsgdmFycy5zZWxlY3Rpb24uYWFfdGFiLCAnQW5nbGVzJyB9KQogICAgICAgICAgICB2YXJzLmFuZ2xlcy50ZWFtID0gZ3JvdXA6Y29tYm9ib3goJ1xmPGRvdD5QbGF5ZXIgVGVhbScsICdDVCcsICdUJyk6ZGVwZW5kKHsgdmFycy5zZWxlY3Rpb24udGFiLCAnQW50aSBBaW0nIH0sIHsgdmFycy5zZWxlY3Rpb24uYWFfdGFiLCAnQW5nbGVzJyB9LCB7IHZhcnMuYW5nbGVzLnR5cGUsICdCdWlsZGVyJyB9KQogICAgICAgICAgICB2YXJzLmFuZ2xlcy5jb25kaXRpb24gPSBncm91cDpjb21ib2JveCgnXGY8ZG90PlBsYXllciBDb25kaXRpb24nLCBhbnRpX2FpbV9zdGF0ZXMpOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ0FudGkgQWltJyB9LCB7IHZhcnMuc2VsZWN0aW9uLmFhX3RhYiwgJ0FuZ2xlcycgfSwgeyB2YXJzLmFuZ2xlcy50eXBlLCAnQnVpbGRlcicgfSkKCiAgICAgICAgICAgIHZhcnMuYW5nbGVzLmxhYmVsID0gZ3JvdXA6bGFiZWwoJ1xmPGRvdD5Zb3UgQXJlIFVzaW5nIFRoZSBcdlByZXNldC4nKTpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdBbnRpIEFpbScgfSwgeyB2YXJzLnNlbGVjdGlvbi5hYV90YWIsICdBbmdsZXMnIH0sIHsgdmFycy5hbmdsZXMudHlwZSwgJ1ByZXNldCcgfSkKICAgICAgICAgICAgdmFycy5hbmdsZXMubGFiZWwyID0gZ3JvdXA6bGFiZWwoJ1xmPGRvdD5FdmVyeXRoaW5nIElzIEFscmVhZHkgXHZTZXQgVXAuJyk6ZGVwZW5kKHsgdmFycy5zZWxlY3Rpb24udGFiLCAnQW50aSBBaW0nIH0sIHsgdmFycy5zZWxlY3Rpb24uYWFfdGFiLCAnQW5nbGVzJyB9LCB7IHZhcnMuYW5nbGVzLnR5cGUsICdQcmVzZXQnIH0pCiAgICAgICAgICAgIHZhcnMuYW5nbGVzLmxhYmVsMyA9IGdyb3VwOmxhYmVsKCdcZjxkb3Q+RW5qb3ksIFx2Jy4ubG9hZGVyLnVzZXJuYW1lKTpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdBbnRpIEFpbScgfSwgeyB2YXJzLnNlbGVjdGlvbi5hYV90YWIsICdBbmdsZXMnIH0sIHsgdmFycy5hbmdsZXMudHlwZSwgJ1ByZXNldCcgfSkKICAgICAgICAKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgY29uZGl0aW9ucyBkbwoKICAgICAgICAgICAgZnVuY3Rpb24gZXhwb3J0X3N0YXRlKHN0YXRlLCB0ZWFtLCB0b3RlYW0pCiAgICAgICAgICAgICAgICBsb2NhbCBjb25maWcgPSBwdWkuc2V0dXAoe2N1c3RvbV9hYVt0ZWFtXVtzdGF0ZV19KQogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIGRhdGEgPSBjb25maWc6c2F2ZSgpCiAgICAgICAgICAgICAgICBsb2NhbCBlbmNyeXB0ZWQgPSBiYXNlNjQuZW5jb2RlKCBqc29uLnN0cmluZ2lmeShkYXRhKSApCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaW1wb3J0X3N0YXRlKGVuY3J5cHRlZCwgc3RhdGUsIHRvdGVhbSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBmdW5jdGlvbiBpbXBvcnRfc3RhdGUoZW5jcnlwdGVkLCBzdGF0ZSx0ZWFtKQogICAgICAgICAgICAgICAgbG9jYWwgZGF0YSA9IGpzb24ucGFyc2UoYmFzZTY0LmRlY29kZShlbmNyeXB0ZWQpKQogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIGNvbmZpZyA9IHB1aS5zZXR1cCh7Y3VzdG9tX2FhW3RlYW1dW3N0YXRlXX0pCiAgICAgICAgICAgICAgICBjb25maWc6bG9hZChkYXRhKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZvciBpLCB0ZWFtIGluIG5leHQsIHRlYW1zIGRvCiAgICAgICAgICAgICAgICBjdXN0b21fYWFbdGVhbV0gPSB7fQogICAgICAgICAgICAgICAgZm9yIGssIHN0YXRlIGluIG5leHQsIGFudGlfYWltX3N0YXRlcyBkbwogICAgICAgICAgICAgICAgICAgIGN1c3RvbV9hYVt0ZWFtXVtzdGF0ZV0gPSB7fQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbV9hYVt0ZWFtXVtzdGF0ZV0uZW5hYmxlZCA9IGdyb3VwOmNoZWNrYm94KHN0cmluZy5mb3JtYXQoJ0VuYWJsZSBcdiVzIFx2JXMgXGFjOGM4YzhmZlN0YXRlJywgc3RhdGUsIHRlYW0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ0FudGkgQWltJyB9LHt2YXJzLmFuZ2xlcy50ZWFtLCB0ZWFtc1tpXX0sIHsgdmFycy5zZWxlY3Rpb24uYWFfdGFiLCAnQW5nbGVzJyB9LCB7IHZhcnMuYW5nbGVzLnR5cGUsICdCdWlsZGVyJyB9LCB7IHZhcnMuYW5nbGVzLmNvbmRpdGlvbiwgYW50aV9haW1fc3RhdGVzW2tdIH0pCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tX2FhW3RlYW1dW3N0YXRlXS5waXRjaCA9IGdyb3VwOmNvbWJvYm94KHN0cmluZy5mb3JtYXQoJ1xmPGRvdD5cdiVzIH4gXGFjOGM4YzhmZlBpdGNoJywgc3RhdGUpLCB7ICdPZmYnLCAnRGVmYXVsdCcsICdVcCcsICdEb3duJywgJ01pbmltYWwnLCAnUmFuZG9tJywgJ0N1c3RvbScgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdBbnRpIEFpbScgfSx7dmFycy5hbmdsZXMudGVhbSwgdGVhbXNbaV19LCB7IHZhcnMuc2VsZWN0aW9uLmFhX3RhYiwgJ0FuZ2xlcycgfSwgeyB2YXJzLmFuZ2xlcy50eXBlLCAnQnVpbGRlcicgfSwgeyB2YXJzLmFuZ2xlcy5jb25kaXRpb24sIGFudGlfYWltX3N0YXRlc1trXSB9LCBjdXN0b21fYWFbdGVhbV1bc3RhdGVdLmVuYWJsZWQpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tX2FhW3RlYW1dW3N0YXRlXS5waXRjaF92YWx1ZSA9IGdyb3VwOnNsaWRlcihzdHJpbmcuZm9ybWF0KCdcZjxkb3Q+UGl0Y2ggVmFsdWUgJXMgJywgc3RhdGUpLCAtODksIDg5LCAwLCB0cnVlLCAnwrAnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ0FudGkgQWltJyB9LHt2YXJzLmFuZ2xlcy50ZWFtLCB0ZWFtc1tpXX0sIHsgdmFycy5zZWxlY3Rpb24uYWFfdGFiLCAnQW5nbGVzJyB9LCB7IHZhcnMuYW5nbGVzLnR5cGUsICdCdWlsZGVyJyB9LCB7IHZhcnMuYW5nbGVzLmNvbmRpdGlvbiwgYW50aV9haW1fc3RhdGVzW2tdIH0sIHsgY3VzdG9tX2FhW3RlYW1dW3N0YXRlXS5waXRjaCwgJ0N1c3RvbScgfSwgY3VzdG9tX2FhW3RlYW1dW3N0YXRlXS5lbmFibGVkKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbV9hYVt0ZWFtXVtzdGF0ZV0ueWF3X2Jhc2UgPSBncm91cDpjb21ib2JveChzdHJpbmcuZm9ybWF0KCdcZjxkb3Q+XHYlcyB+IFxhYzhjOGM4ZmZZYXcgQmFzZScsIHN0YXRlKSwgeyAnTG9jYWwgdmlldycsICdBdCB0YXJnZXRzJyB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ0FudGkgQWltJyB9LHt2YXJzLmFuZ2xlcy50ZWFtLCB0ZWFtc1tpXX0sIHsgdmFycy5zZWxlY3Rpb24uYWFfdGFiLCAnQW5nbGVzJyB9LCB7IHZhcnMuYW5nbGVzLnR5cGUsICdCdWlsZGVyJyB9LCB7IHZhcnMuYW5nbGVzLmNvbmRpdGlvbiwgYW50aV9haW1fc3RhdGVzW2tdIH0sIGN1c3RvbV9hYVt0ZWFtXVtzdGF0ZV0uZW5hYmxlZCkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21fYWFbdGVhbV1bc3RhdGVdLnlhdyA9IGdyb3VwOmNvbWJvYm94KHN0cmluZy5mb3JtYXQoJ1xmPGRvdD5cdiVzIH4gXGFjOGM4YzhmZllhdycsIHN0YXRlKSwgeyAnT2ZmJywgJzE4MCcsICdTcGluJywgJ1N0YXRpYycsICcxODAgWicsICdDcm9zc2hhaXInLCAnMTgwIExlZnQgLyBSaWdodCcgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdBbnRpIEFpbScgfSx7dmFycy5hbmdsZXMudGVhbSwgdGVhbXNbaV19LCB7IHZhcnMuc2VsZWN0aW9uLmFhX3RhYiwgJ0FuZ2xlcycgfSwgeyB2YXJzLmFuZ2xlcy50eXBlLCAnQnVpbGRlcicgfSwgeyB2YXJzLmFuZ2xlcy5jb25kaXRpb24sIGFudGlfYWltX3N0YXRlc1trXSB9LCBjdXN0b21fYWFbdGVhbV1bc3RhdGVdLmVuYWJsZWQpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tX2FhW3RlYW1dW3N0YXRlXS55YXdfb2Zmc2V0ID0gZ3JvdXA6c2xpZGVyKHN0cmluZy5mb3JtYXQoJ1xmPGRvdD5cdiVzIH4gXGFjOGM4YzhmZllhdyBPZmZzZXQnLCBzdGF0ZSksIC0xODAsIDE4MCwgMCwgdHJ1ZSwgJ8KwJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdBbnRpIEFpbScgfSx7dmFycy5hbmdsZXMudGVhbSwgdGVhbXNbaV19LCB7IHZhcnMuc2VsZWN0aW9uLmFhX3RhYiwgJ0FuZ2xlcycgfSwgeyB2YXJzLmFuZ2xlcy50eXBlLCAnQnVpbGRlcicgfSwgeyB2YXJzLmFuZ2xlcy5jb25kaXRpb24sIGFudGlfYWltX3N0YXRlc1trXSB9LCB7IGN1c3RvbV9hYVt0ZWFtXVtzdGF0ZV0ueWF3LCAnMTgwJywgJ1NwaW4nLCAnU3RhdGljJywgJzE4MCBaJywgJ0Nyb3NzaGFpcicgfSwgY3VzdG9tX2FhW3RlYW1dW3N0YXRlXS5lbmFibGVkKQogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbV9hYVt0ZWFtXVtzdGF0ZV0uZGVsYXllZF9zd2FwID0gZ3JvdXA6Y2hlY2tib3goc3RyaW5nLmZvcm1hdCgnXGY8ZG90Plx2JXMgfiBcYWM4YzhjOGZmRGVsYXllZCBTd2FwICcsIHN0YXRlKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdBbnRpIEFpbScgfSx7dmFycy5hbmdsZXMudGVhbSwgdGVhbXNbaV19LCB7IHZhcnMuc2VsZWN0aW9uLmFhX3RhYiwgJ0FuZ2xlcycgfSwgeyB2YXJzLmFuZ2xlcy50eXBlLCAnQnVpbGRlcicgfSwgeyB2YXJzLmFuZ2xlcy5jb25kaXRpb24sIGFudGlfYWltX3N0YXRlc1trXSB9LCB7IGN1c3RvbV9hYVt0ZWFtXVtzdGF0ZV0ueWF3LCAnMTgwIExlZnQgLyBSaWdodCcgfSwgY3VzdG9tX2FhW3RlYW1dW3N0YXRlXS5lbmFibGVkKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbV9hYVt0ZWFtXVtzdGF0ZV0udGlja3NfZGVsYXkgPSBncm91cDpzbGlkZXIoc3RyaW5nLmZvcm1hdCgnXGY8ZG90Plx2JXMgfiBcYWM4YzhjOGZmRGVsYXkgVGlja3MgJywgc3RhdGUpLCAwLCAzMCwgMCwgdHJ1ZSwgJ3QnLCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ0FudGkgQWltJyB9LHt2YXJzLmFuZ2xlcy50ZWFtLCB0ZWFtc1tpXX0sIGN1c3RvbV9hYVt0ZWFtXVtzdGF0ZV0uZGVsYXllZF9zd2FwLCB7IHZhcnMuc2VsZWN0aW9uLmFhX3RhYiwgJ0FuZ2xlcycgfSwgeyB2YXJzLmFuZ2xlcy50eXBlLCAnQnVpbGRlcicgfSwgeyB2YXJzLmFuZ2xlcy5jb25kaXRpb24sIGFudGlfYWltX3N0YXRlc1trXSB9LCB7IGN1c3RvbV9hYVt0ZWFtXVtzdGF0ZV0ueWF3LCAnMTgwIExlZnQgLyBSaWdodCcgfSwgY3VzdG9tX2FhW3RlYW1dW3N0YXRlXS5lbmFibGVkKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbV9hYVt0ZWFtXVtzdGF0ZV0ueWF3X2xlZnQgPSBncm91cDpzbGlkZXIoc3RyaW5nLmZvcm1hdCgnXGY8ZG90Plx2JXMgfiBcYWM4YzhjOGZmTGVmdCBPZmZzZXQgJywgc3RhdGUpLCAtMTgwLCAxODAsIDAsIHRydWUsICfCsCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6ZGVwZW5kKHsgdmFycy5zZWxlY3Rpb24udGFiLCAnQW50aSBBaW0nIH0se3ZhcnMuYW5nbGVzLnRlYW0sIHRlYW1zW2ldfSwgeyB2YXJzLnNlbGVjdGlvbi5hYV90YWIsICdBbmdsZXMnIH0sIHsgdmFycy5hbmdsZXMudHlwZSwgJ0J1aWxkZXInIH0sIHsgdmFycy5hbmdsZXMuY29uZGl0aW9uLCBhbnRpX2FpbV9zdGF0ZXNba10gfSwgeyBjdXN0b21fYWFbdGVhbV1bc3RhdGVdLnlhdywgJzE4MCBMZWZ0IC8gUmlnaHQnIH0sIGN1c3RvbV9hYVt0ZWFtXVtzdGF0ZV0uZW5hYmxlZCkKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21fYWFbdGVhbV1bc3RhdGVdLnlhd19yaWdodCA9IGdyb3VwOnNsaWRlcihzdHJpbmcuZm9ybWF0KCdcZjxkb3Q+XHYlcyB+IFxhYzhjOGM4ZmZSaWdodCBPZmZzZXQnLCBzdGF0ZSksIC0xODAsIDE4MCwgMCwgdHJ1ZSwgJ8KwJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdBbnRpIEFpbScgfSx7dmFycy5hbmdsZXMudGVhbSwgdGVhbXNbaV19LCB7IHZhcnMuc2VsZWN0aW9uLmFhX3RhYiwgJ0FuZ2xlcycgfSwgeyB2YXJzLmFuZ2xlcy50eXBlLCAnQnVpbGRlcicgfSwgeyB2YXJzLmFuZ2xlcy5jb25kaXRpb24sIGFudGlfYWltX3N0YXRlc1trXSB9LCB7IGN1c3RvbV9hYVt0ZWFtXVtzdGF0ZV0ueWF3LCAnMTgwIExlZnQgLyBSaWdodCcgfSwgY3VzdG9tX2FhW3RlYW1dW3N0YXRlXS5lbmFibGVkKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbV9hYVt0ZWFtXVtzdGF0ZV0uYm9keV95YXcgPSBncm91cDpjb21ib2JveChzdHJpbmcuZm9ybWF0KCdcZjxkb3Q+XHYlcyB+IFxhYzhjOGM4ZmZCb2R5IFlhdycsIHN0YXRlKSwgeyAnT2ZmJywgJ1N0YXRpYycsICdKaXR0ZXInLCAnT3Bwb3NpdGUnfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdBbnRpIEFpbScgfSx7dmFycy5hbmdsZXMudGVhbSwgdGVhbXNbaV19LCB7IHZhcnMuc2VsZWN0aW9uLmFhX3RhYiwgJ0FuZ2xlcycgfSwgeyB2YXJzLmFuZ2xlcy50eXBlLCAnQnVpbGRlcicgfSwgeyB2YXJzLmFuZ2xlcy5jb25kaXRpb24sIGFudGlfYWltX3N0YXRlc1trXSB9LCBjdXN0b21fYWFbdGVhbV1bc3RhdGVdLmVuYWJsZWQpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tX2FhW3RlYW1dW3N0YXRlXS5ib2R5X3lhd19vZmZzZXQgPSBncm91cDpzbGlkZXIoc3RyaW5nLmZvcm1hdCgnXGY8ZG90Plx2JXMgfiBcYWM4YzhjOGZmQm9keSBZYXcgT2Zmc2V0Jywgc3RhdGUpLCAtMTgwLCAxODAsIDAsIHRydWUsICfCsCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6ZGVwZW5kKHsgdmFycy5zZWxlY3Rpb24udGFiLCAnQW50aSBBaW0nIH0se3ZhcnMuYW5nbGVzLnRlYW0sIHRlYW1zW2ldfSwgeyB2YXJzLnNlbGVjdGlvbi5hYV90YWIsICdBbmdsZXMnIH0sIHsgdmFycy5hbmdsZXMudHlwZSwgJ0J1aWxkZXInIH0sIHsgdmFycy5hbmdsZXMuY29uZGl0aW9uLCBhbnRpX2FpbV9zdGF0ZXNba10gfSwgeyBjdXN0b21fYWFbdGVhbV1bc3RhdGVdLmJvZHlfeWF3LCAnSml0dGVyJywgJ1N0YXRpYycsICdPcHBvc2l0ZSd9LCBjdXN0b21fYWFbdGVhbV1bc3RhdGVdLmVuYWJsZWQpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tX2FhW3RlYW1dW3N0YXRlXS55YXdfbW9kaWZpZXIgPSBncm91cDpjb21ib2JveChzdHJpbmcuZm9ybWF0KCdcZjxkb3Q+XHYlcyB+IFxhYzhjOGM4ZmZZYXcgSml0dGVyJywgc3RhdGUpLCB7ICdPZmYnLCAnT2Zmc2V0JywgJ0NlbnRlcicsICdSYW5kb20nLCAnU2tpdHRlcicgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdBbnRpIEFpbScgfSwge3ZhcnMuYW5nbGVzLnRlYW0sIHRlYW1zW2ldfSx7IHZhcnMuc2VsZWN0aW9uLmFhX3RhYiwgJ0FuZ2xlcycgfSwgeyB2YXJzLmFuZ2xlcy50eXBlLCAnQnVpbGRlcicgfSwgeyB2YXJzLmFuZ2xlcy5jb25kaXRpb24sIGFudGlfYWltX3N0YXRlc1trXSB9LCB7IGN1c3RvbV9hYVt0ZWFtXVtzdGF0ZV0ueWF3LCAnT2ZmJywgdHJ1ZSB9LCBjdXN0b21fYWFbdGVhbV1bc3RhdGVdLmVuYWJsZWQpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tX2FhW3RlYW1dW3N0YXRlXS55YXdfbW9kaWZpZXJfb2Zmc2V0ID0gZ3JvdXA6c2xpZGVyKHN0cmluZy5mb3JtYXQoJ1xmPGRvdD5cdiVzIH4gXGFjOGM4YzhmZkppdHRlciBPZmZzZXQnLCBzdGF0ZSksIC0xODAsIDE4MCwgMCwgdHJ1ZSwgJ8KwJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdBbnRpIEFpbScgfSwge3ZhcnMuYW5nbGVzLnRlYW0sIHRlYW1zW2ldfSx7IHZhcnMuc2VsZWN0aW9uLmFhX3RhYiwgJ0FuZ2xlcycgfSwgeyB2YXJzLmFuZ2xlcy50eXBlLCAnQnVpbGRlcicgfSwgeyB2YXJzLmFuZ2xlcy5jb25kaXRpb24sIGFudGlfYWltX3N0YXRlc1trXSB9LCB7IGN1c3RvbV9hYVt0ZWFtXVtzdGF0ZV0ueWF3LCAnT2ZmJywgdHJ1ZSB9LCB7IGN1c3RvbV9hYVt0ZWFtXVtzdGF0ZV0ueWF3X21vZGlmaWVyLCAnT2ZmJywgdHJ1ZSB9LCBjdXN0b21fYWFbdGVhbV1bc3RhdGVdLmVuYWJsZWQpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tX2FhW3RlYW1dW3N0YXRlXS5kZWZlbnNpdmUgPSBncm91cDpjaGVja2JveChzdHJpbmcuZm9ybWF0KCdcZjxkb3Q+XHYlcyB+IFxhYzhjOGM4ZmZGb3JjZSBEZWZlbnNpdmUnLCBzdGF0ZSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6ZGVwZW5kKHsgdmFycy5zZWxlY3Rpb24udGFiLCAnQW50aSBBaW0nIH0se3ZhcnMuYW5nbGVzLnRlYW0sIHRlYW1zW2ldfSwgeyB2YXJzLnNlbGVjdGlvbi5hYV90YWIsICdBbmdsZXMnIH0sIHsgdmFycy5hbmdsZXMudHlwZSwgJ0J1aWxkZXInIH0sIHsgdmFycy5hbmdsZXMuY29uZGl0aW9uLCBhbnRpX2FpbV9zdGF0ZXNba10gfSwgY3VzdG9tX2FhW3RlYW1dW3N0YXRlXS5lbmFibGVkKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbV9hYVt0ZWFtXVtzdGF0ZV0uZGVmZW5zaXZlX21vZGUgPSBncm91cDptdWx0aXNlbGVjdChzdHJpbmcuZm9ybWF0KCdcZjxkb3Q+XHYlcyB+IFxhYzhjOGM4ZmZEZWZlbnNpdmUgTW9kZScsIHN0YXRlKSwgeydEb3VibGUgVGFwJywgJ0hpZGUgU2hvdHMnfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdBbnRpIEFpbScgfSx7dmFycy5hbmdsZXMudGVhbSwgdGVhbXNbaV19LCB7IHZhcnMuc2VsZWN0aW9uLmFhX3RhYiwgJ0FuZ2xlcycgfSwgeyB2YXJzLmFuZ2xlcy50eXBlLCAnQnVpbGRlcicgfSwgeyB2YXJzLmFuZ2xlcy5jb25kaXRpb24sIGFudGlfYWltX3N0YXRlc1trXSB9LCBjdXN0b21fYWFbdGVhbV1bc3RhdGVdLmVuYWJsZWQsY3VzdG9tX2FhW3RlYW1dW3N0YXRlXS5kZWZlbnNpdmUpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tX2FhW3RlYW1dW3N0YXRlXS5kZWZlbnNpdmVfcGl0Y2ggPSBncm91cDpjb21ib2JveChzdHJpbmcuZm9ybWF0KCdcZjxkb3Q+XHYlcyB+IFxhYzhjOGM4ZmZEZWZlbnNpdmUgUGl0Y2gnLCBzdGF0ZSksIHsnT2ZmJywgJ0RlZmF1bHQnLCAnVXAnLCAnVXAtU3dpdGNoJywgJ1JhbmRvbScsICdDdXN0b20nfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdBbnRpIEFpbScgfSx7dmFycy5hbmdsZXMudGVhbSwgdGVhbXNbaV19LCB7IHZhcnMuc2VsZWN0aW9uLmFhX3RhYiwgJ0FuZ2xlcycgfSwgeyB2YXJzLmFuZ2xlcy50eXBlLCAnQnVpbGRlcicgfSwgeyB2YXJzLmFuZ2xlcy5jb25kaXRpb24sIGFudGlfYWltX3N0YXRlc1trXSB9LCBjdXN0b21fYWFbdGVhbV1bc3RhdGVdLmVuYWJsZWQsY3VzdG9tX2FhW3RlYW1dW3N0YXRlXS5kZWZlbnNpdmUpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tX2FhW3RlYW1dW3N0YXRlXS5waXRjaF9hbW91bnQgPSBncm91cDpzbGlkZXIoc3RyaW5nLmZvcm1hdCgnXGY8ZG90Plx2JXMgfiBcYWM4YzhjOGZmT2Zmc2V0Jywgc3RhdGUpLCAtODksIDg5LCAwLCB0cnVlLCAnwrAnLCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ0FudGkgQWltJyB9LHt2YXJzLmFuZ2xlcy50ZWFtLCB0ZWFtc1tpXX0sIHsgdmFycy5zZWxlY3Rpb24uYWFfdGFiLCAnQW5nbGVzJyB9LCB7IHZhcnMuYW5nbGVzLnR5cGUsICdCdWlsZGVyJyB9LCB7IHZhcnMuYW5nbGVzLmNvbmRpdGlvbiwgYW50aV9haW1fc3RhdGVzW2tdIH0sIGN1c3RvbV9hYVt0ZWFtXVtzdGF0ZV0uZW5hYmxlZCAsIHtjdXN0b21fYWFbdGVhbV1bc3RhdGVdLmRlZmVuc2l2ZV9waXRjaCwgJ0N1c3RvbScsICdSYW5kb20nfSxjdXN0b21fYWFbdGVhbV1bc3RhdGVdLmRlZmVuc2l2ZSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21fYWFbdGVhbV1bc3RhdGVdLnBpdGNoX2Ftb3VudF8yID0gZ3JvdXA6c2xpZGVyKHN0cmluZy5mb3JtYXQoJ1xmPGRvdD5cdiVzIH4gXGFjOGM4YzhmZk9mZnNldCAyJywgc3RhdGUpLCAtODksIDg5LCAwLCB0cnVlLCAnwrAnLCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ0FudGkgQWltJyB9LHt2YXJzLmFuZ2xlcy50ZWFtLCB0ZWFtc1tpXX0sIHsgdmFycy5zZWxlY3Rpb24uYWFfdGFiLCAnQW5nbGVzJyB9LCB7IHZhcnMuYW5nbGVzLnR5cGUsICdCdWlsZGVyJyB9LCB7IHZhcnMuYW5nbGVzLmNvbmRpdGlvbiwgYW50aV9haW1fc3RhdGVzW2tdIH0sIGN1c3RvbV9hYVt0ZWFtXVtzdGF0ZV0uZW5hYmxlZCwge2N1c3RvbV9hYVt0ZWFtXVtzdGF0ZV0uZGVmZW5zaXZlX3BpdGNoLCAnUmFuZG9tJ30sY3VzdG9tX2FhW3RlYW1dW3N0YXRlXS5kZWZlbnNpdmUpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tX2FhW3RlYW1dW3N0YXRlXS5kZWZlbnNpdmVfeWF3ID0gZ3JvdXA6Y29tYm9ib3goc3RyaW5nLmZvcm1hdCgnXGY8ZG90Plx2JXMgfiBcYWM4YzhjOGZmRGVmZW5zaXZlIFlhdycsIHN0YXRlKSwgeydPZmYnLCAnMTgwJywgJ1JhbmRvbScsICdTcGluJ30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6ZGVwZW5kKHsgdmFycy5zZWxlY3Rpb24udGFiLCAnQW50aSBBaW0nIH0se3ZhcnMuYW5nbGVzLnRlYW0sIHRlYW1zW2ldfSwgeyB2YXJzLnNlbGVjdGlvbi5hYV90YWIsICdBbmdsZXMnIH0sIHsgdmFycy5hbmdsZXMudHlwZSwgJ0J1aWxkZXInIH0sIHsgdmFycy5hbmdsZXMuY29uZGl0aW9uLCBhbnRpX2FpbV9zdGF0ZXNba10gfSwgY3VzdG9tX2FhW3RlYW1dW3N0YXRlXS5lbmFibGVkLGN1c3RvbV9hYVt0ZWFtXVtzdGF0ZV0uZGVmZW5zaXZlKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbV9hYVt0ZWFtXVtzdGF0ZV0ueWF3X2Ftb3VudCA9IGdyb3VwOnNsaWRlcihzdHJpbmcuZm9ybWF0KCdcZjxkb3Q+XHYlcyB+IFxhYzhjOGM4ZmZEZWZlbnNpdmUgWWF3IE9mZnNldCcsIHN0YXRlKSwgLTE4MCwgMTgwLCAwLCB0cnVlLCAnwrAnLCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ0FudGkgQWltJyB9LHt2YXJzLmFuZ2xlcy50ZWFtLCB0ZWFtc1tpXX0sIHsgdmFycy5zZWxlY3Rpb24uYWFfdGFiLCAnQW5nbGVzJyB9LCB7IHZhcnMuYW5nbGVzLnR5cGUsICdCdWlsZGVyJyB9LCB7IHZhcnMuYW5nbGVzLmNvbmRpdGlvbiwgYW50aV9haW1fc3RhdGVzW2tdIH0sIGN1c3RvbV9hYVt0ZWFtXVtzdGF0ZV0uZW5hYmxlZCwge2N1c3RvbV9hYVt0ZWFtXVtzdGF0ZV0uZGVmZW5zaXZlX3lhdywgJ1NwaW4nfSxjdXN0b21fYWFbdGVhbV1bc3RhdGVdLmRlZmVuc2l2ZSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB0ZXN0X3RlYW0gPSB0ZWFtID09ICJDVCIgYW5kICJUIiBvciAiQ1QiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21fYWFbdGVhbV1bc3RhdGVdLmV4cG9ydF9vcHBvc2l0ZV90ZWFtID0gZ3JvdXA6YnV0dG9uKCJFeHBvcnQgVG8gW1x2Ii4udGVzdF90ZWFtLi4iIC0gIi4uc3RhdGUuLiJcYWM4YzhjOGZmXSIsIGZ1bmN0aW9uKCkgZXhwb3J0X3N0YXRlKHN0YXRlLCB0ZWFtLCB0ZXN0X3RlYW0pIGNsaWVudC5jb2xvcl9sb2coMTk1LDE5OCwyNTUsICdhbXBoaWJpYSDCtyBcMCcpIGNsaWVudC5jb2xvcl9sb2coMjAwLDIwMCwyMDAsICdFeHBvcnRlZCB0byAnLi50ZXN0X3RlYW0uLicgLSAnLi5zdGF0ZS4uJy4nKSAgZW5kKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ0FudGkgQWltJyB9LHt2YXJzLmFuZ2xlcy50ZWFtLCB0ZWFtc1tpXX0sIHsgdmFycy5zZWxlY3Rpb24uYWFfdGFiLCAnQW5nbGVzJyB9LCB7IHZhcnMuYW5nbGVzLnR5cGUsICdCdWlsZGVyJyB9LCB7IHZhcnMuYW5nbGVzLmNvbmRpdGlvbiwgYW50aV9haW1fc3RhdGVzW2tdIH0sIGN1c3RvbV9hYVt0ZWFtXVtzdGF0ZV0uZW5hYmxlZCkKCgogICAgICAgICAgICBlbmQKICAgICAgZW5kCiBlbmQKICAgIAogICAgICAgCiAgICAKICAgICAgICBsb2NhbCB2aXN1YWxzIGRvCiAgICAgICAgICAgIHZhcnMudmlzdWFscyA9IHsgfQogICAgCiAgICAgICAgICAgIHZhcnMudmlzdWFscy5pbmRpY2F0b3JzID0gZ3JvdXA6Y2hlY2tib3goJ1NjcmVlbiBJbmRpY2F0b3JzJyk6ZGVwZW5kKHsgdmFycy5zZWxlY3Rpb24udGFiLCAnVmlzdWFscycgfSkKICAgICAgICAgICAgdmFycy52aXN1YWxzLndpZGdldHMgPSBncm91cDptdWx0aXNlbGVjdCgnXGY8ZG90PlNlbGVjdCcsICdEYW1hZ2UgSW5kaWNhdG9yJywgJ0FudGktQWltIEFycm93cycsICdIaXRtYXJrZXInKTpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdWaXN1YWxzJyB9LCB2YXJzLnZpc3VhbHMuaW5kaWNhdG9ycykKICAgICAgICAgICAgCiAgICAgICAgICAgIHZhcnMudmlzdWFscy5kYW1hZ2Vfc3R5bGUgPSBncm91cDpjb21ib2JveCgnXGY8ZG90PkRhbWFnZSBTdHlsZScsICcjMScsICcjMicpOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ1Zpc3VhbHMnIH0sIHZhcnMudmlzdWFscy5pbmRpY2F0b3JzLHt2YXJzLnZpc3VhbHMud2lkZ2V0cywgIkRhbWFnZSBJbmRpY2F0b3IifSkKICAgICAgICAgIAogICAgICAgICAgICB2YXJzLnZpc3VhbHMubGFiZWxfYXJyb3dzID0gZ3JvdXA6bGFiZWwoJ1xmPGRvdD5BcnJvd3MgQ29sb3InKTpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdWaXN1YWxzJyB9LCB2YXJzLnZpc3VhbHMuaW5kaWNhdG9ycyx7dmFycy52aXN1YWxzLndpZGdldHMsICJBbnRpLUFpbSBBcnJvd3MifSkKICAgICAgICAgICAgdmFycy52aXN1YWxzLm1hbnVhbF9hcnJvd3NfY29sb3IgPSBncm91cDpjb2xvcl9waWNrZXIoJ2FudGktYWltIGFycm93cyBjb2xvcicsIDE5NSwxOTgsMjU1LDI1NSk6ZGVwZW5kKHsgdmFycy5zZWxlY3Rpb24udGFiLCAnVmlzdWFscycgfSx2YXJzLnZpc3VhbHMuaW5kaWNhdG9ycyx7dmFycy52aXN1YWxzLndpZGdldHMsICJBbnRpLUFpbSBBcnJvd3MifSkKICAgICAgICAgIAogICAgICAgICAgICB2YXJzLnZpc3VhbHMuaGl0bWFya2VyID0gZ3JvdXA6bGFiZWwoJ1xmPGRvdD5IaXRtYXJrZXIgQ29sb3InKTpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdWaXN1YWxzJyB9LCB2YXJzLnZpc3VhbHMuaW5kaWNhdG9ycyx7dmFycy52aXN1YWxzLndpZGdldHMsICJIaXRtYXJrZXIifSkKICAgICAgICAgICAgdmFycy52aXN1YWxzLmhpdG1hcmtlcl9jb2xvciA9IGdyb3VwOmNvbG9yX3BpY2tlcignSGl0bWFya2VyIGNvbG9yJywgMTY4LCAxNjgsIDE2OCwyNTUpOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ1Zpc3VhbHMnIH0sdmFycy52aXN1YWxzLmluZGljYXRvcnMse3ZhcnMudmlzdWFscy53aWRnZXRzLCAiSGl0bWFya2VyIn0pCgogICAgICAgICAgICB2YXJzLnZpc3VhbHMud2F0ZXJtYXJrID0gZ3JvdXA6Y2hlY2tib3goJ1dhdGVybWFyaycpOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ1Zpc3VhbHMnIH0pCiAgICAgICAgICAgIHZhcnMudmlzdWFscy53YXRlcm1hcmtfbW9kZSA9IGdyb3VwOmNvbWJvYm94KCdcZjxkb3Q+TW9kZSAnLCAnIzEnLCAnIzInKTpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdWaXN1YWxzJyB9LHZhcnMudmlzdWFscy53YXRlcm1hcmspCiAgICAgICAgICAgIHZhcnMudmlzdWFscy53YXRlcm1hcmtfcG9zaXRpb24gPSBncm91cDpjb21ib2JveCgnXGY8ZG90PlBvc2l0aW9uJywgJ0xlZnQnLCAnUmlnaHQnKTpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdWaXN1YWxzJyB9LHZhcnMudmlzdWFscy53YXRlcm1hcmssIHt2YXJzLnZpc3VhbHMud2F0ZXJtYXJrX21vZGUsICcjMSd9KQogICAgICAgICAgICB2YXJzLnZpc3VhbHMubGFiZWxfd2F0ZXJtYXJrID0gZ3JvdXA6bGFiZWwoJ1xmPGRvdD5XYXRlcm1hcmsgQ29sb3IgRmlyc3QnKTpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdWaXN1YWxzJyB9LCB2YXJzLnZpc3VhbHMud2F0ZXJtYXJrLCB7dmFycy52aXN1YWxzLndhdGVybWFya19tb2RlLCAnIzEnfSkKICAgICAgICAgICAgdmFycy52aXN1YWxzLndhdGVybWFya19jb2xvciA9IGdyb3VwOmNvbG9yX3BpY2tlcignV2F0ZXJtYXJrIENvbG9yJywgMTU1LCAxNTUsIDIwMCwyNTUpOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ1Zpc3VhbHMnIH0sdmFycy52aXN1YWxzLndhdGVybWFyaywge3ZhcnMudmlzdWFscy53YXRlcm1hcmtfbW9kZSwgJyMxJ30pCiAgICAgICAgICAgIHZhcnMudmlzdWFscy5sYWJlbF93YXRlcm1hcmsyID0gZ3JvdXA6bGFiZWwoJ1xmPGRvdD5XYXRlcm1hcmsgQ29sb3IgU2Vjb25kJyk6ZGVwZW5kKHsgdmFycy5zZWxlY3Rpb24udGFiLCAnVmlzdWFscycgfSwgdmFycy52aXN1YWxzLndhdGVybWFyaywge3ZhcnMudmlzdWFscy53YXRlcm1hcmtfbW9kZSwgJyMxJ30pCiAgICAgICAgICAgIHZhcnMudmlzdWFscy53YXRlcm1hcmtfY29sb3IyID0gZ3JvdXA6Y29sb3JfcGlja2VyKCdXYXRlcm1hcmsgQ29sb3IgMicsIDAsMCwwLDI1NSk6ZGVwZW5kKHsgdmFycy5zZWxlY3Rpb24udGFiLCAnVmlzdWFscycgfSx2YXJzLnZpc3VhbHMud2F0ZXJtYXJrLCB7dmFycy52aXN1YWxzLndhdGVybWFya19tb2RlLCAnIzEnfSkKICAgICAgICAgICAgdmFycy52aXN1YWxzLndhdGVybWFya19pdGVtcyA9IGdyb3VwOm11bHRpc2VsZWN0KCdcZjxkb3Q+SXRlbXMnLCAnVXNlcm5hbWUnLCAnTGF0ZW5jeScsICdGcmFtZXJhdGUnLCAnVGltZScpOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ1Zpc3VhbHMnIH0sIHt2YXJzLnZpc3VhbHMud2F0ZXJtYXJrX21vZGUsICcjMid9KQogICAgICAgICAgICB2YXJzLnZpc3VhbHMud2F0ZXJtYXJrX2NvbG9yX21vZGVfMiA9IGdyb3VwOmNvbG9yX3BpY2tlcignV2F0ZXJtYXJrIENvbG9yIE1vZGUgMicsIDE1NSwgMTU1LCAyMDAsMjU1KTpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdWaXN1YWxzJyB9LHZhcnMudmlzdWFscy53YXRlcm1hcmssIHt2YXJzLnZpc3VhbHMud2F0ZXJtYXJrX21vZGUsICcjMid9KQoKICAgICAgICAgICAgCiAgICAgICAgICAgIHZhcnMudmlzdWFscy5zbG93ZWQgPSBncm91cDpjaGVja2JveCgnU2xvd2VkIERvd24nKTpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdWaXN1YWxzJyB9KQogICAgICAgICAgICB2YXJzLnZpc3VhbHMubGFiZWxfc2xvd2VkID0gZ3JvdXA6bGFiZWwoJ1xmPGRvdD5WZWxvY2l0eSBDb2xvcicpOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ1Zpc3VhbHMnIH0sIHZhcnMudmlzdWFscy5zbG93ZWQpCiAgICAgICAgICAgIHZhcnMudmlzdWFscy5jb2xvcl9zbG93ZWQgPSBncm91cDpjb2xvcl9waWNrZXIoJ3ZlbG9jaXR5IGNvbG9yJywgMTk1LDE5OCwyNTUsMjU1KTpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdWaXN1YWxzJyB9LCB2YXJzLnZpc3VhbHMuc2xvd2VkKQogICAgICAgICAgICB2YXJzLnZpc3VhbHMudmVsb2NpdHlfeCA9IGdyb3VwOnNsaWRlcignVmVsb2NpdHkgWCcsIDAsIHgsIHgvMi04MikgCiAgICAgICAgICAgIHZhcnMudmlzdWFscy52ZWxvY2l0eV95ID0gZ3JvdXA6c2xpZGVyKCdWZWxvY2l0eSBZJywgMCwgeSwgeS8yIC0gMzAwKQogICAgICAgICAgICB2YXJzLnZpc3VhbHMudmVsb2NpdHlfeDpzZXRfdmlzaWJsZShmYWxzZSkKICAgICAgICAgICAgdmFycy52aXN1YWxzLnZlbG9jaXR5X3k6c2V0X3Zpc2libGUoZmFsc2UpCiAgICAgICAgICAgIAogICAgICAgICAgICB2YXJzLnZpc3VhbHMubG9ncyA9IGdyb3VwOmNoZWNrYm94KCdMb2cgQWltYm90IFNob3RzJyk6ZGVwZW5kKHsgdmFycy5zZWxlY3Rpb24udGFiLCAnVmlzdWFscycgfSkKICAgICAgICAgICAgdmFycy52aXN1YWxzLmZ1bGxfY29sb3IgPSBncm91cDpjaGVja2JveCgnRnVsbCBDb2xvciBMb2dzJyk6ZGVwZW5kKHsgdmFycy5zZWxlY3Rpb24udGFiLCAnVmlzdWFscycgfSwgdmFycy52aXN1YWxzLmxvZ3MpCiAgICAgICAgICAgIHZhcnMudmlzdWFscy5sYWJlbDQgPSBncm91cDpsYWJlbCgnXGY8ZG90PkhpdCBDb2xvcicpOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ1Zpc3VhbHMnIH0sIHZhcnMudmlzdWFscy5sb2dzKQogICAgICAgICAgICB2YXJzLnZpc3VhbHMuaGl0X2NvbG9yID0gZ3JvdXA6Y29sb3JfcGlja2VyKCdoaXQgY29sb3InLCAxNTAsIDIwMCwgNTksMjU1KTpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdWaXN1YWxzJyB9LHZhcnMudmlzdWFscy5sb2dzKQogICAgICAgICAgICB2YXJzLnZpc3VhbHMubGFiZWw1ID0gZ3JvdXA6bGFiZWwoJ1xmPGRvdD5NaXNzIENvbG9yJyk6ZGVwZW5kKHsgdmFycy5zZWxlY3Rpb24udGFiLCAnVmlzdWFscycgfSx2YXJzLnZpc3VhbHMubG9ncykKICAgICAgICAgICAgdmFycy52aXN1YWxzLm1pc3NfY29sb3IgPSBncm91cDpjb2xvcl9waWNrZXIoJ21pc3MgY29sb3InLCAxNTgsIDY5LCA2OSwgMjU1KTpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdWaXN1YWxzJyB9LHZhcnMudmlzdWFscy5sb2dzKQogICAgICAgICAgICAKICAgICAgICAgICAgcmVmZXJlbmNlLmNvbnNvbGVhOmRlcGVuZCh0cnVlLCB7IHZhcnMudmlzdWFscy5sb2dzLCBmYWxzZSB9KQoKICAgICAgICBlbmQKICAgIAogICAgICAgIGxvY2FsIG1pc2MgZG8KICAgICAgICAgICAgdmFycy5taXNjID0geyB9CiAgICAgICAgCiAgICAgICAgICAgICAgICB2YXJzLm1pc2MuZW5hYmxlZCA9IGdyb3VwOmNoZWNrYm94KCdEcm9wIEdyZW5hZGVzJyk6ZGVwZW5kKHsgdmFycy5zZWxlY3Rpb24udGFiLCAnTWlzYycgfSkKICAgICAgICAgICAgICAgIHZhcnMubWlzYy5oayA9IGdyb3VwOmhvdGtleSgnSG90a2V5JywgdHJ1ZSk6ZGVwZW5kKHsgdmFycy5zZWxlY3Rpb24udGFiLCAnTWlzYyd9LCB2YXJzLm1pc2MuZW5hYmxlZCkKICAgICAgICAgICAgICAgIHZhcnMubWlzYy5zZWxlY3Rpb24gPSBncm91cDptdWx0aXNlbGVjdCgnXGY8ZG90Pkl0ZW1zJywgJ1Ntb2tlJywgJ0hlIEdyZW5hZGUnLCAnTW9sb3Rvdi9JbmNlbmRpYXJ5Jyk6ZGVwZW5kKHsgdmFycy5zZWxlY3Rpb24udGFiLCAnTWlzYyd9LCB2YXJzLm1pc2MuZW5hYmxlZCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdmFycy5taXNjLndhcm11cF9oZWxwZXIgPSBncm91cDpjaGVja2JveCgnV2FybXVwIEhlbHBlcicpOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ01pc2MnfSkKICAgICAgICAgICAgICAgIHZhcnMubWlzYy53YXJtdXBfaGVscGVyOnNldF9jYWxsYmFjayhmdW5jdGlvbiAoc2VsZikKICAgICAgICAgICAgICAgICAgICBpZiBzZWxmOmdldCgpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50LmV4ZWMoInN2X2NoZWF0cyAxOyBzdl9yZWdlbmVyYXRpb25fZm9yY2Vfb24gMTsgbXBfbGltaXR0ZWFtcyAwOyBtcF9hdXRvdGVhbWJhbGFuY2UgMDsgbXBfcm91bmR0aW1lIDYwOyBtcF9yb3VuZHRpbWVfZGVmdXNlIDYwOyBtcF9tYXhtb25leSA2MDAwMDsgbXBfc3RhcnRtb25leSA2MDAwMDsgbXBfZnJlZXpldGltZSAwOyBtcF9idXl0aW1lIDk5OTk7IG1wX2J1eV9hbnl3aGVyZSAxOyBzdl9pbmZpbml0ZV9hbW1vIDE7IGFtbW9fZ3JlbmFkZV9saW1pdF90b3RhbCA1OyBib3Rfa2ljazsgYm90X3N0b3AgMTsgbXBfd2FybXVwX2VuZDsgbXBfcmVzdGFydGdhbWUgMTsgbXBfcmVzcGF3bl9vbl9kZWF0aF9jdCAxOyBtcF9yZXNwYXduX29uX2RlYXRoX3QgMTsgc3ZfYWlyYWNjZWxlcmF0ZSAxMDA7IikgICAKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZCwgdHJ1ZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdmFycy5taXNjLmFzcGVjdHJhdGlvID0gZ3JvdXA6Y2hlY2tib3goJ0FzcGVjdCBSYXRpbycpOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ01pc2MnfSkKICAgICAgICAgICAgICAgIHZhcnMubWlzYy5hc3Bfb2Zmc2V0ID0gZ3JvdXA6c2xpZGVyKCdcZjxkb3Q+QXNwZWN0IFJhdGlvIFZhbHVlJywgMCwyMDAsMCk6ZGVwZW5kKHsgdmFycy5zZWxlY3Rpb24udGFiLCAnTWlzYyd9LCB2YXJzLm1pc2MuYXNwZWN0cmF0aW8pCiAgICAgICAgICAgICAgICB2YXJzLm1pc2MuYXNwZWN0cmF0aW86c2V0X2NhbGxiYWNrKGZ1bmN0aW9uIChzZWxmKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmOmdldCgpIHRoZW4gY3Zhci5yX2FzcGVjdHJhdGlvOnNldF9yYXdfZmxvYXQoMCkgZW5kCiAgICAgICAgICAgICAgICBlbmQsIHRydWUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHZhcnMubWlzYy50aGlyZHBlcnNvbiA9IGdyb3VwOmNoZWNrYm94KCdUaGlyZHBlcnNvbicpOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ01pc2MnfSkKICAgICAgICAgICAgICAgIHZhcnMubWlzYy5kaXN0YW5jZV9zbGlkZXIgPSBncm91cDpzbGlkZXIoIlxmPGRvdD5EaXN0YW5jZSIsIDMwLCAyMDAsIDE1MCk6ZGVwZW5kKHsgdmFycy5zZWxlY3Rpb24udGFiLCAnTWlzYyd9LCB2YXJzLm1pc2MudGhpcmRwZXJzb24pCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHZhcnMubWlzYy52aWV3bW9kZWwgPSBncm91cDpjaGVja2JveCgnVmlld21vZGVsJyk6ZGVwZW5kKHsgdmFycy5zZWxlY3Rpb24udGFiLCAnTWlzYyd9KQogICAgICAgICAgICAgICAgdmFycy5taXNjLnZpZXdtb2RlbF9mb3YgPSBncm91cDpzbGlkZXIoJ1xmPGRvdD5GT1YnLCAwLDEwMCwgNjgpOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ01pc2MnfSwgdmFycy5taXNjLnZpZXdtb2RlbCkKICAgICAgICAgICAgICAgIHZhcnMubWlzYy52aWV3bW9kZWxfeCA9IGdyb3VwOnNsaWRlcignXGY8ZG90PlgnLCAtMTAwLDEwMCwyNSwgdHJ1ZSwnJywgMC4xKTpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdNaXNjJ30sIHZhcnMubWlzYy52aWV3bW9kZWwpCiAgICAgICAgICAgICAgICB2YXJzLm1pc2Mudmlld21vZGVsX3kgPSBncm91cDpzbGlkZXIoJ1xmPGRvdD5ZJywgLTEwMCwxMDAsMCwgdHJ1ZSwnJywgMC4xKTpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdNaXNjJ30sIHZhcnMubWlzYy52aWV3bW9kZWwpCiAgICAgICAgICAgICAgICB2YXJzLm1pc2Mudmlld21vZGVsX3ogPSBncm91cDpzbGlkZXIoJ1xmPGRvdD5aJywgLTEwMCwxMDAsLTE1LCB0cnVlLCcnLCAwLjEpOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ01pc2MnfSwgdmFycy5taXNjLnZpZXdtb2RlbCkKICAgICAgICAgICAgICAgIHZhcnMubWlzYy52aWV3bW9kZWw6c2V0X2NhbGxiYWNrKGZ1bmN0aW9uIChzZWxmKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmOmdldCgpIHRoZW4gY3Zhci52aWV3bW9kZWxfZm92OnNldF9yYXdfZmxvYXQoNjgpIGN2YXIudmlld21vZGVsX29mZnNldF94OnNldF9yYXdfZmxvYXQoMi41KSBjdmFyLnZpZXdtb2RlbF9vZmZzZXRfeTpzZXRfcmF3X2Zsb2F0KDApIGN2YXIudmlld21vZGVsX29mZnNldF96OnNldF9yYXdfZmxvYXQoLTEuNSkgZW5kCiAgICAgICAgICAgICAgICBlbmQsIHRydWUpCgogICAgICAgIGVuZAogICAgCiAgICAgICAgbG9jYWwgY29uZmlncyBkbwogICAgICAgICAgICB2YXJzLmNvbmZpZ3MgPSB7IH0KCiAgICAgICAgICAgIHZhcnMuY29uZmlncy5jZmdfbGFiZWwgPSBncm91cF9vdGhlcjpsYWJlbCgnXGY8ZG90Pk5ldyBDb25maWcnKTpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdDb25maWdzJ30pCiAgICAgICAgICAgIHZhcnMuY29uZmlncy5saXN0ID0gZ3JvdXA6bGlzdGJveCgnXG5Db25maWcgTGlzdCcsIHsgJ05vIENvbmZpZ3MhJyB9LCAnJywgZmFsc2UpOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ0NvbmZpZ3MnIH0pCiAgICAgICAgICAgIHZhcnMuY29uZmlncy5uYW1lID0gZ3JvdXBfb3RoZXI6dGV4dGJveCgnXG5Db25maWcgTmFtZScsICcnLCBmYWxzZSk6ZGVwZW5kKHsgdmFycy5zZWxlY3Rpb24udGFiLCAnQ29uZmlncycgfSkKICAgICAgICAgICAgdmFycy5jb25maWdzLmxvYWQgPSBncm91cDpidXR0b24oJ0xvYWQnLCBuaWwsIHRydWUpOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ0NvbmZpZ3MnIH0pCiAgICAgICAgICAgIHZhcnMuY29uZmlncy5jcmVhdGUgPSBncm91cF9vdGhlcjpidXR0b24oJ0NyZWF0ZScsIG5pbCwgdHJ1ZSk6ZGVwZW5kKHsgdmFycy5zZWxlY3Rpb24udGFiLCAnQ29uZmlncycgfSkKICAgICAgICAgICAgdmFycy5jb25maWdzLnNhdmUgPSBncm91cDpidXR0b24oJ1NhdmUnLCBuaWwsIHRydWUpOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ0NvbmZpZ3MnIH0pCiAgICAgICAgICAgIHZhcnMuY29uZmlncy5leHBvcnQgPSBncm91cDpidXR0b24oJ0V4cG9ydCcsIG5pbCwgdHJ1ZSk6ZGVwZW5kKHsgdmFycy5zZWxlY3Rpb24udGFiLCAnQ29uZmlncycgfSkKICAgICAgICAgICAgdmFycy5jb25maWdzLmltcG9ydCA9IGdyb3VwX290aGVyOmJ1dHRvbignSW1wb3J0JywgbmlsLCB0cnVlKTpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdDb25maWdzJyB9KQogICAgICAgICAgICB2YXJzLmNvbmZpZ3MuZGVsZXRlID0gZ3JvdXA6YnV0dG9uKCdEZWxldGUnLCBuaWwsIHRydWUpOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ0NvbmZpZ3MnIH0pCgoKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgc3RhdGlzdGljcyBkbwogICAgICAgICAgICB2YXJzLnN0YXRpc3RpY3MgPSB7IH0KCiAgICAgICAgICAgIHZhcnMuc3RhdGlzdGljcy5sYWJlbDE0NCA9IGdyb3VwX290aGVyOmxhYmVsKCdcZjxkb3Q+SW5mb3JtYXRpb24nKTpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdBbnRpIEFpbScsICdWaXN1YWxzJywgJ01pc2MnfSkKICAgICAgICAgICAgdmFycy5zdGF0aXN0aWNzLnVzZXIgPSBncm91cF9vdGhlcjpsYWJlbCgnXGY8ZG90PlVzZXI6IFx2Jy4ubG9hZGVyLnVzZXJuYW1lKTpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdBbnRpIEFpbScsICdWaXN1YWxzJywgJ01pc2MnfSkKICAgICAgICAgICAgdmFycy5zdGF0aXN0aWNzLmxvYWRlZCA9IGdyb3VwX290aGVyOmxhYmVsKCdcZjxkb3Q+VGltZXMgTG9hZGVkOiBcdicpOmRlcGVuZCh7IHZhcnMuc2VsZWN0aW9uLnRhYiwgJ0FudGkgQWltJywgJ1Zpc3VhbHMnLCAnTWlzYyd9KQogICAgICAgICAgICB2YXJzLnN0YXRpc3RpY3MudGltZV9pbl9nYW1lID0gZ3JvdXBfb3RoZXI6bGFiZWwoJ1xmPGRvdD5TZXNzaW9uOiAnKTpkZXBlbmQoeyB2YXJzLnNlbGVjdGlvbi50YWIsICdBbnRpIEFpbScsICdWaXN1YWxzJywgJ01pc2MnfSkKICAgICAgICAgICAgCiAgICAgICAgZW5kCgoKCmhlbHBlcnNbJ2Z1bmN0aW9ucyddID0gewogICAgYWxwaGFfdmVsID0gc21vb3RoeSgwKSwgaXNfYmRfYWxwaGEgPSBzbW9vdGh5KDApLCB2ZWxvY2l0eV9zbW90aCA9IHNtb290aHkoMCksIHRpbWUgPSBnbG9iYWxzLnJlYWx0aW1lKCksIHNpZGUgPSAwLCAgcHJldl9zaWRlID0gMCwgY2FuYmVwcmVzc2VkID0gdHJ1ZSwgZGFtYWdlX2FuaW0gPSAwLCBkZWZlbnNpdmVfdGlja3MgPSAwLCBpc19iYWNrc3RhYiA9IGZhbHNlLCBncmVuYWRlc19saXN0ID0geyB9LCBwcmV2X3dwbiwgaGl0bWFya2VyX2RhdGEgPSB7fSxmcmFtZXJhdGUgPSAwLCBsYXN0X2ZyYW1lcmF0ZSA9IDAsIHRpY2tzID0gMCwgZGVsYXllZF9zd2l0Y2ggPSBmYWxzZSwKICAgIGlzX2JvdW5kZWQgPSBmdW5jdGlvbihzZWxmLCB2ZWMxX3gsIHZlYzFfeSwgdmVjMl94LCB2ZWMyX3kpIGxvY2FsIG1vdXNlX3Bvc194LCBtb3VzZV9wb3NfeSA9IHVpLm1vdXNlX3Bvc2l0aW9uKCkgcmV0dXJuIG1vdXNlX3Bvc194ID49IHZlYzFfeCBhbmQgbW91c2VfcG9zX3ggPD0gdmVjMl94IGFuZCBtb3VzZV9wb3NfeSA+PSB2ZWMxX3kgYW5kIG1vdXNlX3Bvc195IDw9IHZlYzJfeSBlbmQsCiAgICBsZXJwID0gZnVuY3Rpb24gKHNlbGYsIHN0YXJ0LCBlbmRfLCBzcGVlZCwgZGVsdGEpIGlmIGVudGl0eS5nZXRfcHJvcChlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCAnbV9iSXNTY29wZWQnKSA9PSAwIHRoZW4gbG9jYWwgdGltZSA9IGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAoMykgcmV0dXJuICgoZW5kXyApICogdGltZSArIHN0YXJ0KSBlbHNlIGxvY2FsIHRpbWUgPSBnbG9iYWxzLmZyYW1ldGltZSgpICogKDUpIHJldHVybiAoKGVuZF8gKSAqIHRpbWUgKyBzdGFydCkgZW5kIGVuZCwKICAgIGdldF9kYW1hZ2UgPSBmdW5jdGlvbihzZWxmKSBpZiB1aS5nZXQocmVmZXJlbmNlLmRtZ1sxXSkgYW5kIHVpLmdldChyZWZlcmVuY2UuZG1nWzJdKSB0aGVuIHJldHVybiB1aS5nZXQocmVmZXJlbmNlLmRtZ1szXSkgZW5kIHJldHVybiB1aS5nZXQocmVmZXJlbmNlLmRtZzEpIGVuZCwKICAgIGdldF9wbGF5ZXJfd2VhcG9ucyA9IGZ1bmN0aW9uKHNlbGYsIGVudCkgbG9jYWwgd2VhcG9ucyA9IHsgfTsgZm9yIGkgPSAwLCA2MyBkbyBsb2NhbCB3ZWFwb24gPSBlbnRpdHkuZ2V0X3Byb3AoZW50LCAibV9oTXlXZWFwb25zIiwgaSk7IGlmIHdlYXBvbiA9PSBuaWwgdGhlbiBnb3RvIGNvbnRpbnVlOyBlbmQgd2VhcG9uc1sjd2VhcG9ucyArIDFdID0gd2VhcG9uOyA6OmNvbnRpbnVlOjogZW5kIHJldHVybiB3ZWFwb25zOyBlbmQsCiAgICBpc19jbGFzc19ncmVuYWRlcyA9IGZ1bmN0aW9uKHNlbGYsIGl0ZW1fY2xhc3MpIGlmIGl0ZW1fY2xhc3MgPT0gIndlYXBvbl9zbW9rZWdyZW5hZGUiIHRoZW4gcmV0dXJuIHZhcnMubWlzYy5zZWxlY3Rpb246Z2V0KCJTbW9rZSIpOyBlbmQgaWYgaXRlbV9jbGFzcyA9PSAid2VhcG9uX2hlZ3JlbmFkZSIgdGhlbiByZXR1cm4gdmFycy5taXNjLnNlbGVjdGlvbjpnZXQoIkhlIEdyZW5hZGUiKTsgZW5kIGlmIGl0ZW1fY2xhc3MgPT0gIndlYXBvbl9pbmNncmVuYWRlIiBvciBpdGVtX2NsYXNzID09ICJ3ZWFwb25fbW9sb3RvdiIgdGhlbiByZXR1cm4gdmFycy5taXNjLnNlbGVjdGlvbjpnZXQoIk1vbG90b3YvSW5jZW5kaWFyeSIpOyBlbmQgcmV0dXJuIGZhbHNlOyBlbmQsCiAgICBpc19uZWVkZWRfd2VhcG9uID0gZnVuY3Rpb24oc2VsZiwgd2VhcG9uKSBsb2NhbCBpbmZvID0gY193ZWFwb24od2VhcG9uKTsgaWYgaW5mby53ZWFwb25fdHlwZV9pbnQgfj0gOSB0aGVuIHJldHVybiBmYWxzZTsgZW5kIGlmIG5vdCBzZWxmOmlzX2NsYXNzX2dyZW5hZGVzKGluZm8uaXRlbV9jbGFzcykgdGhlbiByZXR1cm4gZmFsc2U7IGVuZCByZXR1cm4gdHJ1ZTsgZW5kLAogICAgdXBkYXRlX3BsYXllcl93ZWFwb25zID0gZnVuY3Rpb24oc2VsZiwgZW50KSBsb2NhbCB3ZWFwb25zID0gc2VsZjpnZXRfcGxheWVyX3dlYXBvbnMoZW50KTsgZm9yIGkgPSAxLCAjd2VhcG9ucyBkbyBsb2NhbCB3ZWFwb24gPSB3ZWFwb25zW2ldOyBpZiBub3Qgc2VsZjppc19uZWVkZWRfd2VhcG9uKHdlYXBvbikgdGhlbiBnb3RvIGNvbnRpbnVlOyBlbmQgc2VsZi5ncmVuYWRlc19saXN0WyNzZWxmLmdyZW5hZGVzX2xpc3QgKyAxXSA9IHdlYXBvbjsgOjpjb250aW51ZTo6IGVuZCBlbmQsCiAgICBsZXJwMiA9IGZ1bmN0aW9uKHNlbGYsIHgsIHYsIHQpIGlmIHR5cGUoeCkgPT0gJ3RhYmxlJyB0aGVuIHJldHVybiBzZWxmOmxlcnAyKHhbMV0sIHZbMV0sIHQpLCBzZWxmOmxlcnAyKHhbMl0sIHZbMl0sIHQpLCBzZWxmOmxlcnAyKHhbM10sIHZbM10sIHQpLCBzZWxmOmxlcnAyKHhbNF0sIHZbNF0sIHQpIGVuZCBsb2NhbCBkZWx0YSA9IHYgLSB4IGlmIHR5cGUoZGVsdGEpID09ICdudW1iZXInIHRoZW4gaWYgbWF0aC5hYnMoZGVsdGEpIDwgMC4wMDUgdGhlbiByZXR1cm4gdiBlbmQgZW5kIHJldHVybiBkZWx0YSAqIHQgKyB4IGVuZCwKICAgIGlzX2R0X2NoYXJnZWQgPSBmdW5jdGlvbihzZWxmKSBpZiBub3QgZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSB0aGVuIHJldHVybiBlbmQgbG9jYWwgd2VhcG9uID0gZW50aXR5LmdldF9wbGF5ZXJfd2VhcG9uKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkpIGlmIGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkgPT0gbmlsIG9yIHdlYXBvbiA9PSBuaWwgdGhlbiByZXR1cm4gZmFsc2UgZW5kIGlmIGdsb2JhbHMuY3VydGltZSgpIC0gKDE2ICogZ2xvYmFscy50aWNraW50ZXJ2YWwoKSkgPCBlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSwgJ21fZmxOZXh0QXR0YWNrJykgdGhlbiByZXR1cm4gZmFsc2UgZW5kIGlmIGdsb2JhbHMuY3VydGltZSgpIC0gKDAgKiBnbG9iYWxzLnRpY2tpbnRlcnZhbCgpKSA8IGVudGl0eS5nZXRfcHJvcCh3ZWFwb24sICdtX2ZsTmV4dFByaW1hcnlBdHRhY2snKSB0aGVuIHJldHVybiBmYWxzZSBlbmQgcmV0dXJuIHRydWUgZW5kLAogICAgaXNfZGVmZW5zaXZlID0gZnVuY3Rpb24oc2VsZiwgaW5kZXgpIHNlbGYuZGVmZW5zaXZlX3RpY2tzID0gbWF0aC5tYXgoZW50aXR5LmdldF9wcm9wKGluZGV4LCAnbV9uVGlja0Jhc2UnKSwgc2VsZi5kZWZlbnNpdmVfdGlja3Mgb3IgMCkgcmV0dXJuIG1hdGguYWJzKGVudGl0eS5nZXRfcHJvcChpbmRleCwgJ21fblRpY2tCYXNlJykgLSBzZWxmLmRlZmVuc2l2ZV90aWNrcykgPiAyIGFuZCBtYXRoLmFicyhlbnRpdHkuZ2V0X3Byb3AoaW5kZXgsICdtX25UaWNrQmFzZScpIC0gc2VsZi5kZWZlbnNpdmVfdGlja3MpIDwgMTQgZW5kLAogICAgY29udGFpbnMgPSBmdW5jdGlvbihzZWxmLCBpbnB1dFN0cmluZykgaWYgdHlwZShpbnB1dFN0cmluZykgPT0gInN0cmluZyIgdGhlbiBpZiBzdHJpbmcuZmluZChpbnB1dFN0cmluZywgIiVzIikgfj0gbmlsIGFuZCBzdHJpbmcuZmluZChpbnB1dFN0cmluZywgIiVTIikgfj0gbmlsIHRoZW4gbG9jYWwgaGFzU3BhY2UgPSBzdHJpbmcuZmluZChpbnB1dFN0cmluZywgIiVzIikgfj0gbmlsIGxvY2FsIGhhc0NoYXJhY3RlcnMgPSBzdHJpbmcuZmluZChpbnB1dFN0cmluZywgIiVTIikgfj0gbmlsIHJldHVybiBoYXNTcGFjZSBhbmQgaGFzQ2hhcmFjdGVycyBlbHNlaWYgc3RyaW5nLmZpbmQoaW5wdXRTdHJpbmcsICIlcyIpID09IG5pbCBhbmQgc3RyaW5nLmZpbmQoaW5wdXRTdHJpbmcsICIlUyIpIH49IG5pbCB0aGVuIGxvY2FsIGhhc1NwYWNlID0gc3RyaW5nLmZpbmQoaW5wdXRTdHJpbmcsICIlcyIpID09IG5pbCBsb2NhbCBoYXNDaGFyYWN0ZXJzID0gc3RyaW5nLmZpbmQoaW5wdXRTdHJpbmcsICIlUyIpIH49IG5pbCByZXR1cm4gaGFzU3BhY2UgYW5kIGhhc0NoYXJhY3RlcnMgZWxzZSByZXR1cm4gZmFsc2UgZW5kIGVsc2UgcmV0dXJuIGZhbHNlICBlbmQgZW5kLAogICAgYW5pbWF0aW9ucyA9IChmdW5jdGlvbiAoKWxvY2FsIGE9e2RhdGE9e319ZnVuY3Rpb24gYTpjbGFtcChiLGMsZClyZXR1cm4gbWF0aC5taW4oZCxtYXRoLm1heChjLGIpKWVuZDtmdW5jdGlvbiBhOmFuaW1hdGUoZSxmLGcpaWYgbm90IHNlbGYuZGF0YVtlXXRoZW4gc2VsZi5kYXRhW2VdPTAgZW5kO2c9ZyBvciA0O2xvY2FsIGI9Z2xvYmFscy5mcmFtZXRpbWUoKSpnKihmIGFuZC0xIG9yIDEpc2VsZi5kYXRhW2VdPXNlbGY6Y2xhbXAoc2VsZi5kYXRhW2VdK2IsMCwxKXJldHVybiBzZWxmLmRhdGFbZV1lbmQ7cmV0dXJuIGEgZW5kKSgpLAogICAgcmdiYV90b19oZXggPSBmdW5jdGlvbihzZWxmLGIsYyxkLGUpIHJldHVybiBzdHJpbmcuZm9ybWF0KCclMDJ4JTAyeCUwMnglMDJ4JyxiLGMsZCxlKSBlbmQsCiAgICBmYWRlX2hhbmRsZSA9IGZ1bmN0aW9uKHNlbGYsIHRpbWUsIHN0cmluZywgciwgZywgYiwgYSkgbG9jYWwgY29sb3IxLCBjb2xvcjIsIGNvbG9yMywgY29sb3I0ID0gdmFycy52aXN1YWxzLndhdGVybWFya19jb2xvcjI6Z2V0KCkgbG9jYWwgdF9vdXQsIHRfb3V0X2l0ZXIgPSB7IH0sIDEgbG9jYWwgbCA9IHN0cmluZzpsZW4oICkgLSAxIGxvY2FsIHJfYWRkID0gKGNvbG9yMSAtIHIpIGxvY2FsIGdfYWRkID0gKGNvbG9yMiAtIGcpIGxvY2FsIGJfYWRkID0gKGNvbG9yMyAtIGIpIGZvciBpID0gMSwgI3N0cmluZyBkbyBsb2NhbCBpdGVyID0gKGkgLSAxKS8oI3N0cmluZyAtIDEpICsgdGltZSB0X291dFt0X291dF9pdGVyXSA9ICJcYSIgLi4gc2VsZjpyZ2JhX3RvX2hleCggciArIHJfYWRkICogbWF0aC5hYnMobWF0aC5jb3MoIGl0ZXIgKSksIGcgKyBnX2FkZCAqIG1hdGguYWJzKG1hdGguY29zKCBpdGVyICkpLCBiICsgYl9hZGQgKiBtYXRoLmFicyhtYXRoLmNvcyggaXRlciApKSwgYSAgKSB0X291dFt0X291dF9pdGVyICsgMV0gPSBzdHJpbmc6c3ViKCBpLCBpICkgdF9vdXRfaXRlciA9IHRfb3V0X2l0ZXIgKyAyIGVuZCByZXR1cm4gdF9vdXQgZW5kLAogICAgZmFkZV9oYW5kbGUyID0gZnVuY3Rpb24oc2VsZiwgdGltZSwgc3RyaW5nLCByLCBnLCBiLCBhKSBsb2NhbCBjb2xvcjEsIGNvbG9yMiwgY29sb3IzLCBjb2xvcjQgPSAzMiwgMzIsIDMyLCAyNTUgbG9jYWwgdF9vdXQsIHRfb3V0X2l0ZXIgPSB7IH0sIDEgbG9jYWwgbCA9IHN0cmluZzpsZW4oICkgLSAxIGxvY2FsIHJfYWRkID0gKGNvbG9yMSAtIHIpIGxvY2FsIGdfYWRkID0gKGNvbG9yMiAtIGcpIGxvY2FsIGJfYWRkID0gKGNvbG9yMyAtIGIpIGZvciBpID0gMSwgI3N0cmluZyBkbyBsb2NhbCBpdGVyID0gKGkgLSAxKS8oI3N0cmluZyAtIDEpICsgdGltZSB0X291dFt0X291dF9pdGVyXSA9ICJcYSIgLi4gc2VsZjpyZ2JhX3RvX2hleCggciArIHJfYWRkICogbWF0aC5hYnMobWF0aC5jb3MoIGl0ZXIgKSksIGcgKyBnX2FkZCAqIG1hdGguYWJzKG1hdGguY29zKCBpdGVyICkpLCBiICsgYl9hZGQgKiBtYXRoLmFicyhtYXRoLmNvcyggaXRlciApKSwgYSAgKSB0X291dFt0X291dF9pdGVyICsgMV0gPSBzdHJpbmc6c3ViKCBpLCBpICkgdF9vdXRfaXRlciA9IHRfb3V0X2l0ZXIgKyAyIGVuZCByZXR1cm4gdF9vdXQgZW5kLAogICAgbWFudWFsYWEgPSBmdW5jdGlvbihzZWxmKSBpZiBub3QgdmFycy5hYS5lbmNoYTpnZXQoIk1hbnVhbCBBQSIpIHRoZW4gc2VsZi5zaWRlID0gMCByZXR1cm4gMCBlbmQgc2VsZi5jYW5iZXByZXNzZWQgPSBzZWxmLnRpbWUrMC4yIDwgZ2xvYmFscy5yZWFsdGltZSgpIGlmICB2YXJzLmFhLm1hbnVhbF9sZWZ0OmdldCgpIGFuZCBzZWxmLmNhbmJlcHJlc3NlZCB0aGVuIHNlbGYuc2lkZSA9IDEgaWYgc2VsZi5wcmV2X3NpZGUgPT0gc2VsZi5zaWRlIHRoZW4gc2VsZi5zaWRlID0gMCBlbmQgc2VsZi50aW1lID0gZ2xvYmFscy5yZWFsdGltZSgpIGVuZCBpZiB2YXJzLmFhLm1hbnVhbF9yaWdodDpnZXQoKSBhbmQgc2VsZi5jYW5iZXByZXNzZWQgdGhlbiBzZWxmLnNpZGUgPSAyIGlmIHNlbGYucHJldl9zaWRlID09c2VsZi5zaWRlIHRoZW4gc2VsZi5zaWRlID0gMCBlbmQgc2VsZi50aW1lID0gZ2xvYmFscy5yZWFsdGltZSgpIGVuZCBzZWxmLnByZXZfc2lkZSA9IHNlbGYuc2lkZSBpZiBzZWxmLnNpZGUgPT0gMSB0aGVuIHJldHVybiAxIGVuZCAgaWYgc2VsZi5zaWRlID09IDIgdGhlbiByZXR1cm4gMiBlbmQgIGlmIHNlbGYuc2lkZSA9PSAwIHRoZW4gcmV0dXJuIDAgZW5kIGVuZCwKICAgIHVwZGF0ZV9zZXNzaW9uID0gZnVuY3Rpb24oc2VsZikgbG9jYWwgc2Vjb25kc19zZXMgPSBtYXRoLmZsb29yKGdsb2JhbHMucmVhbHRpbWUoKSkgbG9jYWwgaG91cnNfc2VzID0gbWF0aC5mbG9vcihnbG9iYWxzLnJlYWx0aW1lKCkvMzYwMCkgbG9jYWwgbWludXRlc19zZXMgPSBtYXRoLmZsb29yKGdsb2JhbHMucmVhbHRpbWUoKS82MCkgaWYgc2Vjb25kc19zZXMgPT0gMSBhbmQgaG91cnNfc2VzIDwgMSBhbmQgbWludXRlc19zZXMgPCAxIHRoZW4gdGV4dCA9IHNlY29uZHNfc2VzLi4iIFNlY29uZCIgZWxzZWlmIHNlY29uZHNfc2VzID49IDIgYW5kIGhvdXJzX3NlcyA8IDEgYW5kIG1pbnV0ZXNfc2VzIDwgMSB0aGVuIHRleHQgPSBzZWNvbmRzX3Nlcy4uIiBTZWNvbmRzIiBlbHNlaWYgbWludXRlc19zZXMgPj0gMiBhbmQgaG91cnNfc2VzIDwgMSB0aGVuIHRleHQgPSBtaW51dGVzX3Nlcy4uIiBNaW51dGVzIiBlbHNlaWYgbWludXRlc19zZXMgPT0gMSBhbmQgaG91cnNfc2VzIDwgMSB0aGVuIHRleHQgPSBtaW51dGVzX3Nlcy4uIiBNaW51dGUiIGVsc2VpZiBob3Vyc19zZXMgPCAyIHRoZW4gdGV4dCA9IGhvdXJzX3Nlcy4uIiBIb3VyIiBlbHNlaWYgaG91cnNfc2VzID49IDIgdGhlbiB0ZXh0ID0gaG91cnNfc2VzLi4iIEhvdXJzIiBlbmQgdmFycy5zdGF0aXN0aWNzLnRpbWVfaW5fZ2FtZTpzZXQoJ1xmPGRvdD5TZXNzaW9uOiBcdicuLnRleHQpIGVuZCwKfQpzeXN0ZW0ucmVnaXN0ZXIgPSBmdW5jdGlvbihwb3NpdGlvbiwgc2l6ZSwgZ2xvYmFsX25hbWUsIGluc19mdW5jdGlvbikgbG9jYWwgZGF0YSA9IHsgc2l6ZSA9IHNpemUsIHBvc2l0aW9uID0gdmVjdG9yKHBvc2l0aW9uWzFdOmdldCgpLCBwb3NpdGlvblsyXTpnZXQoKSksIGlzX2RyYWdnaW5nID0gZmFsc2UsIGRyYWdfcG9zaXRpb24gPSB2ZWN0b3IoKSwgZ2xvYmFsX25hbWUgPSBnbG9iYWxfbmFtZSwgaW5zX2Z1bmN0aW9uID0gaW5zX2Z1bmN0aW9uLCB1aV9jYWxsYmFja3MgPSB7eCA9IHBvc2l0aW9uWzFdLCB5ID0gcG9zaXRpb25bMl19IH0gdGFibGUuaW5zZXJ0KHN5c3RlbS53aW5kb3dzLCBkYXRhKSByZXR1cm4gc2V0bWV0YXRhYmxlKGRhdGEsIHN5c3RlbSkgZW5kCmZ1bmN0aW9uIHN5c3RlbTpsaW1pdF9wb3NpdGlvbnMoKSBpZiBzZWxmLnBvc2l0aW9uLnggPD0gMCB0aGVuIHNlbGYucG9zaXRpb24ueCA9IDAgZW5kIGlmIHNlbGYucG9zaXRpb24ueCArIHNlbGYuc2l6ZS54ID49IHNjcmVlbl9zaXplX3ggLSAxIHRoZW4gc2VsZi5wb3NpdGlvbi54ID0gc2NyZWVuX3NpemVfeCAtIHNlbGYuc2l6ZS54IC0gMSBlbmQgaWYgc2VsZi5wb3NpdGlvbi55IDw9IDAgdGhlbiBzZWxmLnBvc2l0aW9uLnkgPSAwIGVuZCBpZiBzZWxmLnBvc2l0aW9uLnkgKyBzZWxmLnNpemUueSA+PSBzY3JlZW5fc2l6ZV95IC0gMSB0aGVuIHNlbGYucG9zaXRpb24ueSA9IHNjcmVlbl9zaXplX3kgLSBzZWxmLnNpemUueSAtIDEgZW5kIGVuZApmdW5jdGlvbiBzeXN0ZW06aXNfaW5fYXJlYShtb3VzZV9wb3NpdGlvbikgcmV0dXJuIG1vdXNlX3Bvc2l0aW9uLnggPj0gc2VsZi5wb3NpdGlvbi54IGFuZCBtb3VzZV9wb3NpdGlvbi54IDw9IHNlbGYucG9zaXRpb24ueCArIHNlbGYuc2l6ZS54IGFuZCBtb3VzZV9wb3NpdGlvbi55ID49IHNlbGYucG9zaXRpb24ueSBhbmQgbW91c2VfcG9zaXRpb24ueSA8PSBzZWxmLnBvc2l0aW9uLnkgKyBzZWxmLnNpemUueSBlbmQKZnVuY3Rpb24gc3lzdGVtOnVwZGF0ZSguLi4pIGlmIHVpLmlzX21lbnVfb3BlbigpIHRoZW4gbG9jYWwgbW91c2VfcG9zaXRpb24gPSB2ZWN0b3IodWkubW91c2VfcG9zaXRpb24oKSkgbG9jYWwgaXNfaW5fYXJlYSA9IHNlbGY6aXNfaW5fYXJlYShtb3VzZV9wb3NpdGlvbikgbG9jYWwgbGlzdCA9IHN5c3RlbS5saXN0IGxvY2FsIGlzX2tleV9wcmVzc2VkID0gY2xpZW50LmtleV9zdGF0ZSgxKSBpZiAoaXNfaW5fYXJlYSBvciBzZWxmLmlzX2RyYWdnaW5nKSBhbmQgaXNfa2V5X3ByZXNzZWQgYW5kIChsaXN0LnRhcmdldCA9PSAiIiBvciBsaXN0LnRhcmdldCA9PSBzZWxmLmdsb2JhbF9uYW1lKSB0aGVuIGxpc3QudGFyZ2V0ID0gc2VsZi5nbG9iYWxfbmFtZSBpZiBub3Qgc2VsZi5pc19kcmFnZ2luZyB0aGVuIHNlbGYuaXNfZHJhZ2dpbmcgPSB0cnVlIHNlbGYuZHJhZ19wb3NpdGlvbiA9IG1vdXNlX3Bvc2l0aW9uIC0gc2VsZi5wb3NpdGlvbiBlbHNlIHNlbGYucG9zaXRpb24gPSBtb3VzZV9wb3NpdGlvbiAtIHNlbGYuZHJhZ19wb3NpdGlvbiBzZWxmOmxpbWl0X3Bvc2l0aW9ucygpIHNlbGYudWlfY2FsbGJhY2tzLng6c2V0KG1hdGguZmxvb3Ioc2VsZi5wb3NpdGlvbi54KSkgc2VsZi51aV9jYWxsYmFja3MueTpzZXQobWF0aC5mbG9vcihzZWxmLnBvc2l0aW9uLnkpKSBlbmQgZWxzZWlmIG5vdCBpc19rZXlfcHJlc3NlZCB0aGVuIGxpc3QudGFyZ2V0ID0gIiIgc2VsZi5pc19kcmFnZ2luZyA9IGZhbHNlIHNlbGYuZHJhZ19wb3NpdGlvbiA9IHZlY3RvcigpIGVuZCBlbmQgc2VsZi5pbnNfZnVuY3Rpb24oc2VsZiwgLi4uKSBlbmQKCmhpZGVfbWVudSA9IGZ1bmN0aW9uKHN0YXRlKQogICAgCiAgICB1aS5zZXRfdmlzaWJsZShyZWZlcmVuY2UubHVhLCBzdGF0ZSkKICAgIHVpLnNldF92aXNpYmxlKHJlZmVyZW5jZS5waXRjaFsxXSwgc3RhdGUpCiAgICB1aS5zZXRfdmlzaWJsZShyZWZlcmVuY2UucGl0Y2hbMl0sc3RhdGUpCiAgICB1aS5zZXRfdmlzaWJsZShyZWZlcmVuY2Uucm9sbCxzdGF0ZSkKICAgIHVpLnNldF92aXNpYmxlKHJlZmVyZW5jZS55YXdiYXNlLHN0YXRlKQogICAgdWkuc2V0X3Zpc2libGUocmVmZXJlbmNlLnlhd1sxXSxzdGF0ZSkKICAgIHVpLnNldF92aXNpYmxlKHJlZmVyZW5jZS55YXdbMl0sc3RhdGUpCiAgICB1aS5zZXRfdmlzaWJsZShyZWZlcmVuY2UueWF3aml0dGVyWzFdLHN0YXRlKQogICAgdWkuc2V0X3Zpc2libGUocmVmZXJlbmNlLnlhd2ppdHRlclsyXSxzdGF0ZSkKICAgIHVpLnNldF92aXNpYmxlKHJlZmVyZW5jZS5ib2R5eWF3WzFdLHN0YXRlKQogICAgdWkuc2V0X3Zpc2libGUocmVmZXJlbmNlLmJvZHl5YXdbMl0sc3RhdGUpCiAgICB1aS5zZXRfdmlzaWJsZShyZWZlcmVuY2UuZnJlZXN0YW5kWzFdLHN0YXRlKQogICAgdWkuc2V0X3Zpc2libGUocmVmZXJlbmNlLmZyZWVzdGFuZFsyXSxzdGF0ZSkKICAgIHVpLnNldF92aXNpYmxlKHJlZmVyZW5jZS5mc2JvZHl5YXcsc3RhdGUpCiAgICB1aS5zZXRfdmlzaWJsZShyZWZlcmVuY2UuZWRnZXlhdyxzdGF0ZSkKICAgIHVpLnNldF92aXNpYmxlKHJlZmVyZW5jZS5lbmFibGVbMV0sc3RhdGUpCiAgICB1aS5zZXRfdmlzaWJsZShyZWZlcmVuY2UuZW5hYmxlWzJdLHN0YXRlKQogICAgdWkuc2V0X3Zpc2libGUocmVmZXJlbmNlLmFtb3VudCxzdGF0ZSkKICAgIHVpLnNldF92aXNpYmxlKHJlZmVyZW5jZS52YXJpYW5jZSxzdGF0ZSkKICAgIHVpLnNldF92aXNpYmxlKHJlZmVyZW5jZS5saW1pdCxzdGF0ZSkKICAgIHVpLnNldF92aXNpYmxlKHJlZmVyZW5jZS5zbG93WzFdLHN0YXRlKQogICAgdWkuc2V0X3Zpc2libGUocmVmZXJlbmNlLnNsb3dbMl0sc3RhdGUpCiAgICB1aS5zZXRfdmlzaWJsZShyZWZlcmVuY2UuaHNbMV0sc3RhdGUpCiAgICB1aS5zZXRfdmlzaWJsZShyZWZlcmVuY2UuaHNbMl0sc3RhdGUpCiAgICB1aS5zZXRfdmlzaWJsZShyZWZlcmVuY2UuZnBbMV0sc3RhdGUpCiAgICB1aS5zZXRfdmlzaWJsZShyZWZlcmVuY2UuZnBbMl0sc3RhdGUpCiAgICB1aS5zZXRfdmlzaWJsZShyZWZlcmVuY2UuYW1vdW50LHN0YXRlKQogICAgdWkuc2V0X3Zpc2libGUocmVmZXJlbmNlLmxpbWl0LHN0YXRlKQogICAgcmVmZXJlbmNlLmxtOnNldF92aXNpYmxlKHN0YXRlKQoKZW5kCgoKTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQoKICAgIGxvY2FsIGRiIGRvCiAgICAgICAgZGIgPSB7IH0KICAgIAogICAgICAgIHNldG1ldGF0YWJsZShkYiwgewogICAgICAgICAgICBfX2luZGV4ID0gZnVuY3Rpb24gKHNlbGYsIGtleSkKICAgICAgICAgICAgICAgIHJldHVybiBkYXRhYmFzZS5yZWFkKGtleSkKICAgICAgICAgICAgZW5kLAogICAgCiAgICAgICAgICAgIF9fbmV3aW5kZXggPSBmdW5jdGlvbiAoc2VsZiwga2V5LCB2YWx1ZSkKICAgICAgICAgICAgICAgIHJldHVybiBkYXRhYmFzZS53cml0ZShrZXksIHZhbHVlKQogICAgICAgICAgICBlbmQKICAgICAgICB9KQogICAgZW5kIAoKICAgIGxvY2FsIGRhdGEgPSBkYi5jb25maWdzX2RhdGFfYW1waGliaWFfbHVhIG9yIHsgfQogICAgbG9jYWwgbG9hZGVkX3RpbWVzID0gZGIubG9hZGVkX3RpbWVzX2FtcGhpYmlhX2x1YSBvciAxOwogICAgbG9hZGVkX3RpbWVzID0gbG9hZGVkX3RpbWVzICsgMTsKCgogICAgY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygncGFpbnRfdWknLCBmdW5jdGlvbigpCgogICAgICAgIHZhcnMuc3RhdGlzdGljcy5sb2FkZWQ6c2V0KCdcZjxkb3Q+VGltZXMgTG9hZGVkOiBcdicuLmRiLmxvYWRlZF90aW1lc19hbXBoaWJpYV9sdWEpCgogICAgZW5kKQogICAgZGIubG9hZGVkX3RpbWVzX2FtcGhpYmlhX2x1YSA9IGxvYWRlZF90aW1lczsKCgogICAgaWYgdHlwZShkYXRhKSB+PSAndGFibGUnIHRoZW4KICAgICAgICBkYXRhID0geyB9CiAgICBlbmQKCiAgICBmdW5jdGlvbiBleHBvcnQoKQogICAgICAgIGxvY2FsIGNvbmZpZyA9IHB1aS5zZXR1cCh7Y3VzdG9tX2FhfSk6c2F2ZSgpCiAgICAgICAgaWYgY29uZmlnID09IG5pbCB0aGVuCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBkYXRhID0gewogICAgICAgICAgICBhdXRob3IgPSBsb2FkZXIudXNlcm5hbWUsCiAgICAgICAgICAgIGRhdGEgPSBjb25maWcsCiAgICAgICAgICAgIG5hbWUgPSB2YXJzLmNvbmZpZ3MubmFtZS52YWx1ZSwKICAgICAgICAgICAgbW9kZSA9IHZhcnMuYW5nbGVzLnR5cGUudmFsdWUKCiAgICAgICAgfQoKICAgICAgICBsb2NhbCBzdWNjZXNzLCBwYWNrZWQgPSBwY2FsbChtc2dwYWNrLnBhY2ssIGRhdGEpCiAgICAgICAgaWYgbm90IHN1Y2Nlc3MgdGhlbgogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgc3VjY2VzcywgZW5jb2RlID0gcGNhbGwoYmFzZTY0LmVuY29kZSwgcGFja2VkKQogICAgICAgIGlmIG5vdCBzdWNjZXNzIHRoZW4KICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCgogICAgICAgIHJldHVybiBzdHJpbmcuZm9ybWF0KCdhbXBoaWJpYTolc19hbXBoaWJpYScsIGVuY29kZSkKICAgIGVuZAoKICAgIGZ1bmN0aW9uIGltcG9ydChzdHIpCiAgICAgICAgbG9jYWwgY29uZmlnID0gc3RyIG9yIGNsaXBib2FyZC5nZXQoKQogICAgICAgIGlmIGNvbmZpZyA9PSBuaWwgdGhlbgogICAgICAgICAgICBjbGllbnQuY29sb3JfbG9nKDI1NSwgMTc1LCAxNzUsICdhbXBoaWJpYSDCtyBcMCcpCiAgICAgICAgICAgIGNsaWVudC5jb2xvcl9sb2coMjAwLDIwMCwyMDAsICdDb25maWcgaXMgZW1wdHkuJykKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCgogICAgICAgIGlmIHN0cmluZy5zdWIoY29uZmlnLCAxLCAjJ2FtcGhpYmlhOicpIH49ICdhbXBoaWJpYTonIHRoZW4KICAgICAgICAgICAgY2xpZW50LmNvbG9yX2xvZygyNTUsIDE3NSwgMTc1LCAnYW1waGliaWEgwrcgXDAnKQogICAgICAgICAgICBjbGllbnQuY29sb3JfbG9nKDIwMCwyMDAsMjAwLCAnQ29uZmlnIGRhdGEgaXMgbmlsLicpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAoKICAgICAgICBjb25maWcgPSBjb25maWc6Z3N1YignYW1waGliaWE6JywgJycpOmdzdWIoJ19hbXBoaWJpYScsICcnKQoKICAgICAgICBsb2NhbCBzdWNjZXNzLCBkZWNvZGVkID0gcGNhbGwoYmFzZTY0LmRlY29kZSwgY29uZmlnKQogICAgICAgIGlmIG5vdCBzdWNjZXNzIHRoZW4KICAgICAgICAgICAgY2xpZW50LmNvbG9yX2xvZygyNTUsIDE3NSwgMTc1LCAnYW1waGliaWEgwrcgXDAnKQogICAgICAgICAgICBjbGllbnQuY29sb3JfbG9nKDIwMCwyMDAsMjAwLCAnRmFpbGVkIHRvIGRlY29kZSBjb25maWcuJykKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIHN1Y2Nlc3MsIGRhdGEgPSBwY2FsbChtc2dwYWNrLnVucGFjaywgZGVjb2RlZCkKICAgICAgICBpZiBub3Qgc3VjY2VzcyB0aGVuCiAgICAgICAgICAgIGNsaWVudC5jb2xvcl9sb2coMjU1LCAxNzUsIDE3NSwgJ2FtcGhpYmlhIMK3IFwwJykKICAgICAgICAgICAgY2xpZW50LmNvbG9yX2xvZygyMDAsMjAwLDIwMCwgJ0ZhaWxlZCB0byBwYXJzZSBkYXRhLicpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAoKICAgICAgICBwdWkuc2V0dXAoe2N1c3RvbV9hYX0pOmxvYWQoZGF0YS5kYXRhKQogICAgZW5kCgogICAgbG9jYWwgY29uZmlnc19tdCA9IHsKICAgICAgICBfX2luZGV4ID0gewogICAgICAgICAgICBsb2FkID0gZnVuY3Rpb24oc2VsZikKICAgICAgICAgICAgICAgIGltcG9ydChzZWxmLmRhdGEpCiAgICAgICAgICAgIGVuZCwKCiAgICAgICAgICAgIGV4cG9ydCA9IGZ1bmN0aW9uKHNlbGYpCiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5kYXRhOmZpbmQoJ19hbXBoaWJpYScpIHRoZW4KICAgICAgICAgICAgICAgICAgICBzZWxmLmRhdGEgPSBzdHJpbmcuZm9ybWF0KCclc19hbXBoaWJpYScsIHNlbGYuZGF0YSkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGNsaXBib2FyZC5zZXQoc2VsZi5kYXRhKQogICAgICAgICAgICBlbmQsCgogICAgICAgICAgICBzYXZlID0gZnVuY3Rpb24oc2VsZiwgZGF0YSkKICAgICAgICAgICAgICAgIGlmIGRhdGEgPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgICAgICBkYXRhID0gZXhwb3J0KCkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIHNlbGYuZGF0YSA9IGRhdGEKICAgICAgICAgICAgICAgIHNlbGYubW9kZSA9IHZhcnMuYW5nbGVzLnR5cGUudmFsdWUKCiAgICAgICAgICAgIGVuZCwKCiAgICAgICAgICAgIHRvX2RiID0gZnVuY3Rpb24oc2VsZikKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgbmFtZSA9IHNlbGYubmFtZSwKICAgICAgICAgICAgICAgICAgICBkYXRhID0gc2VsZi5kYXRhLAogICAgICAgICAgICAgICAgICAgIGF1dGhvciA9IGxvYWRlci51c2VybmFtZSwKICAgICAgICAgICAgICAgICAgICBtb2RlID0gc2VsZi5tb2RlCgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBlbmQKICAgICAgICB9CiAgICB9CgogICAgbG9jYWwgZGF0YWJhc2VfbXQgPSBzZXRtZXRhdGFibGUoeyB9LCB7CiAgICAgICAgX19pbmRleCA9IGZ1bmN0aW9uKHNlbGYsIGtleSkKICAgICAgICAgICAgbG9jYWwgc3RvcmFnZSA9IGRhdGEuY29uZmlncwoKICAgICAgICAgICAgaWYgc3RvcmFnZSA9PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIG5pbAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIHN1Y2Nlc3MsIHBhcnNlZCA9IHBjYWxsKGpzb24ucGFyc2UsIHN0b3JhZ2UpCiAgICAgICAgICAgIGlmIG5vdCBzdWNjZXNzIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBuaWwKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICByZXR1cm4gcGFyc2VkWyBrZXkgXQogICAgICAgIGVuZCwKCiAgICAgICAgX19uZXdpbmRleCA9IGZ1bmN0aW9uKHNlbGYsIGtleSwgdikKICAgICAgICAgICAgbG9jYWwgc3RvcmFnZSA9IGRhdGEuY29uZmlncwoKICAgICAgICAgICAgaWYgc3RvcmFnZSA9PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgc3RvcmFnZSA9ICd7fScKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBzdWNjZXNzLCBwYXJzZWQgPSBwY2FsbChqc29uLnBhcnNlLCBzdG9yYWdlKQogICAgICAgICAgICBpZiBub3Qgc3VjY2VzcyB0aGVuCiAgICAgICAgICAgICAgICBwYXJzZWQgPSB7IH0KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBwYXJzZWRbIGtleSBdID0gdgoKICAgICAgICAgICAgZGF0YS5jb25maWdzID0ganNvbi5zdHJpbmdpZnkocGFyc2VkKQogICAgICAgIGVuZAogICAgfSkKCiAgICBsb2NhbCBsaXZlX2xpc3QgPSB7IH0KCiAgICBmdW5jdGlvbiBzdHJpcChzdHIpCiAgICB3aGlsZSBzdHI6c3ViKDEsIDEpID09ICcgJyBkbwogICAgICAgIHN0ciA9IHN0cjpzdWIoMikKICAgIGVuZAoKICAgIHdoaWxlIHN0cjpzdWIoI3N0ciwgI3N0cikgPT0gJyAnIGRvCiAgICAgICAgc3RyID0gc3RyOnN1YigxLCAjc3RyIC0gMSkKICAgIGVuZAoKICAgIGlmICNzdHIgPT0gMCBvciBzdHIgPT0gJycgdGhlbgogICAgICAgIHN0ciA9IHN0cmluZy5mb3JtYXQoIiVzJ3MgJXMiLCBsb2FkZXIudXNlcm5hbWUsICdDb25maWcnKQogICAgZW5kCgogICAgcmV0dXJuIHN0cgplbmQKCiAgICBmdW5jdGlvbiB1cGRhdGVfbGlzdCgpCiAgICAgICAgbG9jYWwgbGlzdF9uYW1lcyA9IHsgfQoKICAgICAgICBsb2NhbCB2YWwgPSB2YXJzLmNvbmZpZ3MubGlzdDpnZXQoKSArIDEKCiAgICAgICAgZm9yIGkgPSAxLCAjbGl2ZV9saXN0IGRvCiAgICAgICAgICAgIGxvY2FsIG9iaiA9IGxpdmVfbGlzdFsgaSBdCgogICAgICAgICAgICBsaXN0X25hbWVzWyAjbGlzdF9uYW1lcyArIDEgXSA9IHN0cmluZy5mb3JtYXQoJyVzJXMnLCB2YWwgPT0gaSBhbmQgJ1xhJyAuLiBwdWkuYWNjZW50IC4uICfigKIgJyBvciAnJywgb2JqLm5hbWUpCiAgICAgICAgZW5kCgogICAgICAgIGlmICNsaXN0X25hbWVzID09IDAgdGhlbgogICAgICAgICAgICBsaXN0X25hbWVzWyAjbGlzdF9uYW1lcyArIDEgXSA9ICdDb25maWcgbGlzdCBpcyBlbXB0eSEnCiAgICAgICAgZW5kCgogICAgICAgIHZhcnMuY29uZmlncy5saXN0OnVwZGF0ZShsaXN0X25hbWVzKQogICAgZW5kCgogICAgZnVuY3Rpb24gZmluZChuYW1lKQogICAgICAgIG5hbWUgPSBzdHJpcChuYW1lKQoKICAgICAgICBmb3IgaSA9IDEsICNsaXZlX2xpc3QgZG8KICAgICAgICAgICAgbG9jYWwgb2JqID0gbGl2ZV9saXN0WyBpIF0KCiAgICAgICAgICAgIGlmIG9iai5uYW1lID09IG5hbWUgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIG9iaiwgaQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGZ1bmN0aW9uIGNyZWF0ZShuYW1lLCBkYXRhLCBhdXRob3IsIG1vZGUpCiAgICAgICAgCiAgICAgICAgbmFtZSA9IHN0cmlwKG5hbWUpCgogICAgICAgIGxvY2FsIG5ld19wcmVzZXQgPSB7CiAgICAgICAgICAgIG5hbWUgPSBuYW1lLAogICAgICAgICAgICBkYXRhID0gZGF0YSBvciBleHBvcnQoKSwKICAgICAgICAgICAgYXV0aG9yID0gYXV0aG9yIG9yIGxvYWRlci51c2VybmFtZSwKICAgICAgICAgICAgbW9kZSA9IG1vZGUgb3IgdmFycy5hbmdsZXMudHlwZS52YWx1ZQoKICAgICAgICB9CgogICAgICAgIGxpdmVfbGlzdFsgI2xpdmVfbGlzdCArIDEgXSA9IHNldG1ldGF0YWJsZShuZXdfcHJlc2V0LCBjb25maWdzX210KQoKICAgICAgICB1cGRhdGVfbGlzdCgpCiAgICAgICAgZmx1c2goKQogICAgZW5kCgogICAgZnVuY3Rpb24gb25fbGlzdF9uYW1lKCkKICAgICAgICBpZiAjbGl2ZV9saXN0ID09IDAgdGhlbgogICAgICAgICAgICByZXR1cm4gdmFycy5jb25maWdzLm5hbWU6c2V0KCcnKQogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBzZWxlY3RlZF9wcmVzZXQgPSBsaXZlX2xpc3RbIHZhcnMuY29uZmlncy5saXN0OmdldCgpICsgMSBdCgogICAgICAgIGlmIHNlbGVjdGVkX3ByZXNldCA9PSBuaWwgdGhlbgogICAgICAgICAgICBzZWxlY3RlZF9wcmVzZXQgPSBsaXZlX2xpc3RbICNsaXZlX2xpc3QgXQogICAgICAgIGVuZAoKICAgICAgICB2YXJzLmNvbmZpZ3MubmFtZTpzZXQoc2VsZWN0ZWRfcHJlc2V0Lm5hbWUpCiAgICBlbmQKCiAgICBmdW5jdGlvbiBkZXN0cm95KHByZXNldCkKICAgICAgICBmb3IgaSA9IDEsICNsaXZlX2xpc3QgZG8KICAgICAgICAgICAgbG9jYWwgb2JqID0gbGl2ZV9saXN0WyBpIF0KCiAgICAgICAgICAgIGlmIG9iai5uYW1lID09IHByZXNldC5uYW1lIHRoZW4KICAgICAgICAgICAgICAgIHRhYmxlLnJlbW92ZShsaXZlX2xpc3QsIGkpCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgdXBkYXRlX2xpc3QoKQogICAgICAgIGZsdXNoKCkKICAgICAgICBvbl9saXN0X25hbWUoKQogICAgZW5kCgogICAgZnVuY3Rpb24gaW5pdCgpCiAgICAgICAgbG9jYWwgZGJfaW5mbyA9IGRhdGFiYXNlX210WyAnYW1waGliaWEnIF0KCiAgICAgICAgaWYgZGJfaW5mbyA9PSBuaWwgdGhlbgogICAgICAgICAgICBkYl9pbmZvID0geyB9CiAgICAgICAgZW5kCgogICAgICAgIGZvciBpID0gMSwgI2RiX2luZm8gZG8KICAgICAgICAgICAgbG9jYWwgb2JqID0gZGJfaW5mb1sgaSBdCgogICAgICAgICAgICBsaXZlX2xpc3RbIGkgXSA9IHNldG1ldGF0YWJsZShvYmosIGNvbmZpZ3NfbXQpCiAgICAgICAgZW5kCgogICAgICAgIHVwZGF0ZV9saXN0KCkKICAgICAgICBvbl9saXN0X25hbWUoKQogICAgZW5kCgogICAgZnVuY3Rpb24gZmx1c2goKQogICAgICAgIGxvY2FsIGRiX2luZm8gPSB7IH0KCiAgICAgICAgZm9yIGkgPSAxLCAjbGl2ZV9saXN0IGRvCiAgICAgICAgICAgIGxvY2FsIG9iaiA9IGxpdmVfbGlzdFsgaSBdCgogICAgICAgICAgICBkYl9pbmZvWyAjZGJfaW5mbyArIDEgXSA9IG9iajp0b19kYigpCiAgICAgICAgZW5kCgogICAgICAgIGRhdGFiYXNlX210WyAnYW1waGliaWEnIF0gPSBkYl9pbmZvCiAgICBlbmQKCiAgICBsb2NhbCBzZW50ZW5jZXMgPSB7CiAgICAgICAgWydsb2FkJ10gPSAnbG9hZGVkJywKICAgICAgICBbJ2V4cG9ydCddID0gJ2V4cG9ydGVkJwogICAgfQoKICAgIGZvciBfLCB0eXBlIGluIG5leHQsIHsgJ2xvYWQnLCAnZXhwb3J0JyB9IGRvCiAgICAgICAgdmFycy5jb25maWdzWyB0eXBlIF06c2V0X2NhbGxiYWNrKGZ1bmN0aW9uKCkKICAgICAgICAgICAgbG9jYWwgc2VsZWN0ZWRfbmFtZSA9IHZhcnMuY29uZmlncy5uYW1lOmdldCgpCiAgICAgICAgICAgIGxvY2FsIHNlbGVjdGVkX3ByZXNldCwgaWQgPSBmaW5kKHNlbGVjdGVkX25hbWUpCgogICAgICAgICAgICBpZiBzZWxlY3RlZF9wcmVzZXQgPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIGNsaWVudC5jb2xvcl9sb2coMjU1LCAxNzUsIDE3NSwgJ2FtcGhpYmlhIMK3IFwwJykKICAgICAgICAgICAgICAgIGNsaWVudC5jb2xvcl9sb2coMjAwLDIwMCwyMDAsICdDb25maWcgaXMgbmlsLicpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICB2YXJzLmFuZ2xlcy50eXBlOnNldChzZWxlY3RlZF9wcmVzZXQubW9kZSkKICAgICAgICAgICAgY2xpZW50LmNvbG9yX2xvZygxOTUsMTk4LDI1NSwgJ2FtcGhpYmlhIMK3IFwwJykKICAgICAgICAgICAgY2xpZW50LmNvbG9yX2xvZygyMDAsMjAwLDIwMCwgJ1N1Y2Nlc3NmdWxseSAnLi5zZW50ZW5jZXNbIHR5cGUgXS4uIiAiLi5zZWxlY3RlZF9wcmVzZXQubmFtZS4uJy4nKQogICAgICAgICAgICBzZWxlY3RlZF9wcmVzZXRbdHlwZV0oc2VsZWN0ZWRfcHJlc2V0KQoKICAgICAgICAgICAgb25fbGlzdF9uYW1lKCkKICAgICAgICAgICAgdXBkYXRlX2J1dHRvbnMoKQogICAgICAgIGVuZCkKICAgIGVuZAoKICAgIHZhcnMuY29uZmlncy5zYXZlOnNldF9jYWxsYmFjayhmdW5jdGlvbigpCiAgICAgICAgbG9jYWwgc2VsZWN0ZWRfbmFtZSA9IHZhcnMuY29uZmlncy5uYW1lOmdldCgpCiAgICAgICAgbG9jYWwgc2VsZWN0ZWRfcHJlc2V0LCBpZCA9IGZpbmQoc2VsZWN0ZWRfbmFtZSkKCiAgICAgICAgICAgIGNsaWVudC5jb2xvcl9sb2coMTk1LDE5OCwyNTUsICdhbXBoaWJpYSDCtyBcMCcpCiAgICAgICAgICAgIGNsaWVudC5jb2xvcl9sb2coMjAwLDIwMCwyMDAsICdQcmVzZXQgc2F2ZWQ6ICcuLnN0cmlwKHNlbGVjdGVkX25hbWUpLi4nLicpCiAgICAgICAgICAgIHNlbGVjdGVkX3ByZXNldDpzYXZlKCkKCiAgICAgICAgb25fbGlzdF9uYW1lKCkKICAgICAgICB1cGRhdGVfYnV0dG9ucygpCiAgICBlbmQpCgogICAgdmFycy5jb25maWdzLmNyZWF0ZTpzZXRfY2FsbGJhY2soZnVuY3Rpb24oKQogICAgICAgIGxvY2FsIHNlbGVjdGVkX25hbWUgPSB2YXJzLmNvbmZpZ3MubmFtZTpnZXQoKQogICAgICAgIGxvY2FsIHNlbGVjdGVkX3ByZXNldCwgaWQgPSBmaW5kKHNlbGVjdGVkX25hbWUpCgogICAgICAgIGlmIHNlbGVjdGVkX3ByZXNldCA9PSBuaWwgdGhlbgogICAgICAgICAgICBpZiBoZWxwZXJzWydmdW5jdGlvbnMnXTpjb250YWlucyhzZWxlY3RlZF9uYW1lKSB0aGVuCiAgICAgICAgICAgIGNyZWF0ZShzZWxlY3RlZF9uYW1lKQogICAgICAgICAgICB2YXJzLmNvbmZpZ3MubGlzdDpzZXQoI2xpdmVfbGlzdCkKICAgICAgICAgICAgY2xpZW50LmNvbG9yX2xvZygxOTUsMTk4LDI1NSwgJ2FtcGhpYmlhIMK3IFwwJykKICAgICAgICAgICAgY2xpZW50LmNvbG9yX2xvZygyMDAsMjAwLDIwMCwgJ1ByZXNldCBjcmVhdGVkOiAnLi5zZWxlY3RlZF9uYW1lLi4nLicpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgY2xpZW50LmNvbG9yX2xvZygyNTUsIDE3NSwgMTc1LCAnYW1waGliaWEgwrcgXDAnKQogICAgICAgICAgICBjbGllbnQuY29sb3JfbG9nKDIwMCwyMDAsMjAwLCAnQ29uZmlnIGlzIG5pbC4nKQogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlCiAgICAgICAgICAgIGNsaWVudC5jb2xvcl9sb2coMjU1LCAxNzUsIDE3NSwgJ2FtcGhpYmlhIMK3IFwwJykKICAgICAgICAgICAgY2xpZW50LmNvbG9yX2xvZygyMDAsMjAwLDIwMCwgJ0NvbmZpZyBpcyBhbHJlYWR5IGFkZGVkLicpCiAgICAgICAgZW5kCgogICAgICAgIG9uX2xpc3RfbmFtZSgpCiAgICAgICAgdXBkYXRlX2J1dHRvbnMoKQogICAgZW5kKQoKICAgIHZhcnMuY29uZmlncy5pbXBvcnQ6c2V0X2NhbGxiYWNrKGZ1bmN0aW9uICgpCiAgICAgICAgbG9jYWwgY2xpcGJvYXJkX3RleHQgPSBjbGlwYm9hcmQuZ2V0KCkKICAgICAgICBsb2NhbCBzID0gY2xpcGJvYXJkX3RleHQKICAgICAgICBpZiBzID09IG5pbCB0aGVuCiAgICAgICAgICAgIGNsaWVudC5jb2xvcl9sb2coMjU1LCAxNzUsIDE3NSwgJ2FtcGhpYmlhIMK3IFwwJykKICAgICAgICAgICAgY2xpZW50LmNvbG9yX2xvZygyMDAsMjAwLDIwMCwgJ1lvdXIgY2xpcGJvYXJkIGlzIGVtcHR5LicpCiAgICAgICAgICAgIHJldHVybiAKICAgICAgICBlbmQKCiAgICAgICAgZG8KICAgICAgICAgICAgaWYgczpzdWIoMSwgIydhbXBoaWJpYTonKSB+PSAnYW1waGliaWE6JyB0aGVuCiAgICAgICAgICAgICAgICBjbGllbnQuY29sb3JfbG9nKDI1NSwgMTc1LCAxNzUsICdhbXBoaWJpYSDCtyBcMCcpCiAgICAgICAgICAgICAgICBjbGllbnQuY29sb3JfbG9nKDIwMCwyMDAsMjAwLCAnQ29uZmlnIGlzIGNvcnJ1cHRlZC4nKQogICAgICAgICAgICAgICAgcmV0dXJuIAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHMgPSBzOnN1YigjJ2FtcGhpYmlhOicgKyAxKQoKICAgICAgICAgICAgaWYgczpmaW5kKCdfYW1waGliaWEnKSB0aGVuCiAgICAgICAgICAgICAgICBzID0gczpnc3ViKCdfYW1waGliaWEnLCAnJykKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIHN1Y2Nlc3MsIGRlY29kZWQgPSBwY2FsbChiYXNlNjQuZGVjb2RlLCBzKQogICAgICAgIGlmIG5vdCBzdWNjZXNzIHRoZW4KICAgICAgICAgICAgY2xpZW50LmNvbG9yX2xvZygyNTUsIDE3NSwgMTc1LCAnYW1waGliaWEgwrcgXDAnKQogICAgICAgICAgICBjbGllbnQuY29sb3JfbG9nKDIwMCwyMDAsMjAwLCAnRmFpbGVkIHRvIGRlY29kZSBjb25maWcuJykKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIHN1Y2Nlc3MsIHVucGFja2VkID0gcGNhbGwobXNncGFjay51bnBhY2ssIGRlY29kZWQpCiAgICAgICAgaWYgbm90IHN1Y2Nlc3MgdGhlbgogICAgICAgICAgICBjbGllbnQuY29sb3JfbG9nKDI1NSwgMTc1LCAxNzUsICdhbXBoaWJpYSDCtyBcMCcpCiAgICAgICAgICAgIGNsaWVudC5jb2xvcl9sb2coMjAwLDIwMCwyMDAsICdGYWlsZWQgdG8gdW5wYWNrIGNvbmZpZy4nKQogICAgICAgICAgICByZXR1cm4gCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIHNlbGVjdGVkX3ByZXNldCwgaWQgPSBmaW5kKHVucGFja2VkLm5hbWUpCgogICAgICAgIGlmIHNlbGVjdGVkX3ByZXNldCA9PSBuaWwgdGhlbgogICAgICAgICAgICBjbGllbnQuY29sb3JfbG9nKDE5NSwxOTgsMjU1LCAnYW1waGliaWEgwrcgXDAnKQogICAgICAgICAgICBjbGllbnQuY29sb3JfbG9nKDIwMCwyMDAsMjAwLCAnUHJlc2V0IGFkZGVkIGJ5ICcuLnVucGFja2VkLmF1dGhvci4uJy4nKQogICAgICAgICAgICBjcmVhdGUodW5wYWNrZWQubmFtZSwgY2xpcGJvYXJkX3RleHQsIHVucGFja2VkLmF1dGhvciwgdW5wYWNrZWQubW9kZSkKICAgICAgICAgICAgdmFycy5jb25maWdzLmxpc3Q6c2V0KCNsaXZlX2xpc3QpCiAgICAgICAgZWxzZQogICAgICAgICAgICBjbGllbnQuY29sb3JfbG9nKDE5NSwxOTgsMjU1LCAnYW1waGliaWEgwrcgXDAnKQogICAgICAgICAgICBjbGllbnQuY29sb3JfbG9nKDIwMCwyMDAsMjAwLCAnUHJlc2V0IHJld3JpdGVkOiAnLi51bnBhY2tlZC5hdXRob3IuLicuJykKCiAgICAgICAgICAgIHNlbGVjdGVkX3ByZXNldDpzYXZlKGNsaXBib2FyZF90ZXh0KQoKICAgICAgICBlbmQKCiAgICAgICAgaW1wb3J0KGNsaXBib2FyZF90ZXh0KQogICAgICAgIG9uX2xpc3RfbmFtZSgpCiAgICAgICAgdXBkYXRlX2J1dHRvbnMoKQogICAgZW5kKQoKICAgIHZhcnMuY29uZmlncy5kZWxldGU6c2V0X2NhbGxiYWNrKGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBzZWxlY3RlZF9uYW1lID0gdmFycy5jb25maWdzLm5hbWU6Z2V0KCkKICAgICAgICBsb2NhbCBzZWxlY3RlZF9wcmVzZXQsIGlkID0gZmluZChzZWxlY3RlZF9uYW1lKQoKICAgICAgICBpZiBzZWxlY3RlZF9wcmVzZXQgPT0gbmlsIHRoZW4KICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCgogICAgICAgIGNsaWVudC5jb2xvcl9sb2coMTk1LDE5OCwyNTUsICdhbXBoaWJpYSDCtyBcMCcpCiAgICAgICAgY2xpZW50LmNvbG9yX2xvZygyMDAsMjAwLDIwMCwgJ1ByZXNldCBkZWxldGVkOiAnLi5zZWxlY3RlZF9wcmVzZXQubmFtZS4uJy4nKQoKICAgICAgICBkZXN0cm95KHNlbGVjdGVkX3ByZXNldCkKICAgICAgICB1cGRhdGVfYnV0dG9ucygpCiAgICBlbmQpCgogICAgZnVuY3Rpb24gdXBkYXRlX2J1dHRvbnMoKQogICAgICAgIGxvY2FsIHNlbGVjdGVkX25hbWUgPSB2YXJzLmNvbmZpZ3MubmFtZTpnZXQoKQogICAgICAgIGxvY2FsIHNlbGVjdGVkX3ByZXNldCwgaWQgPSBmaW5kKHNlbGVjdGVkX25hbWUpCgogICAgICAgIGxvY2FsIHN0YXRlID0gc2VsZWN0ZWRfcHJlc2V0IH49IG5pbAogICAgICAgIHZhcnMuY29uZmlncy5zYXZlOnNldF9lbmFibGVkKHN0YXRlKQogICAgICAgIHZhcnMuY29uZmlncy5sb2FkOnNldF9lbmFibGVkKHN0YXRlKQogICAgICAgIHZhcnMuY29uZmlncy5leHBvcnQ6c2V0X2VuYWJsZWQoc3RhdGUpCiAgICAgICAgdmFycy5jb25maWdzLmRlbGV0ZTpzZXRfZW5hYmxlZChzdGF0ZSkKICAgIGVuZAoKICAgIHZhcnMuY29uZmlncy5saXN0OnNldF9jYWxsYmFjayhmdW5jdGlvbiAoc2VsZikKICAgICAgICBsb2NhbCBzZWxlY3RlZF9uYW1lID0gdmFycy5jb25maWdzLm5hbWU6Z2V0KCkKICAgICAgICBsb2NhbCBzZWxlY3RlZF9wcmVzZXQsIGlkID0gZmluZChzZWxlY3RlZF9uYW1lKQoKICAgICAgICBvbl9saXN0X25hbWUoKQogICAgICAgIHVwZGF0ZV9saXN0KCkKICAgICAgICB1cGRhdGVfYnV0dG9ucygpCiAgICBlbmQsIHRydWUpCgogICAgaW5pdCgpCiAgICBjbGllbnQuZGVsYXlfY2FsbCguMSwgZnVuY3Rpb24gKCkKICAgICAgICBvbl9saXN0X25hbWUoKQogICAgICAgIHVwZGF0ZV9idXR0b25zKCkKICAgIGVuZCkKCiAgICBjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCdzaHV0ZG93bicsIGZ1bmN0aW9uKCkKCiAgICAgICAgZmx1c2goKQogICAgICAgIGRhdGEuc3RvcmVkX2NvbmZpZyA9IGV4cG9ydCgpCiAgICAgICAgZGIuY29uZmlnc19kYXRhX2FtcGhpYmlhX2x1YSA9IGRhdGEKICAgICAgICBkYi5sb2FkZWRfdGltZXNfYW1waGliaWFfbHVhID0gbG9hZGVkX3RpbWVzOwogICAgCiAgICBlbmQpCgplbmQpKCkKCkxQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uICgpCmNvbmRpdGlvbl9nZXQgPSBmdW5jdGlvbihjKSAgICAKICAgIGxvY2FsIHZ4LCB2eSwgdnogPSBlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSwgIm1fdmVjVmVsb2NpdHkiKQogICAgICAgICAgICAKICAgIGxvY2FsIGxwX3ZlbCA9IG1hdGguc3FydCh2eCp2eCArIHZ5KnZ5ICsgdnoqdnopCiAgICBsb2NhbCBvbl9ncm91bmQgPSBiaXQuYmFuZChlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSwgIm1fZkZsYWdzIiksIDEpID09IDEgYW5kIGMuaW5fanVtcCA9PSAwCiAgICBsb2NhbCBpc19jcm91Y2hpbmcgPSBiaXQuYmFuZChlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSwgIm1fZkZsYWdzIiksIDQpID09IDQKICAgIGxvY2FsIHBfc2xvdyA9IHVpLmdldChyZWZlcmVuY2Uuc2xvd1sxXSkgYW5kIHVpLmdldChyZWZlcmVuY2Uuc2xvd1syXSkKICAgIGxvY2FsIGlzX2tuaWZlID0gZW50aXR5LmdldF9jbGFzc25hbWUoZW50aXR5LmdldF9wbGF5ZXJfd2VhcG9uKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkpKSA9PSAnQ0tuaWZlJyBhbmQgb25fZ3JvdW5kID09IGZhbHNlIGFuZCBpc19jcm91Y2hpbmcgPT0gdHJ1ZSBvciBlbnRpdHkuZ2V0X2NsYXNzbmFtZShlbnRpdHkuZ2V0X3BsYXllcl93ZWFwb24oZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkpID09ICdDS25pZmUnIGFuZCBvbl9ncm91bmQgPT0gdHJ1ZSBhbmQgaXNfY3JvdWNoaW5nID09IHRydWUKICAgIGxvY2FsIGZha2VsYWcgID0gbm90KHVpLmdldChyZWZlcmVuY2UuZHRbMl0pIG9yIHVpLmdldChyZWZlcmVuY2UuaHNbMl0pKQogICAgCiAgICBpZiBmYWtlbGFnIHRoZW4KICAgICAgICBwbGF5ZXJfc3RhdGUgPSA4CiAgICAgICAgcmV0dXJuICJGYWtlbGFnIgogICAgZWxzZWlmIGlzX2tuaWZlIHRoZW4KICAgICAgICBwbGF5ZXJfc3RhdGUgPSA3CiAgICAgICAgcmV0dXJuICJTYWZlIgogICAgZWxzZWlmIChvbl9ncm91bmQgYW5kIGlzX2Nyb3VjaGluZykgb3IgdWkuZ2V0KHJlZmVyZW5jZS5mZFsxXSkgdGhlbgogICAgICAgIHBsYXllcl9zdGF0ZSA9IDQKICAgICAgICByZXR1cm4gIkR1Y2tpbmciCiAgICBlbHNlaWYgKChjLmluX2R1Y2sgPT0gMSkgYW5kIChub3Qgb25fZ3JvdW5kKSkgdGhlbgogICAgICAgIHBsYXllcl9zdGF0ZSA9IDYKICAgICAgICByZXR1cm4gIkFpcitEdWNrIgogICAgZWxzZWlmIChub3Qgb25fZ3JvdW5kKSBhbmQgKGMuaW5fZHVjayA9PSAwKXRoZW4KICAgICAgICBwbGF5ZXJfc3RhdGUgPSA1CiAgICAgICAgcmV0dXJuICJBaXIiCiAgICBlbHNlaWYgcF9zbG93IHRoZW4KICAgICAgICBwbGF5ZXJfc3RhdGUgPSAzCiAgICAgICAgcmV0dXJuICJTbG93d2FsayIKICAgIGVsc2VpZiAobHBfdmVsID4gNSkgdGhlbgogICAgICAgIHBsYXllcl9zdGF0ZSA9IDIKICAgICAgICByZXR1cm4gIlJ1bm5pbmciCiAgICBlbHNlCiAgICAgICAgcGxheWVyX3N0YXRlID0gMQogICAgICAgIHJldHVybiAiU3RhbmRpbmciCiAgICBlbmQgCmVuZAoKaGFuZGxlX3N0YXRpY19mcmVlc3RhbmQgPSBmdW5jdGlvbihjKQoKICAgIGlmIHZhcnMuYWEuZW5jaGE6Z2V0KCdGcmVlc3RhbmQnKSBhbmQgdmFycy5hYS5mcmVlc3RhbmRpbmc6Z2V0KCkgIHRoZW4KICAgICAgICBpZiB2YXJzLmFhLmVuY2hhOmdldCgnU3RhdGljIEZyZWVzdGFuZCcpIHRoZW4KICAgICAgICB1aS5zZXQocmVmZXJlbmNlLmZyZWVzdGFuZFsxXSwgdHJ1ZSkKICAgICAgICB1aS5zZXQocmVmZXJlbmNlLmZyZWVzdGFuZFsyXSwgIkFsd2F5cyBvbiIpCiAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS5ib2R5eWF3WzFdLCAnb2ZmJykKICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd2ppdHRlclsxXSwgIm9mZiIpCiAgICAgICAgZWxzZQogICAgICAgIHVpLnNldChyZWZlcmVuY2UuZnJlZXN0YW5kWzFdLCB0cnVlKQogICAgICAgIHVpLnNldChyZWZlcmVuY2UuZnJlZXN0YW5kWzJdLCAiQWx3YXlzIG9uIikKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICB1aS5zZXQocmVmZXJlbmNlLmZyZWVzdGFuZFsxXSwgZmFsc2UpCiAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS5mcmVlc3RhbmRbMl0sICJPbiBob3RrZXkiKQogICAgZW5kCgplbmQKCmhhbmRsZV9zdGF0aWNfd2FybXVwID0gZnVuY3Rpb24oYykKICAgIAogICAgaWYgbm90IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkgb3Igbm90IGVudGl0eS5pc19hbGl2ZShlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpKSB0aGVuIHJldHVybiBlbmQKICAgIGlmIGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkgPT0gbmlsIHRoZW4gcmV0dXJuIGVuZAogICAgaWYgZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfYWxsKCJDQ1NHYW1lUnVsZXNQcm94eSIpWzFdLCJtX2JXYXJtdXBQZXJpb2QiKSA9PSAwIHRoZW4gcmV0dXJuIGVuZAogICAgaWYgbm90IHZhcnMuYWEuZW5jaGE6Z2V0KCdTdGF0aWMgT24gV2FybXVwJykgdGhlbiByZXR1cm4gZW5kCgogICAgdWkuc2V0KHJlZmVyZW5jZS55YXdbMV0sICIxODAiKQogICAgdWkuc2V0KHJlZmVyZW5jZS5waXRjaFsxXSwgJ0RlZmF1bHQnKQogICAgdWkuc2V0KHJlZmVyZW5jZS55YXdiYXNlLCAiQXQgdGFyZ2V0cyIpCiAgICB1aS5zZXQocmVmZXJlbmNlLnBpdGNoWzJdLCAwKQogICAgdWkuc2V0KHJlZmVyZW5jZS5ib2R5eWF3WzFdLCAnT2ZmJykKICAgIHVpLnNldChyZWZlcmVuY2UuYm9keXlhd1syXSwgMCkKICAgIHVpLnNldChyZWZlcmVuY2UueWF3aml0dGVyWzFdLCAiT2ZmIikKICAgIHVpLnNldChyZWZlcmVuY2UueWF3aml0dGVyWzJdLCAwKQogICAgdWkuc2V0KHJlZmVyZW5jZS55YXdbMl0sIDApCgplbmQKCmhhbmRsZV9lZGdlX2Zha2VkdWNrID0gZnVuY3Rpb24oYykKCiAgICBpZiB1aS5nZXQocmVmZXJlbmNlLmZha2VkdWNrKSBhbmQgdmFycy5hYS5lbmNoYTpnZXQoJ0VkZ2UgWWF3IEZha2VkdWNrJykgdGhlbgogICAgICAgIHVpLnNldChyZWZlcmVuY2UuZWRnZXlhdywgdHJ1ZSkKICAgIGVsc2UKICAgICAgICB1aS5zZXQocmVmZXJlbmNlLmVkZ2V5YXcsIGZhbHNlKQogICAgZW5kCgplbmQKCmhhbmRsZV9tYW51YWxzID0gZnVuY3Rpb24oYykKCiAgICB2YXJzLmFhLm1hbnVhbF9sZWZ0OnNldCgnT24gaG90a2V5JykKICAgIHZhcnMuYWEubWFudWFsX3JpZ2h0OnNldCgnT24gaG90a2V5JykKICAgIAogICAgICAgIGlmIGhlbHBlcnNbJ2Z1bmN0aW9ucyddOm1hbnVhbGFhKCkgPT0gMSB0aGVuCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UucGl0Y2hbMV0sICJEZWZhdWx0IikKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS5waXRjaFsyXSwgODkpCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3aml0dGVyWzFdLCAib2ZmIikKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdqaXR0ZXJbMl0sIDApCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UuYm9keXlhd1sxXSwgIm9mZiIpCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UuYm9keXlhd1syXSwgLTE4MCkKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdiYXNlLCAibG9jYWwgdmlldyIpCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3WzFdLCAiMTgwIikKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdbMl0sIC05MCkKICAgICAgICBlbHNlaWYgaGVscGVyc1snZnVuY3Rpb25zJ106bWFudWFsYWEoKSA9PSAyIHRoZW4KICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS5waXRjaFsxXSwgIkRlZmF1bHQiKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnBpdGNoWzJdLCA4OSkKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdqaXR0ZXJbMV0sICJvZmYiKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd2ppdHRlclsyXSwgMCkKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS5ib2R5eWF3WzFdLCAib2ZmIikKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS5ib2R5eWF3WzJdLCAtMTgwKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd2Jhc2UsICJsb2NhbCB2aWV3IikKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdbMV0sICIxODAiKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd1syXSwgOTApCiAgICAgICAgZW5kCgplbmQKCmhhbmRsZV9ib21iaXN0ZV9maXggPSBmdW5jdGlvbihjKQoKICAgIGlmIGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkgPT0gbmlsIHRoZW4gcmV0dXJuIGVuZAogICAgaWYgZW50aXR5LmdldF9wbGF5ZXJfd2VhcG9uKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkpID09IG5pbCB0aGVuIHJldHVybiBlbmQKICAgIGxvY2FsIHBsYXllcl90ZWFtLCBvbl9ib21ic2l0ZSwgZGVmdXNpbmcgPSBlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSwgIm1faVRlYW1OdW0iKSwgZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX2JJbkJvbWJab25lIiksIHBsYXllcl90ZWFtID09IDMKICAgIGxvY2FsIHRyeW5uYV9wbGFudCA9IHBsYXllcl90ZWFtID09IDIgYW5kIGhhc19ib21iCiAgICBsb2NhbCBpbmJvbWIgPSBvbl9ib21ic2l0ZSB+PSBmYWxzZQoKICAgIGxvY2FsIHVzZSA9IGNsaWVudC5rZXlfc3RhdGUoMHg0NSkKCiAgICBpZiBub3QgdmFycy5hYS5lbmNoYTpnZXQoJ0JvbWJzaXRlIEUgRml4JykgdGhlbiByZXR1cm4gZW5kCiAgICBpZiBub3QgaW5ib21iIHRoZW4gcmV0dXJuIGVuZAogICAgaWYgaW5ib21iIGFuZCBub3QgdHJ5bm5hX3BsYW50IGFuZCBub3QgZGVmdXNpbmcgYW5kIHVzZSB0aGVuCgogICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3WzFdLCAib2ZmIikKICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnBpdGNoWzFdLCAnb2ZmJykKICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd2Jhc2UsICJsb2NhbCB2aWV3IikKICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnBpdGNoWzJdLCAwKQogICAgICAgIHVpLnNldChyZWZlcmVuY2UuYm9keXlhd1sxXSwgJ29mZicpCiAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS5ib2R5eWF3WzJdLCAwKQogICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3aml0dGVyWzFdLCAib2ZmIikKICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd2ppdHRlclsyXSwgMCkKICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd1syXSwgMCkKCiAgICBlbmQKCiAgICBpZiBpbmJvbWIgYW5kIG5vdCB0cnlubmFfcGxhbnQgYW5kIG5vdCBkZWZ1c2luZyB0aGVuCiAgICAgICAgYy5pbl91c2UgPSAwCiAgICBlbmQKCmVuZAoKaGFuZGxlX2FudGlfYmFja3N0YWIgPSBmdW5jdGlvbigpCgogICAgbG9jYWwgZXllX3gsIGV5ZV95LCBleWVfeiA9IGNsaWVudC5leWVfcG9zaXRpb24oKQogICAgbG9jYWwgZW5lbXllcyA9IGVudGl0eS5nZXRfcGxheWVycyh0cnVlKQogICAgaWYgdmFycy5hYS5lbmNoYTpnZXQoJ0FudGktQmFja3N0YWInKSB0aGVuCiAgICAgICAgaWYgZW5lbXllcyB+PSBuaWwgdGhlbgogICAgICAgICAgICBmb3IgaSwgZW5lbXkgaW4gcGFpcnMoZW5lbXllcykgZG8KICAgICAgICAgICAgICAgIGZvciBoID0gMCwgMTggZG8KICAgICAgICAgICAgICAgICAgICBsb2NhbCBoZWFkX3gsIGhlYWRfeSwgaGVhZF96ID0gZW50aXR5LmhpdGJveF9wb3NpdGlvbihlbmVteWVzW2ldLCBoKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIHd4LCB3eSA9IHJlbmRlcmVyLndvcmxkX3RvX3NjcmVlbihoZWFkX3gsIGhlYWRfeSwgaGVhZF96KQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGZyYWN0aW9ucywgZW50aW5kZXhfaGl0ID0gY2xpZW50LnRyYWNlX2xpbmUoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSwgZXllX3gsIGV5ZV95LCBleWVfeiwgaGVhZF94LCBoZWFkX3ksIGhlYWRfeikKICAgIAogICAgICAgICAgICAgICAgICAgIGlmIDI1MCA+PSB2ZWN0b3IoZW50aXR5LmdldF9wcm9wKGVuZW15LCAnbV92ZWNPcmlnaW4nKSk6ZGlzdCh2ZWN0b3IoZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICdtX3ZlY09yaWdpbicpKSkgYW5kIGVudGl0eS5pc19hbGl2ZShlbmVteSkgYW5kIGVudGl0eS5nZXRfcGxheWVyX3dlYXBvbihlbmVteSkgfj0gbmlsIGFuZCBlbnRpdHkuZ2V0X2NsYXNzbmFtZShlbnRpdHkuZ2V0X3BsYXllcl93ZWFwb24oZW5lbXkpKSA9PSAnQ0tuaWZlJyBhbmQgKGVudGluZGV4X2hpdCA9PSBlbmVteWVzW2ldIG9yIGZyYWN0aW9ucyA9PSAxKSBhbmQgbm90IGVudGl0eS5pc19kb3JtYW50KGVuZW15ZXNbaV0pIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdbMV0sICcxODAnKQogICAgICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd1syXSwgLTE4MCkKICAgICAgICAgICAgICAgICAgICAgICAgaGVscGVyc1snZnVuY3Rpb25zJ10uaXNfYmFja3N0YWIgPSAxCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBoZWxwZXJzWydmdW5jdGlvbnMnXS5pc19iYWNrc3RhYiA9IDAKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAoKZW5kCgpoYW5kbGVfZGVmZW5zaXZlID0gZnVuY3Rpb24oYykKCiAgICBsb2NhbCB0ZWFtID0gZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX2lUZWFtTnVtIikgPT0gMyBhbmQgIkNUIiBvciAiVCIKICAgIGxvY2FsIHN0YXRlID0gY29uZGl0aW9uX2dldChjKQogICAgbG9jYWwgYWFfdmFsdWUgPSBjdXN0b21fYWFbdGVhbV1bc3RhdGVdCiAgICBsb2NhbCB3b3JrX2RlZmVuc2l2ZSA9IGZhbHNlCgogICAgaWYgdmFycy5hbmdsZXMudHlwZS52YWx1ZSB+PSAnQnVpbGRlcicgdGhlbgogICAgICAgIHJldHVybgogICAgZW5kCgogICAgaWYgaGVscGVyc1snZnVuY3Rpb25zJ106bWFudWFsYWEoKSB+PSAwIHRoZW4KICAgICAgICByZXR1cm4KICAgIGVuZAoKICAgIGlmIG5vdCAodWkuZ2V0KHJlZmVyZW5jZS5kdFsxXSkgYW5kIHVpLmdldChyZWZlcmVuY2UuZHRbMl0pIGFuZCBhYV92YWx1ZS5kZWZlbnNpdmVfbW9kZTpnZXQoJ0RvdWJsZSBUYXAnKSBvciB1aS5nZXQocmVmZXJlbmNlLmhzWzFdKSBhbmQgdWkuZ2V0KHJlZmVyZW5jZS5oc1syXSkgYW5kIGFhX3ZhbHVlLmRlZmVuc2l2ZV9tb2RlOmdldCgnSGlkZSBTaG90cycpKSB0aGVuIAogICAgICAgIHdvcmtfZGVmZW5zaXZlID0gZmFsc2UKICAgIGVsc2UKICAgICAgICB3b3JrX2RlZmVuc2l2ZSA9IHRydWUKICAgIGVuZAoKICAgIGlmIGhlbHBlcnNbJ2Z1bmN0aW9ucyddLmlzX2JhY2tzdGFiID09IDEgdGhlbgogICAgICAgIHJldHVybgogICAgZW5kCgogICAgbG9jYWwgdGVhbXMgPSBlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSwgIm1faVRlYW1OdW0iKQoKICAgIGMuZm9yY2VfZGVmZW5zaXZlID0gYWFfdmFsdWUuZGVmZW5zaXZlOmdldCgpIGFuZCB3b3JrX2RlZmVuc2l2ZSA9PSB0cnVlCgogICAgaWYgdmFycy5hYS5mcmVlc3RhbmRpbmc6Z2V0KCkgPT0gZmFsc2UgYW5kIGlzX2RlZmVuc2l2ZV9hY3RpdmUgYW5kIGFhX3ZhbHVlLmRlZmVuc2l2ZTpnZXQoKSBhbmQgYWFfdmFsdWUuZW5hYmxlZDpnZXQoKSBhbmQgd29ya19kZWZlbnNpdmUgPT0gdHJ1ZSB0aGVuIAoKICAgICAgICBpZiBhYV92YWx1ZS5kZWZlbnNpdmVfcGl0Y2g6Z2V0KCkgfj0gJ09mZicgYW5kIGFhX3ZhbHVlLmRlZmVuc2l2ZV9waXRjaDpnZXQoKSA9PSAnUmFuZG9tJyB0aGVuCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UucGl0Y2hbMV0sICdDdXN0b20nKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLmZzYm9keXlhdywgZmFsc2UpCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UucGl0Y2hbMl0sIG1hdGgucmFuZG9tKGFhX3ZhbHVlLnBpdGNoX2Ftb3VudDpnZXQoKSwgYWFfdmFsdWUucGl0Y2hfYW1vdW50XzI6Z2V0KCkpKQogICAgICAgIGVsc2VpZiBhYV92YWx1ZS5kZWZlbnNpdmVfcGl0Y2g6Z2V0KCkgfj0gJ09mZicgYW5kIGFhX3ZhbHVlLmRlZmVuc2l2ZV9waXRjaDpnZXQoKSA9PSAnVXAtU3dpdGNoJyB0aGVuCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UucGl0Y2hbMV0sICdDdXN0b20nKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLmZzYm9keXlhdywgZmFsc2UpCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UucGl0Y2hbMl0sIGNsaWVudC5yYW5kb21fZmxvYXQoNDUsIDY1KSAqIC0xKQogICAgICAgIGVsc2VpZiBhYV92YWx1ZS5kZWZlbnNpdmVfcGl0Y2g6Z2V0KCkgfj0gJ09mZicgYW5kIGFhX3ZhbHVlLmRlZmVuc2l2ZV9waXRjaDpnZXQoKSA9PSAnQ3VzdG9tJyB0aGVuCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UucGl0Y2hbMV0sIGFhX3ZhbHVlLmRlZmVuc2l2ZV9waXRjaDpnZXQoKSkKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS5waXRjaFsyXSwgYWFfdmFsdWUucGl0Y2hfYW1vdW50OmdldCgpKSAKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS5mc2JvZHl5YXcsIGZhbHNlKQogICAgICAgIGVsc2VpZiBhYV92YWx1ZS5kZWZlbnNpdmVfcGl0Y2g6Z2V0KCkgfj0gJ09mZicgYW5kIGFhX3ZhbHVlLmRlZmVuc2l2ZV9waXRjaDpnZXQoKSA9PSAnVXAnIHRoZW4KICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS5waXRjaFsxXSwgYWFfdmFsdWUuZGVmZW5zaXZlX3BpdGNoOmdldCgpKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLmZzYm9keXlhdywgZmFsc2UpCiAgICAgICAgZWxzZQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnBpdGNoWzFdLCBhYV92YWx1ZS5waXRjaDpnZXQoKSkKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS5waXRjaFsyXSwgYWFfdmFsdWUucGl0Y2hfdmFsdWU6Z2V0KCkpCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UuZnNib2R5eWF3LCBmYWxzZSkKICAgICAgICBlbmQKCmlmIGFhX3ZhbHVlLmRlZmVuc2l2ZV95YXc6Z2V0KCkgfj0gIk9mZiIgYW5kIHdvcmtfZGVmZW5zaXZlID09IHRydWUgdGhlbgogICAgaWYgYWFfdmFsdWUuZGVmZW5zaXZlX3lhdzpnZXQoKSA9PSAiMTgwIiB0aGVuICAKICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd1sxXSwiMTgwIikKICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd1syXSwgMCkKICAgICAgICB1aS5zZXQocmVmZXJlbmNlLmZzYm9keXlhdywgZmFsc2UpCiAgICBlbHNlaWYgYWFfdmFsdWUuZGVmZW5zaXZlX3lhdzpnZXQoKSA9PSAiUmFuZG9tIiB0aGVuIAogICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3WzFdLCAiMTgwIikKICAgICAgICB1aS5zZXQocmVmZXJlbmNlLmZzYm9keXlhdywgZmFsc2UpCiAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdbMl0sY2xpZW50LnJhbmRvbV9pbnQoLTE4MCwgMTgwKSkKICAgIGVsc2VpZiBhYV92YWx1ZS5kZWZlbnNpdmVfeWF3OmdldCgpID09ICJTcGluIiB0aGVuCiAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdbMV0sICdTcGluJykKICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd1syXSwgYWFfdmFsdWUueWF3X2Ftb3VudDpnZXQoKSkKICAgICAgICB1aS5zZXQocmVmZXJlbmNlLmZzYm9keXlhdywgZmFsc2UpCiAgICBlbHNlCiAgICBlbmQKZW5kCmVuZAoKCmVuZAoKaGFuZGxlX2FudGlhaW1zID0gZnVuY3Rpb24oYykKCiAgICBsb2NhbCB0ZWFtID0gZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX2lUZWFtTnVtIikgPT0gMyBhbmQgIkNUIiBvciAiVCIKICAgIGxvY2FsIHN0YXRlID0gY29uZGl0aW9uX2dldChjKQogICAgbG9jYWwgYWFfdmFsdWUgPSBjdXN0b21fYWFbdGVhbV1bc3RhdGVdCiAgICBsb2NhbCBib2R5WWF3ID0gZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX2ZsUG9zZVBhcmFtZXRlciIsIDExKSAqIDEyMCAtIDYwCiAgICBsb2NhbCBzaWRlID0gYm9keVlhdyA+IDAgYW5kIDEgb3IgLTEKCiAgICBpZiBhYV92YWx1ZS5kZWxheWVkX3N3YXA6Z2V0KCkgYW5kIGFhX3ZhbHVlLmVuYWJsZWQ6Z2V0KCkgIGFuZCB2YXJzLmFuZ2xlcy50eXBlLnZhbHVlID09ICdCdWlsZGVyJyBhbmQgYWFfdmFsdWUueWF3OmdldCgpID09ICcxODAgTGVmdCAvIFJpZ2h0JyB0aGVuCiAgICAgICAgaWYgYWFfdmFsdWUudGlja3NfZGVsYXkudmFsdWUgfj0gMCB0aGVuCiAgICAgICAgdGlja3MgPSBhYV92YWx1ZS50aWNrc19kZWxheS52YWx1ZSAvIDQKICAgICAgICBzd2l0Y2ggPSAoZ2xvYmFscy5zZXJ2ZXJ0aWNrY291bnQoKSAlKDgrdGlja3MpID4gNCt0aWNrcy8yKQogICAgICAgIGlmIGMuYWxsb3dfc2VuZF9wYWNrZXQgPT0gdHJ1ZSBhbmQgYy5jaG9rZWRjb21tYW5kcyA8IDEgdGhlbgogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd1syXSwgc3dpdGNoIGFuZCBhYV92YWx1ZS55YXdfbGVmdC52YWx1ZSBvciBhYV92YWx1ZS55YXdfcmlnaHQudmFsdWUpCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UuYm9keXlhd1sxXSwgJ29mZicpCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3aml0dGVyWzFdLCAnb2ZmJykKCiAgICAgICAgZW5kCiAgICAgICAgZWxzZQogICAgICAgICAgICBpZiBjLmFsbG93X3NlbmRfcGFja2V0ID09IHRydWUgYW5kIGMuY2hva2VkY29tbWFuZHMgPCAxIHRoZW4KICAgICAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3WzJdLCBzaWRlID09IDEgYW5kIGFhX3ZhbHVlLnlhd19sZWZ0LnZhbHVlIG9yIGFhX3ZhbHVlLnlhd19yaWdodC52YWx1ZSkKICAgICAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UuYm9keXlhd1sxXSwgYWFfdmFsdWUuYm9keV95YXcudmFsdWUpCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd2ppdHRlclsxXSwgYWFfdmFsdWUueWF3X21vZGlmaWVyLnZhbHVlKQoKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgaWYgYy5hbGxvd19zZW5kX3BhY2tldCA9PSB0cnVlIGFuZCBjLmNob2tlZGNvbW1hbmRzIDwgMSB0aGVuCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3WzJdLCBzaWRlID09IDEgYW5kIGFhX3ZhbHVlLnlhd19sZWZ0LnZhbHVlIG9yIGFhX3ZhbHVlLnlhd19yaWdodC52YWx1ZSkKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS5ib2R5eWF3WzFdLCBhYV92YWx1ZS5ib2R5X3lhdy52YWx1ZSkKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdqaXR0ZXJbMV0sIGFhX3ZhbHVlLnlhd19tb2RpZmllci52YWx1ZSkKCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBpZiBhYV92YWx1ZS5lbmFibGVkOmdldCgpIGFuZCBoZWxwZXJzWydmdW5jdGlvbnMnXTptYW51YWxhYSgpID09IDAgYW5kIHZhcnMuYW5nbGVzLnR5cGUudmFsdWUgPT0gJ0J1aWxkZXInIHRoZW4KICAgICAgICBpZiBhYV92YWx1ZS55YXc6Z2V0KCkgPT0gJzE4MCBMZWZ0IC8gUmlnaHQnICB0aGVuCiAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdbMV0sICIxODAiKQogICAgICAgIHVpLnNldChyZWZlcmVuY2UucGl0Y2hbMV0sIGFhX3ZhbHVlLnBpdGNoLnZhbHVlKQogICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3YmFzZSwgYWFfdmFsdWUueWF3X2Jhc2UudmFsdWUpCiAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS5waXRjaFsyXSwgYWFfdmFsdWUucGl0Y2hfdmFsdWUudmFsdWUpCiAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdqaXR0ZXJbMl0sIGFhX3ZhbHVlLnlhd19tb2RpZmllcl9vZmZzZXQudmFsdWUpCiAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS5ib2R5eWF3WzJdLCBhYV92YWx1ZS5ib2R5X3lhd19vZmZzZXQudmFsdWUpCiAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS5mc2JvZHl5YXcsIGZhbHNlKQogICAgZWxzZQogICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3WzFdLCBhYV92YWx1ZS55YXc6Z2V0KCkpCiAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS5waXRjaFsxXSwgYWFfdmFsdWUucGl0Y2gudmFsdWUpCiAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdiYXNlLCBhYV92YWx1ZS55YXdfYmFzZS52YWx1ZSkKICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnBpdGNoWzJdLCBhYV92YWx1ZS5waXRjaF92YWx1ZS52YWx1ZSkKICAgICAgICB1aS5zZXQocmVmZXJlbmNlLmJvZHl5YXdbMV0sIGFhX3ZhbHVlLmJvZHlfeWF3LnZhbHVlKQogICAgICAgIHVpLnNldChyZWZlcmVuY2UuYm9keXlhd1syXSwgYWFfdmFsdWUuYm9keV95YXdfb2Zmc2V0LnZhbHVlKQogICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3aml0dGVyWzFdLCBhYV92YWx1ZS55YXdfbW9kaWZpZXIudmFsdWUpCiAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdqaXR0ZXJbMl0sIGFhX3ZhbHVlLnlhd19tb2RpZmllcl9vZmZzZXQudmFsdWUpCiAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdbMl0sIGFhX3ZhbHVlLnlhd19vZmZzZXQ6Z2V0KCkpCiAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS5mc2JvZHl5YXcsIGZhbHNlKQoKICAgIGVuZCAgCgogICAgZWxzZWlmIGhlbHBlcnNbJ2Z1bmN0aW9ucyddOm1hbnVhbGFhKCkgPT0gMCBhbmQgdmFycy5hbmdsZXMudHlwZS52YWx1ZT09ICdQcmVzZXQnIHRoZW4KICAgICAgICBpZiBwbGF5ZXJfc3RhdGUgPT0gOCB0aGVuCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3WzFdLCAiMTgwIikKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS5waXRjaFsxXSwgJ0RlZmF1bHQnKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd2Jhc2UsICJBdCB0YXJnZXRzIikKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS5waXRjaFsyXSwgMCkKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS5ib2R5eWF3WzFdLCAnSml0dGVyJykKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS5ib2R5eWF3WzJdLCAtMTkpCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3aml0dGVyWzFdLCAiQ2VudGVyIikKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdqaXR0ZXJbMl0sIDM3KQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd1syXSwgc2lkZSA9PSAxIGFuZCAtMTMgIG9yIDEzKQogICAgICAgIGVsc2VpZiBwbGF5ZXJfc3RhdGUgPT0gNyB0aGVuCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3WzFdLCAiMTgwIikKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS5waXRjaFsxXSwgJ0RlZmF1bHQnKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd2Jhc2UsICJBdCB0YXJnZXRzIikKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS5waXRjaFsyXSwgMCkKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS5ib2R5eWF3WzFdLCAnT2ZmJykKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS5ib2R5eWF3WzJdLCAwKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd2ppdHRlclsxXSwgIk9mZiIpCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3aml0dGVyWzJdLCAwKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd1syXSwgMCkKICAgICAgICBlbHNlaWYgcGxheWVyX3N0YXRlID09IDUgIHRoZW4KICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdbMV0sICIxODAiKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnBpdGNoWzFdLCAnRGVmYXVsdCcpCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3YmFzZSwgIkF0IHRhcmdldHMiKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnBpdGNoWzJdLCAwKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLmJvZHl5YXdbMV0sICdKaXR0ZXInKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLmJvZHl5YXdbMl0sIC0xOSkKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdqaXR0ZXJbMV0sICJDZW50ZXIiKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd2ppdHRlclsyXSwgMzcpCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3WzJdLCBzaWRlID09IDEgYW5kIC0xMyAgb3IgMTMpCiAgICAgICAgZWxzZWlmIHBsYXllcl9zdGF0ZSA9PSAzICAgdGhlbgogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd1sxXSwgIjE4MCIpCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UucGl0Y2hbMV0sICdEZWZhdWx0JykKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdiYXNlLCAiQXQgdGFyZ2V0cyIpCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UucGl0Y2hbMl0sIDApCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UuYm9keXlhd1sxXSwgJ0ppdHRlcicpCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UuYm9keXlhd1syXSwgLTE5KQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd2ppdHRlclsxXSwgIkNlbnRlciIpCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3aml0dGVyWzJdLCA0MykKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdbMl0sIHNpZGUgPT0gMSBhbmQgLTE0ICBvciAxNCkKICAgICAgICBlbHNlaWYgcGxheWVyX3N0YXRlID09IDQgIHRoZW4KICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdbMV0sICIxODAiKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnBpdGNoWzFdLCAnRGVmYXVsdCcpCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3YmFzZSwgIkF0IHRhcmdldHMiKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnBpdGNoWzJdLCAwKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLmJvZHl5YXdbMV0sICdKaXR0ZXInKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLmJvZHl5YXdbMl0sIC0xOSkKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdqaXR0ZXJbMV0sICJDZW50ZXIiKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd2ppdHRlclsyXSwgNDEpCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3WzJdLCBzaWRlID09IDEgYW5kIC02ICBvciAxMCkKICAgICAgICBlbHNlaWYgcGxheWVyX3N0YXRlID09IDYgdGhlbgogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd1sxXSwgIjE4MCIpCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UucGl0Y2hbMV0sICdEZWZhdWx0JykKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdiYXNlLCAiQXQgdGFyZ2V0cyIpCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UucGl0Y2hbMl0sIDApCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UuYm9keXlhd1sxXSwgJ0ppdHRlcicpCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UuYm9keXlhd1syXSwgLTE5KQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd2ppdHRlclsxXSwgIkNlbnRlciIpCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3aml0dGVyWzJdLCAzOCkKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdbMl0sIHNpZGUgPT0gMSBhbmQgLTEyICBvciAxMikKICAgICAgICBlbHNlaWYgcGxheWVyX3N0YXRlID09IDIgIHRoZW4KICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdbMV0sICIxODAiKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnBpdGNoWzFdLCAnRGVmYXVsdCcpCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3YmFzZSwgIkF0IHRhcmdldHMiKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnBpdGNoWzJdLCAwKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLmJvZHl5YXdbMV0sICdKaXR0ZXInKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLmJvZHl5YXdbMl0sIC0xOSkKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdqaXR0ZXJbMV0sICJDZW50ZXIiKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd2ppdHRlclsyXSwgNDUpCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3WzJdLCBzaWRlID09IDEgYW5kIC0xMiAgb3IgNikgICAKICAgICAgICAgZWxzZWlmIHBsYXllcl9zdGF0ZSA9PSAxIHRoZW4KICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdbMV0sICIxODAiKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnBpdGNoWzFdLCAnRGVmYXVsdCcpCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3YmFzZSwgIkF0IHRhcmdldHMiKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnBpdGNoWzJdLCAwKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLmJvZHl5YXdbMV0sICdKaXR0ZXInKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLmJvZHl5YXdbMl0sIC0xOSkKICAgICAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS55YXdqaXR0ZXJbMV0sICJDZW50ZXIiKQogICAgICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd2ppdHRlclsyXSwgMjgpCiAgICAgICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3WzJdLCBzaWRlID09IDEgYW5kIC0xMiAgb3IgMTIpIAogICAgICAgIGVuZCAKICAgIGVsc2VpZiBub3QgYWFfdmFsdWUuZW5hYmxlZDpnZXQoKSBhbmQgaGVscGVyc1snZnVuY3Rpb25zJ106bWFudWFsYWEoKSA9PSAwIGFuZCB2YXJzLmFuZ2xlcy50eXBlLnZhbHVlID09ICdCdWlsZGVyJyAgdGhlbgogICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3WzFdLCAib2ZmIikKICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnBpdGNoWzFdLCAnb2ZmJykKICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd2Jhc2UsICJsb2NhbCB2aWV3IikKICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnBpdGNoWzJdLCAwKQogICAgICAgIHVpLnNldChyZWZlcmVuY2UuYm9keXlhd1sxXSwgJ29mZicpCiAgICAgICAgdWkuc2V0KHJlZmVyZW5jZS5ib2R5eWF3WzJdLCAwKQogICAgICAgIHVpLnNldChyZWZlcmVuY2UueWF3aml0dGVyWzFdLCAib2ZmIikKICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd2ppdHRlclsyXSwgMCkKICAgICAgICB1aS5zZXQocmVmZXJlbmNlLnlhd1syXSwgMCkKICAgCiAgICBlbmQgICAKICAgICAgICAgIAogICAgICAgICAgICBoYW5kbGVfZGVmZW5zaXZlKGMpCiAgICAgICAgICAgIGhhbmRsZV9zdGF0aWNfZnJlZXN0YW5kKGMpCiAgICAgICAgICAgIGhhbmRsZV9zdGF0aWNfd2FybXVwKGMpCiAgICAgICAgICAgIGhhbmRsZV9lZGdlX2Zha2VkdWNrKGMpCiAgICAgICAgICAgIGhhbmRsZV9tYW51YWxzKGMpCiAgICAgICAgICAgIGhhbmRsZV9ib21iaXN0ZV9maXgoYykKCgplbmQKCmhhbmRsZV9kcm9wX25hZGVzID0gZnVuY3Rpb24oYykKICAgIGlmIG5vdCB2YXJzLm1pc2MuZW5hYmxlZDpnZXQoKSB0aGVuCiAgICAgICAgdGFibGUuY2xlYXIoaGVscGVyc1snZnVuY3Rpb25zJ10uZ3JlbmFkZXNfbGlzdCk7CiAgICAgICAgcmV0dXJuOwogICAgZW5kCgogICAgbG9jYWwgd3BuID0gZW50aXR5LmdldF9wbGF5ZXJfd2VhcG9uKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkpOwogICAgaWYgd3BuID09IG5pbCB0aGVuIHJldHVybiBlbmQKCiAgICBpZiBub3QgdmFycy5taXNjLmhrOmdldCgpIHRoZW4KICAgICAgICB0YWJsZS5jbGVhcihoZWxwZXJzWydmdW5jdGlvbnMnXS5ncmVuYWRlc19saXN0KTsKICAgICAgICBoZWxwZXJzWydmdW5jdGlvbnMnXTp1cGRhdGVfcGxheWVyX3dlYXBvbnMoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSk7CiAgICAgICAgcmV0dXJuCiAgICBlbmQKCiAgICBpZiBoZWxwZXJzWydmdW5jdGlvbnMnXS5ncmVuYWRlc19saXN0ID09IG5pbCB0aGVuCiAgICAgICAgcmV0dXJuOwogICAgZW5kCgogICAgbG9jYWwgd2FudGVkX3dlYXBvbiA9IGhlbHBlcnNbJ2Z1bmN0aW9ucyddLmdyZW5hZGVzX2xpc3RbMV07CgogICAgaWYgd2FudGVkX3dlYXBvbiA9PSBuaWwgdGhlbgogICAgICAgIHJldHVybjsKICAgIGVuZAoKICAgIGlmIHdwbiA9PSB3YW50ZWRfd2VhcG9uIHRoZW4KICAgICAgICBsb2NhbCBwaXRjaCwgeWF3ID0gY2xpZW50LmNhbWVyYV9hbmdsZXMoKTsKCiAgICAgICAgbG9jYWwgb2Zmc2V0ID0gMC4wMDAxOwoKICAgICAgICBpZiBwaXRjaCA+IDAgdGhlbgogICAgICAgICAgICBvZmZzZXQgPSAtb2Zmc2V0OwogICAgICAgIGVuZAoKICAgICAgICBjLnlhdyA9IHlhdzsKICAgICAgICBjLnBpdGNoID0gcGl0Y2ggKyBvZmZzZXQ7CgogICAgICAgIGlmIHdwbiA9PSBoZWxwZXJzWydmdW5jdGlvbnMnXS5wcmV2X3dwbiB0aGVuCiAgICAgICAgICAgIGMubm9fY2hva2UgPSB0cnVlOwogICAgICAgICAgICBjLmFsbG93X3NlbmRfcGFja2V0ID0gdHJ1ZTsKCiAgICAgICAgICAgIGlmIGMuY2hva2VkY29tbWFuZHMgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICBjbGllbnQuZXhlYygiZHJvcCIpOwogICAgICAgICAgICAgICAgdGFibGUucmVtb3ZlKGhlbHBlcnNbJ2Z1bmN0aW9ucyddLmdyZW5hZGVzX2xpc3QsIDEpOwogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGMud2VhcG9uc2VsZWN0ID0gd2FudGVkX3dlYXBvbjsKICAgIGhlbHBlcnNbJ2Z1bmN0aW9ucyddLnByZXZfd3BuID0gd3BuOwplbmQKCmhhbmRsZV9mYXN0bGFkZGVyID0gZnVuY3Rpb24oYykKICAgIGlmIHZhcnMuYWEuZW5jaGE6Z2V0KCdGYXN0IExhZGRlciBNb3ZlJykgdGhlbgogICAgICAgIGxvY2FsIHBpdGNoLCB5YXcgPSBjbGllbnQuY2FtZXJhX2FuZ2xlcygpCiAgICAgICAgaWYgZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX01vdmVUeXBlIikgPT0gOSB0aGVuCiAgICAgICAgICAgIGMueWF3ID0gbWF0aC5mbG9vcihjLnlhdyswLjUpCiAgICAgICAgICAgIGMucm9sbCA9IDAKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGMuZm9yd2FyZG1vdmUgPiAwIHRoZW4KICAgICAgICAgICAgICAgIGlmIHBpdGNoIDwgNDUgdGhlbgoKICAgICAgICAgICAgICAgICAgICBjLnBpdGNoID0gODkKICAgICAgICAgICAgICAgICAgICBjLmluX21vdmVyaWdodCA9IDEKICAgICAgICAgICAgICAgICAgICBjLmluX21vdmVsZWZ0ID0gMAogICAgICAgICAgICAgICAgICAgIGMuaW5fZm9yd2FyZCA9IDAKICAgICAgICAgICAgICAgICAgICBjLmluX2JhY2sgPSAxCgogICAgICAgICAgICAgICAgICAgIGlmIGMuc2lkZW1vdmUgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGMueWF3ID0gYy55YXcgKyA5MAogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBpZiBjLnNpZGVtb3ZlIDwgMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGMueWF3ID0gYy55YXcgKyAxNTAKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgaWYgYy5zaWRlbW92ZSA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBjLnlhdyA9IGMueWF3ICsgMzAKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZCAKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBjLmZvcndhcmRtb3ZlIDwgMCB0aGVuCiAgICAgICAgICAgICAgICBjLnBpdGNoID0gODkKICAgICAgICAgICAgICAgIGMuaW5fbW92ZWxlZnQgPSAxCiAgICAgICAgICAgICAgICBjLmluX21vdmVyaWdodCA9IDAKICAgICAgICAgICAgICAgIGMuaW5fZm9yd2FyZCA9IDEKICAgICAgICAgICAgICAgIGMuaW5fYmFjayA9IDAKICAgICAgICAgICAgICAgIGlmIGMuc2lkZW1vdmUgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgYy55YXcgPSBjLnlhdyArIDkwCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIGMuc2lkZW1vdmUgPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICBjLnlhdyA9IGMueWF3ICsgMTUwCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIGMuc2lkZW1vdmUgPCAwIHRoZW4KICAgICAgICAgICAgICAgICAgICBjLnlhdyA9IGMueWF3ICsgMzAKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgplbmQpKCkKCgpMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbiAoKQoKICAgIHRoaXJkcGVyc29uX3JlbmRlciA9IGZ1bmN0aW9uKCkKCiAgICAgICAgaWYgdmFycy5taXNjLnRoaXJkcGVyc29uOmdldCgpIHRoZW4KICAgICAgICAgICAgY2xpZW50LmV4ZWMoImNhbV9pZGVhbGRpc3QgIiwgdmFycy5taXNjLmRpc3RhbmNlX3NsaWRlcjpnZXQoKSkKICAgICAgICBlbHNlCiAgICAKICAgICAgICBlbmQKCiAgICBlbmQKCiAgICBhcnJvd3NfcmVuZGVyID0gZnVuY3Rpb24oKQogICAgCiAgICAgICAgaWYgbm90IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkgb3Igbm90IGVudGl0eS5pc19hbGl2ZShlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpKSB0aGVuCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAogICAgCiAgICAgICAgbG9jYWwgYXJyb3dfY29sb3IgPSB7dmFycy52aXN1YWxzLm1hbnVhbF9hcnJvd3NfY29sb3I6Z2V0KCl9CiAgICAgICAgbG9jYWwgZ2xvYmFsX2FscGhhID0gaGVscGVyc1snZnVuY3Rpb25zJ10uYW5pbWF0aW9uczphbmltYXRlKCJhbHBoYTIiLCBub3QgKHZhcnMudmlzdWFscy5pbmRpY2F0b3JzOmdldCgpICBhbmQgdmFycy52aXN1YWxzLndpZGdldHM6Z2V0KCdBbnRpLUFpbSBBcnJvd3MnKSApLCA2KQogICAgICAgIGxvY2FsIGxlZnRfYWxwaGEgPSBoZWxwZXJzWydmdW5jdGlvbnMnXS5hbmltYXRpb25zOmFuaW1hdGUoImFscGhhX2Fycm93c19sZWZ0Iiwgbm90IChoZWxwZXJzWydmdW5jdGlvbnMnXTptYW51YWxhYSgpID09IDEpLCA2KQogICAgICAgIGxvY2FsIHJpZ2h0X2FscGhhID0gaGVscGVyc1snZnVuY3Rpb25zJ10uYW5pbWF0aW9uczphbmltYXRlKCJhbHBoYV9hcnJvd3NfcmlnaHQiLCBub3QgKGhlbHBlcnNbJ2Z1bmN0aW9ucyddOm1hbnVhbGFhKCkgPT0gMiksIDYpCiAgICAKICAgICAgICByZW5kZXJlci50ZXh0KHgvMi01NSx5LzItMiwgYXJyb3dfY29sb3JbMV0sIGFycm93X2NvbG9yWzJdLCBhcnJvd19jb2xvclszXSwgYXJyb3dfY29sb3JbNF0qZ2xvYmFsX2FscGhhKmxlZnRfYWxwaGEsICdjKycsIDAsICfigLknKQogICAgICAgIHJlbmRlcmVyLnRleHQoeC8yKzU1LHkvMi0yLCBhcnJvd19jb2xvclsxXSwgYXJyb3dfY29sb3JbMl0sIGFycm93X2NvbG9yWzNdLCBhcnJvd19jb2xvcls0XSpnbG9iYWxfYWxwaGEqcmlnaHRfYWxwaGEsICdjKycsIDAsICfigLonKQogICAgCiAgICBlbmQKICAgIGRhbWFnZV9yZW5kZXIgPSBmdW5jdGlvbigpCgogICAgICAgIGlmIG5vdCBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpIG9yIG5vdCBlbnRpdHkuaXNfYWxpdmUoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkgdGhlbgogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgZGFtYWdlID0gaGVscGVyc1snZnVuY3Rpb25zJ106Z2V0X2RhbWFnZSgpOwogICAgCiAgICAgICAgaGVscGVyc1snZnVuY3Rpb25zJ10uZGFtYWdlX2FuaW0gPSBoZWxwZXJzWydmdW5jdGlvbnMnXTpsZXJwMihoZWxwZXJzWydmdW5jdGlvbnMnXS5kYW1hZ2VfYW5pbSwgZGFtYWdlLCAwLjA0MCkKCiAgICAgICAgbG9jYWwgZG1nX3N0cmluZyA9IGRhbWFnZSA9PSAwIGFuZCAiQVVUTyIgb3IgdG9zdHJpbmcobWF0aC5mbG9vcihoZWxwZXJzWydmdW5jdGlvbnMnXS5kYW1hZ2VfYW5pbSArIDAuNSkpCgogICAgICAgIGxvY2FsIGdsb2JhbF9hbHBoYSA9IGhlbHBlcnNbJ2Z1bmN0aW9ucyddLmFuaW1hdGlvbnM6YW5pbWF0ZSgiZGFtYWdlX2luZCIsIG5vdCAodmFycy52aXN1YWxzLmluZGljYXRvcnM6Z2V0KCkgYW5kIHZhcnMudmlzdWFscy53aWRnZXRzOmdldCgnRGFtYWdlIEluZGljYXRvcicpKSwgMTIpCiAgICAgICAgbG9jYWwgc3R5bGVfYWxwaGExMSA9IGhlbHBlcnNbJ2Z1bmN0aW9ucyddLmFuaW1hdGlvbnM6YW5pbWF0ZSgiZGFtYWdlX2luZF9zdHlsZTEiLCBub3QgKHZhcnMudmlzdWFscy5kYW1hZ2Vfc3R5bGU6Z2V0KCkgPT0gJyMxJyksIDEyKQogICAgICAgIGxvY2FsIHN0eWxlX2FscGhhMTIgPSBoZWxwZXJzWydmdW5jdGlvbnMnXS5hbmltYXRpb25zOmFuaW1hdGUoImRhbWFnZV9pbmRfc3R5bGUyIiwgbm90ICh2YXJzLnZpc3VhbHMuZGFtYWdlX3N0eWxlOmdldCgpID09ICcjMicpLCAxMikKCgogICAgICAgIHJlbmRlcmVyLnRleHQoeC8yKzUseS8yKzUsIDIwMCwyMDAsMjAwLDIyMCpnbG9iYWxfYWxwaGEqc3R5bGVfYWxwaGExMSwgJ2RiJywgMCwgZG1nX3N0cmluZykKCiAgICAgICAgbG9jYWwgZG1nX2lzID0gaGVscGVyc1snZnVuY3Rpb25zJ10uYW5pbWF0aW9uczphbmltYXRlKCJkYW1hZ2VfaW5kX2VuYSIsIG5vdCAodWkuZ2V0KHJlZmVyZW5jZS5kbWdbMV0pIGFuZCB1aS5nZXQocmVmZXJlbmNlLmRtZ1syXSkpLCAxMikKCiAgICAgICAgcmVuZGVyZXIudGV4dCh4LzIrNSx5LzItMTUsIDIwMCwyMDAsMjAwLDIyMCpnbG9iYWxfYWxwaGEqZG1nX2lzKnN0eWxlX2FscGhhMTIsICdEZWZhdWx0JywgMCwgdWkuZ2V0KHJlZmVyZW5jZS5kbWdbM10pKQoKICAgIAogICAgZW5kCgogICAgYXNwZWN0cmF0aW9fcmVuZGVyID0gZnVuY3Rpb24oKQogICAgICAgIAogICAgICAgIGlmIHZhcnMubWlzYy5hc3BlY3RyYXRpbzpnZXQoKSAgdGhlbgogICAgICAgICAgICBpZiB2YXJzLm1pc2MuYXNwX29mZnNldDpnZXQoKSA9PSAwIHRoZW4KICAgICAgICAgICAgICAgIGN2YXIucl9hc3BlY3RyYXRpbzpzZXRfZmxvYXQoMCkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgY3Zhci5yX2FzcGVjdHJhdGlvOnNldF9mbG9hdCh2YXJzLm1pc2MuYXNwX29mZnNldDpnZXQoKS8xMDApCiAgICAgICAgICAgIGVuZAogICAgICAgIGVsc2UKICAgICAgICAgICAgY3Zhci5yX2FzcGVjdHJhdGlvOnNldF9mbG9hdCgpCiAgICAgICAgZW5kCgogICAgZW5kCgogICAgdmlld21vZGVsX3JlbmRlciA9IGZ1bmN0aW9uKCkKCiAgICAgICAgaWYgdmFycy5taXNjLnZpZXdtb2RlbDpnZXQoKSB0aGVuCiAgICAgICAgICAgIGN2YXIudmlld21vZGVsX2ZvdjpzZXRfcmF3X2Zsb2F0KHZhcnMubWlzYy52aWV3bW9kZWxfZm92OmdldCgpLCB0cnVlKQogICAgICAgICAgICBjdmFyLnZpZXdtb2RlbF9vZmZzZXRfeDpzZXRfcmF3X2Zsb2F0KHZhcnMubWlzYy52aWV3bW9kZWxfeDpnZXQoKSAvIDEwLCB0cnVlKQogICAgICAgICAgICBjdmFyLnZpZXdtb2RlbF9vZmZzZXRfeTpzZXRfcmF3X2Zsb2F0KHZhcnMubWlzYy52aWV3bW9kZWxfeTpnZXQoKSAvIDEwLCB0cnVlKQogICAgICAgICAgICBjdmFyLnZpZXdtb2RlbF9vZmZzZXRfejpzZXRfcmF3X2Zsb2F0KHZhcnMubWlzYy52aWV3bW9kZWxfejpnZXQoKSAvIDEwLCB0cnVlKQogICAgICAgIGVsc2UKICAgICAgICAgICAgY3Zhci52aWV3bW9kZWxfZm92OnNldF9yYXdfZmxvYXQoKQogICAgICAgICAgICBjdmFyLnZpZXdtb2RlbF9vZmZzZXRfeDpzZXRfcmF3X2Zsb2F0KCkKICAgICAgICAgICAgY3Zhci52aWV3bW9kZWxfb2Zmc2V0X3k6c2V0X3Jhd19mbG9hdCgpCiAgICAgICAgICAgIGN2YXIudmlld21vZGVsX29mZnNldF96OnNldF9yYXdfZmxvYXQoKQogICAgICAgIGVuZAplbmQKCiAgICB3YXRlcm1hcmtfcmVuZGVyID0gZnVuY3Rpb24oKQoKICAgICAgICBpZiBub3QgZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSB0aGVuCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGxvY2FsIHIxLGcxLGIxLGExID0gdmFycy52aXN1YWxzLndhdGVybWFya19jb2xvcjpnZXQoKQogICAgICAgICAgICAgICAgbG9jYWwgcixnLGIsYSA9IHZhcnMudmlzdWFscy53YXRlcm1hcmtfY29sb3JfbW9kZV8yOmdldCgpCgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIGdsb2JhbF9hbHBoYSA9IGhlbHBlcnNbJ2Z1bmN0aW9ucyddLmFuaW1hdGlvbnM6YW5pbWF0ZSgiYWxwaGE1Iiwgbm90ICh2YXJzLnZpc3VhbHMud2F0ZXJtYXJrOmdldCgpKSwgNikKICAgICAgICAgICAgICAgIGxvY2FsIGxlZnRfYWxwaGEgPSBoZWxwZXJzWydmdW5jdGlvbnMnXS5hbmltYXRpb25zOmFuaW1hdGUoImFscGhhMTUiLCBub3QgKHZhcnMudmlzdWFscy53YXRlcm1hcmtfcG9zaXRpb246Z2V0KCkgPT0gJ0xlZnQnKSwgNikKICAgICAgICAgICAgICAgIGxvY2FsIHJpZ2h0X2FscGhhID0gaGVscGVyc1snZnVuY3Rpb25zJ10uYW5pbWF0aW9uczphbmltYXRlKCJhbHBoYTY1Iiwgbm90ICh2YXJzLnZpc3VhbHMud2F0ZXJtYXJrX3Bvc2l0aW9uOmdldCgpID09ICdSaWdodCcpLCA2KQogICAgICAgICAgICAgICAgbG9jYWwgc3R5bGVfMSA9IGhlbHBlcnNbJ2Z1bmN0aW9ucyddLmFuaW1hdGlvbnM6YW5pbWF0ZSgid2F0ZXJtYXJrX21vZGVfMSIsIG5vdCAodmFycy52aXN1YWxzLndhdGVybWFya19tb2RlOmdldCgpID09ICcjMScpLCA2KQogICAgICAgICAgICAgICAgbG9jYWwgc3R5bGVfMiA9IGhlbHBlcnNbJ2Z1bmN0aW9ucyddLmFuaW1hdGlvbnM6YW5pbWF0ZSgid2F0ZXJtYXJrX21vZGVfMiIsIG5vdCAodmFycy52aXN1YWxzLndhdGVybWFya19tb2RlOmdldCgpID09ICcjMicpLCA2KQogICAgICAgICAgICAgICAgbG9jYWwgbGVmdF93YXRlciA9IGhlbHBlcnNbJ2Z1bmN0aW9ucyddOmZhZGVfaGFuZGxlKGdsb2JhbHMuY3VydGltZSgpKjEuMiwgIkEgIE0gIFAgIEggIEkgIEIgIEkgIEEiLCByMSxnMSxiMSwgYTEqZ2xvYmFsX2FscGhhKmxlZnRfYWxwaGEqc3R5bGVfMSkKICAgICAgICAgICAgICAgIGxvY2FsIHJpZ2h0X3dhdGVyID0gaGVscGVyc1snZnVuY3Rpb25zJ106ZmFkZV9oYW5kbGUoLWdsb2JhbHMuY3VydGltZSgpKjEuMiwgIkEgIE0gIFAgIEggIEkgIEIgIEkgIEEiLCByMSxnMSxiMSwgYTEqZ2xvYmFsX2FscGhhKnJpZ2h0X2FscGhhKnN0eWxlXzEpCiAgICAgICAgICAgICAgICBsb2NhbCB0ZXh0ID0gJ1xhJy4uaGVscGVyc1snZnVuY3Rpb25zJ106cmdiYV90b19oZXgocixnLGIsYSpnbG9iYWxfYWxwaGEqc3R5bGVfMikuLidhbXBoaWJpYScuLidcYScuLmhlbHBlcnNbJ2Z1bmN0aW9ucyddOnJnYmFfdG9faGV4KDIwMCwgMjAwLCAyMDAsMjU1Kmdsb2JhbF9hbHBoYSpzdHlsZV8yKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiB2YXJzLnZpc3VhbHMud2F0ZXJtYXJrX2l0ZW1zOmdldCgnVXNlcm5hbWUnKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHRleHQuLicgwrcgJy4ubG9hZGVyLnVzZXJuYW1lCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIHZhcnMudmlzdWFscy53YXRlcm1hcmtfaXRlbXM6Z2V0KCdMYXRlbmN5JykgdGhlbgogICAgICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0Li4nIMK3ICcuLnN0cmluZy5mb3JtYXQoJyVkIG1zJywgY2xpZW50LnJlYWxfbGF0ZW5jeSgpICogMTAwMCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgdmFycy52aXN1YWxzLndhdGVybWFya19pdGVtczpnZXQoJ0ZyYW1lcmF0ZScpIHRoZW4KICAgICAgICAgICAgICAgICAgICBoZWxwZXJzWydmdW5jdGlvbnMnXS5mcmFtZXJhdGUgPSAwLjkgKiBoZWxwZXJzWydmdW5jdGlvbnMnXS5mcmFtZXJhdGUgKyAoMS4wIC0gMC45KSAqIGdsb2JhbHMuYWJzb2x1dGVmcmFtZXRpbWUoKQogICAgICAgICAgICAgICAgICAgIGhlbHBlcnNbJ2Z1bmN0aW9ucyddLmxhc3RfZnJhbWVyYXRlID0gaGVscGVyc1snZnVuY3Rpb25zJ10uZnJhbWVyYXRlID4gMCBhbmQgaGVscGVyc1snZnVuY3Rpb25zJ10uZnJhbWVyYXRlIG9yIDEKICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC4uJyDCtyAnLi5zdHJpbmcuZm9ybWF0KCclZCBmcHMnLCAxIC8gaGVscGVyc1snZnVuY3Rpb25zJ10ubGFzdF9mcmFtZXJhdGUpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiB2YXJzLnZpc3VhbHMud2F0ZXJtYXJrX2l0ZW1zOmdldCgnVGltZScpIHRoZW4KICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC4uJyDCtyAnLi5zdHJpbmcuZm9ybWF0KCclMDJkOiUwMmQnLCBjbGllbnQuc3lzdGVtX3RpbWUoKSkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIHRleHRfc2l6ZSA9IHJlbmRlcmVyLm1lYXN1cmVfdGV4dChuaWwsIHRleHQpCgogICAgICAgICAgICAgICAgcmVuZGVyZXIucmVjdGFuZ2xlKHgtMTkgLSB0ZXh0X3NpemUsIDE5LCB0ZXh0X3NpemUrMTAsIDIwLCAwLCAwLCAwLCAxNTAgKiBnbG9iYWxfYWxwaGEqc3R5bGVfMikKICAgICAgICAgICAgICAgIHJlbmRlcmVyLnRleHQoeC0xNCAtdGV4dF9zaXplICwyMiwgMjU1LCAyNTUsIDI1NSwgMjU1ICogZ2xvYmFsX2FscGhhKiBzdHlsZV8yLCBuaWwsIG5pbCwgdGV4dCkKCgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJlbmRlcmVyLnRleHQoeC8yMSAtIDcyLHkvMiwgMjU1LDI1NSwyNTUsIDI1NSpnbG9iYWxfYWxwaGEgKiBsZWZ0X2FscGhhICogc3R5bGVfMSwgbmlsLCBuaWwsIHVucGFjayhsZWZ0X3dhdGVyKSkKICAgICAgICAgICAgICAgIHJlbmRlcmVyLnRleHQoeCAtIDEyNSx5LzIsIDI1NSwyNTUsMjU1LCAyNTUqZ2xvYmFsX2FscGhhKnJpZ2h0X2FscGhhICogc3R5bGVfMSwgbmlsLCBuaWwsIHVucGFjayhyaWdodF93YXRlcikpCiAgICBlbmQKCiAgICAgICAgaGl0bWFya2VyX3JlbmRlciA9IGZ1bmN0aW9uKCkKCiAgICAgICAgICAgIGlmIG5vdCB2YXJzLnZpc3VhbHMud2lkZ2V0czpnZXQoJ0hpdG1hcmtlcicpIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICBpZiBub3QgZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSBvciBub3QgZW50aXR5LmlzX2FsaXZlKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkpIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICBpZiBub3QgdmFycy52aXN1YWxzLmluZGljYXRvcnM6Z2V0KCkgdGhlbiByZXR1cm4gZW5kCgogICAgICAgICAgICBsb2NhbCByLGcsYixhID0gdmFycy52aXN1YWxzLmhpdG1hcmtlcl9jb2xvcjpnZXQoKQogICAgICAgICAgICBmb3IgdGljaywgZGF0YSBpbiBwYWlycyhoZWxwZXJzWydmdW5jdGlvbnMnXS5oaXRtYXJrZXJfZGF0YSkgZG8KICAgICAgICAgICAgICAgIGlmIGdsb2JhbHMucmVhbHRpbWUoKSA8PSBkYXRhWzRdIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCB4MSwgeTEgPSByZW5kZXJlci53b3JsZF90b19zY3JlZW4oZGF0YVsxXSwgZGF0YVsyXSwgZGF0YVszXSkKICAgICAgICAgICAgICAgICAgICBpZiB4MSB+PSBuaWwgYW5kIHkxIH49IG5pbCB0aGVuCgogICAgICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLmxpbmUoeDEgLSA2LHkxLHgxICsgNix5MSxyLGcsYixhKQogICAgICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLmxpbmUoeDEseTEgLSA2LHgxLHkxICsgNiAscixnLGIsYSkKCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIHZlbG9jaXR5X3JlbmRlciA9IHN5c3RlbS5yZWdpc3Rlcih7dmFycy52aXN1YWxzLnZlbG9jaXR5X3gsIHZhcnMudmlzdWFscy52ZWxvY2l0eV95fSwgdmVjdG9yKDE1OCwzNSksICJTbG93ZWQgRG93biBJbmRpY2F0b3IiLCBmdW5jdGlvbihzZWxmKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkgb3Igbm90IGVudGl0eS5pc19hbGl2ZShlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpKSB0aGVuIHJldHVybiBlbmQKICAgICAgICAKICAgICAgICAgICAgbG9jYWwgciwgZywgYiwgYSA9IHZhcnMudmlzdWFscy5jb2xvcl9zbG93ZWQ6Z2V0KCkKICAgICAgICAgICAgbG9jYWwgbW9kaWZpZXIgPSAgZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksIm1fZmxWZWxvY2l0eU1vZGlmaWVyIikKICAgICAgICAKICAgICAgICAgICAgaWYgdWkuaXNfbWVudV9vcGVuKCkgdGhlbgogICAgICAgICAgICAgICAgbW9kaWZpZXIgPSBoZWxwZXJzWydmdW5jdGlvbnMnXS52ZWxvY2l0eV9zbW90aCgwLjEsIGdsb2JhbHMudGlja2NvdW50KCkgJSAxMjUpLzEyMgogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBtb2RpZmllciA9IG1vZGlmaWVyCiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgIAogICAgICAgICAgICBsb2NhbCBpc19ib3VuZGVkID0gaGVscGVyc1snZnVuY3Rpb25zJ106aXNfYm91bmRlZChzZWxmLnBvc2l0aW9uLngsIHNlbGYucG9zaXRpb24ueSwgc2VsZi5wb3NpdGlvbi54ICsgMTU4LCBzZWxmLnBvc2l0aW9uLnkgKyAzNSkKICAgICAgICAKICAgICAgICAgICAgaWYgaXNfYm91bmRlZCBhbmQgY2xpZW50LmtleV9zdGF0ZSgweDIpIHRoZW4KICAgICAgICAgICAgICAgIHNlbGYucG9zaXRpb24ueCA9IHgvMi04MgogICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIGdsb2JhbF9hbHBoYSA9IGhlbHBlcnNbJ2Z1bmN0aW9ucyddLmFuaW1hdGlvbnM6YW5pbWF0ZSgiZ2xvYmFsX3Nsb3dlZF9hbHBoYSIsIG5vdCAodmFycy52aXN1YWxzLnNsb3dlZDpnZXQoKSksIDYpCiAgICAgICAgICAgIGxvY2FsIGFscGhhID0gaGVscGVyc1snZnVuY3Rpb25zJ10uYWxwaGFfdmVsKDAuMDUsIHVpLmlzX21lbnVfb3BlbigpIGFuZCAyNTUgb3IgKG1vZGlmaWVyID09IDEgYW5kIDAgb3IgMjU1KSkgKiBnbG9iYWxfYWxwaGEKICAgICAgICAgICAgbG9jYWwgYm91bmRlZF9hbHBoYSA9IGhlbHBlcnNbJ2Z1bmN0aW9ucyddLmlzX2JkX2FscGhhKDAuMDUsIHVpLmlzX21lbnVfb3BlbigpIGFuZCAoaXNfYm91bmRlZCBhbmQgbm90IGNsaWVudC5rZXlfc3RhdGUoMHgxKSBhbmQgMTUwIG9yIGlzX2JvdW5kZWQgYW5kIGNsaWVudC5rZXlfc3RhdGUoMHgxKSBhbmQgMTAwIG9yIDI1NSkgb3IgMCkgKiBnbG9iYWxfYWxwaGEKICAgICAgICAgICAgbG9jYWwgY2VudGVyX3RleHQxID0gaGVscGVyc1snZnVuY3Rpb25zJ10uYW5pbWF0aW9uczphbmltYXRlKCJjZW50ZXJfdGV4dF9hbHBoYSIsIG5vdCAodWkuaXNfbWVudV9vcGVuKCkgYW5kIGlzX2JvdW5kZWQpLCA2KQogICAgICAgIAogICAgICAgICAgICByZW5kZXJlci5yZWN0YW5nbGUoc2VsZi5wb3NpdGlvbi54ICsgNywgc2VsZi5wb3NpdGlvbi55ICsgc2VsZi5zaXplLnkgLSAxMCwgc2VsZi5zaXplLnggLSA3LCAgMywgMCwwLDAsdWkuaXNfbWVudV9vcGVuKCkgYW5kIGJvdW5kZWRfYWxwaGEgIG9yIGFscGhhKQogICAgICAgICAgICByZW5kZXJlci5yZWN0YW5nbGUoc2VsZi5wb3NpdGlvbi54ICsgNywgc2VsZi5wb3NpdGlvbi55ICsgc2VsZi5zaXplLnkgLSAxMCwgLTE1K3NlbGYuc2l6ZS54Km1vZGlmaWVyKjEuMTIgLSAxMSwgIDMsIHIsZyxiLCB1aS5pc19tZW51X29wZW4oKSBhbmQgYm91bmRlZF9hbHBoYSBvciBhbHBoYSkKICAgICAgICAgICAgcmVuZGVyZXIudGV4dChzZWxmLnBvc2l0aW9uLnggKyA4MSwgc2VsZi5wb3NpdGlvbi55ICsgc2VsZi5zaXplLnkgLSAyMSwgMjU1LDI1NSwyNTUsIHVpLmlzX21lbnVfb3BlbigpIGFuZCBib3VuZGVkX2FscGhhIG9yIGFscGhhLCAnYycsIG5pbCwgJ01heCB2ZWxvY2l0eSByZWR1Y2VkIGJ5ICcuLm1hdGguZmxvb3IoKDEtbW9kaWZpZXIpKjExMikuLiclJykKICAgICAgICAgICAgcmVuZGVyZXIudGV4dChzZWxmLnBvc2l0aW9uLnggKyAzNiwgc2VsZi5wb3NpdGlvbi55ICsgMzUsIDI1NSwyNTUsMjU1LCBjZW50ZXJfdGV4dDEqMjU1LCBuaWwsIG5pbCwgJ1ByZXNzIE0yIHRvIGNlbnRlci4nKQogICAgICAgIAogICAgICAgIGVuZCkKCiAgICAgICAgY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygncGFpbnQnLCBmdW5jdGlvbigpCgogICAgICAgICAgICBkYW1hZ2VfcmVuZGVyKCkKICAgICAgICAKICAgICAgICAgICAgYXJyb3dzX3JlbmRlcigpCiAgICAgICAgCiAgICAgICAgICAgIHdhdGVybWFya19yZW5kZXIoKQogICAgICAgIAogICAgICAgICAgICBhc3BlY3RyYXRpb19yZW5kZXIoKQogICAgICAgIAogICAgICAgICAgICB2aWV3bW9kZWxfcmVuZGVyKCkKICAgICAgICAKICAgICAgICAgICAgdGhpcmRwZXJzb25fcmVuZGVyKCkKICAgICAgICAKICAgICAgICAgICAgaGl0bWFya2VyX3JlbmRlcigpCiAgICAgICAgCiAgICAgICAgICAgIGlmIGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkgPT0gbmlsIHRoZW4gaGVscGVyc1snZnVuY3Rpb25zJ10uZGVmZW5zaXZlX3RpY2tzID0gMCBlbmQKCiAgICAgICAgICAgIHZlbG9jaXR5X3JlbmRlcjp1cGRhdGUoKQogICAgICAgIAogICAgICAgIGVuZCkKCmVuZCkoKQoKY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygncGFpbnRfdWknLCBmdW5jdGlvbigpCgogICAgaWYgZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSA9PSBuaWwgdGhlbiBoZWxwZXJzWydmdW5jdGlvbnMnXS5kZWZlbnNpdmVfdGlja3MgPSAwIGVuZAoKICAgIGlmIG5vdCB1aS5pc19tZW51X29wZW4oKSB0aGVuCiAgICAgICAgcmV0dXJuCiAgICBlbmQKCiAgICBoZWxwZXJzWydmdW5jdGlvbnMnXTp1cGRhdGVfc2Vzc2lvbigpCgogICAgaGlkZV9tZW51KGZhbHNlKQoKICAgIGlmIHZhcnMudmlzdWFscy5sb2dzOmdldCgpIHRoZW4KICAgICAgICByZWZlcmVuY2UuY29uc29sZWE6b3ZlcnJpZGUodHJ1ZSkKICAgIGVsc2UKICAgICAgICByZWZlcmVuY2UuY29uc29sZWE6b3ZlcnJpZGUoKQogICAgZW5kCgogICAgbG9jYWwgd2F0ZXJfdWkgPSBoZWxwZXJzWydmdW5jdGlvbnMnXTpmYWRlX2hhbmRsZTIoLWdsb2JhbHMuY3VydGltZSgpLCAiICBhbXBoaWJpYSIsIHJlZmVyZW5jZS5jb2xvcjpnZXQoKSkKICAgIHZhcnMuc2VsZWN0aW9uLmxhYmVsOnNldCgiICAgICAgICAgICAgICAgICAgICAiLi50YWJsZS5jb25jYXQod2F0ZXJfdWkpKQoKCmVuZCkKCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soJ3NodXRkb3duJywgZnVuY3Rpb24oKQoKICAgIHVpLnNldChyZWZlcmVuY2UueWF3WzFdLCAib2ZmIikKICAgIHVpLnNldChyZWZlcmVuY2UucGl0Y2hbMV0sICdvZmYnKQogICAgdWkuc2V0KHJlZmVyZW5jZS55YXdiYXNlLCAibG9jYWwgdmlldyIpCiAgICB1aS5zZXQocmVmZXJlbmNlLnBpdGNoWzJdLCAwKQogICAgdWkuc2V0KHJlZmVyZW5jZS5ib2R5eWF3WzFdLCAnb2ZmJykKICAgIHVpLnNldChyZWZlcmVuY2UuYm9keXlhd1syXSwgMCkKICAgIHVpLnNldChyZWZlcmVuY2UueWF3aml0dGVyWzFdLCAib2ZmIikKICAgIHVpLnNldChyZWZlcmVuY2UueWF3aml0dGVyWzJdLCAwKQogICAgdWkuc2V0KHJlZmVyZW5jZS55YXdbMl0sIDApCgogICAgaGlkZV9tZW51KHRydWUpCiAgICAKZW5kKQoKY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygnbmV0X3VwZGF0ZV9lbmQnLCBmdW5jdGlvbigpCgogICAgaWYgZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSB+PSBuaWwgdGhlbgogICAgICAgIGlzX2RlZmVuc2l2ZV9hY3RpdmUgPSBoZWxwZXJzWydmdW5jdGlvbnMnXTppc19kZWZlbnNpdmUoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkKICAgIGVuZAoKZW5kKQoKY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygnYWltX2ZpcmUnLCBmdW5jdGlvbihlKQoKICAgIGhlbHBlcnNbJ2Z1bmN0aW9ucyddLmhpdG1hcmtlcl9kYXRhW2dsb2JhbHMudGlja2NvdW50KCldID0ge2UueCxlLnksZS56LCBnbG9iYWxzLnJlYWx0aW1lKCkgKyAzfQoKICAgIG9yaWdpbmFsID0gZQoKICAgIGhpc3RvcnkgPSBnbG9iYWxzLnRpY2tjb3VudCgpIC0gZS50aWNrCgplbmQpCgpsb2NhbCBoaXRncm91cF9uYW1lcyA9IHsiZ2VuZXJpYyIsICJoZWFkIiwgImNoZXN0IiwgInN0b21hY2giLCAibGVmdCBhcm0iLCAicmlnaHQgYXJtIiwgImxlZnQgbGVnIiwgInJpZ2h0IGxlZyIsICJuZWNrIiwgIj8iLCAiZ2VhciJ9CmxvY2FsIHdlYXBvbnMgPSB7IGtuaWZlID0gJ0tuaWZlZCcsIGhlZ3JlbmFkZSA9ICdOYWRlZCcsIGluZmVybm8gPSAnQnVybmVkJyB9CgpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCdhaW1faGl0JywgZnVuY3Rpb24oZSkKCmlmIG5vdCBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpIG9yIG5vdCBlbnRpdHkuaXNfYWxpdmUoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkgdGhlbgogICAgcmV0dXJuCmVuZAoKaWYgbm90IHZhcnMudmlzdWFscy5sb2dzOmdldCgpIHRoZW4KCXJldHVybgplbmQKCmxvY2FsIGdyb3VwID0gaGl0Z3JvdXBfbmFtZXNbZS5oaXRncm91cCArIDFdIG9yICI/Igpsb2NhbCB0ZXh0ID0gJycKbG9jYWwgdGV4dDIyID0gJycKbG9jYWwgdGV4dGlrID0gJycKICAgIGxvY2FsIHIsZyxiLGEgPSB2YXJzLnZpc3VhbHMuaGl0X2NvbG9yOmdldCgpCgogICAgbG9jYWwgbWlzbWF0Y2hfdGV4dCA9ICcnCiAgICBsb2NhbCBoZ3JvdXAgPSBoaXRncm91cF9uYW1lc1tlLmhpdGdyb3VwICsgMV0gb3IgJz8nCiAgICBsb2NhbCBhaW1lZF9oZ3JvdXAgPSBoaXRncm91cF9uYW1lc1tvcmlnaW5hbC5oaXRncm91cCArIDFdIG9yICc/JwogICAgbG9jYWwgaGdfZGlmZiA9IGhncm91cCB+PSBhaW1lZF9oZ3JvdXAKICAgIGxvY2FsIGRtZ19kaWZmID0gZS5kYW1hZ2Ugfj0gb3JpZ2luYWwuZGFtYWdlCgogICAgaWYgZW50aXR5LmdldF9wcm9wKGUudGFyZ2V0LCAibV9pSGVhbHRoIikgPT0gMCB0aGVuCiAgICAgICAgdGV4dCA9ICdkZWFkLCBcMCcKICAgICAgICB0ZXh0MjIgPSAnIEtpbGxlZCBcMCcKICAgICBlbHNlCiAgICAgICAgdGV4dCA9IGVudGl0eS5nZXRfcHJvcChlLnRhcmdldCwgIm1faUhlYWx0aCIpCiAgICAgICAgdGV4dGlrID0gJyBocCwgXDAnCiAgICAgICAgdGV4dDIyID0gJyBIaXQgXDAnCiAgICAgZW5kCgppZiBub3QgdmFycy52aXN1YWxzLmZ1bGxfY29sb3I6Z2V0KCkgdGhlbgogICAgIGNsaWVudC5jb2xvcl9sb2coMjAwLDIwMCwyMDAsICJbXDAiKQogICAgIGNsaWVudC5jb2xvcl9sb2cociwgZywgYiwgIitcMCIpCiAgICAgY2xpZW50LmNvbG9yX2xvZygyMDAsMjAwLDIwMCwgIl1cMCIpCiAgICAgY2xpZW50LmNvbG9yX2xvZygyMDAsMjAwLDIwMCwgdGV4dDIyKQogICAgIGNsaWVudC5jb2xvcl9sb2cocixnLGIsIGVudGl0eS5nZXRfcGxheWVyX25hbWUoZS50YXJnZXQpLi4iXDAiKQogICAgIGNsaWVudC5jb2xvcl9sb2coMjAwLDIwMCwyMDAsIidzIFwwIikKICAgICBjbGllbnQuY29sb3JfbG9nKHIsZyxiLCBncm91cC4uIlwwIikKICAgICBjbGllbnQuY29sb3JfbG9nKDIwMCwyMDAsMjAwLCAiIGZvciBcMCIpCiAgICAgY2xpZW50LmNvbG9yX2xvZyhyLGcsYiwgZS5kYW1hZ2UuLiJcMCIpCiAgICAgY2xpZW50LmNvbG9yX2xvZygyMDAsMjAwLDIwMCwgIiBbcmVtYWluaW5nOiBcMCIpCiAgICAgY2xpZW50LmNvbG9yX2xvZyhyLGcsYiwgdGV4dC4uIlwwIikKICAgICBjbGllbnQuY29sb3JfbG9nKDIwMCwyMDAsMjAwLCB0ZXh0aWsuLiJcMCIpCiAgICAgY2xpZW50LmNvbG9yX2xvZygyMDAsMjAwLDIwMCwgIkhDOiBcMCIpCiAgICAgY2xpZW50LmNvbG9yX2xvZyhyLGcsYiwgbWF0aC5mbG9vcihlLmhpdF9jaGFuY2UpLi4iJVwwIikKICAgICBjbGllbnQuY29sb3JfbG9nKDIwMCwyMDAsMjAwLCAiLCBoaXN0b3J5OiBcMCIpCiAgICAgY2xpZW50LmNvbG9yX2xvZyhyLGcsYiwgaGlzdG9yeS4uJ1wwJykKICAgICBpZiBkbWdfZGlmZiB0aGVuIAogICAgICAgIGNsaWVudC5jb2xvcl9sb2coMjAwLDIwMCwyMDAsICcgLCBtaXNtYXRjaDoge2RtZzogXDAnKQogICAgICAgIGNsaWVudC5jb2xvcl9sb2cocixnLGIsIG9yaWdpbmFsLmRhbWFnZS4uJ1wwJykKICAgICAgICBjbGllbnQuY29sb3JfbG9nKDIwMCwyMDAsMjAwLCBzdHJpbmcuZm9ybWF0KCclcycsIChoZ19kaWZmIGFuZCAnICwgJyBvciAnfScpKSAuLiAnXDAnKQogICAgZW5kCiAgICBpZiBoZ19kaWZmIHRoZW4gCiAgICAgICAgY2xpZW50LmNvbG9yX2xvZygyMDAsMjAwLDIwMCwgKGhnX2RpZmYgYW5kICdoaXRncm91cDogXDAnKSkKICAgICAgICBjbGllbnQuY29sb3JfbG9nKHIsZyxiLCBhaW1lZF9oZ3JvdXAuLidcMCcpCiAgICAgICAgY2xpZW50LmNvbG9yX2xvZygyMDAsMjAwLDIwMCwgJ31cMCcpCiAgICBlbmQKICAgICBjbGllbnQuY29sb3JfbG9nKDIwMCwyMDAsMjAwLCAiXSIpCmVsc2UKCiAgICAgY2xpZW50LmNvbG9yX2xvZyhyLGcsYiwgIltcMCIpCiAgICAgY2xpZW50LmNvbG9yX2xvZyhyLCBnLCBiLCAiK1wwIikKICAgICBjbGllbnQuY29sb3JfbG9nKHIsZyxiLCAiXVwwIikKICAgICBjbGllbnQuY29sb3JfbG9nKHIsZyxiLCB0ZXh0MjIpCiAgICAgY2xpZW50LmNvbG9yX2xvZyhyLGcsYiwgZW50aXR5LmdldF9wbGF5ZXJfbmFtZShlLnRhcmdldCkuLiJcMCIpCiAgICAgY2xpZW50LmNvbG9yX2xvZyhyLGcsYiwiJ3MgXDAiKQogICAgIGNsaWVudC5jb2xvcl9sb2cocixnLGIsIGdyb3VwLi4iXDAiKQogICAgIGNsaWVudC5jb2xvcl9sb2cocixnLGIsICIgZm9yIFwwIikKICAgICBjbGllbnQuY29sb3JfbG9nKHIsZyxiLCBlLmRhbWFnZS4uIlwwIikKICAgICBjbGllbnQuY29sb3JfbG9nKHIsZyxiLCAiIFtyZW1haW5pbmc6IFwwIikKICAgICBjbGllbnQuY29sb3JfbG9nKHIsZyxiLCB0ZXh0Li4iXDAiKQogICAgIGNsaWVudC5jb2xvcl9sb2cocixnLGIsIHRleHRpay4uIlwwIikKICAgICBjbGllbnQuY29sb3JfbG9nKHIsZyxiLCAiSEM6IFwwIikKICAgICBjbGllbnQuY29sb3JfbG9nKHIsZyxiLCBtYXRoLmZsb29yKGUuaGl0X2NoYW5jZSkuLiIlXDAiKQogICAgIGNsaWVudC5jb2xvcl9sb2cocixnLGIsICIsIGhpc3Rvcnk6IFwwIikKICAgICBjbGllbnQuY29sb3JfbG9nKHIsZyxiLCBoaXN0b3J5Li4nXDAnKQogICAgIGlmIGRtZ19kaWZmIHRoZW4gCiAgICAgICAgY2xpZW50LmNvbG9yX2xvZyhyLGcsYiwgJyAsIG1pc21hdGNoOiB7ZG1nOiBcMCcpCiAgICAgICAgY2xpZW50LmNvbG9yX2xvZyhyLGcsYiwgb3JpZ2luYWwuZGFtYWdlLi4nXDAnKQogICAgICAgIGNsaWVudC5jb2xvcl9sb2cocixnLGIsIHN0cmluZy5mb3JtYXQoJyVzJywgKGhnX2RpZmYgYW5kICcgLCAnIG9yICd9JykpIC4uICdcMCcpCiAgICBlbmQKICAgIGlmIGhnX2RpZmYgdGhlbiAKICAgICAgICBjbGllbnQuY29sb3JfbG9nKHIsZyxiLCAoaGdfZGlmZiBhbmQgJ2hpdGdyb3VwOiBcMCcpKQogICAgICAgIGNsaWVudC5jb2xvcl9sb2cocixnLGIsIGFpbWVkX2hncm91cC4uJ1wwJykKICAgICAgICBjbGllbnQuY29sb3JfbG9nKHIsZyxiLCAnfVwwJykKICAgIGVuZAogICAgIGNsaWVudC5jb2xvcl9sb2cocixnLGIsICJdIikKCmVuZAoKZW5kKQoKY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygncGxheWVyX2h1cnQnLCBmdW5jdGlvbihlKQoKICAgIGlmIG5vdCBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpIG9yIG5vdCBlbnRpdHkuaXNfYWxpdmUoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkgdGhlbgogICAgICAgIHJldHVybgogICAgZW5kCgogICAgaWYgbm90IHZhcnMudmlzdWFscy5sb2dzOmdldCgpIHRoZW4KICAgICAgICByZXR1cm4KICAgIGVuZAoKCWxvY2FsIGF0dGFja2VyX2lkID0gY2xpZW50LnVzZXJpZF90b19lbnRpbmRleChlLmF0dGFja2VyKQoKCWlmIGF0dGFja2VyX2lkID09IG5pbCBvciBhdHRhY2tlcl9pZCB+PSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpIHRoZW4KICAgICAgICByZXR1cm4KICAgIGVuZAoKICAgIGxvY2FsIHIsZyxiLGEgPSB2YXJzLnZpc3VhbHMuaGl0X2NvbG9yOmdldCgpCgogICAgbG9jYWwgZ2FkID0gJycKCiAgICBpZiBlLmhlYWx0aCA9PSAwIHRoZW4KICAgICAgICBnYWQgPSAnZGVhZCcKICAgICBlbHNlCiAgICAgICAgZ2FkID0gZS5oZWFsdGgKICAgICBlbmQKCiAgICAgbG9jYWwgdGFyZ2V0X2lkID0gY2xpZW50LnVzZXJpZF90b19lbnRpbmRleChlLnVzZXJpZCkKICAgICBsb2NhbCB0YXJnZXRfbmFtZSA9IGVudGl0eS5nZXRfcGxheWVyX25hbWUodGFyZ2V0X2lkKQoKCWlmIHdlYXBvbnNbZS53ZWFwb25dIH49IG5pbCB0aGVuCiAgICAgICAgaWYgbm90IHZhcnMudmlzdWFscy5mdWxsX2NvbG9yOmdldCgpIHRoZW4KCiAgICAgICAgY2xpZW50LmNvbG9yX2xvZygyMDAsMjAwLDIwMCwgIltcMCIpCiAgICAgICAgY2xpZW50LmNvbG9yX2xvZyhyLCBnLCBiLCAiK1wwIikKICAgICAgICBjbGllbnQuY29sb3JfbG9nKDIwMCwyMDAsMjAwLCAiXVwwIikKCQljbGllbnQuY29sb3JfbG9nKDIwMCwgMjAwLCAyMDAsIHN0cmluZy5mb3JtYXQoIiAlc1wwIiwgd2VhcG9uc1tlLndlYXBvbl0pKQoJCWNsaWVudC5jb2xvcl9sb2cocixnLGIsIHN0cmluZy5mb3JtYXQoIiAlc1wwIiwgdGFyZ2V0X25hbWUpKQoJCWNsaWVudC5jb2xvcl9sb2coMjAwLCAyMDAsIDIwMCwgIiBmb3JcMCIpCgkJY2xpZW50LmNvbG9yX2xvZyhyLGcsYiwgc3RyaW5nLmZvcm1hdCgiICVzXDAiLCBlLmRtZ19oZWFsdGgpKQogICAgICAgIGNsaWVudC5jb2xvcl9sb2coMjAwLDIwMCwyMDAsICIgW3JlbWFpbmluZzogXDAiKQoJCWNsaWVudC5jb2xvcl9sb2cocixnLGIsIGdhZC4uICdcMCcpCiAgICAgICAgY2xpZW50LmNvbG9yX2xvZygyMDAsMjAwLDIwMCwgIl0iKQogICAgICAgIGVsc2UKICAgIAogICAgICAgICAgICBjbGllbnQuY29sb3JfbG9nKHIsZyxiLCAiW1wwIikKICAgICAgICAgICAgY2xpZW50LmNvbG9yX2xvZyhyLCBnLCBiLCAiK1wwIikKICAgICAgICAgICAgY2xpZW50LmNvbG9yX2xvZyhyLGcsYiwgIl1cMCIpCiAgICAgICAgICAgIGNsaWVudC5jb2xvcl9sb2cocixnLGIsIHN0cmluZy5mb3JtYXQoIiAlc1wwIiwgd2VhcG9uc1tlLndlYXBvbl0pKQogICAgICAgICAgICBjbGllbnQuY29sb3JfbG9nKHIsZyxiLCBzdHJpbmcuZm9ybWF0KCIgJXNcMCIsIHRhcmdldF9uYW1lKSkKICAgICAgICAgICAgY2xpZW50LmNvbG9yX2xvZyhyLGcsYiwgIiBmb3JcMCIpCiAgICAgICAgICAgIGNsaWVudC5jb2xvcl9sb2cocixnLGIsIHN0cmluZy5mb3JtYXQoIiAlc1wwIiwgZS5kbWdfaGVhbHRoKSkKICAgICAgICAgICAgY2xpZW50LmNvbG9yX2xvZyhyLGcsYiwgIiBbcmVtYWluaW5nOiBcMCIpCiAgICAgICAgICAgIGNsaWVudC5jb2xvcl9sb2cocixnLGIsIGdhZC4uICdcMCcpCiAgICAgICAgICAgIGNsaWVudC5jb2xvcl9sb2cocixnLGIsICJdIikKICAgICAgICBlbmQKCgllbmQKCmVuZCkKCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soJ2FpbV9taXNzJywgZnVuY3Rpb24oZSkKCiAgICBpZiBub3QgZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSBvciBub3QgZW50aXR5LmlzX2FsaXZlKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkpIHRoZW4KICAgICAgICByZXR1cm4KICAgIGVuZAoKICAgIGxvY2FsIGdyb3VwID0gaGl0Z3JvdXBfbmFtZXNbZS5oaXRncm91cCArIDFdIG9yICI/IgoKICAgIGxvY2FsIHIsZyxiLGEgPSB2YXJzLnZpc3VhbHMubWlzc19jb2xvcjpnZXQoKQogICAgaWYgdmFycy52aXN1YWxzLmxvZ3M6Z2V0KCkgdGhlbgogICAgaWYgbm90IHZhcnMudmlzdWFscy5mdWxsX2NvbG9yOmdldCgpIHRoZW4KICAgIGNsaWVudC5jb2xvcl9sb2coMjAwLDIwMCwyMDAsICJbXDAiKQogICAgY2xpZW50LmNvbG9yX2xvZyhyLCBnLCBiLCAiLVwwIikKICAgIGNsaWVudC5jb2xvcl9sb2coMjAwLDIwMCwyMDAsICJdXDAiKQogICAgY2xpZW50LmNvbG9yX2xvZygyMDAsMjAwLDIwMCwgIiBNaXNzZWQgXDAiKQogICAgY2xpZW50LmNvbG9yX2xvZyhyLGcsYiwgZW50aXR5LmdldF9wbGF5ZXJfbmFtZShlLnRhcmdldCkuLiJcMCIpCiAgICBjbGllbnQuY29sb3JfbG9nKDIwMCwyMDAsMjAwLCIncyBcMCIpCiAgICBjbGllbnQuY29sb3JfbG9nKHIsZyxiLCBncm91cC4uIlwwIikKICAgIGNsaWVudC5jb2xvcl9sb2coMjAwLDIwMCwyMDAsICIgZHVlIHRvIFwwIikKICAgIGNsaWVudC5jb2xvcl9sb2cocixnLGIsIGUucmVhc29uLi4gIlwwIikKICAgIGNsaWVudC5jb2xvcl9sb2coMjAwLDIwMCwyMDAsICIgW2RtZzogXDAiKQogICAgY2xpZW50LmNvbG9yX2xvZyhyLGcsYiwgb3JpZ2luYWwuZGFtYWdlLi4iXDAiKQogICAgY2xpZW50LmNvbG9yX2xvZygyMDAsMjAwLDIwMCwgIiBocCwgXDAiKQogICAgY2xpZW50LmNvbG9yX2xvZygyMDAsMjAwLDIwMCwgIkhDOiBcMCIpCiAgICBjbGllbnQuY29sb3JfbG9nKHIsZyxiLCBtYXRoLmZsb29yKGUuaGl0X2NoYW5jZSkuLiIlXDAiKQogICAgY2xpZW50LmNvbG9yX2xvZygyMDAsMjAwLDIwMCwgIiwgaGlzdG9yeTogXDAiKQogICAgY2xpZW50LmNvbG9yX2xvZyhyLGcsYiwgaGlzdG9yeS4uJ1wwJykKICAgIGNsaWVudC5jb2xvcl9sb2coMjAwLDIwMCwyMDAsICJdIikKICAgIGVsc2UKICAgICAgICBjbGllbnQuY29sb3JfbG9nKHIsZyxiLCAiW1wwIikKICAgICAgICBjbGllbnQuY29sb3JfbG9nKHIsIGcsIGIsICItXDAiKQogICAgICAgIGNsaWVudC5jb2xvcl9sb2cocixnLGIsICJdXDAiKQogICAgICAgIGNsaWVudC5jb2xvcl9sb2cocixnLGIsICIgTWlzc2VkIFwwIikKICAgICAgICBjbGllbnQuY29sb3JfbG9nKHIsZyxiLCBlbnRpdHkuZ2V0X3BsYXllcl9uYW1lKGUudGFyZ2V0KS4uIlwwIikKICAgICAgICBjbGllbnQuY29sb3JfbG9nKHIsZyxiLCIncyBcMCIpCiAgICAgICAgY2xpZW50LmNvbG9yX2xvZyhyLGcsYiwgZ3JvdXAuLiJcMCIpCiAgICAgICAgY2xpZW50LmNvbG9yX2xvZyhyLGcsYiwgIiBkdWUgdG8gXDAiKQogICAgICAgIGNsaWVudC5jb2xvcl9sb2cocixnLGIsIGUucmVhc29uLi4gIlwwIikKICAgICAgICBjbGllbnQuY29sb3JfbG9nKHIsZyxiLCAiIFtkbWc6IFwwIikKICAgICAgICBjbGllbnQuY29sb3JfbG9nKHIsZyxiLCBvcmlnaW5hbC5kYW1hZ2UuLiJcMCIpCiAgICAgICAgY2xpZW50LmNvbG9yX2xvZyhyLGcsYiwgIiBocCwgXDAiKQogICAgICAgIGNsaWVudC5jb2xvcl9sb2cocixnLGIsICJIQzogXDAiKQogICAgICAgIGNsaWVudC5jb2xvcl9sb2cocixnLGIsIG1hdGguZmxvb3IoZS5oaXRfY2hhbmNlKS4uIiVcMCIpCiAgICAgICAgY2xpZW50LmNvbG9yX2xvZyhyLGcsYiwgIiwgaGlzdG9yeTogXDAiKQogICAgICAgIGNsaWVudC5jb2xvcl9sb2cocixnLGIsIGhpc3RvcnkuLidcMCcpCiAgICAgICAgY2xpZW50LmNvbG9yX2xvZyhyLGcsYiwgIl0iKQogICAgZW5kCmVuZAoKZW5kKQoKY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygicm91bmRfcHJlc3RhcnQiLCBmdW5jdGlvbigpCgogICAgaGVscGVyc1snZnVuY3Rpb25zJ10uaGl0bWFya2VyX2RhdGEgPSB7fQogICAgCmVuZCkKCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soJ3ByZV9yZW5kZXInLCBmdW5jdGlvbihjKQoKICAgIGlmIG5vdCBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpIG9yIG5vdCBlbnRpdHkuaXNfYWxpdmUoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkgdGhlbgogICAgICAgIHJldHVybgogICAgZW5kCiAgICAKICAgIGlmIG5vdCB2YXJzLmFhLmVuY2hhOmdldCgnQW5pbWF0aW9ucyBCcmVha2VyJykgdGhlbiByZWZlcmVuY2UubG06b3ZlcnJpZGUoIk5ldmVyIHNsaWRlIik7IHJldHVybiBlbmQKICAgIGxvY2FsIG9uX2dyb3VuZCA9IGJpdC5iYW5kKGVudGl0eS5nZXRfcHJvcChlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCAibV9mRmxhZ3MiKSwgMSkgPT0gMSAKCiAgICBpZiB2YXJzLmFhLmdyb3VuZC52YWx1ZSA9PSAnU3RhdGljJyB0aGVuCiAgICAgICAgZW50aXR5LnNldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICdtX2ZsUG9zZVBhcmFtZXRlcicsIDEsIDApCiAgICAgICAgcmVmZXJlbmNlLmxtOm92ZXJyaWRlKCdBbHdheXMgc2xpZGUnKQogICAgZWxzZWlmIHZhcnMuYWEuZ3JvdW5kLnZhbHVlID09ICdXYWxraW5nJyB0aGVuCiAgICAgICAgZW50aXR5LnNldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICdtX2ZsUG9zZVBhcmFtZXRlcicsIC41LCA3KQogICAgICAgIHJlZmVyZW5jZS5sbTpvdmVycmlkZSgnTmV2ZXIgc2xpZGUnKQogICAgZWxzZWlmIHZhcnMuYWEuZ3JvdW5kLnZhbHVlID09ICdKaXR0ZXInIHRoZW4KICAgICAgICBpZiBnbG9iYWxzLnRpY2tjb3VudCgpICUgMyA+IDEgIHRoZW4KICAgICAgICAgICAgZW50aXR5LnNldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX2ZsUG9zZVBhcmFtZXRlciIsIDEsIDApOwogICAgICAgICAgICByZWZlcmVuY2UubG06b3ZlcnJpZGUoJ0Fsd2F5cyBzbGlkZScpCiAgICAgICAgZWxzZQogICAgICAgICAgICByZWZlcmVuY2UubG06b3ZlcnJpZGUoIk5ldmVyIHNsaWRlIik7CiAgICAgICAgZW5kCiAgICAgICAgZW50aXR5LnNldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX2ZsUG9zZVBhcmFtZXRlciIsIDEsIGdsb2JhbHMudGlja2NvdW50KCkgJSA0ID4gMSBhbmQgNSBvciAxKQogICAgZW5kCgogICAgaWYgdmFycy5hYS5haXIudmFsdWUgPT0gJ1N0YXRpYycgYW5kIG5vdCBvbl9ncm91bmQgdGhlbgogICAgICAgIGVudGl0eS5zZXRfcHJvcChlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCAnbV9mbFBvc2VQYXJhbWV0ZXInLCAxLCA2KQogICAgZWxzZWlmIHZhcnMuYWEuYWlyLnZhbHVlID09ICdXYWxraW5nJyBhbmQgbm90IG9uX2dyb3VuZCB0aGVuCiAgICAgICAgbG9jYWwgZW50ID0gY19lbnRpdHkoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkKICAgICAgICBsb2NhbCBhbmltbGF5ZXIgPSBlbnQ6Z2V0X2FuaW1fb3ZlcmxheSg2KQogICAgICAgIGFuaW1sYXllci53ZWlnaHQgPSAxCiAgICBlbmQKCmVuZCkKCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soJ3Bvc3RfY29uZmlnX2xvYWQnLCBmdW5jdGlvbigpCiAgICBmb3IgXywgcG9pbnQgaW4gcGFpcnMoc3lzdGVtLndpbmRvd3MpIGRvCiAgICAgICAgcG9pbnQucG9zaXRpb24gPSB2ZWN0b3IocG9pbnQudWlfY2FsbGJhY2tzLng6Z2V0KCksIHBvaW50LnVpX2NhbGxiYWNrcy55OmdldCgpKQogICAgZW5kCmVuZCkKCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soJ3NldHVwX2NvbW1hbmQnLCBmdW5jdGlvbihjKQogICAgCiAgICBpZiBub3QgZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSBvciBub3QgZW50aXR5LmlzX2FsaXZlKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkpIHRoZW4KICAgICAgICByZXR1cm4KICAgIGVuZAoKICAgIGlmIHVpLmlzX21lbnVfb3BlbigpIHRoZW4KICAgICAgICBjLmluX2F0dGFjayA9IGZhbHNlCiAgICBlbmQKCiAgICBoYW5kbGVfYW50aWFpbXMoYykKICAgIGhhbmRsZV9kcm9wX25hZGVzKGMpCiAgICBoYW5kbGVfZmFzdGxhZGRlcihjKQogICAgaGFuZGxlX2FudGlfYmFja3N0YWIoYykKICAgIAplbmQpCiAgICAKICAgICA="}