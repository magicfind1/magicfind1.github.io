{"status":200,"content":"bG9jYWwgdWlfbWVudV9zaXplLHJlbmRlcmVyX3JlY3RhbmdsZSx1aV9tZW51X3Bvc2l0aW9uLHVpX21vdXNlX3Bvc2l0aW9uID0gdWkubWVudV9zaXplLHJlbmRlcmVyLnJlY3RhbmdsZSx1aS5tZW51X3Bvc2l0aW9uLHVpLm1vdXNlX3Bvc2l0aW9uCmxvY2FsIGFudGlfYWltX2Z1bmNzID0gcmVxdWlyZSAoImdhbWVzZW5zZS9hbnRpYWltX2Z1bmNzIikgb3IgZXJyb3IoIkZhaWxlZCB0byByZXRyaWV2ZSBhbnRpYWltX2Z1bmNzIHwgaHR0cHM6Ly9nYW1lc2Vuc2UucHViL2ZvcnVtcy92aWV3dG9waWMucGhwP2lkPTI5NjY1IikKbG9jYWwgY2xpcGJvYXJkID0gcmVxdWlyZSgiZ2FtZXNlbnNlL2NsaXBib2FyZCIpIG9yIGVycm9yKCJGYWlsZWQgdG8gbG9hZCBjbGlwYm9hcmQgfCBodHRwczovL2dhbWVzZW5zZS5wdWIvZm9ydW1zL3ZpZXd0b3BpYy5waHA/aWQ9Mjg2NzgiKQpsb2NhbCBiYXNlNjQgPSByZXF1aXJlKCJnYW1lc2Vuc2UvYmFzZTY0Iikgb3IgZXJyb3IoIkZhaWxlZCB0byBsb2FkIGJhc2U2NCB8IGh0dHBzOi8vZ2FtZXNlbnNlLnB1Yi9mb3J1bXMvdmlld3RvcGljLnBocD9pZD0yMTYxOSIpCmxvY2FsIGNzZ29fd2VhcG9ucyA9IHJlcXVpcmUoImdhbWVzZW5zZS9jc2dvX3dlYXBvbnMiKSBvciBlcnJvcigiRmFpbGVkIHRvIGxvYWQgY3Nnb193ZWFwb25zIikKbG9jYWwgZW50ID0gcmVxdWlyZSAiZ2FtZXNlbnNlL2VudGl0eSIgb3IgZXJyb3IoIkZhaWxlZCB0byBsb2FkIGVudGl0eSB8IGh0dHBzOi8vZ2FtZXNlbnNlLnB1Yi9mb3J1bXMvdmlld3RvcGljLnBocD9pZD0yNzUyOSIpCmxvY2FsIHRyYWNlID0gcmVxdWlyZSAiZ2FtZXNlbnNlL3RyYWNlIiBvciBlcnJvcigiRmFpbGVkIHRvIGxvYWQgdHJhY2UiKQotLSBsb2NhbCBodHRwID0gcmVxdWlyZSAiZ2FtZXNlbnNlL2h0dHAiIG9yIGVycm9yKCJGYWlsZWQgdG8gbG9hZCBodHRwIHwgaHR0cHM6Ly9nYW1lc2Vuc2UucHViL2ZvcnVtcy92aWV3dG9waWMucGhwP2lkPTE5MjUzIikKbG9jYWwgaW1hZ2VzID0gcmVxdWlyZSgiZ2FtZXNlbnNlL2ltYWdlcyIpIG9yIGVycm9yKCJGYWlsZWQgdG8gbG9hZCBpbWFnZXMgfCBodHRwczovL2dhbWVzZW5zZS5wdWIvZm9ydW1zL3ZpZXd0b3BpYy5waHA/aWQ9MjI5MTciKQpsb2NhbCB2ZWN0b3IgPSByZXF1aXJlICJ2ZWN0b3IiCmxvY2FsIG9iZXhfZGF0YSA9IG9iZXhfZmV0Y2ggYW5kIG9iZXhfZmV0Y2goKSBvciB7dXNlcm5hbWUgPSAnTW9uc3RyeScsIGJ1aWxkID0gJ2RldicsIGRpc2NvcmQ9Jyd9CmxvY2FsIHRhYixwbGFjZSA9ICAiQUEiLCJBbnRpLWFpbWJvdCBhbmdsZXMiCmxvY2FsIGZmaSA9IHJlcXVpcmUgJ2ZmaScKCmxvY2FsIHdoYXRfbm90aV9pbWFnZSA9IGltYWdlcy5sb2FkKGJhc2U2NC5kZWNvZGUoImlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFCNEFBQUFjQ0FZQUFBQjIrQStwQUFBQUlHTklVazBBQUhvbUFBQ0FoQUFBK2dBQUFJRG9BQUIxTUFBQTZtQUFBRHFZQUFBWGNKeTZVVHdBQUFBR1lrdEhSQUQvQVA4QS82QzlwNU1BQUFZRFNVUkJWRWpIeFpaN1RGdjNGY2Mvdmx6akYrWWRiQWlZWnhVZUFiWVVtbFp6U2hMWWtsUmlhWlpWblVZMjdhV3F5aDlwazJwYTJyL1NxdnVuMnRMOXNWVmQxelVWVkpHaXFRcFYxRGJaL2xpeVpzM3NFa2hEUXN1cklSUXdqNEF2eGpiWTJENzd3dzNNZzBDeVROdFhPdExWdWVmOFB2ZWMzK3ZxZ0FCZzVuK3JvQTZRbFg0Rm5TNEprU2dRVy9ZcUNqcWRqbWcwZXQ5a05RR25xTmdjVG9xcjltSXdaZUwzalRQdHVjYThkcFh0emtvZWZYUWJxcW95TWpMS2xTdFhjTHZkZUR5ZS93aWNVSEZlU1NQZmFqbEJMQmJsK2o5YTBhYjZ5YzYyODRzakxUaTNGdlArMlk5NS83MVcvSDR2V1ZuWlpHUmtNREF3d01XTEYvSDcvZmNNRjBCME9sVzJQZjZhSEh4bFhrbzJQeW0zL2M4OGMwZzB6U3RQSDN4V05wYnVGbHZoYnRFYmN3UVFrOGtrOWZYMTB0emNMRGFiYlNubkxpMytvQ1FaWmZjUFQ4dUJvMzFpU1hVSUlGbFpXZUp5dWFTOXZWMHNGbk1jbHBJdk9RVTd4WnBaSWFDTHgyVm1Ta05EZzloemMrOGF2RFRIRW9zUW10Y1FFVVRpM1M4c0xLU29xSWdUSjA0UUNBUUJDQVVuVWZVbWJJNGQ1SlkwRXZLUG9xSVJqUWtIV2xvWUhSM0Y1L014UGo1T1gxOGZjM056YXk4dWtRaTNQTmNvcnRxRDBiS0I0TnlYMkd3MkZFV2h2NytQSkgwcStXVTdLZG04bDV5Q09qYlk4dGhVYktXeVVDaklDWk5tQ1pGcXRhQ3FLdEZvbEVBZ3dQbno1emx5NUFnM2I5NWNlMVY3Ym55TWlKQ1RYOC9NZU9mU0lLYTBTblk4OFRSbE5ZOWhzVm9vZDRDekdrbzNnbDRGU0FaU2xnZFZWUXdHQS92MjdlUFVxVlByZzcyVDNYaHV1Q2l0ZVp6ZXJuZnd6YzZpS01sc2F6N0d5R3dXWmdNMFBRamJhc0dRREpxbU1lVFJNYnVReG1JRWl2UGlIM05iRXhNVERBNE9ydDFxZ09paW4rdXV0OWo1eEd0c0xHMWl6Tk5ETU9nbmYyTUJZejdZdVFVYTYwQ25pOGUvL1hZYmYrM09wYUJxUDlGb2hGMFA2U2kwUVNRU1FVUm9iVzJsdTd0Ny9YME1rS1JhYU5qL0JtYXJqYzQvUDgvcGQ5dFkwRytpNHpONGFpK2ttSlpqeDhZOFhPdWY1L012WnJuOGlZdWc5eG9ta3hsdCtnYXg2RHhUVTFPNDNlNVZ3VW5Bc1lSTkhWdEVteDZpNnFFZkVTT0YvRHdiZGJWNWhFSlFVNWFZYkxWYUtTM0tvTDUyQTlzZktTRWpWYytmM2ozRDVVK0h1WDcxRWxsWkdZVERpeXdzTEt3UEJsandlMWdNTFZLNTljY01EM3pDcnUxRmpNMFlVUlRJVEl1M0thRnRPZ1dUMmN5bThuSzBtVEV1L3IyTFpGTTJrZEFNZHJ1ZHljbkpGV0JsMVRhb0prYjYvNEp2b2dPcnJZNmhvVEV5amFPODhOSkpYdjZOaXc4dVRETTRLc3lIRXZORWhKR1JFWHplUG96bURRUkRSdExUMHpHWlRLdGhFaytVSk5Vb2RVMHZ5L092WEphT3JpRVptWWlLengrU1dVMlRQWHVhUlZFekpNZXhRMXFlNjVUM1BoS0p4bVJKbHk1ZEVvY2pmdW9aelhiSkxYNU12dUhjSVE1SHdaMVBydHRLTm1aUytlQzMrY0dUMVZRNGxyeEFNb2NPSGFUbnMxNHk3VFpxeXpPb0xnSGxxNzczOVBSdzlPaFJob2VINDlNVkhDZXlHQ1RKV0V4dWJvRGg0Uy9YcnRoa0xaUVhqdmZKZkVnU0ZJdUpoTU5oK2ZScXZ3eVArbVV4R3ZlSHcyRTVjK2FNMU5YVmlVNm5TeGdyMlpndGpjMHZ5djd2Zm4vOWloZUN0NWk0NlVaUkh2aTNCUVI2dlo2YTZ2alNucHZ6MGRuWlJWdGJHKzN0N1V4UFQ2K29LTHh3aTJCZ21wcnlhaFJGUnl5MnZITlhnQ1VhNFBUSlkrUm5hM3huYnlOMmV3NTZ2WjVJSklyWHE2RkR5TSszOCtKTHYrU3RQLzRCcjlmTFd2TFBkSkZpTGtCUmtvakZJbmR1OVcxVEZMM1ljd3VrcHJaZXRqN2NJRi9mOG9nNENoK1F6WnRyNVc4WExvaTdvMXNlZHU0VFNGN3orbXRxYXBKWGY5Y3Vla1A2NnZmeHZWaDFkYlc0WEM0WkdQSkp5OCtPaXlXdGJQVTdWMVhsMThkZmxkKzJEWW81dGVUK3dZQlVWRlRJMmJNZmlqWW44dWJKYm5GKzg3Q2twSmNKNkFVUWc4RWdCdzYwU044WDAvTHpYdzE5OVc0NS93NS9tWGNubTgzRzRjUFA4cE9mUGtWTXljVGRNY0Rsam8rWW0rbGx5OWVxMkxXbkdYZC9PcSsvZVk1ejczeVBjRWhiZjQ3djFsUlZGYWZUS1cvOC9uWHA2KzBWVFpzVm4yOU9Sc2REY3VyY3ZMUTgxeUY1SlUwcjh1NnI0bitWcXFyWTdYYnk4dkpRVlFPK0JTdWFMNFkyOVRrQjN6QWlzWVQ0L3hyNFhxVUF3ZjhETi9oUGtIRkNRdWp5dTlnQUFBQU9aVmhKWmsxTkFDb0FBQUFJQUFBQUFBQUFBTkpUa3dBQUFBQkpSVTVFcmtKZ2dnPT0iKSkKCmZ1bmN0aW9uIHJvdW5kZWRfcmVjdGFuZ2xlKHgsIHksIHcsIGgsIHIsIGcsIGIsIGEsIHJhZGl1cywgdGhpY2tuZXNzKQogICAgeSA9IHkgKyByYWRpdXMKICAgIGxvY2FsIGRhdGFfY2lyY2xlID0gewogICAgICAgIHt4ICsgcmFkaXVzLCB5LCAxODB9LAogICAgICAgIHt4ICsgdyAtIHJhZGl1cywgeSwgMjcwfSwKICAgICAgICB7eCArIHJhZGl1cywgeSArIGggLSByYWRpdXMgKiAyLCA5MH0sCiAgICAgICAge3ggKyB3IC0gcmFkaXVzLCB5ICsgaCAtIHJhZGl1cyAqIDIsIDB9LAogICAgfQoKICAgIGxvY2FsIGRhdGEgPSB7CiAgICAgICAge3ggKyByYWRpdXMsIHkgLSByYWRpdXMsIHcgLSByYWRpdXMgKiAyLCB0aGlja25lc3N9LAogICAgICAgIHt4ICsgcmFkaXVzLCB5ICsgaCAtIHJhZGl1cyAtIHRoaWNrbmVzcywgdyAtIHJhZGl1cyAqIDIsIHRoaWNrbmVzc30sCiAgICAgICAge3gsIHksIHRoaWNrbmVzcywgaCAtIHJhZGl1cyAqIDJ9LAogICAgICAgIHt4ICsgdyAtIHRoaWNrbmVzcywgeSwgdGhpY2tuZXNzLCBoIC0gcmFkaXVzICogMn0sCiAgICB9CgogICAgZm9yIF8sIGRhdGEgaW4gbmV4dCwgZGF0YV9jaXJjbGUgZG8KICAgICAgICByZW5kZXJlci5jaXJjbGVfb3V0bGluZShkYXRhWzFdLCBkYXRhWzJdLCByLCBnLCBiLCBhLCByYWRpdXMsIGRhdGFbM10sIDAuMjUsIHRoaWNrbmVzcykKICAgIGVuZAoKICAgIGZvciBfLCBkYXRhIGluIG5leHQsIGRhdGEgZG8KICAgICAgICByZW5kZXJlci5yZWN0YW5nbGUoZGF0YVsxXSwgZGF0YVsyXSwgZGF0YVszXSwgZGF0YVs0XSwgciwgZywgYiwgYSkKICAgIGVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIHRhYmxlX2NvbnRhaW5zKHRibCwgdmFsKQogICAgZm9yIGk9MSwjdGJsIGRvCiAgICAgICAgaWYgdGJsW2ldID09IHZhbCB0aGVuCiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgZW5kCiAgICBlbmQKICAgIHJldHVybiBmYWxzZQplbmQKCmxvY2FsIHgsIG8gPSAnXHgxNFx4MTRceDE0XHhGRicsICdceDBjXHgwY1x4MGNceEZGJwpsb2NhbCBwYXR0ZXJuID0gdGFibGUuY29uY2F0ewogIHgseCxvLHgsCiAgbyx4LG8seCwKICBvLHgseCx4LAogIG8seCxvLHgKfQoKbG9jYWwgdyxoID0gY2xpZW50LnNjcmVlbl9zaXplKCkKbG9jYWwgdGV4X2lkID0gcmVuZGVyZXIubG9hZF9yZ2JhKHBhdHRlcm4sIDQsIDQpCgpsb2NhbCBtZW51X3JlZmVyZW5jZSA9IHsKICAgIGVuYWJsZWQgPSB1aS5yZWZlcmVuY2UoIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJFbmFibGVkIiksCiAgICBwaXRjaCA9IHsgdWkucmVmZXJlbmNlKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAicGl0Y2giKSB9LAogICAgcm9sbCA9IHVpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgInJvbGwiKSwKICAgIHlhd2Jhc2UgPSB1aS5yZWZlcmVuY2UoIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJZYXcgYmFzZSIpLAogICAgeWF3ID0ge3VpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIllhdyIpfSwKICAgIGZzYm9keXlhdyA9IHVpLnJlZmVyZW5jZSgiQUEiLCAiYW50aS1haW1ib3QgYW5nbGVzIiwgIkZyZWVzdGFuZGluZyBib2R5IHlhdyIpLAogICAgZWRnZXlhdyA9IHVpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIkVkZ2UgeWF3IiksCiAgICBkdGhvbGRhaW0gPSB1aS5yZWZlcmVuY2UoIm1pc2MiLCAic2V0dGluZ3MiLCAic3ZfbWF4dXNyY21kcHJvY2Vzc3RpY2tzX2hvbGRhaW0iKSwKICAgIGZha2VkdWNrID0gdWkucmVmZXJlbmNlKCJSQUdFIiwgIk90aGVyIiwgIkR1Y2sgcGVlayBhc3Npc3QiKSwKICAgIG1pbmltdW1fZGFtYWdlID0gdWkucmVmZXJlbmNlKCJSQUdFIiwgIkFpbWJvdCIsICJNaW5pbXVtIGRhbWFnZSIpLAogICAgc2FmZXBvaW50ID0gdWkucmVmZXJlbmNlKCJSQUdFIiwgIkFpbWJvdCIsICJGb3JjZSBzYWZlIHBvaW50IiksCiAgICBmb3JjZWJhaW0gPSB1aS5yZWZlcmVuY2UoIlJBR0UiLCAiQWltYm90IiwgIkZvcmNlIGJvZHkgYWltIiksCiAgICBwbGF5ZXJfbGlzdCA9IHVpLnJlZmVyZW5jZSgiUExBWUVSUyIsICJQbGF5ZXJzIiwgIlBsYXllciBsaXN0IiksCiAgICByZXNldF9hbGwgPSB1aS5yZWZlcmVuY2UoIlBMQVlFUlMiLCAiUGxheWVycyIsICJSZXNldCBhbGwiKSwKICAgIGFwcGx5X2FsbCA9IHVpLnJlZmVyZW5jZSgiUExBWUVSUyIsICJBZGp1c3RtZW50cyIsICJBcHBseSB0byBhbGwiKSwKICAgIGxvYWRfY2ZnID0gdWkucmVmZXJlbmNlKCJDb25maWciLCAiUHJlc2V0cyIsICJMb2FkIiksCiAgICBmbF9saW1pdCA9IHVpLnJlZmVyZW5jZSgiQUEiLCAiRmFrZSBsYWciLCAiTGltaXQiKSwKICAgIGR0X2xpbWl0ID0gdWkucmVmZXJlbmNlKCJSQUdFIiwgIkFpbWJvdCIsICJEb3VibGUgdGFwIGZha2UgbGFnIGxpbWl0IiksCiAgICBxdWlja3BlZWsgPSB7dWkucmVmZXJlbmNlKCJSQUdFIiwgIk90aGVyIiwgIlF1aWNrIHBlZWsgYXNzaXN0Iil9LAogICAgeWF3aml0dGVyID0ge3VpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIllhdyBqaXR0ZXIiKX0sCiAgICBib2R5eWF3ID0ge3VpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIkJvZHkgeWF3Iil9LAogICAgZnJlZXN0YW5kID0ge3VpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIkZyZWVzdGFuZGluZyIpfSwKICAgIGZyZWVzdGFuZF9ib2R5ID0ge3VpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIkZyZWVzdGFuZGluZyBib2R5IHlhdyIpfSwKICAgIG9zID0ge3VpLnJlZmVyZW5jZSgiQUEiLCAiT3RoZXIiLCAiT24gc2hvdCBhbnRpLWFpbSIpfSwKICAgIHNsb3cgPSB7dWkucmVmZXJlbmNlKCJBQSIsICJPdGhlciIsICJTbG93IG1vdGlvbiIpfSwKICAgIGR0ID0ge3VpLnJlZmVyZW5jZSgiUkFHRSIsICJBaW1ib3QiLCAiRG91YmxlIHRhcCIpfSwKICAgIGZha2VsYWcgPSB7dWkucmVmZXJlbmNlKCJBQSIsICJGYWtlIGxhZyIsICJMaW1pdCIpfSwKICAgIGZha2VsYWdfdmFyaWFuY2UgPSB1aS5yZWZlcmVuY2UoIkFBIiwgIkZha2UgbGFnIiwgIlZhcmlhbmNlIiksCiAgICBmYWtlX2xhZ19hbW91bnQgPSB1aS5yZWZlcmVuY2UoIkFBIiwgIkZha2UgbGFnIiwgIkFtb3VudCIpLAogICAgbGVnX21vdmVtZW50ID0gdWkucmVmZXJlbmNlKCJBQSIsICJPdGhlciIsICJMZWcgbW92ZW1lbnQiKSwKICAgIGFtbW8gPSB1aS5yZWZlcmVuY2UoIlZJU1VBTFMiLCJQbGF5ZXIgRVNQIiwiQW1tbyIpLAogICAgd2VhcG9uX3RleHQgPSB1aS5yZWZlcmVuY2UoIlZJU1VBTFMiLCJQbGF5ZXIgRVNQIiwiV2VhcG9uIHRleHQiKSwKICAgIHdlYXBvbl9pY29uID0gdWkucmVmZXJlbmNlKCJWSVNVQUxTIiwiUGxheWVyIEVTUCIsIldlYXBvbiBpY29uIiksCiAgICBwaW5nID0geyB1aS5yZWZlcmVuY2UoIk1JU0MiLCJNaXNjZWxsYW5lb3VzIiwiUGluZyBzcGlrZSIpIH0sCiAgICBjbGFuX3RhZ19zcGFtbWVyID0gdWkucmVmZXJlbmNlKCJNSVNDIiwiTWlzY2VsbGFuZW91cyIsIkNsYW4gdGFnIHNwYW1tZXIiKSwKICAgIG1pbl9kbWdfb3ZlcnJpZGUgPSB7IHVpLnJlZmVyZW5jZSgiUkFHRSIsIkFpbWJvdCIsIk1pbmltdW0gZGFtYWdlIG92ZXJyaWRlIikgfSwKICAgIG1lbnVfa2V5ID0geyB1aS5yZWZlcmVuY2UoIk1JU0MiLCJTZXR0aW5ncyIsIk1lbnUga2V5IikgfSwKICAgIGRwaV9zY2FsZSA9IHVpLnJlZmVyZW5jZSgiTUlTQyIsIlNldHRpbmdzIiwiRFBJIHNjYWxlIikKfQoKbG9jYWwgbmV3X21lbnVfcmVmZXJlbmNlcyA9IHsKICAgIC0tZXh0cmFfbGFiZWwgPSB1aS5uZXdfbGFiZWwodGFiLHBsYWNlLCJ+IGFhIGV4dHJhcyB0YWIgfiIpLAogICAgYWFfdGFiID0gdWkubmV3X2NvbWJvYm94KHRhYixwbGFjZSwiXGFhYWM4ZmJmZmFudGktYWltXGFmZmZmZmZmZiBleHRyYXMiLHsiTWFpbiIsIkppdHRlciIsIkJydXRlZm9yY2UifSksCiAgIAogICAgWyJhYSJdID0gewogICAgICAgIAogICAgICAgIAogICAgICAgIGFhX3N0YXRlX21lbnUgPSB1aS5uZXdfY29tYm9ib3godGFiLHBsYWNlLCJcYWFhYzhmYmZmYW50aS1haW1cYWZmZmZmZmZmIHN0YXRlIix7IlN0YW5kIiwiV2FsayIsIkluLUFpciIsIkFpciBkdWNrIiwiRHVjayIsIlNsb3ciLCJNYW51YWwiLCJGYWtlbGFnIiwiTGVnaXQifSksCiAgICAgICAgYWFfc3RhdGUgPSB7fSwKICAgICAgICBhbnRpX2tuaXYgPSB1aS5uZXdfY2hlY2tib3godGFiLCBwbGFjZSwgIkFudGkta25pZmUiKSwKICAgICAgICBzYWZlX2Rhbmdlcm91cyA9IHVpLm5ld19jaGVja2JveCh0YWIsIHBsYWNlLCAic2FmZSBrbmlmZSB8IHRhc2VyIiksCiAgICAgICAgbGFiZWxfaml0dGVyX3dheXMgPSB1aS5uZXdfbGFiZWwodGFiLHBsYWNlLCJPbmx5IHdvcmtzIGlmIHlvdSBlbmFibGUgaml0dGVyIHdheXMiKSwKICAgICAgICBmcmVlc3RhbmRpbmdfb3B0aW9ucyA9IHVpLm5ld19jb21ib2JveCh0YWIsIHBsYWNlLCAiRnJlZXN0YW5kaW5nIG1vZGUiLHsiRGVmYXVsdCIsIlN0YXRpYyIsIkppdHRlciJ9KSwKICAgICAgICBmcmVlc3RhbmRpbmdfZGlzYWJsZXIgPSB1aS5uZXdfbXVsdGlzZWxlY3QodGFiLCBwbGFjZSwgIkZyZWVzdGFuZGluZyBbXGFhYWM4ZmJmZmRpc2FibGVyc1xhZmZmZmZmZmZdIix7IlN0YW5kIiwiV2FsayIsIkluLUFpciIsIkFpciBkdWNrIiwiRHVjayIsIlNsb3ciLCJGYWtlbGFnIn0pLAogICAgfSwKCiAgICBbInZpc3VhbHMiXSA9IHsKICAgICAgICAKICAgICAgICBlbmFibGVfaW5kaWNhdG9ycyA9IHVpLm5ld19jb21ib2JveCh0YWIscGxhY2UsIkluZGljYXRvcnMiLHsib2ZmIiwiZGVmYXVsdCIsIm1pbmltYWwiLCJ5ZWF0In0pLAogICAgICAgIGluZGljYXRvcl9jb2xvciA9IHVpLm5ld19jb2xvcl9waWNrZXIodGFiLCBwbGFjZSwgImluZGljYXRvcnoiLCAxMDEsIDEzMCwgMTkwLCAyNTUpLAogICAgICAgIHNjb3BlZF9hbmltYXRpb24gPSB1aS5uZXdfY2hlY2tib3godGFiLCBwbGFjZSwgIlNjb3BlZCBhbmltYXRpb24iKSwKICAgICAgICBlbmFibGVfbWFudWFsID0gdWkubmV3X2NvbWJvYm94KHRhYiwgcGxhY2UsICJNYW51YWwgYXJyb3dzIix7Im9mZiIsInRzIiwibWluaW1hbCJ9KSwKICAgICAgICBpbmRpY2F0b3JfbWFudWFsX2NvbG9yID0gdWkubmV3X2NvbG9yX3BpY2tlcih0YWIsIHBsYWNlLCAiaW5kaWNhdG9yem1hbnVhbCIsIDI1NSwgMjU1LCAyNTUsIDI1NSksCiAgICAgICAgZW5hYmxlX3ZlbG9jaXR5X2FkYXB0aXZlID0gdWkubmV3X2NoZWNrYm94KHRhYiwgcGxhY2UsICJ2ZWxvY2l0eSBhZGFwdGl2ZSIpLAogICAgICAgIGVuYWJsZV9kZWZlbnNpdmVfaW5kaWNhdG9yID0gdWkubmV3X2NoZWNrYm94KHRhYiwgcGxhY2UsICJkZWZlbnNpdmUgaW5kaWNhdG9yIiksCiAgICAgICAgaW5kaWNhdG9yX2RlZmVuc2l2ZV9jb2xvciA9IHVpLm5ld19jb2xvcl9waWNrZXIodGFiLCBwbGFjZSwgImluZGljYXRvcnpkZWZlbnNpdmUiLCAyNTUsIDI1NSwgMjU1LCAyNTUpLAogICAgICAgIHNsb3dfaW5kaWNhdG9yID0gdWkubmV3X2NoZWNrYm94KHRhYiwgcGxhY2UsICJzbG93IGRvd24gaW5kaWNhdG9yIiksCiAgICAgICAgaW5kaWNhdG9yX3Nsb3dfY29sb3IgPSB1aS5uZXdfY29sb3JfcGlja2VyKHRhYiwgcGxhY2UsICJpbmRpY2F0b3J6c2xvdyIsIDI1NSwgMjU1LCAyNTUsIDI1NSksCiAgICAgICAgZW5hYmxlX21pbl9kbWdfb3ZycmQgPSB1aS5uZXdfY2hlY2tib3godGFiLCBwbGFjZSwgIm1pbmltdW0gZGFtYWdlIGluZGljYXRvciIpLAogICAgICAgIGVuYWJsZV9kZXN5bmNfaW5kaWNhdG9yID0gdWkubmV3X2NoZWNrYm94KHRhYiwgcGxhY2UsICJkZXN5bmMgaW5kaWNhdG9yIiksCiAgICAgICAgaW5kaWNhdG9yX2Rlc3luY19jb2xvciA9IHVpLm5ld19jb2xvcl9waWNrZXIodGFiLCBwbGFjZSwgImluZGljYXRvcnpkZXN5bmMiLCAyNTUsIDI1NSwgMjU1LCAyNTUpLAogICAgICAgIGRyYXdfbG9ncyA9IHVpLm5ld19jaGVja2JveCh0YWIsIHBsYWNlLCAiY29uc29sZSBsb2dzIiksCiAgICAgICAgemV1cyA9IHVpLm5ld19tdWx0aXNlbGVjdCh0YWIsIHBsYWNlLCAiPiB6ZXVzIGluZGljYXRvciIseyJwbGF5ZXIiLCJvdXQgb2YgdmlldyJ9KSwKICAgICAgICBleHRyYV92aXN1YWxzID0gdWkubmV3X211bHRpc2VsZWN0KHRhYiwgcGxhY2UsICI+IGV4dHJhcyIseyJiZXRhIGxvZ3MiLCJiZXRhIGR0IGluZGljYXRvciIsImF0IHRhcmdldCBmbGFnIn0pLAogICAgICAgIG5vdGlfdGltZXIgPSB1aS5uZXdfc2xpZGVyKHRhYixwbGFjZSwibm90aWZjYXRpb24gdGltZXIiLCAxLCAxMCwgNSwxLCJzIiksCiAgICAgICAgbm90aV9wYWRkaW5nID0gdWkubmV3X3NsaWRlcih0YWIscGxhY2UsIm5vdGlmY2F0aW9uIHBhZGRpbmciLCAwLCA1MCwgMTAsMSwicHgiKSwKICAgICAgICBhaW1fbG9nc19sYWJlbCA9IHVpLm5ld19sYWJlbCh0YWIscGxhY2UsImFpbSBsb2dzIG91dGxpbmUiKSwKICAgICAgICBhaW1fbG9nc19vdXRsaW5lX2NvbG9yID0gdWkubmV3X2NvbG9yX3BpY2tlcih0YWIscGxhY2UsImFpbSBsb2dzIG91dGxpbmV6IiwxMDEsMTMwLDE5MCwyNTUpLAogICAgICAgIHdhdGVybWFya19sYWJlbCA9IHVpLm5ld19sYWJlbCh0YWIscGxhY2UsIndhdGVybWFyayIpLAogICAgICAgIHdhdGVybWFya19jb2xvciA9IHVpLm5ld19jb2xvcl9waWNrZXIodGFiLHBsYWNlLCJ3YXRlcl9jb2xvcnoiLDEwMSwxMzAsMTkwLDI1NSksCiAgICAgICAgd2F0b3JtdWsgPSB1aS5uZXdfY2hlY2tib3godGFiLCBwbGFjZSwgIndhdHVybXVyayIpLAogICAgICAgIGFpbWVyX2xlZ3MgPSB1aS5uZXdfY2hlY2tib3godGFiLCBwbGFjZSwgImFpbWVyX2x1Z3MiKSwKICAgICAgICB3aGF0c2FwcGkgPSB1aS5uZXdfY2hlY2tib3godGFiLCBwbGFjZSwgIndoYXRzYXBwaSIpLAogICAgfSwKCiAgICBbIm1pc2MiXSA9IHsKICAgICAgICAKICAgICAgICBlbmFibGVfY2xhbl90YWcgPSB1aS5uZXdfY2hlY2tib3godGFiLCBwbGFjZSwgInN5bmNlZCB0YWciKSwKICAgICAgICBlbmFibGVfa2lsbF9zYXkgPSB1aS5uZXdfY29tYm9ib3godGFiLCBwbGFjZSwgImtpbGwgc2F5Iix7IkRpc2FibGVkIiwiU3RhcmxpZ2h0IiwiWWVhdCJ9KSwKICAgICAgICBlbmFibGVfc3VuX3Jpc2UgPSB1aS5uZXdfY2hlY2tib3godGFiLCBwbGFjZSwgInN1biByaXNlIG1vZGUiKSwKICAgICAgICBlbmFibGVfbmlndGhlcm1vZGUgPSB1aS5uZXdfY2hlY2tib3godGFiLCBwbGFjZSwgIm5pZ2h0bW9kZSB2MiIpLAogICAgICAgIGVuYWJsZV9sb2NhbF9hbmltYXRpb25zID0gdWkubmV3X211bHRpc2VsZWN0KHRhYiwgcGxhY2UsICJhbmltYXRpb25zIFtcYWFhYzhmYmZmY2xpZW50XGFmZmZmZmZmZl0iLHsicGl0Y2ggMCIsInJldmVyc2VkIGxlZ3MiLCJtb29ud2FsayIsInN0YXRpYyBsZWdzIiwiYmxpbmQiLCJ0LXBvc2UifSksCiAgICAgICAgZGVidWdfcmFnZWJvdCA9IHVpLm5ld19tdWx0aXNlbGVjdCh0YWIsIHBsYWNlLCAiW1xhYWFjOGZiZmZkZWJ1Z1xhZmZmZmZmZmZdIHJhZ2Vib3QgZW5oYW5jZXIiLHsiZGVmZW5zaXZlIGFhIHJlc29sdmVyIChleHByaW1lbnRhbCkiLCJzYWZlIHBvaW50IGVuaGFuY2VyIn0pLAogICAgICAgIHNhZmVfcG9pbnQgPSB1aS5uZXdfbXVsdGlzZWxlY3QodGFiLCBwbGFjZSwgInNhZmUgcG9pbnQgZW5oYW5jZXIiLHsiU3RhbmQiLCJvbiBsZXRoYWwiLCJkZWZhdWx0Iiwid2lkZSBqaXR0ZXIifSksCiAgICB9LAoKICAgIFsia2V5cyJdID0gewogICAgICAgIGVuYWJsZV9rZXkgPSB1aS5uZXdfY2hlY2tib3godGFiLCBwbGFjZSwgImtleXMiKSwKICAgICAgICBtYW51YWxfbGVmdCA9IHVpLm5ld19ob3RrZXkodGFiLHBsYWNlLCAiLSBtYW51YWwgbGVmdCIsZmFsc2UpLAogICAgICAgIG1hbnVhbF9yaWdodCA9IHVpLm5ld19ob3RrZXkodGFiLHBsYWNlLCAiLSBtYW51YWwgcmlnaHQiLGZhbHNlKSwKICAgICAgICBtYW51YWxfZm9yd2FyZCA9IHVpLm5ld19ob3RrZXkodGFiLHBsYWNlLCAiLSBtYW51YWwgZm9yd2FyZCIsZmFsc2UpLAogICAgICAgIG1hbnVhbF9yZXNldCA9dWkubmV3X2hvdGtleSh0YWIscGxhY2UsICItIHJlc2V0IGFuZ2xlcyIsZmFsc2UpLAogICAgICAgIGdsb2JhbF9mcyA9IHVpLm5ld19ob3RrZXkodGFiLHBsYWNlLCAiLSBmcmVlc3RhbmRpbmciLGZhbHNlKSwKICAgIH0sCgogICAgWyJjb25maWciXSA9IHsKICAgICAgIAogICAgfSwKCiAgICBbImJydXRlZm9yY2UiXSA9IHsKICAgICAgICBbMV0gPSAwLAogICAgICAgIFsyXSA9IDAsCiAgICAgICAgWzNdID0gMCwKICAgICAgICBbNF0gPSAwLAogICAgfSwKfQoKdWkuc2V0X3Zpc2libGUobmV3X21lbnVfcmVmZXJlbmNlc1sidmlzdWFscyJdLndhdG9ybXVrLCBmYWxzZSkKdWkuc2V0X3Zpc2libGUobmV3X21lbnVfcmVmZXJlbmNlc1sidmlzdWFscyJdLmFpbWVyX2xlZ3MsIGZhbHNlKQp1aS5zZXRfdmlzaWJsZShuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0ud2hhdHNhcHBpLCBmYWxzZSkKCgpsb2NhbCBhYV9mdW5jdGlvbnMgPSB7CiAgICBhYV9udW1iZXIgPSAiU3RhbmQiLAogICAgaml0dGVyX3dheV9udW1iZXIgPSAxLAogICAgb2xkX3dlYXBvbiA9IDAsCiAgICBhY3R1YWxfd2VhcG9uID0gMCwKICAgIGFjdHVhbF90aWNrID0gMCwKICAgIHRvX3N0YXJ0ID0gZmFsc2UsCiAgICB0b19qaXR0ZXIgPSBmYWxzZSwgIAogICAgYm9tYl93YXNfYm9tYmVkID0gZmFsc2UsCiAgICBib21iX3dhc19kZWZ1c2VkID0gZmFsc2UsCiAgICBjYW5fZGVmZW5zaXZlID0gZmFsc2UsCiAgICBkZWZfdGlja3MgPSAwLAp9Cgpsb2NhbCB2aXN1YWxfZnVuY3Rpb25zID0gewogICAgaW5kaWNhdG9yX2JvdHRvbSA9IDAsCiAgICBkYW1hZ2VfaW5kaSA9ICIwIiwKICAgIGR0X2luZGljYXRvcl9hbmltYXRpb24gPSAwLAogICAgaHNfaW5kaWNhdG9yX2FuaW1hdGlvbiA9IDAsCiAgICBvZmZzZXQgPSAwLAogICAgb2Zmc2V0MiA9IDAsCiAgICBkZWZlbnNpdmVfcmVhZHkgPSBmYWxzZSwKICAgIGlzX2RlZmVuc2l2ZSA9IGZhbHNlLAogICAgb3V0bGluZV90ZXh0X2FscGhhID0gMjU1LAogICAgdGV4dF9hbHBoYSA9IDI1NSwKICAgIGlzX2RlZmVuc2l2ZV9zdGF0ZSA9IGZhbHNlLAogICAgaXNfZGVmZW5zaXZlX3RpY2tzID0gMCwKICAgIGlzX2RlZmVuc2l2ZV9kaXNhYmxlID0gZmFsc2UsCiAgICB0aWNrcyA9IDAsCiAgICBvbGRfd2VhcG9uID0gMCwKICAgIGN1cnJlbnRfd2VhcG9uID0gMCwKICAgIGlzX2luX2F0dGFjayA9IGZhbHNlLAogICAgaW5fZmlyZSA9IGZhbHNlLAogICAgbW92ZSA9IGZhbHNlLAogICAgZGFtYWdlX3ByZWRpY3Rfc3RyaW5nX2NhbGMgPSAiIiwKICAgIGNhbGNfZG1nID0gMCwKICAgIGNoYW5jZSA9IDAsCiAgICBidCA9IDAsCiAgICBwcmVkaWN0ZWRfZGFtYWdlID0gMCwKICAgIHByZWRpY3RlZF9oaXRncm91cCA9IDAsCn0KCmxvY2FsIG1pc2NfZnVuY3Rpb25zID0gewogICAga2lsbF9zYXkgPSB7WyJTdGFybGlnaHQiXSA9IHsiVSB0aGluayB1IGdvb2Q/IGx1Y2tpbHkgaW0gaGVyZSAjU1RBUkxJR0hUIiwieW91cmUgdmFsdWUgY29tcGFyZWQgdG8gbWUgIGlzIGJ1dCBhIGdyYWluIG9mIHNhbmQiLCJhbGwgcm9tYW5pYW4oeW91KSB3aWxsIGRpZSB0byBtZShneXB5cyBraW5nKSIsCiAgICAidGhpcyBpc250IHBoYXNtYXBob2JpYTogZ2xvYmFsIG9mZmVuc2l2ZSBwbGVhc2UgZG9udCBzcGVhayIsInN0YXJsaWdodCB0cmFwIGhvdXNlIiwiSSBndWFybnRlZSB5b3VyZSBsb3NzIGZvcmV2ZXIgYW5kIGFsd2F5cyIsIvCdlaHwnZWj8J2VoPCdlZPwnZWd8J2VlvCdlZ4/IiwiY29wZSIsCiAgICAiIOagvOaLieagvOaLiSA8IHlvdT8g5peg5Yqf5peg6L+HIDwgbWUgQikgI1NUQVJMSUdIVCIsImluIGh2aCB3YXIgaSB3aWxsIHdpbiIsImJlbG93IGF2ZXJhZ2UgcGVyZm9ybWFuY2Ugc3RhcmxpZ2h0IHBlcmZvcm1hbmNlIiwiU1BFQUsgQlVMR0FSSUFOPyBXSUxMIFRBTEsgQ04iLAogICAgInlvdSBhcmUgbG9zcyBpdCBpcyBkZWNpZGVkIHdpdGggbXkgc3RhcmxpZ2h0Lmx1YSIsInlvdSBkbyBub3QgcGVyZm9ybSB0aGlzIGh2aCBhZ2FpbnN0IHN0YXJsaWdodCIsInFhaGFoYWhhIGkgYW0gdG9wIG9mIHRoaXMgcmVnaW9uIiwidGhpcyB3ZWFrIHNuYWlsIGlzIHNwb2tlIG9mIHZpY3RvcnkgYnV0IGlzIGRvb3IgdW5oaW5nZWQgdG8gbG9zcyIsCiAgICAieW91IGRvIG5vdCBoYXZlIHRoZSBpbXByZXNzaW9uIG9mIG93bmluZyB0aGUgcGVyZm9ybWFuY2UtZW5oYW5jaW5nIHNvZnR3YXJlIGtub3duIGFzIEdhbWVzZW5zZS5wdWIiLCJob3cgeW91IHdpbGwgZmVlbCBrbm93aW5nIGltIHNrZWV0aGF2aW5nIGFuZCB1IHdpbGwgc2tlZXRsZXNzICNzdGFybGlnaHQiLAogICAgInlvdXIgbWV4aWNhbiBmYW1pbGlhIG5ldmVyIG1ha2UgaXQgb3V0IGZyb20gdHJhaWxlciAjc3RhcmxpZ2h0IiwiY2FudCB1bmRlcnN0YW5kIHUuIGFueSBub25hbWUgdHJhbnNsYXRvcj8gI1NUQVJMSUdIVCIsInlvdSB3YXN0ZSBha2EgZmVjYWwgbWF0dGVyL3NoaXQoeW91KSIsInNvcnJ5IGZvciB1IGxvc3MsIG1lIGFsd2F5cyBiZXR0ZXIgbGlrZSBsaWZlIiwKICAgICJiZXR0ZXIgbHVjayBuZXh0IHJvdW5kLCBvaCB3YWl0IGkgYWxyIHdvbiBCQUhBSEhBIiwidXIgbHVhICYgdSBzdWNrcyBnZXQgU1RBUkxJR0hUID4uPCIsIndoZW4geW91IHNwYXduIHRlbGwgbWUgd2h5IHUgZGllIHRvIG1lIiwiaG93IGhpdCBjaGFuY2UgaW4gZGVhZ2xlPyBpIHNpdC4iLAogICAgInNoaXR0aW5nIG9uIHlvdXIgY2hlYXQgc3BlZWRydW4gYW55JSBXUiBydW4gZmVhdCBzdGFybGlnaHQiLCJzbWVsbHkgbGFwZG9nIGRyZWFtcyBvZiBzdWNjZXNzIGluIDF4MSBidXQgaXMgaGFuZGVkIDkgY2FzdWFsaXRpZXMiLCJkdWRlIHdoZXJlIGFyZSBteSBkaWFtb25kcz8iLCJhbGwgd2VhayBkb2dzIGZhbGwgdG8gc3RhcmxpZ2h0IiwiV09XIFNUQVJMSUdIVCAu44CCR1lQU1kg55qE56eR5oqAIChURUNITk9MT0dZKSA/ICJ9LAogICAgWyJZZWF0Il0gPSB7IkkgZ290IGJlZWYgd2l0aCBteSBraWRuZXksIGhlIHNhaWQgdGhhdCB3ZSBnb3QgYSBwcm9ibGVtIiwiZmlyc3QgbXkgbW9uZXkgdHdlcmssIG5vdyBpdHMgbGlmdGluZyB3ZWlnaHRzIG1vbmV5IGluIHRoZSBneW0sIG5vdyBpdHMgaGVhdnl3ZWlnaHQiLAogICAgIkkganVzdCBwb3BwZWQgYSBYIHBpbGwgYW5kIGhhbGYgbXkgYm9keSBnbGl0Y2hlZCIsICJZZWFoLCB0aGlzIHBlcmN5IGdvdCBtZSBzbmFpbCwgeW91IHNob3VsZCBjYWxsIG1lIEdhcnkiLCJNYWQgYm91dCB0aGF0In19LAogICAgY2xhbl90YWcgPSB7IiIsICJzdCIsInN0YSIsInN0YXIiLCJzdGFybCIsInN0YXJsaSIsInN0YXJsaWciLCJzdGFybGlnaCIsInN0YXJsaWdodCIsInN0YXJsaWdoIiwic3RhcmxpZyIsInN0YXJsaSIsInN0YXJsIiwic3RhciIsInN0YSIsInN0In0sCiAgICBjdF90aWNrID0gMCwKICAgIGN0X29sZF90aWNrID0gMCwKICAgIHNhdmVfdGljayA9IDAsCiAgICBjbGFuX3RhZ19jaGFuZ2VfcG90ZW50aWFsID0gImNoYW5nZSIsCiAgICB3YXNfY3RfZW5hYmxlZF9iZWZvcmUgPSBmYWxzZSwKICAgIGdyb3VuZF90aWNrcyA9IDEsCiAgICBlbmRfdGltZSA9IDAsCn0KCmxvY2FsIGZ1bmN0aW9uIGxlcnAoYSwgYiwgdCkKICAgIHJldHVybiBhICsgKGIgLSBhKSAqIHQKZW5kCgoKbG9jYWwgdWlfbWVudSA9IHsKICAgIHRhYnNfbmFtZXMgPSB7Iu6EpSIsIu6EtiIsIu6KsSIsIu6HniIsIu6EsiJ9LAogICAgc2VsZWN0ZWRfdGFiID0gMSwKICAgIHNlbGVjdGVkX2NvbG9yID0geyB7MjAsIDIwLCAyMCwgMjU1fSwgezIxMCwyMTAsMjEwLDI1NX0gfSwKICAgIHNlbGVjdGVkX2NvbCA9ICI4OEE2RjM5MSIsCiAgICBtZW51X2FscGhhID0gMjU1LAogICAgaXNfaG92ZXJlZCA9IGZhbHNlLAogICAgZHBpX3NjYWxpbmdfeSA9IHt7ODQsMTQ5fSx7MTAwLDE4MX0sezExNiwyMTN9LHsxMzIsMjQ1fSx7MTQ4LDI3Nn19LAogICAgcGVzYWRlbG9fbmFfY296aW5oYTIgPSB7NTk3LDc0MSw4ODUsMTAzMCwxMTczIH0sCiAgICBzZWxlY3RlZF9nc190YWIgPSBmYWxzZSwKICAgIG1vdXNlX3ByZXNzID0gZmFsc2UsCiAgICBvbGRfbXBvcyA9IHswLDB9Cn0KCmZ1bmN0aW9uIHVpX21lbnU6aXNfYWFfdGFiKCkKICAgIGxvY2FsIG1lbnVfc2l6ZSA9IHsgdWlfbWVudV9zaXplKCkgfQogIAogICAgCiAgICBsb2NhbCBtZW51X3BvcyA9IHsgdWlfbWVudV9wb3NpdGlvbigpIH0KICAgIGxvY2FsIG1vdXNlX3BvcyA9IHsgdWlfbW91c2VfcG9zaXRpb24oKSB9CgogICBsb2NhbCBzY2FsZSA9IHswLDB9CiAgIGxvY2FsIHNjYWxlX3ggPSAwCiAgIGxvY2FsIHBlc2FkZWxvX25vX2RpcmVpdG8gPSAwCgogICAgCgogICAgaWYgdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLmRwaV9zY2FsZSkgPT0gIjEwMCUiIHRoZW4KICAgICAgICBzY2FsZSA9IHsgdWlfbWVudS5kcGlfc2NhbGluZ195WzFdWzFdLHVpX21lbnUuZHBpX3NjYWxpbmdfeVsxXVsyXSB9CiAgICAgICAgc2NhbGVfeCA9IDc2CiAgICAgICAgcGVzYWRlbG9fbm9fZGlyZWl0byA9IHVpX21lbnUucGVzYWRlbG9fbmFfY296aW5oYTJbMV0KICAgIGVsc2VpZiB1aS5nZXQobWVudV9yZWZlcmVuY2UuZHBpX3NjYWxlKSAgPT0gIjEyNSUiIHRoZW4KICAgICAgICBzY2FsZSA9IHsgdWlfbWVudS5kcGlfc2NhbGluZ195WzJdWzFdLHVpX21lbnUuZHBpX3NjYWxpbmdfeVsyXVsyXSB9CiAgICAgICAgc2NhbGVfeCA9IDk1CiAgICAgICAgcGVzYWRlbG9fbm9fZGlyZWl0byA9IHVpX21lbnUucGVzYWRlbG9fbmFfY296aW5oYTJbMl0KICAgIGVsc2VpZiB1aS5nZXQobWVudV9yZWZlcmVuY2UuZHBpX3NjYWxlKSAgPT0gIjE1MCUiIHRoZW4KICAgICAgICBzY2FsZSA9IHsgdWlfbWVudS5kcGlfc2NhbGluZ195WzNdWzFdLHVpX21lbnUuZHBpX3NjYWxpbmdfeVszXVsyXSB9CiAgICAgICAgc2NhbGVfeCA9IDExMwogICAgICAgIHBlc2FkZWxvX25vX2RpcmVpdG8gPSB1aV9tZW51LnBlc2FkZWxvX25hX2NvemluaGEyWzNdCiAgICBlbHNlaWYgdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLmRwaV9zY2FsZSkgID09ICIxNzUlIiB0aGVuCiAgICAgICAgc2NhbGUgPSB7IHVpX21lbnUuZHBpX3NjYWxpbmdfeVs0XVsxXSx1aV9tZW51LmRwaV9zY2FsaW5nX3lbNF1bMl0gfQogICAgICAgIHNjYWxlX3ggPSAxMzIKICAgICAgICBwZXNhZGVsb19ub19kaXJlaXRvID0gdWlfbWVudS5wZXNhZGVsb19uYV9jb3ppbmhhMls0XQogICAgZWxzZWlmIHVpLmdldChtZW51X3JlZmVyZW5jZS5kcGlfc2NhbGUpICA9PSAiMjAwJSIgdGhlbgogICAgICAgIHNjYWxlID0geyB1aV9tZW51LmRwaV9zY2FsaW5nX3lbNV1bMV0sdWlfbWVudS5kcGlfc2NhbGluZ195WzVdWzJdIH0KICAgICAgICBzY2FsZV94ID0gMTUxCiAgICAgICAgcGVzYWRlbG9fbm9fZGlyZWl0byA9IHVpX21lbnUucGVzYWRlbG9fbmFfY296aW5oYTJbNV0KICAgIGVuZAoKICAgIGlmIHVpX21lbnUubW91c2VfcHJlc3MgPT0gZmFsc2UgdGhlbgogICAgICAgIHVpX21lbnUub2xkX21wb3MgPSBtb3VzZV9wb3MKICAgIGVuZCAgICAgIAoKICAgIGlmIGNsaWVudC5rZXlfc3RhdGUoMHgxKSB0aGVuCiAgICAgICAgaWYgbm90IHVpX21lbnUubW91c2VfcHJlc3MgdGhlbgogICAgICAgICAgICB1aV9tZW51Lm1vdXNlX3ByZXNzID0gdHJ1ZQogICAgICAgICAgICBpZiBtb3VzZV9wb3NbMV0gPiBtZW51X3Bvc1sxXSArIDUgYW5kIG1vdXNlX3Bvc1sxXSA8IG1lbnVfcG9zWzFdICsgNSArIHNjYWxlX3ggdGhlbgogICAgICAgICAgICAgICAgaWYgbW91c2VfcG9zWzJdID4gbWVudV9wb3NbMl0gKyBzY2FsZVsxXSBhbmQgbW91c2VfcG9zWzJdIDwgbWVudV9wb3NbMl0gKyBzY2FsZVsyXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdWlfbWVudS5zZWxlY3RlZF9nc190YWIgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbHNlaWYgbW91c2VfcG9zWzJdID4gbWVudV9wb3NbMl0gKyAxOSBhbmQgKG1lbnVfc2l6ZVsyXSA+PSBwZXNhZGVsb19ub19kaXJlaXRvIGFuZCBtb3VzZV9wb3NbMl0gPCBtZW51X3Bvc1syXSArIG1lbnVfc2l6ZVsyXSBvciBtb3VzZV9wb3NbMl0gPCBtZW51X3Bvc1syXSArIHBlc2FkZWxvX25vX2RpcmVpdG8pIGFuZCB1aV9tZW51LnNlbGVjdGVkX2dzX3RhYiA9PSB0cnVlIHRoZW4KICAgICAgICAgICAgICAgICAgICB1aV9tZW51LnNlbGVjdGVkX2dzX3RhYiA9IGZhbHNlCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgdWlfbWVudS5tb3VzZV9wcmVzcyA9IGZhbHNlCiAgICBlbmQKZW5kCgpmdW5jdGlvbiB1aV9tZW51Om5ld190YWIoKQoKICAgIHVpX21lbnUuaXNfaG92ZXJlZCA9IGZhbHNlCiAgICBpZiBub3QgdWkuaXNfbWVudV9vcGVuKCkgIHRoZW4KICAgICAgICB1aV9tZW51Lm1lbnVfYWxwaGEgPSBsZXJwKHVpX21lbnUubWVudV9hbHBoYSwwLGdsb2JhbHMuZnJhbWV0aW1lKCkgKiA1MCkKICAgIGVsc2UKICAgICAgICB1aV9tZW51Lm1lbnVfYWxwaGEgPSBsZXJwKHVpX21lbnUubWVudV9hbHBoYSwyNTUsZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDUpCiAgICBlbmQKCiAgICBpZiB1aV9tZW51Lm1lbnVfYWxwaGEgPCA1MCB0aGVuIHJldHVybiBlbmQKCiAgICBsb2NhbCBtZW51X3NpemUgPSB7IHVpX21lbnVfc2l6ZSgpIH0KICAgIGxvY2FsIGRpdmlkZV9tZW51ID0gKG1lbnVfc2l6ZVsxXSAtIDEyKSAvICN1aV9tZW51LnRhYnNfbmFtZXMKICAgIAogICAgbG9jYWwgbWVudV9wb3MgPSB7IHVpX21lbnVfcG9zaXRpb24oKSB9CiAgICBsb2NhbCBtb3VzZV9wb3MgPSB7IHVpX21vdXNlX3Bvc2l0aW9uKCkgfQoKICAgIGlmIG5vdCB1aV9tZW51LnNlbGVjdGVkX2dzX3RhYiB0aGVuIHJldHVybiBlbmQKICAgIAogICAgZm9yIGssdiBpbiBpcGFpcnModWlfbWVudS50YWJzX25hbWVzKSBkbwoKICAgICAgICBpZiB1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSBrIHRoZW4KICAgICAgICAgICAgdWlfbWVudS5zZWxlY3RlZF9jb2xvclsxXSA9IHsyMCwgMjAsIDIwfQogICAgICAgICAgICB1aV9tZW51LnNlbGVjdGVkX2NvbG9yWzJdID0gezIxMCwgMjEwLCAyMTB9CiAgICAgICAgICAgIC0tdWlfbWVudS5zZWxlY3RlZF9jb2wgPSAiXGFEMkQyRDJGRiIKICAgICAgICBlbHNlCiAgICAgICAgICAgIHVpX21lbnUuc2VsZWN0ZWRfY29sb3JbMV0gPSB7MTIsIDEyLCAxMn0KICAgICAgICAgICAgdWlfbWVudS5zZWxlY3RlZF9jb2xvclsyXSA9IHs5MCwgOTAsIDkwfQogICAgICAgICAgICAtLXVpX21lbnUuc2VsZWN0ZWRfY29sID0gIlxhNEU0RTRFOTciCiAgICAgICAgZW5kCiAgICAgICAKICAgICAgIAogICAgICAgIHJlbmRlcmVyLnJlY3RhbmdsZShtZW51X3Bvc1sxXSArIDYgLCBtZW51X3Bvc1syXSAtIDQ3LG1lbnVfc2l6ZVsxXSAtIDYsMiwgdWlfbWVudS5zZWxlY3RlZF9jb2xvclsxXVsxXSwgdWlfbWVudS5zZWxlY3RlZF9jb2xvclsxXVsyXSwgdWlfbWVudS5zZWxlY3RlZF9jb2xvclsxXVszXSwgdWlfbWVudS5tZW51X2FscGhhICkKICAgICAgICByZW5kZXJlci5yZWN0YW5nbGUobWVudV9wb3NbMV0gKyA2ICsgKGRpdmlkZV9tZW51ICogaykgLSBkaXZpZGVfbWVudSwgbWVudV9wb3NbMl0gLSA0NSxkaXZpZGVfbWVudSArIDEsNTAgLCB1aV9tZW51LnNlbGVjdGVkX2NvbG9yWzFdWzFdLCB1aV9tZW51LnNlbGVjdGVkX2NvbG9yWzFdWzJdLCB1aV9tZW51LnNlbGVjdGVkX2NvbG9yWzFdWzNdLCB1aV9tZW51Lm1lbnVfYWxwaGEgKQogICAgICAgIHJlbmRlcmVyLnRleHR1cmUodGV4X2lkLCBtZW51X3Bvc1sxXSArIDYgKyAoZGl2aWRlX21lbnUgKiB1aV9tZW51LnNlbGVjdGVkX3RhYikgLSBkaXZpZGVfbWVudSwgbWVudV9wb3NbMl0gLSA0NSxkaXZpZGVfbWVudSArIDEsNTAsIDI1NSwgMjU1LCAyNTUsIHVpX21lbnUubWVudV9hbHBoYSwgJ3InKQogICAgICAgIAogICAgICAgIGlmIG9iZXhfZGF0YS51c2VybmFtZSA9PSAiS2liIiB0aGVuCiAgICAgICAgICAgIHJlbmRlcmVyLnRleHQobWVudV9wb3NbMV0gKyAoZGl2aWRlX21lbnUgKiBrKSAtIGRpdmlkZV9tZW51IC8gMiAsbWVudV9wb3NbMl0gLSAyNSx1aV9tZW51LnNlbGVjdGVkX2NvbG9yWzJdWzFdLCB1aV9tZW51LnNlbGVjdGVkX2NvbG9yWzJdWzJdLCB1aV9tZW51LnNlbGVjdGVkX2NvbG9yWzJdWzNdLHVpX21lbnUubWVudV9hbHBoYSwiY2QrIiwwLCJLaWJieSIpCiAgICAgICAgZWxzZQogICAgICAgICAgICByZW5kZXJlci50ZXh0KG1lbnVfcG9zWzFdICsgKGRpdmlkZV9tZW51ICogaykgLSBkaXZpZGVfbWVudSAvIDIgLG1lbnVfcG9zWzJdIC0gMjUsdWlfbWVudS5zZWxlY3RlZF9jb2xvclsyXVsxXSwgdWlfbWVudS5zZWxlY3RlZF9jb2xvclsyXVsyXSwgdWlfbWVudS5zZWxlY3RlZF9jb2xvclsyXVszXSx1aV9tZW51Lm1lbnVfYWxwaGEsImNkKyIsMCx2KQogICAgICAgIGVuZAoKICAgICAgICBpZiBtb3VzZV9wb3NbMV0gPiBtZW51X3Bvc1sxXSArIChkaXZpZGVfbWVudSAqIGspIC0gIGRpdmlkZV9tZW51IGFuZCBtb3VzZV9wb3NbMV0gPCBtZW51X3Bvc1sxXSArIChkaXZpZGVfbWVudSAqIGspIGFuZCBtb3VzZV9wb3NbMl0gPiBtZW51X3Bvc1syXSAtIDUwIGFuZCBtb3VzZV9wb3NbMl0gPCBtZW51X3Bvc1syXSB0aGVuCiAgICAgICAgICAgIHVpX21lbnUuaXNfaG92ZXJlZCA9IHRydWUKICAgICAgICAgICAgaWYgIGNsaWVudC5rZXlfc3RhdGUoMHgxKSB0aGVuCiAgICAgICAgICAgICAgICB1aV9tZW51LnNlbGVjdGVkX3RhYiA9IGsKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIGlmIG9iZXhfZGF0YS51c2VybmFtZSA9PSAiS2liIiB0aGVuCiAgICAgICAgcmVuZGVyZXIudGV4dChtZW51X3Bvc1sxXSArIChkaXZpZGVfbWVudSAqIHVpX21lbnUuc2VsZWN0ZWRfdGFiKSAtIGRpdmlkZV9tZW51IC8gMiAsbWVudV9wb3NbMl0gLSAyNSwyMTAsIDIxMCwgMjEwLHVpX21lbnUubWVudV9hbHBoYSwiY2QrIiwwLCJLaWJieSIpCiAgICBlbHNlCiAgICAgICAgcmVuZGVyZXIudGV4dChtZW51X3Bvc1sxXSArIChkaXZpZGVfbWVudSAqIHVpX21lbnUuc2VsZWN0ZWRfdGFiKSAtIGRpdmlkZV9tZW51IC8gMiAsbWVudV9wb3NbMl0gLSAyNSwyMTAsIDIxMCwgMjEwLHVpX21lbnUubWVudV9hbHBoYSwiY2QrIiwwLHVpX21lbnUudGFic19uYW1lc1t1aV9tZW51LnNlbGVjdGVkX3RhYl0pCiAgICBlbmQKZW5kCgpmdW5jdGlvbiB1aV9tZW51Om91dHNpZGVfYmFyKCkKICAgIAogICAgaWYgbm90IHVpX21lbnUuc2VsZWN0ZWRfZ3NfdGFiIHRoZW4gcmV0dXJuIGVuZAoKICAgIGlmIHVpX21lbnUubWVudV9hbHBoYSA8IDUwIHRoZW4gcmV0dXJuIGVuZAoKICAgIGxvY2FsIG1lbnVfc2l6ZSA9IHsgdWlfbWVudV9zaXplKCkgfQogICAgbG9jYWwgbWVudV9wb3MgPSB7IHVpX21lbnVfcG9zaXRpb24oKSB9CiAKCgogICAgLS10b3AgYmFyCiAgICByZW5kZXJlcl9yZWN0YW5nbGUobWVudV9wb3NbMV0gLG1lbnVfcG9zWzJdIC0gNTMsbWVudV9zaXplWzFdICwxICwxMiwxMiwxMix1aV9tZW51Lm1lbnVfYWxwaGEpIC0tIGJsYWNrCiAgICByZW5kZXJlcl9yZWN0YW5nbGUobWVudV9wb3NbMV0gKyAyLG1lbnVfcG9zWzJdIC0gNTIsbWVudV9zaXplWzFdIC0gNCw1ICw2MCw2MCw2MCx1aV9tZW51Lm1lbnVfYWxwaGEpIC0tIG91dGxpbmVzCiAgICByZW5kZXJlcl9yZWN0YW5nbGUobWVudV9wb3NbMV0gKyAyLG1lbnVfcG9zWzJdIC0gNTEsbWVudV9zaXplWzFdIC0gNCwzICw0MCw0MCw0MCx1aV9tZW51Lm1lbnVfYWxwaGEpIC0tIGlubmVyCgogICAgLS1sZWZ0IGJhcgogICAgcmVuZGVyZXJfcmVjdGFuZ2xlKG1lbnVfcG9zWzFdICxtZW51X3Bvc1syXSAtIDUzLDEsNTMgLDEyLDEyLDEyLHVpX21lbnUubWVudV9hbHBoYSkgLS0gYmxhY2sKICAgIHJlbmRlcmVyX3JlY3RhbmdsZShtZW51X3Bvc1sxXSArIDEsbWVudV9wb3NbMl0gLSA1Miw0LDUyICw2MCw2MCw2MCx1aV9tZW51Lm1lbnVfYWxwaGEpIC0tIG91dGxpbmVzCiAgICByZW5kZXJlcl9yZWN0YW5nbGUobWVudV9wb3NbMV0gKyAyLG1lbnVfcG9zWzJdIC0gNTEsMyw1MSAsNDAsNDAsNDAsdWlfbWVudS5tZW51X2FscGhhKSAtLSBpbm5lcgogICAgcmVuZGVyZXJfcmVjdGFuZ2xlKG1lbnVfcG9zWzFdICsgNSxtZW51X3Bvc1syXSAtIDQ4LDEsNDggLDYwLDYwLDYwLHVpX21lbnUubWVudV9hbHBoYSkgLS0gb3V0bGluZXMKCiAgICAtLXJpZ2h0IGJhcgogICAgcmVuZGVyZXJfcmVjdGFuZ2xlKG1lbnVfcG9zWzFdICsgbWVudV9zaXplWzFdIC0gMSxtZW51X3Bvc1syXSAtIDUzLDEsNTMgLDEyLDEyLDEyLHVpX21lbnUubWVudV9hbHBoYSkgLS0gYmxhY2sKICAgIHJlbmRlcmVyX3JlY3RhbmdsZShtZW51X3Bvc1sxXSArIG1lbnVfc2l6ZVsxXSAtIDMsbWVudV9wb3NbMl0gLSA1MiwyLDUyICw2MCw2MCw2MCx1aV9tZW51Lm1lbnVfYWxwaGEpIC0tIG91dGxpbmVzCiAgICByZW5kZXJlcl9yZWN0YW5nbGUobWVudV9wb3NbMV0gKyBtZW51X3NpemVbMV0gLSA1LG1lbnVfcG9zWzJdIC0gNTEsMyw1MSAsNDAsNDAsNDAsdWlfbWVudS5tZW51X2FscGhhKSAtLSBpbm5lcgogICAgcmVuZGVyZXJfcmVjdGFuZ2xlKG1lbnVfcG9zWzFdICsgbWVudV9zaXplWzFdIC0gNixtZW51X3Bvc1syXSAtIDQ4LDEsNDggLDYwLDYwLDYwLHVpX21lbnUubWVudV9hbHBoYSkgLS0gb3V0bGluZXMKCiAgICByZW5kZXJlci5ncmFkaWVudChtZW51X3Bvc1sxXSArIDcsbWVudV9wb3NbMl0gLSA0NiwKICAgIG1lbnVfc2l6ZVsxXS8yLDEsIDU5LCAxNzUsIDIyMiwgMjU1LCAyMDIsIDcwLCAyMDUsIDI1NSx0cnVlKQogICAgICAgICAgICAKICAgIHJlbmRlcmVyLmdyYWRpZW50KG1lbnVfcG9zWzFdICsgNyArIG1lbnVfc2l6ZVsxXS8yICxtZW51X3Bvc1syXSAtIDQ2LAogICAgbWVudV9zaXplWzFdLzIgLSAxNCwgMSwyMDIsIDcwLCAyMDUsIDI1NSwyMDQsIDIyNywgNTMsIDI1NSx0cnVlKQplbmQKCmxvY2FsIGFhID0gewogICAgYWFfc3RhdGVzID0geyJTdGFuZCIsIldhbGsiLCJJbi1BaXIiLCJBaXIgZHVjayIsIkR1Y2siLCJTbG93IiwiTWFudWFsIiwiRmFrZWxhZyIsIkxlZ2l0In0sCiAgICBtYW51YWxfc3RhdGUgPSAicmVzZXQiLAogICAgY29sb3JfbGVmdCA9IHsxMjAsMTIwLDEyMCwyNTV9LAogICAgY29sb3JfcmlnaHQgPSB7MTIwLDEyMCwxMjAsMjU1fSwKICAgIGNvbG9yX2JvZHlfciA9IHsxMjAsMTIwLDEyMCwyNTV9LAogICAgY29sb3JfYm9keV9sID0gezEyMCwxMjAsMTIwLDI1NX0sCiAgICBsYXN0X3ByZXNzZWQgPSAwLAp9Cgpsb2NhbCBicnV0ZV9zdGFnZSA9IHsKICAgIGJydXRlID0ge30sCiAgICBsYXN0X21pc3MgPSAwLAogICAgdG9fZGVhdGhfcmVzZXQgPSBmYWxzZSwKICAgIHRvX3Jlc2V0ID0gZmFsc2UsCiAgICByb3VuZF9zdGFydGluZyA9IGZhbHNlLAp9Cgpsb2NhbCBsaWdodF9ibHVlID0gIlxhYWFjOGZiZmYiCmxvY2FsIHdoaXRlID0gIlxhZmZmZmZmZmY6ICIKLS0gbWVudSBhYSB1aQpmb3Igayx2IGluIGlwYWlycyhhYS5hYV9zdGF0ZXMpIGRvCiAgICAKICAgIAogICAgYnJ1dGVfc3RhZ2UuYnJ1dGVbdl0gPSB7fQogICAgbG9jYWwgeSA9IHN0cmluZy5zdWIodiwxLDEpCiAgICBsb2NhbCBuZXdfc3RyZW5nID0gc3RyaW5nLmdzdWIodix5LHN0cmluZy51cHBlcih5KSkKICAgIG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0gPSB7fQogICAgbmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS5qd2F5X2NvdW50ZXIgPSB1aS5uZXdfc2xpZGVyKHRhYixwbGFjZSwgImppdHRlciBzbGlkZXIgXG4iIC4uIG5ld19zdHJlbmcsIDIsIDEyLCAyKQogICAgbmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS5lbmFibGVkID0gdWkubmV3X2NoZWNrYm94KHRhYixwbGFjZSwiZW5hYmxlICciIC4uIGxpZ2h0X2JsdWUgLi4gbmV3X3N0cmVuZyAuLiAiJyIgLi4gIlxhZmZmZmZmZmYiICkKICAgIG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0ucGl0Y2ggPSB1aS5uZXdfY29tYm9ib3godGFiLHBsYWNlLGxpZ2h0X2JsdWUgLi4gbmV3X3N0cmVuZyAuLiB3aGl0ZSAuLiJwaXRjaFxuIiAuLiB2LHsib2ZmIiwgImRlZmF1bHQiLCAiZG93biIsICJtaW5pbWFsIiwiY3VzdG9tIn0pCiAgICBuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLnBpdGNoX3NsaWRlciA9IHVpLm5ld19zbGlkZXIodGFiLHBsYWNlLCJcbiIgLi4gbGlnaHRfYmx1ZSAuLiBuZXdfc3RyZW5nIC4uIHdoaXRlIC4uICJjdXN0b20gcGl0Y2giLCAtODksIDg5LCAwKQoKCiAgICBuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLnlhd2Jhc2UgPSB1aS5uZXdfY29tYm9ib3godGFiLHBsYWNlLGxpZ2h0X2JsdWUgLi4gbmV3X3N0cmVuZyAuLiB3aGl0ZSAuLiJ5YXcgYmFzZVxuIiAuLiB2LHsibG9jYWwgdmlldyIsICJhdCB0YXJnZXRzIn0pCiAgICBuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLnlhdyA9IHVpLm5ld19jb21ib2JveCh0YWIscGxhY2UsbGlnaHRfYmx1ZSAuLiBuZXdfc3RyZW5nIC4uIHdoaXRlIC4uInlhd1xuIiAuLiB2LHsib2ZmIiwgIjE4MCIsICIxODAgeiIsICJjcm9zc2hhaXIiLCJqaXR0ZXJ5IiwiZGVsYXllZCIsImwgJiByIn0pCiAgICAKICAgIG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0ueWF3YWRkID0gdWkubmV3X3NsaWRlcih0YWIscGxhY2UsIGxpZ2h0X2JsdWUgLi4gbmV3X3N0cmVuZyAuLiB3aGl0ZSAuLiJ5YXcgcmlnaHRcbiIgLi4gdiwgLTE4MCwgMTgwLCBrID09IDkgYW5kIDE4MCBvciAwKQoKICAgIGlmIGsgfj0gIm1hbnVhbCIgYW5kIGsgfj0gImxlaWd0IiB0aGVuCiAgICAgICAgbmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS55YXdhZGRsZWZ0ID0gdWkubmV3X3NsaWRlcih0YWIscGxhY2UsIGxpZ2h0X2JsdWUgLi4gbmV3X3N0cmVuZyAuLiB3aGl0ZSAuLiJ5YXcgbGVmdCBcbiIgLi4gdiwgLTE4MCwgMTgwLCAwKQogICAgICAgIG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0udGlja2VyX3NsaWRlciA9IHVpLm5ld19zbGlkZXIodGFiLHBsYWNlLCBsaWdodF9ibHVlIC4uIG5ld19zdHJlbmcgLi4gd2hpdGUgLi4idGlja3MgZGVsYXkgXG4iIC4uIHYsIDEsIDEwLCAxKQogICAgZW5kCiAgICBuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLnlhd2ppdHRlciA9IHVpLm5ld19jb21ib2JveCggdGFiLHBsYWNlLGxpZ2h0X2JsdWUgLi4gbmV3X3N0cmVuZyAuLiB3aGl0ZSAuLiJ5YXcgaml0dGVyXG4iIC4uIHYseyJvZmYiLCAib2Zmc2V0IiwgImNlbnRlciIsICJyYW5kb20iLCJza2l0dGVyIiwiaml0dGVyIHdheXMiLCJzd2F5IiwibCAmIHIifSkKICAgIG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0ueWF3aml0dGVyYWRkID0gdWkubmV3X3NsaWRlcih0YWIscGxhY2UsbGlnaHRfYmx1ZSAuLiBuZXdfc3RyZW5nIC4uIHdoaXRlIC4uICJ5YXcgaml0dGVyIiAsIC0xODAsIDE4MCwgMCkKICAgIG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0ueWF3aml0dGVyYWRkMiA9IHVpLm5ld19zbGlkZXIodGFiLHBsYWNlLCBsaWdodF9ibHVlIC4uIG5ld19zdHJlbmcgLi4gd2hpdGUgLi4ieWF3IGppdHRlciBsZWZ0IiwgLTE4MCwgMTgwLCAwKQogICAgbmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS5zd2F5bSA9IHVpLm5ld19zbGlkZXIodGFiLHBsYWNlLGxpZ2h0X2JsdWUgLi4gbmV3X3N0cmVuZyAuLiB3aGl0ZSAuLiAic3dheSBtaW5cbiIgLi4gdiwgLTE4MCwgMTgwLCAwKQogICAgbmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS5zd2F5bXggPSB1aS5uZXdfc2xpZGVyKHRhYixwbGFjZSxsaWdodF9ibHVlIC4uIG5ld19zdHJlbmcgLi4gd2hpdGUgLi4gInN3YXkgbWF4XG4iIC4uIHYsIC0xODAsIDE4MCwgMCkKICAgIG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0uc3dheXNwZWVkID0gdWkubmV3X3NsaWRlcih0YWIscGxhY2UsbGlnaHRfYmx1ZSAuLiBuZXdfc3RyZW5nIC4uIHdoaXRlIC4uICJzd2F5IHNwZWVkXG4iIC4uIHYsIDEsIDEwLDEpCiAgICBuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLnN3YXlfdmFsdWUgPSAwCiAgICBuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLnRvX3N3YXkgPSBmYWxzZQogICAgbmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS5nc19ib2R5eWF3ID0gdWkubmV3X2NvbWJvYm94KCB0YWIscGxhY2UsbGlnaHRfYmx1ZSAuLiBuZXdfc3RyZW5nIC4uIHdoaXRlIC4uImJvZHkgeWF3XG4iIC4uIHYseyJvZmYiLCJqaXR0ZXIiLCAic3RhdGljIiwiYW50aSBicnV0ZWZvcmNlIiwiYXV0byBqaXR0ZXIiLCJkZWxheWVkIHlhdyJ9KQogICAgbmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS5kZWxheWVkX21ldGhvZCA9IHVpLm5ld19jb21ib2JveCggdGFiLHBsYWNlLGxpZ2h0X2JsdWUgLi4gbmV3X3N0cmVuZyAuLiB3aGl0ZSAuLiJkZWxheWVkIG1ldGhvZFxuIiAuLiB2LHsic2ltcGxlIiwiYWR2YW5jZWQifSkKICAgIG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0uZ3NfYm9keXlhd2FkZCA9IHVpLm5ld19zbGlkZXIodGFiLHBsYWNlLCJcbiIgLi4gbGlnaHRfYmx1ZSAuLiBuZXdfc3RyZW5nIC4uIHdoaXRlIC4uICJib2R5IHlhd1xuIiAuLiB2LCAtMTgwLCAxODAsIDApCgogICAgbmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS5wZWRyb19hYXMyID0geyB1aS5uZXdfc2xpZGVyKHRhYixwbGFjZSwgbGlnaHRfYmx1ZSAuLiBuZXdfc3RyZW5nIC4uIHdoaXRlIC4uImppdHRlciB3YXkgMSBcbiIgLi4gaywgLTE4MCwgMTgwLCAwKSx1aS5uZXdfc2xpZGVyKHRhYixwbGFjZSwgImppdHRlciB3YXkgMlxuIiAuLiBrLCAtMTgwLCAxODAsIDApCiAgICAsdWkubmV3X3NsaWRlcih0YWIscGxhY2UsbGlnaHRfYmx1ZSAuLiBuZXdfc3RyZW5nIC4uIHdoaXRlIC4uICJqaXR0ZXIgd2F5IDMgXG4iLi4gaywgLTE4MCwgMTgwLCAwKSx1aS5uZXdfc2xpZGVyKHRhYixwbGFjZSxsaWdodF9ibHVlIC4uIG5ld19zdHJlbmcgLi4gd2hpdGUgLi4gImppdHRlciB3YXkgNCBcbiIgLi4gaywgLTE4MCwgMTgwLCAwKQogICAgLHVpLm5ld19zbGlkZXIodGFiLHBsYWNlLCBsaWdodF9ibHVlIC4uIG5ld19zdHJlbmcgLi4gd2hpdGUgLi4iaml0dGVyIHdheSA1IFxuIi4uIGssIC0xODAsIDE4MCwgMCksdWkubmV3X3NsaWRlcih0YWIscGxhY2UsbGlnaHRfYmx1ZSAuLiBuZXdfc3RyZW5nIC4uIHdoaXRlIC4uICJqaXR0ZXIgd2F5IDZcbiIgLi4gaywgLTE4MCwgMTgwLCAwKQogICAgLHVpLm5ld19zbGlkZXIodGFiLHBsYWNlLCBsaWdodF9ibHVlIC4uIG5ld19zdHJlbmcgLi4gd2hpdGUgLi4iaml0dGVyIHdheSA3IFxuIi4uIGssIC0xODAsIDE4MCwgMCksdWkubmV3X3NsaWRlcih0YWIscGxhY2UsbGlnaHRfYmx1ZSAuLiBuZXdfc3RyZW5nIC4uIHdoaXRlIC4uICJqaXR0ZXIgd2F5IDhcbiIgLi4gaywgLTE4MCwgMTgwLCAwKQogICAgLHVpLm5ld19zbGlkZXIodGFiLHBsYWNlLCBsaWdodF9ibHVlIC4uIG5ld19zdHJlbmcgLi4gd2hpdGUgLi4iaml0dGVyIHdheSA5IFxuIiAuLiBrLCAtMTgwLCAxODAsIDApLHVpLm5ld19zbGlkZXIodGFiLHBsYWNlLGxpZ2h0X2JsdWUgLi4gbmV3X3N0cmVuZyAuLiB3aGl0ZSAuLiAiaml0dGVyIHdheSAxMFxuIiAuLiBrLCAtMTgwLCAxODAsIDApLHVpLm5ld19zbGlkZXIodGFiLHBsYWNlLCAiaml0dGVyIHdheSAxMVxuIi4uIGssIC0xODAsIDE4MCwgMCkKICAgICx1aS5uZXdfc2xpZGVyKHRhYixwbGFjZSxsaWdodF9ibHVlIC4uIG5ld19zdHJlbmcgLi4gd2hpdGUgLi4gImppdHRlciB3YXkgMTJcbiIuLiBrLCAtMTgwLCAxODAsIDApfQoKICAgIGlmIGsgfj0gIm1hbnVhbCIgYW5kIGsgfj0gImZha2VsYWciIGFuZCBrIH49ICJMZWdpdCIgdGhlbgogICAgICAgIG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0uZW5hYmxlZF9leHBsb2l0ID0gdWkubmV3X2NoZWNrYm94KHRhYixwbGFjZSxsaWdodF9ibHVlIC4uIG5ld19zdHJlbmcgLi4gd2hpdGUgLi4iZW5hYmxlIGRlZmVuc2l2ZVxuICIgLi4gdikKICAgICAgICBuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLmVuYWJsZWRfZGVmZW5zaXZlX2ZvcmNlID0gdWkubmV3X2NoZWNrYm94KHRhYixwbGFjZSxsaWdodF9ibHVlIC4uIG5ld19zdHJlbmcgLi4gd2hpdGUgLi4iZm9yY2UgZGVmZW5zaXZlXG4gIiAuLiB2KQogICAgICAgIG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0ucGl0Y2hfZGVmZW5zaXZlID0gdWkubmV3X2NvbWJvYm94KHRhYixwbGFjZSxsaWdodF9ibHVlIC4uIG5ld19zdHJlbmcgLi4gd2hpdGUgLi4icGl0Y2ggZGVmZW5zaXZlXG4iIC4uIHYseyJvZmYiLCAidXAiLCAicmFuZG9tIiwiemVybyJ9KQogICAgICAgIG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0ueWF3X2RlZmVuc2l2ZSA9IHVpLm5ld19jb21ib2JveCh0YWIscGxhY2UsbGlnaHRfYmx1ZSAuLiBuZXdfc3RyZW5nIC4uIHdoaXRlIC4uInlhdyBkZWZlbnNpdmVcbiIgLi4gdix7Im9mZiIsICIxODAiLCAic3BpbiJ9KQogICAgICAgIG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0ueWF3YWRkX2RlZmVuc2l2ZSA9IHVpLm5ld19zbGlkZXIodGFiLHBsYWNlLGxpZ2h0X2JsdWUgLi4gbmV3X3N0cmVuZyAuLiB3aGl0ZSAuLiAiYWRkIGRlZmVuc2l2ZVxuIiAuLiB2LCAtMTgwLCAxODAsMCkKICAgICAgICBuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLnNraXR0ZXJfZGVmZW5zaXZlID0gdWkubmV3X2NoZWNrYm94KHRhYixwbGFjZSxsaWdodF9ibHVlIC4uIG5ld19zdHJlbmcgLi4gd2hpdGUgLi4ic2tpdHRlciBkZWZlbnNpdmVcbiAiIC4uIHYpCiAgICAgICAgbmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS5za2l0dGVyX3NsaWRlcl9kZWZlbnNpdmUgPSB1aS5uZXdfc2xpZGVyKHRhYixwbGFjZSxsaWdodF9ibHVlIC4uIG5ld19zdHJlbmcgLi4gd2hpdGUgLi4gInNraXR0ZXIgYWRkIGRlZmVuc2l2ZVxuIiAuLiB2LCAtMTgwLCAxODAsMCkKICAgIGVuZAoKICAgIGJydXRlX3N0YWdlLmJydXRlW3ZdLm1pc3NlZF9idWxsZXRzID0gMAplbmQKCmZvciBmID0gMSw0IGRvCiAgICBuZXdfbWVudV9yZWZlcmVuY2VzWyJicnV0ZWZvcmNlIl1bZl0gPSB1aS5uZXdfc2xpZGVyKHRhYixwbGFjZSwgImJydXRlZm9yY2Ugc3RhZ2UgIiAuLiBmIC4uICJcbiIgLi4gZiwgLTE4MCwgMTgwLCAwKQplbmQKCmxvY2FsIGppdHRlcl9hZGQgPSB1aS5uZXdfYnV0dG9uKHRhYixwbGFjZSwiYWRkIGppdHRlciIsZnVuY3Rpb24oKQogICAgbG9jYWwgZ2V0X3ZhbHVlID0gbmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZV9tZW51KV0uandheV9jb3VudGVyCiAgICBsb2NhbCBuaWdnYSA9IHVpLmdldChnZXRfdmFsdWUpCgogICAgaWYgbmlnZ2EgPj0gMTIgdGhlbgogICAgICAgIHByaW50KCJDYW4ndCBnbyBvdmVyIDEyIGppdHRlciBhbmdsZXMiKQogICAgICAgIHJldHVybiAKICAgIGVuZAoKICAgIHVpLnNldChnZXRfdmFsdWUsbmlnZ2EgKyAxKQplbmQpCgpsb2NhbCBqaXR0ZXJfcmVtb3ZlID0gdWkubmV3X2J1dHRvbih0YWIscGxhY2UsInJlbW92ZSBqaXR0ZXIiLGZ1bmN0aW9uKCkKICAgIGxvY2FsIGdldF92YWx1ZSA9IG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVfbWVudSldLmp3YXlfY291bnRlcgogICAgbG9jYWwgbmlnZ2EgPSB1aS5nZXQoZ2V0X3ZhbHVlKQoKICAgIGlmIG5pZ2dhIDw9IDIgdGhlbgogICAgICAgIHByaW50KCJDYW4ndCBnbyBsb3dlciB0aGFuIDIgaml0dGVyIGFuZ2xlcyIpCiAgICAgICAgcmV0dXJuIAogICAgZW5kCgogICAgdWkuc2V0KGdldF92YWx1ZSxuaWdnYSAtIDEpCmVuZCkKCmxvY2FsIGZ1bmN0aW9uIGdldF92ZWxvY2l0eShwbGF5ZXIpCiAgICBsb2NhbCB4LCB5LCB6ID0gZW50aXR5LmdldF9wcm9wKHBsYXllciwgIm1fdmVjVmVsb2NpdHkiKQogICAgaWYgeCA9PSBuaWwgdGhlbgogICAgICAgIHJldHVybgogICAgZW5kCiAgICByZXR1cm4gbWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkgKyB6ICogeikKZW5kCgpsb2NhbCBmdW5jdGlvbiBjbGFtcCh2YWx1ZSwgbWluVmFsLCBtYXhWYWwpCiAgICByZXR1cm4gbWF0aC5tYXgobWluVmFsLCBtYXRoLm1pbih2YWx1ZSwgbWF4VmFsKSkKZW5kCgoKCmxvY2FsIHByZXZfc2ltdWxhdGlvbl90aW1lID0gMApmdW5jdGlvbiBhYV9mdW5jdGlvbnM6c2ltX2RpZmYoKSAKICAgIGxvY2FsIGN1cnJlbnRfc2ltdWxhdGlvbl90aW1lID0gbWF0aC5mbG9vcigwLjUgKyAoZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX2ZsU2ltdWxhdGlvblRpbWUiKSAvIGdsb2JhbHMudGlja2ludGVydmFsKCkpKSAKICAgIGxvY2FsIGRpZmYgPSBjdXJyZW50X3NpbXVsYXRpb25fdGltZSAtIHByZXZfc2ltdWxhdGlvbl90aW1lCiAgICBwcmV2X3NpbXVsYXRpb25fdGltZSA9IGN1cnJlbnRfc2ltdWxhdGlvbl90aW1lCiAgICByZXR1cm4gZGlmZgplbmQKCmxvY2FsIHRpY2sgPSAwCmxvY2FsIHRpY2tlciA9IDAKbG9jYWwgbGVycF9hbHBoYSA9IDAKZnVuY3Rpb24gdmlzdWFsX2Z1bmN0aW9uczpkZWZlbnNpdmVfaW5kaWNhdG9yKCkKCiAgICB2aXN1YWxfZnVuY3Rpb25zLnRpY2tzID0gYWFfZnVuY3Rpb25zLnNpbV9kaWZmKCkKICAgIGlmIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uZW5hYmxlX2RlZmVuc2l2ZV9pbmRpY2F0b3IpIHRoZW4KCiAgICAgICAgbG9jYWwgdyxoID0gY2xpZW50LnNjcmVlbl9zaXplKCkKICAgICAgICAKICAgIAogICAgICAgIGxvY2FsIGRlZmVuc2l2ZSA9IHt1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sidmlzdWFscyJdLmluZGljYXRvcl9kZWZlbnNpdmVfY29sb3IpfQogICAgICAgIGlmIHZpc3VhbF9mdW5jdGlvbnMudGlja3MgPCAwIGFuZCB1aS5nZXQobWVudV9yZWZlcmVuY2UuZHRbMV0pIGFuZCB1aS5nZXQobWVudV9yZWZlcmVuY2UuZHRbMl0pIGFuZCBub3QgdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLmZha2VkdWNrKSB0aGVuCiAgICAgICAgICAgIHRpY2sgPSBnbG9iYWxzLnRpY2tjb3VudCgpCiAgICAgICAgICAgIHZpc3VhbF9mdW5jdGlvbnMuZGVmZW5zaXZlX3JlYWR5ID0gdHJ1ZQogICAgICAgICAgICB0aWNrZXIgPSAwCiAgICAgICAgICAgIGxlcnBfYWxwaGEgPSAyNTUKICAgICAgICBlbmQKICAgIAogICAgICAgIGlmIHZpc3VhbF9mdW5jdGlvbnMuZGVmZW5zaXZlX3JlYWR5ID09IHRydWUgdGhlbgogICAgCiAgICAgICAgICAgIGxvY2FsIGV4cGFuZCA9IHZpc3VhbF9mdW5jdGlvbnMuaXNfZGVmZW5zaXZlIGFuZCA5OCBvciB0aWNrZXIgKiA5OCAvIDE3NQogICAgCiAgICAgICAgICAgIHJlbmRlcmVyLnRleHQodyAvIDIgLCB2aXN1YWxfZnVuY3Rpb25zLmlzX2RlZmVuc2l2ZSBhbmQgaCAvIDIgICogMC41IC0gMjAgb3IgaCAvIDIgICogMC41IC0gMTAgLDI1NSwyNTUsMjU1LGxlcnBfYWxwaGEsImMiLDAsdmlzdWFsX2Z1bmN0aW9ucy5pc19kZWZlbnNpdmUgYW5kICJkZWZlbnNpdmUiIG9yICItIGRlZmVuc2l2ZSAtIikKICAgICAgICAgICAgaWYgdmlzdWFsX2Z1bmN0aW9ucy5pc19kZWZlbnNpdmUgdGhlbgogICAgICAgICAgICAgICAgcmVuZGVyZXIudGV4dCh3IC8gMiAsIGggLyAyICAqIDAuNSAtIDEwICwyNTUsMjU1LDI1NSxsZXJwX2FscGhhLCJjKyIsMCwi4oieIikKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHJlbmRlcmVyLnJlY3RhbmdsZSh3IC8gMiAtIDUwLCBoIC8gMiAgKiAwLjUsIDEwMCwgNCwgMTIsIDEyLCAxMixsZXJwX2FscGhhIDw9IDE1MCBhbmQgbGVycF9hbHBoYSBvciAxNTApCiAgICAgICAgICAgIHJlbmRlcmVyLnJlY3RhbmdsZSh3IC8gMiAtIDQ5LCBoIC8gMiAgKiAwLjUgKyAxLGV4cGFuZCwyLGRlZmVuc2l2ZVsxXSxkZWZlbnNpdmVbMl0sZGVmZW5zaXZlWzNdLGxlcnBfYWxwaGEpCiAgICAKICAgICAgICAgICAKCiAgICAgICAgICAgIGlmIHRpY2tlciA+IDE1NSB0aGVuIAogICAgICAgICAgICAgICAgbGVycF9hbHBoYSA9IGxlcnAobGVycF9hbHBoYSwwLGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAzMCkKCiAgICAgICAgICAgICAgICBpZiBsZXJwX2FscGhhIDwgMjAgdGhlbgogICAgICAgICAgICAgICAgICAgIHZpc3VhbF9mdW5jdGlvbnMuZGVmZW5zaXZlX3JlYWR5ID0gZmFsc2UKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgdGlja2VyID0gdGlja2VyICsgMQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKZnVuY3Rpb24gdmlzdWFsX2Z1bmN0aW9uczpzbG93X2luZGljYXRvcigpCgogICAgaWYgbm90IHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uc2xvd19pbmRpY2F0b3IpIHRoZW4gcmV0dXJuIGVuZAoKICAgIGxvY2FsIE5PVklOSEFfUVVFSVNTTyA9IGVudGl0eS5nZXRfcHJvcChlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCJtX2ZsVmVsb2NpdHlNb2RpZmllciIpICogMTAwCgogICAgaWYgTk9WSU5IQV9RVUVJU1NPIDwgMTAwIHRoZW4KCiAgICAgICAgbG9jYWwgc2l6ZXIgPSB2ZWN0b3IoY2xpZW50LnNjcmVlbl9zaXplKCkpCiAgICAKICAgICAgICBsb2NhbCBzaXplX2JhciA9IE5PVklOSEFfUVVFSVNTTyAqIDk4IC8gMTAwCgogICAgICAgIGxvY2FsIGRlZmVuc2l2ZSA9IHt1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sidmlzdWFscyJdLmluZGljYXRvcl9zbG93X2NvbG9yKX0KICAgICAgICAKICAgICAgICByZW5kZXJlci50ZXh0KHNpemVyLnggLzIsc2l6ZXIueS8yLSAyNDAsMjMwLDIzMCwyMzAsMjU1LCJjIixuaWwsc3RyaW5nLmZvcm1hdCgic2xvd2VkIGJ5ICVzIixtYXRoLmZsb29yKDEwMCAtIE5PVklOSEFfUVVFSVNTTykpIC4uICIlIikKICAgICAgICByZW5kZXJlci5yZWN0YW5nbGUoc2l6ZXIueCAvIDIgLSA1MCxzaXplci55LzIgLSAyMzIsMTAwLDQsMTIsMTIsMTIsMTgwKQogICAgICAgIHJlbmRlcmVyLnJlY3RhbmdsZShzaXplci54IC8gMi00OSxzaXplci55LzIgLSAyMzEsc2l6ZV9iYXIsMixkZWZlbnNpdmVbMV0sZGVmZW5zaXZlWzJdLGRlZmVuc2l2ZVszXSxkZWZlbnNpdmVbNF0pCiAgICAKICAgIGVuZAplbmQKCmZ1bmN0aW9uIGFhX2Z1bmN0aW9uczptYW51YWxfYW50aV9haW0oKQogICAgaWYgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbIk1hbnVhbCJdLmVuYWJsZWQpIHRoZW4KICAgICAgICAKICAgICAgICB1aS5zZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVsiTWFudWFsIl0ueWF3LCIxODAiKQogICAgICAgIGlmIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJrZXlzIl0ubWFudWFsX3JpZ2h0KSBhbmQgYWEubGFzdF9wcmVzc2VkICsgMC4yIDwgZ2xvYmFscy5jdXJ0aW1lKCkgdGhlbgogICAgICAgICAgICBhYS5tYW51YWxfc3RhdGUgPSBhYS5tYW51YWxfc3RhdGUgPT0gInJpZ2h0IiBhbmQgInJlc2V0IiBvciAicmlnaHQiCiAgICAgICAgICAgIGFhLmxhc3RfcHJlc3NlZCA9IGdsb2JhbHMuY3VydGltZSgpCiAgICAgICAgZWxzZWlmIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJrZXlzIl0ubWFudWFsX2xlZnQpIGFuZCBhYS5sYXN0X3ByZXNzZWQgKyAwLjIgPCBnbG9iYWxzLmN1cnRpbWUoKSB0aGVuCiAgICAgICAgICAgIGFhLm1hbnVhbF9zdGF0ZSA9IGFhLm1hbnVhbF9zdGF0ZSA9PSAibGVmdCIgYW5kICJyZXNldCIgb3IgImxlZnQiCiAgICAgICAgICAgIGFhLmxhc3RfcHJlc3NlZCA9IGdsb2JhbHMuY3VydGltZSgpCiAgICAgICAgZWxzZWlmIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJrZXlzIl0ubWFudWFsX2ZvcndhcmQpIGFuZCBhYS5sYXN0X3ByZXNzZWQgKyAwLjIgPCBnbG9iYWxzLmN1cnRpbWUoKSB0aGVuCiAgICAgICAgICAgIGFhLm1hbnVhbF9zdGF0ZSA9IGFhLm1hbnVhbF9zdGF0ZSA9PSAiZm9yd2FyZCIgYW5kICJyZXNldCIgb3IgImZvcndhcmQiCiAgICAgICAgICAgIGFhLmxhc3RfcHJlc3NlZCA9IGdsb2JhbHMuY3VydGltZSgpCiAgICAgICAgZWxzZWlmIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJrZXlzIl0ubWFudWFsX3Jlc2V0KSBhbmQgYWEubGFzdF9wcmVzc2VkICsgMC4yIDwgZ2xvYmFscy5jdXJ0aW1lKCkgdGhlbgogICAgICAgICAgICBhYS5tYW51YWxfc3RhdGUgPSAicmVzZXQiCiAgICAgICAgICAgIGFhLmxhc3RfcHJlc3NlZCA9IGdsb2JhbHMuY3VydGltZSgpCiAgICAgICAgZWxzZWlmIGFhLmxhc3RfcHJlc3NlZCA+IGdsb2JhbHMuY3VydGltZSgpIHRoZW4KICAgICAgICAgICAgYWEubGFzdF9wcmVzc2VkID0gZ2xvYmFscy5jdXJ0aW1lKCkKICAgICAgICBlbmQKICAgIAogICAgICAgIGlmIGFhLm1hbnVhbF9zdGF0ZSB+PSAicmVzZXQiIHRoZW4KICAgICAgICAgICAgdWkuc2V0KG1lbnVfcmVmZXJlbmNlLnlhd2Jhc2UsIkF0IHRhcmdldHMiKQogICAgICAgIGVuZAoKICAgICAgICBpZiBhYS5tYW51YWxfc3RhdGUgPT0gInJpZ2h0IiB0aGVuCiAgICAgICAgICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS55YXdbMV0sIjE4MCIpCiAgICAgICAgICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS55YXdbMl0sOTApCiAgICAgICAgZWxzZWlmIGFhLm1hbnVhbF9zdGF0ZSA9PSAibGVmdCIgdGhlbgogICAgICAgICAgICB1aS5zZXQobWVudV9yZWZlcmVuY2UueWF3WzFdLCIxODAiKQogICAgICAgICAgICB1aS5zZXQobWVudV9yZWZlcmVuY2UueWF3WzJdLC05MCkKICAgICAgICBlbHNlaWYgYWEubWFudWFsX3N0YXRlID09ICJmb3J3YXJkIiB0aGVuCiAgICAgICAgICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS55YXdbMV0sIjE4MCIpCiAgICAgICAgICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS55YXdbMl0sLTE4MCkKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmZ1bmN0aW9uIGFhX2Z1bmN0aW9ucy5hbnRpX2JydXRlX2J1bGxldF9pbXBhY3QoZXZlbnQpCgogICAgbG9jYWwgbWUgPSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpCgoJaWYgbm90IGVudGl0eS5pc19hbGl2ZShtZSkgdGhlbiByZXR1cm4gZW5kCgogICAgaWYgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0uZ3NfYm9keXlhdyApIH49ICJhbnRpIGJydXRlZm9yY2UiIHRoZW4gcmV0dXJuIGVuZAoKICAgIGlmIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW2FhX2Z1bmN0aW9ucy5hYV9udW1iZXJdLnlhdykgPT0gImwgJiByIiBvciB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS55YXcpID09ICJkZWxheWVkIiBvciB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS55YXcpID09ICJqaXR0ZXJ5IiB0aGVuCiAgICAgICAgcmV0dXJuCiAgICBlbmQKCglsb2NhbCBzaG9vdGVyX2lkID0gZXZlbnQudXNlcmlkCglsb2NhbCBzaG9vdGVyID0gY2xpZW50LnVzZXJpZF90b19lbnRpbmRleChzaG9vdGVyX2lkKQoKCWlmIG5vdCBlbnRpdHkuaXNfZW5lbXkoc2hvb3Rlcikgb3IgZW50aXR5LmlzX2Rvcm1hbnQoc2hvb3RlcikgdGhlbiByZXR1cm4gZW5kCgoJbG9jYWwgbHgsIGx5LCBseiA9IGVudGl0eS5oaXRib3hfcG9zaXRpb24obWUsICJoZWFkXzAiKQoJCglsb2NhbCBveCwgb3ksIG96ID0gZW50aXR5LmdldF9wcm9wKG1lLCAibV92ZWNPcmlnaW4iKQoJbG9jYWwgZXgsIGV5LCBleiA9IGVudGl0eS5nZXRfcHJvcChzaG9vdGVyLCAibV92ZWNPcmlnaW4iKQoKCWxvY2FsIGRpc3QgPSAoKGV2ZW50LnkgLSBleSkqbHggLSAoZXZlbnQueCAtIGV4KSpseSArIGV2ZW50LngqZXkgLSBldmVudC55KmV4KSAvIG1hdGguc3FydCgoZXZlbnQueS1leSleMiArIChldmVudC54IC0gZXgpXjIpCiAgICAKCQoJaWYgbWF0aC5hYnMoZGlzdCkgPD0gMzUgYW5kIGdsb2JhbHMuY3VydGltZSgpIC0gYnJ1dGVfc3RhZ2UubGFzdF9taXNzID4gMC4wMTUgdGhlbgogICAgICAgIGJydXRlX3N0YWdlLmxhc3RfbWlzcyA9IGdsb2JhbHMuY3VydGltZSgpCgogICAgICAgIAogICAgICAgIGJydXRlX3N0YWdlLmJydXRlW2FhX2Z1bmN0aW9ucy5hYV9udW1iZXJdLm1pc3NlZF9idWxsZXRzID0gYnJ1dGVfc3RhZ2UuYnJ1dGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0ubWlzc2VkX2J1bGxldHMgKyAxCgogICAgICAgIGlmICBicnV0ZV9zdGFnZS5icnV0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS5taXNzZWRfYnVsbGV0cyA+PSA1IHRoZW4gCiAgICAgICAgICAgIGJydXRlX3N0YWdlLmJydXRlW2FhX2Z1bmN0aW9ucy5hYV9udW1iZXJdLm1pc3NlZF9idWxsZXRzID0gMQogICAgICAgICAgICBwcmludCgiQmFjayB0byBzdGFnZSAxIHwgU3RhZ2VzIHdlcmUgc3VwZXJpb3IgdGhhbiA0IikKICAgICAgICBlbmQKICAgICAgICBwcmludCgiYW50aS1icnV0ZWZvcmNlIFsiIC4uIGFhX2Z1bmN0aW9ucy5hYV9udW1iZXIgLi4gICJdIHN0YWdlOiIgLi4gYnJ1dGVfc3RhZ2UuYnJ1dGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0ubWlzc2VkX2J1bGxldHMpCgogICAgZW5kCiAgICAKZW5kCgpmdW5jdGlvbiBhYV9mdW5jdGlvbnM6YW50aV9icnV0ZV9hbnRpX2FpbSgpCgogICAgaWYgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0uZ3NfYm9keXlhdykgfj0gImFudGkgYnJ1dGVmb3JjZSIgdGhlbiByZXR1cm4gZW5kCgogICAgaWYgbm90IGVudGl0eS5pc19hbGl2ZShlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpKSB0aGVuIHJldHVybiBlbmQKCiAgICBpZiBicnV0ZV9zdGFnZS5icnV0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS5taXNzZWRfYnVsbGV0cyA+PSAxIHRoZW4KCiAgICAgICAgaWYgIGJydXRlX3N0YWdlLmJydXRlW2FhX2Z1bmN0aW9ucy5hYV9udW1iZXJdLm1pc3NlZF9idWxsZXRzID09IDEgdGhlbgogICAgICAgICAgICB1aS5zZXQobWVudV9yZWZlcmVuY2UuYm9keXlhd1sxXSwiU3RhdGljIikKICAgICAgICAgICAgdWkuc2V0KG1lbnVfcmVmZXJlbmNlLmJvZHl5YXdbMl0sdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImJydXRlZm9yY2UiXVsxXSkpCiAgICAgICAgZWxzZWlmICBicnV0ZV9zdGFnZS5icnV0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS5taXNzZWRfYnVsbGV0cyA9PSAyIHRoZW4KICAgICAgICAgICAgdWkuc2V0KG1lbnVfcmVmZXJlbmNlLmJvZHl5YXdbMV0sIlN0YXRpYyIpCiAgICAgICAgICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS5ib2R5eWF3WzJdLHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJicnV0ZWZvcmNlIl1bMl0pKQogICAgICAgIGVsc2VpZiAgYnJ1dGVfc3RhZ2UuYnJ1dGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0ubWlzc2VkX2J1bGxldHMgPT0gMyB0aGVuCiAgICAgICAgICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS5ib2R5eWF3WzFdLCJTdGF0aWMiKQogICAgICAgICAgICB1aS5zZXQobWVudV9yZWZlcmVuY2UuYm9keXlhd1syXSx1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYnJ1dGVmb3JjZSJdWzNdKSkKICAgICAgICBlbHNlaWYgIGJydXRlX3N0YWdlLmJydXRlW2FhX2Z1bmN0aW9ucy5hYV9udW1iZXJdLm1pc3NlZF9idWxsZXRzID09IDQgdGhlbgogICAgICAgICAgICB1aS5zZXQobWVudV9yZWZlcmVuY2UuYm9keXlhd1sxXSwiU3RhdGljIikKICAgICAgICAgICAgdWkuc2V0KG1lbnVfcmVmZXJlbmNlLmJvZHl5YXdbMl0sdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImJydXRlZm9yY2UiXVs0XSkpCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgdWkuc2V0KG1lbnVfcmVmZXJlbmNlLmJvZHl5YXdbMV0sIkppdHRlciIpCiAgICAgICAgdWkuc2V0KG1lbnVfcmVmZXJlbmNlLmJvZHl5YXdbMl0sMSkKICAgIGVuZAoKZW5kCgpmdW5jdGlvbiBhYV9mdW5jdGlvbnM6YW50aV9rbmlmZSgpCgogICAgaWYgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYW50aV9rbml2KXRoZW4KICAgICAgICBsb2NhbCBwbGF5ZXJzID0gZW50aXR5LmdldF9wbGF5ZXJzKHRydWUpCiAgICAgICAgbG9jYWwgb3BvcyA9IHZlY3RvcihlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSwgIm1fdmVjT3JpZ2luIikpCiAgICAgICAgbG9jYWwgeWF3LCB5YXdfc2xpZGVyID0gdWkucmVmZXJlbmNlKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiWWF3IikKICAgICAgICBsb2NhbCBwaXRjaCA9IHVpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIlBpdGNoIikKCiAgICAgICAgZm9yIGkgPSAxLCAjcGxheWVycyBkbwogICAgICAgICAgICBsb2NhbCBwbHBvcyA9IHZlY3RvcihlbnRpdHkuZ2V0X3Byb3AocGxheWVyc1tpXSwgIm1fdmVjT3JpZ2luIikpCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCB3ZWFwb24gPSBlbnRpdHkuZ2V0X3BsYXllcl93ZWFwb24ocGxheWVyc1tpXSkKCiAgICAgICAgICAgIGlmIGVudGl0eS5nZXRfY2xhc3NuYW1lKHdlYXBvbikgPT0gIkNLbmlmZSIgYW5kIG9wb3M6ZGlzdChwbHBvcykgPCAyMDAgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgZXllcG9zID0gdmVjdG9yKGNsaWVudC5leWVfcG9zaXRpb24oKSkKICAgICAgICAgICAgICAgIGxvY2FsIGh4cGwgPSB2ZWN0b3IoZW50aXR5LmhpdGJveF9wb3NpdGlvbihwbGF5ZXJzW2ldLDQpKQogICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgZnJhY3Rpb24sIGVudGluZGV4X2hpdCA9IGNsaWVudC50cmFjZV9saW5lKHBsYXllcnNbaV0sIGh4cGwueCwgaHhwbC55LCBoeHBsLnosZXllcG9zLngsZXllcG9zLnksIGV5ZXBvcy56KQoKICAgICAgICAgICAgICAgIGlmIGVudGluZGV4X2hpdCA9PSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpIG9yIGZyYWN0aW9uID09IDEgdGhlbgogICAgICAgICAgICAgICAgICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS55YXdiYXNlLCJBdCB0YXJnZXRzIikKICAgICAgICAgICAgICAgICAgICB1aS5zZXQobWVudV9yZWZlcmVuY2UueWF3WzFdLCIxODAiKQogICAgICAgICAgICAgICAgICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS55YXdbMl0sMTgwKQogICAgICAgICAgICAgICAgICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS55YXdqaXR0ZXJbMV0sIk9mZiIpCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KG1lbnVfcmVmZXJlbmNlLnlhd2ppdHRlclsyXSw2MCkKICAgICAgICAgICAgICAgICAgICB1aS5zZXQobWVudV9yZWZlcmVuY2UuYm9keXlhd1sxXSwiaml0dGVyIikKICAgICAgICAgICAgICAgICAgICB1aS5zZXQobWVudV9yZWZlcmVuY2UuYm9keXlhd1syXSwwKQogICAgICAgICAgICAgICAgICAgIHVpLnNldChwaXRjaCwgIkRlZmF1bHQiKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAoKCmZ1bmN0aW9uIGFhX2Z1bmN0aW9uczpsZWdpdF9hYShjbWQpCgogICAgaWYgbm90IHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlWyJMZWdpdCJdLmVuYWJsZWQpIHRoZW4gcmV0dXJuIGVuZAoKICAgIGxvY2FsIGluX3VzZSA9IGNtZC5pbl91c2UgPT0gMQogICAgbG9jYWwgaW5fYm9tYnNpdGUgPSBlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSwgIm1fYkluQm9tYlpvbmUiKSA+IDAKICAgIGxvY2FsIG5UZWFtID0gZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX2lUZWFtTnVtIikKICAgIGx4LGx5LGx6ID0gZW50aXR5LmdldF9vcmlnaW4oZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkKICAgIHVpLnNldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlWyJMZWdpdCJdLnlhdywiMTgwIikKCiAgICBsb2NhbCBmcm9tID0gdmVjdG9yKGNsaWVudC5leWVfcG9zaXRpb24oKSkKCWxvY2FsIHRvID0gZnJvbSArIHZlY3RvcigpOmluaXRfZnJvbV9hbmdsZXMoY2xpZW50LmNhbWVyYV9hbmdsZXMoKSkgKiAxMDI0CgogICAgbG9jYWwgdHIgPSB0cmFjZS5saW5lKGZyb20sIHRvLCB7IHNraXAgPSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCBtYXNrID0gIk1BU0tfU0hPVCIgfSkKCiAgICBsb2NhbCBsb2NhbF9wb3MgPSB2ZWN0b3IoZW50aXR5LmdldF9vcmlnaW4oZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkpCgogICAgaWYgdHIuZnJhY3Rpb24gPj0gMSB0aGVuCiAgICAgICAgdHIuZW50aW5kZXggPSAwCiAgICBlbmQKICAgCiAgIGlmIGVudGl0eS5nZXRfY2xhc3NuYW1lKHRyLmVudGluZGV4KSB+PSAiQ1dvcmxkIiBhbmQgZW50aXR5LmdldF9jbGFzc25hbWUodHIuZW50aW5kZXgpIH49ICJDQ1NQbGF5ZXIiIGFuZCBlbnRpdHkuZ2V0X2NsYXNzbmFtZSh0ci5lbnRpbmRleCkgfj0gIkNGdW5jQnJ1c2giIGFuZCBlbnRpdHkuZ2V0X2NsYXNzbmFtZSh0ci5lbnRpbmRleCkgfj0gIkNCYXNlQnV0dG9uIiBhbmQgZW50aXR5LmdldF9jbGFzc25hbWUodHIuZW50aW5kZXgpIH49ICJDRHluYW1pY1Byb3AiIGFuZCBlbnRpdHkuZ2V0X2NsYXNzbmFtZSh0ci5lbnRpbmRleCkgfj0gIkNQaHlzaWNzUHJvcE11bHRpcGxheWVyIiBhbmQgZW50aXR5LmdldF9jbGFzc25hbWUodHIuZW50aW5kZXgpIH49ICJDQmFzZUVudGl0eSIgYW5kIGVudGl0eS5nZXRfY2xhc3NuYW1lKHRyLmVudGluZGV4KSB+PSAiQ0M0IiB0aGVuIAogICAgICAKICAgICAgICBsb2NhbCBub3Rfd2Vwd2VwID0gdmVjdG9yKGVudGl0eS5nZXRfb3JpZ2luKHRyLmVudGluZGV4KSkKCiAgICAgICAgaWYgZW50aXR5LmdldF9jbGFzc25hbWUodHIuZW50aW5kZXgpID09ICJDUHJvcERvb3JSb3RhdGluZyIgb3IgKGVudGl0eS5nZXRfY2xhc3NuYW1lKHRyLmVudGluZGV4KSA9PSAiQ0hvc3RhZ2UiIGFuZCBuVGVhbSA9PSAzKSB0aGVuCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBsb2NhbF9wb3M6ZGlzdChub3Rfd2Vwd2VwKSA8IDEyNSB0aGVuCgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgIGVuZAoKICAgICAgICBlbHNlaWYgZW50aXR5LmdldF9jbGFzc25hbWUodHIuZW50aW5kZXgpIH49ICJDUHJvcERvb3JSb3RhdGluZyIgYW5kIGVudGl0eS5nZXRfY2xhc3NuYW1lKHRyLmVudGluZGV4KSB+PSAiQ0hvc3RhZ2UiIHRoZW4KCiAgICAgICAgICAgIGlmIGxvY2FsX3BvczpkaXN0KG5vdF93ZXB3ZXApIDwgMjAwIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgZW5kCiAgCiAgICBsb2NhbCBib21iX3RhYmxlICAgID0gZW50aXR5LmdldF9hbGwoIkNQbGFudGVkQzQiKQogICAgbG9jYWwgYm9tYl9wbGFudGVkICA9ICNib21iX3RhYmxlID4gMAogICAgbG9jYWwgYm9tYl9kaXN0YW5jZSA9IDEwMAoKICAgIGlmIGJvbWJfcGxhbnRlZCB0aGVuCiAgICAgICAgbG9jYWwgYm9tYl9lbnRpdHkgPSBib21iX3RhYmxlWyNib21iX3RhYmxlXQogICAgICAgIGxvY2FsIGJvbWJfcG9zID0gdmVjdG9yKGVudGl0eS5nZXRfb3JpZ2luKGJvbWJfZW50aXR5KSkKICAgICAgICBib21iX2Rpc3RhbmNlID0gbG9jYWxfcG9zOmRpc3QoYm9tYl9wb3MpCiAgICBlbmQKCiAgICBsb2NhbCBkZWZ1c2luZyA9IGJvbWJfZGlzdGFuY2UgPCA1MCBhbmQgblRlYW0gPT0gMyBhbmQgYWFfZnVuY3Rpb25zLmJvbWJfd2FzX2JvbWJlZCA9PSBmYWxzZSBhbmQgYWFfZnVuY3Rpb25zLmJvbWJfd2FzX2RlZnVzZWQgPT0gZmFsc2UKCiAgICBpZiBkZWZ1c2luZyB0aGVuIHJldHVybiBmYWxzZSBlbmQKCiAgICBpZiBpbl91c2UgdGhlbgogICAgICAgIGNtZC5pbl91c2UgPSAwCiAgICAgICAgcmV0dXJuIHRydWUKICAgIGVuZAogICAgcmV0dXJuIGZhbHNlCmVuZAoKZnVuY3Rpb24gYWFfZnVuY3Rpb25zOnN0YXRpY19pbl9hZXJvcGhvYmljKGNtZCkKCiAgICBpZiBub3QgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uc2FmZV9kYW5nZXJvdXMpIHRoZW4gcmV0dXJuIGVuZAogICAgbG9jYWwgbG9jYWxfcGxheWVyID0gZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKQoKICAgIGlmIG5vdCBlbnRpdHkuaXNfYWxpdmUobG9jYWxfcGxheWVyKSB0aGVuIHJldHVybiBlbmQKICAgIGxvY2FsIG9uX2dyb3VuZCA9IGJpdC5iYW5kKGVudGl0eS5nZXRfcHJvcChsb2NhbF9wbGF5ZXIsICJtX2ZGbGFncyIpLCAxKSA9PSAxIGFuZCBjbWQuaW5fanVtcCA9PSAwCiAgICBsb2NhbCB3ZWFwb25fZW50ID0gZW50aXR5LmdldF9wbGF5ZXJfd2VhcG9uKGxvY2FsX3BsYXllcikKICAgIGlmIHdlYXBvbl9lbnQgPT0gbmlsIHRoZW4gcmV0dXJuIGVuZAoKICAgIGxvY2FsIHdlYXBvbl9pZHggPSBlbnRpdHkuZ2V0X3Byb3Aod2VhcG9uX2VudCwgIm1faUl0ZW1EZWZpbml0aW9uSW5kZXgiKQogICAgbG9jYWwgd2VhcG9uID0gY3Nnb193ZWFwb25zW3dlYXBvbl9pZHhdCiAgICBpZiB3ZWFwb25fZW50ID09IG5pbCB0aGVuIHJldHVybiBlbmQKCiAgICBpZiB3ZWFwb24udHlwZSA9PSAia25pZmUiIG9yIHdlYXBvbi50eXBlID09ICJ0YXNlciIgdGhlbgogICAgICAgIGlmIG5vdCBvbl9ncm91bmQgb3IgKG5vdCBvbl9ncm91bmQgYW5kIGNtZC5pbl9kdWNrID09IDEpIHRoZW4KCiAgICAgICAgICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS55YXdiYXNlLCJBdCB0YXJnZXRzIikKICAgICAgICAgICAgdWkuc2V0KG1lbnVfcmVmZXJlbmNlLnlhd1sxXSwiMTgwIikKICAgICAgICAgICAgdWkuc2V0KG1lbnVfcmVmZXJlbmNlLnlhd1syXSwwKQogICAgICAgICAgICB1aS5zZXQobWVudV9yZWZlcmVuY2UueWF3aml0dGVyWzFdLCJPZmYiKQogICAgICAgICAgICB1aS5zZXQobWVudV9yZWZlcmVuY2UueWF3aml0dGVyWzJdLDApCiAgICAgICAgICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS5ib2R5eWF3WzFdLCJTdGF0aWMiKQogICAgICAgICAgICB1aS5zZXQobWVudV9yZWZlcmVuY2UuYm9keXlhd1syXSwwKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKbG9jYWwgb2xkX2RlZl9zdGF0ZSA9ICJTdGFuZCIKZnVuY3Rpb24gYWFfZnVuY3Rpb25zOmRlZmVuc2l2ZV9zZXR1cChjbWQpCgogICAgaWYgbm90IHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW2FhX2Z1bmN0aW9ucy5hYV9udW1iZXJdLmVuYWJsZWQpIHRoZW4gcmV0dXJuIGVuZAoKICAgIHZpc3VhbF9mdW5jdGlvbnMuaXNfZGVmZW5zaXZlID0gZmFsc2UKCiAgICBhYV9mdW5jdGlvbnMub2xkX3dlYXBvbiA9ICBhYV9mdW5jdGlvbnMuYWN0dWFsX3dlYXBvbgogICAgYWFfZnVuY3Rpb25zLmFjdHVhbF93ZWFwb24gPSBlbnRpdHkuZ2V0X3BsYXllcl93ZWFwb24oZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkKICAgIAogICAgaWYgYWFfZnVuY3Rpb25zLm9sZF93ZWFwb24gfj0gYWFfZnVuY3Rpb25zLmFjdHVhbF93ZWFwb24gdGhlbgogICAgICAgIGFhX2Z1bmN0aW9ucy50b19zdGFydCA9IHRydWUKICAgIGVuZAogICAgCiAgICBpZiBlbnRpdHkuZ2V0X3BsYXllcl93ZWFwb24oZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkgfj0gYWFfZnVuY3Rpb25zLm9sZF93ZWFwb24gdGhlbgogICAgICAgIGFhX2Z1bmN0aW9ucy5hY3R1YWxfdGljayA9IDAKICAgICAgICBhYV9mdW5jdGlvbnMudG9fc3RhcnQgPSB0cnVlCiAgICBlbmQKICAgIAogICAgaWYgYWFfZnVuY3Rpb25zLnRvX3N0YXJ0ID09IHRydWUgYW5kIGFhX2Z1bmN0aW9ucy5hY3R1YWxfdGljayA8IDEwMCB0aGVuCiAgICAgICAgYWFfZnVuY3Rpb25zLmFjdHVhbF90aWNrID0gYWFfZnVuY3Rpb25zLmFjdHVhbF90aWNrICsgMQogICAgZWxzZWlmIGFhX2Z1bmN0aW9ucy5hY3R1YWxfdGljayA+PSAxMDAgdGhlbgogICAgICAgIGFhX2Z1bmN0aW9ucy5hY3R1YWxfdGljayA9IDAKICAgICAgICBhYV9mdW5jdGlvbnMudG9fc3RhcnQgPSBmYWxzZQogICAgZW5kCiAgICAKICAgIGFhX2Z1bmN0aW9ucy5vbGRfd2VhcG9uID0gZW50aXR5LmdldF9wbGF5ZXJfd2VhcG9uKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkpCgogICAgaWYgYWFfZnVuY3Rpb25zLmNhbl9kZWZlbnNpdmUgdGhlbgogICAgICAgIGlmIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW29sZF9kZWZfc3RhdGVdLmVuYWJsZWRfZXhwbG9pdCkgfj0gdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0uZW5hYmxlZF9leHBsb2l0KSB0aGVuCiAgICAgICAgICAgIGFhX2Z1bmN0aW9ucy5jYW5fZGVmZW5zaXZlID0gZmFsc2UKICAgICAgICBlbmQKICAgIGVuZAogICAgb2xkX2RlZl9zdGF0ZSA9IGFhX2Z1bmN0aW9ucy5hYV9udW1iZXIKCiAgICBpZiBhYV9mdW5jdGlvbnMuY2FuX2RlZmVuc2l2ZSAgdGhlbgogICAgICAgIGFhX2Z1bmN0aW9ucy5kZWZfdGlja3MgPSAyNwogICAgICAgIGFhX2Z1bmN0aW9ucy5jYW5fZGVmZW5zaXZlID0gZmFsc2UKICAgIGVuZAoKICAgICAgIGlmIGFhX2Z1bmN0aW9ucy5kZWZfdGlja3MgPiAwIHRoZW4KICAgICAgICAgIGFhX2Z1bmN0aW9ucy5kZWZfdGlja3MgPSBhYV9mdW5jdGlvbnMuZGVmX3RpY2tzIC0gMQogICAgICAgZWxzZQogICAgICAgICBhYV9mdW5jdGlvbnMuY2FuX2RlZmVuc2l2ZSA9IGZhbHNlCiAgICAgICBlbmQKCiAgICBpZiBhYV9mdW5jdGlvbnMudG9fc3RhcnQgPT0gdHJ1ZSB0aGVuIHJldHVybiBlbmQKCiAgICBpZiBhYV9mdW5jdGlvbnMuYWFfbnVtYmVyIH49ICJtYW51YWwiIGFuZCBhYV9mdW5jdGlvbnMuYWFfbnVtYmVyIH49ICJMZWdpdCIgYW5kIGFhX2Z1bmN0aW9ucy5hYV9udW1iZXIgfj0gImZha2VsYWciIHRoZW4KICAgICAgICBpZiB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS5lbmFibGVkX2V4cGxvaXQpIGFuZCAodWkuZ2V0KG1lbnVfcmVmZXJlbmNlLmR0WzFdKSBhbmQgdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLmR0WzJdKSBvciB1aS5nZXQobWVudV9yZWZlcmVuY2Uub3NbMV0pIGFuZCB1aS5nZXQobWVudV9yZWZlcmVuY2Uub3NbMl0pKSBhbmQgbm90IHVpLmdldChtZW51X3JlZmVyZW5jZS5mYWtlZHVjaykgIHRoZW4KICAgICAgICAgICAKICAgICAgICAgICAgaWYgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0uZW5hYmxlZF9kZWZlbnNpdmVfZm9yY2UpIHRoZW4gCiAgICAgICAgICAgICAgICBjbWQuZm9yY2VfZGVmZW5zaXZlID0gdHJ1ZQogICAgICAgICAgICBlbmQKICAgICAgICAgICBpZiBjbWQuZm9yY2VfZGVmZW5zaXZlID09IHRydWUgdGhlbiB2aXN1YWxfZnVuY3Rpb25zLmlzX2RlZmVuc2l2ZSA9IHRydWUgZW5kCgogICAgICAgICAgIGlmIGNtZC5mb3JjZV9kZWZlbnNpdmUgdGhlbgogICAgICAgICAgICAgICAgaWYgZ2xvYmFscy50aWNrY291bnQoKSAlIDEwIDw9IDIgdGhlbgogICAgICAgICAgICAgICAgICAgIGNtZC5mb3JjZV9kZWZlbnNpdmUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgZW5kCgogICAgICAgICAgIGlmIGFhX2Z1bmN0aW9ucy5kZWZfdGlja3MgPiAwIG9yIGNtZC5mb3JjZV9kZWZlbnNpdmUgPT0gdHJ1ZSB0aGVuIAogICAgICAgICAgICBpZiAgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0ucGl0Y2hfZGVmZW5zaXZlKSA9PSAiemVybyIgdGhlbgogICAgICAgICAgICAgICAgdWkuc2V0KG1lbnVfcmVmZXJlbmNlLnBpdGNoWzFdLCJPZmYiKQogICAgICAgICAgIGVsc2VpZiB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS5waXRjaF9kZWZlbnNpdmUpIH49ICJvZmYiIHRoZW4KICAgICAgICAgICAgICAgdWkuc2V0KG1lbnVfcmVmZXJlbmNlLnBpdGNoWzFdLHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW2FhX2Z1bmN0aW9ucy5hYV9udW1iZXJdLnBpdGNoX2RlZmVuc2l2ZSkpCiAgICAgICAgICAgZW5kCiAgICAgICAgICAgCiAgICAgICAgICAgaWYgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0ueWF3X2RlZmVuc2l2ZSkgfj0gIm9mZiIgdGhlbgogICAgICAgICAgICAgICB1aS5zZXQobWVudV9yZWZlcmVuY2UueWF3WzFdLHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW2FhX2Z1bmN0aW9ucy5hYV9udW1iZXJdLnlhd19kZWZlbnNpdmUpKQogICAgICAgICAgICAgICB1aS5zZXQobWVudV9yZWZlcmVuY2UueWF3WzJdLHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW2FhX2Z1bmN0aW9ucy5hYV9udW1iZXJdLnlhd2FkZF9kZWZlbnNpdmUpKQogICAgICAgICAgIGVuZAogICAKICAgICAgICAgICBpZiB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS5za2l0dGVyX2RlZmVuc2l2ZSkgdGhlbgogICAgICAgICAgICAgICB1aS5zZXQobWVudV9yZWZlcmVuY2UueWF3aml0dGVyWzFdLCJTa2l0dGVyIikKICAgICAgICAgICAgICAgdWkuc2V0KG1lbnVfcmVmZXJlbmNlLnlhd2ppdHRlclsyXSx1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS5za2l0dGVyX3NsaWRlcl9kZWZlbnNpdmUpKQogICAgICAgICAgIGVuZAogICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAoKbG9jYWwgUVVFSVNTTyA9IGZhbHNlCmxvY2FsIGN1cnJlbnRfdGlja2NvdW50ID0gMApsb2NhbCBzaWRlID0gbmlsCmxvY2FsIHNldHRpbmdfc2VjcmV0XzEgPSBuaWwKbG9jYWwgc2V0dGluZ19zZWNyZXRfMiA9IG5pbApmdW5jdGlvbiBhYV9mdW5jdGlvbnM6c2V0dXAoY21kKQoKICAgIGlmIG5vdCBlbnRpdHkuaXNfYWxpdmUoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkgdGhlbiByZXR1cm4gZW5kCgogICAgbG9jYWwgbHAgPSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpCiAgICBsb2NhbCBvbl9ncm91bmQgPSBiaXQuYmFuZChlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSwgIm1fZkZsYWdzIiksIDEpID09IDEgYW5kIGNtZC5pbl9qdW1wID09IDAKICAgIGxvY2FsIGlzX3Nsb3cgPSB1aS5nZXQobWVudV9yZWZlcmVuY2Uuc2xvd1sxXSkgYW5kIHVpLmdldChtZW51X3JlZmVyZW5jZS5zbG93WzJdKQoKICAgIGxvY2FsIGJvZHl5YXcgPSBlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSwgIm1fZmxQb3NlUGFyYW1ldGVyIiwgMTEpICogMTIwIC0gNjAKCiAgICBpZiB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVsiTGVnaXQiXS5lbmFibGVkKSBhbmQgYWFfZnVuY3Rpb25zOmxlZ2l0X2FhKGNtZCkgdGhlbgogICAgICAgIGFhX2Z1bmN0aW9ucy5hYV9udW1iZXIgPSAiTGVnaXQiCiAgICBlbHNlaWYgIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlWyJNYW51YWwiXS5lbmFibGVkKSBhbmQgYWEubWFudWFsX3N0YXRlIH49ICJyZXNldCIgdGhlbgogICAgICAgIGFhX2Z1bmN0aW9ucy5hYV9udW1iZXIgPSAiTWFudWFsIgogICAgZWxzZWlmICB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVsiRmFrZWxhZyJdLmVuYWJsZWQpIGFuZCBub3QgdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLmR0WzJdKSBhbmQgbm90IHVpLmdldChtZW51X3JlZmVyZW5jZS5vc1syXSkgdGhlbgogICAgICAgIGFhX2Z1bmN0aW9ucy5hYV9udW1iZXIgPSAiRmFrZWxhZyIKICAgIGVsc2VpZiBvbl9ncm91bmQgYW5kIGNtZC5pbl9kdWNrID09IDEgdGhlbgogICAgICAgIGFhX2Z1bmN0aW9ucy5hYV9udW1iZXIgPSAiRHVjayIKICAgIGVsc2VpZiBub3Qgb25fZ3JvdW5kIGFuZCBjbWQuaW5fZHVjayA9PSAxIHRoZW4KICAgICAgICBhYV9mdW5jdGlvbnMuYWFfbnVtYmVyID0gIkFpciBkdWNrIgogICAgZWxzZWlmIG5vdCBvbl9ncm91bmQgdGhlbgogICAgICAgIGFhX2Z1bmN0aW9ucy5hYV9udW1iZXIgPSAiSW4tQWlyIgogICAgZWxzZWlmIGlzX3Nsb3cgdGhlbgogICAgICAgIGFhX2Z1bmN0aW9ucy5hYV9udW1iZXIgPSAiU2xvdyIKICAgIGVsc2VpZiBvbl9ncm91bmQgYW5kIGdldF92ZWxvY2l0eShscCkgPCAzIHRoZW4KICAgICAgICBhYV9mdW5jdGlvbnMuYWFfbnVtYmVyID0gIlN0YW5kIgogICAgZWxzZWlmIG9uX2dyb3VuZCBhbmQgZ2V0X3ZlbG9jaXR5KGxwKSA+PSAzIHRoZW4KICAgICAgICBhYV9mdW5jdGlvbnMuYWFfbnVtYmVyID0gIldhbGsiCiAgICBlbmQKCiAgICBpZiBjbWQuY2hva2VkY29tbWFuZHMgPT0gMCB0aGVuCiAgICAgICAgc2lkZSA9IGJvZHl5YXcgPiAwIGFuZCB0cnVlIG9yIGZhbHNlCiAgICAgICAgCiAgICAgICAgaWYgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0ueWF3aml0dGVyKSA9PSAiaml0dGVyIHdheXMiIHRoZW4KICAgICAgIAogICAgICAgICAgICBhYV9mdW5jdGlvbnMuaml0dGVyX3dheV9udW1iZXIgPSBhYV9mdW5jdGlvbnMuaml0dGVyX3dheV9udW1iZXIgKyAxIAogICAgICAgIAogICAgICAgIAogICAgICAgICAgICBpZiBhYV9mdW5jdGlvbnMuaml0dGVyX3dheV9udW1iZXIgPiB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS5qd2F5X2NvdW50ZXIpIHRoZW4KICAgICAgICAgICAgICAgIGFhX2Z1bmN0aW9ucy5qaXR0ZXJfd2F5X251bWJlciA9IDEKICAgICAgICAgICAgZW5kCiAgICAgICAgZWxzZWlmIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW2FhX2Z1bmN0aW9ucy5hYV9udW1iZXJdLnlhd2ppdHRlcikgPT0gInN3YXkiIHRoZW4KICAgIAogICAgICAgICAgIAogICAgICAgICAgCiAgICAgICAgICAgICAgICB1aS5zZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS5zd2F5bSxtYXRoLm1pbih1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS5zd2F5bSksdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0uc3dheW14KSkpCiAgICAgICAgICAgICAgICBsb2NhbCBudW1iZXIgPSB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS5zd2F5c3BlZWQpIAogICAgICAgICAgICAgICAgbG9jYWwgbnVtYmVyX3RvX2FkZCA9IG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0udG9fc3dheSBhbmQgbnVtYmVyIG9yIC1udW1iZXIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS5zd2F5X3ZhbHVlID0gbmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS5zd2F5X3ZhbHVlICsgbnVtYmVyX3RvX2FkZAogICAgICAgICAgICAgICAgaWYgbmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS5zd2F5X3ZhbHVlIDwgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0uc3dheW0pIHRoZW4KICAgICAgICAgICAgICAgICAgICBuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW2FhX2Z1bmN0aW9ucy5hYV9udW1iZXJdLnN3YXlfdmFsdWUgPSB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS5zd2F5bSkKICAgICAgICAgICAgICAgIGVsc2VpZiBuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW2FhX2Z1bmN0aW9ucy5hYV9udW1iZXJdLnN3YXlfdmFsdWUgPiB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS5zd2F5bXgpIHRoZW4KICAgICAgICAgICAgICAgICAgICBuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW2FhX2Z1bmN0aW9ucy5hYV9udW1iZXJdLnN3YXlfdmFsdWUgPSB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS5zd2F5bXgpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgbmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS5zd2F5X3ZhbHVlID49IHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW2FhX2Z1bmN0aW9ucy5hYV9udW1iZXJdLnN3YXlteCkgYW5kIG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0udG9fc3dheSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0udG9fc3dheSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmIG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0uc3dheV92YWx1ZSA8PSB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS5zd2F5bSkgYW5kIG5vdCBuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW2FhX2Z1bmN0aW9ucy5hYV9udW1iZXJdLnRvX3N3YXkgIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS50b19zd2F5ID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCgoKCiAgICBpZiBhYV9mdW5jdGlvbnMuYWFfbnVtYmVyIH49ICJMZWdpdCIgYW5kIGFhX2Z1bmN0aW9ucy5hYV9udW1iZXIgfj0gIm1hbnVhbCIgdGhlbgogICAgICAgIGlmIGdsb2JhbHMudGlja2NvdW50KCkgPiBjdXJyZW50X3RpY2tjb3VudCArIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW2FhX2Z1bmN0aW9ucy5hYV9udW1iZXJdLnRpY2tlcl9zbGlkZXIpICB0aGVuCiAgICAgICAgICAgIGlmIGNtZC5jaG9rZWRjb21tYW5kcyA9PSAwIHRoZW4KICAgICAgICAgICAgICAgYWFfZnVuY3Rpb25zLnRvX2ppdHRlciA9IG5vdCBhYV9mdW5jdGlvbnMudG9faml0dGVyCiAgICAgICAgICAgICAgIGN1cnJlbnRfdGlja2NvdW50ID0gZ2xvYmFscy50aWNrY291bnQoKQogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlaWYgZ2xvYmFscy50aWNrY291bnQoKSA8ICBjdXJyZW50X3RpY2tjb3VudCB0aGVuCiAgICAgICAgICAgIGN1cnJlbnRfdGlja2NvdW50ID0gZ2xvYmFscy50aWNrY291bnQoKQogICAgICAgIGVuZAoKICAgIGVuZAogICAgCiAgICB1aS5zZXQobWVudV9yZWZlcmVuY2UuZW5hYmxlZCx1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS5lbmFibGVkKSkKICAKICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS5waXRjaFsxXSwgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0ucGl0Y2gpKQoKICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS5waXRjaFsyXSwgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0ucGl0Y2hfc2xpZGVyKSkKICAgICAgICAKICAgIAogICAgdWkuc2V0KG1lbnVfcmVmZXJlbmNlLnlhd2Jhc2UsIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW2FhX2Z1bmN0aW9ucy5hYV9udW1iZXJdLnlhd2Jhc2UpKQoKICAgIGlmIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW2FhX2Z1bmN0aW9ucy5hYV9udW1iZXJdLnlhdykgPT0gImppdHRlcnkiIHRoZW4KICAgICAgICB1aS5zZXQobWVudV9yZWZlcmVuY2UueWF3WzFdLCAiMTgwIikKICAgICAgICBpZiBjbWQuY2hva2VkY29tbWFuZHMgPT0gMCB0aGVuCiAgICAgICAgICAgIGFhX2Z1bmN0aW9ucy5yYW5kb21fZXh0cmFwb2xhdGVkID0gY2xpZW50LnJhbmRvbV9pbnQoMCwxKSA9PSAxCiAgICAgICAgICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS55YXdbMl0sICBhYV9mdW5jdGlvbnMucmFuZG9tX2V4dHJhcG9sYXRlZCBhbmQgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0ueWF3YWRkbGVmdCkgb3IgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0ueWF3YWRkKSkKICAgICAgICBlbmQKICAgICAgICBlbHNlaWYgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0ueWF3KSA9PSAiZGVsYXllZCIgdGhlbgoKICAgICAgICB1aS5zZXQobWVudV9yZWZlcmVuY2UueWF3WzFdLCAiMTgwIikKICAgICAgICBpZiBjbWQuY2hva2VkY29tbWFuZHMgPT0gMCB0aGVuCiAgICAgICAgICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS55YXdbMl0sICBhYV9mdW5jdGlvbnMudG9faml0dGVyIGFuZCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS55YXdhZGRsZWZ0KSBvciB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS55YXdhZGQpKQogICAgICAgIGVuZAogICAgICAgIGVsc2VpZiB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS55YXcpID09ICJsICYgciIgdGhlbgogICAgICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS55YXdbMV0sICIxODAiKQogICAgICAgIGlmIGNtZC5jaG9rZWRjb21tYW5kcyA9PSAwIHRoZW4KICAgICAgICAgICAgaWYgc2lkZSB+PSBuaWwgdGhlbiAKICAgICAgICAgICAgICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS55YXdbMl0sIHNpZGUgYW5kIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW2FhX2Z1bmN0aW9ucy5hYV9udW1iZXJdLnlhd2FkZGxlZnQpIG9yIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW2FhX2Z1bmN0aW9ucy5hYV9udW1iZXJdLnlhd2FkZCkpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgCiAgICBlbHNlCiAgICAgICAgdWkuc2V0KG1lbnVfcmVmZXJlbmNlLnlhd1sxXSwgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0ueWF3KSkKICAgICAgICB1aS5zZXQobWVudV9yZWZlcmVuY2UueWF3WzJdLCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS55YXdhZGQpKQogICAgZW5kCgogICAgaWYgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0ueWF3aml0dGVyKSA9PSAiaml0dGVyIHdheXMiIHRoZW4KICAgICAgICAKICAgICAgICB1aS5zZXQobWVudV9yZWZlcmVuY2UueWF3aml0dGVyWzFdLCJDZW50ZXIiKQogICAgICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS55YXdqaXR0ZXJbMl0sIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW2FhX2Z1bmN0aW9ucy5hYV9udW1iZXJdLnBlZHJvX2FhczJbYWFfZnVuY3Rpb25zLmppdHRlcl93YXlfbnVtYmVyXSkpCiAgICAgICAgCiAgICBlbHNlaWYgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0ueWF3aml0dGVyKSA9PSAic3dheSIgdGhlbgogICAgICAgIAogICAgICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS55YXdqaXR0ZXJbMV0sIkNlbnRlciIpCiAgICAgICAgCiAgICAgICAgICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS55YXdqaXR0ZXJbMl0sIG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0uc3dheV92YWx1ZSkKICAgICAgICAKICAgIGVsc2VpZiB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS55YXdqaXR0ZXIpID09ICJsICYgciIgdGhlbgogICAgICAgIC0taWYgY21kLmNob2tlZGNvbW1hbmRzID09IDAgdGhlbgogICAgICAgICAgICB1aS5zZXQobWVudV9yZWZlcmVuY2UueWF3aml0dGVyWzFdLCAiQ2VudGVyIikKICAgICAgICAgICAgdWkuc2V0KG1lbnVfcmVmZXJlbmNlLnlhd2ppdHRlclsyXSwgc2lkZSBhbmQgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0ueWF3aml0dGVyYWRkKSBvciB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS55YXdqaXR0ZXJhZGQyKSkKICAgICAgIC0tIGVuZAogICAgZWxzZQogICAgICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS55YXdqaXR0ZXJbMV0sIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW2FhX2Z1bmN0aW9ucy5hYV9udW1iZXJdLnlhd2ppdHRlcikpCiAgICAgICAgdWkuc2V0KG1lbnVfcmVmZXJlbmNlLnlhd2ppdHRlclsyXSwgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0ueWF3aml0dGVyYWRkKSkKICAgIGVuZAoKICAgIGlmIGNtZC5jaG9rZWRjb21tYW5kcyA9PSAwIHRoZW4KICAgICAgICBpZiB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS5nc19ib2R5eWF3KSA9PSAiYW50aSBicnV0ZWZvcmNlIiB0aGVuCiAgICAgICAgICAgIGFhX2Z1bmN0aW9ucy5hbnRpX2JydXRlX2FudGlfYWltKCkKICAgICAgICBlbHNlaWYgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0uZ3NfYm9keXlhdykgPT0gImF1dG8gaml0dGVyIiB0aGVuCiAgICAgICAgICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS5ib2R5eWF3WzFdLCAiSml0dGVyIikKICAgICAgICAgICAgdWkuc2V0KG1lbnVfcmVmZXJlbmNlLmJvZHl5YXdbMl0sIHVpLmdldChtZW51X3JlZmVyZW5jZS55YXdqaXR0ZXJbMl0pKQogICAgICAgIGVsc2VpZiB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS5nc19ib2R5eWF3KSA9PSAiZGVsYXllZCB5YXciIHRoZW4KICAgICAgICAgICAgaWYgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0uZGVsYXllZF9tZXRob2QpID09ICJzaW1wbGUiIHRoZW4KICAgICAgICAgICAgICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS5ib2R5eWF3WzFdLCAiU3RhdGljIikKICAgICAgICAgICAgICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS5ib2R5eWF3WzJdLGFhX2Z1bmN0aW9ucy50b19qaXR0ZXIgYW5kIC0xMTUgb3IgMTE1KQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB1aS5zZXQobWVudV9yZWZlcmVuY2UuYm9keXlhd1sxXSwgIlN0YXRpYyIpCiAgICAgICAgICAgICAgICB1aS5zZXQobWVudV9yZWZlcmVuY2UuYm9keXlhd1syXSwgdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLnlhd1syXSkpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVsc2UKICAgICAgICAgICAgdWkuc2V0KG1lbnVfcmVmZXJlbmNlLmJvZHl5YXdbMV0sIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW2FhX2Z1bmN0aW9ucy5hYV9udW1iZXJdLmdzX2JvZHl5YXcpKQogICAgICAgICAgICB1aS5zZXQobWVudV9yZWZlcmVuY2UuYm9keXlhd1syXSwgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbYWFfZnVuY3Rpb25zLmFhX251bWJlcl0uZ3NfYm9keXlhd2FkZCkpCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAoKICAgIGlmIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJrZXlzIl0uZ2xvYmFsX2ZzKSBhbmQgYWFfZnVuY3Rpb25zLmFhX251bWJlciB+PSAiTGVnaXQiIGFuZCBhYV9mdW5jdGlvbnMuYWFfbnVtYmVyIH49ICJtYW51YWwiIGFuZCBub3QgdGFibGVfY29udGFpbnModWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uZnJlZXN0YW5kaW5nX2Rpc2FibGVyKSxhYV9mdW5jdGlvbnMuYWFfbnVtYmVyKSB0aGVuCiAgICAgICAgdWkuc2V0KG1lbnVfcmVmZXJlbmNlLmZyZWVzdGFuZFsxXSx0cnVlKQogICAgICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS5mcmVlc3RhbmRbMl0sIkFsd2F5cyBvbiIpCiAgICAgIAogICAgZWxzZWlmIG5vdCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sia2V5cyJdLmdsb2JhbF9mcykgb3IgYWFfZnVuY3Rpb25zLmFhX251bWJlciA9PSAiTGVnaXQiIG9yIGFhX2Z1bmN0aW9ucy5hYV9udW1iZXIgPT0gIm1hbnVhbCIgb3IgdGFibGVfY29udGFpbnModWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uZnJlZXN0YW5kaW5nX2Rpc2FibGVyKSxhYV9mdW5jdGlvbnMuYWFfbnVtYmVyKSB0aGVuCiAgICAgICAgdWkuc2V0KG1lbnVfcmVmZXJlbmNlLmZyZWVzdGFuZFsxXSxmYWxzZSkKICAgIGVuZAoKCiAgICBpZiB1aS5nZXQobWVudV9yZWZlcmVuY2UuZnJlZXN0YW5kWzFdKSA9PSB0cnVlIHRoZW4KICAgICAgICBpZiB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5mcmVlc3RhbmRpbmdfb3B0aW9ucykgPT0gInN0YXRpYyIgdGhlbgogICAgICAgICAgICB1aS5zZXQobWVudV9yZWZlcmVuY2UuYm9keXlhd1sxXSwiU3RhdGljIikKICAgICAgICAgICAgdWkuc2V0KG1lbnVfcmVmZXJlbmNlLmJvZHl5YXdbMl0sMSkKICAgICAgICAgICAgdWkuc2V0KG1lbnVfcmVmZXJlbmNlLnlhd2ppdHRlclsxXSwiT2ZmIikKICAgICAgICAgICAgdWkuc2V0KG1lbnVfcmVmZXJlbmNlLnlhd1syXSwwKQogICAgICAgIGVsc2VpZiB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5mcmVlc3RhbmRpbmdfb3B0aW9ucykgPT0gImppdHRlciIgdGhlbgogICAgICAgICAgICB1aS5zZXQobWVudV9yZWZlcmVuY2UuYm9keXlhd1sxXSwiSml0dGVyIikKICAgICAgICAgICAgdWkuc2V0KG1lbnVfcmVmZXJlbmNlLnlhd2ppdHRlclsxXSwiT2ZmIikKICAgICAgICAgICAgdWkuc2V0KG1lbnVfcmVmZXJlbmNlLnlhd1syXSwwKQogICAgICAgIGVuZAogICAgZW5kCiAgICAKICAgIGFhX2Z1bmN0aW9uczptYW51YWxfYW50aV9haW0oKQogICAgYWFfZnVuY3Rpb25zOnN0YXRpY19pbl9hZXJvcGhvYmljKGNtZCkKICAgIGFhX2Z1bmN0aW9uczpkZWZlbnNpdmVfc2V0dXAoY21kKQogICAgYWFfZnVuY3Rpb25zOmFudGlfa25pZmUoKQplbmQKCmxvY2FsIHRleHRfYW5pbSA9IHswLDAsMCwwLDB9CmxvY2FsIGFkZF95ID0gezAsMH0KbG9jYWwgYm90dG9tID0gMApsb2NhbCBhZGRpdGlvbiA9IDAgCmZ1bmN0aW9uIHZpc3VhbF9mdW5jdGlvbnM6aW5kaWNhdG9ycygpCgogICAKICAgIGxvY2FsIHcsaCA9IGNsaWVudC5zY3JlZW5fc2l6ZSgpCiAgICBsb2NhbCBzY29wZWQgPSBlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSwibV9iSXNTY29wZWQiKSA9PSAxIGFuZCB0cnVlIG9yIGZhbHNlCiAgICBsb2NhbCBzY29wZWRfYW5kX2JveCA9IHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uc2NvcGVkX2FuaW1hdGlvbikgYW5kIHNjb3BlZAogICAgbG9jYWwgaW5kaWNhdG9yX2NvbG9yID0geyB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sidmlzdWFscyJdLmluZGljYXRvcl9jb2xvcikgfQoKICAgIHJlbmRlcmVyLnRleHQodyAvIDIgKyBtYXRoLmNlaWwodGV4dF9hbmltWzFdKS0xLGggLyAyICsgMjQsaW5kaWNhdG9yX2NvbG9yWzFdLGluZGljYXRvcl9jb2xvclsyXSxpbmRpY2F0b3JfY29sb3JbM10saW5kaWNhdG9yX2NvbG9yWzRdLCJjLSIsMCwiUyAgVCAgQSAgUiAgTCAgSSAgRyAgSCAgVCIpCiAgIAogICAgaWYgdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLmR0WzFdKSBhbmQgdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLmR0WzJdKSB0aGVuIAogICAgICAgIHJlbmRlcmVyLnRleHQodyAvIDIgKyBtYXRoLmNlaWwodGV4dF9hbmltWzJdKS0xLGggLyAyICsgMjQgKyBtYXRoLmNlaWwoYWRkX3lbMV0pLDI1NSwyNTUsMjU1LGFudGlfYWltX2Z1bmNzLmdldF9kb3VibGVfdGFwKCkgYW5kIDI1NSBvciAxMzAgLCJjLSIsMCwiRFQiKQogICAgZW5kCgogICAgaWYgdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLm9zWzFdKSBhbmQgdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLm9zWzJdKSBhbmQgbm90IHVpLmdldChtZW51X3JlZmVyZW5jZS5kdFsyXSkgdGhlbgogICAgICAgIHJlbmRlcmVyLnRleHQodyAvIDIgKyBtYXRoLmNlaWwodGV4dF9hbmltWzNdKS0xLGggLyAyICsgMjQrIG1hdGguY2VpbChhZGRfeVsyXSksMjU1LDI1NSwyNTUsMjU1ICwiYy0iLDAsIkhTIikKICAgIGVuZAoKICAgIGlmIHVpLmdldChtZW51X3JlZmVyZW5jZS5kdFsxXSkgYW5kIHVpLmdldChtZW51X3JlZmVyZW5jZS5kdFsyXSkgdGhlbgogICAgICAgIGFkZGl0aW9uID0gYWRkX3lbMV0KICAgIGVsc2VpZiB1aS5nZXQobWVudV9yZWZlcmVuY2Uub3NbMV0pIGFuZCB1aS5nZXQobWVudV9yZWZlcmVuY2Uub3NbMl0pIGFuZCBub3QgdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLmR0WzJdKSB0aGVuCiAgICAgICAgYWRkaXRpb24gPSBhZGRfeVsyXQogICAgZWxzZSAKICAgICAgICBhZGRpdGlvbiA9IGxlcnAoYWRkaXRpb24sMCxnbG9iYWxzLmZyYW1ldGltZSgpICogMTUpCiAgICBlbmQKICAgIAoKICAgIHJlbmRlcmVyLnRleHQodyAvIDIgLSAyICsgbWF0aC5jZWlsKHRleHRfYW5pbVs0XSkgLGggLyAyICsgMzMgKyBtYXRoLmNlaWwoYWRkaXRpb24pLDI1NSwyNTUsMjU1LHVpLmdldChtZW51X3JlZmVyZW5jZS5mcmVlc3RhbmRbMV0pIGFuZCAyNTUgb3IgMTMwLCJjLSIsMCwiRlMiKQogICAgcmVuZGVyZXIudGV4dCh3IC8gMiAtIDE4ICsgbWF0aC5jZWlsKHRleHRfYW5pbVs0XSksaCAvIDIgKyAzMyArIG1hdGguY2VpbChhZGRpdGlvbiksMjU1LDI1NSwyNTUsdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLmZvcmNlYmFpbSkgYW5kIDI1NSBvciAxMzAsImMtIiwwLCJCQUlNIikKICAgIHJlbmRlcmVyLnRleHQodyAvIDIgKyAxNiArICBtYXRoLmNlaWwodGV4dF9hbmltWzRdKSxoIC8gMiArIDMzICsgbWF0aC5jZWlsKGFkZGl0aW9uKSwyNTUsMjU1LDI1NSx1aS5nZXQobWVudV9yZWZlcmVuY2UucXVpY2twZWVrWzJdKSBhbmQgdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLnF1aWNrcGVla1sxXSkgYW5kIDI1NSBvciAxMzAsImMtIiwwLCJRVUlDSyIpCgogICAgbG9jYWwgdGV4dCA9IHsiUyAgVCAgQSAgUiAgTCAgSSAgRyAgSCAgVCIsIkRUIiwiSFMiLCJCQUlNIn0KICAgIGZvciBpID0gMSwjdGV4dCBkbwogICAgICAgIGxvY2FsIG1lYXN1cmUgPSB2ZWN0b3IocmVuZGVyZXIubWVhc3VyZV90ZXh0KCJjLSIsIHRleHRbaV0pKQogICAgICAgIGxvY2FsIGNhbjIgPSBzY29wZWRfYW5kX2JveAoKICAgICAgICBpZiBpID09IDQgdGhlbgogICAgICAgICAgICB0ZXh0X2FuaW1baV0gPSBsZXJwKHRleHRfYW5pbVtpXSxjYW4yIGFuZCBtZWFzdXJlLngvMiArIDE5IG9yIDAsZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDE1KQogICAgICAgIGVsc2UKICAgICAgICAgICAgdGV4dF9hbmltW2ldID0gbGVycCh0ZXh0X2FuaW1baV0sY2FuMiBhbmQgbWVhc3VyZS54LzIgKyAyIG9yIDAsZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDE1KQogICAgICAgIGVuZAoKICAgICAgICBpZiBpIDwgMyB0aGVuCiAgICAgICAgICAgIGlmIGkgPT0gMSB0aGVuCiAgICAgICAgICAgICAgICBhZGRfeVtpXSA9IGxlcnAoYWRkX3lbaV0sKHVpLmdldChtZW51X3JlZmVyZW5jZS5kdFsxXSkgYW5kIHVpLmdldChtZW51X3JlZmVyZW5jZS5kdFsyXSkpIGFuZCA5IG9yIDAsZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDE1KQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBsb2NhbCBjYW4gPSB1aS5nZXQobWVudV9yZWZlcmVuY2Uub3NbMV0pIGFuZCB1aS5nZXQobWVudV9yZWZlcmVuY2Uub3NbMl0pIGFuZCBub3QgdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLmR0WzJdKQogICAgICAgICAgICAgICAgYWRkX3lbaV0gPSBsZXJwKGFkZF95W2ldLGNhbiBhbmQgOSBvciAwLGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAxNSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiB0ZXh0X3BsdXModXBkYXRlX3RpY2ssdGV4dCxzcGVlZCkKICAgIHN0cmluZ19zaXplID0gc3RyaW5nLmxlbih0ZXh0KQogICAgCiAgICBpZiB1cGRhdGVfdGljayA8ICN0ZXh0IHRoZW4KICAgICAgICB1cGRhdGVfdGljayA9IHVwZGF0ZV90aWNrICsgMSAqIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiBzcGVlZAogICAgZWxzZQogICAgICAgIHVwZGF0ZV90aWNrID0gdXBkYXRlX3RpY2sKICAgIGVuZAoKICAgIHN0cmluZ19taW51cyA9IHN0cmluZ19zaXplIC0gc3RyaW5nX3NpemUgKyB1cGRhdGVfdGljawoKICAgIHRleHRfcmVuZGVyID0gc3RyaW5nLnN1Yih0ZXh0LDEsc3RyaW5nX21pbnVzKQoKICAgIHJldHVybiB1cGRhdGVfdGljayx0ZXh0X3JlbmRlcgplbmQKCgpsb2NhbCBsYXN0X3N0YXRlID0gIlN0YW5kIgpsb2NhbCB0ZXh0X2luZGV4LHRleHRfc3RyaW5nID0gMCwiU3RhbmQiCmZ1bmN0aW9uIHZpc3VhbF9mdW5jdGlvbnM6aW5kaWNhdG9yczIoKQogICAgbG9jYWwgdyxoID0gY2xpZW50LnNjcmVlbl9zaXplKCkKICAgIGxvY2FsIHNjb3BlZCA9IGVudGl0eS5nZXRfcHJvcChlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCJtX2JJc1Njb3BlZCIpID09IDEgYW5kIHRydWUgb3IgZmFsc2UKICAgIGxvY2FsIHNjb3BlZF9hbmRfYm94ID0gdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS5zY29wZWRfYW5pbWF0aW9uKSBhbmQgc2NvcGVkCiAgICBsb2NhbCBpbmRpY2F0b3JfY29sb3IgPSB7IHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uaW5kaWNhdG9yX2NvbG9yKSB9CgogICAgaWYgbGFzdF9zdGF0ZSB+PSBhYV9mdW5jdGlvbnMuYWFfbnVtYmVyIHRoZW4KICAgICAgICBpZiAjbGFzdF9zdGF0ZSA8ICNhYV9mdW5jdGlvbnMuYWFfbnVtYmVyIHRoZW4KICAgICAgICAgICAgdGV4dF9pbmRleCA9ICNsYXN0X3N0YXRlCiAgICAgICAgZWxzZQogICAgICAgICAgICB0ZXh0X2luZGV4ID0gI2FhX2Z1bmN0aW9ucy5hYV9udW1iZXIgLyAyCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBsYXN0X3N0YXRlID0gYWFfZnVuY3Rpb25zLmFhX251bWJlcgoKCiAgICB0ZXh0X2luZGV4LHRleHRfc3RyaW5nID0gdGV4dF9wbHVzKHRleHRfaW5kZXgsYWFfZnVuY3Rpb25zLmFhX251bWJlciw1MCkKICAgIAoKICAgIHJlbmRlcmVyLnRleHQodyAvIDIgKyBtYXRoLmNlaWwodGV4dF9hbmltWzFdKSxoIC8gMiArIDI0LGluZGljYXRvcl9jb2xvclsxXSxpbmRpY2F0b3JfY29sb3JbMl0saW5kaWNhdG9yX2NvbG9yWzNdLGluZGljYXRvcl9jb2xvcls0XSwiYyIsMCwic3RhcmxpZ2h0IikKICAgIHJlbmRlcmVyLnRleHQodyAvIDIgKyBtYXRoLmNlaWwodGV4dF9hbmltWzJdKSxoIC8gMiArIDM2LDI1NSwyNTUsMjU1LDI1NSwiYyIsMCwiLSAiIC4uIHRleHRfc3RyaW5nIC4uICIgLSIpCiAgIAogICAgaWYgdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLmR0WzFdKSBhbmQgdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLmR0WzJdKSB0aGVuIAogICAgICAgIHJlbmRlcmVyLnRleHQodyAvIDIgKyBtYXRoLmNlaWwodGV4dF9hbmltWzNdKSxoIC8gMiArIDM2ICsgbWF0aC5jZWlsKGFkZF95WzFdKSwyNTUsMjU1LDI1NSxhbnRpX2FpbV9mdW5jcy5nZXRfZG91YmxlX3RhcCgpIGFuZCAyNTUgb3IgMTMwICwiYyIsMCwiZG91YmxlIHRhcCIpCiAgICBlbmQKCiAgICBpZiB1aS5nZXQobWVudV9yZWZlcmVuY2Uub3NbMV0pIGFuZCB1aS5nZXQobWVudV9yZWZlcmVuY2Uub3NbMl0pIGFuZCBub3QgdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLmR0WzJdKSB0aGVuCiAgICAgICAgcmVuZGVyZXIudGV4dCh3IC8gMiArIG1hdGguY2VpbCh0ZXh0X2FuaW1bNF0pLGggLyAyICsgMzYrIG1hdGguY2VpbChhZGRfeVsyXSksMjU1LDI1NSwyNTUsMjU1ICwiYyIsMCwib24gc2hvdCIpCiAgICBlbmQKCiAgICBpZiB1aS5nZXQobWVudV9yZWZlcmVuY2UuZHRbMV0pIGFuZCB1aS5nZXQobWVudV9yZWZlcmVuY2UuZHRbMl0pIHRoZW4KICAgICAgICBhZGRpdGlvbiA9IGFkZF95WzFdCiAgICBlbHNlaWYgdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLm9zWzFdKSBhbmQgdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLm9zWzJdKSBhbmQgbm90IHVpLmdldChtZW51X3JlZmVyZW5jZS5kdFsyXSkgdGhlbgogICAgICAgIGFkZGl0aW9uID0gYWRkX3lbMl0KICAgIGVsc2UgCiAgICAgICAgYWRkaXRpb24gPSBsZXJwKGFkZGl0aW9uLDAsZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDE1KQogICAgZW5kCgoKCiAgICByZW5kZXJlci50ZXh0KHcgLyAyICsgbWF0aC5jZWlsKHRleHRfYW5pbVs1XSkgLGggLyAyICsgNDggKyBtYXRoLmNlaWwoYWRkaXRpb24pLDI1NSwyNTUsMjU1LHVpLmdldChtZW51X3JlZmVyZW5jZS5mcmVlc3RhbmRbMV0pIGFuZCAyNTUgb3IgMTMwLCJjIiwwLCJmcyIpCiAgICByZW5kZXJlci50ZXh0KHcgLyAyIC0gMTggKyBtYXRoLmNlaWwodGV4dF9hbmltWzVdKSxoIC8gMiArIDQ4ICsgbWF0aC5jZWlsKGFkZGl0aW9uKSwyNTUsMjU1LDI1NSx1aS5nZXQobWVudV9yZWZlcmVuY2UuZm9yY2ViYWltKSBhbmQgMjU1IG9yIDEzMCwiYyIsMCwiYmFpbSIpCiAgICByZW5kZXJlci50ZXh0KHcgLyAyICsgMTggKyAgbWF0aC5jZWlsKHRleHRfYW5pbVs1XSksaCAvIDIgKyA0OCArIG1hdGguY2VpbChhZGRpdGlvbiksMjU1LDI1NSwyNTUsdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLnF1aWNrcGVla1syXSkgYW5kIHVpLmdldChtZW51X3JlZmVyZW5jZS5xdWlja3BlZWtbMV0pIGFuZCAyNTUgb3IgMTMwLCJjIiwwLCJxdWljayIpCgogICAgbG9jYWwgdGV4dCA9IHsic3RhcmxpZ2h0IiwiLSAiIC4uIHRleHRfc3RyaW5nIC4uICIgLSIsImRvdWJsZSB0YXAiLCJvbiBzaG90IiwiYmFpbSJ9CiAgICBmb3IgaSA9IDEsI3RleHQgZG8KICAgICAgICBsb2NhbCBtZWFzdXJlID0gdmVjdG9yKHJlbmRlcmVyLm1lYXN1cmVfdGV4dCgiYyIsIHRleHRbaV0pKQogICAgICAgIGxvY2FsIGNhbjIgPSBzY29wZWRfYW5kX2JveAoKICAgICAgICBpZiBpID09IDUgdGhlbgogICAgICAgICAgICB0ZXh0X2FuaW1baV0gPSBsZXJwKHRleHRfYW5pbVtpXSxjYW4yIGFuZCBtZWFzdXJlLngvMiArIDE5IG9yIDAsZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDE1KQogICAgICAgIGVsc2UKICAgICAgICAgICAgdGV4dF9hbmltW2ldID0gbGVycCh0ZXh0X2FuaW1baV0sY2FuMiBhbmQgbWVhc3VyZS54LzIgKyAyIG9yIDAsZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDE1KQogICAgICAgIGVuZAoKICAgICAgICBpZiBpIDwgMyB0aGVuCiAgICAgICAgICAgIGlmIGkgPT0gMSB0aGVuCiAgICAgICAgICAgICAgICBhZGRfeVtpXSA9IGxlcnAoYWRkX3lbaV0sKHVpLmdldChtZW51X3JlZmVyZW5jZS5kdFsxXSkgYW5kIHVpLmdldChtZW51X3JlZmVyZW5jZS5kdFsyXSkpIGFuZCAxMiBvciAwLGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAxNSkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgbG9jYWwgY2FuID0gdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLm9zWzFdKSBhbmQgdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLm9zWzJdKSBhbmQgbm90IHVpLmdldChtZW51X3JlZmVyZW5jZS5kdFsyXSkKICAgICAgICAgICAgICAgIGFkZF95W2ldID0gbGVycChhZGRfeVtpXSxjYW4gYW5kIDEyIG9yIDAsZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDE1KQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKCgpmdW5jdGlvbiB2aXN1YWxfZnVuY3Rpb25zOmluZGljYXRvcnMzKCkKCiAgICB2aXN1YWxfZnVuY3Rpb25zLmluZGljYXRvcl9ib3R0b20gPSAwCiAgICBsb2NhbCB3LGggPSBjbGllbnQuc2NyZWVuX3NpemUoKQogICAgbG9jYWwgaW5kaWNhdG9yX2NvbG9yID0geyB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sidmlzdWFscyJdLmluZGljYXRvcl9jb2xvcikgfQoKICAgIHJlbmRlcmVyLnRleHQodyAvIDIgKyB2aXN1YWxfZnVuY3Rpb25zLm9mZnNldCxoIC8gMiArIDI1LGluZGljYXRvcl9jb2xvclsxXSxpbmRpY2F0b3JfY29sb3JbMl0saW5kaWNhdG9yX2NvbG9yWzNdLGluZGljYXRvcl9jb2xvcls0XSwiYy0iLDAsc3RyaW5nLmZvcm1hdCgiTFVIXGE5NkM4M0MlMDJYR8OLRUsiLGluZGljYXRvcl9jb2xvcls0XSxpbmRpY2F0b3JfY29sb3JbNF0pKQogICAgCiAgICBpZiB1aS5nZXQobWVudV9yZWZlcmVuY2UuZHRbMV0pIGFuZCB1aS5nZXQobWVudV9yZWZlcmVuY2UuZHRbMl0pIHRoZW4KICAgICAgICB2aXN1YWxfZnVuY3Rpb25zLmluZGljYXRvcl9ib3R0b20gPSB2aXN1YWxfZnVuY3Rpb25zLmluZGljYXRvcl9ib3R0b20gKyAxMAogICAgICAgIHZpc3VhbF9mdW5jdGlvbnMuZHRfaW5kaWNhdG9yX2FuaW1hdGlvbiA9IGxlcnAodmlzdWFsX2Z1bmN0aW9ucy5kdF9pbmRpY2F0b3JfYW5pbWF0aW9uLHZpc3VhbF9mdW5jdGlvbnMuaW5kaWNhdG9yX2JvdHRvbSxnbG9iYWxzLmZyYW1ldGltZSgpICogMTUpCiAgICAgICAgcmVuZGVyZXIudGV4dCh3IC8gMiArIHZpc3VhbF9mdW5jdGlvbnMub2Zmc2V0LGggLyAyICsgMjUgKyB2aXN1YWxfZnVuY3Rpb25zLmR0X2luZGljYXRvcl9hbmltYXRpb24sMjU1LDI1NSwyNTUsYW50aV9haW1fZnVuY3MuZ2V0X2RvdWJsZV90YXAoKSBhbmQgMjU1IG9yIDUwLCAiYy0iLCAwLCJET1VCTMOLIikKICAgICAgICAKICAgIGVuZAoKICAgIGlmIHVpLmdldChtZW51X3JlZmVyZW5jZS5vc1sxXSkgYW5kIHVpLmdldChtZW51X3JlZmVyZW5jZS5vc1syXSkgdGhlbgogICAgICAgIHZpc3VhbF9mdW5jdGlvbnMuaW5kaWNhdG9yX2JvdHRvbSA9IHZpc3VhbF9mdW5jdGlvbnMuaW5kaWNhdG9yX2JvdHRvbSArIDEwCiAgICAgICAgdmlzdWFsX2Z1bmN0aW9ucy5oc19pbmRpY2F0b3JfYW5pbWF0aW9uID0gbGVycCh2aXN1YWxfZnVuY3Rpb25zLmhzX2luZGljYXRvcl9hbmltYXRpb24sdmlzdWFsX2Z1bmN0aW9ucy5pbmRpY2F0b3JfYm90dG9tLGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAxNSkKCiAgICAgICAgcmVuZGVyZXIudGV4dCh3IC8gMiArIHZpc3VhbF9mdW5jdGlvbnMub2Zmc2V0LGggLyAyICsgMjUgKyB2aXN1YWxfZnVuY3Rpb25zLmhzX2luZGljYXRvcl9hbmltYXRpb24sIDI1NSwyNTUsMjU1LG5vdCB1aS5nZXQobWVudV9yZWZlcmVuY2UuZHRbMl0pIGFuZCAyNTUgb3IgNTAsICJjLSIsIDAsICJTSEhISCIpCiAgICAgICAgCiAgICAgICAgCiAgICBlbmQKICAgIAogICAgYm90dG9tID0gbGVycChib3R0b20sdmlzdWFsX2Z1bmN0aW9ucy5pbmRpY2F0b3JfYm90dG9tICsgMTAsZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDE1KQogICAgcmVuZGVyZXIudGV4dCh3IC8gMiArIHZpc3VhbF9mdW5jdGlvbnMub2Zmc2V0ICxoIC8gMiArIDI1ICsgYm90dG9tLDI1NSwyNTUsMjU1LHVpLmdldChtZW51X3JlZmVyZW5jZS5mcmVlc3RhbmRbMV0pIGFuZCAyNTUgb3IgNTAsImMtIiwwLCJGUyIpCiAgICByZW5kZXJlci50ZXh0KHcgLyAyIC0gMTUgKyB2aXN1YWxfZnVuY3Rpb25zLm9mZnNldCxoIC8gMiArIDI1ICsgYm90dG9tLDI1NSwyNTUsMjU1LHVpLmdldChtZW51X3JlZmVyZW5jZS5mb3JjZWJhaW0pIGFuZCAyNTUgb3IgNTAsImMtIiwwLCJCQUlNIikKICAgIHJlbmRlcmVyLnRleHQodyAvIDIgKyAxOCArICB2aXN1YWxfZnVuY3Rpb25zLm9mZnNldCxoIC8gMiArIDI1ICsgYm90dG9tLDI1NSwyNTUsMjU1LHVpLmdldChtZW51X3JlZmVyZW5jZS5xdWlja3BlZWtbMl0pIGFuZCB1aS5nZXQobWVudV9yZWZlcmVuY2UucXVpY2twZWVrWzFdKSBhbmQgMjU1IG9yIDUwLCJjLSIsMCwiUVVJQ0siKQoKCiAgICBpZiBub3QgdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLmR0WzJdKSB0aGVuCiAgICAgICAgdmlzdWFsX2Z1bmN0aW9ucy5kdF9pbmRpY2F0b3JfYW5pbWF0aW9uID0gMAogICAgZW5kCgogICAgaWYgbm90IHVpLmdldChtZW51X3JlZmVyZW5jZS5vc1syXSkgdGhlbgogICAgICAgIHZpc3VhbF9mdW5jdGlvbnMuaHNfaW5kaWNhdG9yX2FuaW1hdGlvbiA9IDAKICAgIGVuZAplbmQKCmxvY2FsIERUX0NvbG9yID0ge30KZnVuY3Rpb24gdmlzdWFsX2Z1bmN0aW9uczpncmVlbl9kdF9za2VldF9iZXRhKCkKCiAgCiAgICBpZiB1aS5nZXQobWVudV9yZWZlcmVuY2UuZHRbMV0pIGFuZCB1aS5nZXQobWVudV9yZWZlcmVuY2UuZHRbMl0pIHRoZW4KICAgIAogICAgICAgCiAgICAKICAgICAgICBpZiB2aXN1YWxfZnVuY3Rpb25zLnRpY2tzIDw9IC0xIHRoZW4KICAgICAgICAgICAgdmlzdWFsX2Z1bmN0aW9ucy5pc19kZWZlbnNpdmVfc3RhdGUgPSB0cnVlCiAgICAgICAgZW5kCgoKICAgICAgICBpZiB2aXN1YWxfZnVuY3Rpb25zLmlzX2luX2F0dGFjayBvciB2aXN1YWxfZnVuY3Rpb25zLmluX2ZpcmUgdGhlbgogICAgICAgICAgICB2aXN1YWxfZnVuY3Rpb25zLmlzX2RlZmVuc2l2ZV9zdGF0ZSA9IGZhbHNlCiAgICAgICAgICAgIHZpc3VhbF9mdW5jdGlvbnMuaXNfZGVmZW5zaXZlX3RpY2tzID0gMAogICAgICAgICAgICB2aXN1YWxfZnVuY3Rpb25zLmlzX2RlZmVuc2l2ZV9kaXNhYmxlID0gZmFsc2UKICAgICAgICBlbmQKCgogICAgICAgIGlmIHZpc3VhbF9mdW5jdGlvbnMuaXNfZGVmZW5zaXZlX3N0YXRlID09IHRydWUgdGhlbgogICAgICAgICAgICAKICAgICAgICAgICAgaWYgIHZpc3VhbF9mdW5jdGlvbnMuaXNfZGVmZW5zaXZlX3RpY2tzIDwgMTAwIHRoZW4KICAgICAgICAgICAgICAgIHZpc3VhbF9mdW5jdGlvbnMuaXNfZGVmZW5zaXZlX3RpY2tzID0gIHZpc3VhbF9mdW5jdGlvbnMuaXNfZGVmZW5zaXZlX3RpY2tzICsgMQogICAgICAgICAgICBlbHNlaWYgIHZpc3VhbF9mdW5jdGlvbnMuaXNfZGVmZW5zaXZlX3RpY2tzID49IDEwMCB0aGVuCiAgICAgICAgICAgICAgICB2aXN1YWxfZnVuY3Rpb25zLmlzX2RlZmVuc2l2ZV9zdGF0ZSA9IGZhbHNlCiAgICAgICAgICAgICAgICB2aXN1YWxfZnVuY3Rpb25zLmlzX2RlZmVuc2l2ZV90aWNrcyA9IDAKICAgICAgICAgICAgZW5kCiAgICAgICAgZWxzZQogICAgICAgICAgICB2aXN1YWxfZnVuY3Rpb25zLmlzX2RlZmVuc2l2ZV90aWNrcyA9IDAKICAgICAgICBlbmQKCiAgICAgICAgaWYgdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLmZha2VkdWNrKSB0aGVuCiAgICAgICAgICAgIHZpc3VhbF9mdW5jdGlvbnMuaXNfZGVmZW5zaXZlX2Rpc2FibGUgPSBmYWxzZQogICAgICAgIGVuZAoKICAgICAgICBpZiB2aXN1YWxfZnVuY3Rpb25zLmlzX2RlZmVuc2l2ZV9zdGF0ZSA9PSB0cnVlIHRoZW4KICAgICAgICAgICAgRFRfQ29sb3IgPSB7MTQzLDE5NCwyMSwyNTV9CiAgICAgICAgICAgIHZpc3VhbF9mdW5jdGlvbnMuaXNfZGVmZW5zaXZlX2Rpc2FibGUgPSB0cnVlCiAgICAgICAgZWxzZWlmIG5vdCBhbnRpX2FpbV9mdW5jcy5nZXRfZG91YmxlX3RhcCgpIHRoZW4KCiAgICAgICAgICAgIERUX0NvbG9yID0gezI1NSwwLDUwLDI1NX0KICAgICAgICAgICAgaWYgdmlzdWFsX2Z1bmN0aW9ucy50aWNrcyA+PSAwIGFuZCB2aXN1YWxfZnVuY3Rpb25zLmlzX2RlZmVuc2l2ZV9kaXNhYmxlID09IHRydWUgdGhlbgogICAgICAgICAgICAgICAgRFRfQ29sb3IgPSB7MjA1LDIwNSwyMDUsMjU1fQogICAgICAgICAgICBlbmQKCiAgICAgICAgZWxzZWlmIGFudGlfYWltX2Z1bmNzLmdldF9kb3VibGVfdGFwKCkgdGhlbgogICAgICAgICAgICBEVF9Db2xvciA9IHsyMDUsMjA1LDIwNSwyNTV9CiAgICAgICAgICAgIHZpc3VhbF9mdW5jdGlvbnMuaXNfZGVmZW5zaXZlX2Rpc2FibGUgPSB0cnVlCiAgICAgICAgZW5kCgogICAgCgogICAgICAgcmVuZGVyZXIuaW5kaWNhdG9yKERUX0NvbG9yWzFdLCBEVF9Db2xvclsyXSwgRFRfQ29sb3JbM10sIERUX0NvbG9yWzRdLCAiRFQiKQoKICAgICAgIHZpc3VhbF9mdW5jdGlvbnMuaW5fZmlyZSA9IGZhbHNlCiAgICBlbmQKCmVuZAoKZnVuY3Rpb24gdmlzdWFsX2Z1bmN0aW9uczptYW51YWxfaW5kaWNhdG9yKCkKCiAgICBsb2NhbCB3LGggPSBjbGllbnQuc2NyZWVuX3NpemUoKQogICAgbG9jYWwgYm9keXlhdyA9IGVudGl0eS5nZXRfcHJvcChlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCAibV9mbFBvc2VQYXJhbWV0ZXIiLCAxMSkgKiAxMjAgLSA2MAoKICAgIGFhLmNvbG9yX2xlZnQgPSB7MTIsMTIsMTIsMTMwfQogICAgYWEuY29sb3JfcmlnaHQgPSB7MTIsMTIsMTIsMTMwfQogICAgaWYgYWEubWFudWFsX3N0YXRlID09ICJsZWZ0IiB0aGVuCiAgICAgICAgYWEuY29sb3JfbGVmdCA9IHt1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sidmlzdWFscyJdLmluZGljYXRvcl9tYW51YWxfY29sb3IpfQogICAgZWxzZWlmIGFhLm1hbnVhbF9zdGF0ZSA9PSAicmlnaHQiIHRoZW4KICAgICAgICBhYS5jb2xvcl9yaWdodCA9IHt1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sidmlzdWFscyJdLmluZGljYXRvcl9tYW51YWxfY29sb3IpfQogICAgZW5kCgogICAgaWYgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS5lbmFibGVfbWFudWFsKSA9PSAidHMiIHRoZW4KCgogICAgICAgIGFhLmNvbG9yX2JvZHlfbCA9IHsxMiwxMiwxMiwxMzB9CiAgICAgICAgYWEuY29sb3JfYm9keV9yID0gezEyLDEyLDEyLDEzMH0KICAgICAgICBpZiBib2R5eWF3IDwgLTEwIHRoZW4KICAgICAgICAgICAgYWEuY29sb3JfYm9keV9yID0ge3VpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uaW5kaWNhdG9yX21hbnVhbF9jb2xvcil9CiAgICAgICAgZWxzZWlmIGJvZHl5YXcgPiAxMCB0aGVuCiAgICAgICAgICAgIGFhLmNvbG9yX2JvZHlfbCA9IHt1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sidmlzdWFscyJdLmluZGljYXRvcl9tYW51YWxfY29sb3IpfQogICAgICAgIGVuZAogICAgCiAgICAgICAgbG9jYWwgdmVsX2FkYXAgPSAodWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS5lbmFibGVfdmVsb2NpdHlfYWRhcHRpdmUpIGFuZCBnZXRfdmVsb2NpdHkoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkgKiA0NSAvIDMwMCkgIG9yIDAKCgogICAgICAgIHJlbmRlcmVyLnRyaWFuZ2xlKHcgLyAyICsgNTUgKyB2ZWxfYWRhcCwgaCAvIDIgKyAyLCB3IC8gMiArIDQyICsgdmVsX2FkYXAsIGggLyAyIC0gNywgdyAvIDIgKyA0MiArIHZlbF9hZGFwLCBoIC8gMiArIDExLCBhYS5jb2xvcl9yaWdodFsxXSxhYS5jb2xvcl9yaWdodFsyXSxhYS5jb2xvcl9yaWdodFszXSxhYS5jb2xvcl9yaWdodFs0XSkgCgogICAgICAgIHJlbmRlcmVyLnRyaWFuZ2xlKHcgLyAyIC0gNTUgKyAtdmVsX2FkYXAsIGggLyAyICsgMiwgdyAvIDIgLSA0MiArIC12ZWxfYWRhcCwgaCAvIDIgLSA3LCB3IC8gMiAtIDQyICsgLXZlbF9hZGFwLCBoIC8gMiArIDExLCBhYS5jb2xvcl9sZWZ0WzFdLGFhLmNvbG9yX2xlZnRbMl0sYWEuY29sb3JfbGVmdFszXSxhYS5jb2xvcl9sZWZ0WzRdKSAKCiAgICAgICAgcmVuZGVyZXIucmVjdGFuZ2xlKHcgLyAyICsgMzggKyB2ZWxfYWRhcCwgaCAvIDIgLSA3LCAyLCAxOCwgYWEuY29sb3JfYm9keV9yWzFdLGFhLmNvbG9yX2JvZHlfclsyXSxhYS5jb2xvcl9ib2R5X3JbM10sYWEuY29sb3JfYm9keV9yWzRdKQogICAgICAgcmVuZGVyZXIucmVjdGFuZ2xlKHcgLyAyIC0gNDAgKyAtdmVsX2FkYXAsIGggLyAyIC0gNywgMiwgMTgsYWEuY29sb3JfYm9keV9sWzFdLGFhLmNvbG9yX2JvZHlfbFsyXSxhYS5jb2xvcl9ib2R5X2xbM10sYWEuY29sb3JfYm9keV9sWzRdKQogICAgZWxzZWlmIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uZW5hYmxlX21hbnVhbCkgPT0gIm1pbmltYWwiIHRoZW4KICAgIAogICAgICAgIGxvY2FsIHZlbF9hZGFwID0gKHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uZW5hYmxlX3ZlbG9jaXR5X2FkYXB0aXZlKSBhbmQgZ2V0X3ZlbG9jaXR5KGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkpICogNDUgLyAzMDApICBvciAwCiAgICAgICAgcmVuZGVyZXIudGV4dCh3IC8gMiArIDM1ICsgdmVsX2FkYXAsIGggLyAyICxhYS5jb2xvcl9yaWdodFsxXSxhYS5jb2xvcl9yaWdodFsyXSxhYS5jb2xvcl9yaWdodFszXSxhYS5jb2xvcl9yaWdodFs0XSwiY2IiLDAsIuKuniIpCiAgICAgICAgcmVuZGVyZXIudGV4dCh3IC8gMiAtIDM1ICsgLXZlbF9hZGFwLCBoIC8gMiAsYWEuY29sb3JfbGVmdFsxXSxhYS5jb2xvcl9sZWZ0WzJdLGFhLmNvbG9yX2xlZnRbM10sYWEuY29sb3JfbGVmdFs0XSwiY2IiLDAsIuKunCIpCiAgICBlbmQKZW5kCgpmdW5jdGlvbiB2aXN1YWxfZnVuY3Rpb25zOm1pbl9kbWdfaW5kaWNhdG9yKCkKCiAgICBpZiB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sidmlzdWFscyJdLmVuYWJsZV9taW5fZG1nX292cnJkKSB0aGVuCgogICAgICAgIGxvY2FsIHcsaCA9IGNsaWVudC5zY3JlZW5fc2l6ZSgpCgogICAgICAgIGlmIHVpLmdldChtZW51X3JlZmVyZW5jZS5taW5fZG1nX292ZXJyaWRlWzFdKSBhbmQgdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLm1pbl9kbWdfb3ZlcnJpZGVbMl0pIHRoZW4KICAgICAgICAgICAgaWYgdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLm1pbl9kbWdfb3ZlcnJpZGVbM10pID09IDAgdGhlbgogICAgICAgICAgICAgICAgdmlzdWFsX2Z1bmN0aW9ucy5kYW1hZ2VfaW5kaSA9ICJhdXRvIgogICAgICAgICAgICBlbHNlaWYgdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLm1pbl9kbWdfb3ZlcnJpZGVbM10pID4gMTAwIHRoZW4KICAgICAgICAgICAgICAgIHZpc3VhbF9mdW5jdGlvbnMuZGFtYWdlX2luZGkgPSAiSFArIiAuLiB1aS5nZXQobWVudV9yZWZlcmVuY2UubWluX2RtZ19vdmVycmlkZVszXSkgLSAxMDAKICAgICAgICAgICAgZWxzZWlmIHVpLmdldChtZW51X3JlZmVyZW5jZS5taW5fZG1nX292ZXJyaWRlWzNdKSA8PSAxMDAgdGhlbgogICAgICAgICAgICAgICAgdmlzdWFsX2Z1bmN0aW9ucy5kYW1hZ2VfaW5kaSA9IHVpLmdldChtZW51X3JlZmVyZW5jZS5taW5fZG1nX292ZXJyaWRlWzNdKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAKICAgICAgICBlbHNlaWYgIG5vdCB1aS5nZXQobWVudV9yZWZlcmVuY2UubWluX2RtZ19vdmVycmlkZVsxXSkgb3Igbm90IHVpLmdldChtZW51X3JlZmVyZW5jZS5taW5fZG1nX292ZXJyaWRlWzJdKSB0aGVuIAogICAgCiAgICAgICAgICAgIGlmIHVpLmdldChtZW51X3JlZmVyZW5jZS5taW5pbXVtX2RhbWFnZSkgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICB2aXN1YWxfZnVuY3Rpb25zLmRhbWFnZV9pbmRpID0gImF1dG8iCiAgICAgICAgICAgIGVsc2VpZiB1aS5nZXQobWVudV9yZWZlcmVuY2UubWluaW11bV9kYW1hZ2UpID4gMTAwIHRoZW4KICAgICAgICAgICAgICAgIHZpc3VhbF9mdW5jdGlvbnMuZGFtYWdlX2luZGkgPSAiSFArIiAuLiB1aS5nZXQobWVudV9yZWZlcmVuY2UubWluaW11bV9kYW1hZ2UpIC0gMTAwCiAgICAgICAgICAgIGVsc2VpZiB1aS5nZXQobWVudV9yZWZlcmVuY2UubWluaW11bV9kYW1hZ2UpIDw9IDEwMCB0aGVuCiAgICAgICAgICAgICAgICB2aXN1YWxfZnVuY3Rpb25zLmRhbWFnZV9pbmRpID0gdWkuZ2V0KG1lbnVfcmVmZXJlbmNlLm1pbmltdW1fZGFtYWdlKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIAogICAgICAgIHJlbmRlcmVyLnRleHQodyAvIDIgKyAxMywgaCAvIDIgLSAxNSAsIDI1NSwgMjU1LCAyNTUsIDI1NSwiYy0iLDAsdG9zdHJpbmcodmlzdWFsX2Z1bmN0aW9ucy5kYW1hZ2VfaW5kaSk6dXBwZXIoKSkKICAgIGVuZAplbmQKCmZ1bmN0aW9uIHZpc3VhbF9mdW5jdGlvbnM6ZGVzeW5jX2luZGljYXRvcigpCgogICAgaWYgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS5lbmFibGVfZGVzeW5jX2luZGljYXRvcikgdGhlbgoKICAgICAgICBsb2NhbCBzY29wZWQgPSBlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSwibV9iSXNTY29wZWQiKSA9PSAxIGFuZCB0cnVlIG9yIGZhbHNlCiAgICAgICBsb2NhbCBzY29wZWRfYW5kX2JveCA9IHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uc2NvcGVkX2FuaW1hdGlvbikgYW5kIHNjb3BlZAogICAgICAgdmlzdWFsX2Z1bmN0aW9ucy5vZmZzZXQyID0gbGVycCh2aXN1YWxfZnVuY3Rpb25zLm9mZnNldDIsc2NvcGVkX2FuZF9ib3ggYW5kIDE3IG9yIDAsZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDE1KQoKICAgICAgICBsb2NhbCB3LGggPSBjbGllbnQuc2NyZWVuX3NpemUoKQogICAgICAgIGxvY2FsIGRlc3luY19jb2xvciA9IHt1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sidmlzdWFscyJdLmluZGljYXRvcl9kZXN5bmNfY29sb3IpfQoKICAgICAgICBsb2NhbCBkZXN5bmMgPSAgbWF0aC5mbG9vcihtYXRoLm1pbig2MCwgKGVudGl0eS5nZXRfcHJvcChlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCAibV9mbFBvc2VQYXJhbWV0ZXIiLCAxMSkgKiAxMjAgLSA2MCkpKQoKICAgICAgICBpZiBkZXN5bmMgPCAwIHRoZW4KICAgICAgICAgICAgZGVzeW5jID0gLWRlc3luYwogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBkZXN5bmNfYmFyID0gZGVzeW5jICogMjYgLyA2MAogICAgCiAgICAgICAgbG9jYWwgaW5kaWNhdG9yX3NldCA9IHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uZW5hYmxlX2luZGljYXRvcnMpID09ICJkZWZhdWx0IiBhbmQgdmlzdWFsX2Z1bmN0aW9ucy5vZmZzZXQgb3IgdmlzdWFsX2Z1bmN0aW9ucy5vZmZzZXQyCiAgICAgICAgcmVuZGVyZXIucmVjdGFuZ2xlKHcgLyAyIC0gMTQgKyBpbmRpY2F0b3Jfc2V0ICwgaCAvIDIgKyAxMywyOSw0LDAsMCwwLDI1NSkKICAgICAgICByZW5kZXJlci5ncmFkaWVudCh3IC8gMiAtIDEzICsgaW5kaWNhdG9yX3NldCwgaCAvIDIgKyAxNCxkZXN5bmNfYmFyLDIsZGVzeW5jX2NvbG9yWzFdLGRlc3luY19jb2xvclsyXSxkZXN5bmNfY29sb3JbM10sZGVzeW5jX2NvbG9yWzRdLCAgZGVzeW5jX2NvbG9yWzFdLGRlc3luY19jb2xvclsyXSxkZXN5bmNfY29sb3JbM10sMCx0cnVlKQogICAgZW5kIAplbmQKCmZ1bmN0aW9uIG1pc2NfZnVuY3Rpb25zOmdsb2JhbF9jb3VudGVyKCkKCiAgICBpZiB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sibWlzYyJdLmVuYWJsZV9jbGFuX3RhZykgdGhlbgoKICAgICAgICBpZiB1aS5nZXQobWVudV9yZWZlcmVuY2UuY2xhbl90YWdfc3BhbW1lcikgdGhlbgogICAgICAgICAgICBtaXNjX2Z1bmN0aW9ucy53YXNfY3RfZW5hYmxlZF9iZWZvcmUgPSB0cnVlCiAgICAgICAgICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS5jbGFuX3RhZ19zcGFtbWVyLGZhbHNlKQogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIG1pc2NfZnVuY3Rpb25zLmNsYW5fdGFnX2NoYW5nZV9wb3RlbnRpYWwgPSAiY2hhbmdlIgogICAgICAgIGxvY2FsIG5vdF9zdHJpbmcgPSBnbG9iYWxzLnRpY2tjb3VudCgpCgogICAgICAgIGxvY2FsIGVsX3N0cmluZyA9IHRvbnVtYmVyKHRvc3RyaW5nKG5vdF9zdHJpbmcpOnN1YigtMykpCgogICAgCiAgICAgICAgbWlzY19mdW5jdGlvbnMuY3Rfb2xkX3RpY2sgPSBtaXNjX2Z1bmN0aW9ucy5jdF90aWNrCiAgICAgICAgaWYgZWxfc3RyaW5nIDwgMTAwIHRoZW4KICAgICAgICAgICAgbWlzY19mdW5jdGlvbnMuY3RfdGljayA9IDEKICAgICAgICBlbHNlaWYgZWxfc3RyaW5nID4gMTAwIGFuZCBlbF9zdHJpbmcgPCAxNTUgdGhlbgogICAgICAgICAgIG1pc2NfZnVuY3Rpb25zLmN0X3RpY2sgPSAyCiAgICAgICAgZWxzZWlmIGVsX3N0cmluZyA+IDE1NSBhbmQgZWxfc3RyaW5nIDwgMjEwIHRoZW4KICAgICAgICAgICAgbWlzY19mdW5jdGlvbnMuY3RfdGljayA9IDMKICAgICAgICBlbHNlaWYgZWxfc3RyaW5nID4gMjEwIGFuZCBlbF9zdHJpbmcgPCAyNjUgdGhlbgogICAgICAgICAgICBtaXNjX2Z1bmN0aW9ucy5jdF90aWNrID0gNAogICAgICAgIGVsc2VpZiBlbF9zdHJpbmcgPiAyNjUgYW5kIGVsX3N0cmluZyA8IDMyMCB0aGVuCiAgICAgICAgICAgbWlzY19mdW5jdGlvbnMuY3RfdGljayA9IDUKICAgICAgICBlbHNlaWYgZWxfc3RyaW5nID4gMzIwIGFuZCBlbF9zdHJpbmcgPCAzNzUgdGhlbgogICAgICAgICAgICBtaXNjX2Z1bmN0aW9ucy5jdF90aWNrID0gNgogICAgICAgIGVsc2VpZiBlbF9zdHJpbmcgPiAzNzUgYW5kIGVsX3N0cmluZyA8IDQzMCB0aGVuCiAgICAgICAgICAgIG1pc2NfZnVuY3Rpb25zLmN0X3RpY2sgPSA3CiAgICAgICAgZWxzZWlmIGVsX3N0cmluZyA+IDQzMCBhbmQgZWxfc3RyaW5nIDwgNDg1IHRoZW4KICAgICAgICAgICAgbWlzY19mdW5jdGlvbnMuY3RfdGljayA9IDgKICAgICAgICBlbHNlaWYgZWxfc3RyaW5nID4gNTQwIGFuZCBlbF9zdHJpbmcgPCA1OTUgdGhlbgogICAgICAgICAgICBtaXNjX2Z1bmN0aW9ucy5jdF90aWNrID0gOQogICAgICAgIGVsc2VpZiBlbF9zdHJpbmcgPiA1OTUgYW5kIGVsX3N0cmluZyA8IDY1MCB0aGVuCiAgICAgICAgICAgIG1pc2NfZnVuY3Rpb25zLmN0X3RpY2sgPSAxMAogICAgICAgIGVsc2VpZiBlbF9zdHJpbmcgPiA2NTAgYW5kIGVsX3N0cmluZyA8IDcwNSB0aGVuCiAgICAgICAgICAgIG1pc2NfZnVuY3Rpb25zLmN0X3RpY2sgPSAxMQogICAgICAgIGVsc2VpZiBlbF9zdHJpbmcgPiA3MDUgYW5kIGVsX3N0cmluZyA8IDc2MCB0aGVuCiAgICAgICAgICAgIG1pc2NfZnVuY3Rpb25zLmN0X3RpY2sgPSAxMgogICAgICAgIGVsc2VpZiBlbF9zdHJpbmcgPiA3NjAgYW5kIGVsX3N0cmluZyA8IDgxNSB0aGVuCiAgICAgICAgICAgIG1pc2NfZnVuY3Rpb25zLmN0X3RpY2sgPSAxMwogICAgICAgIGVsc2VpZiBlbF9zdHJpbmcgPiA4MTUgYW5kIGVsX3N0cmluZyA8IDg3MCB0aGVuCiAgICAgICAgICAgIG1pc2NfZnVuY3Rpb25zLmN0X3RpY2sgPSAxNAogICAgICAgIGVsc2VpZiBlbF9zdHJpbmcgPiA4NzAgYW5kIGVsX3N0cmluZyA8IDkyNSB0aGVuCiAgICAgICAgICAgIG1pc2NfZnVuY3Rpb25zLmN0X3RpY2sgPSAxNQogICAgICAgIGVsc2VpZiBlbF9zdHJpbmcgPiA5MjUgYW5kIGVsX3N0cmluZyA8IDk5OSB0aGVuCiAgICAgICAgICAgIG1pc2NfZnVuY3Rpb25zLmN0X3RpY2sgPSAxNgogICAgICAgIGVuZAoKICAgICAgICBpZiBtaXNjX2Z1bmN0aW9ucy5jdF9vbGRfdGljayB+PSBtaXNjX2Z1bmN0aW9ucy5jdF90aWNrIHRoZW4KICAgICAgICAgICAgY2xpZW50LnNldF9jbGFuX3RhZyhtaXNjX2Z1bmN0aW9ucy5jbGFuX3RhZ1ttaXNjX2Z1bmN0aW9ucy5jdF90aWNrXSkKICAgICAgICBlbmQKICAgICAgICAKCiAgICAgICAgbWlzY19mdW5jdGlvbnMuc2F2ZV90aWNrID0gZ2xvYmFscy50aWNrY291bnQoKQogICAgZWxzZWlmIG5vdCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sibWlzYyJdLmVuYWJsZV9jbGFuX3RhZykgdGhlbgoKICAgICAgICBpZiBtaXNjX2Z1bmN0aW9ucy53YXNfY3RfZW5hYmxlZF9iZWZvcmUgPT0gdHJ1ZSB0aGVuCiAgICAgICAgICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS5jbGFuX3RhZ19zcGFtbWVyLHRydWUpCiAgICAgICAgICAgIG1pc2NfZnVuY3Rpb25zLndhc19jdF9lbmFibGVkX2JlZm9yZSA9IGZhbHNlCiAgICAgICAgZWxzZQogICAgICAgICAgICBpZiBtaXNjX2Z1bmN0aW9ucy5zYXZlX3RpY2sgKyA1ID4gZ2xvYmFscy50aWNrY291bnQoKSB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgICAgIGlmIG1pc2NfZnVuY3Rpb25zLmNsYW5fdGFnX2NoYW5nZV9wb3RlbnRpYWwgPT0gImNoYW5nZSIgdGhlbgogICAgICAgICAgICAgICAgY2xpZW50LnNldF9jbGFuX3RhZygiIikKICAgICAgICAgICAgICAgIG1pc2NfZnVuY3Rpb25zLmNsYW5fdGFnX2NoYW5nZV9wb3RlbnRpYWwgPSAiZG9udCBjaGFuZ2UiCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAoKCmxvY2FsIG9sZF9zdW4gPSB7MCwwLDB9CmxvY2FsIHllcyA9IGZhbHNlCmZ1bmN0aW9uIG1pc2NfZnVuY3Rpb25zOnN1bnNldCgpCiAgICBsb2NhbCBzdW5fcHJvcCA9IGVudGl0eS5nZXRfYWxsKCdDQ2FzY2FkZUxpZ2h0JylbMV0KICAgIAogICAgbG9jYWwgbmV3X3N1biA9IHZlY3RvcihlbnRpdHkuZ2V0X3Byb3Aoc3VuX3Byb3AsICJtX2VudkxpZ2h0U2hhZG93RGlyZWN0aW9uIikpCgogICAgaWYgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbIm1pc2MiXS5lbmFibGVfc3VuX3Jpc2UpIGFuZCB5ZXMgPT0gZmFsc2UgdGhlbgogICAgICAgIG9sZF9zdW4gPSB2ZWN0b3IoZW50aXR5LmdldF9wcm9wKHN1bl9wcm9wLCAibV9lbnZMaWdodFNoYWRvd0RpcmVjdGlvbiIpKQogICAgICAgIGVudGl0eS5zZXRfcHJvcChzdW5fcHJvcCwibV9lbnZMaWdodFNoYWRvd0RpcmVjdGlvbiIsMCwwLDApCiAgICAgICAgeWVzID0gdHJ1ZQogICAgZWxzZWlmIG5vdCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sibWlzYyJdLmVuYWJsZV9zdW5fcmlzZSkgdGhlbgogICAgICAgIGlmIHllcyA9PSB0cnVlIHRoZW4KICAgICAgICAgICAgZW50aXR5LnNldF9wcm9wKHN1bl9wcm9wLCJtX2VudkxpZ2h0U2hhZG93RGlyZWN0aW9uIixvbGRfc3VuLngsb2xkX3N1bi55LG9sZF9zdW4ueikKICAgICAgICAgICAgeWVzID0gZmFsc2UKICAgICAgICBlbmQKICAgIGVuZAogICAgCmVuZAoKY2xpZW50LnJlZ2lzdGVyX2VzcF9mbGFnKCJBVCIsIDI1NSwgMjU1LCAyNTUsIGZ1bmN0aW9uKGVudCkKICAgIGlmIHRhYmxlX2NvbnRhaW5zKHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uZXh0cmFfdmlzdWFscyksImF0IHRhcmdldCBmbGFnIikgdGhlbgogICAgICAgIGlmIGVudCA9PSBjbGllbnQuY3VycmVudF90aHJlYXQoKSB0aGVuCiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKCmxvY2FsIGZ1bmN0aW9uIHJvdGF0ZV9hcm91bmRfY2VudGVyKGFuZywgY2VudGVyLCBwb2ludCwgcG9pbnQyKQoJbG9jYWwgcywgYyA9IG1hdGguc2luKGFuZyksIG1hdGguY29zKGFuZykKCXBvaW50LngscG9pbnQueSxwb2ludDIueCxwb2ludDIueT1wb2ludC54LWNlbnRlci54LHBvaW50LnktY2VudGVyLnkscG9pbnQyLngtY2VudGVyLngscG9pbnQyLnktY2VudGVyLnkKCglsb2NhbCB4LCB5ID0gcG9pbnQueCpjIC0gcG9pbnQueSpzLCBwb2ludC54KnMgKyBwb2ludC55KmMKCWxvY2FsIHgyLCB5MiA9IHBvaW50Mi54KmMgLSBwb2ludDIueSpzLCBwb2ludDIueCpzICsgcG9pbnQyLnkqYwoKCXJldHVybiB4K2NlbnRlci54LCB5K2NlbnRlci55LCB4MitjZW50ZXIueCwgeTIrY2VudGVyLnkKZW5kCgpsb2NhbCB6ZXVzX3RhYmxlID0ge30KbG9jYWwgdG9fYWRkX3kgPSAwCmZ1bmN0aW9uIHZpc3VhbF9mdW5jdGlvbnM6emV1c19pbmRpY2F0b3IoKQoKICAgIC0taWYgbm90IHRhYmxlX2NvbnRhaW5zKHVpLmdldChmZWF0dXJlcy52aXN1YWxzLmV4dHJhX29wdGlvbnMpLCJ6ZXVzIHdhcm5pbmciKSB0aGVuIHJldHVybiBlbmQKCiAgICB6ZXVzX3RhYmxlID0ge30KICAgIHRvX2FkZF95ID0gMAogICAgbG9jYWwgb3JpZ2lubmlnZ2EgPSB2ZWN0b3IoZW50aXR5LmdldF9vcmlnaW4oZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkpCgoKICAgIGlmIHVpLmdldChtZW51X3JlZmVyZW5jZS53ZWFwb25fdGV4dCkgdGhlbgogICAgICAgIHRvX2FkZF95ID0gdG9fYWRkX3kgKyAxNQogICAgZW5kCiAgICBpZiB1aS5nZXQobWVudV9yZWZlcmVuY2Uud2VhcG9uX2ljb24pIHRoZW4KICAgICAgICB0b19hZGRfeSA9IHRvX2FkZF95ICsgMTIKICAgIGVuZAogICAgbG9jYWwgemV1c19sb2FkID0gaW1hZ2VzLmdldF93ZWFwb25faWNvbigid2VhcG9uX3Rhc2VyIikKCiAgICBsb2NhbCBwbCA9IGVudGl0eS5nZXRfcGxheWVycyh0cnVlKQogICAgZm9yIGkgPSAxLCAjcGwgZG8KICAgCiAgICAgICAgbG9jYWwgZW50ID0gcGxbaV0KICAgICAgICBsb2NhbCBib3VuZGluZ19ib3ggPSB7ZW50aXR5LmdldF9ib3VuZGluZ19ib3goZW50KX0KICAgICAgICBsb2NhbCBoYXNfemV1cyA9IGZhbHNlCgogICAgICAgIGxvY2FsIHdlYXBvbl9lbnQgPSBlbnRpdHkuZ2V0X3BsYXllcl93ZWFwb24oZW50KQogICAgICAgIGlmIHdlYXBvbl9lbnQgPT0gbmlsIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICBsb2NhbCB3ZWFwb24gPSBjc2dvX3dlYXBvbnMod2VhcG9uX2VudCkKICAgICAgICBpZiB3ZWFwb24gPT0gbmlsIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICBmb3IgaW5kZXggPSAwLCA2NCBkbwogICAgICAgICAgICBsb2NhbCBhID0gZW50aXR5LmdldF9wcm9wKGVudCwgIm1faE15V2VhcG9ucyIsIGluZGV4KQogICAgICAgICAgICBpZiBhIH49IG5pbCB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCB3ZXAgPSBjc2dvX3dlYXBvbnMoYSkKICAgICAgICAgICAgICAgIGlmIHdlcCB+PSBuaWwgYW5kIHdlcC5uYW1lID09ICJaZXVzIHgyNyIgdGhlbgogICAgICAgICAgICAgICAgICAgIGhhc196ZXVzID0gdHJ1ZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCB3ZWFwb24gPSBjc2dvX3dlYXBvbnNbZW50aXR5LmdldF9wcm9wKHdlYXBvbl9lbnQsICJtX2lJdGVtRGVmaW5pdGlvbkluZGV4IildCiAgICAgICAgbG9jYWwgd2VhcG9uX2ljb24gPSBpbWFnZXMuZ2V0X3dlYXBvbl9pY29uKHdlYXBvbikKICAgICAgICBsb2NhbCB3ZWFwb25femV1cyA9IGltYWdlcy5nZXRfd2VhcG9uX2ljb24oIndlYXBvbl90YXNlciIpCiAgICAgICAgbG9jYWwgZW50X2dpbiA9IHZlY3RvcihlbnRpdHkuZ2V0X29yaWdpbihlbnQpKQogICAgICAgIAogICAgICAgIAogICAgICAgIGlmIGhhc196ZXVzIGFuZCB3ZWFwb24ubmFtZSB+PSAiWmV1cyB4MjciIHRoZW4KCiAgICAgICAgICAgIGlmIGJvdW5kaW5nX2JveFsxXSB+PSBuaWwgYW5kIGJvdW5kaW5nX2JveFsyXSB+PSBuaWwgYW5kIGJvdW5kaW5nX2JveFszXSB+PSBuaWwgYW5kIGJvdW5kaW5nX2JveFs0XSB+PSBuaWwgdGhlbiAKICAgICAgICAgICAgICAgIGlmIHRhYmxlX2NvbnRhaW5zKHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uemV1cyksInBsYXllciIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBvcmlnaW5uaWdnYTpkaXN0KGVudF9naW4pIDwgNTAwIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIHpldXNfbG9hZDpkcmF3KChib3VuZGluZ19ib3hbMV0gKyBib3VuZGluZ19ib3hbM10pIC8gMiAtIDEwLGJvdW5kaW5nX2JveFsyXSAtIDQwLDI1LDIyLDEwMCwxMDAsMTAwLDI1NSx0cnVlLG5pbCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlaWYgaGFzX3pldXMgYW5kIHdlYXBvbi5uYW1lID09ICJaZXVzIHgyNyIgdGhlbgoKICAgICAgICAgICAgaWYgemV1c190YWJsZVtpXSA9PSBlbnQgdGhlbgogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoemV1c190YWJsZSxlbnQpIAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIGJvdW5kaW5nX2JveFsxXSB+PSBuaWwgYW5kIGJvdW5kaW5nX2JveFsyXSB+PSBuaWwgYW5kIGJvdW5kaW5nX2JveFszXSB+PSBuaWwgYW5kIGJvdW5kaW5nX2JveFs0XSB+PSBuaWwgdGhlbiAKICAgICAgICAgICAgICAgIGlmIHRhYmxlX2NvbnRhaW5zKHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uemV1cyksInBsYXllciIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBvcmlnaW5uaWdnYTpkaXN0KGVudF9naW4pIDwgNTAwIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIHpldXNfbG9hZDpkcmF3KChib3VuZGluZ19ib3hbMV0gKyBib3VuZGluZ19ib3hbM10pIC8gMiAtIDEwLGJvdW5kaW5nX2JveFsyXSAtIDQwLDI1LDIyLDI1NSwgMjU1LCAyNTUsMjU1LHRydWUsbmlsKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVsc2VpZiBub3QgaGFzX3pldXMgb3Igbm90IHdlYXBvbi5uYW1lID09ICJaZXVzIHgyNyIgdGhlbgogICAgICAgICAgICBpZiB6ZXVzX3RhYmxlW2ldID09IGVudCB0aGVuCiAgICAgICAgICAgICAgICB0YWJsZS5yZW1vdmUoemV1c190YWJsZSxlbnQpIAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmZ1bmN0aW9uIHZpc3VhbF9mdW5jdGlvbnM6emV1c19uaWdnYSgpCgogICAgaWYgdGFibGVfY29udGFpbnModWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS56ZXVzKSwib3V0IG9mIHZpZXciKSB0aGVuCiAgICAgICAgbG9jYWwgbHBfcG9zID0gdmVjdG9yKGVudGl0eS5nZXRfb3JpZ2luKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkpKQogICAgICAgIGxvY2FsIHZpZXcgPSB2ZWN0b3IoY2xpZW50LmNhbWVyYV9hbmdsZXMoKSk7IGlmIHZpZXcgPT0gbmlsIHRoZW4gcmV0dXJuIGVuZAogICAgICAgIGxvY2FsIHcsaCA9IGNsaWVudC5zY3JlZW5fc2l6ZSgpCiAgICAgICAgbG9jYWwgc2l6ZSwgcmFkaXVzID0gMTUsIDIwKjg7IHJhZGl1cyA9IHJhZGl1cytzaXplCiAgICAgICAgbG9jYWwgemV1c19sb2FkID0gaW1hZ2VzLmdldF93ZWFwb25faWNvbigid2VhcG9uX3Rhc2VyIikKICAgICAgICBsb2NhbCBuaWdnYXMgPSBlbnRpdHkuZ2V0X3BsYXllcnModHJ1ZSkKICAgIAogICAgICAgIGZvciBrLHYgaW4gaXBhaXJzKHpldXNfdGFibGUpIGRvCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBvcmlnZW4gPSB2ZWN0b3IoZW50aXR5LmdldF9vcmlnaW4odikpCiAgICAgICAgICAgIGxvY2FsIGRzdCA9IG1hdGgubWluKDgwMCxscF9wb3M6ZGlzdChvcmlnZW4pKS84MDAKICAgIAogICAgICAgICAgICBpZiBub3QgZW50aXR5LmlzX2FsaXZlKHYpIHRoZW4KICAgICAgICAgICAgICAgIHRhYmxlLnJlbW92ZSh6ZXVzX3RhYmxlLGspCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICBsb2NhbCB3MnMgPSB7cmVuZGVyZXIud29ybGRfdG9fc2NyZWVuKG9yaWdlbjp1bnBhY2soKSl9CiAgICAKICAgICAgICAgICAgaWYgdzJzWzFdIGFuZCB3MnNbMl0gYW5kIHcyc1sxXSA+IDAgYW5kIHcyc1syXSA+IDAgYW5kIHcyc1sxXSA8IHcgYW5kIHcyc1syXSA8IGggdGhlbiBicmVhayBlbmQKICAgIAogICAgICAgICAgICBsb2NhbCBfLCBhbmdsZSA9IGxwX3Bvczp0byhvcmlnZW4pOmFuZ2xlcygpIGlmIG5vdCBhbmdsZSB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICBhbmdsZT0yNzAtYW5nbGUrdmlldy55CiAgICAgICAgICAgIGxvY2FsIGFuZ19yYWQgPSBtYXRoLnJhZChhbmdsZSkKICAgICAgICAgICAgbG9jYWwgcG9pbnQgPSB2ZWN0b3Iody8yICsgbWF0aC5jb3MoYW5nX3JhZCkqcmFkaXVzLCBoLzIgKyBtYXRoLnNpbihhbmdfcmFkKSpyYWRpdXMsIDApCiAgICAKICAgICAgICAgICAgbG9jYWwgcG9pbnQyLCBwb2ludDMgPSB2ZWN0b3IocG9pbnQueCAtIHNpemUvMiwgcG9pbnQueSAtIHNpemUsIDApLCB2ZWN0b3IocG9pbnQueCArIHNpemUvMiwgcG9pbnQueS1zaXplLCAwKQogICAgICAgICAgICBsb2NhbCBwb2ludHMgPSB7IHJvdGF0ZV9hcm91bmRfY2VudGVyKG1hdGgucmFkKGFuZ2xlLTkwKSwgcG9pbnQsIHBvaW50MiwgcG9pbnQzKSB9CiAgICAKICAgICAgICAgICAgemV1c19sb2FkOmRyYXcocG9pbnQueCwgcG9pbnQueSwzMCwzMCwyNTUsMjU1LDI1NSwyNTUsdHJ1ZSxuaWwpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgoKbG9jYWwgb3ZlcndyaXR0ZW4gPSBmYWxzZQpsb2NhbCBmdW5jdGlvbiBlbnRpdHlfb3ZlcnJpZGUoKQogICAgbG9jYWwgZW50X21hcCA9IGVudGl0eS5nZXRfYWxsKCJDRW52VG9uZW1hcENvbnRyb2xsZXIiKVsxXQoKICAgIGlmIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJtaXNjIl0uZW5hYmxlX25pZ3RoZXJtb2RlKSBhbmQgb3ZlcndyaXR0ZW4gPT0gZmFsc2UgdGhlbgogICAgICAgIGVudGl0eS5zZXRfcHJvcChlbnRfbWFwLCAibV9iVXNlQ3VzdG9tQXV0b0V4cG9zdXJlTWluIiwgMSkKICAgICAgICBlbnRpdHkuc2V0X3Byb3AoZW50X21hcCwgIm1fYlVzZUN1c3RvbUF1dG9FeHBvc3VyZU1heCIsMSkKICAgICAgICBlbnRpdHkuc2V0X3Byb3AoZW50X21hcCwgIm1fZmxDdXN0b21BdXRvRXhwb3N1cmVNaW4iLCAwLjEpCiAgICAgICAgZW50aXR5LnNldF9wcm9wKGVudF9tYXAsICJtX2ZsQ3VzdG9tQXV0b0V4cG9zdXJlTWF4IiwgMC4xKQogICAgICAgIG92ZXJ3cml0dGVuID0gdHJ1ZQogICAgZWxzZWlmIG5vdCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sibWlzYyJdLmVuYWJsZV9uaWd0aGVybW9kZSkgYW5kIG92ZXJ3cml0dGVuIHRoZW4KICAgICAgICBlbnRpdHkuc2V0X3Byb3AoZW50X21hcCwgIm1fYlVzZUN1c3RvbUF1dG9FeHBvc3VyZU1pbiIsIDApCiAgICAgICAgZW50aXR5LnNldF9wcm9wKGVudF9tYXAsICJtX2JVc2VDdXN0b21BdXRvRXhwb3N1cmVNYXgiLDApCiAgICAgICAgb3ZlcndyaXR0ZW4gPSBmYWxzZQogICAgZW5kCmVuZAoKCmxvY2FsIGZ1bmN0aW9uIGNsYW1wKHZhbHVlLCBtaW5WYWx1ZSwgbWF4VmFsdWUpCiAgICBpZiB2YWx1ZSA8IG1pblZhbHVlIHRoZW4KICAgICAgICByZXR1cm4gbWluVmFsdWUKICAgIGVuZAoKICAgIGlmIHZhbHVlID4gbWF4VmFsdWUgdGhlbgogICAgICAgICByZXR1cm4gbWF4VmFsdWUKICAgIGVuZAoKICAgIHJldHVybiB2YWx1ZQplbmQKCmxvY2FsIHJnYmFfdG9faGV4ID0gZnVuY3Rpb24oYiwgYywgZCwgZSkKICAgIHJldHVybiBzdHJpbmcuZm9ybWF0KCclMDJ4JTAyeCUwMnglMDJ4JywgYiwgYywgZCwgZSkKZW5kCgpsb2NhbCBmdW5jdGlvbiB0ZXh0X2ZhZGVfYW5pbWF0aW9uKHgsIHksIHNwZWVkLCBjb2xvcjEsIGNvbG9yMiwgdGV4dCkKICAgIGxvY2FsIGZpbmFsX3RleHQgPSAnJwogICAgbG9jYWwgY3VydGltZSA9IGdsb2JhbHMuY3VydGltZSgpCiAgICBmb3IgaSA9IDAsICN0ZXh0IGRvCiAgICAgICAgbG9jYWwgeCA9IGkgKiAxMCAgCiAgICAgICAgbG9jYWwgd2F2ZSA9IG1hdGguY29zKDIgKiBzcGVlZCAqIGN1cnRpbWUgLyA0ICsgeCAvIDUwKQogICAgICAgIGxvY2FsIGNvbG9yID0gcmdiYV90b19oZXgoCiAgICAgICAgICAgIGxlcnAoY29sb3IxLnIsIGNvbG9yMi5yLCBjbGFtcCh3YXZlLCAwLCAxKSksCiAgICAgICAgICAgIGxlcnAoY29sb3IxLmcsIGNvbG9yMi5nLCBjbGFtcCh3YXZlLCAwLCAxKSksCiAgICAgICAgICAgIGxlcnAoY29sb3IxLmIsIGNvbG9yMi5iLCBjbGFtcCh3YXZlLCAwLCAxKSksCiAgICAgICAgICAgIGNvbG9yMS5hCiAgICAgICAgKSAKICAgICAgICBmaW5hbF90ZXh0ID0gZmluYWxfdGV4dCAuLiAnIFxhJyAuLiBjb2xvciAuLiB0ZXh0OnN1YihpLCBpKSAKICAgIGVuZAogICAgCiAgICByZW5kZXJlci50ZXh0KHgsIHksIGNvbG9yMS5yLCBjb2xvcjEuZywgY29sb3IxLmIsIGNvbG9yMS5hLCAiYyIsIG5pbCwgZmluYWxfdGV4dCkKZW5kCgoKZnVuY3Rpb24gdmlzdWFsX2Z1bmN0aW9uczp3YXRlcm1hcmsoKQogICAgbG9jYWwgdyxoID0gY2xpZW50LnNjcmVlbl9zaXplKCkKICAgIGxvY2FsIHdtID0geyB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sidmlzdWFscyJdLndhdGVybWFya19jb2xvcikgfQogICAgCgogICAgdGV4dF9mYWRlX2FuaW1hdGlvbih3IC0gNTAsaCAvIDIsNSx7cj0yNTUsZz0yNTUsYj0yNTUsYT0yNTV9LHtyPXdtWzFdLGc9d21bMl0sYj13bVszXSxhPXdtWzRdfSwic3RhcmxpZ2h0IikKZW5kCgoKbG9jYWwgZnVuY3Rpb24gc3RyX3RvX3N1YihpbnB1dCwgc2VwKQogICAgbG9jYWwgdCA9IHt9CiAgICBmb3Igc3RyIGluIHN0cmluZy5nbWF0Y2goaW5wdXQsICIoW14iLi5zZXAuLiJdKykiKSBkbwogICAgICAgIHRbI3QgKyAxXSA9IHN0cmluZy5nc3ViKHN0ciwgIlxuIiwgIiIpCiAgICBlbmQKICAgIHJldHVybiB0CmVuZAoKbG9jYWwgZnVuY3Rpb24gdG9fYm9vbGVhbihzdHIpCiAgICBpZiBzdHIgPT0gInRydWUiIG9yIHN0ciA9PSAiZmFsc2UiIHRoZW4KICAgICAgICByZXR1cm4gKHN0ciA9PSAidHJ1ZSIpCiAgICBlbHNlCiAgICAgICAgcmV0dXJuIHN0cgogICAgZW5kCmVuZAoKbmV3X21lbnVfcmVmZXJlbmNlcy5jb25maWcuZXhwb3J0X2ZpbGUgPSB1aS5uZXdfYnV0dG9uKHRhYixwbGFjZSwgImV4cG9ydCB0byBjbGlwYm9hcmQiLCBmdW5jdGlvbigpCgogICAgbG9jYWwgc3RyID0gIiIKCiAgICBmb3Igayx2IGluIGlwYWlycyhhYS5hYV9zdGF0ZXMpIGRvCiAgICAgICAKCQlzdHIgPSBzdHIKCQkuLiB0b3N0cmluZyh1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS5lbmFibGVkKSkgLi4gInwiCgkJLi4gdG9zdHJpbmcodWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0ucGl0Y2gpKSAuLiAifCIKCQkuLiB0b3N0cmluZyh1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS55YXdiYXNlKSkgLi4gInwiCgkJLi4gdG9zdHJpbmcodWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0ueWF3KSkgLi4gInwiCgkJLi4gdG9zdHJpbmcodWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0ueWF3YWRkKSkgLi4gInwiCgkJLi4gdG9zdHJpbmcodWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0udGlja2VyX3NsaWRlcikpIC4uICJ8IgogICAgICAgIC4uIHRvc3RyaW5nKHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLnlhd2FkZGxlZnQpKSAuLiAifCIKCQkuLiB0b3N0cmluZyh1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS55YXdqaXR0ZXIpKSAuLiAifCIKCQkuLiB0b3N0cmluZyh1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS55YXdqaXR0ZXJhZGQpKSAuLiAifCIKICAgICAgICAuLiB0b3N0cmluZyh1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS55YXdqaXR0ZXJhZGQyKSkgLi4gInwiCiAgICAgICAgLi4gdG9zdHJpbmcodWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0uZ3NfYm9keXlhdykpIC4uICJ8IgogICAgICAgIC4uIHRvc3RyaW5nKHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLmdzX2JvZHl5YXdhZGQpKSAuLiAifCIgICAgCgogICAgICAgIGZvciBiID0gMSwxMiBkbwogICAgICAgICAgICBzdHIgPSBzdHIgLi4gdG9zdHJpbmcodWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0ucGVkcm9fYWFzMltiXSkpIC4uICJ8IiAgIAogICAgICAgIGVuZAogICAgZW5kCgogICAgZm9yIGkgPSAxLDQgZG8KICAgICAgICBzdHIgPSBzdHIgLi4gdG9zdHJpbmcodG9zdHJpbmcodWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImJydXRlZm9yY2UiXVtpXSkpKSAuLiAifCIKICAgIGVuZAoKICAgIGNsaXBib2FyZC5zZXQoYmFzZTY0LmVuY29kZShzdHIsJ2Jhc2U2NCcpKQplbmQpCgoKbmV3X21lbnVfcmVmZXJlbmNlcy5jb25maWcuaW1wb3J0X2NvbmZpZyA9IHVpLm5ld19idXR0b24odGFiLHBsYWNlLCJpbXBvcnQgZnJvbSBjbGlwYm9hcmQiLGZ1bmN0aW9uKCkKCgogICAgbG9jYWwgdGJsID0gc3RyX3RvX3N1YihiYXNlNjQuZGVjb2RlKGNsaXBib2FyZC5nZXQoKSwgJ2Jhc2U2NCcpLCAifCIpCiAgICBsb2NhbCBjcmVzY2VudGUgPSAxCiAgICAKICAgIGZvciBrLHYgaW4gaXBhaXJzKGFhLmFhX3N0YXRlcykgZG8KICAgIAogICAgICAgIHVpLnNldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLmVuYWJsZWQsIHRvX2Jvb2xlYW4odGJsW2NyZXNjZW50ZV0pKQogICAgICAgIGNyZXNjZW50ZSA9IGNyZXNjZW50ZSArIDEKCQl1aS5zZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS5waXRjaCwgdG9zdHJpbmcodGJsW2NyZXNjZW50ZV0pKQogICAgICAgIGNyZXNjZW50ZSA9IGNyZXNjZW50ZSArIDEKCQl1aS5zZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS55YXdiYXNlLCB0b3N0cmluZyh0YmxbY3Jlc2NlbnRlXSkpCiAgICAgICAgY3Jlc2NlbnRlID0gY3Jlc2NlbnRlICsgMQoJCXVpLnNldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLnlhdywgdG9zdHJpbmcodGJsW2NyZXNjZW50ZV0pKQogICAgICAgIGNyZXNjZW50ZSA9IGNyZXNjZW50ZSArIDEKCQl1aS5zZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS55YXdhZGQsIHRvbnVtYmVyKHRibFtjcmVzY2VudGVdKSkKICAgICAgICBjcmVzY2VudGUgPSBjcmVzY2VudGUgKyAxCgkJdWkuc2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0udGlja2VyX3NsaWRlciwgdG9udW1iZXIodGJsW2NyZXNjZW50ZV0pKQoJCWNyZXNjZW50ZSA9IGNyZXNjZW50ZSArIDEKICAgICAgICB1aS5zZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS55YXdhZGRsZWZ0LCB0b251bWJlcih0YmxbY3Jlc2NlbnRlXSkpCiAgICAgICAgY3Jlc2NlbnRlID0gY3Jlc2NlbnRlICsgMQoJCXVpLnNldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLnlhd2ppdHRlciwgdG9zdHJpbmcodGJsW2NyZXNjZW50ZV0pKQogICAgICAgIGNyZXNjZW50ZSA9IGNyZXNjZW50ZSArIDEKCQl1aS5zZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS55YXdqaXR0ZXJhZGQsIHRvbnVtYmVyKHRibFtjcmVzY2VudGVdKSkKICAgICAgICBjcmVzY2VudGUgPSBjcmVzY2VudGUgKyAxCiAgICAgICAgdWkuc2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0ueWF3aml0dGVyYWRkMiwgdG9udW1iZXIodGJsW2NyZXNjZW50ZV0pKQogICAgICAgIGNyZXNjZW50ZSA9IGNyZXNjZW50ZSArIDEKICAgICAgICB1aS5zZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS5nc19ib2R5eWF3LCB0b3N0cmluZyh0YmxbY3Jlc2NlbnRlXSkpCiAgICAgICAgY3Jlc2NlbnRlID0gY3Jlc2NlbnRlICsgMQogICAgICAgIHVpLnNldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLmdzX2JvZHl5YXdhZGQsIHRvbnVtYmVyKHRibFtjcmVzY2VudGVdKSkKICAgICAgICBjcmVzY2VudGUgPSBjcmVzY2VudGUgKyAxCgogICAgICAgIGZvciBiID0gMSwxMiBkbwogICAgICAgICAgICB1aS5zZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS5wZWRyb19hYXMyW2JdLHRvbnVtYmVyKHRibFtjcmVzY2VudGVdKSkKICAgICAgICAgICAgY3Jlc2NlbnRlID0gY3Jlc2NlbnRlICsgMQogICAgICAgIGVuZAogICAgZW5kCgogICAgZm9yIGkgPSAxLCA0IGRvCiAgICAgICAgdWkuc2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImJydXRlZm9yY2UiXVtpXSx0b251bWJlcih0YmxbY3Jlc2NlbnRlXSkpCiAgICAgICAgY3Jlc2NlbnRlID0gY3Jlc2NlbnRlICsgMQogICAgZW5kCmVuZCkKCmxvY2FsIGZ1bmN0aW9uIGhpZGVfZGVmYXVsdF9hYShjb25kaXRpb25zKQogICAgdWkuc2V0X3Zpc2libGUobWVudV9yZWZlcmVuY2UuZW5hYmxlZCxjb25kaXRpb25zKQogICAgdWkuc2V0X3Zpc2libGUobWVudV9yZWZlcmVuY2UucGl0Y2hbMV0sIGNvbmRpdGlvbnMpCiAgICB1aS5zZXRfdmlzaWJsZShtZW51X3JlZmVyZW5jZS5waXRjaFsyXSwgY29uZGl0aW9ucykKICAgIHVpLnNldF92aXNpYmxlKG1lbnVfcmVmZXJlbmNlLnJvbGwsIGNvbmRpdGlvbnMpCiAgICB1aS5zZXRfdmlzaWJsZShtZW51X3JlZmVyZW5jZS55YXdiYXNlLCBjb25kaXRpb25zKQogICAgdWkuc2V0X3Zpc2libGUobWVudV9yZWZlcmVuY2UueWF3WzFdLCBjb25kaXRpb25zKQogICAgdWkuc2V0X3Zpc2libGUobWVudV9yZWZlcmVuY2UueWF3WzJdLCBjb25kaXRpb25zKQogICAgdWkuc2V0X3Zpc2libGUobWVudV9yZWZlcmVuY2UueWF3aml0dGVyWzFdLCBjb25kaXRpb25zKQogICAgdWkuc2V0X3Zpc2libGUobWVudV9yZWZlcmVuY2UueWF3aml0dGVyWzJdLCBjb25kaXRpb25zKQogICAgdWkuc2V0X3Zpc2libGUobWVudV9yZWZlcmVuY2UuYm9keXlhd1sxXSwgY29uZGl0aW9ucykKICAgIHVpLnNldF92aXNpYmxlKG1lbnVfcmVmZXJlbmNlLmJvZHl5YXdbMl0sIGNvbmRpdGlvbnMpCiAgICB1aS5zZXRfdmlzaWJsZShtZW51X3JlZmVyZW5jZS5mcmVlc3RhbmRbMV0sIGNvbmRpdGlvbnMpCiAgICB1aS5zZXRfdmlzaWJsZShtZW51X3JlZmVyZW5jZS5mcmVlc3RhbmRbMl0sIGNvbmRpdGlvbnMpCiAgICB1aS5zZXRfdmlzaWJsZShtZW51X3JlZmVyZW5jZS5mc2JvZHl5YXcsY29uZGl0aW9ucykKICAgIHVpLnNldF92aXNpYmxlKG1lbnVfcmVmZXJlbmNlLmVkZ2V5YXcsIGNvbmRpdGlvbnMpCmVuZAoKLS0gYWEgPSAxLHZpc3VhbHMgPSAyLG1pc2MgPSAzLGNvbmZpZyA9IDQKCmxvY2FsIGZ1bmN0aW9uIG5ld19tZW51X3Zpc2liaWxpdHkoKQoKICAgIGxvY2FsIG1hbnVhbF9wYWdlID0gdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVfbWVudSkgPT0gIk1hbnVhbCIKICAgIGxvY2FsIG1haW5fcGFnZSA9IHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzLmFhX3RhYikgPT0gIk1haW4iCiAgICBsb2NhbCBqaXR0ZXJfcGFnZSA9IHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzLmFhX3RhYikgPT0gIkppdHRlciIKICAgIGxvY2FsIGJydXRlZm9yY2VfcGFnZSA9IHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzLmFhX3RhYikgPT0gIkJydXRlZm9yY2UiCiAgIAogICAgLS1hYQogICAtLSB1aS5zZXRfdmlzaWJsZShuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX2xhYmVsLHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDEpCiAgICB1aS5zZXRfdmlzaWJsZShuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlX21lbnUsdWlfbWVudS5zZWxlY3RlZF90YWIgPT0gMSBvciB1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSAyIGFuZCBqaXR0ZXJfcGFnZSkKICAgIHVpLnNldF92aXNpYmxlKG5ld19tZW51X3JlZmVyZW5jZXMuYWFfdGFiLHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDIpCiAgICAKICAgIC0tbG9jYWwgYW50aV9icnV0ZWZvcmNlID0gdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl1fdGFiKSA9PSAiYnJ1dGVmb3JjZSIKICAgIGZvciBrLHYgaW4gaXBhaXJzKGFhLmFhX3N0YXRlcykgZG8KICAgICAgICB1aS5zZXRfdmlzaWJsZShuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLmVuYWJsZWQsdWlfbWVudS5zZWxlY3RlZF90YWIgPT0gMSBhbmQgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVfbWVudSkgPT0gdikKICAgICAgICB1aS5zZXRfdmlzaWJsZSggbmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS5waXRjaCx1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSAxIGFuZCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZV9tZW51KSA9PSB2KQogICAgICAgIHVpLnNldF92aXNpYmxlKCBuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLnBpdGNoX3NsaWRlcix1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSAxIGFuZCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZV9tZW51KSA9PSB2IGFuZCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS5waXRjaCkgPT0gImN1c3RvbSIpCiAgICAgICAgdWkuc2V0X3Zpc2libGUoIG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0ueWF3YmFzZSx1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSAxIGFuZCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZV9tZW51KSA9PSB2IGFuZCBub3QgbWFudWFsX3BhZ2UpIAogICAgICAgIHVpLnNldF92aXNpYmxlKCBuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLnlhdyx1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSAxIGFuZCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZV9tZW51KSA9PSB2IGFuZCBrIH49IDcgYW5kIGsgfj0gOSkgCiAgICAgICAgdWkuc2V0X3Zpc2libGUoIG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0ueWF3YWRkLHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDEgYW5kIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlX21lbnUpID09IHYgYW5kIG5vdCBtYW51YWxfcGFnZSBhbmQgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0ueWF3KSB+PSAib2ZmIikgCiAgICAgICAgdWkuc2V0X3Zpc2libGUoIG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0ueWF3aml0dGVyLHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDEgYW5kIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlX21lbnUpID09IHYpICAKICAgICAgICB1aS5zZXRfdmlzaWJsZSggbmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS55YXdqaXR0ZXJhZGQsdWlfbWVudS5zZWxlY3RlZF90YWIgPT0gMSBhbmQgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVfbWVudSkgPT0gdiBhbmQgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0ueWF3aml0dGVyKSB+PSAib2ZmIiBhbmQgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0ueWF3aml0dGVyKSB+PSAiaml0dGVyIHdheXMiIGFuZCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS55YXdqaXR0ZXIpIH49ICJzd2F5IikgIAogICAgICAgIHVpLnNldF92aXNpYmxlKCBuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLnlhd2ppdHRlcmFkZDIsdWlfbWVudS5zZWxlY3RlZF90YWIgPT0gMSBhbmQgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVfbWVudSkgPT0gdiBhbmQgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0ueWF3aml0dGVyKSA9PSAibCAmIHIiKSAgCiAgICAgICAgdWkuc2V0X3Zpc2libGUoIG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0uZ3NfYm9keXlhdyx1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSAxIGFuZCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZV9tZW51KSA9PSB2KSAKICAgICAgICB1aS5zZXRfdmlzaWJsZSggbmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS5kZWxheWVkX21ldGhvZCx1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSAxIGFuZCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZV9tZW51KSA9PSB2IGFuZCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS5nc19ib2R5eWF3KSA9PSAiZGVsYXllZCB5YXciKSAKICAgICAgICB1aS5zZXRfdmlzaWJsZSggbmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS5nc19ib2R5eWF3YWRkLHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDEgYW5kIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlX21lbnUpID09IHYgYW5kIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLmdzX2JvZHl5YXcpIH49ICJvZmYiIGFuZCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS5nc19ib2R5eWF3KSB+PSAiYW50aSBicnV0ZWZvcmNlIiBhbmQgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0uZ3NfYm9keXlhdykgfj0gImF1dG8gaml0dGVyIiBhbmQgIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLmdzX2JvZHl5YXcpIH49ICJkZWxheWVkIHlhdyIpIAogICAgICAgIHVpLnNldF92aXNpYmxlKG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0uandheV9jb3VudGVyLGZhbHNlKQogICAgICAgIHVpLnNldF92aXNpYmxlKG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0uc3dheW0sIHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDEgYW5kIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlX21lbnUpID09IHYgYW5kIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLnlhd2ppdHRlcikgPT0gInN3YXkiKQogICAgICAgIHVpLnNldF92aXNpYmxlKG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0uc3dheW14LCB1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSAxIGFuZCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZV9tZW51KSA9PSB2IGFuZCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS55YXdqaXR0ZXIpID09ICJzd2F5IikKICAgICAgICB1aS5zZXRfdmlzaWJsZShuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLnN3YXlzcGVlZCwgdWlfbWVudS5zZWxlY3RlZF90YWIgPT0gMSBhbmQgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVfbWVudSkgPT0gdiBhbmQgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0ueWF3aml0dGVyKSA9PSAic3dheSIpCgogICAgICAgIGlmICBrIH49ICJMZWdpdCIgYW5kIGsgfj0gIm1hbnVhbCIgdGhlbgogICAgICAgICAgICB1aS5zZXRfdmlzaWJsZShuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLnlhd2FkZGxlZnQsIHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDEgYW5kIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlX21lbnUpID09IHYgYW5kICh1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS55YXcpID09ICJqaXR0ZXJ5IiBvciB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS55YXcpID09ICJkZWxheWVkIiBvciB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS55YXcpID09ICJsICYgciIpKQogICAgICAgICAgICB1aS5zZXRfdmlzaWJsZShuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLnRpY2tlcl9zbGlkZXIsIHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDEgYW5kIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlX21lbnUpID09IHYgYW5kIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLnlhdykgPT0gImRlbGF5ZWQiKQogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIGlmIGsgfj0gImZha2VsYWciIGFuZCBrIH49ICJMZWdpdCIgYW5kIGsgfj0gIm1hbnVhbCIgdGhlbgogICAgICAgICAgICB1aS5zZXRfdmlzaWJsZShuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLmVuYWJsZWRfZXhwbG9pdCx1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSAxIGFuZCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZV9tZW51KSA9PSB2KQogICAgICAgICAgICB1aS5zZXRfdmlzaWJsZSggbmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS5lbmFibGVkX2RlZmVuc2l2ZV9mb3JjZSx1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSAxIGFuZCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZV9tZW51KSA9PSB2IGFuZCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS5lbmFibGVkX2V4cGxvaXQpKSAKICAgICAgICAgICAgdWkuc2V0X3Zpc2libGUoIG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0ucGl0Y2hfZGVmZW5zaXZlLHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDEgYW5kIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlX21lbnUpID09IHYgYW5kIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLmVuYWJsZWRfZXhwbG9pdCkpIAogICAgICAgICAgICB1aS5zZXRfdmlzaWJsZSggbmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS55YXdfZGVmZW5zaXZlLHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDEgYW5kIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlX21lbnUpID09IHYgYW5kIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLmVuYWJsZWRfZXhwbG9pdCkpIAogICAgICAgICAgICB1aS5zZXRfdmlzaWJsZSggbmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS55YXdhZGRfZGVmZW5zaXZlLHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDEgYW5kIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlX21lbnUpID09IHYgYW5kIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLnlhd19kZWZlbnNpdmUpIH49ICJvZmYiIGFuZCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS5lbmFibGVkX2V4cGxvaXQpKSAKICAgICAgICAgICAgdWkuc2V0X3Zpc2libGUoIG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0uc2tpdHRlcl9kZWZlbnNpdmUsdWlfbWVudS5zZWxlY3RlZF90YWIgPT0gMSBhbmQgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVfbWVudSkgPT0gdiBhbmQgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0uZW5hYmxlZF9leHBsb2l0KSkgCiAgICAgICAgICAgIHVpLnNldF92aXNpYmxlKG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0uc2tpdHRlcl9zbGlkZXJfZGVmZW5zaXZlLHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDEgYW5kIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlX21lbnUpID09IHYgYW5kIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLnNraXR0ZXJfZGVmZW5zaXZlKSBhbmQgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0uZW5hYmxlZF9leHBsb2l0KSkKICAgICAgICBlbmQKCiAgICAgICAgdWkuc2V0X3Zpc2libGUobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5sYWJlbF9qaXR0ZXJfd2F5cyx1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSAyIGFuZCBqaXR0ZXJfcGFnZSBhbmQgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVfbWVudSldLnlhd2ppdHRlcikgfj0gImppdHRlciB3YXlzIikKICAgICAgICBmb3IgaSA9IDEsIDEyIGRvCiAgICAgICAgICAgIHVpLnNldF92aXNpYmxlKCBuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLnBlZHJvX2FhczJbaV0gICx1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSAyIGFuZCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZV9tZW51KSA9PSB2IGFuZCBpIDw9IHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLmp3YXlfY291bnRlcikgYW5kIGppdHRlcl9wYWdlIGFuZCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZV9tZW51KV0ueWF3aml0dGVyKSA9PSAiaml0dGVyIHdheXMiKQogICAgICAgICAgICAtLXByaW50KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0uc2xpZGVyW2ldKQogICAgICAgIGVuZAogICAgZW5kCgogICAgLS1hYTIKICAgIAogICAgbG9jYWwga2V5cyA9IHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJrZXlzIl0uZW5hYmxlX2tleSkKICAgIHVpLnNldF92aXNpYmxlKG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uZnJlZXN0YW5kaW5nX2Rpc2FibGVyLCB1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSAyIGFuZCBtYWluX3BhZ2UpCiAgICB1aS5zZXRfdmlzaWJsZShuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmZyZWVzdGFuZGluZ19vcHRpb25zLCB1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSAyIGFuZCBtYWluX3BhZ2UpCiAgICB1aS5zZXRfdmlzaWJsZShqaXR0ZXJfYWRkLCB1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSAyIGFuZCBqaXR0ZXJfcGFnZSBhbmQgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVfbWVudSldLnlhd2ppdHRlcikgPT0gImppdHRlciB3YXlzIiApCiAgICB1aS5zZXRfdmlzaWJsZShqaXR0ZXJfcmVtb3ZlLCB1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSAyIGFuZCBqaXR0ZXJfcGFnZSBhbmQgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVfbWVudSldLnlhd2ppdHRlcikgPT0gImppdHRlciB3YXlzIikKICAgIHVpLnNldF92aXNpYmxlKG5ld19tZW51X3JlZmVyZW5jZXNbImtleXMiXS5lbmFibGVfa2V5LCB1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSAyIGFuZCBtYWluX3BhZ2UpCiAgICB1aS5zZXRfdmlzaWJsZShuZXdfbWVudV9yZWZlcmVuY2VzWyJrZXlzIl0ubWFudWFsX2ZvcndhcmQsIHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDIgYW5kIG1haW5fcGFnZSBhbmQga2V5cykKICAgIHVpLnNldF92aXNpYmxlKG5ld19tZW51X3JlZmVyZW5jZXNbImtleXMiXS5tYW51YWxfbGVmdCwgdWlfbWVudS5zZWxlY3RlZF90YWIgPT0gMiBhbmQgbWFpbl9wYWdlIGFuZCBrZXlzKQogICAgdWkuc2V0X3Zpc2libGUobmV3X21lbnVfcmVmZXJlbmNlc1sia2V5cyJdLm1hbnVhbF9yaWdodCwgdWlfbWVudS5zZWxlY3RlZF90YWIgPT0gMiBhbmQgbWFpbl9wYWdlIGFuZCBrZXlzKQogICAgdWkuc2V0X3Zpc2libGUobmV3X21lbnVfcmVmZXJlbmNlc1sia2V5cyJdLm1hbnVhbF9yZXNldCwgdWlfbWVudS5zZWxlY3RlZF90YWIgPT0gMiBhbmQgbWFpbl9wYWdlIGFuZCBrZXlzKQogICAgdWkuc2V0X3Zpc2libGUobmV3X21lbnVfcmVmZXJlbmNlc1sia2V5cyJdLmdsb2JhbF9mcywgdWlfbWVudS5zZWxlY3RlZF90YWIgPT0gMiBhbmQgbWFpbl9wYWdlIGFuZCBrZXlzKQogICAgdWkuc2V0X3Zpc2libGUobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hbnRpX2tuaXYsIHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDIgYW5kIG1haW5fcGFnZSkKICAgIHVpLnNldF92aXNpYmxlKG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uc2FmZV9kYW5nZXJvdXMsIHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDIgYW5kIG1haW5fcGFnZSkKICAgCgogICAgZm9yIGggPSAxLCA0IGRvCiAgICAgICAKICAgICAgICB1aS5zZXRfdmlzaWJsZShuZXdfbWVudV9yZWZlcmVuY2VzWyJicnV0ZWZvcmNlIl1baF0sdWlfbWVudS5zZWxlY3RlZF90YWIgPT0gMiBhbmQgYnJ1dGVmb3JjZV9wYWdlKQogICAgZW5kCgogICAgLS12aXN1YWxzCiAgICAtLXVpLnNldF92aXNpYmxlKG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS52aXN1YWxfbGFiZWwsdWlfbWVudS5zZWxlY3RlZF90YWIgPT0gMykKICAgIHVpLnNldF92aXNpYmxlKG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS56ZXVzLHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDMpCiAgICB1aS5zZXRfdmlzaWJsZShuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uZW5hYmxlX2luZGljYXRvcnMsdWlfbWVudS5zZWxlY3RlZF90YWIgPT0gMykKICAgIHVpLnNldF92aXNpYmxlKG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS5kcmF3X2xvZ3MsdWlfbWVudS5zZWxlY3RlZF90YWIgPT0gMykKICAgIHVpLnNldF92aXNpYmxlKG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS5pbmRpY2F0b3JfY29sb3IsdWlfbWVudS5zZWxlY3RlZF90YWIgPT0gMyBhbmQgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS5lbmFibGVfaW5kaWNhdG9ycykgfj0gIm9mZiIpCiAgICB1aS5zZXRfdmlzaWJsZShuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uc2NvcGVkX2FuaW1hdGlvbix1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSAzICkKICAgIHVpLnNldF92aXNpYmxlKG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS5pbmRpY2F0b3JfbWFudWFsX2NvbG9yLHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDMgYW5kIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uZW5hYmxlX21hbnVhbCkgfj0gIm9mZiIpCiAgICB1aS5zZXRfdmlzaWJsZShuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uZW5hYmxlX21hbnVhbCx1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSAzKQogICAgdWkuc2V0X3Zpc2libGUobmV3X21lbnVfcmVmZXJlbmNlc1sidmlzdWFscyJdLmVuYWJsZV9taW5fZG1nX292cnJkLHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDMpCiAgICB1aS5zZXRfdmlzaWJsZShuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uZW5hYmxlX2Rlc3luY19pbmRpY2F0b3IsdWlfbWVudS5zZWxlY3RlZF90YWIgPT0gMykKICAgIHVpLnNldF92aXNpYmxlKG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS5lbmFibGVfdmVsb2NpdHlfYWRhcHRpdmUsIHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDMgYW5kIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uZW5hYmxlX21hbnVhbCkgfj0gIm9mZiIpCiAgICB1aS5zZXRfdmlzaWJsZShuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uZW5hYmxlX2RlZmVuc2l2ZV9pbmRpY2F0b3IsdWlfbWVudS5zZWxlY3RlZF90YWIgPT0gMykKICAgIHVpLnNldF92aXNpYmxlKG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS5zbG93X2luZGljYXRvcix1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSAzKQogICAgdWkuc2V0X3Zpc2libGUobmV3X21lbnVfcmVmZXJlbmNlc1sidmlzdWFscyJdLmluZGljYXRvcl9kZXN5bmNfY29sb3IsdWlfbWVudS5zZWxlY3RlZF90YWIgPT0gMyBhbmQgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS5lbmFibGVfZGVzeW5jX2luZGljYXRvcikpCiAgICB1aS5zZXRfdmlzaWJsZShuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uaW5kaWNhdG9yX2RlZmVuc2l2ZV9jb2xvcix1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSAzIGFuZCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sidmlzdWFscyJdLmVuYWJsZV9kZWZlbnNpdmVfaW5kaWNhdG9yKSkKICAgIHVpLnNldF92aXNpYmxlKG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS5pbmRpY2F0b3Jfc2xvd19jb2xvcix1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSAzIGFuZCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sidmlzdWFscyJdLnNsb3dfaW5kaWNhdG9yKSkKICAgIHVpLnNldF92aXNpYmxlKG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS5haW1fbG9nc19sYWJlbCwgdWlfbWVudS5zZWxlY3RlZF90YWIgPT0gMyBhbmQgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS5haW1lcl9sZWdzKSkKICAgIHVpLnNldF92aXNpYmxlKG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS5haW1fbG9nc19vdXRsaW5lX2NvbG9yLCB1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSAzIGFuZCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sidmlzdWFscyJdLmFpbWVyX2xlZ3MpKQogICAgdWkuc2V0X3Zpc2libGUobmV3X21lbnVfcmVmZXJlbmNlc1sidmlzdWFscyJdLndhdGVybWFya19jb2xvciwgdWlfbWVudS5zZWxlY3RlZF90YWIgPT0gMykKICAgIHVpLnNldF92aXNpYmxlKG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS53YXRlcm1hcmtfbGFiZWwsIHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDMpCiAgICB1aS5zZXRfdmlzaWJsZShuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uZXh0cmFfdmlzdWFscyx1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSAzKQogICAgdWkuc2V0X3Zpc2libGUobmV3X21lbnVfcmVmZXJlbmNlc1sidmlzdWFscyJdLm5vdGlfdGltZXIsdWlfbWVudS5zZWxlY3RlZF90YWIgPT0gMyBhbmQgKHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uYWltZXJfbGVncykgb3IgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS53aGF0c2FwcGkpKSkKICAgIHVpLnNldF92aXNpYmxlKG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS5ub3RpX3BhZGRpbmcsdWlfbWVudS5zZWxlY3RlZF90YWIgPT0gMyBhbmQgIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0ud2hhdHNhcHBpKSkKICAgIAogICAgLS1taXNjCiAgICAtLXVpLnNldF92aXNpYmxlKG5ld19tZW51X3JlZmVyZW5jZXNbIm1pc2MiXS5taXNjX2xhYmVsLHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDQpCiAgICB1aS5zZXRfdmlzaWJsZShuZXdfbWVudV9yZWZlcmVuY2VzWyJtaXNjIl0uZW5hYmxlX2NsYW5fdGFnLHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDQpCiAgICB1aS5zZXRfdmlzaWJsZShuZXdfbWVudV9yZWZlcmVuY2VzWyJtaXNjIl0uZW5hYmxlX2tpbGxfc2F5LHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDQpCiAgICB1aS5zZXRfdmlzaWJsZShuZXdfbWVudV9yZWZlcmVuY2VzWyJtaXNjIl0uZW5hYmxlX3N1bl9yaXNlLHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDQpCiAgICB1aS5zZXRfdmlzaWJsZShuZXdfbWVudV9yZWZlcmVuY2VzWyJtaXNjIl0uZW5hYmxlX25pZ3RoZXJtb2RlLHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDQpCiAgICB1aS5zZXRfdmlzaWJsZShuZXdfbWVudV9yZWZlcmVuY2VzWyJtaXNjIl0uZW5hYmxlX2xvY2FsX2FuaW1hdGlvbnMsdWlfbWVudS5zZWxlY3RlZF90YWIgPT0gNCkKICAgIHVpLnNldF92aXNpYmxlKG5ld19tZW51X3JlZmVyZW5jZXNbIm1pc2MiXS5zYWZlX3BvaW50LHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDQgYW5kIHRhYmxlX2NvbnRhaW5zKHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJtaXNjIl0uZGVidWdfcmFnZWJvdCksInNhZmUgcG9pbnQgZW5oYW5jZXIiKSkKICAgIHVpLnNldF92aXNpYmxlKG5ld19tZW51X3JlZmVyZW5jZXNbIm1pc2MiXS5kZWJ1Z19yYWdlYm90LHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDQpCgogICAgLS1jb25maWcKICAgIC0tdWkuc2V0X3Zpc2libGUobmV3X21lbnVfcmVmZXJlbmNlcy5jb25maWcuY29uZmlnX2xhYmVsLHVpX21lbnUuc2VsZWN0ZWRfdGFiID09IDUpCiAgICB1aS5zZXRfdmlzaWJsZShuZXdfbWVudV9yZWZlcmVuY2VzLmNvbmZpZy5leHBvcnRfZmlsZSx1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSA1KQogICAgdWkuc2V0X3Zpc2libGUobmV3X21lbnVfcmVmZXJlbmNlcy5jb25maWcuaW1wb3J0X2NvbmZpZyx1aV9tZW51LnNlbGVjdGVkX3RhYiA9PSA1KQplbmQKCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInBsYXllcl9kZWF0aCIsZnVuY3Rpb24oZW50KQoKICAgIGlmIGNsaWVudC51c2VyaWRfdG9fZW50aW5kZXgoZW50LnVzZXJpZCkgPT0gZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSB0aGVuCiAgICAgICAgYnJ1dGVfc3RhZ2UubGFzdF9taXNzID0gMAogICAgICAgIGZvciBrLHYgaW4gaXBhaXJzKGFhLmFhX3N0YXRlcykgZG8KCiAgICAgICAgICAgIGlmIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLnlhdykgPT0gImwgJiByIiBvciB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS55YXcpID09ICJkZWxheWVkIiBvciB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS55YXcpID09ICJqaXR0ZXJ5IiB0aGVuCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlbmQKICAgICAgICAgIAogICAgICAgICAgICBpZiB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVt2XS5nc19ib2R5eWF3KSA9PSAiYW50aSBicnV0ZWZvcmNlIiBhbmQgbm90IGJydXRlX3N0YWdlLnRvX3Jlc2V0IHRoZW4KICAgICAgICAgICAgICAgIGJydXRlX3N0YWdlLmJydXRlW3ZdLm1pc3NlZF9idWxsZXRzID0gMAogICAgICAgICAgICAgICAgcHJpbnQoIkFudGkgYnJ1dGVmb3JjZSBhbmdsZXMgd2VyZSByZXNldHRlZCBkdWUgdG8gZGVhdGgiKQogICAgICAgICAgICAgICAgYnJ1dGVfc3RhZ2UudG9fcmVzZXQgPSB0cnVlCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCgogICAgaWYgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbIm1pc2MiXS5lbmFibGVfa2lsbF9zYXkpIH49ICJEaXNhYmxlZCIgYW5kIGNsaWVudC51c2VyaWRfdG9fZW50aW5kZXgoZW50LmF0dGFja2VyKSA9PSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpIGFuZCBlbnRpdHkuZ2V0X3Byb3AoY2xpZW50LnVzZXJpZF90b19lbnRpbmRleChlbnQudXNlcmlkKSwibV9pVGVhbU51bSIpIH49IGVudGl0eS5nZXRfcHJvcChlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCJtX2lUZWFtTnVtIikgdGhlbgogICAgICAgCiAgICAgICAgY2xpZW50LmV4ZWMoInNheSAiIC4uIG1pc2NfZnVuY3Rpb25zLmtpbGxfc2F5W3VpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJtaXNjIl0uZW5hYmxlX2tpbGxfc2F5KV1bY2xpZW50LnJhbmRvbV9pbnQoMSwgI21pc2NfZnVuY3Rpb25zLmtpbGxfc2F5W3VpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJtaXNjIl0uZW5hYmxlX2tpbGxfc2F5KV0pXSkKICAgIGVuZAplbmQpCgoKY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygicm91bmRfZW5kIixmdW5jdGlvbihlKQogICBicnV0ZV9zdGFnZS5yb3VuZF9zdGFydGluZyA9IHRydWUgIAplbmQpCgpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJyb3VuZF9zdGFydCIsZnVuY3Rpb24oZW50KQogICAgaWYgYnJ1dGVfc3RhZ2Uucm91bmRfc3RhcnRpbmcgPT0gdHJ1ZSBhbmQgYnJ1dGVfc3RhZ2UudG9fcmVzZXQgPT0gZmFsc2UgdGhlbgogICAgICAgCiAgICAgICAgZm9yIGssdiBpbiBpcGFpcnMoYWEuYWFfc3RhdGVzKSBkbwoKICAgICAgICAgICAgaWYgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0ueWF3KSA9PSAibCAmIHIiIG9yIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLnlhdykgPT0gImRlbGF5ZWQiIG9yIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlW3ZdLnlhdykgPT0gImppdHRlcnkiIHRoZW4KICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVbdl0uZ3NfYm9keXlhdykgPT0gImFudGkgYnJ1dGVmb3JjZSIgdGhlbgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBicnV0ZV9zdGFnZS5icnV0ZVt2XS5taXNzZWRfYnVsbGV0cyA9IDAKICAgICAgICAgICAgICAgIHByaW50KCJBbnRpIGJydXRlZm9yY2UgYW5nbGVzIHdlcmUgcmVzZXR0ZWQgZHVlIHRvIHJvdW5kIHN0YXJ0IikKICAgICAgICAgICAgICAgIGJydXRlX3N0YWdlLnJvdW5kX3N0YXJ0aW5nID0gZmFsc2UKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAgICAgCiAgICBlbmQKCiAgICBtaXNzX3NwID0ge30KICAgIGJydXRlX3N0YWdlLnRvX3Jlc2V0ID0gZmFsc2UKICAgIGFhX2Z1bmN0aW9ucy5ib21iX3dhc19ib21iZWQgPSBmYWxzZQogICAgYWFfZnVuY3Rpb25zLmJvbWJfd2FzX2RlZnVzZWQgPSBmYWxzZQplbmQpCgoKZnVuY3Rpb24gbWlzY19mdW5jdGlvbnM6bG9jYWxfYW5pbWF0aW9ucygpCgogICAgaWYgbm90IGVudGl0eS5pc19hbGl2ZShlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpKSB0aGVuCiAgICAgICAgbWlzY19mdW5jdGlvbnMuZW5kX3RpbWUgPSAwCiAgICAgICAgbWlzY19mdW5jdGlvbnMuZ3JvdW5kX3RpY2tzID0gMAogICAgICAgIHJldHVybgogICAgZW5kCgogICAgaWYgdGFibGVfY29udGFpbnModWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbIm1pc2MiXS5lbmFibGVfbG9jYWxfYW5pbWF0aW9ucyksInBpdGNoIDAiKSB0aGVuCgogICAgICAgIAogICAgICAgIGxvY2FsIG9uX2dyb3VuZCA9IGJpdC5iYW5kKGVudGl0eS5nZXRfcHJvcChlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCAibV9mRmxhZ3MiKSwgMSkKCiAgICAgICAgaWYgb25fZ3JvdW5kID09IDEgdGhlbgogICAgICAgICAgICBtaXNjX2Z1bmN0aW9ucy5ncm91bmRfdGlja3MgPSBtaXNjX2Z1bmN0aW9ucy5ncm91bmRfdGlja3MgKyAxCiAgICAgICAgZWxzZQogICAgICAgICAgICBtaXNjX2Z1bmN0aW9ucy5ncm91bmRfdGlja3MgPSAwCiAgICAgICAgICAgIG1pc2NfZnVuY3Rpb25zLmVuZF90aW1lID0gZ2xvYmFscy5jdXJ0aW1lKCkgKyAxCiAgICAgICAgZW5kCgogICAgICAgIGlmICBtaXNjX2Z1bmN0aW9ucy5ncm91bmRfdGlja3MgPiA1IGFuZCBtaXNjX2Z1bmN0aW9ucy5lbmRfdGltZSArIDAuNSA+IGdsb2JhbHMuY3VydGltZSgpIHRoZW4KICAgICAgICAgICAgZW50aXR5LnNldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX2ZsUG9zZVBhcmFtZXRlciIsIDAuNSwgMTIpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBpZiB0YWJsZV9jb250YWlucyh1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sibWlzYyJdLmVuYWJsZV9sb2NhbF9hbmltYXRpb25zKSwicmV2ZXJzZWQgbGVncyIpIHRoZW4KICAgICAgICBsb2NhbCBtYXRoX3JhbmRvbWl6ZWQgPSBtYXRoLnJhbmRvbSgxLDIpCgogICAgICAgIHVpLnNldChtZW51X3JlZmVyZW5jZS5sZWdfbW92ZW1lbnQsIG1hdGhfcmFuZG9taXplZCA9PSAxIGFuZCAiQWx3YXlzIHNsaWRlIiBvciAiTmV2ZXIgc2xpZGUiKQogICAgICAgIGVudGl0eS5zZXRfcHJvcChlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCAibV9mbFBvc2VQYXJhbWV0ZXIiLCA4LCAwKQogICAgZW5kCgogICAgaWYgdGFibGVfY29udGFpbnModWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbIm1pc2MiXS5lbmFibGVfbG9jYWxfYW5pbWF0aW9ucyksInN0YXRpYyBsZWdzIikgdGhlbgogICAgICAgIGVudGl0eS5zZXRfcHJvcChlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCAibV9mbFBvc2VQYXJhbWV0ZXIiLCAxLCA2KSAKICAgIGVuZAoKICAgIGlmIHRhYmxlX2NvbnRhaW5zKHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJtaXNjIl0uZW5hYmxlX2xvY2FsX2FuaW1hdGlvbnMpLCJtb29ud2FsayIpIHRoZW4KICAgICAgIAoKICAgICAgICBsb2NhbCBtZSA9IGVudC5nZXRfbG9jYWxfcGxheWVyKCkKICAgICAgICBsb2NhbCBtX2ZGbGFncyA9IG1lOmdldF9wcm9wKCJtX2ZGbGFncyIpCiAgICAgICAgbG9jYWwgaXNfb25ncm91bmQgPSBiaXQuYmFuZChtX2ZGbGFncywgMSkgfj0gMAogICAgICAgIGlmIG5vdCBpc19vbmdyb3VuZCB0aGVuCiAgICAgICAgICAgIGxvY2FsIG15X2FuaW1sYXllciA9IG1lOmdldF9hbmltX292ZXJsYXkoNikgCiAgICAgICAgICAgCiAgICAgICAgICAgIG15X2FuaW1sYXllci53ZWlnaHQgPSAxCiAgICAgICAgZWxzZQogICAgICAgICAgICB1aS5zZXQobWVudV9yZWZlcmVuY2UubGVnX21vdmVtZW50LCJPZmYiKQogICAgICAgICAgICBlbnRpdHkuc2V0X3Byb3AoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSwgIm1fZmxQb3NlUGFyYW1ldGVyIiwgMCwgNykKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGlmIHRhYmxlX2NvbnRhaW5zKHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJtaXNjIl0uZW5hYmxlX2xvY2FsX2FuaW1hdGlvbnMpLCJibGluZCIpIHRoZW4KCiAgICAgICAgbG9jYWwgbm90X25pZ2dhbmlnZ2EgPSBlbnQuZ2V0X2xvY2FsX3BsYXllcigpIAogICAgICAgIGxvY2FsIG5vdF9hbmltX2xheWVyID0gbm90X25pZ2dhbmlnZ2E6Z2V0X2FuaW1fb3ZlcmxheSg5KSAKICAgICAgICBub3RfYW5pbV9sYXllci53ZWlnaHQgPSAxCiAgICAgICAgbm90X2FuaW1fbGF5ZXIuc2VxdWVuY2UgPSAyMjQKICAgIGVuZAoKICAgIGlmIHRhYmxlX2NvbnRhaW5zKHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJtaXNjIl0uZW5hYmxlX2xvY2FsX2FuaW1hdGlvbnMpLCJ0LXBvc2UiKSB0aGVuCgogICAgICAgIGxvY2FsIG5vdF9uaWdnYW5pZ2dhID0gZW50LmdldF9sb2NhbF9wbGF5ZXIoKSAKICAgICAgICBsb2NhbCBub3RfYW5pbV9sYXllciA9IG5vdF9uaWdnYW5pZ2dhOmdldF9hbmltX292ZXJsYXkoMCkKICAgICAgICBub3RfYW5pbV9sYXllci5zZXF1ZW5jZSA9IDExCiAgICBlbmQKICAKICAgCmVuZAoKY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygiYnVsbGV0X2ltcGFjdCIsIGFhX2Z1bmN0aW9ucy5hbnRpX2JydXRlX2J1bGxldF9pbXBhY3QpCgpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJwcmVfcmVuZGVyIiwgZnVuY3Rpb24oKQogICAgbWlzY19mdW5jdGlvbnM6bG9jYWxfYW5pbWF0aW9ucygpCmVuZCkKCmxvY2FsIGFpbV9sb2dzID0ge30KbG9jYWwgcmVhc29uID0gInNwcmVhZCIKCmxvY2FsIGhpdGdyb3VwX25hbWVzID0geydHZW5lcmljJywgJ0hlYWQnLCAnQ2hlc3QnLCAnU3RvbWFjaCcsICdMZWZ0IGFybScsICdSaWdodCBhcm0nLCAnTGVmdCBsZWcnLCAnUmlnaHQgbGVnJywgJ05lY2snLCAnPycsICdHZWFyJ30KCmxvY2FsIHBsYXllcl9ocF9vbl9maXJlID0gMTAwCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soImFpbV9maXJlIixmdW5jdGlvbihlbnQpCiAgICBwbGF5ZXJfaHBfb25fZmlyZSA9IGVudGl0eS5nZXRfcHJvcChlbnQudGFyZ2V0LCJtX2lIZWFsdGgiKQogICAgdmlzdWFsX2Z1bmN0aW9ucy5pbl9maXJlID0gdHJ1ZQoKICAgIHZpc3VhbF9mdW5jdGlvbnMuY2hhbmNlID0gbWF0aC5mbG9vcihlbnQuaGl0X2NoYW5jZSkKICAgIHZpc3VhbF9mdW5jdGlvbnMuYnQgPSBnbG9iYWxzLnRpY2tjb3VudCgpIC0gZW50LnRpY2sKICAgIHZpc3VhbF9mdW5jdGlvbnMucHJlZGljdGVkX2RhbWFnZSA9IGVudC5kYW1hZ2UKICAgIHZpc3VhbF9mdW5jdGlvbnMucHJlZGljdGVkX2hpdGdyb3VwID0gZW50LmhpdGdyb3VwCmVuZCkKCmxvY2FsIHJhbmRvbV9yZXNvbHZlcl92YWx1ZSA9IHsiQiIsIlNCWSIsIlNCQVkiLCJCWSIsIlNFIiwiU0IiLCJTQk0iLCJTIn0KCmxvY2FsIG1pc3Nfc3AgPSB7fQoKY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygiYWltX21pc3MiLGZ1bmN0aW9uKGVudCkKCiAgICBsb2NhbCBncm91cCA9IGhpdGdyb3VwX25hbWVzW2VudC5oaXRncm91cCArIDFdIG9yICI/IgogICAgbG9jYWwgbmFtZSA9IGVudGl0eS5nZXRfcGxheWVyX25hbWUoZW50LnRhcmdldCkKICAgIGxvY2FsIGhwX2xlZnQgPSBlbnRpdHkuZ2V0X3Byb3AoZW50LnRhcmdldCwgIm1faUhlYWx0aCIpCiAgICBsb2NhbCBqcyA9IHBhbm9yYW1hLm9wZW4oKQogICAgbG9jYWwgcGVyc29uYV9hcGkgPSBqcy5NeVBlcnNvbmFBUEkKICAgIGxvY2FsIHVzZXJuYW1lID0gcGVyc29uYV9hcGkuR2V0TmFtZSgpICAKICAgIGxvY2FsIHRhcmdldG5hbWUgPSBuYW1lOwogICAgbG9jYWwgaGl0Ym94ID0gZ3JvdXA7CiAgICBsb2NhbCBoYyA9IHZpc3VhbF9mdW5jdGlvbnMuY2hhbmNlOwogICAgbG9jYWwgYmFja3RyYWNrID0gdmlzdWFsX2Z1bmN0aW9ucy5idDsKCiAgICBpZiBlbnQucmVhc29uID09ICI/IiB0aGVuCiAgICAgICAgcmVhc29uID0gInVua25vd24iCiAgICBlbHNlCiAgICAgICAgcmVhc29uID0gZW50LnJlYXNvbgogICAgZW5kCgogICAgbWlzc19zcFsjbWlzc19zcCArIDFdID0gCiAgICB7CiAgICAgICAgbmlnZ2EgPSBlbnQudGFyZ2V0LAogICAgICAgIGhwID0gZW50aXR5LmdldF9wcm9wKGVudC50YXJnZXQsICJtX2lIZWFsdGgiKSwKICAgIH0KICAgCiAgICBhaW1fbG9nc1sjYWltX2xvZ3MgKyAxXSA9IAogICAgewogICAgICAgIHRleHQgPSBzdHJpbmcuZm9ybWF0KCJNaXNzZWQgXGFGRjAwMzJGRiVzXGFGRkZGRkZGRiBpbiB0aGUgXGFGRjAwMzJGRiVzXGFGRkZGRkZGRiBzaG90IGR1ZSB0byBcYUZGMDAzMkZGJXNcYUZGRkZGRkZGIixuYW1lLHN0cmluZy5sb3dlcihoaXRib3gpLHN0cmluZy5sb3dlcihyZWFzb24pKSwKICAgICAgICB0aW1lciA9IGdsb2JhbHMudGlja2NvdW50KCkgKiBnbG9iYWxzLnRpY2tpbnRlcnZhbCgpLAogICAgICAgIGFscGhhID0gMjU1LAogICAgICAgIGhpdCA9IGZhbHNlLAogICAgfQoKICAgIGlmIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uZHJhd19sb2dzKSB0aGVuCiAgICAgICAgcHJpbnQoc3RyaW5nLmZvcm1hdCgiTWlzc2VkIHNob3QgZHVlIHRvICVzIixyZWFzb24pKQogICAgZW5kCgoKICAgIGlmIHRhYmxlX2NvbnRhaW5zKHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uZXh0cmFfdmlzdWFscyksImJldGEgbG9ncyIpIHRoZW4KICAgICAgCiAgICAgICAgaWYgZ2V0X3ZlbG9jaXR5KGVudC50YXJnZXQpID4gMiB0aGVuCiAgICAgICAgICAgIHZpc3VhbF9mdW5jdGlvbnMubW92ZSA9IDEKICAgICAgICBlbHNlCiAgICAgICAgICAgIHZpc3VhbF9mdW5jdGlvbnMubW92ZSA9IDAKICAgICAgICBlbmQKCgogICAgICAgIGxvY2FsIGJldGFfc3RyaW5nID0gIGNsaWVudC5jb2xvcl9sb2coMjU1LDEzMCwxMjAsIHN0cmluZy5mb3JtYXQoIlstXSBNaXNzZWQgJXMncyAlcyBmb3IgJXMgZGFtYWdlICglcykgZHVlIHRvICVzIGJ0PSVkbXMgKCVzKSBbMjoxOjI34oG6OjE24oG6XSAlcyBtb3ZlPSVzIHQ9JXMgYm9uZXlhdz0lcy4lcyVzJXMiLG5hbWUsaGl0Ym94LHZpc3VhbF9mdW5jdGlvbnMucHJlZGljdGVkX2RhbWFnZSxoYyAuLiAiJSIscmVhc29uLCB0b251bWJlcih0b3RpbWUoYmFja3RyYWNrKSAqIDEwMDApLGJhY2t0cmFjayxyYW5kb21fcmVzb2x2ZXJfdmFsdWVbY2xpZW50LnJhbmRvbV9pbnQoMSwjcmFuZG9tX3Jlc29sdmVyX3ZhbHVlKV0KICAgICx2aXN1YWxfZnVuY3Rpb25zLm1vdmUsY2xpZW50LnJhbmRvbV9pbnQoMCwzMCksY2xpZW50LnJhbmRvbV9pbnQoLTEwMCwxMDApLGNsaWVudC5yYW5kb21faW50KDAwLDk5KSxjbGllbnQucmFuZG9tX2ludCgwMCw5OSksY2xpZW50LnJhbmRvbV9pbnQoMDAsOTkpKSk7CiAgICBlbmQKZW5kKQoKY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygiYWltX2hpdCIsZnVuY3Rpb24oZW50KQoKICAgbG9jYWwgbGVmdF9ocCA9IHBsYXllcl9ocF9vbl9maXJlIC0gZW50LmRhbWFnZSAKCiAgIGxvY2FsIGdyb3VwID0gaGl0Z3JvdXBfbmFtZXNbZW50LmhpdGdyb3VwICsgMV0gb3IgIj8iCiAgIGxvY2FsIG5hbWUgPSBlbnRpdHkuZ2V0X3BsYXllcl9uYW1lKGVudC50YXJnZXQpCiAgIGxvY2FsIGRhbWFnZSA9IGVudC5kYW1hZ2UKICAgbG9jYWwgaHBfbGVmdCA9IGVudGl0eS5nZXRfcHJvcChlbnQudGFyZ2V0LCAibV9pSGVhbHRoIikKICAgbG9jYWwganMgPSBwYW5vcmFtYS5vcGVuKCkKICAgbG9jYWwgcGVyc29uYV9hcGkgPSBqcy5NeVBlcnNvbmFBUEkKICAgbG9jYWwgdXNlcm5hbWUgPSBwZXJzb25hX2FwaS5HZXROYW1lKCkgIAogICBsb2NhbCB0YXJnZXRuYW1lID0gbmFtZQogICBsb2NhbCBoaXRib3ggPSBncm91cAogICBsb2NhbCBkbWcgPSBkYW1hZ2UKICAgbG9jYWwgaGMgPSB2aXN1YWxfZnVuY3Rpb25zLmNoYW5jZQogICBsb2NhbCBiYWNrdHJhY2sgPSB2aXN1YWxfZnVuY3Rpb25zLmJ0OwogICBsb2NhbCBwcmVkaWN0ZWRfZ3JvdXAgPSBoaXRncm91cF9uYW1lc1t2aXN1YWxfZnVuY3Rpb25zLnByZWRpY3RlZF9oaXRncm91cCArIDFdIG9yICI/IgoKICAgaWYgbGVmdF9ocCA8IDAgdGhlbgogICAgbGVmdF9ocCA9IDAKICAgZW5kCgogICAgYWltX2xvZ3NbI2FpbV9sb2dzICsgMV0gPSAKICAgIHsKICAgICAgICB0ZXh0ID0gc3RyaW5nLmZvcm1hdCgiSGl0IFxhOTZDODNDRkYlc1xhRkZGRkZGRkYgaW4gdGhlIFxhOTZDODNDRkYlc1xhRkZGRkZGRkYgZm9yIFxhOTZDODNDRkYlc1xhRkZGRkZGRkYgZGFtYWdlIChcYTk2QzgzQ0ZGJXNcYUZGRkZGRkZGIGhlYWx0aCByZW1haW5pbmcpIixlbnRpdHkuZ2V0X3BsYXllcl9uYW1lKGVudC50YXJnZXQpLHN0cmluZy5sb3dlcihoaXRncm91cF9uYW1lc1tlbnQuaGl0Z3JvdXAgKyAgMV0pLGVudC5kYW1hZ2UsbGVmdF9ocCksCiAgICAgICAgdGltZXIgPSBnbG9iYWxzLnRpY2tjb3VudCgpICogZ2xvYmFscy50aWNraW50ZXJ2YWwoKSwKICAgICAgICBhbHBoYSA9IDI1NSwKICAgICAgICBzdGF0ZSA9IHRydWUsCiAgICB9CgogICAgaWYgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS5kcmF3X2xvZ3MpIHRoZW4KICAgICAgICBwcmludChzdHJpbmcuZm9ybWF0KCJIaXQgJXMgaW4gdGhlICVzIGZvciAlcyBkYW1hZ2UgKCVzIGhlYWx0aCByZW1haW5pbmcpIixlbnRpdHkuZ2V0X3BsYXllcl9uYW1lKGVudC50YXJnZXQpLGhpdGdyb3VwX25hbWVzW2VudC5oaXRncm91cCArICAxXSxlbnQuZGFtYWdlLGxlZnRfaHApKQogICAgZW5kCgogICAgaWYgdGFibGVfY29udGFpbnModWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS5leHRyYV92aXN1YWxzKSwiYmV0YSBsb2dzIikgdGhlbgogICAgICAgIGlmIHZpc3VhbF9mdW5jdGlvbnMucHJlZGljdGVkX2RhbWFnZSA+IGRhbWFnZSB0aGVuCiAgICAgICAgICAgIHZpc3VhbF9mdW5jdGlvbnMuY2FsY19kbWcgPSB2aXN1YWxfZnVuY3Rpb25zLnByZWRpY3RlZF9kYW1hZ2UgLSBkYW1hZ2UKICAgICAgICAgICAgdmlzdWFsX2Z1bmN0aW9ucy5kYW1hZ2VfcHJlZGljdF9zdHJpbmdfY2FsYyA9ICItIiAuLiB0b3N0cmluZyh2aXN1YWxfZnVuY3Rpb25zLmNhbGNfZG1nKQogICAgICAgIGVsc2VpZiB2aXN1YWxfZnVuY3Rpb25zLnByZWRpY3RlZF9kYW1hZ2UgPCBkYW1hZ2UgdGhlbgogICAgICAgICAgICB2aXN1YWxfZnVuY3Rpb25zLmNhbGNfZG1nID0gZGFtYWdlIC0gdmlzdWFsX2Z1bmN0aW9ucy5wcmVkaWN0ZWRfZGFtYWdlCiAgICAgICAgICAgIHZpc3VhbF9mdW5jdGlvbnMuZGFtYWdlX3ByZWRpY3Rfc3RyaW5nX2NhbGMgPSAiKyIgLi4gdG9zdHJpbmcodmlzdWFsX2Z1bmN0aW9ucy5jYWxjX2RtZykKICAgICAgICBlbHNlaWYgdmlzdWFsX2Z1bmN0aW9ucy5wcmVkaWN0ZWRfZGFtYWdlID09IGRhbWFnZSB0aGVuCiAgICAgICAgICAgIHZpc3VhbF9mdW5jdGlvbnMuZGFtYWdlX3ByZWRpY3Rfc3RyaW5nX2NhbGMgPSAiKzAiCiAgICAgICAgZW5kCgogICAgICAgIGlmIGdldF92ZWxvY2l0eShlbnQudGFyZ2V0KSA+IDIgdGhlbgogICAgICAgICAgICB2aXN1YWxfZnVuY3Rpb25zLm1vdmUgPSAxCiAgICAgICAgZWxzZQogICAgICAgICAgICB2aXN1YWxfZnVuY3Rpb25zLm1vdmUgPSAwCiAgICAgICAgZW5kCgoKICAgICAgICBsb2NhbCBiZXRhX3N0cmluZyA9ICBjbGllbnQuY29sb3JfbG9nKDE2MCwxODAsMTAwLCBzdHJpbmcuZm9ybWF0KCJbK10gSGl0ICVzJ3MgJXMgZm9yICVzICglcykgZGFtYWdlICglcykgYnQ9JWRtcyAoJXMpIFsyOjE6Mjfigbo6MTbigbpdICVzIG1vdmU9JXMgdD0lcyBib25leWF3PSVzLiVzJXMlcyIsbmFtZSxoaXRib3gsZGFtYWdlLHZpc3VhbF9mdW5jdGlvbnMuZGFtYWdlX3ByZWRpY3Rfc3RyaW5nX2NhbGMsaGMgLi4gIiUiLCB0b251bWJlcih0b3RpbWUoYmFja3RyYWNrKSAqIDEwMDApLGJhY2t0cmFjayxyYW5kb21fcmVzb2x2ZXJfdmFsdWVbY2xpZW50LnJhbmRvbV9pbnQoMSwjcmFuZG9tX3Jlc29sdmVyX3ZhbHVlKV0KICAgICx2aXN1YWxfZnVuY3Rpb25zLm1vdmUsY2xpZW50LnJhbmRvbV9pbnQoMCwzMCksY2xpZW50LnJhbmRvbV9pbnQoLTEwMCwxMDApLGNsaWVudC5yYW5kb21faW50KDAwLDk5KSxjbGllbnQucmFuZG9tX2ludCgwMCw5OSksY2xpZW50LnJhbmRvbV9pbnQoMDAsOTkpKSk7CiAgICBlbmQKZW5kKQoKbG9jYWwgZnVuY3Rpb24gcmlnaHRfYWxwaGEoY29uZGl0aW9uLGFscGhhMSxhbHBoYTIpCiAgICBpZiBjb25kaXRpb24gPT0gdHJ1ZSB0aGVuCiAgICAgICAgcmV0dXJuIGFscGhhMgogICAgZW5kCgogICAgcmV0dXJuIGFscGhhMQplbmQKCmZ1bmN0aW9uIHZpc3VhbF9mdW5jdGlvbnM6bm90aWZjYXRpb24oKQoKCiAgICBpZiB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sidmlzdWFscyJdLmFpbWVyX2xlZ3MpIHRoZW4KCiAgICAgICAgbG9jYWwgdyxoID0gY2xpZW50LnNjcmVlbl9zaXplKCkKICAgICAgICBmb3IgaSA9IDEsI2FpbV9sb2dzIGRvCiAgICAKICAgICAgICAgICAgaWYgYWltX2xvZ3NbaV0gPT0gbmlsIHRoZW4gCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICBpZiBub3QgYWltX2xvZ3NbaV0uaW5pdCB0aGVuIAogICAgICAgICAgICAgICAgYWltX2xvZ3NbaV0ucG9zX2FuaW1hdGlvbiA9IHcgKyA1MAogICAgICAgICAgICAgICAgYWltX2xvZ3NbaV0ueF9hbmltYXRpb24gPSAwCiAgICAgICAgICAgICAgICBhaW1fbG9nc1tpXS5pbml0ID0gdHJ1ZQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGFpbV9sb2dzW2ldLnBvc19hbmltYXRpb24gPSBsZXJwKGFpbV9sb2dzW2ldLnBvc19hbmltYXRpb24sKGgvIDIgKyAoaCAvIDIgKiAwLjc1KSkgLSBpICogMzUsZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDEwKQogICAgCiAgICAgICAgICAgIGxvY2FsIG1lYXN1cmUgPSB7IHJlbmRlcmVyLm1lYXN1cmVfdGV4dCgiYyIsIGFpbV9sb2dzW2ldLnRleHQpIH0KCiAgICAgICAgICAgIGxvY2FsIG91dGxpbmV6X2NvbG9yID0geyB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sidmlzdWFscyJdLmFpbV9sb2dzX291dGxpbmVfY29sb3IpIH0KICAgIAoKICAgICAgICAgICAgcmVuZGVyZXIuY2lyY2xlX291dGxpbmUoKHcgLyAyKSAgLSBtZWFzdXJlWzFdLzIsbWF0aC5jZWlsKGFpbV9sb2dzW2ldLnBvc19hbmltYXRpb24pLTEsb3V0bGluZXpfY29sb3JbMV0sIG91dGxpbmV6X2NvbG9yWzJdLCBvdXRsaW5lel9jb2xvclszXSwgb3V0bGluZXpfY29sb3JbNF0sNiwgMTgwLCAwLjI1LCAyKQogICAgICAgICAgICByZW5kZXJlci5jaXJjbGVfb3V0bGluZSgodyAvIDIpICArIG1lYXN1cmVbMV0vMixtYXRoLmNlaWwoYWltX2xvZ3NbaV0ucG9zX2FuaW1hdGlvbiktMSxvdXRsaW5lel9jb2xvclsxXSwgb3V0bGluZXpfY29sb3JbMl0sIG91dGxpbmV6X2NvbG9yWzNdLCBvdXRsaW5lel9jb2xvcls0XSw2LCAyNzAsIDAuMjUsIDIpCiAgICAgICAgICAgIHJlbmRlcmVyLmNpcmNsZV9vdXRsaW5lKCh3IC8gMikgIC0gbWVhc3VyZVsxXS8yLG1hdGguY2VpbChhaW1fbG9nc1tpXS5wb3NfYW5pbWF0aW9uKS0xKzE1LG91dGxpbmV6X2NvbG9yWzFdLCBvdXRsaW5lel9jb2xvclsyXSwgb3V0bGluZXpfY29sb3JbM10sIG91dGxpbmV6X2NvbG9yWzRdLDYsIDkwLCAwLjI1LCAyKQogICAgICAgICAgICByZW5kZXJlci5jaXJjbGVfb3V0bGluZSgodyAvIDIpICArIG1lYXN1cmVbMV0vMixtYXRoLmNlaWwoYWltX2xvZ3NbaV0ucG9zX2FuaW1hdGlvbiktMSsxNSxvdXRsaW5lel9jb2xvclsxXSwgb3V0bGluZXpfY29sb3JbMl0sIG91dGxpbmV6X2NvbG9yWzNdLCBvdXRsaW5lel9jb2xvcls0XSw2LCAwLCAwLjI1LCAyKQoKICAgICAgICAgICAgcmVuZGVyZXIuZ3JhZGllbnQoKHcgLyAyKSAtIG1lYXN1cmVbMV0vMixtYXRoLmNlaWwoYWltX2xvZ3NbaV0ucG9zX2FuaW1hdGlvbiktNywgbWVhc3VyZVsxXS80LCAxLCBvdXRsaW5lel9jb2xvclsxXSwgb3V0bGluZXpfY29sb3JbMl0sIG91dGxpbmV6X2NvbG9yWzNdLCBvdXRsaW5lel9jb2xvcls0XSwgb3V0bGluZXpfY29sb3JbMV0sIG91dGxpbmV6X2NvbG9yWzJdLCBvdXRsaW5lel9jb2xvclszXSwgcmlnaHRfYWxwaGEob3V0bGluZXpfY29sb3JbNF08MjUsMjUsb3V0bGluZXpfY29sb3JbNF0pLCB0cnVlKQogICAgICAgICAgICByZW5kZXJlci5ncmFkaWVudCgodyAvIDIpIC0gbWVhc3VyZVsxXS8yLG1hdGguY2VpbChhaW1fbG9nc1tpXS5wb3NfYW5pbWF0aW9uKSsxOSwgbWVhc3VyZVsxXS80LCAxLCBvdXRsaW5lel9jb2xvclsxXSwgb3V0bGluZXpfY29sb3JbMl0sIG91dGxpbmV6X2NvbG9yWzNdLCBvdXRsaW5lel9jb2xvcls0XSwgb3V0bGluZXpfY29sb3JbMV0sIG91dGxpbmV6X2NvbG9yWzJdLCBvdXRsaW5lel9jb2xvclszXSwgcmlnaHRfYWxwaGEob3V0bGluZXpfY29sb3JbNF08MjUsMjUsb3V0bGluZXpfY29sb3JbNF0pLCB0cnVlKQogICAgICAgICAgICByZW5kZXJlci5ncmFkaWVudCgodyAvIDIpK21lYXN1cmVbMV0vMi1tZWFzdXJlWzFdLzMrMSxtYXRoLmNlaWwoYWltX2xvZ3NbaV0ucG9zX2FuaW1hdGlvbiktNywgbWVhc3VyZVsxXS8zLCAxLCBvdXRsaW5lel9jb2xvclsxXSwgb3V0bGluZXpfY29sb3JbMl0sIG91dGxpbmV6X2NvbG9yWzNdLCByaWdodF9hbHBoYShvdXRsaW5lel9jb2xvcls0XTwyNSwyNSxvdXRsaW5lel9jb2xvcls0XSksIG91dGxpbmV6X2NvbG9yWzFdLCBvdXRsaW5lel9jb2xvclsyXSwgb3V0bGluZXpfY29sb3JbM10sIG91dGxpbmV6X2NvbG9yWzRdLCB0cnVlKQogICAgICAgICAgICByZW5kZXJlci5ncmFkaWVudCgodyAvIDIpICsgbWVhc3VyZVsxXS8yLW1lYXN1cmVbMV0vMysxLG1hdGguY2VpbChhaW1fbG9nc1tpXS5wb3NfYW5pbWF0aW9uKSsxOSwgbWVhc3VyZVsxXS8zLCAxLCBvdXRsaW5lel9jb2xvclsxXSwgb3V0bGluZXpfY29sb3JbMl0sIG91dGxpbmV6X2NvbG9yWzNdLCByaWdodF9hbHBoYShvdXRsaW5lel9jb2xvcls0XTwyNSwyNSxvdXRsaW5lel9jb2xvcls0XSksIG91dGxpbmV6X2NvbG9yWzFdLCBvdXRsaW5lel9jb2xvclsyXSwgb3V0bGluZXpfY29sb3JbM10sIG91dGxpbmV6X2NvbG9yWzRdLCB0cnVlKQoKICAgICAgICAgICAgcmVuZGVyZXIuZ3JhZGllbnQoKHcgLyAyKSAtIG1lYXN1cmVbMV0vMi02LG1hdGguY2VpbChhaW1fbG9nc1tpXS5wb3NfYW5pbWF0aW9uKS0xLCAxLCAxMCwgb3V0bGluZXpfY29sb3JbMV0sIG91dGxpbmV6X2NvbG9yWzJdLCBvdXRsaW5lel9jb2xvclszXSwgb3V0bGluZXpfY29sb3JbNF0sIDAsIDAsIDAsIDAsIGZhbHNlKQogICAgICAgICAgICByZW5kZXJlci5ncmFkaWVudCgodyAvIDIpICsgbWVhc3VyZVsxXS8yKzUsbWF0aC5jZWlsKGFpbV9sb2dzW2ldLnBvc19hbmltYXRpb24pLTEsIDEsIDEwLCBvdXRsaW5lel9jb2xvclsxXSwgb3V0bGluZXpfY29sb3JbMl0sIG91dGxpbmV6X2NvbG9yWzNdLCBvdXRsaW5lel9jb2xvcls0XSwgMCwgMCwgMCwgMCwgZmFsc2UpCgogICAgICAgICAgICByZW5kZXJlci5ncmFkaWVudCgodyAvIDIpIC0gbWVhc3VyZVsxXS8yLTYsbWF0aC5jZWlsKGFpbV9sb2dzW2ldLnBvc19hbmltYXRpb24pKzYsIDEsIDEwLCAwLCAwLCAwLCAwLCBvdXRsaW5lel9jb2xvclsxXSwgb3V0bGluZXpfY29sb3JbMl0sIG91dGxpbmV6X2NvbG9yWzNdLCBvdXRsaW5lel9jb2xvcls0XSwgZmFsc2UpCiAgICAgICAgICAgIHJlbmRlcmVyLmdyYWRpZW50KCh3IC8gMikgKyBtZWFzdXJlWzFdLzIrNSxtYXRoLmNlaWwoYWltX2xvZ3NbaV0ucG9zX2FuaW1hdGlvbikrNiwgMSwgMTAsIDAsIDAsIDAsIDAsIG91dGxpbmV6X2NvbG9yWzFdLCBvdXRsaW5lel9jb2xvclsyXSwgb3V0bGluZXpfY29sb3JbM10sIG91dGxpbmV6X2NvbG9yWzRdLCBmYWxzZSkKICAgICAgICAgICAKCiAgICAgICAgICAgIHJvdW5kZWRfcmVjdGFuZ2xlKCh3IC8gMikgIC0gbWVhc3VyZVsxXS8yIC0gNSxtYXRoLmNlaWwoYWltX2xvZ3NbaV0ucG9zX2FuaW1hdGlvbiktNiwgbWVhc3VyZVsxXSArIDEwLDI1LDEyLDEyLDEyLDI1NSw2LDE1KQogICAgICAgICAgICByZW5kZXJlci5yZWN0YW5nbGUoKHcgLyAyKSAgLSBtZWFzdXJlWzFdLzIgLSA1LG1hdGguY2VpbChhaW1fbG9nc1tpXS5wb3NfYW5pbWF0aW9uKS02LCBtZWFzdXJlWzFdICsgMTAsMjUsMTIsMTIsMTIsMjU1KQogICAgICAgICAgICByZW5kZXJlci50ZXh0KHcvIDIsbWF0aC5jZWlsKGFpbV9sb2dzW2ldLnBvc19hbmltYXRpb24pICsgNSwyNTUsMjU1LDI1NSwyNTUsImMiLG5pbCxhaW1fbG9nc1tpXS50ZXh0KQogICAgICAgICAgICBhaW1fbG9nc1tpXS50aW1lciA9IGFpbV9sb2dzW2ldLnRpbWVyIC0gMC41CgogICAgICAgICAgICBpZiBnbG9iYWxzLnRpY2tjb3VudCgpICogZ2xvYmFscy50aWNraW50ZXJ2YWwoKSA+PSBhaW1fbG9nc1tpXS50aW1lciArIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0ubm90aV90aW1lcikgdGhlbgogICAgICAgICAgICAgICAgdGFibGUucmVtb3ZlKGFpbV9sb2dzLGkpCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIGFpbV9sb2dzW2ldLnBvc19hbmltYXRpb24gPCBoIC8gMiArIDEyNSB0aGVuCiAgICAgICAgICAgICAgICB0YWJsZS5yZW1vdmUoYWltX2xvZ3MsMSkKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAoKZnVuY3Rpb24gdmlzdWFsX2Z1bmN0aW9uczp3aGF0c2FwcF9ub3RpZmljYXRpb25zKCkKICAgIGxvY2FsIHcsaCA9IGNsaWVudC5zY3JlZW5fc2l6ZSgpCgogICAgZm9yIGk9MSwjYWltX2xvZ3MgZG8KCiAgICAgICAgaWYgbm90IGFpbV9sb2dzW2ldLmluaXQgdGhlbiAKICAgICAgICAgICAgYWltX2xvZ3NbaV0ucG9zX2FuaW1hdGlvbiA9IC01MAogICAgICAgICAgICBhaW1fbG9nc1tpXS54X2FuaW1hdGlvbiA9IDAKICAgICAgICAgICAgYWltX2xvZ3NbaV0uaW5pdCA9IHRydWUKICAgICAgICBlbmQKCiAgICAgICAgaWYgd2hhdF9ub3RpX2ltYWdlID09IG5pbCB0aGVuIGJyZWFrIGVuZAoKICAgICAgICBhaW1fbG9nc1tpXS5wb3NfYW5pbWF0aW9uID0gbGVycChhaW1fbG9nc1tpXS5wb3NfYW5pbWF0aW9uLDEwICsgaSAqIDQ1LGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAxMCkKCiAgICAgICAgbG9jYWwgYWN0dWFsX3N0cmluZyA9IG5pbAogICAgICAgIGlmIGFpbV9sb2dzW2ldLnN0YXRlIHRoZW4KICAgICAgICAgICAgYWN0dWFsX3N0cmluZyA9IHN0cmluZy5zdWIoYWltX2xvZ3NbaV0udGV4dCw1LCNhaW1fbG9nc1tpXS50ZXh0KQogICAgICAgICAgZWxzZQogICAgICAgICAgICAgIGFjdHVhbF9zdHJpbmcgPSBzdHJpbmcuc3ViKGFpbV9sb2dzW2ldLnRleHQsOCwjYWltX2xvZ3NbaV0udGV4dCkKICAgICAgICAgIGVuZCAgIAoKICAgICAgICBsb2NhbCBtZWFzdXJlID0geyByZW5kZXJlci5tZWFzdXJlX3RleHQoImMiLCBhY3R1YWxfc3RyaW5nKSB9CgogICAgICAgIGxvY2FsIG5vdF94ID0gdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS5ub3RpX3BhZGRpbmcpCiAgICAgICAgCiAgICAgICAgcm91bmRlZF9yZWN0YW5nbGUodyAvIDIgLSBtZWFzdXJlWzFdLzIgLSA3LG1hdGguY2VpbChhaW1fbG9nc1tpXS5wb3NfYW5pbWF0aW9uKSAtIDM3ICsgbm90X3gsIG1lYXN1cmVbMV0gKyA1MCw0MCw1MCw1MCw1MCwyMDAsNiwxNSkKICAgICAgICByb3VuZGVkX3JlY3RhbmdsZSh3IC8gMiAtIG1lYXN1cmVbMV0vMiAtIDEwLG1hdGguY2VpbChhaW1fbG9nc1tpXS5wb3NfYW5pbWF0aW9uKSAtIDQwICsgbm90X3gsIG1lYXN1cmVbMV0gKyA1MCw0MCwwLDAsMCwyNTUsNiwxNSkKICAgICAgICByZW5kZXJlci5yZWN0YW5nbGUodyAvIDIgLSBtZWFzdXJlWzFdLzIsbWF0aC5jZWlsKGFpbV9sb2dzW2ldLnBvc19hbmltYXRpb24pIC0gNDAgKyBub3RfeCwgbWVhc3VyZVsxXSArIDMwLDQwLDAsMCwwLDI1NSkKCiAgICAgICAgcmVuZGVyZXIudGV4dCh3LyAyIC0gbWVhc3VyZVsxXS8yICsgMzAsbWF0aC5jZWlsKGFpbV9sb2dzW2ldLnBvc19hbmltYXRpb24pIC0gMzIgKyBub3RfeCwyMjAsMjIwLDIyMCwyNTUsIiIsbmlsLCBhaW1fbG9nc1tpXS5zdGF0ZSA9PSB0cnVlIGFuZCAiU3RhcmxpZ2h0IH4gXGE5NkM4M0NGRkhpdFxhRkZGRkZGRkYiIG9yICJTdGFybGlnaHQgfiBcYUZGMDAzMkZGTWlzc1xhRkZGRkZGRkYiKQogICAgICAgIAoKICAgICAgICByZW5kZXJlci50ZXh0KHcvIDIgLSBtZWFzdXJlWzFdLzIgKyAzMCxtYXRoLmNlaWwoYWltX2xvZ3NbaV0ucG9zX2FuaW1hdGlvbikgLSAyMCArIG5vdF94LDIyMCwyMjAsMjIwLDI1NSwiIixuaWwsIGFjdHVhbF9zdHJpbmcpCgogICAgICAgIHdoYXRfbm90aV9pbWFnZTpkcmF3KHcgLyAyIC0gbWVhc3VyZVsxXS8yIC0gNSwgbWF0aC5jZWlsKGFpbV9sb2dzW2ldLnBvc19hbmltYXRpb24pIC0gMzUgKyBub3RfeCwzMCwzMCwyNTUsMjU1LDI1NSwyNTUsdHJ1ZSxuaWwpCgogICAgICAgIGlmIGdsb2JhbHMudGlja2NvdW50KCkgKiBnbG9iYWxzLnRpY2tpbnRlcnZhbCgpID49IGFpbV9sb2dzW2ldLnRpbWVyICsgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS5ub3RpX3RpbWVyKSB0aGVuCiAgICAgICAgICAgIHRhYmxlLnJlbW92ZShhaW1fbG9ncyxpKQogICAgICAgICAgICBicmVhawogICAgICAgIGVuZAoKICAgICAgICBpZiBpID4gNCB0aGVuCiAgICAgICAgICAgIHRhYmxlLnJlbW92ZShhaW1fbG9ncywxKQogICAgICAgICAgICBicmVhawogICAgICAgIGVuZAogICAgZW5kCmVuZAoKbG9jYWwgYWxsX3BsYXllcnMgPSB7fQpsb2NhbCBmdW5jdGlvbiBnZXRfYm90c19wbGF5ZXJzKCkKCiAgICBmb3Igayx2IGluIGlwYWlycyhlbnRpdHkuZ2V0X3BsYXllcnModHJ1ZSkpIGRvIAogICAgICAgIHRhYmxlLmluc2VydChhbGxfcGxheWVycyx7aW5kZXg9dixvbGRfcG9zPTAsdGltZWZyYW1lPWVudGl0eS5nZXRfcHJvcCh2LCAibV9mbFNpbXVsYXRpb25UaW1lIikgLyBnbG9iYWxzLnRpY2tpbnRlcnZhbCgpLHdqaXR0ZXI9ZmFsc2UsbG9vcD0wfSkKICAgICAgIAogICAgICAgIGxvY2FsIHdhc19mb3VuZCA9IHRydWUKICAgICAgICBsb2NhbCB0aW1lc19mb3VuZCA9IDAKICAgICAgICBmb3IgaSxuIGluIGlwYWlycyhhbGxfcGxheWVycykgZG8gCiAgICAgICAgICAgIGlmIGVudGl0eS5nZXRfcGxheWVyX25hbWUobi5pbmRleCkgPT0gZW50aXR5LmdldF9wbGF5ZXJfbmFtZShlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpKSB0aGVuIAogICAgICAgICAgICAgICAgdGFibGUucmVtb3ZlKGFsbF9wbGF5ZXJzLGkpCiAgICAgICAgICAgICAgICBicmVhayAKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBuLmluZGV4ID09IHYgdGhlbgogICAgICAgICAgICAgICAgdGltZXNfZm91bmQgPSB0aW1lc19mb3VuZCArIDEKICAgICAgICAgICAgICAgIHdhc19mb3VuZCA9IGZhbHNlCiAgICAgICAgICAgICAgICBpZiB0aW1lc19mb3VuZCA+PSAyIHRoZW4KICAgICAgICAgICAgICAgICAgICB3YXNfZm91bmQgPSB0cnVlIAogICAgICAgICAgICAgICAgICAgIHRhYmxlLnJlbW92ZShhbGxfcGxheWVycyxpKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgd2FzX2ZvdW5kID0gZmFsc2UKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgpsb2NhbCBhdGltZXIgPSA2MApsb2NhbCBpc19ob3Zlcl9sb2dzID0gZmFsc2UKbG9jYWwgaXNfaG92ZXJfbG9nc18yID0gZmFsc2UKbG9jYWwgbGVycF9hbHBoYTIgPSAwCmxvY2FsIGxlcnBfYWxwaGEzID0gMApmdW5jdGlvbiB2aXN1YWxfZnVuY3Rpb25zOm5lZ3JvcygpCgogICAgaXNfaG92ZXJfbG9ncyA9IGZhbHNlCiAgICBsb2NhbCBvdXRsaW5lel9jb2xvciA9IHsgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS5haW1fbG9nc19vdXRsaW5lX2NvbG9yKSB9CgogICAgaWYgbm90IHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uYWltZXJfbGVncykgdGhlbgogICAgICAgIGlmIHVpLmlzX21lbnVfb3BlbigpIHRoZW4KICAgICAgICAgICAgbGVycF9hbHBoYTIgPSBsZXJwKGxlcnBfYWxwaGEyLDEzMCxnbG9iYWxzLmZyYW1ldGltZSgpICogMTUpCiAgICAgICAgZWxzZQogICAgICAgICAgICBsZXJwX2FscGhhMiA9IGxlcnAobGVycF9hbHBoYTIsMCxnbG9iYWxzLmZyYW1ldGltZSgpICogMTApCgogICAgICAgICAgICBpZiBsZXJwX2FscGhhMiA8PSAxIHRoZW4gcmV0dXJuIGVuZAogICAgICAgIGVuZAogICAgICAgIGFpbV9sb2dzID0ge30KICAgIGVsc2UKICAgICAgICBpZiB1aS5pc19tZW51X29wZW4oKSB0aGVuCiAgICAgICAgICAgIGxlcnBfYWxwaGEyID0gbGVycChsZXJwX2FscGhhMiwyNTUsZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDE1KQogICAgICAgIGVsc2UKICAgICAgICAgICAgbGVycF9hbHBoYTIgPSBsZXJwKGxlcnBfYWxwaGEyLDAsZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDEwKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKZnVuY3Rpb24gdmlzdWFsX2Z1bmN0aW9uczpOSUdHQVNTU1NTUygpCgogICAgaXNfaG92ZXJfbG9nc18yID0gZmFsc2UKCiAgICBsb2NhbCBpc19vbiA9IGZhbHNlCgogICAgaWYgbm90IHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0ud2hhdHNhcHBpKSB0aGVuCiAgICAgICAgaXNfb24gPSBmYWxzZQogICAgICAgIGlmIHVpLmlzX21lbnVfb3BlbigpIHRoZW4KICAgICAgICAgICAgbGVycF9hbHBoYTMgPSBtYXRoLmNlaWwobGVycChsZXJwX2FscGhhMywzNSArIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0ubm90aV9wYWRkaW5nKSxnbG9iYWxzLmZyYW1ldGltZSgpICogMTUpKQogICAgICAgIGVsc2UKICAgICAgICAgICAgbGVycF9hbHBoYTMgPSBtYXRoLmNlaWwobGVycChsZXJwX2FscGhhMywtOTAsZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDEwKSkKCiAgICAgICAgICAgIGlmIGxlcnBfYWxwaGEzIDw9IC00MCB0aGVuIHJldHVybiBlbmQKICAgICAgICBlbmQKICAgICAgICBhaW1fbG9ncyA9IHt9CiAgICBlbHNlCiAgICAgICAgaXNfb24gPSB0cnVlCiAgICAgICAgaWYgdWkuaXNfbWVudV9vcGVuKCkgdGhlbgogICAgICAgICAgICBsZXJwX2FscGhhMyA9IG1hdGguY2VpbChsZXJwKGxlcnBfYWxwaGEzLDM1ICsgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS5ub3RpX3BhZGRpbmcpLGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAxNSkpCiAgICAgICAgZWxzZQogICAgICAgICAgICBsZXJwX2FscGhhMyA9IG1hdGguY2VpbChsZXJwKGxlcnBfYWxwaGEzLC05MCxnbG9iYWxzLmZyYW1ldGltZSgpICogMTApKQogICAgICAgICAgICBpZiBsZXJwX2FscGhhMyA8PSAtNDAgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBsb2NhbCB3LGggPSBjbGllbnQuc2NyZWVuX3NpemUoKQogICAgbG9jYWwgbXBvcyA9IHsgdWkubW91c2VfcG9zaXRpb24oKSB9CiAgICBsb2NhbCBtZWFzdXJlID0geyByZW5kZXJlci5tZWFzdXJlX3RleHQoImMiLCAiSGl0IFxhOTZDODNDRkZyb3lhbHR5XGFGRkZGRkZGRiBpbiB0aGUgXGE5NkM4M0NGRmhlYWRcYUZGRkZGRkZGIGZvciBcYTk2QzgzQ0ZGNzRcYUZGRkZGRkZGIGRhbWFnZSAoXGE5NkM4M0NGRjBcYUZGRkZGRkZGIGhlYWx0aCByZW1haW5pbmcpIikgfQoKICAgIGlmIG1wb3NbMV0gPiAodyAvIDIpICAtIG1lYXN1cmVbMV0vMi0xNSBhbmQgbXBvc1sxXSA8ICh3IC8gMikgKyBtZWFzdXJlWzFdLzIrNTAgYW5kIG1wb3NbMl0gPiBsZXJwX2FscGhhMyAtIDEwIGFuZCBtcG9zWzJdIDxsZXJwX2FscGhhMyAtIDEwICsgNTAgdGhlbgogICAgICAgIAogICAgICAgIGlzX2hvdmVyX2xvZ3NfMiA9IHRydWUKICAgICAgICBpZiBjbGllbnQua2V5X3N0YXRlKDB4MSkgYW5kIGF0aW1lciA+IDcwIHRoZW4KICAgICAgICAgICAgaWYgdWkuaXNfbWVudV9vcGVuKCkgdGhlbgogICAgICAgICAgICAgICB1aS5zZXQobmV3X21lbnVfcmVmZXJlbmNlc1sidmlzdWFscyJdLndoYXRzYXBwaSxub3QgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS53aGF0c2FwcGkpKQogICAgICAgICAgICAgICB1aS5zZXQobmV3X21lbnVfcmVmZXJlbmNlc1sidmlzdWFscyJdLmFpbWVyX2xlZ3MsZmFsc2UpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBhdGltZXIgPSAwCiAgICAgICAgZW5kCiAgICBlbmQKCgogICAgaWYgd2hhdF9ub3RpX2ltYWdlID09IG5pbCB0aGVuIHJldHVybiBlbmQKCiAgICAKICAgIHJlbmRlcmVyLnJlY3RhbmdsZSh3IC8gMiAtIG1lYXN1cmVbMV0vMiAtIDUsbGVycF9hbHBoYTMgLSAxMCwgbWVhc3VyZVsxXSArIDE1LDQwLDAsMCwwLDI1NSkKICAgIHJlbmRlcmVyLnJlY3RhbmdsZSh3IC8gMiAtIG1lYXN1cmVbMV0vMiAtIDE1LGxlcnBfYWxwaGEzICAsIDEwLDIwLDAsMCwwLDI1NSkKICAgIHJlbmRlcmVyLmNpcmNsZSh3IC8gMiAtIG1lYXN1cmVbMV0vMiAtIDUsbGVycF9hbHBoYTMsIDAsMCwwLDI1NSwgMTAsIDE4MCwgMC4yNSkKICAgIHJlbmRlcmVyLmNpcmNsZSh3IC8gMiAtIG1lYXN1cmVbMV0vMiAtIDUsbGVycF9hbHBoYTMgKyAyMCwgMCwwLDAsMjU1LCAxMCwgMjcwLCAwLjI1KQoKICAgIHJlbmRlcmVyLnJlY3RhbmdsZSh3IC8gMiArIG1lYXN1cmVbMV0vMiArIDcsbGVycF9hbHBoYTMgICwgMTAsMjAsMCwwLDAsMjU1KQogICAgcmVuZGVyZXIuY2lyY2xlKHcgLyAyICsgbWVhc3VyZVsxXS8yICsgNyxsZXJwX2FscGhhMywgMCwwLDAsMjU1LCAxMCwgOTAsIDAuMjUpCiAgICByZW5kZXJlci5jaXJjbGUodyAvIDIgKyBtZWFzdXJlWzFdLzIgKyA3LGxlcnBfYWxwaGEzICsgMjAsIDAsMCwwLDI1NSwgMTAsIDAsIDAuMjUpCiAgICAKCiAgICByZW5kZXJlci50ZXh0KHcvIDIgLSBtZWFzdXJlWzFdLzIgKyAzMCxsZXJwX2FscGhhMyArIDggLSAxMCwyMjAsMjIwLDIyMCwyNTUsIiIsbmlsLCJTdGFybGlnaHQgfiAiIC4uIHN0cmluZy5mb3JtYXQoIiVzIixpc19vbiA9PSB0cnVlIGFuZCAiXGE5NkM4M0NGRk5vdGlmaWNhdGlvblxhRkZGRkZGRkYiIG9yICJcYUZGMDAzMkZGTm90aWZpY2F0aW9uXGFGRkZGRkZGRiIpKQogICAgCgogICAgcmVuZGVyZXIudGV4dCh3LyAyIC0gbWVhc3VyZVsxXS8yICsgMzAsbGVycF9hbHBoYTMgKyAyMCAtIDEwLDIyMCwyMjAsMjIwLDI1NSwiIixuaWwsICJIaXQgXGE5NkM4M0NGRnB1d3BsXGFGRkZGRkZGRiBpbiB0aGUgXGE5NkM4M0NGRmhlYWRcYUZGRkZGRkZGIGZvciBcYTk2QzgzQ0ZGMTAwXGFGRkZGRkZGRiAoXGE5NkM4M0NGRjBcYUZGRkZGRkZGIGhlYWx0aCByZW1haW5pbmcpIikKCiAgICB3aGF0X25vdGlfaW1hZ2U6ZHJhdyh3IC8gMiAtIG1lYXN1cmVbMV0vMiAtIDUsbGVycF9hbHBoYTMgKyA1IC0gMTAsMzAsMzAsMjU1LDI1NSwyNTUsMjU1LHRydWUsbmlsKQogICAgCiAgCiAgIAplbmQKCmNsaWVudC5yZWdpc3Rlcl9lc3BfZmxhZygiRlMiLDI1NSwyNTUsMjU1LCBmdW5jdGlvbihlbnQpCiAgICBpZiBwbGlzdC5nZXQoZW50LCJPdmVycmlkZSBzYWZlIHBvaW50IikgPT0gIk9uIiB0aGVuIHJldHVybiAiRlMiIGVuZAplbmQpCgpsb2NhbCBpbnRybyA9IHt9CgpmdW5jdGlvbiB2aXN1YWxfZnVuY3Rpb25zOndlbGNvbWVfdG9fc3RhcmxpZ2h0KCkKICAgbG9jYWwgdyxoID0gY2xpZW50LnNjcmVlbl9zaXplKCkKICAgIGludHJvWyNpbnRybyArIDFdID17CiAgICAgICAgbWVzc2FnZSA9ICJXZWxjb21lIHRvIHN0YXJsaWdodCwgIiwKICAgICAgICB1c2VybmFtZSA9IG9iZXhfZGF0YS51c2VybmFtZSAuLiAnLicsCiAgICAgICAgYWxwaGEgPSAyNTUsCiAgICAgICAgdGltZXIgPSA2MDAsCiAgICAgICAgeCA9IHcgLyAyIC0gMTUwLAogICAgICAgIHkgPSBoICsgaCAvIDIsCiAgICB9CmVuZAoKdmlzdWFsX2Z1bmN0aW9ucy53ZWxjb21lX3RvX3N0YXJsaWdodCgpCgpmdW5jdGlvbiB2aXN1YWxfZnVuY3Rpb25zOnN0YXJ0X2ludHJvKCkKCgogICAgbG9jYWwgdyxoID0gY2xpZW50LnNjcmVlbl9zaXplKCkKICAgIGZvciBpID0gMSwjaW50cm8gZG8KCiAgICAgICAgaWYgaW50cm9baV0gPT0gbmlsIHRoZW4gYnJlYWsgZW5kCgogICAgICAgIHJlbmRlcmVyLnJlY3RhbmdsZSgwLCAwLCB3LCBoLCAxMiwgMTIsIDEyLCBpbnRyb1tpXS5hbHBoYSkKICAgICAgICByZW5kZXJlci50ZXh0KHcgLyAyLCBoIC8gMiwyNTUsMjU1LDI1NSxpbnRyb1tpXS5hbHBoYSwiYysiLDAsaW50cm9baV0ubWVzc2FnZSAuLiBpbnRyb1tpXS51c2VybmFtZSkKICAgICAgICByZW5kZXJlci50ZXh0KHcgLyAyLCBoIC8gMiArIDI1LDEwMSwxMzAsMTkwLGludHJvW2ldLmFscGhhLCJjKyIsMCwiYnVpbGQgIiAuLiBzdHJpbmcubG93ZXIob2JleF9kYXRhLmJ1aWxkKSkKCiAgICAgICAgbG9jYWwgc2l6ZSA9IGludHJvW2ldLnRpbWVyICogMSAvIDYwMAogICAgICAgIHJlbmRlcmVyLmNpcmNsZV9vdXRsaW5lKHcgLyAyLCBoIC8gMiArIDUwLDEwMSwxMzAsMTkwLGludHJvW2ldLmFscGhhLDEwLDAsc2l6ZSwyKQoKICAgICAgICBpZiBpbnRyb1tpXS50aW1lciA8IDI1NSB0aGVuCiAgICAgICAgICAgIGludHJvW2ldLmFscGhhID0gaW50cm9baV0uYWxwaGEgLSAxCiAgICAgICAgZW5kCiAgICAgICAgCgogICAgICAgIGludHJvW2ldLnRpbWVyID0gaW50cm9baV0udGltZXIgLSAxIAoKICAgICAgICBpZiBpbnRyb1tpXS50aW1lciA8IDEgdGhlbgogICAgICAgICAgICB0YWJsZS5yZW1vdmUoaW50cm8sI2ludHJvKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInBhaW50IixmdW5jdGlvbigpCiAgICBnZXRfYm90c19wbGF5ZXJzKCkKICAgIGxvY2FsIHNjb3BlZCA9IGVudGl0eS5nZXRfcHJvcChlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCJtX2JJc1Njb3BlZCIpID09IDEgYW5kIHRydWUgb3IgZmFsc2UKICAgIGxvY2FsIHNjb3BlZF9hbmRfYm94ID0gdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS5zY29wZWRfYW5pbWF0aW9uKSBhbmQgc2NvcGVkCiAgICB2aXN1YWxfZnVuY3Rpb25zLm9mZnNldCA9IGxlcnAodmlzdWFsX2Z1bmN0aW9ucy5vZmZzZXQsc2NvcGVkX2FuZF9ib3ggYW5kIDMwIG9yIDAsZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDE1KQoKICAgIC0tYWFfZnVuY3Rpb25zLmNhbl9kZWZlbnNpdmUgPSBmYWxzZQogICAgaWYgdmlzdWFsX2Z1bmN0aW9ucy50aWNrcyA8PSAtMSBhbmQgYWFfZnVuY3Rpb25zLnRvX3N0YXJ0ID09IGZhbHNlIGFuZCB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVthYV9mdW5jdGlvbnMuYWFfbnVtYmVyXS5lbmFibGVkX2V4cGxvaXQpIHRoZW4KICAgICAgICBhYV9mdW5jdGlvbnMuY2FuX2RlZmVuc2l2ZSA9IHRydWUKICAgIGVuZAogICAgCiAgICBlbnRpdHlfb3ZlcnJpZGUoKQogICAgbG9jYWwgc2NyZWVuID0gdmVjdG9yKGNsaWVudC5zY3JlZW5fc2l6ZSgpKQogICAKICAgIGlmIGVudGl0eS5pc19hbGl2ZShlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpKSB0aGVuCgogICAgICAgIHZpc3VhbF9mdW5jdGlvbnMuc2xvd19pbmRpY2F0b3IoKQogICAgICAgIGlmIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uZW5hYmxlX2luZGljYXRvcnMpID09ICJkZWZhdWx0IiB0aGVuCiAgICAgICAgICAgIHZpc3VhbF9mdW5jdGlvbnMuaW5kaWNhdG9ycygpCiAgICAgICAgZWxzZWlmIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0uZW5hYmxlX2luZGljYXRvcnMpID09ICJtaW5pbWFsIiB0aGVuCiAgICAgICAgICAgIHZpc3VhbF9mdW5jdGlvbnMuaW5kaWNhdG9yczIoKQogICAgICAgIGVsc2VpZiB1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sidmlzdWFscyJdLmVuYWJsZV9pbmRpY2F0b3JzKSA9PSAieWVhdCIgdGhlbgogICAgICAgICAgICB2aXN1YWxfZnVuY3Rpb25zLmluZGljYXRvcnMzKCkKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICB2aXN1YWxfZnVuY3Rpb25zLnpldXNfaW5kaWNhdG9yKCkKICAgICAgICB2aXN1YWxfZnVuY3Rpb25zLnpldXNfbmlnZ2EoKQogICAgICAgIHZpc3VhbF9mdW5jdGlvbnMubWluX2RtZ19pbmRpY2F0b3IoKQogICAgICAgIHZpc3VhbF9mdW5jdGlvbnMuZGVzeW5jX2luZGljYXRvcigpCiAgICAgICAgdmlzdWFsX2Z1bmN0aW9ucy5tYW51YWxfaW5kaWNhdG9yKCkKCiAgICAgICAgaWYgdGFibGVfY29udGFpbnModWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS5leHRyYV92aXN1YWxzKSwiYmV0YSBkdCBpbmRpY2F0b3IiKSB0aGVuCiAgICAgICAgICAgIHZpc3VhbF9mdW5jdGlvbnMuZ3JlZW5fZHRfc2tlZXRfYmV0YSgpCiAgICAgICAgZW5kCiAgICBlbmQKCgogICAgbWlzY19mdW5jdGlvbnMuc3Vuc2V0KCkKICAgIHZpc3VhbF9mdW5jdGlvbnMuZGVmZW5zaXZlX2luZGljYXRvcigpCgogICAgaWYgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbInZpc3VhbHMiXS5haW1lcl9sZWdzKSB0aGVuIAogICAgICAgIHZpc3VhbF9mdW5jdGlvbnMubm90aWZjYXRpb24oKQogICAgZWxzZWlmIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJ2aXN1YWxzIl0ud2hhdHNhcHBpKSB0aGVuCiAgICAgdmlzdWFsX2Z1bmN0aW9ucy53aGF0c2FwcF9ub3RpZmljYXRpb25zKCkKICAgIGVuZAogICAgCiAgICAtLQogICAgbWlzY19mdW5jdGlvbnMuZ2xvYmFsX2NvdW50ZXIoKQogICAgdmlzdWFsX2Z1bmN0aW9ucy53YXRlcm1hcmsoKQplbmQpCgpmdW5jdGlvbiBtaXNjX2Z1bmN0aW9uczpzYWZlX3BvaW50KCkKCgogICAgaWYgdGFibGVfY29udGFpbnModWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbIm1pc2MiXS5kZWJ1Z19yYWdlYm90KSwic2FmZSBwb2ludCBlbmhhbmNlciIpIHRoZW4KICAgICAgICBmb3IgaSxuIGluIGlwYWlycyhhbGxfcGxheWVycykgZG8KICAgICAgICAgICAgbG9jYWwgYW1vdW50X29mX3Nob3RzID0gMAogICAgICAgICAgICBsb2NhbCBocF9zaG90ID0gMAogICAgCiAgICAgICAgICAgaWYgbm90IGVudGl0eS5pc19hbGl2ZShuLmluZGV4KSB0aGVuIHRhYmxlLnJlbW92ZShhbGxfcGxheWVycyxpKSBicmVhayBlbmQKICAgIAogICAgICAgICAgICBpZiB0YWJsZV9jb250YWlucyh1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sibWlzYyJdLnNhZmVfcG9pbnQpLCJkZWZhdWx0Iikgb3IgdGFibGVfY29udGFpbnModWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbIm1pc2MiXS5zYWZlX3BvaW50KSwib24gbGV0aGFsIikgdGhlbgogICAgICAgICAgICAgICAgZm9yIGssdiBpbiBpcGFpcnMobWlzc19zcCkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB2Lm5pZ2dhID09IG4uaW5kZXggdGhlbgogICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiB2LmhwIDw9IDUwIGFuZCB0YWJsZV9jb250YWlucyh1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sibWlzYyJdLnNhZmVfcG9pbnQpLCJvbiBsZXRoYWwiKSAgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhwX3Nob3QgPSBocF9zaG90ICsgMSAKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdGFibGVfY29udGFpbnModWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbIm1pc2MiXS5zYWZlX3BvaW50KSwiZGVmYXVsdCIpID09IHRydWUgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudF9vZl9zaG90cyA9IGFtb3VudF9vZl9zaG90cyArIDEgCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgIGxvY2FsIGV5ZXMgPSB2ZWN0b3IoZW50aXR5LmdldF9wcm9wKG4uaW5kZXgsIm1fYW5nRXllQW5nbGVzIikpCiAgICAgICAgICAgIAogICAgCiAgICAgICAgICAgIGxvY2FsIG1hdGhlZCA9IG1hdGguZmxvb3IoZXllcy55KSAtIG1hdGguZmxvb3Iobi5vbGRfcG9zKQogICAgCiAgICAgICAgICAgIGlmIG1hdGhlZCA9PSAwIHRoZW4KICAgICAgICAgICAgICAgIG4ubG9vcCA9IG4ubG9vcCArIDEKICAgIAogICAgICAgICAgICAgICAgaWYgbi5sb29wID4gNCB0aGVuIAogICAgICAgICAgICAgICAgICAgIG4ud2ppdHRlciA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgbi5sb29wID0gMAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIG4ubG9vcCA9IDAKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAKICAgICAgICAKICAgICAgICAgICAgaWYgbWF0aGVkID4gMTgwIG9yIG1hdGhlZCA8IC0xODAgdGhlbgogICAgCiAgICAgICAgICAgICAgICBsb2NhbCB0cnVlX21hdGggPSAwCiAgICAKICAgICAgICAgICAgICAgIGlmIG1hdGhlZCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgIHRydWVfbWF0aCA9IDE5OSAtIG1hdGhlZAogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHRydWVfbWF0aCA9IC0xOTkgLSBtYXRoZWQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiB0cnVlX21hdGggPiA4MCBvciB0cnVlX21hdGggPCAtODAgdGhlbgogICAgICAgICAgICAgICAgICAgIC0tbi53aml0dGVyID0gZmFsc2UKICAgICAgICAgICAgICAgIGVsc2VpZiAodHJ1ZV9tYXRoIDw9IDgwIG9yIHRydWVfbWF0aCA+PSAtODAgYW5kIHRydWVfbWF0aCA8PSAtMSkgYW5kIG1hdGhlZCB+PSAwIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgbi53aml0dGVyID0gdHJ1ZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVsc2VpZiBtYXRoZWQgPCAxODAgb3IgbWF0aGVkID4gLTE4MCB0aGVuCiAgICAgICAgICAgICAgICBpZiBtYXRoZWQgPiA4MCBvciBtYXRoZWQgPCAtODAgdGhlbgogICAgICAgICAgICAgICAgICAgIG4ud2ppdHRlciA9IHRydWUKICAgICAgICAgICAgICAgIGVsc2VpZiAobWF0aGVkIDwgODAgb3IgbWF0aGVkID4gLTgwIGFuZCBtYXRoZWQgPD0gLTEpIGFuZCBtYXRoZWQgfj0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgLS1uLndqaXR0ZXIgPSBmYWxzZQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBlbHNlaWYgbWF0aGVkID09IDAgYW5kIG4ud2ppdHRlciA9PSB0cnVlIHRoZW4gCiAgICAgICAgICAgICAgICBuLndqaXR0ZXIgPSB0cnVlIAogICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICBsb2NhbCBpc193aWRlX2ppdHRlcl9tYXliZSA9IGZhbHNlIAogICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCB2ZWxvY2l0eSA9IHZlY3RvcihlbnRpdHkuZ2V0X3Byb3Aobi5pbmRleCwibV92ZWNWZWxvY2l0eSIpKQogICAgICAgICAgICBsb2NhbCBvbl9ncm91bmQgPSBiaXQuYmFuZChlbnRpdHkuZ2V0X3Byb3Aobi5pbmRleCwgIm1fZkZsYWdzIiksIDEpID09IDEKICAgIAogICAgICAgICAgICAKICAgIAogICAgICAgICAgICBpZiAoaHBfc2hvdCA+PSAxIGFuZCB0YWJsZV9jb250YWlucyh1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sibWlzYyJdLnNhZmVfcG9pbnQpLCJvbiBsZXRoYWwiKSApIG9yIChhbW91bnRfb2Zfc2hvdHMgPj0gMiBhbmQgdGFibGVfY29udGFpbnModWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbIm1pc2MiXS5zYWZlX3BvaW50KSwiZGVmYXVsdCIpKSBvciAoIHZlbG9jaXR5Omxlbmd0aDJkc3FyKCkgPCAyIGFuZCBvbl9ncm91bmQgYW5kIHRhYmxlX2NvbnRhaW5zKHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJtaXNjIl0uc2FmZV9wb2ludCksIlN0YW5kIikpIG9yIAogICAgICAgICAgICAobi53aml0dGVyID09IHRydWUgYW5kIChub3Qgb25fZ3JvdW5kIG9yIHZlbG9jaXR5Omxlbmd0aDJkKCkgPiAzIGFuZCBlbnRpdHkuZ2V0X3Byb3Aobi5pbmRleCwibV9mbER1Y2tBbW91bnQiKSA8PSAwIGFuZCBvbl9ncm91bmQpIGFuZCB0YWJsZV9jb250YWlucyh1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sibWlzYyJdLnNhZmVfcG9pbnQpLCJ3aWRlIGppdHRlciIpKSB0aGVuCiAgICAgICAgICAgICAgICBwbGlzdC5zZXQobi5pbmRleCwgIk92ZXJyaWRlIHNhZmUgcG9pbnQiLCAiT24iKQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBwbGlzdC5zZXQobi5pbmRleCwgIk92ZXJyaWRlIHNhZmUgcG9pbnQiLCAiLSIpCiAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgIGxvY2FsIHRlbXBvID0gZW50aXR5LmdldF9wcm9wKG4uaW5kZXgsICJtX2ZsU2ltdWxhdGlvblRpbWUiKSAvIGdsb2JhbHMudGlja2ludGVydmFsKCkKICAgIAogICAgICAgICAgICBpZiBtYXRoZWQgPT0gMCB0aGVuCiAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgIGlmIG4udGltZWZyYW1lIDwgdGVtcG8gdGhlbgogICAgICAgICAgICAgICAgbi50aW1lZnJhbWUgPSB0ZW1wbwogICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIG4ub2xkX3BvcyA9IGV5ZXMueQogICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBlbmQgCiAgICBlbmQKZW5kCgpsb2NhbCBkZWJ1Z19yZXNvbHZlciA9IGZhbHNlCmZ1bmN0aW9uIGFhX2Z1bmN0aW9uczpyZXNvbHZlcigpCgogICAgaWYgdGFibGVfY29udGFpbnModWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbIm1pc2MiXS5kZWJ1Z19yYWdlYm90KSwiZGVmZW5zaXZlIGFhIHJlc29sdmVyIChleHByaW1lbnRhbCkiKSB0aGVuCiAgICAgICAgZGVidWdfcmVzb2x2ZXIgPSB0cnVlCiAgICAgICAgZm9yIGssZW50IGluIGlwYWlycyhlbnRpdHkuZ2V0X3BsYXllcnModHJ1ZSkpIGRvCiAgICAgICAgICAgIGxvY2FsIGVudF9qdW1waW5nID0gYml0LmJhbmQoZW50aXR5LmdldF9wcm9wKGVudCwgIm1fZkZsYWdzIiksIDEpIAogICAgICAgICAgICBsb2NhbCB5LHAgPSBlbnRpdHkuZ2V0X3Byb3AoZW50LCJtX2FuZ0V5ZUFuZ2xlcyIpCiAgICAgICAgICAgIGxvY2FsIGVudF9mbGFncyA9IGVudGl0eS5nZXRfZXNwX2RhdGEoZW50KS5mbGFncwogICAgICAgICAgICAKICAgIAogICAgICAgICAgICBpZiBlbnRfanVtcGluZyA9PSAwIHRoZW4KICAgICAgICAgICAgICAgIGlmIHkgPCAtMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcGxpc3Quc2V0KGVudCwiRm9yY2UgcGl0Y2giLHRydWUpCiAgICAgICAgICAgICAgICAgICAgcGxpc3Quc2V0KGVudCwiRm9yY2UgcGl0Y2ggdmFsdWUiLDApCiAgICAgICAgICAgICAgICAgICAgcGxpc3Quc2V0KGVudCwiRm9yY2UgYm9keSB5YXciLHRydWUpCiAgICAgICAgICAgICAgICAgICAgcGxpc3Quc2V0KGVudCwiRm9yY2UgYm9keSB5YXcgdmFsdWUiLDApCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgcGxpc3Quc2V0KGVudCwiRm9yY2UgcGl0Y2giLGZhbHNlKQogICAgICAgICAgICAgICAgICAgIHBsaXN0LnNldChlbnQsIkZvcmNlIGJvZHkgeWF3IixmYWxzZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBwbGlzdC5zZXQoZW50LCJGb3JjZSBwaXRjaCIsZmFsc2UpCiAgICAgICAgICAgICAgICBwbGlzdC5zZXQoZW50LCJGb3JjZSBib2R5IHlhdyIsZmFsc2UpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZWxzZWlmIG5vdCB0YWJsZV9jb250YWlucyh1aS5nZXQobmV3X21lbnVfcmVmZXJlbmNlc1sibWlzYyJdLmRlYnVnX3JhZ2Vib3QpLCJkZWZlbnNpdmUgYWEgcmVzb2x2ZXIgKGV4cHJpbWVudGFsKSIpIGFuZCBkZWJ1Z19yZXNvbHZlciA9PSB0cnVlIHRoZW4KICAgICAgICBmb3IgayxlbnQgaW4gaXBhaXJzKGVudGl0eS5nZXRfcGxheWVycyh0cnVlKSkgZG8KICAgICAgICAgICAgcGxpc3Quc2V0KGVudCwiRm9yY2UgcGl0Y2giLGZhbHNlKQogICAgICAgICAgICBwbGlzdC5zZXQoZW50LCJGb3JjZSBib2R5IHlhdyIsZmFsc2UpCiAgICAgICAgZW5kCiAgICAgICAgZGVidWdfcmVzb2x2ZXIgPSBmYWxzZQogICAgZW5kCgplbmQKCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soIm5ldF91cGRhdGVfZW5kIiwgbWlzY19mdW5jdGlvbnMuc2FmZV9wb2ludCkKCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInNldHVwX2NvbW1hbmQiLGZ1bmN0aW9uKGNtZCkKICAgIGFhX2Z1bmN0aW9uczpzZXR1cChjbWQpCiAgICBhYV9mdW5jdGlvbnM6cmVzb2x2ZXIoKQoKCiAgICBpZiBpc19ob3Zlcl9sb2dzIG9yIHVpX21lbnUuaXNfaG92ZXJlZCBvciBpc19ob3Zlcl9sb2dzXzIgdGhlbgogICAgICAgIGNtZC5pbl9hdHRhY2sgPSBmYWxzZQogICAgZW5kCgogICAgdmlzdWFsX2Z1bmN0aW9ucy5pc19pbl9hdHRhY2sgPSBjbWQuaW5fYXR0YWNrID09IDEgYW5kIHRydWUgb3IgZmFsc2UKZW5kKQoKY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygicGFpbnRfdWkiLCBmdW5jdGlvbigpCgogICAgaWYgdWkuZ2V0KG5ld19tZW51X3JlZmVyZW5jZXNbImFhIl0uYWFfc3RhdGVfbWVudSkgPT0gIkxlZ2l0IiBhbmQgKHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlWyJMZWdpdCJdLnlhdykgPT0gImppdHRlcnkiIG9yIHVpLmdldChuZXdfbWVudV9yZWZlcmVuY2VzWyJhYSJdLmFhX3N0YXRlWyJMZWdpdCJdLnlhdykgPT0gImRlbGF5ZWQiKXRoZW4KICAgICAgICB1aS5zZXQobmV3X21lbnVfcmVmZXJlbmNlc1siYWEiXS5hYV9zdGF0ZVs5XS55YXcsIjE4MCIpCiAgICBlbmQKICAgIAogICAgdmlzdWFsX2Z1bmN0aW9ucy5uZWdyb3MoKQogICAgdmlzdWFsX2Z1bmN0aW9ucy5OSUdHQVNTU1NTUygpCiAgICBpZiBhdGltZXIgPCA3MSB0aGVuCiAgICAgICAgYXRpbWVyID0gYXRpbWVyICsgMQogICAgZW5kCiAgICB2aXN1YWxfZnVuY3Rpb25zLnN0YXJ0X2ludHJvKCkKICAgIGlmIHVpLmlzX21lbnVfb3BlbigpIHRoZW4KICAgICAgICBoaWRlX2RlZmF1bHRfYWEoZmFsc2UpCiAgICAgICAgbmV3X21lbnVfdmlzaWJpbGl0eSgpCiAgICBlbmQKZW5kKQoKCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInBhaW50X3VpIiwgdWlfbWVudS5pc19hYV90YWIpCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInBhaW50X3VpIiwgdWlfbWVudS5uZXdfdGFiKQpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJwYWludF91aSIsIHVpX21lbnUub3V0c2lkZV9iYXIpCgpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJzaHV0ZG93biIsIGZ1bmN0aW9uKCkKICAgIGlmIHllcyA9PSB0cnVlIHRoZW4KICAgICAgICBsb2NhbCBzdW5fcHJvcCA9IGVudGl0eS5nZXRfYWxsKCdDQ2FzY2FkZUxpZ2h0JylbMV0KICAgICAgICBlbnRpdHkuc2V0X3Byb3Aoc3VuX3Byb3AsIm1fZW52TGlnaHRTaGFkb3dEaXJlY3Rpb24iLG9sZF9zdW4ueCxvbGRfc3VuLnksb2xkX3N1bi56KQogICAgZW5kCgogICAgaWYgb3ZlcndyaXR0ZW4gPT0gdHJ1ZSB0aGVuIAogICAgICAgIGxvY2FsIGVudF9tYXAgPSBlbnRpdHkuZ2V0X2FsbCgiQ0VudlRvbmVtYXBDb250cm9sbGVyIilbMV0KICAgICAgICBlbnRpdHkuc2V0X3Byb3AoZW50X21hcCwgIm1fYlVzZUN1c3RvbUF1dG9FeHBvc3VyZU1pbiIsIDApCiAgICAgICAgZW50aXR5LnNldF9wcm9wKGVudF9tYXAsICJtX2JVc2VDdXN0b21BdXRvRXhwb3N1cmVNYXgiLDApCiAgICBlbmQKCiAgICBpZiBkZWJ1Z19yZXNvbHZlciA9PSB0cnVlIHRoZW4KICAgICAgICBmb3IgayxlbnQgaW4gaXBhaXJzKGVudGl0eS5nZXRfcGxheWVycyh0cnVlKSkgZG8KICAgICAgICAgICAgcGxpc3Quc2V0KGVudCwiRm9yY2UgcGl0Y2giLGZhbHNlKQogICAgICAgICAgICBwbGlzdC5zZXQoZW50LCJGb3JjZSBib2R5IHlhdyIsZmFsc2UpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBoaWRlX2RlZmF1bHRfYWEodHJ1ZSkKZW5kKQoKY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygiYm9tYl9leHBsb2RlZCIsZnVuY3Rpb24oKQogICAgYWFfZnVuY3Rpb25zLmJvbWJfd2FzX2JvbWJlZCA9IHRydWUKZW5kKQoKY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygiYm9tYl9kZWZ1c2VkIixmdW5jdGlvbigpCiAgICBhYV9mdW5jdGlvbnMuYm9tYl93YXNfZGVmdXNlZCA9IHRydWUKZW5kKQ=="}