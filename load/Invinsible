{"status":200,"content":"LS0gQHJlZ2lvbiBMVUFTRVRUSU5HUyBzdGFydApsb2NhbCBsdWFfbmFtZSA9ICJJbnZpbnNpYmxlIgpsb2NhbCBsdWFfY29sb3IgPSB7ciA9IDI1NSwgZyA9IDI1NSwgYiA9IDI1NX0KbG9jYWwgc2NyaXB0X2J1aWxkID0gIlJlbmV3ZWQiCgotLSBAcmVnaW9uIExVQVNFVFRJTkdTIGVuZAoKLS0gcmVnaW9uIFVTRVJEQVRBCgpsb2NhbCBjaGFwdGVyX2RhdGEgPSBjaGFwdGVyX2ZldGNoIGFuZCBjaGFwdGVyX2ZldGNoKCkgb3Ige3VzZXJuYW1lID0gc3RlYW1uYW1lLCBidWlsZCA9ICdiZXRhJywgZGlzY29yZD0nJ30KbG9jYWwgdXNlcmRhdGEgPSB7CiAgICB1c2VybmFtZSA9IGNoYXB0ZXJfZGF0YS51c2VybmFtZSA9PSBuaWwgb3IgY2hhcHRlcl9kYXRhLnVzZXJuYW1lLAp9CgotLSB1c2VyZGF0YSBlbmQKCi0tIEByZWdpb24gREVQRU5ERU5DSUVTIHN0YXJ0CmxvY2FsIGZ1bmN0aW9uIHRyeV9yZXF1aXJlKG1vZHVsZSwgbXNnKQogICAgbG9jYWwgc3VjY2VzcywgcmVzdWx0ID0gcGNhbGwocmVxdWlyZSwgbW9kdWxlKQogICAgaWYgc3VjY2VzcyB0aGVuIHJldHVybiByZXN1bHQgZWxzZSByZXR1cm4gZXJyb3IobXNnKSBlbmQKZW5kCgpsb2NhbCBncmFtX2NyZWF0ZSA9IGZ1bmN0aW9uKHZhbHVlLCBjb3VudCkgbG9jYWwgZ3JhbSA9IHsgfTsgZm9yIGk9MSwgY291bnQgZG8gZ3JhbVtpXSA9IHZhbHVlOyBlbmQgcmV0dXJuIGdyYW07IGVuZApsb2NhbCBncmFtX3VwZGF0ZSA9IGZ1bmN0aW9uKHRhYiwgdmFsdWUsIGZvcmNlZCkgbG9jYWwgbmV3X3RhYiA9IHRhYjsgaWYgZm9yY2VkIG9yIG5ld190YWJbI25ld190YWJdIH49IHZhbHVlIHRoZW4gdGFibGUuaW5zZXJ0KG5ld190YWIsIHZhbHVlKTsgdGFibGUucmVtb3ZlKG5ld190YWIsIDEpOyBlbmQ7IHRhYiA9IG5ld190YWI7IGVuZApsb2NhbCBnZXRfYXZlcmFnZSA9IGZ1bmN0aW9uKHRhYikgbG9jYWwgZWxlbWVudHMsIHN1bSA9IDAsIDA7IGZvciBrLCB2IGluIHBhaXJzKHRhYikgZG8gc3VtID0gc3VtICsgdjsgZWxlbWVudHMgPSBlbGVtZW50cyArIDE7IGVuZCByZXR1cm4gc3VtIC8gZWxlbWVudHM7IGVuZApsb2NhbCBpbWFnZXMgPSB0cnlfcmVxdWlyZSgiZ2FtZXNlbnNlL2ltYWdlcyIsICJEb3dubG9hZCBpbWFnZXMgbGlicmFyeTogaHR0cHM6Ly9nYW1lc2Vuc2UucHViL2ZvcnVtcy92aWV3dG9waWMucGhwP2lkPTIyOTE3IikKbG9jYWwgYml0ID0gdHJ5X3JlcXVpcmUoImJpdCIpCmxvY2FsIGJhc2U2NCA9IHRyeV9yZXF1aXJlKCJnYW1lc2Vuc2UvYmFzZTY0IiwgIkRvd25sb2FkIGJhc2U2NCBlbmNvZGUvZGVjb2RlIGxpYnJhcnk6IGh0dHBzOi8vZ2FtZXNlbnNlLnB1Yi9mb3J1bXMvdmlld3RvcGljLnBocD9pZD0yMTYxOSIpCmxvY2FsIGFudGlhaW1fZnVuY3MgPSB0cnlfcmVxdWlyZSgiZ2FtZXNlbnNlL2FudGlhaW1fZnVuY3MiLCAiRG93bmxvYWQgYW50aS1haW0gZnVuY3Rpb25zIGxpYnJhcnk6IGh0dHBzOi8vZ2FtZXNlbnNlLnB1Yi9mb3J1bXMvdmlld3RvcGljLnBocD9pZD0yOTY2NSIpCmxvY2FsIGZmaSA9IHRyeV9yZXF1aXJlKCJmZmkiLCAiRmFpbGVkIHRvIHJlcXVpcmUgRkZJLCBwbGVhc2UgbWFrZSBzdXJlIEFsbG93IHVuc2FmZSBzY3JpcHRzIGlzIGVuYWJsZWQhIikKbG9jYWwgdmVjdG9yID0gdHJ5X3JlcXVpcmUoInZlY3RvciIsICJNaXNzaW5nIHZlY3RvciIpCmxvY2FsIGh0dHAgPSB0cnlfcmVxdWlyZSgiZ2FtZXNlbnNlL2h0dHAiLCAiRG93bmxvYWQgSFRUUCBsaWJyYXJ5OiBodHRwczovL2dhbWVzZW5zZS5wdWIvZm9ydW1zL3ZpZXd0b3BpYy5waHA/aWQ9MjE2MTkiKQpsb2NhbCBjbGlwYm9hcmQgPSB0cnlfcmVxdWlyZSgiZ2FtZXNlbnNlL2NsaXBib2FyZCIsICJEb3dubG9hZCBDbGlwYm9hcmQgbGlicmFyeTogaHR0cHM6Ly9nYW1lc2Vuc2UucHViL2ZvcnVtcy92aWV3dG9waWMucGhwP2lkPTI4Njc4IikKbG9jYWwgZW50ID0gdHJ5X3JlcXVpcmUoImdhbWVzZW5zZS9lbnRpdHkiLCAiRG93bmxvYWQgRW50aXR5IE9iamVjdCBsaWJyYXJ5OiBodHRwczovL2dhbWVzZW5zZS5wdWIvZm9ydW1zL3ZpZXd0b3BpYy5waHA/aWQ9Mjc1MjkiKQpsb2NhbCBjc2dvX3dlYXBvbnMgPSB0cnlfcmVxdWlyZSgiZ2FtZXNlbnNlL2NzZ29fd2VhcG9ucyIsICJEb3dubG9hZCBDUzpHTyB3ZWFwb24gZGF0YSBsaWJyYXJ5OiBodHRwczovL2dhbWVzZW5zZS5wdWIvZm9ydW1zL3ZpZXd0b3BpYy5waHA/aWQ9MTg4MDciKQpsb2NhbCBzdGVhbXdvcmtzID0gdHJ5X3JlcXVpcmUoImdhbWVzZW5zZS9zdGVhbXdvcmtzIikgb3IgZXJyb3IoJ01pc3NpbmcgaHR0cHM6Ly9nYW1lc2Vuc2UucHViL2ZvcnVtcy92aWV3dG9waWMucGhwP2lkPTI2NTI2JykKZnVuY3Rpb24gdWkubXVsdGlSZWZlcmVuY2UodGFiLCBncm91cGJveCwgbmFtZSkKICAgIGxvY2FsIHJlZjEsIHJlZjIsIHJlZjMgPSB1aS5yZWZlcmVuY2UodGFiLCBncm91cGJveCwgbmFtZSkKICAgIHJldHVybiB7IHJlZjEsIHJlZjIsIHJlZjMgfQplbmQKLS0gQHJlZ2lvbiBERVBFTkRFTkNJRVMgZW5kCgotLSBAcmVnaW9uIFVTRVJEQVRBIHN0YXJ0CmNsaWVudC5leGVjKCJjbGVhciIpCmNsaWVudC5jb2xvcl9sb2coMjU1LCAyNTUsIDI1NSwgIldlbGNvbWUgdG9cMCIpCmNsaWVudC5jb2xvcl9sb2cobHVhX2NvbG9yLnIsIGx1YV9jb2xvci5nLCBsdWFfY29sb3IuYiwgIiBJbnZpbnNpYmxlIikKCmxvY2FsIGx1YSA9IHt9Cmx1YS5kYXRhYmFzZSA9IHsKICAgIGNvbmZpZ3MgPSAiOiIgLi4gbHVhX25hbWUgLi4gIjo6Y29uZmlnczoiCn0KbG9jYWwgcHJlc2V0cyA9IHt9Ci0tIEByZWdpb24gVVNFUkRBVEEgZW5kCgotLSBAcmVnaW9uIFJFRkVSRU5DRVMgc3RhcnQKbG9jYWwgcmVmcyA9IHsKICAgIHNsb3dtb3Rpb24gPSB1aS5yZWZlcmVuY2UoIkFBIiwgIk90aGVyIiwgIlNsb3cgbW90aW9uIiksCiAgICBPU0FBQSA9IHVpLnJlZmVyZW5jZSgiQUEiLCAiT3RoZXIiLCAiT24gc2hvdCBhbnRpLWFpbSIpLAogICAgTGVnbW92ZXMgPSB1aS5yZWZlcmVuY2UoIkFBIiwgIk90aGVyIiwgIkxlZyBtb3ZlbWVudCIpLAogICAgbGVnaXQgPSB1aS5yZWZlcmVuY2UoIkxFR0lUIiwgIkFpbWJvdCIsICJFbmFibGVkIiksCiAgICBtaW5pbXVtX2RhbWFnZV9vdmVycmlkZSA9IHsgdWkucmVmZXJlbmNlKCJSYWdlIiwgIkFpbWJvdCIsICJNaW5pbXVtIGRhbWFnZSBvdmVycmlkZSIpIH0sCiAgICBmYWtlRHVjayA9IHVpLnJlZmVyZW5jZSgiUkFHRSIsICJPdGhlciIsICJEdWNrIHBlZWsgYXNzaXN0IiksCiAgICBtaW5pbXVtX2RhbWFnZSA9IHVpLnJlZmVyZW5jZSgiUmFnZSIsICJBaW1ib3QiLCAiTWluaW11bSBkYW1hZ2UiKSwKICAgIGhpdENoYW5jZSA9IHVpLnJlZmVyZW5jZSgiUkFHRSIsICJBaW1ib3QiLCAiTWluaW11bSBoaXQgY2hhbmNlIiksCiAgICBzYWZlUG9pbnQgPSB1aS5yZWZlcmVuY2UoIlJBR0UiLCAiQWltYm90IiwgIkZvcmNlIHNhZmUgcG9pbnQiKSwKICAgIGZvcmNlQmFpbSA9IHVpLnJlZmVyZW5jZSgiUkFHRSIsICJBaW1ib3QiLCAiRm9yY2UgYm9keSBhaW0iKSwKICAgIGR0TGltaXQgPSB1aS5yZWZlcmVuY2UoIlJBR0UiLCAiQWltYm90IiwgIkRvdWJsZSB0YXAgZmFrZSBsYWcgbGltaXQiKSwKICAgIHF1aWNrUGVlayA9IHt1aS5yZWZlcmVuY2UoIlJBR0UiLCAiT3RoZXIiLCAiUXVpY2sgcGVlayBhc3Npc3QiKX0sCiAgICBkdCA9IHt1aS5yZWZlcmVuY2UoIlJBR0UiLCAiQWltYm90IiwgIkRvdWJsZSB0YXAiKX0sCiAgICBlbmFibGVkID0gdWkucmVmZXJlbmNlKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiRW5hYmxlZCIpLAogICAgcGl0Y2ggPSB7dWkucmVmZXJlbmNlKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAicGl0Y2giKX0sCiAgICByb2xsID0gdWkucmVmZXJlbmNlKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAicm9sbCIpLAogICAgeWF3QmFzZSA9IHVpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIllhdyBiYXNlIiksCiAgICB5YXcgPSB7dWkucmVmZXJlbmNlKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiWWF3Iil9LAogICAgZmxMaW1pdCA9IHVpLnJlZmVyZW5jZSgiQUEiLCAiRmFrZSBsYWciLCAiTGltaXQiKSwKICAgIGZsYW1vdW50ID0gdWkucmVmZXJlbmNlKCJBQSIsICJGYWtlIGxhZyIsICJBbW91bnQiKSwKICAgIGZsZW5hYmxlZCA9IHVpLnJlZmVyZW5jZSgiQUEiLCAiRmFrZSBsYWciLCAiRW5hYmxlZCIpLAogICAgZmxWYXJpYW5jZSA9IHVpLnJlZmVyZW5jZSgiQUEiLCAiRmFrZSBsYWciLCAiVmFyaWFuY2UiKSwKICAgIEFBZmFrZSA9IHVpLnJlZmVyZW5jZSgiQUEiLCAiT3RoZXIiLCAiRmFrZSBwZWVrIiksCiAgICBmc0JvZHlZYXcgPSB1aS5yZWZlcmVuY2UoIkFBIiwgImFudGktYWltYm90IGFuZ2xlcyIsICJGcmVlc3RhbmRpbmcgYm9keSB5YXciKSwKICAgIGVkZ2VZYXcgPSB1aS5yZWZlcmVuY2UoIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJFZGdlIHlhdyIpLAogICAgeWF3Sml0dGVyID0ge3VpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIllhdyBqaXR0ZXIiKX0sCiAgICBib2R5WWF3ID0ge3VpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIkJvZHkgeWF3Iil9LAogICAgZnJlZVN0YW5kID0ge3VpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIkZyZWVzdGFuZGluZyIpfSwKICAgIG9zID0ge3VpLnJlZmVyZW5jZSgiQUEiLCAiT3RoZXIiLCAiT24gc2hvdCBhbnRpLWFpbSIpfSwKICAgIHNsb3cgPSB7dWkucmVmZXJlbmNlKCJBQSIsICJPdGhlciIsICJTbG93IG1vdGlvbiIpfSwKICAgIGZha2VMYWcgPSB7dWkucmVmZXJlbmNlKCJBQSIsICJGYWtlIGxhZyIsICJMaW1pdCIpfSwKICAgIGxlZ01vdmVtZW50ID0gdWkucmVmZXJlbmNlKCJBQSIsICJPdGhlciIsICJMZWcgbW92ZW1lbnQiKSwKICAgIGluZGljYXRvcnMgPSB7dWkucmVmZXJlbmNlKCJWSVNVQUxTIiwgIk90aGVyIEVTUCIsICJGZWF0dXJlIGluZGljYXRvcnMiKX0sCiAgICBwaW5nID0ge3VpLnJlZmVyZW5jZSgiTUlTQyIsICJNaXNjZWxsYW5lb3VzIiwgIlBpbmcgc3Bpa2UiKX0sCn0KCmxvY2FsIHJlZiA9IHsKICAgIGFpbWJvdCA9IHVpLnJlZmVyZW5jZSgnUkFHRScsICdBaW1ib3QnLCAnRW5hYmxlZCcpLAogICAgZG91YmxldGFwID0gewogICAgICAgIG1haW4gPSB7IHVpLnJlZmVyZW5jZSgnUkFHRScsICdBaW1ib3QnLCAnRG91YmxlIHRhcCcpIH0sCiAgICAgICAgZmFrZWxhZ19saW1pdCA9IHVpLnJlZmVyZW5jZSgnUkFHRScsICdBaW1ib3QnLCAnRG91YmxlIHRhcCBmYWtlIGxhZyBsaW1pdCcpCiAgICB9Cn0KCmxvY2FsIGJpbmRzID0gewogICAgbGVnTW92ZW1lbnQgPSB1aS5tdWx0aVJlZmVyZW5jZSgiQUEiLCAiT3RoZXIiLCAiTGVnIG1vdmVtZW50IiksCiAgICBmbGVuYWJsZWQgPSB1aS5tdWx0aVJlZmVyZW5jZSgiQUEiLCAiRmFrZSBsYWciLCAiRW5hYmxlZCIpLAogICAgc2xvd21vdGlvbiA9IHVpLm11bHRpUmVmZXJlbmNlKCJBQSIsICJPdGhlciIsICJTbG93IG1vdGlvbiIpLAogICAgT1NBQUEgPSB1aS5tdWx0aVJlZmVyZW5jZSgiQUEiLCAiT3RoZXIiLCAiT24gc2hvdCBhbnRpLWFpbSIpLAogICAgQUFmYWtlID0gdWkubXVsdGlSZWZlcmVuY2UoIkFBIiwgIk90aGVyIiwgIkZha2UgcGVlayIpLAp9Cgpsb2NhbCBmdW5jdGlvbiB0cmF2ZXJzZV90YWJsZV9vbih0YmwsIHByZWZpeCkKICAgIHByZWZpeCA9IHByZWZpeCBvciAiIgogICAgbG9jYWwgc3RhY2sgPSB7e3RibCwgcHJlZml4fX0KCiAgICB3aGlsZSAjc3RhY2sgPiAwIGRvCiAgICAgICAgbG9jYWwgY3VycmVudCA9IHRhYmxlLnJlbW92ZShzdGFjaykKICAgICAgICBsb2NhbCBjdXJyZW50X3RibCA9IGN1cnJlbnRbMV0KICAgICAgICBsb2NhbCBjdXJyZW50X3ByZWZpeCA9IGN1cnJlbnRbMl0KCiAgICAgICAgZm9yIGtleSwgdmFsdWUgaW4gcGFpcnMoY3VycmVudF90YmwpIGRvCiAgICAgICAgICAgIGxvY2FsIGZ1bGxfa2V5ID0gY3VycmVudF9wcmVmaXggLi4ga2V5CiAgICAgICAgICAgIGlmIHR5cGUodmFsdWUpID09ICJ0YWJsZSIgdGhlbgogICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHN0YWNrLCB7dmFsdWUsIGZ1bGxfa2V5IC4uICIuIn0pCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIC0tINCf0YDQuNC80LXQvdGP0LXQvCB1aS5zZXRfdmlzaWJsZSDQuiDQutCw0LbQtNC+0LzRgyDRjdC70LXQvNC10L3RgtGDCiAgICAgICAgICAgICAgICB1aS5zZXRfdmlzaWJsZSh2YWx1ZSwgdHJ1ZSkgLS0g0JfQtNC10YHRjCDQvNC+0LbQvdC+INC40LfQvNC10L3QuNGC0Ywg0L/QsNGA0LDQvNC10YLRgCDQstC40LTQuNC80L7RgdGC0Lgg0L3QsCDQvdGD0LbQvdC+0LUg0LfQvdCw0YfQtdC90LjQtQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIHRyYXZlcnNlX3RhYmxlKHRibCwgcHJlZml4KQogICAgcHJlZml4ID0gcHJlZml4IG9yICIiCiAgICBsb2NhbCBzdGFjayA9IHt7dGJsLCBwcmVmaXh9fQoKICAgIHdoaWxlICNzdGFjayA+IDAgZG8KICAgICAgICBsb2NhbCBjdXJyZW50ID0gdGFibGUucmVtb3ZlKHN0YWNrKQogICAgICAgIGxvY2FsIGN1cnJlbnRfdGJsID0gY3VycmVudFsxXQogICAgICAgIGxvY2FsIGN1cnJlbnRfcHJlZml4ID0gY3VycmVudFsyXQoKICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiBwYWlycyhjdXJyZW50X3RibCkgZG8KICAgICAgICAgICAgbG9jYWwgZnVsbF9rZXkgPSBjdXJyZW50X3ByZWZpeCAuLiBrZXkKICAgICAgICAgICAgaWYgdHlwZSh2YWx1ZSkgPT0gInRhYmxlIiB0aGVuCiAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoc3RhY2ssIHt2YWx1ZSwgZnVsbF9rZXkgLi4gIi4ifSkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgLS0g0J/RgNC40LzQtdC90Y/QtdC8IHVpLnNldF92aXNpYmxlINC6INC60LDQttC00L7QvNGDINGN0LvQtdC80LXQvdGC0YMKICAgICAgICAgICAgICAgIHVpLnNldF92aXNpYmxlKHZhbHVlLCBmYWxzZSkgLS0g0JfQtNC10YHRjCDQvNC+0LbQvdC+INC40LfQvNC10L3QuNGC0Ywg0L/QsNGA0LDQvNC10YLRgCDQstC40LTQuNC80L7RgdGC0Lgg0L3QsCDQvdGD0LbQvdC+0LUg0LfQvdCw0YfQtdC90LjQtQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKLS0gQHJlZ2lvbiBSRUZFUkVOQ0VTIGVuZAoKLS0gQHJlZ2lvbiBWQVJJQUJMRVMgc3RhcnQKbG9jYWwgdmFycyA9IHsKICAgIGxvY2FsUGxheWVyID0gMCwKICAgIGhpdGdyb3VwX25hbWVzID0geyAnR2VuZXJpYycsICdIZWFkJywgJ0NoZXN0JywgJ1N0b21hY2gnLCAnTGVmdCBhcm0nLCAnUmlnaHQgYXJtJywgJ0xlZnQgbGVnJywgJ1JpZ2h0IGxlZycsICdOZWNrJywgJz8nLCAnR2VhcicgfSwKICAgIGFhU3RhdGVzID0geyJHbG9iYWwiLCAiU3RhbmRpbmciLCAiTW92aW5nIiwgIlNsb3d3YWxraW5nIiwgIkNyb3VjaGluZyIsICJBaXIiLCAiQWlyLUNyb3VjaGluZyIsICJDcm91Y2gtTW92aW5nIiwgIkZha2VsYWcifSwKICAgIHBTdGF0ZXMgPSB7IkciLCAiUyIsICJNIiwgIlNXIiwgIkMiLCAiQSIsICJBQyIsICJDTSIsICJGTCJ9LAoJc1RvSW50ID0ge1siR2xvYmFsIl0gPSAxLCBbIlN0YW5kaW5nIl0gPSAyLCBbIk1vdmluZyJdID0gMywgWyJTbG93d2Fsa2luZyJdID0gNCwgWyJDcm91Y2hpbmciXSA9IDUsIFsiQWlyIl0gPSA2LCBbIkFpci1Dcm91Y2hpbmciXSA9IDcsIFsiQ3JvdWNoLU1vdmluZyJdID0gOCAsIFsiRmFrZWxhZyJdID0gOX0sCiAgICBpbnRUb1MgPSB7WzFdID0gIkdsb2JhbCIsIFsyXSA9ICJTdGFuZGluZyIsIFszXSA9ICJNb3ZpbmciLCBbNF0gPSAiU2xvd3dhbGtpbmciLCBbNV0gPSAiQ3JvdWNoaW5nIiwgWzZdID0gIkFpciIsIFs3XSA9ICJBaXItQ3JvdWNoaW5nIiwgWzhdID0gIkNyb3VjaC1Nb3ZpbmciLCBbOV0gPSAiRmFrZWxhZyJ9LAogICAgY3VycmVudFRhYiA9IDEsCiAgICBhY3RpdmVTdGF0ZSA9IDEsCiAgICBwU3RhdGUgPSAxLAogICAgeWF3ID0gMCwKICAgIHNpZGVtb3ZlID0gMCwKICAgIG0xX3RpbWUgPSAwLAogICAgY2hva2VkID0gMCwKICAgIGR0X3N0YXRlID0gMCwKICAgIGRvdWJsZXRhcF90aW1lID0gMCwKICAgIGJyZWFrZXIgPSB7CiAgICAgICAgZGVmZW5zaXZlID0gMCwKICAgICAgICBkZWZlbnNpdmVfY2hlY2sgPSAwLAogICAgICAgIGNtZCA9IDAsCiAgICAgICAgbGFzdF9vcmlnaW4gPSBuaWwsCiAgICAgICAgb3JpZ2luID0gbmlsLAogICAgICAgIHRwX2Rpc3QgPSAwLAogICAgICAgIHRwX2RhdGEgPSBncmFtX2NyZWF0ZSgwLDMpCiAgICB9LAogICAgbWFwbmFtZSA9IGdsb2JhbHMubWFwbmFtZSgpCn0KCmxvY2FsIGpzID0gcGFub3JhbWEub3BlbigpCmxvY2FsIE15UGVyc29uYUFQSSwgTG9iYnlBUEksIFBhcnR5TGlzdEFQSSwgU3RlYW1PdmVybGF5QVBJID0ganMuTXlQZXJzb25hQVBJLCBqcy5Mb2JieUFQSSwganMuUGFydHlMaXN0QVBJLCBqcy5TdGVhbU92ZXJsYXlBUEkKLS0gQHJlZ2lvbiBWQVJJQUJMRVMgZW5kCgotLSBAcmVnaW9uIEZGSSBzdGFydApsb2NhbCBhbmdsZTNkX3N0cnVjdCA9IGZmaS50eXBlb2YoInN0cnVjdCB7IGZsb2F0IHBpdGNoOyBmbG9hdCB5YXc7IGZsb2F0IHJvbGw7IH0iKQpsb2NhbCB2ZWNfc3RydWN0ID0gZmZpLnR5cGVvZigic3RydWN0IHsgZmxvYXQgeDsgZmxvYXQgeTsgZmxvYXQgejsgfSIpCgpsb2NhbCBjVXNlckNtZCA9CiAgICBmZmkudHlwZW9mKAogICAgW1sKICAgIHN0cnVjdAogICAgewogICAgICAgIHVpbnRwdHJfdCB2ZnB0cjsKICAgICAgICBpbnQgY29tbWFuZF9udW1iZXI7CiAgICAgICAgaW50IHRpY2tfY291bnQ7CiAgICAgICAgJCB2aWV3YW5nbGVzOwogICAgICAgICQgYWltZGlyZWN0aW9uOwogICAgICAgIGZsb2F0IGZvcndhcmRtb3ZlOwogICAgICAgIGZsb2F0IHNpZGVtb3ZlOwogICAgICAgIGZsb2F0IHVwbW92ZTsKICAgICAgICBpbnQgYnV0dG9uczsKICAgICAgICB1aW50OF90IGltcHVsc2U7CiAgICAgICAgaW50IHdlYXBvbnNlbGVjdDsKICAgICAgICBpbnQgd2VhcG9uc3VidHlwZTsKICAgICAgICBpbnQgcmFuZG9tX3NlZWQ7CiAgICAgICAgc2hvcnQgbW91c2VkeDsKICAgICAgICBzaG9ydCBtb3VzZWR5OwogICAgICAgIGJvb2wgaGFzYmVlbnByZWRpY3RlZDsKICAgICAgICAkIGhlYWRhbmdsZXM7CiAgICAgICAgJCBoZWFkb2Zmc2V0OwogICAgICAgIGJvb2wgc2VuZF9wYWNrZXQ7IAogICAgfQogICAgXV0sCiAgICBhbmdsZTNkX3N0cnVjdCwKICAgIHZlY19zdHJ1Y3QsCiAgICBhbmdsZTNkX3N0cnVjdCwKICAgIHZlY19zdHJ1Y3QKKQoKbG9jYWwgY2xpZW50X3NpZyA9IGNsaWVudC5maW5kX3NpZ25hdHVyZSgiY2xpZW50LmRsbCIsICJceEI5XHhDQ1x4Q0NceENDXHhDQ1x4OEJceDQwXHgzOFx4RkZceEQwXHg4NFx4QzBceDBGXHg4NSIpIG9yIGVycm9yKCJjbGllbnQuZGxsITppbnB1dCBub3QgZm91bmQuIikKbG9jYWwgZ2V0X2NVc2VyQ21kID0gZmZpLnR5cGVvZigiJCogKF9fdGhpc2NhbGwqKSh1aW50cHRyX3QgZWN4LCBpbnQgblNsb3QsIGludCBzZXF1ZW5jZV9udW1iZXIpIiwgY1VzZXJDbWQpCmxvY2FsIGlucHV0X3Z0YmwgPSBmZmkudHlwZW9mKFtbc3RydWN0e3VpbnRwdHJfdCBwYWRkaW5nWzhdOyQgR2V0VXNlckNtZDt9XV0sZ2V0X2NVc2VyQ21kKQpsb2NhbCBpbnB1dCA9IGZmaS50eXBlb2YoW1tzdHJ1Y3R7JCogdmZwdHI7fSpdXSwgaW5wdXRfdnRibCkKbG9jYWwgZ2V0X2lucHV0ID0gZmZpLmNhc3QoaW5wdXQsZmZpLmNhc3QoInVpbnRwdHJfdCoqIix0b251bWJlcihmZmkuY2FzdCgidWludHB0cl90IiwgY2xpZW50X3NpZykpICsgMSlbMF0pCi0tIEByZWdpb24gRkZJIGVuZAoKLS0gQHJlZ2lvbiBGVU5DUyBzdGFydApsb2NhbCBmdW5jID0gewogICAgcmVuZGVyX3RleHQgPSBmdW5jdGlvbih4LCB5LCAuLi4pCiAgICAgICAgbG9jYWwgeF9PZmZzZXQgPSAwCiAgICAgICAgCiAgICAgICAgbG9jYWwgYXJncyA9IHsuLi59CiAgICAKICAgICAgICBmb3IgaSwgbGluZSBpbiBwYWlycyhhcmdzKSBkbwogICAgICAgICAgICBsb2NhbCByLCBnLCBiLCBhLCB0ZXh0ID0gdW5wYWNrKGxpbmUpCiAgICAgICAgICAgIGxvY2FsIHNpemUgPSB2ZWN0b3IocmVuZGVyZXIubWVhc3VyZV90ZXh0KCItZCIsIHRleHQpKQogICAgICAgICAgICByZW5kZXJlci50ZXh0KHggKyB4X09mZnNldCwgeSwgciwgZywgYiwgYSwgIi1kIiwgMCwgdGV4dCkKICAgICAgICAgICAgeF9PZmZzZXQgPSB4X09mZnNldCArIHNpemUueAogICAgICAgIGVuZAogICAgZW5kLAogICAgZWFzZUluT3V0ID0gZnVuY3Rpb24odCkKICAgICAgICByZXR1cm4gKHQgPiAwLjUpIGFuZCA0KigodC0xKV4zKSsxIG9yIDQqdF4zOwogICAgZW5kLAogICAgcmVjID0gZnVuY3Rpb24oeCwgeSwgdywgaCwgcmFkaXVzLCBjb2xvcikKICAgICAgICByYWRpdXMgPSBtYXRoLm1pbih4LzIsIHkvMiwgcmFkaXVzKQogICAgICAgIGxvY2FsIHIsIGcsIGIsIGEgPSB1bnBhY2soY29sb3IpCiAgICAgICAgcmVuZGVyZXIucmVjdGFuZ2xlKHgsIHkgKyByYWRpdXMsIHcsIGggLSByYWRpdXMqMiwgciwgZywgYiwgYSkKICAgICAgICByZW5kZXJlci5yZWN0YW5nbGUoeCArIHJhZGl1cywgeSwgdyAtIHJhZGl1cyoyLCByYWRpdXMsIHIsIGcsIGIsIGEpCiAgICAgICAgcmVuZGVyZXIucmVjdGFuZ2xlKHggKyByYWRpdXMsIHkgKyBoIC0gcmFkaXVzLCB3IC0gcmFkaXVzKjIsIHJhZGl1cywgciwgZywgYiwgYSkKICAgICAgICByZW5kZXJlci5jaXJjbGUoeCArIHJhZGl1cywgeSArIHJhZGl1cywgciwgZywgYiwgYSwgcmFkaXVzLCAxODAsIDAuMjUpCiAgICAgICAgcmVuZGVyZXIuY2lyY2xlKHggLSByYWRpdXMgKyB3LCB5ICsgcmFkaXVzLCByLCBnLCBiLCBhLCByYWRpdXMsIDkwLCAwLjI1KQogICAgICAgIHJlbmRlcmVyLmNpcmNsZSh4IC0gcmFkaXVzICsgdywgeSAtIHJhZGl1cyArIGgsIHIsIGcsIGIsIGEsIHJhZGl1cywgMCwgMC4yNSkKICAgICAgICByZW5kZXJlci5jaXJjbGUoeCArIHJhZGl1cywgeSAtIHJhZGl1cyArIGgsIHIsIGcsIGIsIGEsIHJhZGl1cywgLTkwLCAwLjI1KQogICAgZW5kLAogICAgcmVjX291dGxpbmUgPSBmdW5jdGlvbih4LCB5LCB3LCBoLCByYWRpdXMsIHRoaWNrbmVzcywgY29sb3IpCiAgICAgICAgcmFkaXVzID0gbWF0aC5taW4ody8yLCBoLzIsIHJhZGl1cykKICAgICAgICBsb2NhbCByLCBnLCBiLCBhID0gdW5wYWNrKGNvbG9yKQogICAgICAgIGlmIHJhZGl1cyA9PSAxIHRoZW4KICAgICAgICAgICAgcmVuZGVyZXIucmVjdGFuZ2xlKHgsIHksIHcsIHRoaWNrbmVzcywgciwgZywgYiwgYSkKICAgICAgICAgICAgcmVuZGVyZXIucmVjdGFuZ2xlKHgsIHkgKyBoIC0gdGhpY2tuZXNzLCB3ICwgdGhpY2tuZXNzLCByLCBnLCBiLCBhKQogICAgICAgIGVsc2UKICAgICAgICAgICAgcmVuZGVyZXIucmVjdGFuZ2xlKHggKyByYWRpdXMsIHksIHcgLSByYWRpdXMqMiwgdGhpY2tuZXNzLCByLCBnLCBiLCBhKQogICAgICAgICAgICByZW5kZXJlci5yZWN0YW5nbGUoeCArIHJhZGl1cywgeSArIGggLSB0aGlja25lc3MsIHcgLSByYWRpdXMqMiwgdGhpY2tuZXNzLCByLCBnLCBiLCBhKQogICAgICAgICAgICByZW5kZXJlci5yZWN0YW5nbGUoeCwgeSArIHJhZGl1cywgdGhpY2tuZXNzLCBoIC0gcmFkaXVzKjIsIHIsIGcsIGIsIGEpCiAgICAgICAgICAgIHJlbmRlcmVyLnJlY3RhbmdsZSh4ICsgdyAtIHRoaWNrbmVzcywgeSArIHJhZGl1cywgdGhpY2tuZXNzLCBoIC0gcmFkaXVzKjIsIHIsIGcsIGIsIGEpCiAgICAgICAgICAgIHJlbmRlcmVyLmNpcmNsZV9vdXRsaW5lKHggKyByYWRpdXMsIHkgKyByYWRpdXMsIHIsIGcsIGIsIGEsIHJhZGl1cywgMTgwLCAwLjI1LCB0aGlja25lc3MpCiAgICAgICAgICAgIHJlbmRlcmVyLmNpcmNsZV9vdXRsaW5lKHggKyByYWRpdXMsIHkgKyBoIC0gcmFkaXVzLCByLCBnLCBiLCBhLCByYWRpdXMsIDkwLCAwLjI1LCB0aGlja25lc3MpCiAgICAgICAgICAgIHJlbmRlcmVyLmNpcmNsZV9vdXRsaW5lKHggKyB3IC0gcmFkaXVzLCB5ICsgcmFkaXVzLCByLCBnLCBiLCBhLCByYWRpdXMsIC05MCwgMC4yNSwgdGhpY2tuZXNzKQogICAgICAgICAgICByZW5kZXJlci5jaXJjbGVfb3V0bGluZSh4ICsgdyAtIHJhZGl1cywgeSArIGggLSByYWRpdXMsIHIsIGcsIGIsIGEsIHJhZGl1cywgMCwgMC4yNSwgdGhpY2tuZXNzKQogICAgICAgIGVuZAogICAgZW5kLAogICAgY2xhbXAgPSBmdW5jdGlvbih4LCBtaW4sIG1heCkKICAgICAgICByZXR1cm4geCA8IG1pbiBhbmQgbWluIG9yIHggPiBtYXggYW5kIG1heCBvciB4CiAgICBlbmQsCiAgICB0YWJsZV9jb250YWlucyA9IGZ1bmN0aW9uKHRibCwgdmFsdWUpCiAgICAgICAgZm9yIGkgPSAxLCAjdGJsIGRvCiAgICAgICAgICAgIGlmIHRibFtpXSA9PSB2YWx1ZSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICByZXR1cm4gZmFsc2UKICAgIGVuZCwKICAgIHNldEFBVGFiID0gZnVuY3Rpb24ocmVmKQogICAgICAgIHVpLnNldF92aXNpYmxlKHJlZnMuZW5hYmxlZCwgcmVmKQogICAgICAgIHVpLnNldF92aXNpYmxlKHJlZnMucGl0Y2hbMV0sIHJlZikKICAgICAgICB1aS5zZXRfdmlzaWJsZShyZWZzLnBpdGNoWzJdLCByZWYpCiAgICAgICAgdWkuc2V0X3Zpc2libGUocmVmcy5yb2xsLCByZWYpCiAgICAgICAgdWkuc2V0X3Zpc2libGUocmVmcy5zbG93bW90aW9uLCByZWYpCiAgICAgICAgdWkuc2V0X3Zpc2libGUocmVmcy5MZWdtb3ZlcywgcmVmKQogICAgICAgIHVpLnNldF92aXNpYmxlKHJlZnMueWF3QmFzZSwgcmVmKQogICAgICAgIHVpLnNldF92aXNpYmxlKHJlZnMueWF3WzFdLCByZWYpCiAgICAgICAgdWkuc2V0X3Zpc2libGUocmVmcy55YXdbMl0sIHJlZikKICAgICAgICB1aS5zZXRfdmlzaWJsZShyZWZzLnlhd0ppdHRlclsxXSwgcmVmKQogICAgICAgIHVpLnNldF92aXNpYmxlKHJlZnMueWF3Sml0dGVyWzJdLCByZWYpCiAgICAgICAgdWkuc2V0X3Zpc2libGUocmVmcy5ib2R5WWF3WzFdLCByZWYpCiAgICAgICAgdWkuc2V0X3Zpc2libGUocmVmcy5ib2R5WWF3WzJdLCByZWYpCiAgICAgICAgdWkuc2V0X3Zpc2libGUocmVmcy5mcmVlU3RhbmRbMV0sIHJlZikKICAgICAgICB1aS5zZXRfdmlzaWJsZShyZWZzLmZyZWVTdGFuZFsyXSwgcmVmKQogICAgICAgIHVpLnNldF92aXNpYmxlKHJlZnMuZnNCb2R5WWF3LCByZWYpCiAgICAgICAgdWkuc2V0X3Zpc2libGUocmVmcy5lZGdlWWF3LCByZWYpCiAgICAgICAgdWkuc2V0X3Zpc2libGUocmVmcy5mbExpbWl0LCByZWYpCiAgICAgICAgdWkuc2V0X3Zpc2libGUocmVmcy5mbGFtb3VudCwgcmVmKQogICAgICAgIHVpLnNldF92aXNpYmxlKHJlZnMuZmxWYXJpYW5jZSwgcmVmKQogICAgICAgIHVpLnNldF92aXNpYmxlKHJlZnMuZmxlbmFibGVkLCByZWYpCiAgICAgICAgdWkuc2V0X3Zpc2libGUocmVmcy5BQWZha2UsIHJlZikKICAgICAgICB1aS5zZXRfdmlzaWJsZShyZWZzLk9TQUFBLCByZWYpCiAgICBlbmQsCiAgICBmaW5kRGlzdCA9IGZ1bmN0aW9uICh4MSwgeTEsIHoxLCB4MiwgeTIsIHoyKQogICAgICAgIHJldHVybiBtYXRoLnNxcnQoKHgyIC0geDEpXjIgKyAoeTIgLSB5MSleMiArICh6MiAtIHoxKV4yKQogICAgZW5kLAogICAgcmVzZXRBQVRhYiA9IGZ1bmN0aW9uKCkKICAgICAgICB1aS5zZXQocmVmcy5PU0FBYSwgZmFsc2UpCiAgICAgICAgdWkuc2V0KHJlZnMuZW5hYmxlZCwgZmFsc2UpCiAgICAgICAgdWkuc2V0KHJlZnMucGl0Y2hbMV0sICJPZmYiKQogICAgICAgIHVpLnNldChyZWZzLnBpdGNoWzJdLCAwKQogICAgICAgIHVpLnNldChyZWZzLnJvbGwsIDApCiAgICAgICAgdWkuc2V0KHJlZnMuc2xvd21vdGlvbiwgZmFsc2UpCiAgICAgICAgdWkuc2V0KHJlZnMueWF3QmFzZSwgImxvY2FsIHZpZXciKQogICAgICAgIHVpLnNldChyZWZzLnlhd1sxXSwgIk9mZiIpCiAgICAgICAgdWkuc2V0KHJlZnMueWF3WzJdLCAwKQogICAgICAgIHVpLnNldChyZWZzLnlhd0ppdHRlclsxXSwgIk9mZiIpCiAgICAgICAgdWkuc2V0KHJlZnMueWF3Sml0dGVyWzJdLCAwKQogICAgICAgIHVpLnNldChyZWZzLmJvZHlZYXdbMV0sICJPZmYiKQogICAgICAgIHVpLnNldChyZWZzLmJvZHlZYXdbMl0sIDApCiAgICAgICAgdWkuc2V0KHJlZnMuZnJlZVN0YW5kWzFdLCBmYWxzZSkKICAgICAgICB1aS5zZXQocmVmcy5mcmVlU3RhbmRbMl0sICJPbiBob3RrZXkiKQogICAgICAgIHVpLnNldChyZWZzLmZzQm9keVlhdywgZmFsc2UpCiAgICAgICAgdWkuc2V0KHJlZnMuZWRnZVlhdywgZmFsc2UpCiAgICAgICAgdWkuc2V0KHJlZnMuZmxMaW1pdCwgZmFsc2UpCiAgICAgICAgdWkuc2V0KHJlZnMuZmxhbW91bnQsIGZhbHNlKQogICAgICAgIHVpLnNldChyZWZzLmZsZW5hYmxlZCwgZmFsc2UpCiAgICAgICAgdWkuc2V0KHJlZnMuZmxWYXJpYW5jZSwgZmFsc2UpCiAgICAgICAgdWkuc2V0KHJlZnMuQUFmYWtlLCBmYWxzZSkKICAgIGVuZCwKICAgIHR5cGVfZnJvbV9zdHJpbmcgPSBmdW5jdGlvbihpbnB1dCkKICAgICAgICBpZiB0eXBlKGlucHV0KSB+PSAic3RyaW5nIiB0aGVuIHJldHVybiBpbnB1dCBlbmQKCiAgICAgICAgbG9jYWwgdmFsdWUgPSBpbnB1dDpsb3dlcigpCgogICAgICAgIGlmIHZhbHVlID09ICJ0cnVlIiB0aGVuCiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgZWxzZWlmIHZhbHVlID09ICJmYWxzZSIgdGhlbgogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICBlbHNlaWYgdG9udW1iZXIodmFsdWUpIH49IG5pbCB0aGVuCiAgICAgICAgICAgIHJldHVybiB0b251bWJlcih2YWx1ZSkKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiB0b3N0cmluZyhpbnB1dCkKICAgICAgICBlbmQKICAgIGVuZCwKICAgIGxlcnAgPSBmdW5jdGlvbihzdGFydCwgdmVuZCwgdGltZSkKICAgICAgICByZXR1cm4gc3RhcnQgKyAodmVuZCAtIHN0YXJ0KSAqIHRpbWUKICAgIGVuZCwKICAgIHZlY19hbmdsZXMgPSBmdW5jdGlvbihhbmdsZV94LCBhbmdsZV95KQogICAgICAgIGxvY2FsIHN5ID0gbWF0aC5zaW4obWF0aC5yYWQoYW5nbGVfeSkpCiAgICAgICAgbG9jYWwgY3kgPSBtYXRoLmNvcyhtYXRoLnJhZChhbmdsZV95KSkKICAgICAgICBsb2NhbCBzcCA9IG1hdGguc2luKG1hdGgucmFkKGFuZ2xlX3gpKQogICAgICAgIGxvY2FsIGNwID0gbWF0aC5jb3MobWF0aC5yYWQoYW5nbGVfeCkpCiAgICAgICAgcmV0dXJuIGNwICogY3ksIGNwICogc3ksIC1zcAogICAgZW5kLAogICAgaGV4ID0gZnVuY3Rpb24oYXJnKQogICAgICAgIGxvY2FsIHJlc3VsdCA9ICJcYSIKICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiBuZXh0LCBhcmcgZG8KICAgICAgICAgICAgbG9jYWwgb3V0cHV0ID0gIiIKICAgICAgICAgICAgd2hpbGUgdmFsdWUgPiAwIGRvCiAgICAgICAgICAgICAgICBsb2NhbCBpbmRleCA9IG1hdGguZm1vZCh2YWx1ZSwgMTYpICsgMQogICAgICAgICAgICAgICAgdmFsdWUgPSBtYXRoLmZsb29yKHZhbHVlIC8gMTYpCiAgICAgICAgICAgICAgICBvdXRwdXQgPSBzdHJpbmcuc3ViKCIwMTIzNDU2Nzg5QUJDREVGIiwgaW5kZXgsIGluZGV4KSAuLiBvdXRwdXQgCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiAjb3V0cHV0ID09IDAgdGhlbiAKICAgICAgICAgICAgICAgIG91dHB1dCA9ICIwMCIgCiAgICAgICAgICAgIGVsc2VpZiAjb3V0cHV0ID09IDEgdGhlbiAKICAgICAgICAgICAgICAgIG91dHB1dCA9ICIwIiAuLiBvdXRwdXQgCiAgICAgICAgICAgIGVuZCAKICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0IC4uIG91dHB1dAogICAgICAgIGVuZCAKICAgICAgICByZXR1cm4gcmVzdWx0IC4uICJGRiIKICAgIGVuZCwKICAgIHNwbGl0ID0gZnVuY3Rpb24oIGlucHV0c3RyLCBzZXApCiAgICAgICAgaWYgc2VwID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICBzZXAgPSAiJXMiCiAgICAgICAgZW5kCiAgICAgICAgbG9jYWwgdD17fQogICAgICAgIGZvciBzdHIgaW4gc3RyaW5nLmdtYXRjaChpbnB1dHN0ciwgIihbXiIuLnNlcC4uIl0rKSIpIGRvCiAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQodCwgc3RyKQogICAgICAgIGVuZAogICAgICAgIHJldHVybiB0CiAgICBlbmQsCiAgICBSR0JBdG9IRVggPSBmdW5jdGlvbihyZWRBcmcsIGdyZWVuQXJnLCBibHVlQXJnLCBhbHBoYUFyZykKICAgICAgICByZXR1cm4gc3RyaW5nLmZvcm1hdCgnJS4yeCUuMnglLjJ4JS4yeCcsIHJlZEFyZywgZ3JlZW5BcmcsIGJsdWVBcmcsIGFscGhhQXJnKQogICAgZW5kLAogICAgY3JlYXRlX2NvbG9yX2FycmF5ID0gZnVuY3Rpb24ociwgZywgYiwgc3RyaW5nKQogICAgICAgIGxvY2FsIGNvbG9ycyA9IHt9CiAgICAgICAgZm9yIGkgPSAwLCAjc3RyaW5nIGRvCiAgICAgICAgICAgIGxvY2FsIGNvbG9yID0ge3IsIGcsIGIsIDI1NSAqIG1hdGguYWJzKDEgKiBtYXRoLmNvcygyICogbWF0aC5waSAqIGdsb2JhbHMuY3VydGltZSgpIC8gNCArIGkgKiA1IC8gMzApKX0KICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGNvbG9ycywgY29sb3IpCiAgICAgICAgZW5kCiAgICAgICAgcmV0dXJuIGNvbG9ycwogICAgZW5kLAogICAgdGV4dEFycmF5ID0gZnVuY3Rpb24oc3RyaW5nKQogICAgICAgIGxvY2FsIHJlc3VsdCA9IHt9CiAgICAgICAgZm9yIGk9MSwgI3N0cmluZyBkbwogICAgICAgICAgICByZXN1bHRbaV0gPSBzdHJpbmcuc3ViKHN0cmluZywgaSwgaSkKICAgICAgICBlbmQKICAgICAgICByZXR1cm4gcmVzdWx0CiAgICBlbmQsCiAgICBpbmNsdWRlcyA9IGZ1bmN0aW9uKHRibCwgdmFsdWUpCiAgICAgICAgZm9yIGkgPSAxLCAjdGJsIGRvCiAgICAgICAgICAgIGlmIHRibFtpXSA9PSB2YWx1ZSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICByZXR1cm4gZmFsc2UKICAgIGVuZCwKICAgIGdyYWRpZW50X3RleHQgPSBmdW5jdGlvbihyMSwgZzEsIGIxLCBhMSwgcjIsIGcyLCBiMiwgYTIsIHRleHQpCiAgICAgICAgbG9jYWwgb3V0cHV0ID0gJycKICAgIAogICAgICAgIGxvY2FsIGxlbiA9ICN0ZXh0LTEKICAgIAogICAgICAgIGxvY2FsIHJpbmMgPSAocjIgLSByMSkgLyBsZW4KICAgICAgICBsb2NhbCBnaW5jID0gKGcyIC0gZzEpIC8gbGVuCiAgICAgICAgbG9jYWwgYmluYyA9IChiMiAtIGIxKSAvIGxlbgogICAgICAgIGxvY2FsIGFpbmMgPSAoYTIgLSBhMSkgLyBsZW4KICAgIAogICAgICAgIGZvciBpPTEsIGxlbisxIGRvCiAgICAgICAgICAgIG91dHB1dCA9IG91dHB1dCAuLiAoJ1xhJTAyeCUwMnglMDJ4JTAyeCVzJyk6Zm9ybWF0KHIxLCBnMSwgYjEsIGExLCB0ZXh0OnN1YihpLCBpKSkKICAgIAogICAgICAgICAgICByMSA9IHIxICsgcmluYwogICAgICAgICAgICBnMSA9IGcxICsgZ2luYwogICAgICAgICAgICBiMSA9IGIxICsgYmluYwogICAgICAgICAgICBhMSA9IGExICsgYWluYwogICAgICAgIGVuZAogICAgCiAgICAgICAgcmV0dXJuIG91dHB1dAogICAgZW5kCiwgICAgCiAgICB0aW1lX3RvX3RpY2tzID0gZnVuY3Rpb24odCkKICAgICAgICByZXR1cm4gbWF0aC5mbG9vcigwLjUgKyAodCAvIGdsb2JhbHMudGlja2ludGVydmFsKCkpKQogICAgZW5kLAogICAgaGVhZFZpc2libGUgPSBmdW5jdGlvbihlbmVteSkKICAgICAgICBsb2NhbF9wbGF5ZXIgPSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpCiAgICAgICAgaWYgbG9jYWxfcGxheWVyID09IG5pbCB0aGVuIHJldHVybiBlbmQKICAgICAgICBsb2NhbCBleCwgZXksIGV6ID0gZW50aXR5LmhpdGJveF9wb3NpdGlvbihlbmVteSwgMSkKICAgIAogICAgICAgIGxvY2FsIGh4LCBoeSwgaHogPSBlbnRpdHkuaGl0Ym94X3Bvc2l0aW9uKGxvY2FsX3BsYXllciwgMSkKICAgICAgICBsb2NhbCBoZWFkX2ZyYWN0aW9uLCBoZWFkX2VudGluZGV4X2hpdCA9IGNsaWVudC50cmFjZV9saW5lKGVuZW15LCBleCwgZXksIGV6LCBoeCwgaHksIGh6KQogICAgICAgIGlmIGhlYWRfZW50aW5kZXhfaGl0ID09IGxvY2FsX3BsYXllciBvciBoZWFkX2ZyYWN0aW9uID09IDEgdGhlbiByZXR1cm4gdHJ1ZSBlbHNlIHJldHVybiBmYWxzZSBlbmQKICAgIGVuZAp9CgpmdW5jLmluX2FpciA9IChmdW5jdGlvbihwbGF5ZXIpCiAgICBpZiBwbGF5ZXIgPT0gbmlsIHRoZW4gcmV0dXJuIGVuZAogICAgbG9jYWwgZmxhZ3MgPSBlbnRpdHkuZ2V0X3Byb3AocGxheWVyLCAibV9mRmxhZ3MiKQogICAgaWYgZmxhZ3MgPT0gbmlsIHRoZW4gcmV0dXJuIGVuZAogICAgaWYgYml0LmJhbmQoZmxhZ3MsIDEpID09IDAgdGhlbgogICAgICAgIHJldHVybiB0cnVlCiAgICBlbmQKICAgIHJldHVybiBmYWxzZQplbmQpCgpsb2NhbCBmdW5jdGlvbiBnZXRfdmVsb2NpdHkocGxheWVyKQogICAgbG9jYWwgeCx5LHogPSBlbnRpdHkuZ2V0X3Byb3AocGxheWVyLCAibV92ZWNWZWxvY2l0eSIpCiAgICBpZiB4ID09IG5pbCB0aGVuIHJldHVybiBlbmQKICAgIHJldHVybiBtYXRoLnNxcnQoeCp4ICsgeSp5ICsgeip6KQplbmQKCmxvY2FsIGZ1bmN0aW9uIGNhbl9kZXN5bmMoY21kKQogICAgaWYgZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX01vdmVUeXBlIikgPT0gOSB0aGVuCiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICBlbmQKICAgIGxvY2FsIGNsaWVudF93ZWFwb24gPSBlbnRpdHkuZ2V0X3BsYXllcl93ZWFwb24oZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkKICAgIGlmIGNsaWVudF93ZWFwb24gPT0gbmlsIHRoZW4KICAgICAgICByZXR1cm4gZmFsc2UKICAgIGVuZAogICAgbG9jYWwgd2VhcG9uX2NsYXNzbmFtZSA9IGVudGl0eS5nZXRfY2xhc3NuYW1lKGNsaWVudF93ZWFwb24pCiAgICBsb2NhbCBpbl91c2UgPSBjbWQuaW5fdXNlID09IDEKICAgIGxvY2FsIGluX2F0dGFjayA9IGNtZC5pbl9hdHRhY2sgPT0gMQogICAgbG9jYWwgaW5fYXR0YWNrMiA9IGNtZC5pbl9hdHRhY2syID09IDEKICAgIGlmIGluX3VzZSB0aGVuCiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICBlbmQKICAgIGlmIGluX2F0dGFjayBvciBpbl9hdHRhY2syIHRoZW4KICAgICAgICBpZiB3ZWFwb25fY2xhc3NuYW1lOmZpbmQoIkdyZW5hZGUiKSB0aGVuCiAgICAgICAgICAgIHZhcnMubTFfdGltZSA9IGdsb2JhbHMuY3VydGltZSgpICsgMC4xNQogICAgICAgIGVuZAogICAgZW5kCiAgICBpZiB2YXJzLm0xX3RpbWUgPiBnbG9iYWxzLmN1cnRpbWUoKSB0aGVuCiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICBlbmQKICAgIGlmIGluX2F0dGFjayB0aGVuCiAgICAgICAgaWYgY2xpZW50X3dlYXBvbiA9PSBuaWwgdGhlbgogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICBlbmQKICAgICAgICBpZiB3ZWFwb25fY2xhc3NuYW1lIHRoZW4KICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgZW5kCiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICBlbmQKICAgIHJldHVybiB0cnVlCmVuZAoKbG9jYWwgZnVuY3Rpb24gZ2V0X2Nob2tlKGNtZCkKICAgIGxvY2FsIGZsX2xpbWl0ID0gdWkuZ2V0KHJlZnMuZmxMaW1pdCkKICAgIGxvY2FsIGZsX3AgPSBmbF9saW1pdCAlIDIgPT0gMQogICAgbG9jYWwgY2hva2VkY29tbWFuZHMgPSBjbWQuY2hva2VkY29tbWFuZHMKICAgIGxvY2FsIGNtZF9wID0gY2hva2VkY29tbWFuZHMgJSAyID09IDAKICAgIGxvY2FsIGRvdWJsZXRhcF9yZWYgPSB1aS5nZXQocmVmcy5kdFsxXSkgYW5kIHVpLmdldChyZWZzLmR0WzJdKQogICAgbG9jYWwgb3NhYV9yZWYgPSB1aS5nZXQocmVmcy5vc1sxXSkgYW5kIHVpLmdldChyZWZzLm9zWzJdKQogICAgbG9jYWwgZmRfcmVmID0gdWkuZ2V0KHJlZnMuZmFrZUR1Y2spCiAgICBsb2NhbCB2ZWxvY2l0eSA9IGdldF92ZWxvY2l0eShlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpKQogICAgaWYgZG91YmxldGFwX3JlZiB0aGVuCiAgICAgICAgaWYgdmFycy5jaG9rZWQgPiAyIHRoZW4KICAgICAgICAgICAgaWYgY21kLmNob2tlZGNvbW1hbmRzID49IDAgdGhlbgogICAgICAgICAgICAgICAgY21kX3AgPSBmYWxzZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgdmFycy5jaG9rZWQgPSBjbWQuY2hva2VkY29tbWFuZHMKICAgIGlmIHZhcnMuZHRfc3RhdGUgfj0gZG91YmxldGFwX3JlZiB0aGVuCiAgICAgICAgdmFycy5kb3VibGV0YXBfdGltZSA9IGdsb2JhbHMuY3VydGltZSgpICsgMC4yNQogICAgZW5kCiAgICBpZiBub3QgZG91YmxldGFwX3JlZiBhbmQgbm90IG9zYWFfcmVmIGFuZCBub3QgY21kLm5vX2Nob2tlIG9yIGZkX3JlZiB0aGVuCiAgICAgICAgaWYgbm90IGZsX3AgdGhlbgogICAgICAgICAgICBpZiB2YXJzLmRvdWJsZXRhcF90aW1lID4gZ2xvYmFscy5jdXJ0aW1lKCkgdGhlbgogICAgICAgICAgICAgICAgaWYgY21kLmNob2tlZGNvbW1hbmRzID49IDAgYW5kIGNtZC5jaG9rZWRjb21tYW5kcyA8IGZsX2xpbWl0IHRoZW4KICAgICAgICAgICAgICAgICAgICBjbWRfcCA9IGNob2tlZGNvbW1hbmRzICUgMiA9PSAwCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgY21kX3AgPSBjaG9rZWRjb21tYW5kcyAlIDIgPT0gMQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGNtZF9wID0gY2hva2VkY29tbWFuZHMgJSAyID09IDEKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIHZhcnMuZHRfc3RhdGUgPSBkb3VibGV0YXBfcmVmCiAgICByZXR1cm4gY21kX3AKZW5kCgpsb2NhbCBmdW5jdGlvbiBhcHBseV9kZXN5bmMoY21kLCBmYWtlKQogICAgbG9jYWwgdXNyY21kID0gZ2V0X2lucHV0LnZmcHRyLkdldFVzZXJDbWQoZmZpLmNhc3QoInVpbnRwdHJfdCIsIGdldF9pbnB1dCksIDAsIGNtZC5jb21tYW5kX251bWJlcikKICAgIGNtZC5hbGxvd19zZW5kX3BhY2tldCA9IGZhbHNlCgogICAgbG9jYWwgcGl0Y2gsIHlhdyA9IGNsaWVudC5jYW1lcmFfYW5nbGVzKCkKCiAgICBsb2NhbCBjYW5fZGVzeW5jID0gY2FuX2Rlc3luYyhjbWQpCiAgICBsb2NhbCBpc19jaG9rZSA9IGdldF9jaG9rZShjbWQpCgogICAgdWkuc2V0KHJlZnMuYm9keVlhd1sxXSwgaXNfY2hva2UgYW5kICJTdGF0aWMiIG9yICJPZmYiKQogICAgaWYgY21kLmNob2tlZGNvbW1hbmRzID09IDAgdGhlbgogICAgICAgIHZhcnMueWF3ID0gKHlhdyArIDE4MCkgLSBmYWtlKjI7CiAgICBlbmQKCiAgICBpZiBjYW5fZGVzeW5jIHRoZW4KICAgICAgICBpZiBub3QgdXNyY21kLmhhc2JlZW5wcmVkaWN0ZWQgdGhlbgogICAgICAgICAgICBpZiBpc19jaG9rZSB0aGVuCiAgICAgICAgICAgICAgICBjbWQueWF3ID0gdmFycy55YXc7CiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAoKbG9jYWwgY29sb3JfdGV4dCA9IGZ1bmN0aW9uKCBzdHJpbmcsIHIsIGcsIGIsIGEpCiAgICBsb2NhbCB3aGl0ZSA9ICJcYSIgLi4gZnVuYy5SR0JBdG9IRVgoMjU1LCAyNTUsIDI1NSwgYSkKCiAgICBsb2NhbCBzdHIgPSAiIgogICAgZm9yIGksIHMgaW4gaXBhaXJzKGZ1bmMuc3BsaXQoc3RyaW5nLCAiJCIpKSBkbwogICAgZW5kCgogICAgcmV0dXJuIHN0cgplbmQKCmxvY2FsIGFuaW1hdGVfdGV4dCA9IGZ1bmN0aW9uKHRpbWUsIHN0cmluZywgciwgZywgYiwgYSkKICAgIGxvY2FsIHRfb3V0LCB0X291dF9pdGVyID0geyB9LCAxCgogICAgbG9jYWwgbCA9IHN0cmluZzpsZW4oICkgLSAxCgogICAgbG9jYWwgcl9hZGQgPSAoMCAtIHIpCiAgICBsb2NhbCBnX2FkZCA9ICgwIC0gZykKICAgIGxvY2FsIGJfYWRkID0gKDAgLSBiKQogICAgbG9jYWwgYV9hZGQgPSAoMjU1IC0gYSkKCiAgICBmb3IgaSA9IDEsICNzdHJpbmcgZG8KICAgICAgICBsb2NhbCBpdGVyID0gKGkgLSAxKS8oI3N0cmluZyAtIDEpICsgdGltZQogICAgICAgIHRfb3V0W3Rfb3V0X2l0ZXJdID0gIlxhIiAuLiBmdW5jLlJHQkF0b0hFWCggciArIHJfYWRkICogbWF0aC5hYnMobWF0aC5jb3MoIGl0ZXIgKSksIGcgKyBnX2FkZCAqIG1hdGguYWJzKG1hdGguY29zKCBpdGVyICkpLCBiICsgYl9hZGQgKiBtYXRoLmFicyhtYXRoLmNvcyggaXRlciApKSwgYSArIGFfYWRkICogbWF0aC5hYnMobWF0aC5jb3MoIGl0ZXIgKSkgKQoKICAgICAgICB0X291dFt0X291dF9pdGVyICsgMV0gPSBzdHJpbmc6c3ViKCBpLCBpICkKCiAgICAgICAgdF9vdXRfaXRlciA9IHRfb3V0X2l0ZXIgKyAyCiAgICBlbmQKCiAgICByZXR1cm4gdF9vdXQKZW5kCgpsb2NhbCBnbG93X21vZHVsZSA9IGZ1bmN0aW9uKHgsIHksIHcsIGgsIHdpZHRoLCByb3VuZGluZywgYWNjZW50LCBhY2NlbnRfaW5uZXIpCiAgICBsb2NhbCB0aGlja25lc3MgPSAxCiAgICBsb2NhbCBPZmZzZXQgPSAxCiAgICBsb2NhbCByLCBnLCBiLCBhID0gdW5wYWNrKGFjY2VudCkKICAgIGlmIGFjY2VudF9pbm5lciB0aGVuCiAgICAgICAgZnVuYy5yZWMoeCwgeSwgdywgaCArIDEsIHJvdW5kaW5nLCBhY2NlbnRfaW5uZXIpCiAgICBlbmQKICAgIGZvciBrID0gMCwgd2lkdGggZG8KICAgICAgICBpZiBhICogKGsvd2lkdGgpXigxKSA+IDUgdGhlbgogICAgICAgICAgICBsb2NhbCBhY2NlbnQgPSB7ciwgZywgYiwgYSAqIChrL3dpZHRoKV4oMil9CiAgICAgICAgICAgIGZ1bmMucmVjX291dGxpbmUoeCArIChrIC0gd2lkdGggLSBPZmZzZXQpKnRoaWNrbmVzcywgeSArIChrIC0gd2lkdGggLSBPZmZzZXQpICogdGhpY2tuZXNzLCB3IC0gKGsgLSB3aWR0aCAtIE9mZnNldCkqdGhpY2tuZXNzKjIsIGggKyAxIC0gKGsgLSB3aWR0aCAtIE9mZnNldCkqdGhpY2tuZXNzKjIsIHJvdW5kaW5nICsgdGhpY2tuZXNzICogKHdpZHRoIC0gayArIE9mZnNldCksIHRoaWNrbmVzcywgYWNjZW50KQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gcmVtYXAodmFsLCBuZXdtaW4sIG5ld21heCwgbWluLCBtYXgsIGNsYW1wKQoJbWluID0gbWluIG9yIDAKCW1heCA9IG1heCBvciAxCgoJbG9jYWwgcGN0ID0gKHZhbC1taW4pLyhtYXgtbWluKQoKCWlmIGNsYW1wIH49IGZhbHNlIHRoZW4KCQlwY3QgPSBtYXRoLm1pbigxLCBtYXRoLm1heCgwLCBwY3QpKQoJZW5kCgoJcmV0dXJuIG5ld21pbisobmV3bWF4LW5ld21pbikqcGN0CmVuZAoKCgoKLS0gQHJlZ2lvbiBGVU5DUyBlbmQKCi0tIEByZWdpb24gVUlfTEFZT1VUIHN0YXJ0CmxvY2FsIHRhYiwgY29udGFpbmVyID0gIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIKbG9jYWwgbGFiZWwgPSB1aS5uZXdfbGFiZWwoIkFBIiwgIkZha2UgbGFnIiwgIkludmluc2libGUiKQpsb2NhbCB0YWJQaWNrZXIgPSB1aS5uZXdfY29tYm9ib3goIkFBIiwgIkZha2UgbGFnIiwgIlxuVGFiIiwgIk1haW4iLCAiU2V0dGluZ3MiLCAiQW50aS1haW0iKQpsb2NhbCBhYVRhYnMgPSB1aS5uZXdfY29tYm9ib3goIkFBIiwgIkZha2UgbGFnIiwgIlxuQUEgVGFicyIsICJCdWlsZGVyIiwgIk90aGVyIikKCgpsb2NhbCBtZW51ID0gewogICAgYWFUYWIgPSB7CiAgICAgICAgbGFibGVvdGggPSB1aS5uZXdfbGFiZWwodGFiLCBjb250YWluZXIsICLigKIgIFxhRkZGRkZGRkZCaW5kcyIpLAogICAgICAgIGxhYmVsMzQ1ID0gdWkubmV3X2xhYmVsKHRhYiwgY29udGFpbmVyLCAiXGFGRkZGRkY2RuKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgSIpLAogICAgICAgIG1hbnVhbHNPdmVyRnMgPSB1aS5uZXdfY2hlY2tib3godGFiLCBjb250YWluZXIsICJNYW51YWxzIG92ZXIgZnJlZXN0YW5kaW5nIiksCiAgICAgICAgbGVnaXRBQUhvdGtleSA9IHVpLm5ld19ob3RrZXkodGFiLCBjb250YWluZXIsICJMZWdpdCBBQSIpLAogICAgICAgIGZyZWVzdGFuZCA9IHVpLm5ld19jb21ib2JveCh0YWIsIGNvbnRhaW5lciwgIkZyZWVzdGFuZGluZyIsICJEZWZhdWx0IiwgIlN0YXRpYyIpLAogICAgICAgIGZyZWVzdGFuZEhvdGtleSA9IHVpLm5ld19ob3RrZXkodGFiLCBjb250YWluZXIsICJGcmVlc3RhbmQiLCB0cnVlKSwKICAgICAgICBtYW51YWxzZW5iID0gdWkubmV3X2NoZWNrYm94KHRhYiwgY29udGFpbmVyLCAiRW5hYmxlIE1hbnVhbHMiKSwKICAgICAgICBtYW51YWxzID0gdWkubmV3X2NvbWJvYm94KHRhYiwgY29udGFpbmVyLCAiTWFudWFscyIsICJPZmYiLCAiRGVmYXVsdCIsICJTdGF0aWMiKSwKICAgICAgICBtYW51YWxUYWIgPSB7CiAgICAgICAgICAgIG1hbnVhbExlZnQgPSB1aS5uZXdfaG90a2V5KHRhYiwgY29udGFpbmVyLCAi4oCiIE1hbnVhbCAiIC4uIGZ1bmMuaGV4KHsyMDAsMjAwLDIwMH0pIC4uICJsZWZ0IiksCiAgICAgICAgICAgIG1hbnVhbFJpZ2h0ID0gdWkubmV3X2hvdGtleSh0YWIsIGNvbnRhaW5lciwgIuKAoiBNYW51YWwgIiAuLiBmdW5jLmhleCh7MjAwLDIwMCwyMDB9KSAuLiAicmlnaHQiKSwKICAgICAgICAgICAgbWFudWFsRm9yd2FyZCA9IHVpLm5ld19ob3RrZXkodGFiLCBjb250YWluZXIsICLigKIgTWFudWFsICIgLi4gZnVuYy5oZXgoezIwMCwyMDAsMjAwfSkgLi4gImZvcndhcmQiKSwKICAgICAgICB9LAogICAgfSwKICAgIGJ1aWxkZXJUYWIgPSB7CiAgICAgICAgbGFibGVzYWYgPSB1aS5uZXdfbGFiZWwoIkFBIiwgIk90aGVyIiwgIuKKsyBTYWZlIEZ1bmN0aW9ucyIpLAogICAgICAgIGxhYmVsc2FmYSA9IHVpLm5ld19sYWJlbCgiQUEiLCAiT3RoZXIiLCAiXGFGRkZGRkY2RuKKsuKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKKsyIpLAogICAgICAgIHNhZmVLbmlmZSA9IHVpLm5ld19jaGVja2JveCgiQUEiLCAiT3RoZXIiLCAiU2FmZSBLbmlmZSIpLAogICAgICAgIHNhZmVaZXVzID0gdWkubmV3X2NoZWNrYm94KCJBQSIsICJPdGhlciIsICJTYWZlIFpldXMiKSwKICAgICAgICBsYWJsZWIgPSB1aS5uZXdfbGFiZWwodGFiLCBjb250YWluZXIsICLiirMgQnVpbGRlciIpLAogICAgICAgIGxhYmVsc2FmYWEgPSB1aS5uZXdfbGFiZWwodGFiLCBjb250YWluZXIsICJcYUZGRkZGRjZG4oqy4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4oqzIiksCiAgICAgICAgc3RhdGUgPSB1aS5uZXdfY29tYm9ib3godGFiLCBjb250YWluZXIsICJBbnRpLWFpbSBzdGF0ZSIsIHZhcnMuYWFTdGF0ZXMpCiAgICB9LAogICAgdmlzdWFsc1RhYiA9IHsKICAgICAgICBsYWJsZXYgPSB1aS5uZXdfbGFiZWwodGFiLCBjb250YWluZXIsICLiirMgVmlzdWFscyIpLAogICAgICAgIHZvdmFwdXRpbiA9IHVpLm5ld19sYWJlbCh0YWIsIGNvbnRhaW5lciwgIlxhRkZGRkZGNkbiirLilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHiirMiKSwKICAgICAgICBpbmRpY2F0b3JzVHlwZSA9IHVpLm5ld19jaGVja2JveCh0YWIsIGNvbnRhaW5lciwgIkVuYWJsZSBJbmRpY2F0b3JzIiksCiAgICAgICAgaW5kaWNhdG9yc0NsciA9IHVpLm5ld19jb2xvcl9waWNrZXIodGFiLCBjb250YWluZXIsICJNYWluIENvbG9yIiwgbHVhX2NvbG9yLnIsIGx1YV9jb2xvci5nLCBsdWFfY29sb3IuYiwgMjU1KSwKICAgICAgICBhcnJvd3NpbmRlbmIgPSB1aS5uZXdfY2hlY2tib3godGFiLCBjb250YWluZXIsICJFbmFibGUgQXJyb3dzIEluZGljYXRvciIpLAogICAgICAgIGFycm93SW5kaWNhdG9yU3R5bGUgPSB1aS5uZXdfY29tYm9ib3godGFiLCBjb250YWluZXIsICJBcnJvd3MiLCAiU3RhbmRhcnQiLCAiVHJpYW5nbGUiKSwKICAgICAgICBhcnJvd0NsciA9IHVpLm5ld19jb2xvcl9waWNrZXIodGFiLCBjb250YWluZXIsICJBcnJvdyBDb2xvciIsIGx1YV9jb2xvci5yLCBsdWFfY29sb3IuZywgbHVhX2NvbG9yLmIsIDI1NSksCiAgICAgICAgaGl0bG9nc2VuYiA9IHVpLm5ld19jaGVja2JveCh0YWIsIGNvbnRhaW5lciwgIkVuYWJsZSBIaXRsb2ciKSwKICAgICAgICBoaXRsb2dzX2tydXRpZSA9IHVpLm5ld19tdWx0aXNlbGVjdCh0YWIsIGNvbnRhaW5lciwgIkhpdGxvZ3MiLCAiSGl0IiwgIk1pc3MiKSwKICAgICAgICBoaXRsb2dzX2tydXRpZUNsciA9IHVpLm5ld19jb2xvcl9waWNrZXIodGFiLCBjb250YWluZXIsICJIaXRsb2dzIENvbG9yIiwgbHVhX2NvbG9yLnIsIGx1YV9jb2xvci5nLCBsdWFfY29sb3IuYiwgMjU1KSwKICAgICAgICBtaW5pbXVtX2RhbWFnZWVuYiA9IHVpLm5ld19jaGVja2JveCh0YWIsIGNvbnRhaW5lciwgIkVuYWJsZSBNaW4gRGFtYWdlIEluZGljYXRvciIpLAogICAgICAgIG1pbmltdW1fZGFtYWdlSW5kaWNhdG9yID0gdWkubmV3X2NvbWJvYm94KHRhYiwgY29udGFpbmVyLCAiTWluaW11bSBEYW1hZ2UgSW5kaWNhdG9yIiwgIkJpbmQiLCAiQ29uc3RhbnQiKSwKICAgICAgICBzaWRlSW5kaWNhdG9yc2VuYiA9IHVpLm5ld19jaGVja2JveCh0YWIsIGNvbnRhaW5lciwgIkVuYWJsZSBTaWRlIGluZGljYXRvcnMiKSwKICAgICAgICBzaWRlSW5kaWNhdG9ycyA9IHVpLm5ld19jb21ib2JveCh0YWIsIGNvbnRhaW5lciwgICJcbiBTaWRlIEluZGljYXRvcnMiLCAiU2tlZXQiLCAiU2tlZXQgb2xkIiksCiAgICB9LAogICAgbWlzY1RhYiA9IHsKICAgICAgICBsYWJsZWRnZGZncyA9IHVpLm5ld19sYWJlbCh0YWIsIGNvbnRhaW5lciwgIiAiKSwKICAgICAgICBsYWJsZXZyID0gdWkubmV3X2xhYmVsKHRhYiwgY29udGFpbmVyLCAi4oqzIE1pc2MiKSwKICAgICAgICB2b3ZhcHV0aW4yID0gdWkubmV3X2xhYmVsKHRhYiwgY29udGFpbmVyLCAiXGFGRkZGRkY2RuKKsuKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKKsyIpLAogICAgICAgIHdhdGVybWFyayA9IHVpLm5ld19jaGVja2JveCh0YWIsIGNvbnRhaW5lciwgIldhdGVybWFyayIpLAogICAgICAgIHdhdGVybWFya0NsciA9IHVpLm5ld19jb2xvcl9waWNrZXIodGFiLCBjb250YWluZXIsICJXYXRlcm1hcmsgQ29sb3IiLCBsdWFfY29sb3IuciwgbHVhX2NvbG9yLmcsIGx1YV9jb2xvci5iLCAyNTUpLAogICAgICAgIEF2b2lkQmFjayA9IHVpLm5ld19jaGVja2JveCh0YWIsIGNvbnRhaW5lciwgIkF2b2lkIEJhY2tzdGFiIiksCiAgICAgICAgb3RoZnVuYyA9IHVpLm5ld19sYWJlbCgiQUEiLCAiT3RoZXIiLCAi4oqzIE90aGVyIGZ1bmN0aW9ucyIpLAogICAgICAgIHZvdmFwdXRpbjMgPSB1aS5uZXdfbGFiZWwoIkFBIiwgIk90aGVyIiwgIiBcYUZGRkZGRjZG4oqy4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4oqzIiksCiAgICAgICAgZmlsdGVyY29ucyA9IHVpLm5ld19jaGVja2JveCgiQUEiLCAiT3RoZXIiLCAiQ29uc29sZSBGaWx0ZXIiKSwKICAgICAgICB1bnNhZmVjaGFyaGdlID0gdWkubmV3X2NoZWNrYm94KCJBQSIsICJPdGhlciIsICJBdXRvIGRpc2NoYXJnZSBleHBsb2l0IFxhNGY0ZjRmZmZbb25seSBzY291dCAmIGF3cF0iKSwKICAgICAgICBjbGFuVGFnID0gdWkubmV3X2NoZWNrYm94KHRhYiwgY29udGFpbmVyLCAiQ2xhbnRhZyIpLAogICAgICAgIGR0dW5zYWZlY2hhcmdlID0gdWkubmV3X2NoZWNrYm94KCJBQSIsICJPdGhlciIsICJVbnNhZmUgY2hhcmdlIG9uIGVuZW15IFxhNGY0ZjRmZmZjaGFyZyBpbiB2aXNpYmVsIiksCiAgICAgICAgdHJhc2hUYWxrID0gdWkubmV3X2NoZWNrYm94KHRhYiwgY29udGFpbmVyLCAiVHJhc2h0YWxrIiksCiAgICAgICAgdHJhc2hUYWxrX3ZpYm9yID0gdWkubmV3X211bHRpc2VsZWN0KHRhYiwgY29udGFpbmVyLCAiXG4gdHJhc2h0YWxrIHZpYm9yIiwgIktpbGwiLCAiRGVhdGgiKSwKICAgICAgICBmYXN0TGFkZGVyID0gdWkubmV3X2NoZWNrYm94KHRhYiwgY29udGFpbmVyLCAiRmFzdCBsYWRkZXIiKSwKICAgICAgICBhbmltYXRpb25zRW5hYmxlZCA9IHVpLm5ld19jaGVja2JveCh0YWIsIGNvbnRhaW5lciwgIlxhYWZhZjYyZmZBbmltIGJyZWFrZXJzIiksCiAgICAgICAgYW5pbWF0aW9ucyA9IHVpLm5ld19tdWx0aXNlbGVjdCh0YWIsIGNvbnRhaW5lciwgIlxuIEFuaW0gYnJlYWtlcnMiLCAiQnJva2VuIiwgIlN0YXRpYyBsZWdzIiwgIkxlZyBmdWNrZXIiLCAiMCBwaXRjaCBvbiBsYW5kaW5nIiwgIk1vb253YWxrIiksCiAgICB9LAogICAgY29uZmlnVGFiID0gewogICAgICAgIGxhYmVsMzQ1ID0gdWkubmV3X2xhYmVsKCJBQSIsICJGYWtlIGxhZyIsICJcYUZGRkZGRjZG4oqy4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4pSB4oqzIiksCiAgICAgICAgbGFiZWwxID0gdWkubmV3X2xhYmVsKCJBQSIsICJGYWtlIGxhZyIsICJXZWxjb21lIiksCiAgICAgICAgbGFiZWwyID0gdWkubmV3X2xhYmVsKCJBQSIsICJGYWtlIGxhZyIsICJCdWlsZCAtIEJldGEiKSwKICAgICAgICBsYWJlbDMgPSB1aS5uZXdfbGFiZWwoIkFBIiwgIkZha2UgbGFnIiwgIkxhc3QgdXBkYXRlIHdhczogMTYgSnVseS4iKSwKICAgICAgICBsYWJsZTEyMzQgPSB1aS5uZXdfbGFiZWwoIkFBIiwgIkZha2UgbGFnIiwgIlxhRkZGRkZGNkbiirLilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHiirMiKSwKICAgICAgICBsYWJlbDQgPSB1aS5uZXdfbGFiZWwgKCJBQSIsICJPdGhlciIsICLiirMgRGlzY29yZCBTZXJ2ZXIiKSwKICAgICAgICBsYWJsZTEyMyA9IHVpLm5ld19sYWJlbCgiQUEiLCAiT3RoZXIiLCAiXGFGRkZGRkY2RuKKsuKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKKsyIpLAogICAgICAgIGJ1dHRvbnNkID0gdWkubmV3X2J1dHRvbigiQUEiLCAiT3RoZXIiLCAiSm9pbiB1cyIsIGZ1bmN0aW9uKCkgU3RlYW1PdmVybGF5QVBJLk9wZW5FeHRlcm5hbEJyb3dzZXJVUkwoImh0dHBzOi8vZGlzY29yZC5nZy9qVFVoUzk4YkhIIikgZW5kKSwKICAgICAgICBsaXN0ID0gdWkubmV3X2xpc3Rib3godGFiLCBjb250YWluZXIsICJDb25maWdzIiwgIiIpLAogICAgICAgIG5hbWUgPSB1aS5uZXdfdGV4dGJveCh0YWIsIGNvbnRhaW5lciwgIkNvbmZpZyBuYW1lIiwgIiIpLAogICAgICAgIGxvYWQgPSB1aS5uZXdfYnV0dG9uKHRhYiwgY29udGFpbmVyLCAiTG9hZCIsIGZ1bmN0aW9uKCkgZW5kKSwKICAgICAgICBzYXZlID0gdWkubmV3X2J1dHRvbih0YWIsIGNvbnRhaW5lciwgIlNhdmUiLCBmdW5jdGlvbigpIGVuZCksCiAgICAgICAgZGVsZXRlID0gdWkubmV3X2J1dHRvbih0YWIsIGNvbnRhaW5lciwgIkRlbGV0ZSIsIGZ1bmN0aW9uKCkgZW5kKSwKICAgICAgICBpbXBvcnQgPSB1aS5uZXdfYnV0dG9uKHRhYiwgY29udGFpbmVyLCAiSW1wb3J0IiwgZnVuY3Rpb24oKSBlbmQpLAogICAgICAgIGV4cG9ydCA9IHVpLm5ld19idXR0b24odGFiLCBjb250YWluZXIsICJFeHBvcnQiLCBmdW5jdGlvbigpIGVuZCkKICAgIH0KfQoKbG9jYWwgc3RhcnRfdGltZSA9IGNsaWVudC51bml4X3RpbWUoKQpsb2NhbCBmdW5jdGlvbiBnZXRfZWxhcHNlZF90aW1lKCkKICAgIGxvY2FsIGVsYXBzZWRfc2Vjb25kcyA9IGNsaWVudC51bml4X3RpbWUoKSAtIHN0YXJ0X3RpbWUKICAgIGxvY2FsIGhvdXJzID0gbWF0aC5mbG9vcihlbGFwc2VkX3NlY29uZHMgLyAzNjAwKQogICAgbG9jYWwgbWludXRlcyA9IG1hdGguZmxvb3IoKGVsYXBzZWRfc2Vjb25kcyAtIGhvdXJzICogMzYwMCkgLyA2MCkKICAgIGxvY2FsIHNlY29uZHMgPSBtYXRoLmZsb29yKGVsYXBzZWRfc2Vjb25kcyAtIGhvdXJzICogMzYwMCAtIG1pbnV0ZXMgKiA2MCkKICAgIHJldHVybiBzdHJpbmcuZm9ybWF0KCIlMDJkOiUwMmQ6JTAyZCIsIGhvdXJzLCBtaW51dGVzLCBzZWNvbmRzKQplbmQKCmxvY2FsIGFhQnVpbGRlciA9IHt9CmxvY2FsIGFhQ29udGFpbmVyID0ge30KZm9yIGk9MSwgI3ZhcnMuYWFTdGF0ZXMgZG8KICAgIGFhQ29udGFpbmVyW2ldID0gZnVuYy5oZXgoezIwMCwyMDAsMjAwfSkgLi4gIigiIC4uIGZ1bmMuaGV4KHsyMjIsNTUsNTV9KSAuLiAiIiAuLiB2YXJzLnBTdGF0ZXNbaV0gLi4gIiIgLi4gZnVuYy5oZXgoezIwMCwyMDAsMjAwfSkgLi4gIikiIC4uIGZ1bmMuaGV4KHsxNTUsMTU1LDE1NX0pIC4uICIgIgogICAgYWFCdWlsZGVyW2ldID0gewogICAgICAgIGVuYWJsZVN0YXRlID0gdWkubmV3X2NoZWNrYm94KHRhYiwgY29udGFpbmVyLCAiRW5hYmxlICIgLi4gZnVuYy5oZXgoe2x1YV9jb2xvci5yLCBsdWFfY29sb3IuZywgbHVhX2NvbG9yLmJ9KSAuLiB2YXJzLmFhU3RhdGVzW2ldIC4uIGZ1bmMuaGV4KHsyMDAsMjAwLDIwMH0pIC4uICIgc3RhdGUiKSwKICAgICAgICBmb3JjZURlZmVuc2l2ZSA9IHVpLm5ld19jaGVja2JveCh0YWIsIGNvbnRhaW5lciwgIkZvcmNlIERlZmVuc2l2ZVxuIiAuLiBhYUNvbnRhaW5lcltpXSksCiAgICAgICAgc3RhdGVEaXNhYmxlcnMgPSB1aS5uZXdfbXVsdGlzZWxlY3QodGFiLCBjb250YWluZXIsICJEaXNhYmxlcnNcbiIgLi4gYWFDb250YWluZXJbaV0sICJTdGFuZGluZyIsICJNb3ZpbmciLCAiU2xvd3dhbGtpbmciLCAiQ3JvdWNoaW5nIiwgIkFpciIsICJBaXItQ3JvdWNoaW5nIiwgIkNyb3VjaC1Nb3ZpbmciKSwKICAgICAgICBwaXRjaCA9IHVpLm5ld19jb21ib2JveCh0YWIsIGNvbnRhaW5lciwgIlBpdGNoXG4iIC4uIGFhQ29udGFpbmVyW2ldLCAiT2ZmIiwgIkRlZmF1bHQiLCAiVXAiLCAiRG93biIsICJNaW5pbWFsIiwgIlJhbmRvbSIsICJDdXN0b20iKSwKICAgICAgICBwaXRjaFNsaWRlciA9IHVpLm5ld19zbGlkZXIodGFiLCBjb250YWluZXIsICJcblBpdGNoIGFkZCIgLi4gYWFDb250YWluZXJbaV0sIC04OSwgODksIDAsIHRydWUsICLCsCIsIDEpLAogICAgICAgIHlhd0Jhc2UgPSB1aS5uZXdfY29tYm9ib3godGFiLCBjb250YWluZXIsICJZYXcgYmFzZVxuIiAuLiBhYUNvbnRhaW5lcltpXSwgIkxvY2FsIHZpZXciLCAiQXQgdGFyZ2V0cyIpLAogICAgICAgIHlhdyA9IHVpLm5ld19jb21ib2JveCh0YWIsIGNvbnRhaW5lciwgIllhd1xuIiAuLiBhYUNvbnRhaW5lcltpXSwgIk9mZiIsICIxODAiLCAiMTgwIFoiLCAiU3BpbiIsICJTbG93IEppdHRlciIsICJEZWxheSBKaXR0ZXIiLCAiTCZSIiksCiAgICAgICAgc3dpdGNoVGlja3MgPSB1aS5uZXdfc2xpZGVyKHRhYiwgY29udGFpbmVyLCAiXG50aWNrcyIgLi4gYWFDb250YWluZXJbaV0sIDEsIDE0LCA2LCAwKSwKICAgICAgICB5YXdTdGF0aWMgPSB1aS5uZXdfc2xpZGVyKHRhYiwgY29udGFpbmVyLCAiXG55YXciIC4uIGFhQ29udGFpbmVyW2ldLCAtMTgwLCAxODAsIDAsIHRydWUsICLCsCIsIDEpLAogICAgICAgIHlhd0xlZnQgPSB1aS5uZXdfc2xpZGVyKHRhYiwgY29udGFpbmVyLCAiTGVmdFxueWF3IiAuLiBhYUNvbnRhaW5lcltpXSwgLTE4MCwgMTgwLCAwLCB0cnVlLCAiwrAiLCAxKSwKICAgICAgICB5YXdSaWdodCA9IHVpLm5ld19zbGlkZXIodGFiLCBjb250YWluZXIsICJSaWdodFxueWF3IiAuLiBhYUNvbnRhaW5lcltpXSwgLTE4MCwgMTgwLCAwLCB0cnVlLCAiwrAiLCAxKSwKICAgICAgICB5YXdKaXR0ZXIgPSB1aS5uZXdfY29tYm9ib3godGFiLCBjb250YWluZXIsICJZYXcgaml0dGVyXG4iIC4uIGFhQ29udGFpbmVyW2ldLCAiT2ZmIiwgIk9mZnNldCIsICJDZW50ZXIiLCAiU2tpdHRlciIsICJSYW5kb20iLCAiMy1XYXkiLCAiTCZSIiksCiAgICAgICAgd2F5Rmlyc3QgPSB1aS5uZXdfc2xpZGVyKHRhYiwgY29udGFpbmVyLCAiRmlyc3RcbnlhdyBqaXR0ZXIiIC4uIGFhQ29udGFpbmVyW2ldLCAtMTgwLCAxODAsIDAsIHRydWUsICLCsCIsIDEpLAogICAgICAgIHdheVNlY29uZCA9IHVpLm5ld19zbGlkZXIodGFiLCBjb250YWluZXIsICJTZWNvbmRcbnlhdyBqaXR0ZXIiIC4uIGFhQ29udGFpbmVyW2ldLCAtMTgwLCAxODAsIDAsIHRydWUsICLCsCIsIDEpLAogICAgICAgIHdheVRoaXJkID0gdWkubmV3X3NsaWRlcih0YWIsIGNvbnRhaW5lciwgIlRoaXJkXG55YXcgaml0dGVyIiAuLiBhYUNvbnRhaW5lcltpXSwgLTE4MCwgMTgwLCAwLCB0cnVlLCAiwrAiLCAxKSwKICAgICAgICB5YXdKaXR0ZXJTdGF0aWMgPSB1aS5uZXdfc2xpZGVyKHRhYiwgY29udGFpbmVyLCAiXG55YXcgaml0dGVyIiAuLiBhYUNvbnRhaW5lcltpXSwgLTE4MCwgMTgwLCAwLCB0cnVlLCAiwrAiLCAxKSwKICAgICAgICB5YXdKaXR0ZXJMZWZ0ID0gdWkubmV3X3NsaWRlcih0YWIsIGNvbnRhaW5lciwgIkxlZnRcbnlhdyBqaXR0ZXIiIC4uIGFhQ29udGFpbmVyW2ldLCAtMTgwLCAxODAsIDAsIHRydWUsICLCsCIsIDEpLAogICAgICAgIHlhd0ppdHRlclJpZ2h0ID0gdWkubmV3X3NsaWRlcih0YWIsIGNvbnRhaW5lciwgIlJpZ2h0XG55YXcgaml0dGVyIiAuLiBhYUNvbnRhaW5lcltpXSwgLTE4MCwgMTgwLCAwLCB0cnVlLCAiwrAiLCAxKSwKICAgICAgICBib2R5WWF3ID0gdWkubmV3X2NvbWJvYm94KHRhYiwgY29udGFpbmVyLCAiQm9keSB5YXdcbiIgLi4gYWFDb250YWluZXJbaV0sICJPZmYiLCAiQ3VzdG9tIERlc3luYyIsICJPcHBvc2l0ZSIsICJKaXR0ZXIiLCAiU3RhdGljIiksCiAgICAgICAgYm9keVlhd1N0YXRpYyA9IHVpLm5ld19zbGlkZXIodGFiLCBjb250YWluZXIsICJcbmJvZHkgeWF3IiAuLiBhYUNvbnRhaW5lcltpXSwgLTE4MCwgMTgwLCAwLCB0cnVlLCAiwrAiLCAxKSwKICAgICAgICBmYWtlWWF3TGltaXQgPSB1aS5uZXdfc2xpZGVyKHRhYiwgY29udGFpbmVyLCAiRmFrZSB5YXcgbGltaXRcbiIgLi4gYWFDb250YWluZXJbaV0sIC01OSwgNTksIDAsIHRydWUsICLCsCIsIDEpLAogICAgICAgIGRlZmVuc2l2ZUFudGlBaW0gPSB1aS5uZXdfY2hlY2tib3godGFiLCBjb250YWluZXIsICJEZWZlbnNpdmUgQW50aS1BaW1cbiIgLi4gYWFDb250YWluZXJbaV0pLAogICAgICAgIGRlZl9waXRjaCA9IHVpLm5ld19jb21ib2JveCh0YWIsIGNvbnRhaW5lciwgIltEZWZlbnNpdmVdIFBpdGNoXG4iIC4uIGFhQ29udGFpbmVyW2ldLCAiT2ZmIiwgIkRlZmF1bHQiLCAiVXAiLCAiRG93biIsICJNaW5pbWFsIiwgIlJhbmRvbSIsICJDdXN0b20iKSwKICAgICAgICBkZWZfcGl0Y2hTbGlkZXIgPSB1aS5uZXdfc2xpZGVyKHRhYiwgY29udGFpbmVyLCAiW0RlZmVuc2l2ZV0gXG5QaXRjaCBhZGQiIC4uIGFhQ29udGFpbmVyW2ldLCAtODksIDg5LCAwLCB0cnVlLCAiwrAiLCAxKSwKICAgICAgICBkZWZfeWF3QmFzZSA9IHVpLm5ld19jb21ib2JveCh0YWIsIGNvbnRhaW5lciwgIltEZWZlbnNpdmVdIFlhdyBiYXNlXG4iIC4uIGFhQ29udGFpbmVyW2ldLCAiTG9jYWwgdmlldyIsICJBdCB0YXJnZXRzIiksCiAgICAgICAgZGVmX3lhdyA9IHVpLm5ld19jb21ib2JveCh0YWIsIGNvbnRhaW5lciwgIltEZWZlbnNpdmVdIFlhd1xuIiAuLiBhYUNvbnRhaW5lcltpXSwgIk9mZiIsICIxODAiLCAiMTgwIFoiLCAiU3BpbiIsICJTbG93IEppdHRlciIsICJEZWxheSBKaXR0ZXIiLCAiTCZSIiksCiAgICAgICAgZGVmX3N3aXRjaFRpY2tzID0gdWkubmV3X3NsaWRlcih0YWIsIGNvbnRhaW5lciwgIltEZWZlbnNpdmVdIFxudGlja3MiIC4uIGFhQ29udGFpbmVyW2ldLCAxLCAxNCwgNiwgMCksCiAgICAgICAgZGVmX3lhd1N0YXRpYyA9IHVpLm5ld19zbGlkZXIodGFiLCBjb250YWluZXIsICJbRGVmZW5zaXZlXSBcbnlhdyIgLi4gYWFDb250YWluZXJbaV0sIC0xODAsIDE4MCwgMCwgdHJ1ZSwgIsKwIiwgMSksCiAgICAgICAgZGVmX3lhd0xlZnQgPSB1aS5uZXdfc2xpZGVyKHRhYiwgY29udGFpbmVyLCAiW0RlZmVuc2l2ZV0gTGVmdFxueWF3IiAuLiBhYUNvbnRhaW5lcltpXSwgLTE4MCwgMTgwLCAwLCB0cnVlLCAiwrAiLCAxKSwKICAgICAgICBkZWZfeWF3UmlnaHQgPSB1aS5uZXdfc2xpZGVyKHRhYiwgY29udGFpbmVyLCAiW0RlZmVuc2l2ZV0gUmlnaHRcbnlhdyIgLi4gYWFDb250YWluZXJbaV0sIC0xODAsIDE4MCwgMCwgdHJ1ZSwgIsKwIiwgMSksCiAgICAgICAgZGVmX3lhd0ppdHRlciA9IHVpLm5ld19jb21ib2JveCh0YWIsIGNvbnRhaW5lciwgIltEZWZlbnNpdmVdIFlhdyBqaXR0ZXJcbiIgLi4gYWFDb250YWluZXJbaV0sICJPZmYiLCAiT2Zmc2V0IiwgIkNlbnRlciIsICJTa2l0dGVyIiwgIlJhbmRvbSIsICIzLVdheSIsICJMJlIiKSwKICAgICAgICBkZWZfd2F5Rmlyc3QgPSB1aS5uZXdfc2xpZGVyKHRhYiwgY29udGFpbmVyLCAiW0RlZmVuc2l2ZV0gRmlyc3RcbnlhdyBqaXR0ZXIiIC4uIGFhQ29udGFpbmVyW2ldLCAtMTgwLCAxODAsIDAsIHRydWUsICLCsCIsIDEpLAogICAgICAgIGRlZl93YXlTZWNvbmQgPSB1aS5uZXdfc2xpZGVyKHRhYiwgY29udGFpbmVyLCAiW0RlZmVuc2l2ZV0gU2Vjb25kXG55YXcgaml0dGVyIiAuLiBhYUNvbnRhaW5lcltpXSwgLTE4MCwgMTgwLCAwLCB0cnVlLCAiwrAiLCAxKSwKICAgICAgICBkZWZfd2F5VGhpcmQgPSB1aS5uZXdfc2xpZGVyKHRhYiwgY29udGFpbmVyLCAiW0RlZmVuc2l2ZV0gVGhpcmRcbnlhdyBqaXR0ZXIiIC4uIGFhQ29udGFpbmVyW2ldLCAtMTgwLCAxODAsIDAsIHRydWUsICLCsCIsIDEpLAogICAgICAgIGRlZl95YXdKaXR0ZXJTdGF0aWMgPSB1aS5uZXdfc2xpZGVyKHRhYiwgY29udGFpbmVyLCAiW0RlZmVuc2l2ZV0gXG55YXcgaml0dGVyIiAuLiBhYUNvbnRhaW5lcltpXSwgLTE4MCwgMTgwLCAwLCB0cnVlLCAiwrAiLCAxKSwKICAgICAgICBkZWZfeWF3Sml0dGVyTGVmdCA9IHVpLm5ld19zbGlkZXIodGFiLCBjb250YWluZXIsICJbRGVmZW5zaXZlXSBMZWZ0XG55YXcgaml0dGVyIiAuLiBhYUNvbnRhaW5lcltpXSwgLTE4MCwgMTgwLCAwLCB0cnVlLCAiwrAiLCAxKSwKICAgICAgICBkZWZfeWF3Sml0dGVyUmlnaHQgPSB1aS5uZXdfc2xpZGVyKHRhYiwgY29udGFpbmVyLCAiW0RlZmVuc2l2ZV0gUmlnaHRcbnlhdyBqaXR0ZXIiIC4uIGFhQ29udGFpbmVyW2ldLCAtMTgwLCAxODAsIDAsIHRydWUsICLCsCIsIDEpLAogICAgICAgIGRlZl9ib2R5WWF3ID0gdWkubmV3X2NvbWJvYm94KHRhYiwgY29udGFpbmVyLCAiW0RlZmVuc2l2ZV0gQm9keSB5YXdcbiIgLi4gYWFDb250YWluZXJbaV0sICJPZmYiLCAiQ3VzdG9tIERlc3luYyIsICJPcHBvc2l0ZSIsICJKaXR0ZXIiLCAiU3RhdGljIiksCiAgICAgICAgZGVmX2JvZHlZYXdTdGF0aWMgPSB1aS5uZXdfc2xpZGVyKHRhYiwgY29udGFpbmVyLCAiW0RlZmVuc2l2ZV0gXG5ib2R5IHlhdyIgLi4gYWFDb250YWluZXJbaV0sIC0xODAsIDE4MCwgMCwgdHJ1ZSwgIsKwIiwgMSksCiAgICAgICAgZGVmX2Zha2VZYXdMaW1pdCA9IHVpLm5ld19zbGlkZXIodGFiLCBjb250YWluZXIsICJbRGVmZW5zaXZlXSBGYWtlIHlhdyBsaW1pdFxuIiAuLiBhYUNvbnRhaW5lcltpXSwgLTU5LCA1OSwgMCwgdHJ1ZSwgIsKwIiwgMSksCiAgICB9CmVuZAoKbG9jYWwgZnVuY3Rpb24gZ2V0Q29uZmlnKG5hbWUpCiAgICBsb2NhbCBkYXRhYmFzZSA9IGRhdGFiYXNlLnJlYWQobHVhLmRhdGFiYXNlLmNvbmZpZ3MpIG9yIHt9CgogICAgZm9yIGksIHYgaW4gcGFpcnMoZGF0YWJhc2UpIGRvCiAgICAgICAgaWYgdi5uYW1lID09IG5hbWUgdGhlbgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgY29uZmlnID0gdi5jb25maWcsCiAgICAgICAgICAgICAgICBpbmRleCA9IGkKICAgICAgICAgICAgfQogICAgICAgIGVuZAogICAgZW5kCgogICAgZm9yIGksIHYgaW4gcGFpcnMocHJlc2V0cykgZG8KICAgICAgICBpZiB2Lm5hbWUgPT0gbmFtZSB0aGVuCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBjb25maWcgPSB2LmNvbmZpZywKICAgICAgICAgICAgICAgIGluZGV4ID0gaQogICAgICAgICAgICB9CiAgICAgICAgZW5kCiAgICBlbmQKCiAgICByZXR1cm4gZmFsc2UKZW5kCmxvY2FsIGZ1bmN0aW9uIHNhdmVDb25maWcobmFtZSkKICAgIGxvY2FsIGRiID0gZGF0YWJhc2UucmVhZChsdWEuZGF0YWJhc2UuY29uZmlncykgb3Ige30KICAgIGxvY2FsIGNvbmZpZyA9IHt9CgogICAgaWYgbmFtZTptYXRjaCgiW14ld10iKSB+PSBuaWwgdGhlbgogICAgICAgIHJldHVybgogICAgZW5kCgogICAgZm9yIGtleSwgdmFsdWUgaW4gcGFpcnModmFycy5wU3RhdGVzKSBkbwogICAgICAgIGNvbmZpZ1t2YWx1ZV0gPSB7fQogICAgICAgIGZvciBrLCB2IGluIHBhaXJzKGFhQnVpbGRlcltrZXldKSBkbwogICAgICAgICAgICBjb25maWdbdmFsdWVdW2tdID0gdWkuZ2V0KHYpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBsb2NhbCBjZmcgPSBnZXRDb25maWcobmFtZSkKCiAgICBpZiBub3QgY2ZnIHRoZW4KICAgICAgICB0YWJsZS5pbnNlcnQoZGIsIHsgbmFtZSA9IG5hbWUsIGNvbmZpZyA9IGNvbmZpZyB9KQogICAgZWxzZQogICAgICAgIGRiW2NmZy5pbmRleF0uY29uZmlnID0gY29uZmlnCiAgICBlbmQKCiAgICBkYXRhYmFzZS53cml0ZShsdWEuZGF0YWJhc2UuY29uZmlncywgZGIpCmVuZApsb2NhbCBmdW5jdGlvbiBkZWxldGVDb25maWcobmFtZSkKICAgIGxvY2FsIGRiID0gZGF0YWJhc2UucmVhZChsdWEuZGF0YWJhc2UuY29uZmlncykgb3Ige30KCiAgICBmb3IgaSwgdiBpbiBwYWlycyhkYikgZG8KICAgICAgICBpZiB2Lm5hbWUgPT0gbmFtZSB0aGVuCiAgICAgICAgICAgIHRhYmxlLnJlbW92ZShkYiwgaSkKICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGZvciBpLCB2IGluIHBhaXJzKHByZXNldHMpIGRvCiAgICAgICAgaWYgdi5uYW1lID09IG5hbWUgdGhlbgogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGRhdGFiYXNlLndyaXRlKGx1YS5kYXRhYmFzZS5jb25maWdzLCBkYikKZW5kCmxvY2FsIGZ1bmN0aW9uIGdldENvbmZpZ0xpc3QoKQogICAgbG9jYWwgZGF0YWJhc2UgPSBkYXRhYmFzZS5yZWFkKGx1YS5kYXRhYmFzZS5jb25maWdzKSBvciB7fQogICAgbG9jYWwgY29uZmlnID0ge30KCiAgICBmb3IgaSwgdiBpbiBwYWlycyhwcmVzZXRzKSBkbwogICAgICAgIHRhYmxlLmluc2VydChjb25maWcsIHYubmFtZSkKICAgIGVuZAoKICAgIGZvciBpLCB2IGluIHBhaXJzKGRhdGFiYXNlKSBkbwogICAgICAgIHRhYmxlLmluc2VydChjb25maWcsIHYubmFtZSkKICAgIGVuZAoKICAgIHJldHVybiBjb25maWcKZW5kCmxvY2FsIGZ1bmN0aW9uIHR5cGVGcm9tU3RyaW5nKGlucHV0KQogICAgaWYgdHlwZShpbnB1dCkgfj0gInN0cmluZyIgdGhlbiByZXR1cm4gaW5wdXQgZW5kCgogICAgbG9jYWwgdmFsdWUgPSBpbnB1dDpsb3dlcigpCgogICAgaWYgdmFsdWUgPT0gInRydWUiIHRoZW4KICAgICAgICByZXR1cm4gdHJ1ZQogICAgZWxzZWlmIHZhbHVlID09ICJmYWxzZSIgdGhlbgogICAgICAgIHJldHVybiBmYWxzZQogICAgZWxzZWlmIHRvbnVtYmVyKHZhbHVlKSB+PSBuaWwgdGhlbgogICAgICAgIHJldHVybiB0b251bWJlcih2YWx1ZSkKICAgIGVsc2UKICAgICAgICByZXR1cm4gdG9zdHJpbmcoaW5wdXQpCiAgICBlbmQKZW5kCmxvY2FsIGZ1bmN0aW9uIGxvYWRTZXR0aW5ncyhjb25maWcpCiAgICBmb3Iga2V5LCB2YWx1ZSBpbiBwYWlycyh2YXJzLnBTdGF0ZXMpIGRvCiAgICAgICAgZm9yIGssIHYgaW4gcGFpcnMoYWFCdWlsZGVyW2tleV0pIGRvCiAgICAgICAgICAgIGlmIChjb25maWdbdmFsdWVdW2tdIH49IG5pbCkgdGhlbgogICAgICAgICAgICAgICAgdWkuc2V0KHYsIGNvbmZpZ1t2YWx1ZV1ba10pCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCAKICAgIGVuZAplbmQKbG9jYWwgZnVuY3Rpb24gaW1wb3J0U2V0dGluZ3MoKQogICAgbG9hZFNldHRpbmdzKGpzb24ucGFyc2UoY2xpcGJvYXJkLmdldCgpKSkKZW5kCmxvY2FsIGZ1bmN0aW9uIGV4cG9ydFNldHRpbmdzKG5hbWUpCiAgICBsb2NhbCBjb25maWcgPSB7fQogICAgZm9yIGtleSwgdmFsdWUgaW4gcGFpcnModmFycy5wU3RhdGVzKSBkbwogICAgICAgIGNvbmZpZ1t2YWx1ZV0gPSB7fQogICAgICAgIGZvciBrLCB2IGluIHBhaXJzKGFhQnVpbGRlcltrZXldKSBkbwogICAgICAgICAgICBjb25maWdbdmFsdWVdW2tdID0gdWkuZ2V0KHYpCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgY2xpcGJvYXJkLnNldChqc29uLnN0cmluZ2lmeShjb25maWcpKQplbmQKbG9jYWwgZnVuY3Rpb24gbG9hZENvbmZpZyhuYW1lKQogICAgbG9jYWwgY29uZmlnID0gZ2V0Q29uZmlnKG5hbWUpCiAgICBsb2FkU2V0dGluZ3MoY29uZmlnLmNvbmZpZykKZW5kCgpsb2NhbCBmdW5jdGlvbiBpbml0RGF0YWJhc2UoKQogICAgaWYgZGF0YWJhc2UucmVhZChsdWEuZGF0YWJhc2UuY29uZmlncykgPT0gbmlsIHRoZW4KICAgICAgICBkYXRhYmFzZS53cml0ZShsdWEuZGF0YWJhc2UuY29uZmlncywge30pCiAgICBlbmQKCiAgICBsb2NhbCBsaW5rID0gImh0dHBzOi8vcGFzdGViaW4uY29tL3Jhdy9tMGNremJVYiIKCiAgICBodHRwLmdldChsaW5rLCBmdW5jdGlvbihzdWNjZXNzLCByZXNwb25zZSkKICAgICAgICBpZiBub3Qgc3VjY2VzcyB0aGVuCiAgICAgICAgICAgIHByaW50KCJGYWlsZWQgdG8gZ2V0IHByZXNldHMiKQogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKICAgIAogICAgICAgIGRhdGEgPSBqc29uLnBhcnNlKHJlc3BvbnNlLmJvZHkpCiAgICAKICAgICAgICBmb3IgaSwgcHJlc2V0IGluIHBhaXJzKGRhdGEucHJlc2V0cykgZG8KICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHByZXNldHMsIHsgbmFtZSA9ICIqIi4ucHJlc2V0Lm5hbWUsIGNvbmZpZyA9IHByZXNldC5jb25maWd9KQogICAgICAgICAgICB1aS5zZXQobWVudS5jb25maWdUYWIubmFtZSwgIioiLi5wcmVzZXQubmFtZSkKICAgICAgICBlbmQKICAgICAgICB1aS51cGRhdGUobWVudS5jb25maWdUYWIubGlzdCwgZ2V0Q29uZmlnTGlzdCgpKQogICAgZW5kKQplbmQKaW5pdERhdGFiYXNlKCkKLS0gQHJlZ2lvbiBVSV9MQVlPVVQgZW5kCgotLSBAcmVnaW9uIE5PVElGSUNBVElPTl9BTklNIHN0YXJ0CmxvY2FsIGFuaW1fdGltZSA9IDAuNzUKbG9jYWwgbWF4X25vdGlmcyA9IDYKbG9jYWwgZGF0YSA9IHt9CmxvY2FsIG5vdGlmaWNhdGlvbnMgPSB7CgogICAgbmV3ID0gZnVuY3Rpb24oIHN0cmluZywgciwgZywgYikKICAgICAgICB0YWJsZS5pbnNlcnQoZGF0YSwgewogICAgICAgICAgICB0aW1lID0gZ2xvYmFscy5jdXJ0aW1lKCksCiAgICAgICAgICAgIHN0cmluZyA9IHN0cmluZywKICAgICAgICAgICAgY29sb3IgPSB7ciwgZywgYiwgMjU1fSwKICAgICAgICAgICAgZnJhY3Rpb24gPSAwCiAgICAgICAgfSkKICAgICAgICBsb2NhbCB0aW1lID0gNQogICAgICAgIGZvciBpID0gI2RhdGEsIDEsIC0xIGRvCiAgICAgICAgICAgIGxvY2FsIG5vdGlmID0gZGF0YVtpXQogICAgICAgICAgICBpZiAjZGF0YSAtIGkgKyAxID4gbWF4X25vdGlmcyBhbmQgbm90aWYudGltZSArIHRpbWUgLSBnbG9iYWxzLmN1cnRpbWUoKSA+IDAgdGhlbgogICAgICAgICAgICAgICAgbm90aWYudGltZSA9IGdsb2JhbHMuY3VydGltZSgpIC0gdGltZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCwKCiAgICByZW5kZXIgPSBmdW5jdGlvbigpCiAgICAgICAgbG9jYWwgeCwgeSA9IGNsaWVudC5zY3JlZW5fc2l6ZSgpCiAgICAgICAgbG9jYWwgdG9fcmVtb3ZlID0ge30KICAgICAgICBsb2NhbCBPZmZzZXQgPSAwCiAgICAgICAgZm9yIGkgPSAxLCAjZGF0YSBkbwogICAgICAgICAgICBsb2NhbCBub3RpZiA9IGRhdGFbaV0KCiAgICAgICAgICAgIGxvY2FsIGRhdGEgPSB7cm91bmRpbmcgPSAwLCBzaXplID0gMCwgZ2xvdyA9IDAsIHRpbWUgPSAwfQoKICAgICAgICAgICAgaWYgbm90aWYudGltZSArIGRhdGEudGltZSAtIGdsb2JhbHMuY3VydGltZSgpID4gMCB0aGVuCiAgICAgICAgICAgICAgICBub3RpZi5mcmFjdGlvbiA9IGZ1bmMuY2xhbXAobm90aWYuZnJhY3Rpb24gKyBnbG9iYWxzLmZyYW1ldGltZSgpIC8gYW5pbV90aW1lLCAwLCAxKQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBub3RpZi5mcmFjdGlvbiA9IGZ1bmMuY2xhbXAobm90aWYuZnJhY3Rpb24gLSBnbG9iYWxzLmZyYW1ldGltZSgpIC8gYW5pbV90aW1lLCAwLCAxKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIG5vdGlmLmZyYWN0aW9uIDw9IDAgYW5kIG5vdGlmLnRpbWUgKyBkYXRhLnRpbWUgLSBnbG9iYWxzLmN1cnRpbWUoKSA8PSAwIHRoZW4KICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydCh0b19yZW1vdmUsIGkpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBsb2NhbCBmcmFjdGlvbiA9IGZ1bmMuZWFzZUluT3V0KG5vdGlmLmZyYWN0aW9uKQoKICAgICAgICAgICAgbG9jYWwgciwgZywgYiwgYSA9IHVucGFjayhub3RpZi5jb2xvcikKICAgICAgICAgICAgbG9jYWwgc3RyaW5nID0gY29sb3JfdGV4dChub3RpZi5zdHJpbmcsIHIsIGcsIGIsIGEgKiBmcmFjdGlvbikKCiAgICAgICAgICAgIGxvY2FsIHN0cncsIHN0cmggPSByZW5kZXJlci5tZWFzdXJlX3RleHQoIiIsIHN0cmluZykKICAgICAgICAgICAgbG9jYWwgc3RydzIgPSByZW5kZXJlci5tZWFzdXJlX3RleHQoImIiLCAiIikKCiAgICAgICAgICAgIGxvY2FsIHBhZGRpbmd4LCBwYWRkaW5neSA9IDcsIGRhdGEuc2l6ZQogICAgICAgICAgICBkYXRhLnJvdW5kaW5nID0gMAoKICAgICAgICAgICAgT2Zmc2V0ID0gT2Zmc2V0ICsgKHN0cmggKyBwYWRkaW5neSoyICsgCW1hdGguc3FydChkYXRhLmdsb3cvMTApKjEwICsgNSkgKiBmcmFjdGlvbgogICAgICAgICAgICBnbG93X21vZHVsZSh4LzIgLSAoc3RydyArIHN0cncyKS8yIC0gcGFkZGluZ3gsIHkgLSAxMDAgLSBzdHJoLzIgLSBwYWRkaW5neSAtIE9mZnNldCwgc3RydyArIHN0cncyICsgcGFkZGluZ3gqMiwgc3RyaCArIHBhZGRpbmd5KjIsIGRhdGEuZ2xvdywgZGF0YS5yb3VuZGluZywge3IsIGcsIGIsIDQ1ICogZnJhY3Rpb259LCB7MjUsMjUsMjUsMTQwICogZnJhY3Rpb259KQogICAgICAgICAgICByZW5kZXJlci50ZXh0KHgvMiArIHN0cncyLzIsIHkgLSAxMDAgLSBPZmZzZXQsIDI1NSwgMjU1LCAyNTUsIDI1NSAqIGZyYWN0aW9uLCAiYyIsIDAsIHN0cmluZykKICAgICAgICAgICAgcmVuZGVyZXIubGluZSh4LzIgLSAoc3RydyArIHN0cncyKS8yIC0gcGFkZGluZ3ggLSAxLCB5IC0gMTAwICsgc3RyaC8yICsgcGFkZGluZ3kgLSBPZmZzZXQsIHgvMiArIChzdHJ3ICsgc3RydzIpLzIgKyBwYWRkaW5neCArIDEsIHkgLSAxMDAgKyBzdHJoLzIgKyBwYWRkaW5neSAtIE9mZnNldCwgciwgZywgYiwgMjU1ICAqIGZyYWN0aW9uKQogICAgICAgICAgICAtLXJlbmRlcmVyLnRleHQoeC8yICsgc3RydzIvMiwgeSAtIDEwMCAtIE9mZnNldCwgMjU1LCAyNTUsIDI1NSwgMjU1ICogZnJhY3Rpb24sICJjIiwgMCwgc3RyaW5nICIkSW52aW5zaWJsZSIsIHIsIGcsIGIsIGEpICogZnJhY3Rpb24gIAogICAgICAgIGVuZAoKICAgICAgICBmb3IgaSA9ICN0b19yZW1vdmUsIDEsIC0xIGRvCiAgICAgICAgICAgIHRhYmxlLnJlbW92ZShkYXRhLCB0b19yZW1vdmVbaV0pCiAgICAgICAgZW5kCiAgICBlbmQsCgogICAgY2xlYXIgPSBmdW5jdGlvbigpCiAgICAgICAgZGF0YSA9IHt9CiAgICBlbmQKfQoKCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soImNsaWVudF9kaXNjb25uZWN0IiwgZnVuY3Rpb24oKSBub3RpZmljYXRpb25zLmNsZWFyKCkgZW5kKQpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJsZXZlbF9pbml0IiwgZnVuY3Rpb24oKSAgbm90aWZpY2F0aW9ucy5jbGVhcigpIGVuZCkKY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygncGxheWVyX2Nvbm5lY3RfZnVsbCcsIGZ1bmN0aW9uKGUpIGlmIGNsaWVudC51c2VyaWRfdG9fZW50aW5kZXgoZS51c2VyaWQpID09IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkgdGhlbiBub3RpZmljYXRpb25zLmNsZWFyKCkgZW5kIGVuZCkKCgotLSBAcmVnaW9uIE5PVElGSUNBVElPTl9BTklNIGVuZAoKLS0gQHJlZ2lvbiBBQV9DQUxMQkFDS1Mgc3RhcnQKbG9jYWwgYWEgPSB7CglpZ25vcmUgPSBmYWxzZSwKCW1hbnVhbEFBPSAwLAoJaW5wdXQgPSAwLAp9CmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInBsYXllcl9jb25uZWN0X2Z1bGwiLCBmdW5jdGlvbigpIAoJYWEuaWdub3JlID0gZmFsc2UKCWFhLm1hbnVhbEFBPSAwCglhYS5pbnB1dCA9IDAKZW5kKSAKCmxvY2FsIGNvdW50ZXIgPSAwCmxvY2FsIHN3aXRjaCA9IGZhbHNlCgpkaXN0YW5jZV9rbmlmZSA9IHt9CmRpc3RhbmNlX2tuaWZlLmFudGlfa25pZmVfZGlzdCA9IGZ1bmN0aW9uICh4MSwgeTEsIHoxLCB4MiwgeTIsIHoyKQogICAgcmV0dXJuIG1hdGguc3FydCgoeDIgLSB4MSleMiArICh5MiAtIHkxKV4yICsgKHoyIC0gejEpXjIpCmVuZAogICAgCgpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJydW5fY29tbWFuZCIsIGZ1bmN0aW9uKGNtZCkKICAgIHZhcnMuYnJlYWtlci5jbWQgPSBjbWQuY29tbWFuZF9udW1iZXIKICAgIGlmIGNtZC5jaG9rZWRjb21tYW5kcyA9PSAwIHRoZW4KICAgICAgICB2YXJzLmJyZWFrZXIub3JpZ2luID0gdmVjdG9yKGVudGl0eS5nZXRfb3JpZ2luKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkpKQogICAgICAgIGlmIHZhcnMuYnJlYWtlci5sYXN0X29yaWdpbiB+PSBuaWwgdGhlbgogICAgICAgICAgICB2YXJzLmJyZWFrZXIudHBfZGlzdCA9ICh2YXJzLmJyZWFrZXIub3JpZ2luIC0gdmFycy5icmVha2VyLmxhc3Rfb3JpZ2luKTpsZW5ndGgyZHNxcigpCiAgICAgICAgICAgIGdyYW1fdXBkYXRlKHZhcnMuYnJlYWtlci50cF9kYXRhLCB2YXJzLmJyZWFrZXIudHBfZGlzdCwgdHJ1ZSkKICAgICAgICBlbmQKICAgICAgICB2YXJzLmJyZWFrZXIubGFzdF9vcmlnaW4gPSB2YXJzLmJyZWFrZXIub3JpZ2luCiAgICBlbmQKZW5kKQoKY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygicHJlZGljdF9jb21tYW5kIiwgZnVuY3Rpb24oY21kKQogICAgaWYgY21kLmNvbW1hbmRfbnVtYmVyID09IHZhcnMuYnJlYWtlci5jbWQgdGhlbgogICAgICAgIGxvY2FsIHRpY2tiYXNlID0gZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX25UaWNrQmFzZSIpCiAgICAgICAgdmFycy5icmVha2VyLmRlZmVuc2l2ZSA9IG1hdGguYWJzKHRpY2tiYXNlIC0gdmFycy5icmVha2VyLmRlZmVuc2l2ZV9jaGVjaykKICAgICAgICB2YXJzLmJyZWFrZXIuZGVmZW5zaXZlX2NoZWNrID0gbWF0aC5tYXgodGlja2Jhc2UsIHZhcnMuYnJlYWtlci5kZWZlbnNpdmVfY2hlY2spCiAgICAgICAgdmFycy5icmVha2VyLmNtZCA9IDAKICAgIGVuZAplbmQpCgpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJzZXR1cF9jb21tYW5kIiwgZnVuY3Rpb24oY21kKQogICAgdmFycy5sb2NhbFBsYXllciA9IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkKCiAgICBpZiBub3QgdmFycy5sb2NhbFBsYXllciAgb3Igbm90IGVudGl0eS5pc19hbGl2ZSh2YXJzLmxvY2FsUGxheWVyKSB0aGVuIHJldHVybiBlbmQKCWxvY2FsIGZsYWdzID0gZW50aXR5LmdldF9wcm9wKHZhcnMubG9jYWxQbGF5ZXIsICJtX2ZGbGFncyIpCiAgICBsb2NhbCBvbmdyb3VuZCA9IGJpdC5iYW5kKGZsYWdzLCAxKSB+PSAwIGFuZCBjbWQuaW5fanVtcCA9PSAwCglsb2NhbCB2YWx2ZSA9IGVudGl0eS5nZXRfcHJvcChlbnRpdHkuZ2V0X2dhbWVfcnVsZXMoKSwgIm1fYklzVmFsdmVEUyIpCglsb2NhbCBvcmlnaW4gPSB2ZWN0b3IoZW50aXR5LmdldF9wcm9wKHZhcnMubG9jYWxQbGF5ZXIsICJtX3ZlY09yaWdpbiIpKQoJbG9jYWwgY2FtZXJhID0gdmVjdG9yKGNsaWVudC5jYW1lcmFfYW5nbGVzKCkpCglsb2NhbCBleWUgPSB2ZWN0b3IoY2xpZW50LmV5ZV9wb3NpdGlvbigpKQogICAgbG9jYWwgdmVsb2NpdHkgPSB2ZWN0b3IoZW50aXR5LmdldF9wcm9wKHZhcnMubG9jYWxQbGF5ZXIsICJtX3ZlY1ZlbG9jaXR5IikpCiAgICBsb2NhbCB3ZWFwb24gPSBlbnRpdHkuZ2V0X3BsYXllcl93ZWFwb24oKQoJbG9jYWwgcFN0aWxsID0gbWF0aC5zcXJ0KHZlbG9jaXR5LnggXiAyICsgdmVsb2NpdHkueSBeIDIpIDwgNQogICAgbG9jYWwgYm9keVlhdyA9IGVudGl0eS5nZXRfcHJvcCh2YXJzLmxvY2FsUGxheWVyLCAibV9mbFBvc2VQYXJhbWV0ZXIiLCAxMSkgKiAxMjAgLSA2MAogICAgbG9jYWwgdHBfYW1vdW50ID0gZ2V0X2F2ZXJhZ2UodmFycy5icmVha2VyLnRwX2RhdGEpL2dldF92ZWxvY2l0eShlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpKSoxMDAgCiAgICBsb2NhbCBpc19kZWZlbnNpdmUgPSAodmFycy5icmVha2VyLmRlZmVuc2l2ZSA+IDEpIGFuZCBub3QgKHRwX2Ftb3VudCA+PSAyNSBhbmQgdmFycy5icmVha2VyLmRlZmVuc2l2ZSA+PSAxMykKCiAgICBsb2NhbCBpc1Nsb3cgPSB1aS5nZXQocmVmcy5zbG93WzFdKSBhbmQgdWkuZ2V0KHJlZnMuc2xvd1syXSkKCWxvY2FsIGlzT3MgPSB1aS5nZXQocmVmcy5vc1sxXSkgYW5kIHVpLmdldChyZWZzLm9zWzJdKQoJbG9jYWwgaXNGZCA9IHVpLmdldChyZWZzLmZha2VEdWNrKQoJbG9jYWwgaXNEdCA9IHVpLmdldChyZWZzLmR0WzFdKSBhbmQgdWkuZ2V0KHJlZnMuZHRbMl0pCiAgICBsb2NhbCBpc0ZsID0gdWkuZ2V0KHVpLnJlZmVyZW5jZSgiQUEiLCAiRmFrZSBsYWciLCAiRW5hYmxlZCIpKQogICAgbG9jYWwgbGVnaXRBQSA9IGZhbHNlCgogICAgbG9jYWwgbWFudWFsc092ZXJGcyA9IHVpLmdldChtZW51LmFhVGFiLm1hbnVhbHNPdmVyRnMpID09IHRydWUgYW5kIHRydWUgb3IgZmFsc2UKCiAgICAtLSBzZWFyY2ggZm9yIHN0YXRlcwogICAgdmFycy5wU3RhdGUgPSAxCiAgICBpZiBwU3RpbGwgdGhlbiB2YXJzLnBTdGF0ZSA9IDIgZW5kCiAgICBpZiBub3QgcFN0aWxsIHRoZW4gdmFycy5wU3RhdGUgPSAzIGVuZAogICAgaWYgaXNTbG93IHRoZW4gdmFycy5wU3RhdGUgPSA0IGVuZAogICAgaWYgZW50aXR5LmdldF9wcm9wKHZhcnMubG9jYWxQbGF5ZXIsICJtX2ZsRHVja0Ftb3VudCIpID4gMC4xIHRoZW4gdmFycy5wU3RhdGUgPSA1IGVuZAogICAgaWYgbm90IHBTdGlsbCBhbmQgZW50aXR5LmdldF9wcm9wKHZhcnMubG9jYWxQbGF5ZXIsICJtX2ZsRHVja0Ftb3VudCIpID4gMC4xIHRoZW4gdmFycy5wU3RhdGUgPSA4IGVuZAogICAgaWYgbm90IG9uZ3JvdW5kIHRoZW4gdmFycy5wU3RhdGUgPSA2IGVuZAogICAgaWYgbm90IG9uZ3JvdW5kIGFuZCBlbnRpdHkuZ2V0X3Byb3AodmFycy5sb2NhbFBsYXllciwgIm1fZmxEdWNrQW1vdW50IikgPiAwLjEgdGhlbiB2YXJzLnBTdGF0ZSA9IDcgZW5kCgogICAgaWYgdWkuZ2V0KGFhQnVpbGRlcls5XS5lbmFibGVTdGF0ZSkgYW5kIG5vdCBmdW5jLnRhYmxlX2NvbnRhaW5zKHVpLmdldChhYUJ1aWxkZXJbOV0uc3RhdGVEaXNhYmxlcnMpLCB2YXJzLmludFRvU1t2YXJzLnBTdGF0ZV0pIGFuZCBpc0R0ID09IGZhbHNlIGFuZCBpc09zID09IGZhbHNlIGFuZCBpc0ZsID09IHRydWUgdGhlbgoJCXZhcnMucFN0YXRlID0gOQogICAgZW5kCgogICAgaWYgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0uZW5hYmxlU3RhdGUpID09IGZhbHNlIGFuZCB2YXJzLnBTdGF0ZSB+PSAxIHRoZW4KICAgICAgICB2YXJzLnBTdGF0ZSA9IDEKICAgIGVuZAoKICAgIGlmIGNtZC5jaG9rZWRjb21tYW5kcyA9PSAwIHRoZW4KICAgICAgICBjb3VudGVyID0gY291bnRlciArIDEKICAgIGVuZAoKICAgIGlmIGNvdW50ZXIgPj0gOCB0aGVuCiAgICAgICAgY291bnRlciA9IDAKICAgIGVuZAoKICAgIGlmIGdsb2JhbHMudGlja2NvdW50KCkgJSB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS5zd2l0Y2hUaWNrcykgPT0gMSB0aGVuCiAgICAgICAgc3dpdGNoID0gbm90IHN3aXRjaAogICAgZW5kCgogICAgbG9jYWwgbmV4dEF0dGFjayA9IGVudGl0eS5nZXRfcHJvcCh2YXJzLmxvY2FsUGxheWVyLCAibV9mbE5leHRBdHRhY2siKQogICAgbG9jYWwgbmV4dFByaW1hcnlBdHRhY2sgPSBlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9wbGF5ZXJfd2VhcG9uKHZhcnMubG9jYWxQbGF5ZXIpLCAibV9mbE5leHRQcmltYXJ5QXR0YWNrIikKICAgIGxvY2FsIGR0QWN0aXZlID0gZmFsc2UKICAgIGlmIG5leHRQcmltYXJ5QXR0YWNrIH49IG5pbCB0aGVuCiAgICAgICAgZHRBY3RpdmUgPSBub3QgKG1hdGgubWF4KG5leHRQcmltYXJ5QXR0YWNrLCBuZXh0QXR0YWNrKSA+IGdsb2JhbHMuY3VydGltZSgpKQogICAgZW5kCiAgICAtLSBhcHBseSBhbnRpYWltIHNldAogICAgbG9jYWwgc2lkZSA9IGJvZHlZYXcgPiAwIGFuZCAxIG9yIC0xCgogICAgICAgIC0tIG1hbnVhbCBhYQogICAgICAgIGlmIHVpLmdldChtZW51LmFhVGFiLm1hbnVhbHMpIH49ICJPZmYiIHRoZW4KICAgICAgICAgICAgdWkuc2V0KG1lbnUuYWFUYWIubWFudWFsVGFiLm1hbnVhbExlZnQsICJPbiBob3RrZXkiKQogICAgICAgICAgICB1aS5zZXQobWVudS5hYVRhYi5tYW51YWxUYWIubWFudWFsUmlnaHQsICJPbiBob3RrZXkiKQogICAgICAgICAgICB1aS5zZXQobWVudS5hYVRhYi5tYW51YWxUYWIubWFudWFsRm9yd2FyZCwgIk9uIGhvdGtleSIpCiAgICAgICAgICAgIGlmIGFhLmlucHV0ICsgMC4yMiA8IGdsb2JhbHMuY3VydGltZSgpIHRoZW4KICAgICAgICAgICAgICAgIGlmIGFhLm1hbnVhbEFBID09IDAgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIHVpLmdldChtZW51LmFhVGFiLm1hbnVhbFRhYi5tYW51YWxMZWZ0KSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGFhLm1hbnVhbEFBID0gMQogICAgICAgICAgICAgICAgICAgICAgICBhYS5pbnB1dCA9IGdsb2JhbHMuY3VydGltZSgpCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmIHVpLmdldChtZW51LmFhVGFiLm1hbnVhbFRhYi5tYW51YWxSaWdodCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBhYS5tYW51YWxBQSA9IDIKICAgICAgICAgICAgICAgICAgICAgICAgYWEuaW5wdXQgPSBnbG9iYWxzLmN1cnRpbWUoKQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiB1aS5nZXQobWVudS5hYVRhYi5tYW51YWxUYWIubWFudWFsRm9yd2FyZCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBhYS5tYW51YWxBQSA9IDMKICAgICAgICAgICAgICAgICAgICAgICAgYWEuaW5wdXQgPSBnbG9iYWxzLmN1cnRpbWUoKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZWlmIGFhLm1hbnVhbEFBID09IDEgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIHVpLmdldChtZW51LmFhVGFiLm1hbnVhbFRhYi5tYW51YWxSaWdodCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBhYS5tYW51YWxBQSA9IDIKICAgICAgICAgICAgICAgICAgICAgICAgYWEuaW5wdXQgPSBnbG9iYWxzLmN1cnRpbWUoKQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiB1aS5nZXQobWVudS5hYVRhYi5tYW51YWxUYWIubWFudWFsRm9yd2FyZCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBhYS5tYW51YWxBQSA9IDMKICAgICAgICAgICAgICAgICAgICAgICAgYWEuaW5wdXQgPSBnbG9iYWxzLmN1cnRpbWUoKQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiB1aS5nZXQobWVudS5hYVRhYi5tYW51YWxUYWIubWFudWFsTGVmdCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBhYS5tYW51YWxBQSA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgYWEuaW5wdXQgPSBnbG9iYWxzLmN1cnRpbWUoKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZWlmIGFhLm1hbnVhbEFBID09IDIgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIHVpLmdldChtZW51LmFhVGFiLm1hbnVhbFRhYi5tYW51YWxMZWZ0KSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGFhLm1hbnVhbEFBID0gMQogICAgICAgICAgICAgICAgICAgICAgICBhYS5pbnB1dCA9IGdsb2JhbHMuY3VydGltZSgpCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmIHVpLmdldChtZW51LmFhVGFiLm1hbnVhbFRhYi5tYW51YWxGb3J3YXJkKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGFhLm1hbnVhbEFBID0gMwogICAgICAgICAgICAgICAgICAgICAgICBhYS5pbnB1dCA9IGdsb2JhbHMuY3VydGltZSgpCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmIHVpLmdldChtZW51LmFhVGFiLm1hbnVhbFRhYi5tYW51YWxSaWdodCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBhYS5tYW51YWxBQSA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgYWEuaW5wdXQgPSBnbG9iYWxzLmN1cnRpbWUoKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZWlmIGFhLm1hbnVhbEFBID09IDMgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIHVpLmdldChtZW51LmFhVGFiLm1hbnVhbFRhYi5tYW51YWxGb3J3YXJkKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGFhLm1hbnVhbEFBID0gMAogICAgICAgICAgICAgICAgICAgICAgICBhYS5pbnB1dCA9IGdsb2JhbHMuY3VydGltZSgpCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmIHVpLmdldChtZW51LmFhVGFiLm1hbnVhbFRhYi5tYW51YWxMZWZ0KSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGFhLm1hbnVhbEFBID0gMQogICAgICAgICAgICAgICAgICAgICAgICBhYS5pbnB1dCA9IGdsb2JhbHMuY3VydGltZSgpCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmIHVpLmdldChtZW51LmFhVGFiLm1hbnVhbFRhYi5tYW51YWxSaWdodCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBhYS5tYW51YWxBQSA9IDIKICAgICAgICAgICAgICAgICAgICAgICAgYWEuaW5wdXQgPSBnbG9iYWxzLmN1cnRpbWUoKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBhYS5tYW51YWxBQSA9PSAxIG9yIGFhLm1hbnVhbEFBID09IDIgb3IgYWEubWFudWFsQUEgPT0gMyB0aGVuCiAgICAgICAgICAgICAgICBhYS5pZ25vcmUgPSB0cnVlCgogICAgICAgICAgICAgICAgaWYgdWkuZ2V0KG1lbnUuYWFUYWIubWFudWFscykgPT0gIlN0YXRpYyIgdGhlbgogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd0ppdHRlclsxXSwgIk9mZiIpCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3Sml0dGVyWzJdLCAwKQogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLmJvZHlZYXdbMV0sICJTdGF0aWMiKQogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLmJvZHlZYXdbMl0sIDE4MCkKICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy5waXRjaFsxXSwgIkRvd24iKQoKICAgICAgICAgICAgICAgICAgICBpZiBhYS5tYW51YWxBQSA9PSAxIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3QmFzZSwgImxvY2FsIHZpZXciKQogICAgICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdbMV0sICIxODAiKQogICAgICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdbMl0sIC05MCkKICAgICAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMucGl0Y2hbMV0sICJEb3duIikKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgYWEubWFudWFsQUEgPT0gMiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd0Jhc2UsICJsb2NhbCB2aWV3IikKICAgICAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzFdLCAiMTgwIikKICAgICAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzJdLCA5MCkKICAgICAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMucGl0Y2hbMV0sICJEb3duIikKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgYWEubWFudWFsQUEgPT0gMyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd0Jhc2UsICJsb2NhbCB2aWV3IikKICAgICAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzFdLCAiMTgwIikKICAgICAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzJdLCAxODApCiAgICAgICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnBpdGNoWzFdLCAiRG93biIpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlaWYgdWkuZ2V0KG1lbnUuYWFUYWIubWFudWFscykgPT0gIkRlZmF1bHQiIGFuZCB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS5lbmFibGVTdGF0ZSkgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLnlhd0ppdHRlcikgPT0gIjMtV2F5IiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd0ppdHRlclsxXSwgIkNlbnRlciIpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHdheXMgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS53YXlGaXJzdCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS53YXlTZWNvbmQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0ud2F5VGhpcmQpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3Sml0dGVyWzJdLCB3YXlzWyhnbG9iYWxzLnRpY2tjb3VudCgpICUgMykgKyAxXSApCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLnlhd0ppdHRlcikgPT0gIkwmUiIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdKaXR0ZXJbMV0sICJDZW50ZXIiKQogICAgICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdKaXR0ZXJbMl0sIChzaWRlID09IDEgYW5kIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLnlhd0ppdHRlckxlZnQpIG9yIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLnlhd0ppdHRlclJpZ2h0KSkpCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdKaXR0ZXJbMV0sIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLnlhd0ppdHRlcikpCiAgICAgICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd0ppdHRlclsyXSwgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0ueWF3Sml0dGVyU3RhdGljKSkKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMuYm9keVlhd1sxXSwgIk9wcG9zaXRlIikKICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy5ib2R5WWF3WzJdLCAtMTgwKQoKICAgICAgICAgICAgICAgICAgICBpZiBhYS5tYW51YWxBQSA9PSAxIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3QmFzZSwgImxvY2FsIHZpZXciKQogICAgICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdbMV0sICIxODAiKQogICAgICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdbMl0sIC05MCkKICAgICAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMucGl0Y2hbMV0sICJEb3duIikKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgYWEubWFudWFsQUEgPT0gMiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd0Jhc2UsICJsb2NhbCB2aWV3IikKICAgICAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzFdLCAiMTgwIikKICAgICAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzJdLCA5MCkKICAgICAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMucGl0Y2hbMV0sICJEb3duIikKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgYWEubWFudWFsQUEgPT0gMyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd0Jhc2UsICJsb2NhbCB2aWV3IikKICAgICAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzFdLCAiMTgwIikKICAgICAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzJdLCAxODApCiAgICAgICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnBpdGNoWzFdLCAiRG93biIpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQgICAgICAgICAgICAgICAgICAgCgogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBhYS5pZ25vcmUgPSBmYWxzZQogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlCiAgICAgICAgICAgIGFhLmlnbm9yZSA9IGZhbHNlCiAgICAgICAgICAgIGFhLm1hbnVhbEFBPSAwCiAgICAgICAgICAgIGFhLmlucHV0ID0gMAogICAgICAgIGVuZAoKICAgIGlmIG5vdCB1aS5nZXQobWVudS5hYVRhYi5sZWdpdEFBSG90a2V5KSBhbmQgYWEuaWdub3JlID09IGZhbHNlIHRoZW4KICAgICAgICBpZiB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS5lbmFibGVTdGF0ZSkgdGhlbgoKICAgICAgICAgICAgY21kLmZvcmNlX2RlZmVuc2l2ZSA9IHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLmZvcmNlRGVmZW5zaXZlKSAKICAgICAgICAgICAgaWYgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0uZGVmZW5zaXZlQW50aUFpbSkgYW5kIGlzX2RlZmVuc2l2ZSB0aGVuCiAgICAgICAgICAgICAgICBpZiB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS5kZWZfcGl0Y2gpIH49ICJDdXN0b20iIHRoZW4KICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy5waXRjaFsxXSwgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0uZGVmX3BpdGNoKSkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy5waXRjaFsxXSwgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0uZGVmX3BpdGNoKSkKICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy5waXRjaFsyXSwgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0uZGVmX3BpdGNoU2xpZGVyKSkKICAgICAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdCYXNlLCB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS5kZWZfeWF3QmFzZSkpCiAgICAKICAgICAgICAgICAgICAgIGlmIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLmRlZl95YXcpID09ICJTbG93IEppdHRlciIgdGhlbgogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd1sxXSwgIjE4MCIpCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzJdLCBzd2l0Y2ggYW5kIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLmRlZl95YXdSaWdodCkgb3IgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0uZGVmX3lhd0xlZnQpKQogICAgICAgICAgICAgICAgZWxzZWlmIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLmRlZl95YXcpID09ICJEZWxheSBKaXR0ZXIiIHRoZW4KICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdbMV0sICIxODAiKQogICAgICAgICAgICAgICAgICAgIGlmIGNvdW50ZXIgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIC0tcmlnaHQKICAgICAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzJdLCB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS5kZWZfeWF3UmlnaHQpKQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiBjb3VudGVyID09IDEgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAtLWxlZnQKICAgICAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzJdLCB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS5kZWZfeWF3TGVmdCkpCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmIGNvdW50ZXIgPT0gMiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIC0tbGVmdAogICAgICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdbMl0sIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLmRlZl95YXdMZWZ0KSkKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgY291bnRlciA9PSAzIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgLS1sZWZ0CiAgICAgICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd1syXSwgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0uZGVmX3lhd0xlZnQpKQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiBjb3VudGVyID09IDQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAtLXJpZ2h0CiAgICAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzJdLCB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS5kZWZfeWF3UmlnaHQpKQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiBjb3VudGVyID09IDUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAtLWxlZnQKICAgICAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzJdLCB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS5kZWZfeWF3TGVmdCkpCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmIGNvdW50ZXIgPT0gNiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIC0tcmlnaHQKICAgICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdbMl0sIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLmRlZl95YXdSaWdodCkpCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmIGNvdW50ZXIgPT0gNyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIC0tcmlnaHQKICAgICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdbMl0sIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLmRlZl95YXdSaWdodCkpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgICAgIGVsc2VpZiB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS5kZWZfeWF3KSA9PSAiTCZSIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzFdLCAiMTgwIikKICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdbMl0sKHNpZGUgPT0gMSBhbmQgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0uZGVmX3lhd0xlZnQpIG9yIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLmRlZl95YXdSaWdodCkpKQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd1sxXSwgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0uZGVmX3lhdykpCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzJdLCB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS5kZWZfeWF3U3RhdGljKSkKICAgICAgICAgICAgICAgIGVuZAogICAgCiAgICAKICAgICAgICAgICAgICAgIGlmIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLmRlZl95YXdKaXR0ZXIpID09ICIzLVdheSIgdGhlbgogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd0ppdHRlclsxXSwgIkNlbnRlciIpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgd2F5cyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0uZGVmX3dheUZpcnN0KSwKICAgICAgICAgICAgICAgICAgICAgICAgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0uZGVmX3dheVNlY29uZCksCiAgICAgICAgICAgICAgICAgICAgICAgIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLmRlZl93YXlUaGlyZCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAKICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdKaXR0ZXJbMl0sIHdheXNbKGdsb2JhbHMudGlja2NvdW50KCkgJSAzKSArIDFdICkKICAgICAgICAgICAgICAgIGVsc2VpZiB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS5kZWZfeWF3Sml0dGVyKSA9PSAiTCZSIiB0aGVuIAogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd0ppdHRlclsxXSwgIkNlbnRlciIpCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3Sml0dGVyWzJdLCAoc2lkZSA9PSAxIGFuZCB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS5kZWZfeWF3Sml0dGVyTGVmdCkgb3IgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0uZGVmX3lhd0ppdHRlclJpZ2h0KSkpCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3Sml0dGVyWzFdLCB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS5kZWZfeWF3Sml0dGVyKSkKICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdKaXR0ZXJbMl0sIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLmRlZl95YXdKaXR0ZXJTdGF0aWMpKQogICAgICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0uZGVmX2JvZHlZYXcpID09ICJDdXN0b20gRGVzeW5jIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMuYm9keVlhd1sxXSwgIk9wcG9zaXRlIikKICAgICAgICAgICAgICAgICAgICBhcHBseV9kZXN5bmMoY21kLCB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS5kZWZfZmFrZVlhd0xpbWl0KSkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy5ib2R5WWF3WzFdLCB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS5kZWZfYm9keVlhdykpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAKICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLmJvZHlZYXdbMl0sICh1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS5kZWZfYm9keVlhd1N0YXRpYykpKQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMuZnNCb2R5WWF3LCBmYWxzZSkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgaWYgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0ucGl0Y2gpIH49ICJDdXN0b20iIHRoZW4KICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy5waXRjaFsxXSwgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0ucGl0Y2gpKQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnBpdGNoWzFdLCB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS5waXRjaCkpCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMucGl0Y2hbMl0sIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLnBpdGNoU2xpZGVyKSkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd0Jhc2UsIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLnlhd0Jhc2UpKQoKICAgICAgICAgICAgICAgIGlmIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLnlhdykgPT0gIlNsb3cgSml0dGVyIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzFdLCAiMTgwIikKICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdbMl0sIHN3aXRjaCBhbmQgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0ueWF3UmlnaHQpIG9yIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLnlhd0xlZnQpKQogICAgICAgICAgICAgICAgZWxzZWlmIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLnlhdykgPT0gIkRlbGF5IEppdHRlciIgdGhlbgogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd1sxXSwgIjE4MCIpCiAgICAgICAgICAgICAgICAgICAgaWYgY291bnRlciA9PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgLS1yaWdodAogICAgICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdbMl0sIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLnlhd1JpZ2h0KSkKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgY291bnRlciA9PSAxIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgLS1sZWZ0CiAgICAgICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd1syXSwgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0ueWF3TGVmdCkpCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmIGNvdW50ZXIgPT0gMiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIC0tbGVmdAogICAgICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdbMl0sIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLnlhd0xlZnQpKQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiBjb3VudGVyID09IDMgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAtLWxlZnQKICAgICAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzJdLCB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS55YXdMZWZ0KSkKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgY291bnRlciA9PSA0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgLS1yaWdodAogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd1syXSwgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0ueWF3UmlnaHQpKQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiBjb3VudGVyID09IDUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAtLWxlZnQKICAgICAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzJdLCB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS55YXdMZWZ0KSkKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgY291bnRlciA9PSA2IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgLS1yaWdodAogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd1syXSwgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0ueWF3UmlnaHQpKQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiBjb3VudGVyID09IDcgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAtLXJpZ2h0CiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzJdLCB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS55YXdSaWdodCkpCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgZWxzZWlmIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLnlhdykgPT0gIkwmUiIgdGhlbgogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd1sxXSwgIjE4MCIpCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzJdLChzaWRlID09IDEgYW5kIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLnlhd0xlZnQpIG9yIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLnlhd1JpZ2h0KSkpCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzFdLCB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS55YXcpKQogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd1syXSwgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0ueWF3U3RhdGljKSkKICAgICAgICAgICAgICAgIGVuZAoKCiAgICAgICAgICAgICAgICBpZiB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS55YXdKaXR0ZXIpID09ICIzLVdheSIgdGhlbgogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd0ppdHRlclsxXSwgIkNlbnRlciIpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgd2F5cyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0ud2F5Rmlyc3QpLAogICAgICAgICAgICAgICAgICAgICAgICB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS53YXlTZWNvbmQpLAogICAgICAgICAgICAgICAgICAgICAgICB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS53YXlUaGlyZCkKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd0ppdHRlclsyXSwgd2F5c1soZ2xvYmFscy50aWNrY291bnQoKSAlIDMpICsgMV0gKQogICAgICAgICAgICAgICAgZWxzZWlmIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLnlhd0ppdHRlcikgPT0gIkwmUiIgdGhlbiAKICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdKaXR0ZXJbMV0sICJDZW50ZXIiKQogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd0ppdHRlclsyXSwgKHNpZGUgPT0gMSBhbmQgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0ueWF3Sml0dGVyTGVmdCkgb3IgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0ueWF3Sml0dGVyUmlnaHQpKSkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdKaXR0ZXJbMV0sIHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLnlhd0ppdHRlcikpCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3Sml0dGVyWzJdLCB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS55YXdKaXR0ZXJTdGF0aWMpKQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS5ib2R5WWF3KSA9PSAiQ3VzdG9tIERlc3luYyIgdGhlbgogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLmJvZHlZYXdbMV0sICJPcHBvc2l0ZSIpCiAgICAgICAgICAgICAgICAgICAgYXBwbHlfZGVzeW5jKGNtZCwgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0uZmFrZVlhd0xpbWl0KSkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy5ib2R5WWF3WzFdLCB1aS5nZXQoYWFCdWlsZGVyW3ZhcnMucFN0YXRlXS5ib2R5WWF3KSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMuYm9keVlhd1syXSwgKHVpLmdldChhYUJ1aWxkZXJbdmFycy5wU3RhdGVdLmJvZHlZYXdTdGF0aWMpKSkKICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLmZzQm9keVlhdywgZmFsc2UpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVsc2VpZiBub3QgdWkuZ2V0KGFhQnVpbGRlclt2YXJzLnBTdGF0ZV0uZW5hYmxlU3RhdGUpIHRoZW4KICAgICAgICAgICAgdWkuc2V0KHJlZnMucGl0Y2hbMV0sICJPZmYiKQogICAgICAgICAgICB1aS5zZXQocmVmcy55YXdCYXNlLCAiTG9jYWwgdmlldyIpCiAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd1sxXSwgIk9mZiIpCiAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd1syXSwgMCkKICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3Sml0dGVyWzFdLCAiT2ZmIikKICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3Sml0dGVyWzJdLCAwKQogICAgICAgICAgICB1aS5zZXQocmVmcy5ib2R5WWF3WzFdLCAiT2ZmIikKICAgICAgICAgICAgdWkuc2V0KHJlZnMuYm9keVlhd1syXSwgMCkKICAgICAgICAgICAgdWkuc2V0KHJlZnMuZnNCb2R5WWF3LCBmYWxzZSkKICAgICAgICAgICAgdWkuc2V0KHJlZnMuZWRnZVlhdywgZmFsc2UpCiAgICAgICAgICAgIHVpLnNldChyZWZzLnJvbGwsIDApCiAgICAgICAgZW5kCiAgICBlbHNlaWYgdWkuZ2V0KG1lbnUuYWFUYWIubGVnaXRBQUhvdGtleSkgYW5kIGFhLmlnbm9yZSA9PSBmYWxzZSB0aGVuCiAgICAgICAgaWYgZW50aXR5LmdldF9jbGFzc25hbWUoZW50aXR5LmdldF9wbGF5ZXJfd2VhcG9uKHZhcnMubG9jYWxQbGF5ZXIpKSA9PSAiQ0M0IiB0aGVuIAogICAgICAgICAgICByZXR1cm4gCiAgICAgICAgZW5kCiAgICAKICAgICAgICBsb2NhbCBzaG91bGRfZGlzYWJsZSA9IGZhbHNlCiAgICAgICAgbG9jYWwgcGxhbnRlZF9ib21iID0gZW50aXR5LmdldF9hbGwoIkNQbGFudGVkQzQiKVsxXQogICAgCiAgICAgICAgaWYgcGxhbnRlZF9ib21iIH49IG5pbCB0aGVuCiAgICAgICAgICAgIGJvbWJfZGlzdGFuY2UgPSB2ZWN0b3IoZW50aXR5LmdldF9vcmlnaW4odmFycy5sb2NhbFBsYXllcikpOmRpc3QodmVjdG9yKGVudGl0eS5nZXRfb3JpZ2luKHBsYW50ZWRfYm9tYikpKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgYm9tYl9kaXN0YW5jZSA8PSA2NCBhbmQgZW50aXR5LmdldF9wcm9wKHZhcnMubG9jYWxQbGF5ZXIsICJtX2lUZWFtTnVtIikgPT0gMyB0aGVuCiAgICAgICAgICAgICAgICBzaG91bGRfZGlzYWJsZSA9IHRydWUKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAKICAgICAgICBsb2NhbCBwaXRjaCwgeWF3ID0gY2xpZW50LmNhbWVyYV9hbmdsZXMoKQogICAgICAgIGxvY2FsIGRpcmVjdF92ZWMgPSB2ZWN0b3IoZnVuYy52ZWNfYW5nbGVzKHBpdGNoLCB5YXcpKQogICAgCiAgICAgICAgbG9jYWwgZXllX3BvcyA9IHZlY3RvcihjbGllbnQuZXllX3Bvc2l0aW9uKCkpCiAgICAgICAgbG9jYWwgZnJhY3Rpb24sIGVudCA9IGNsaWVudC50cmFjZV9saW5lKHZhcnMubG9jYWxQbGF5ZXIsIGV5ZV9wb3MueCwgZXllX3Bvcy55LCBleWVfcG9zLnosIGV5ZV9wb3MueCArIChkaXJlY3RfdmVjLnggKiA4MTkyKSwgZXllX3Bvcy55ICsgKGRpcmVjdF92ZWMueSAqIDgxOTIpLCBleWVfcG9zLnogKyAoZGlyZWN0X3ZlYy56ICogODE5MikpCiAgICAKICAgICAgICBpZiBlbnQgfj0gbmlsIGFuZCBlbnQgfj0gLTEgdGhlbgogICAgICAgICAgICBpZiBlbnRpdHkuZ2V0X2NsYXNzbmFtZShlbnQpID09ICJDUHJvcERvb3JSb3RhdGluZyIgdGhlbgogICAgICAgICAgICAgICAgc2hvdWxkX2Rpc2FibGUgPSB0cnVlCiAgICAgICAgICAgIGVsc2VpZiBlbnRpdHkuZ2V0X2NsYXNzbmFtZShlbnQpID09ICJDSG9zdGFnZSIgdGhlbgogICAgICAgICAgICAgICAgc2hvdWxkX2Rpc2FibGUgPSB0cnVlCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIGlmIHNob3VsZF9kaXNhYmxlIH49IHRydWUgdGhlbgogICAgICAgICAgICB1aS5zZXQocmVmcy5waXRjaFsxXSwgIk9mZiIpCiAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd0Jhc2UsICJMb2NhbCB2aWV3IikKICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzFdLCAiT2ZmIikKICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzJdLCAwKQogICAgICAgICAgICB1aS5zZXQocmVmcy55YXdKaXR0ZXJbMV0sICJPZmYiKQogICAgICAgICAgICB1aS5zZXQocmVmcy55YXdKaXR0ZXJbMl0sIDApCiAgICAgICAgICAgIHVpLnNldChyZWZzLmJvZHlZYXdbMV0sICJPcHBvc2l0ZSIpCiAgICAgICAgICAgIHVpLnNldChyZWZzLmZzQm9keVlhdywgdHJ1ZSkKICAgICAgICAgICAgdWkuc2V0KHJlZnMuZWRnZVlhdywgZmFsc2UpCiAgICAgICAgICAgIHVpLnNldChyZWZzLnJvbGwsIDApCiAgICAKICAgICAgICAgICAgY21kLmluX3VzZSA9IDAKICAgICAgICAgICAgY21kLnJvbGwgPSAwCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICAKICAgLS0gQXZvaWQgYmFja3N0YWIKICAgbG9jYWwgc2VsZiA9IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkKCiAgIGxvY2FsIHBsYXllcnMgPSBlbnRpdHkuZ2V0X3BsYXllcnModHJ1ZSkKICAgbG9jYWwgZXllX3gsIGV5ZV95LCBleWVfeiA9IGNsaWVudC5leWVfcG9zaXRpb24oKQogICByZXR1cm50aGF0ID0gZmFsc2UgCiAgIGlmIHVpLmdldChtZW51Lm1pc2NUYWIuQXZvaWRCYWNrKSB+PSAwIHRoZW4KICAgICAgIGlmIHBsYXllcnMgfj0gbmlsIHRoZW4KICAgICAgICAgICBmb3IgaSwgZW5lbXkgaW4gcGFpcnMocGxheWVycykgZG8KICAgICAgICAgICAgICAgbG9jYWwgaGVhZF94LCBoZWFkX3ksIGhlYWRfeiA9IGVudGl0eS5oaXRib3hfcG9zaXRpb24ocGxheWVyc1tpXSwgNSkKICAgICAgICAgICAgICAgbG9jYWwgd3gsIHd5ID0gcmVuZGVyZXIud29ybGRfdG9fc2NyZWVuKGhlYWRfeCwgaGVhZF95LCBoZWFkX3opCiAgICAgICAgICAgICAgIGxvY2FsIGZyYWN0aW9ucywgZW50aW5kZXhfaGl0ID0gY2xpZW50LnRyYWNlX2xpbmUoc2VsZiwgZXllX3gsIGV5ZV95LCBleWVfeiwgaGVhZF94LCBoZWFkX3ksIGhlYWRfeikKICAgCiAgICAgICAgICAgICAgIGlmIDI1MCA+PSB2ZWN0b3IoZW50aXR5LmdldF9wcm9wKGVuZW15LCAnbV92ZWNPcmlnaW4nKSk6ZGlzdCh2ZWN0b3IoZW50aXR5LmdldF9wcm9wKHNlbGYsICdtX3ZlY09yaWdpbicpKSkgYW5kIGVudGl0eS5pc19hbGl2ZShlbmVteSkgYW5kIGVudGl0eS5nZXRfcGxheWVyX3dlYXBvbihlbmVteSkgfj0gbmlsIGFuZCBlbnRpdHkuZ2V0X2NsYXNzbmFtZShlbnRpdHkuZ2V0X3BsYXllcl93ZWFwb24oZW5lbXkpKSA9PSAnQ0tuaWZlJyBhbmQgKGVudGluZGV4X2hpdCA9PSBwbGF5ZXJzW2ldIG9yIGZyYWN0aW9ucyA9PSAxKSBhbmQgbm90IGVudGl0eS5pc19kb3JtYW50KHBsYXllcnNbaV0pIHRoZW4KICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd1syXSwgMTgwKQogICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3QmFzZSwgIkF0IHRhcmdldHMiKQogICAgICAgICAgICAgICAgICAgcmV0dXJudGhhdCA9IHRydWUKICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgZW5kCiAgICAgICBlbmQKICAgZW5kCgogICAgLS0gZnJlZXN0YW5kCiAgICBpZiAoIHVpLmdldChtZW51LmFhVGFiLmZyZWVzdGFuZEhvdGtleSkgYW5kIHVpLmdldChtZW51LmFhVGFiLmZyZWVzdGFuZCkpIHRoZW4KICAgICAgICBpZiBtYW51YWxzT3ZlckZzID09IHRydWUgYW5kIGFhLmlnbm9yZSA9PSB0cnVlIHRoZW4KICAgICAgICAgICAgdWkuc2V0KHJlZnMuZnJlZVN0YW5kWzJdLCAiT24gaG90a2V5IikKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZWxzZQogICAgICAgICAgICBpZiB1aS5nZXQobWVudS5hYVRhYi5mcmVlc3RhbmQpID09ICJTdGF0aWMiIHRoZW4KICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLmJvZHlZYXdbMV0sICJPZmYiKQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMucGl0Y2hbMV0sICJEb3duIikKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHVpLnNldChyZWZzLmZyZWVTdGFuZFsyXSwgIkFsd2F5cyBvbiIpCiAgICAgICAgICAgIHVpLnNldChyZWZzLmZyZWVTdGFuZFsxXSwgdHJ1ZSkKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICB1aS5zZXQocmVmcy5mcmVlU3RhbmRbMV0sIGZhbHNlKQogICAgICAgIHVpLnNldChyZWZzLmZyZWVTdGFuZFsyXSwgIk9uIGhvdGtleSIpCiAgICBlbmQKICAgIAogICAgLS0gZmFzdCBsYWRkZXIKICAgIGxvY2FsIHBpdGNoLCB5YXcgPSBjbGllbnQuY2FtZXJhX2FuZ2xlcygpCiAgICBpZiBlbnRpdHkuZ2V0X3Byb3AodmFycy5sb2NhbFBsYXllciwgIm1fTW92ZVR5cGUiKSA9PSA5IHRoZW4KICAgICAgICBjbWQueWF3ID0gbWF0aC5mbG9vcihjbWQueWF3KzAuNSkKICAgICAgICBjbWQucm9sbCA9IDAKCiAgICAgICAgaWYgdWkuZ2V0KG1lbnUubWlzY1RhYi5mYXN0TGFkZGVyKSB0aGVuCiAgICAgICAgICAgIGlmIGNtZC5mb3J3YXJkbW92ZSA+IDAgdGhlbgogICAgICAgICAgICAgICAgaWYgcGl0Y2ggPCA0NSB0aGVuCiAgICAgICAgICAgICAgICAgICAgY21kLnBpdGNoID0gODkKICAgICAgICAgICAgICAgICAgICBjbWQuaW5fbW92ZXJpZ2h0ID0gMQogICAgICAgICAgICAgICAgICAgIGNtZC5pbl9tb3ZlbGVmdCA9IDAKICAgICAgICAgICAgICAgICAgICBjbWQuaW5fZm9yd2FyZCA9IDAKICAgICAgICAgICAgICAgICAgICBjbWQuaW5fYmFjayA9IDEKICAgICAgICAgICAgICAgICAgICBpZiBjbWQuc2lkZW1vdmUgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGNtZC55YXcgPSBjbWQueWF3ICsgOTAKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBjbWQuc2lkZW1vdmUgPCAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgY21kLnlhdyA9IGNtZC55YXcgKyAxNTAKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBjbWQuc2lkZW1vdmUgPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgY21kLnlhdyA9IGNtZC55YXcgKyAzMAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kIAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAoKCiAgICBpZiB1aS5nZXQobWVudS5idWlsZGVyVGFiLnNhZmVLbmlmZSkgYW5kIHZhcnMucFN0YXRlID09IDcgYW5kIGVudGl0eS5nZXRfY2xhc3NuYW1lKGVudGl0eS5nZXRfcGxheWVyX3dlYXBvbih2YXJzLmxvY2FsUGxheWVyKSkgPT0gIkNLbmlmZSIgdGhlbgogICAgICAgIHVpLnNldChyZWZzLnBpdGNoWzFdLCAiTWluaW1hbCIpCiAgICAgICAgdWkuc2V0KHJlZnMueWF3QmFzZSwgIkF0IHRhcmdldHMiKQogICAgICAgIHVpLnNldChyZWZzLnlhd1sxXSwgIjE4MCIpCiAgICAgICAgdWkuc2V0KHJlZnMueWF3WzJdLCAwKQogICAgICAgIHVpLnNldChyZWZzLnlhd0ppdHRlclsxXSwgIk9mZnNldCIpCiAgICAgICAgdWkuc2V0KHJlZnMueWF3Sml0dGVyWzJdLCAwKQogICAgICAgIHVpLnNldChyZWZzLmJvZHlZYXdbMV0sICJTdGF0aWMiKQogICAgICAgIHVpLnNldChyZWZzLmJvZHlZYXdbMl0sIDApCiAgICAgICAgdWkuc2V0KHJlZnMuZnNCb2R5WWF3LCBmYWxzZSkKICAgICAgICB1aS5zZXQocmVmcy5lZGdlWWF3LCBmYWxzZSkKICAgICAgICB1aS5zZXQocmVmcy5yb2xsLCAwKQogICAgZW5kCiAgICAKICAgIGlmIHVpLmdldChtZW51LmJ1aWxkZXJUYWIuc2FmZVpldXMpIGFuZCB2YXJzLnBTdGF0ZSA9PSA3IGFuZCBlbnRpdHkuZ2V0X2NsYXNzbmFtZShlbnRpdHkuZ2V0X3BsYXllcl93ZWFwb24odmFycy5sb2NhbFBsYXllcikpID09ICJDV2VhcG9uVGFzZXIiIHRoZW4KICAgICAgICB1aS5zZXQocmVmcy5waXRjaFsxXSwgIkRvd24iKQogICAgICAgIHVpLnNldChyZWZzLnlhd0Jhc2UsICJBdCB0YXJnZXRzIikKICAgICAgICB1aS5zZXQocmVmcy55YXdbMV0sICIxODAiKQogICAgICAgIHVpLnNldChyZWZzLnlhd1syXSwgMCkKICAgICAgICB1aS5zZXQocmVmcy55YXdKaXR0ZXJbMV0sICJPZmYiKQogICAgICAgIHVpLnNldChyZWZzLnlhd0ppdHRlclsyXSwgMCkKICAgICAgICB1aS5zZXQocmVmcy5ib2R5WWF3WzFdLCAiU3RhdGljIikKICAgICAgICB1aS5zZXQocmVmcy5ib2R5WWF3WzJdLCAwKQogICAgICAgIHVpLnNldChyZWZzLmZzQm9keVlhdywgZmFsc2UpCiAgICAgICAgdWkuc2V0KHJlZnMuZWRnZVlhdywgZmFsc2UpCiAgICAgICAgdWkuc2V0KHJlZnMucm9sbCwgMCkKZW5kCgplbmQpCgpsb2NhbCBsZWdzU2F2ZWQgPSBmYWxzZQpsb2NhbCBsZWdzVHlwZXMgPSB7WzFdID0gIk9mZiIsIFsyXSA9ICJBbHdheXMgc2xpZGUiLCBbM10gPSAiTmV2ZXIgc2xpZGUifQpsb2NhbCBncm91bmRfdGlja3MgPSAwCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInByZV9yZW5kZXIiLCBmdW5jdGlvbigpCiAgICBpZiBub3QgZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSB0aGVuIHJldHVybiBlbmQKICAgIGxvY2FsIGZsYWdzID0gZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX2ZGbGFncyIpCiAgICBncm91bmRfdGlja3MgPSBiaXQuYmFuZChmbGFncywgMSkgPT0gMCBhbmQgMCBvciAoZ3JvdW5kX3RpY2tzIDwgNSBhbmQgZ3JvdW5kX3RpY2tzICsgMSBvciBncm91bmRfdGlja3MpCiAgICAKCiAgICBpZiBmdW5jLnRhYmxlX2NvbnRhaW5zKHVpLmdldChtZW51Lm1pc2NUYWIuYW5pbWF0aW9ucyksICJTdGF0aWMgbGVncyIpIHRoZW4KICAgICAgICBlbnRpdHkuc2V0X3Byb3AoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSwgIm1fZmxQb3NlUGFyYW1ldGVyIiwgMSwgNikgCiAgICBlbmQKCiAgICBpZiBmdW5jLnRhYmxlX2NvbnRhaW5zKHVpLmdldChtZW51Lm1pc2NUYWIuYW5pbWF0aW9ucyksICJCcm9rZW4iKSB0aGVuCiAgICAgICAgZW50aXR5LnNldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX2ZsUG9zZVBhcmFtZXRlciIsIG1hdGgucmFuZG9tKDAsIDEwKS8xMCwgMykKICAgICAgICBlbnRpdHkuc2V0X3Byb3AoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSwgIm1fZmxQb3NlUGFyYW1ldGVyIiwgbWF0aC5yYW5kb20oMCwgMTApLzEwLCA3KQogICAgICAgIGVudGl0eS5zZXRfcHJvcChlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCAibV9mbFBvc2VQYXJhbWV0ZXIiLCBtYXRoLnJhbmRvbSgwLCAxMCkvMTAsIDYpCiAgICBlbmQKCiAgICBpZiBmdW5jLnRhYmxlX2NvbnRhaW5zKHVpLmdldChtZW51Lm1pc2NUYWIuYW5pbWF0aW9ucyksICJMZWcgZnVja2VyIikgdGhlbgogICAgICAgIGlmIG5vdCBsZWdzU2F2ZWQgdGhlbgogICAgICAgICAgICBsZWdzU2F2ZWQgPSB1aS5nZXQocmVmcy5sZWdNb3ZlbWVudCkKICAgICAgICBlbmQKICAgICAgICB1aS5zZXRfdmlzaWJsZShyZWZzLmxlZ01vdmVtZW50LCBmYWxzZSkKICAgICAgICBpZiBmdW5jLnRhYmxlX2NvbnRhaW5zKHVpLmdldChtZW51Lm1pc2NUYWIuYW5pbWF0aW9ucyksICJMZWcgZnVja2VyIikgdGhlbgogICAgICAgICAgICB1aS5zZXQocmVmcy5sZWdNb3ZlbWVudCwgbGVnc1R5cGVzW21hdGgucmFuZG9tKDEsIDMpXSkKICAgICAgICAgICAgZW50aXR5LnNldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX2ZsUG9zZVBhcmFtZXRlciIsIDksICAwKQogICAgICAgIGVuZAoKICAgIGVsc2VpZiAobGVnc1NhdmVkID09ICJPZmYiIG9yIGxlZ3NTYXZlZCA9PSAiQWx3YXlzIHNsaWRlIiBvciBsZWdzU2F2ZWQgPT0gIk5ldmVyIHNsaWRlIikgdGhlbgogICAgICAgIHVpLnNldF92aXNpYmxlKHJlZnMubGVnTW92ZW1lbnQsIHRydWUpCiAgICAgICAgdWkuc2V0KHJlZnMubGVnTW92ZW1lbnQsIGxlZ3NTYXZlZCkKICAgICAgICBsZWdzU2F2ZWQgPSBmYWxzZQogICAgZW5kCgogICAgaWYgZnVuYy50YWJsZV9jb250YWlucyh1aS5nZXQobWVudS5taXNjVGFiLmFuaW1hdGlvbnMpLCAiMCBwaXRjaCBvbiBsYW5kaW5nIikgdGhlbgogICAgICAgIGdyb3VuZF90aWNrcyA9IGJpdC5iYW5kKGZsYWdzLCAxKSA9PSAxIGFuZCBncm91bmRfdGlja3MgKyAxIG9yIDAKCiAgICAgICAgaWYgZ3JvdW5kX3RpY2tzID4gMjAgYW5kIGdyb3VuZF90aWNrcyA8IDE1MCB0aGVuCiAgICAgICAgICAgIGVudGl0eS5zZXRfcHJvcChlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCAibV9mbFBvc2VQYXJhbWV0ZXIiLCAwLjUsIDEyKQogICAgICAgIGVuZAogICAgZW5kCgogICAgaWYgZnVuYy50YWJsZV9jb250YWlucyh1aS5nZXQobWVudS5taXNjVGFiLmFuaW1hdGlvbnMpLCAiTW9vbndhbGsiKSB0aGVuCiAgICAgICAgaWYgbm90IGxlZ3NTYXZlZCB0aGVuCiAgICAgICAgICAgIGxlZ3NTYXZlZCA9IHVpLmdldChyZWZzLmxlZ01vdmVtZW50KQogICAgICAgIGVuZAogICAgICAgIHVpLnNldF92aXNpYmxlKHJlZnMubGVnTW92ZW1lbnQsIGZhbHNlKQogICAgICAgIGVudGl0eS5zZXRfcHJvcChlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCAibV9mbFBvc2VQYXJhbWV0ZXIiLCAwLCA3KQogICAgICAgIGxvY2FsIG1lID0gZW50LmdldF9sb2NhbF9wbGF5ZXIoKQogICAgICAgIGxvY2FsIGZsYWdzID0gbWU6Z2V0X3Byb3AoIm1fZkZsYWdzIikKICAgICAgICBsb2NhbCBvbmdyb3VuZCA9IGJpdC5iYW5kKGZsYWdzLCAxKSB+PSAwCiAgICAgICAgaWYgbm90IG9uZ3JvdW5kIHRoZW4KICAgICAgICAgICAgbG9jYWwgbXlfYW5pbWxheWVyID0gbWU6Z2V0X2FuaW1fb3ZlcmxheSg2KSAtLSBNT1ZFTUVOVF9NT1ZFCiAgICAgICAgICAgIG15X2FuaW1sYXllci53ZWlnaHQgPSAxCiAgICAgICAgZW5kCiAgICAgICAgdWkuc2V0KHJlZnMubGVnTW92ZW1lbnQsICJPZmYiKQogICAgZWxzZWlmIChsZWdzU2F2ZWQgPT0gIk9mZiIgb3IgbGVnc1NhdmVkID09ICJBbHdheXMgc2xpZGUiIG9yIGxlZ3NTYXZlZCA9PSAiTmV2ZXIgc2xpZGUiKSB0aGVuCiAgICAgICAgdWkuc2V0X3Zpc2libGUocmVmcy5sZWdNb3ZlbWVudCwgdHJ1ZSkKICAgICAgICB1aS5zZXQocmVmcy5sZWdNb3ZlbWVudCwgbGVnc1NhdmVkKQogICAgICAgIGxlZ3NTYXZlZCA9IGZhbHNlCiAgICBlbmQKCiAgICBpZiBub3QgdWkuZ2V0KG1lbnUubWlzY1RhYi5hbmltYXRpb25zRW5hYmxlZCkgdGhlbgogICAgICAgIHJldHVybgogICAgZW5kCiAgICAKZW5kKQotLSBAcmVnaW9uIEFBX0NBTExCQUNLUyBlbmQKCi0tIEByZWdpb24gSU5ESUNBVE9SUyBzdGFydApsb2NhbCBhbHBoYSA9IDAKbG9jYWwgc2NvcGVkRnJhY3Rpb24gPSAwCmxvY2FsIGFjYXRlbFNjb3BlZCA9IDEKbG9jYWwgZHRNb2RpZmllciA9IDAKbG9jYWwgYmFyTW92ZVkgPSAwCgpsb2NhbCBhY3RpdmVGcmFjdGlvbiA9IDAKbG9jYWwgaW5hY3RpdmVGcmFjdGlvbiA9IDAKbG9jYWwgZGVmZW5zaXZlRnJhY3Rpb24gPSAwCmxvY2FsIGhpZGVGcmFjdGlvbiA9IDAKbG9jYWwgaGlkZUluYWN0aXZlRnJhY3Rpb24gPSAwCmxvY2FsIGR0UG9zID0ge3kgPSAwfQpsb2NhbCBvc1BvcyA9IHt5ID0gMH0KCmxvY2FsIG1haW5JbmRDbHIgPSB7ciA9IDAsIGcgPSAwLCBiID0gMCwgYSA9IDB9CmxvY2FsIGR0Q2xyID0ge3IgPSAwLCBnID0gMCwgYiA9IDAsIGEgPSAwfQpsb2NhbCBjaGFyZ2VDbHIgPSB7ciA9IDAsIGcgPSAwLCBiID0gMCwgYSA9IDB9CmxvY2FsIGNoYXJnZUluZCA9IHt3ID0gMCwgeCA9IDAsIHkgPSAyNX0KbG9jYWwgcHNDbHIgPSB7ciA9IDAsIGcgPSAwLCBiID0gMCwgYSA9IDB9CmxvY2FsIGR0SW5kID0ge3cgPSAwLCB4ID0gMCwgeSA9IDI1fQpsb2NhbCBxcEluZCA9IHt3ID0gMCwgeCA9IDAsIHkgPSAyNSwgYSA9IDB9CmxvY2FsIGZkSW5kID0ge3cgPSAwLCB4ID0gMCwgeSA9IDI1LCBhID0gMH0KbG9jYWwgc3BJbmQgPSB7dyA9IDAsIHggPSAwLCB5ID0gMjUsIGEgPSAwfQpsb2NhbCBiYUluZCA9IHt3ID0gMCwgeCA9IDAsIHkgPSAyNSwgYSA9IDB9CmxvY2FsIGZzSW5kID0ge3cgPSAwLCB4ID0gMCwgeSA9IDI1LCBhID0gMH0KbG9jYWwgb3NJbmQgPSB7dyA9IDAsIHggPSAwLCB5ID0gMjUsIGEgPSAwfQpsb2NhbCBwc0luZCA9IHt3ID0gMCwgeCA9IDAsIHkgPSAyNX0KbG9jYWwgd0FscGhhID0gMApsb2NhbCBpbnRlcnZhbCA9IDAKCmxvY2FsIGluZGljYXRvcnNfdGFibGUgPSB7fQoKbG9jYWwgemFsdXBhID0gZnVuY3Rpb24oaW5kaWNhdG9yKQogICAgbG9jYWwgaXNfZGVmZW5zaXZlID0gKHZhcnMuYnJlYWtlci5kZWZlbnNpdmUgPiAxKQogICAgaWYgaW5kaWNhdG9yLnRleHQgPT0gJ0RUJyB0aGVuCiAgICAgICAgaWYgaXNfZGVmZW5zaXZlIHRoZW4KICAgICAgICAgICAgaW5kaWNhdG9yLnIgPSAxMzAKICAgICAgICAgICAgaW5kaWNhdG9yLmcgPSAxOTUKICAgICAgICAgICAgaW5kaWNhdG9yLmIgPSAyMAogICAgICAgIGVuZAogICAgZW5kCgogICAgaW5kaWNhdG9yc190YWJsZVsjaW5kaWNhdG9yc190YWJsZSArIDFdID0gaW5kaWNhdG9yCmVuZAoKY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygicGFpbnQiLCBmdW5jdGlvbigpCiAgICBsb2NhbCBsb2NhbF9wbGF5ZXIgPSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpCiAgICAgICAgdmFycy5sb2NhbFBsYXllciA9IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkKICAgIGlmIGxvY2FsX3BsYXllciA9PSBuaWwgb3IgZW50aXR5LmlzX2FsaXZlKGxvY2FsX3BsYXllcikgPT0gZmFsc2UgdGhlbiByZXR1cm4gZW5kCiAgICBsb2NhbCBzaXplWCwgc2l6ZVkgPSBjbGllbnQuc2NyZWVuX3NpemUoKQogICAgbG9jYWwgd2VhcG9uID0gZW50aXR5LmdldF9wbGF5ZXJfd2VhcG9uKGxvY2FsX3BsYXllcikKICAgIGxvY2FsIGJvZHlZYXcgPSBlbnRpdHkuZ2V0X3Byb3AobG9jYWxfcGxheWVyLCAibV9mbFBvc2VQYXJhbWV0ZXIiLCAxMSkgKiAxMjAgLSA2MAogICAgbG9jYWwgc2lkZSA9IGJvZHlZYXcgPiAwIGFuZCAxIG9yIC0xCiAgICBsb2NhbCBzdGF0ZSA9ICJNT1ZJTkciCiAgICBsb2NhbCBtYWluQ2xyID0ge30KICAgIG1haW5DbHIuciwgbWFpbkNsci5nLCBtYWluQ2xyLmIsIG1haW5DbHIuYSA9IHVpLmdldChtZW51LnZpc3VhbHNUYWIuaW5kaWNhdG9yc0NscikKICAgIGxvY2FsIGFycm93Q2xyID0ge30KICAgIGFycm93Q2xyLnIsIGFycm93Q2xyLmcsIGFycm93Q2xyLmIsIGFycm93Q2xyLmEgPSB1aS5nZXQobWVudS52aXN1YWxzVGFiLmFycm93Q2xyKQogICAgbG9jYWwgZmFrZSA9IG1hdGguZmxvb3IoYW50aWFpbV9mdW5jcy5nZXRfZGVzeW5jKDEpKQogICAgCiAgICAtLSBkcmF3IGFycm93cwoKICAgIGlmIHVpLmdldChtZW51LnZpc3VhbHNUYWIuYXJyb3dzaW5kZW5iKSBhbmQgdWkuZ2V0KG1lbnUudmlzdWFsc1RhYi5hcnJvd0luZGljYXRvclN0eWxlKSA9PSAiVHJpYW5nbGUiIHRoZW4KICAgICAgICByZW5kZXJlci50cmlhbmdsZShzaXplWCAvIDIgKyA0MCwgc2l6ZVkgLyAyICsgMSwgc2l6ZVggLyAyICsgMzAsIHNpemVZIC8gMiAtIDYsIHNpemVYIC8gMiArIDMwLCBzaXplWSAvIDIgKyA3LCAKICAgICAgICBhYS5tYW51YWxBQSA9PSAyIGFuZCBhcnJvd0Nsci5yIG9yIDAsIAogICAgICAgIGFhLm1hbnVhbEFBID09IDIgYW5kIGFycm93Q2xyLmcgb3IgMCwgCiAgICAgICAgYWEubWFudWFsQUEgPT0gMiBhbmQgYXJyb3dDbHIuYiBvciAwLCAKICAgICAgICBhYS5tYW51YWxBQSA9PSAyIGFuZCBhcnJvd0Nsci5hIG9yIDE2MCkKCiAgICAgICAgcmVuZGVyZXIudHJpYW5nbGUoc2l6ZVggLyAyIC0gNDAsIHNpemVZIC8gMiArIDEsIHNpemVYIC8gMiAtIDMwLCBzaXplWSAvIDIgLSA2LCBzaXplWCAvIDIgLSAzMCwgc2l6ZVkgLyAyICsgNywgCiAgICAgICAgYWEubWFudWFsQUEgPT0gMSBhbmQgYXJyb3dDbHIuciBvciAwLCAKICAgICAgICBhYS5tYW51YWxBQSA9PSAxIGFuZCBhcnJvd0Nsci5nIG9yIDAsIAogICAgICAgIGFhLm1hbnVhbEFBID09IDEgYW5kIGFycm93Q2xyLmIgb3IgMCwgCiAgICAgICAgYWEubWFudWFsQUEgPT0gMSBhbmQgYXJyb3dDbHIuYSBvciAxNjApCiAgICBlbmQKCiAgICBpZiB1aS5nZXQobWVudS52aXN1YWxzVGFiLmFycm93c2luZGVuYikgYW5kIHVpLmdldChtZW51LnZpc3VhbHNUYWIuYXJyb3dJbmRpY2F0b3JTdHlsZSkgID09ICJTdGFuZGFydCIgdGhlbgogICAgICAgIGFscGhhID0gKGFhLm1hbnVhbEFBID09IDIgb3IgYWEubWFudWFsQUEgPT0gMSkgYW5kIGZ1bmMubGVycChhbHBoYSwgMjU1LCBnbG9iYWxzLmZyYW1ldGltZSgpICogMjApIG9yIGZ1bmMubGVycChhbHBoYSwgMCwgZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDIwKQogICAgICAgIHJlbmRlcmVyLnRleHQoc2l6ZVggLyAyICsgNjAsIHNpemVZIC8gMiAtIDIuNSwgYWEubWFudWFsQUEgPT0gMiBhbmQgYXJyb3dDbHIuciBvciAwLCBhYS5tYW51YWxBQSA9PSAyIGFuZCBhcnJvd0Nsci5nIG9yIDAsIGFhLm1hbnVhbEFBID09IDIgYW5kIGFycm93Q2xyLmIgb3IgMCwgYWEubWFudWFsQUEgPT0gMiBhbmQgYXJyb3dDbHIuYSBvciAxNjAsICJjKyIsIDAsICfirp4nKQogICAgICAgIHJlbmRlcmVyLnRleHQoc2l6ZVggLyAyIC0gNjAsIHNpemVZIC8gMiAtIDIuNSwgYWEubWFudWFsQUEgPT0gMSBhbmQgYXJyb3dDbHIuciBvciAwLCBhYS5tYW51YWxBQSA9PSAxIGFuZCBhcnJvd0Nsci5nIG9yIDAsIGFhLm1hbnVhbEFBID09IDEgYW5kIGFycm93Q2xyLmIgb3IgMCwgYWEubWFudWFsQUEgPT0gMSBhbmQgYXJyb3dDbHIuYSBvciAxNjAsICJjKyIsIDAsICfirpwnKQogICAgZW5kCiAgICAKICAgIAogICAgLS0gbW92ZSBvbiBzY29wZQogICAgbG9jYWwgc2NvcGVMZXZlbCA9IGVudGl0eS5nZXRfcHJvcCh3ZWFwb24sICdtX3pvb21MZXZlbCcpCiAgICBsb2NhbCBzY29wZWQgPSBlbnRpdHkuZ2V0X3Byb3AobG9jYWxfcGxheWVyLCAnbV9iSXNTY29wZWQnKSA9PSAxCiAgICBsb2NhbCByZXN1bWVab29tID0gZW50aXR5LmdldF9wcm9wKGxvY2FsX3BsYXllciwgJ21fYlJlc3VtZVpvb20nKSA9PSAxCiAgICBsb2NhbCBpc1ZhbGlkID0gd2VhcG9uIH49IG5pbCBhbmQgc2NvcGVMZXZlbCB+PSBuaWwKICAgIGxvY2FsIGFjdCA9IGlzVmFsaWQgYW5kIHNjb3BlTGV2ZWwgPiAwIGFuZCBzY29wZWQgYW5kIG5vdCByZXN1bWVab29tCiAgICBsb2NhbCB0aW1lID0gZ2xvYmFscy5mcmFtZXRpbWUoKSAqIDMwCgogICAgaWYgYWN0IHRoZW4KICAgICAgICBpZiBzY29wZWRGcmFjdGlvbiA8IDEgdGhlbgogICAgICAgICAgICBzY29wZWRGcmFjdGlvbiA9IGZ1bmMubGVycChzY29wZWRGcmFjdGlvbiwgMSArIDAuMSwgdGltZSkKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNjb3BlZEZyYWN0aW9uID0gMQogICAgICAgIGVuZAogICAgZWxzZQogICAgICAgIHNjb3BlZEZyYWN0aW9uID0gZnVuYy5sZXJwKHNjb3BlZEZyYWN0aW9uLCAwLCB0aW1lKQogICAgZW5kCgogICAgLS0gZHJhdyBpbmRpY2F0b3JzCiAgICBsb2NhbCBkcGkgPSB1aS5nZXQodWkucmVmZXJlbmNlKCJNSVNDIiwgIlNldHRpbmdzIiwgIkRQSSBzY2FsZSIpKTpnc3ViKCclJScsICcnKSAtIDEwMAogICAgbG9jYWwgZ2xvYmFsRmxhZyA9ICJjZC0iCiAgICBsb2NhbCBnbG9iYWxNb3ZlWSA9IDAKICAgIGxvY2FsIGluZFgsIGluZFkgPSByZW5kZXJlci5tZWFzdXJlX3RleHQoZ2xvYmFsRmxhZywgIkRUIikKICAgIGxvY2FsIHlEZWZhdWx0ID0gMTYKICAgIGxvY2FsIGluZENvdW50ID0gMAogICAgaW5kWSA9IGdsb2JhbEZsYWcgPT0gImNkLSIgYW5kIGluZFkgLSAzIG9yIGluZFkgLSAyCgogICAgbG9jYWwgbmV4dEF0dGFjayA9IGVudGl0eS5nZXRfcHJvcCh2YXJzLmxvY2FsUGxheWVyLCAibV9mbE5leHRBdHRhY2siKQogICAgbG9jYWwgbmV4dFByaW1hcnlBdHRhY2sgPSBlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9wbGF5ZXJfd2VhcG9uKHZhcnMubG9jYWxQbGF5ZXIpLCAibV9mbE5leHRQcmltYXJ5QXR0YWNrIikKICAgIGxvY2FsIGR0QWN0aXZlID0gZmFsc2UKICAgIGlmIG5leHRQcmltYXJ5QXR0YWNrIH49IG5pbCB0aGVuCiAgICAgICAgZHRBY3RpdmUgPSBub3QgKG1hdGgubWF4KG5leHRQcmltYXJ5QXR0YWNrLCBuZXh0QXR0YWNrKSA+IGdsb2JhbHMuY3VydGltZSgpKQogICAgZW5kCiAgICBsb2NhbCBpc0NoYXJnZWQgPSBkdEFjdGl2ZQogICAgbG9jYWwgaXNGcyA9IHVpLmdldChtZW51LmFhVGFiLmZyZWVzdGFuZEhvdGtleSkKICAgIGxvY2FsIGlzQmEgPSB1aS5nZXQocmVmcy5mb3JjZUJhaW0pCiAgICBsb2NhbCBpc1NwID0gdWkuZ2V0KHJlZnMuc2FmZVBvaW50KQogICAgbG9jYWwgaXNRcCA9IHVpLmdldChyZWZzLnF1aWNrUGVla1syXSkKICAgIGxvY2FsIGlzU2xvdyA9IHVpLmdldChyZWZzLnNsb3dbMV0pIGFuZCB1aS5nZXQocmVmcy5zbG93WzJdKQogICAgbG9jYWwgaXNPcyA9IHVpLmdldChyZWZzLm9zWzFdKSBhbmQgdWkuZ2V0KHJlZnMub3NbMl0pCiAgICBsb2NhbCBpc0ZkID0gdWkuZ2V0KHJlZnMuZmFrZUR1Y2spCiAgICBsb2NhbCBpc0R0ID0gdWkuZ2V0KHJlZnMuZHRbMV0pIGFuZCB1aS5nZXQocmVmcy5kdFsyXSkKCiAgICBsb2NhbCBzdGF0ZSA9IHZhcnMuaW50VG9TW3ZhcnMucFN0YXRlXTp1cHBlcigpCgogICAgCgogICAgaWYgdWkuZ2V0KG1lbnUudmlzdWFsc1RhYi5pbmRpY2F0b3JzVHlwZSkgdGhlbgogICAgICAgIGxvY2FsIHN0cmlrZV93LCBzdHJpa2VfaCA9IHJlbmRlcmVyLm1lYXN1cmVfdGV4dCgiY2RiIiwgbHVhX25hbWUgKQogICAgICAgIGxvY2FsIGxvZ28gPSBhbmltYXRlX3RleHQoZ2xvYmFscy5jdXJ0aW1lKCksIGx1YV9uYW1lLCBtYWluQ2xyLnIsIG1haW5DbHIuZywgbWFpbkNsci5iLCAyNTUpCgogICAgICAgIGdsb3dfbW9kdWxlKHNpemVYLzIgKyAoKHN0cmlrZV93KS8yKSAqIHNjb3BlZEZyYWN0aW9uIC0gc3RyaWtlX3cvMiArIDIsIHNpemVZLzIgKyAyMCAtIGRwaS8xMCwgc3RyaWtlX3cgLSAzLCAwLCAxMCwgMCwge21haW5DbHIuciwgbWFpbkNsci5nLCBtYWluQ2xyLmIsIDEwMCAqIG1hdGguYWJzKG1hdGguY29zKGdsb2JhbHMuY3VydGltZSgpKjIpKX0sIHttYWluQ2xyLnIsIG1haW5DbHIuZywgbWFpbkNsci5iLCAxMDAgKiBtYXRoLmFicyhtYXRoLmNvcyhnbG9iYWxzLmN1cnRpbWUoKSoyKSl9KQogICAgICAgIHJlbmRlcmVyLnRleHQoc2l6ZVgvMiArICgoc3RyaWtlX3cgKyAyKS8yKSAqIHNjb3BlZEZyYWN0aW9uLCBzaXplWS8yICsgMjAgLSBkcGkvMTAsIDE1NSwgMCwgMCwgMCwgImNkYiIsIG5pbCwgdW5wYWNrKGxvZ28pKQoKICAgICAgICBsb2NhbCBjb3VudCA9IDAKCiAgICAgICAgaWYgaXNEdCBhbmQgZHRBY3RpdmUgYW5kIGlzRGVmZW5zaXZlID09IGZhbHNlIHRoZW4KICAgICAgICAgICAgYWN0aXZlRnJhY3Rpb24gPSBmdW5jLmNsYW1wKGFjdGl2ZUZyYWN0aW9uICsgZ2xvYmFscy5mcmFtZXRpbWUoKS8wLjE1LCAwLCAxKQogICAgICAgICAgICBpZiBkdFBvcy55IDwgaW5kWSAqIGNvdW50IHRoZW4KICAgICAgICAgICAgICAgIGR0UG9zLnkgPSBmdW5jLmxlcnAoZHRQb3MueSwgaW5kWSAqIGNvdW50ICsgMC4xLCB0aW1lKQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBkdFBvcy55ID0gaW5kWSAqIGNvdW50CiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBjb3VudCA9IGNvdW50ICsgMQogICAgICAgIGVsc2UKICAgICAgICAgICAgYWN0aXZlRnJhY3Rpb24gPSBmdW5jLmNsYW1wKGFjdGl2ZUZyYWN0aW9uIC0gZ2xvYmFscy5mcmFtZXRpbWUoKS8wLjE1LCAwLCAxKQogICAgICAgIGVuZAoKICAgICAgICBpZiBpc0R0IGFuZCBkdEFjdGl2ZSBhbmQgaXNEZWZlbnNpdmUgdGhlbgogICAgICAgICAgICBkZWZlbnNpdmVGcmFjdGlvbiA9IGZ1bmMuY2xhbXAoZGVmZW5zaXZlRnJhY3Rpb24gKyBnbG9iYWxzLmZyYW1ldGltZSgpLzAuMTUsIDAsIDEpCiAgICAgICAgICAgIGlmIGR0UG9zLnkgPCBpbmRZICogY291bnQgdGhlbgogICAgICAgICAgICAgICAgZHRQb3MueSA9IGZ1bmMubGVycChkdFBvcy55LCBpbmRZICogY291bnQgKyAwLjEsIHRpbWUpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGR0UG9zLnkgPSBpbmRZICogY291bnQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGNvdW50ID0gY291bnQgKyAxCiAgICAgICAgZWxzZQogICAgICAgICAgICBkZWZlbnNpdmVGcmFjdGlvbiA9IGZ1bmMuY2xhbXAoZGVmZW5zaXZlRnJhY3Rpb24gLSBnbG9iYWxzLmZyYW1ldGltZSgpLzAuMTUsIDAsIDEpCiAgICAgICAgICAgIGlzRGVmZW5zaXZlID0gZmFsc2UKICAgICAgICBlbmQKCiAgICAgICAgaWYgaXNEdCBhbmQgbm90IGR0QWN0aXZlIHRoZW4KICAgICAgICAgICAgaW5hY3RpdmVGcmFjdGlvbiA9IGZ1bmMuY2xhbXAoaW5hY3RpdmVGcmFjdGlvbiArIGdsb2JhbHMuZnJhbWV0aW1lKCkvMC4xNSwgMCwgMSkKICAgICAgICAgICAgaWYgZHRQb3MueSA8IGluZFkgKiBjb3VudCB0aGVuCiAgICAgICAgICAgICAgICBkdFBvcy55ID0gZnVuYy5sZXJwKGR0UG9zLnksIGluZFkgKiBjb3VudCArIDAuMSwgdGltZSkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgZHRQb3MueSA9IGluZFkgKiBjb3VudAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgY291bnQgPSBjb3VudCArIDEKICAgICAgICBlbHNlCiAgICAgICAgICAgIGluYWN0aXZlRnJhY3Rpb24gPSBmdW5jLmNsYW1wKGluYWN0aXZlRnJhY3Rpb24gLSBnbG9iYWxzLmZyYW1ldGltZSgpLzAuMTUsIDAsIDEpCiAgICAgICAgZW5kCgogICAgICAgIGlmIGlzT3MgYW5kIHVpLmdldCh1aS5yZWZlcmVuY2UoIlJhZ2UiLCAiT3RoZXIiLCAiU2lsZW50IGFpbSIpKSBhbmQgaXNEdCB0aGVuCiAgICAgICAgICAgIGhpZGVJbmFjdGl2ZUZyYWN0aW9uID0gZnVuYy5jbGFtcChoaWRlSW5hY3RpdmVGcmFjdGlvbiArIGdsb2JhbHMuZnJhbWV0aW1lKCkvMC4xNSwgMCwgMSkKICAgICAgICAgICAgaWYgb3NQb3MueSA8IGluZFkgKiBjb3VudCB0aGVuCiAgICAgICAgICAgICAgICBvc1Bvcy55ID0gZnVuYy5sZXJwKG9zUG9zLnksIGluZFkgKiBjb3VudCArIDAuMSwgdGltZSkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgb3NQb3MueSA9IGluZFkgKiBjb3VudAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgY291bnQgPSBjb3VudCArIDEKICAgICAgICBlbHNlCiAgICAgICAgICAgIGhpZGVJbmFjdGl2ZUZyYWN0aW9uID0gZnVuYy5jbGFtcChoaWRlSW5hY3RpdmVGcmFjdGlvbiAtIGdsb2JhbHMuZnJhbWV0aW1lKCkvMC4xNSwgMCwgMSkKICAgICAgICBlbmQKCiAgICAgICAgaWYgaXNPcyBhbmQgdWkuZ2V0KHVpLnJlZmVyZW5jZSgiUmFnZSIsICJPdGhlciIsICJTaWxlbnQgYWltIikpIGFuZCBub3QgaXNEdCB0aGVuCiAgICAgICAgICAgIGhpZGVGcmFjdGlvbiA9IGZ1bmMuY2xhbXAoaGlkZUZyYWN0aW9uICsgZ2xvYmFscy5mcmFtZXRpbWUoKS8wLjE1LCAwLCAxKQogICAgICAgICAgICBpZiBvc1Bvcy55IDwgaW5kWSAqIGNvdW50IHRoZW4KICAgICAgICAgICAgICAgIG9zUG9zLnkgPSBmdW5jLmxlcnAob3NQb3MueSwgaW5kWSAqIGNvdW50ICsgMC4xLCB0aW1lKQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBvc1Bvcy55ID0gaW5kWSAqIGNvdW50CiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBjb3VudCA9IGNvdW50ICsgMQogICAgICAgIGVsc2UKICAgICAgICAgICAgaGlkZUZyYWN0aW9uID0gZnVuYy5jbGFtcChoaWRlRnJhY3Rpb24gLSBnbG9iYWxzLmZyYW1ldGltZSgpLzAuMTUsIDAsIDEpCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIGdsb2JhbE1hcmdpblgsIGdsb2JhbE1hcmdpblkgPSByZW5kZXJlci5tZWFzdXJlX3RleHQoIi1jZCIsICJEU0FEIikKICAgICAgICBnbG9iYWxNYXJnaW5ZID0gZ2xvYmFsTWFyZ2luWSAtIDIKICAgICAgICBsb2NhbCBkdF9zaXplID0gcmVuZGVyZXIubWVhc3VyZV90ZXh0KCItY2QiLCAiRFQgIikKICAgICAgICBsb2NhbCByZWFkeV9zaXplID0gcmVuZGVyZXIubWVhc3VyZV90ZXh0KCItY2QiLCAiUkVBRFkiKQogICAgICAgIHJlbmRlcmVyLnRleHQoc2l6ZVgvMiArICgoZHRfc2l6ZSArIHJlYWR5X3NpemUgKyAyKS8yKSAqIHNjb3BlZEZyYWN0aW9uLCBzaXplWS8yICsgMzAgKyBnbG9iYWxNYXJnaW5ZICsgZHRQb3MueSwgMjU1LCAyNTUsIDI1NSwgYWN0aXZlRnJhY3Rpb24gKiAyNTUsICItY2QiLCBkdF9zaXplICsgYWN0aXZlRnJhY3Rpb24gKiByZWFkeV9zaXplICsgMSwgIkRUICIsICJcYSIgLi4gZnVuYy5SR0JBdG9IRVgoNSwgMjU1LCA1LCAyNTUgKiBhY3RpdmVGcmFjdGlvbikgLi4gIlJFQURZIikKCiAgICAgICAgbG9jYWwgY2hhcmdpbmdfc2l6ZSA9IHJlbmRlcmVyLm1lYXN1cmVfdGV4dCgiLWNkIiwgIldBSVRJTkciKQogICAgICAgIGxvY2FsIHJldCA9IGFuaW1hdGVfdGV4dChnbG9iYWxzLmN1cnRpbWUoKSwgIldBSVRJTkciLCAyNTUsIDAsIDAsIDI1NSkKICAgICAgICByZW5kZXJlci50ZXh0KHNpemVYLzIgKyAoKGR0X3NpemUgKyBjaGFyZ2luZ19zaXplICsgMikvMikgKiBzY29wZWRGcmFjdGlvbiwgc2l6ZVkvMiArIDMwICsgZ2xvYmFsTWFyZ2luWSArIGR0UG9zLnksIDI1NSwgMjU1LCAyNTUsIGluYWN0aXZlRnJhY3Rpb24gKiAyNTUsICItY2QiLCBkdF9zaXplICsgaW5hY3RpdmVGcmFjdGlvbiAqIGNoYXJnaW5nX3NpemUgKyAxLCAiRFQgIiwgdW5wYWNrKHJldCkpCgogICAgICAgIGxvY2FsIGRlZmVuc2l2ZV9zaXplID0gcmVuZGVyZXIubWVhc3VyZV90ZXh0KCItY2QiLCAiREVGRU5TSVZFIikKICAgICAgICBsb2NhbCBkZWYgPSBhbmltYXRlX3RleHQoZ2xvYmFscy5jdXJ0aW1lKCksICJERUZFTlNJVkUiLCBtYWluQ2xyLnIsIG1haW5DbHIuZywgbWFpbkNsci5iLCAyNTUpCiAgICAgICAgcmVuZGVyZXIudGV4dChzaXplWC8yICsgKChkdF9zaXplICsgZGVmZW5zaXZlX3NpemUgKyAyKS8yKSAqIHNjb3BlZEZyYWN0aW9uLCBzaXplWS8yICsgMzAgKyBnbG9iYWxNYXJnaW5ZICsgZHRQb3MueSwgMjU1LCAyNTUsIDI1NSwgZGVmZW5zaXZlRnJhY3Rpb24gKiAyNTUsICItY2QiLCBkdF9zaXplICsgZGVmZW5zaXZlRnJhY3Rpb24gKiBkZWZlbnNpdmVfc2l6ZSArIDEsICJEVCAiLCB1bnBhY2soZGVmKSkKCiAgICAgICAgbG9jYWwgaGlkZV9zaXplID0gcmVuZGVyZXIubWVhc3VyZV90ZXh0KCItY2QiLCAiT1NBQSAiKQogICAgICAgIGxvY2FsIGFjdGl2ZV9zaXplID0gcmVuZGVyZXIubWVhc3VyZV90ZXh0KCItY2QiLCAiQUNUSVZFIikKICAgICAgICByZW5kZXJlci50ZXh0KHNpemVYLzIgKyAoKGhpZGVfc2l6ZSArIGFjdGl2ZV9zaXplICsgMikvMikgKiBzY29wZWRGcmFjdGlvbiwgc2l6ZVkvMiArIDMwICsgZ2xvYmFsTWFyZ2luWSArIG9zUG9zLnksIDI1NSwgMjU1LCAyNTUsIGhpZGVGcmFjdGlvbiAqIDI1NSwgIi1jZCIsIGhpZGVfc2l6ZSArIGhpZGVGcmFjdGlvbiAqIGFjdGl2ZV9zaXplICsgMSwgIk9TQUEgIiwgIlxhIiAuLiBmdW5jLlJHQkF0b0hFWCgyNTUsIDI1NSwgMCwgMjU1ICogaGlkZUZyYWN0aW9uKSAuLiAiQUNUSVZFIikKICAgICAgICAKICAgICAgICBsb2NhbCBpbmFjdGl2ZV9zaXplID0gcmVuZGVyZXIubWVhc3VyZV90ZXh0KCItY2QiLCAiSU5BQ1RJVkUiKQogICAgICAgIGxvY2FsIG9zaW4gPSBhbmltYXRlX3RleHQoZ2xvYmFscy5jdXJ0aW1lKCksICJJTkFDVElWRSIsIDI1NSwgMCwgMCwgMjU1KQogICAgICAgIHJlbmRlcmVyLnRleHQoc2l6ZVgvMiArICgoaGlkZV9zaXplICsgaW5hY3RpdmVfc2l6ZSArIDIpLzIpICogc2NvcGVkRnJhY3Rpb24sIHNpemVZLzIgKyAzMCArIGdsb2JhbE1hcmdpblkgKyBvc1Bvcy55LCAyNTUsIDI1NSwgMjU1LCBoaWRlSW5hY3RpdmVGcmFjdGlvbiAqIDI1NSwgIi1jZCIsIGhpZGVfc2l6ZSArIGhpZGVJbmFjdGl2ZUZyYWN0aW9uICogaW5hY3RpdmVfc2l6ZSArIDEsICJPU0FBICIsIHVucGFjayhvc2luKSkKICAgIAogICAgICAgIGxvY2FsIHN0YXRlX3NpemUgPSByZW5kZXJlci5tZWFzdXJlX3RleHQoIi1jZCIsICc+JyAuLiBzdHJpbmcudXBwZXIoc3RhdGUpIC4uICc8JykKICAgICAgICByZW5kZXJlci50ZXh0KHNpemVYLzIgKyAoKHN0YXRlX3NpemUgKyAyKS8yKSAqIHNjb3BlZEZyYWN0aW9uLCBzaXplWS8yICsgMzAgLCAyNTUsIDI1NSwgMjU1LCAyNTUsICItY2QiLCAwLCAnPicgLi4gc3RyaW5nLnVwcGVyKHN0YXRlKSAuLiAnPCcpCiAgICBlbmQKICAgIAogICAgLS0gZHJhdyBkbWcgaW5kaWNhdG9yCiAgICBpZiB1aS5nZXQobWVudS52aXN1YWxzVGFiLm1pbmltdW1fZGFtYWdlSW5kaWNhdG9yKSB+PSAiLSIgYW5kIGVudGl0eS5nZXRfY2xhc3NuYW1lKHdlYXBvbikgfj0gIkNLbmlmZSIgIHRoZW4KICAgICAgICBpZiB1aS5nZXQobWVudS52aXN1YWxzVGFiLm1pbmltdW1fZGFtYWdlZW5iKSBhbmQgdWkuZ2V0KG1lbnUudmlzdWFsc1RhYi5taW5pbXVtX2RhbWFnZUluZGljYXRvcikgPT0gIkNvbnN0YW50IiB0aGVuCiAgICAgICAgICAgIGlmICggdWkuZ2V0KHJlZnMubWluaW11bV9kYW1hZ2Vfb3ZlcnJpZGVbMV0pIGFuZCB1aS5nZXQocmVmcy5taW5pbXVtX2RhbWFnZV9vdmVycmlkZVsyXSkgKSA9PSBmYWxzZSB0aGVuCiAgICAgICAgICAgICAgICByZW5kZXJlci50ZXh0KHNpemVYIC8gMiArIDMsIHNpemVZIC8gMiAtIDE1LCAyNTUsIDI1NSwgMjU1LCAyNTUsICIiLCAwLCB1aS5nZXQocmVmcy5taW5pbXVtX2RhbWFnZSkpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHJlbmRlcmVyLnRleHQoc2l6ZVggLyAyICsgMywgc2l6ZVkgLyAyIC0gMTUsIDI1NSwgMjU1LCAyNTUsIDI1NSwgIiIsIDAsIHVpLmdldChyZWZzLm1pbmltdW1fZGFtYWdlX292ZXJyaWRlWzNdKSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZWxzZWlmIHVpLmdldChtZW51LnZpc3VhbHNUYWIubWluaW11bV9kYW1hZ2VlbmIpIGFuZCB1aS5nZXQocmVmcy5taW5pbXVtX2RhbWFnZV9vdmVycmlkZVsxXSkgYW5kIHVpLmdldChyZWZzLm1pbmltdW1fZGFtYWdlX292ZXJyaWRlWzJdKSBhbmQgdWkuZ2V0KG1lbnUudmlzdWFsc1RhYi5taW5pbXVtX2RhbWFnZUluZGljYXRvcikgPT0gIkJpbmQiIHRoZW4KICAgICAgICAgICAgZG1nID0gdWkuZ2V0KHJlZnMubWluaW11bV9kYW1hZ2Vfb3ZlcnJpZGVbM10pCiAgICAgICAgICAgIHJlbmRlcmVyLnRleHQoc2l6ZVggLyAyICsgMywgc2l6ZVkgLyAyIC0gMTUsIDI1NSwgMjU1LCAyNTUsIDI1NSwgIiIsIDAsIGRtZykKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGlmIHVpLmdldChtZW51Lm1pc2NUYWIud2F0ZXJtYXJrKSB0aGVuCiAgICAgICAgICAgIGxvY2FsIGNscl9yLCBjbHJfZywgY2xyX2IgPSB1aS5nZXQobWVudS5taXNjVGFiLndhdGVybWFya0NscikKICAgICAgICAgICAgbG9jYWwgcixnLGIsYSA9IDg3LCAyMzUsIDYxCiAgICAgICAgICAgIGxvY2FsIHRleHRfc2l6ZSA9IHZlY3RvcihyZW5kZXJlci5tZWFzdXJlX3RleHQoImNiIiwgIkkgTiBWIEkgTiBTIEkgQiBMIEUiKSkKCiAgICAgICAgICAgIGxvY2FsIHdhdGVybWFybzRrYSA9IGFuaW1hdGVfdGV4dChnbG9iYWxzLmN1cnRpbWUoKSwgbHVhX25hbWUsIGNscl9yLCBjbHJfZywgY2xyX2IsIDI1NSkKICAgICAgICAgICAgcmVuZGVyZXIudGV4dChzaXplWC8yIC0gcmVuZGVyZXIubWVhc3VyZV90ZXh0KCJkYiIsIGx1YV9uYW1lKS8yLCBzaXplWSAtIDIwLCAxNTUsIDAsIDAsIDAsICJkYiIsIG5pbCwgdW5wYWNrKHdhdGVybWFybzRrYSkpCiAgICBlbmQKCiAgICBpZiB1aS5nZXQobWVudS52aXN1YWxzVGFiLnNpZGVJbmRpY2F0b3JzKSA9PSAiU2tlZXQgb2xkIiB0aGVuCiAgICAgICAgbG9jYWwgaCA9IHNlbGVjdCgyLCBjbGllbnQuc2NyZWVuX3NpemUoKSkKICAgICAgICBsb2NhbCBzdGFydGluZyA9IGggLSA0MjIKICAgIAogICAgICAgIGZvciBpbmRleCwgaW5kaWNhdG9yIGluIHBhaXJzKGluZGljYXRvcnNfdGFibGUpIGRvIGluZGV4ID0gaW5kZXggLSAxCiAgICAgICAgICAgIGxvY2FsIHdpZHRoLCBoZWlnaHQgPSByZW5kZXJlci5tZWFzdXJlX3RleHQoJ2QrJywgaW5kaWNhdG9yLnRleHQpCiAgICAgICAgICAgIGxvY2FsIG9mZnNldCA9IGluZGV4ICogKGhlaWdodCAtIDgpCiAgICAKICAgICAgICAgICAgbG9jYWwgeSA9IHN0YXJ0aW5nICsgb2Zmc2V0CiAgICAKICAgICAgICAgICAgcmVuZGVyZXIudGV4dCgxMCwgeSArIDIsIGluZGljYXRvci5yLCBpbmRpY2F0b3IuZywgaW5kaWNhdG9yLmIsIGluZGljYXRvci5hLCAnZCsnLCAwLCBpbmRpY2F0b3IudGV4dCkKICAgICAgICBlbmQKICAgIAogICAgICAgIGluZGljYXRvcnNfdGFibGUgPSB7fQogICAgZW5kCgogICAgbm90aWZpY2F0aW9ucy5yZW5kZXIoKQplbmQpCi0tIEByZWdpb24gSU5ESUNBVE9SUyBlbmQKCi0tIEByZWdpb24gVUlfQ0FMTEJBQ0tTIHN0YXJ0CnVpLnNldF9jYWxsYmFjayhtZW51LnZpc3VhbHNUYWIuc2lkZUluZGljYXRvcnMsIGZ1bmN0aW9uKHZhbHVlKQogICAgbG9jYWwgY2FsbGJhY2sgPSB1aS5nZXQodmFsdWUpID09ICdTa2VldCBvbGQnIGFuZCBjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrIG9yIGNsaWVudC51bnNldF9ldmVudF9jYWxsYmFjawogICAgY2FsbGJhY2soJ2luZGljYXRvcicsIHphbHVwYSkKZW5kKQp1aS51cGRhdGUobWVudS5jb25maWdUYWIubGlzdCxnZXRDb25maWdMaXN0KCkpCmlmIGRhdGFiYXNlLnJlYWQobHVhLmRhdGFiYXNlLmNvbmZpZ3MpID09IG5pbCB0aGVuCiAgICBkYXRhYmFzZS53cml0ZShsdWEuZGF0YWJhc2UuY29uZmlncywge30pCmVuZAp1aS5zZXQobWVudS5jb25maWdUYWIubmFtZSwgI2RhdGFiYXNlLnJlYWQobHVhLmRhdGFiYXNlLmNvbmZpZ3MpID09IDAgYW5kICIiIG9yIGRhdGFiYXNlLnJlYWQobHVhLmRhdGFiYXNlLmNvbmZpZ3MpW3VpLmdldChtZW51LmNvbmZpZ1RhYi5saXN0KSsxXS5uYW1lKQp1aS5zZXRfY2FsbGJhY2sobWVudS5jb25maWdUYWIubGlzdCwgZnVuY3Rpb24odmFsdWUpCiAgICBsb2NhbCBwcm90ZWN0ZWQgPSBmdW5jdGlvbigpCiAgICAgICAgaWYgdmFsdWUgPT0gbmlsIHRoZW4gcmV0dXJuIGVuZAogICAgICAgIGxvY2FsIG5hbWUgPSAiIgogICAgCiAgICAgICAgbG9jYWwgY29uZmlncyA9IGdldENvbmZpZ0xpc3QoKQogICAgICAgIGlmIGNvbmZpZ3MgPT0gbmlsIHRoZW4gcmV0dXJuIGVuZAogICAgCiAgICAgICAgbmFtZSA9IGNvbmZpZ3NbdWkuZ2V0KHZhbHVlKSsxXSBvciAiIgogICAgCiAgICAgICAgdWkuc2V0KG1lbnUuY29uZmlnVGFiLm5hbWUsIG5hbWUpCiAgICBlbmQKCiAgICBpZiBwY2FsbChwcm90ZWN0ZWQpIHRoZW4KCiAgICBlbmQKZW5kKQoKdWkuc2V0X2NhbGxiYWNrKG1lbnUuY29uZmlnVGFiLmxvYWQsIGZ1bmN0aW9uKCkKICAgIGxvY2FsIG5hbWUgPSB1aS5nZXQobWVudS5jb25maWdUYWIubmFtZSkKICAgIGlmIG5hbWUgPT0gIiIgdGhlbiByZXR1cm4gZW5kCiAgICBsb2NhbCBwcm90ZWN0ZWQgPSBmdW5jdGlvbigpCiAgICAgICAgbG9hZENvbmZpZyhuYW1lKQogICAgZW5kCgogICAgaWYgcGNhbGwocHJvdGVjdGVkKSB0aGVuCiAgICAgICAgbmFtZSA9IG5hbWU6Z3N1YignKicsICcnKQogICAgICAgIG5vdGlmaWNhdGlvbnMubmV3KHN0cmluZy5mb3JtYXQoJ1N1Y2Nlc3NmdWxseSBsb2FkZWQgIiQlcyQiJywgbmFtZSksIHIsIGcsIGIpCiAgICBlbHNlCiAgICAgICAgbm90aWZpY2F0aW9ucy5uZXcoc3RyaW5nLmZvcm1hdCgnRmFpbGVkIHRvIGxvYWQgIiQlcyQiJywgbmFtZSksIDI1NSwgMTIwLCAxMjApCiAgICBlbmQKZW5kKQoKdWkuc2V0X2NhbGxiYWNrKG1lbnUuY29uZmlnVGFiLnNhdmUsIGZ1bmN0aW9uKCkKCiAgICAgICAgbG9jYWwgbmFtZSA9IHVpLmdldChtZW51LmNvbmZpZ1RhYi5uYW1lKQogICAgICAgIGlmIG5hbWUgPT0gIiIgdGhlbiByZXR1cm4gZW5kCiAgICAKICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhwcmVzZXRzKSBkbwogICAgICAgICAgICBpZiB2Lm5hbWUgPT0gbmFtZTpnc3ViKCcqJywgJycpIHRoZW4KICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbnMubmV3KHN0cmluZy5mb3JtYXQoJ1lvdSBjYW5gdCBzYXZlIGJ1aWx0LWluIHByZXNldCAiJCVzJCInLCBuYW1lOmdzdWIoJyonLCAnJykpLCAyNTUsIDEyMCwgMTIwKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBpZiBuYW1lOm1hdGNoKCJbXiV3XSIpIH49IG5pbCB0aGVuCiAgICAgICAgICAgIG5vdGlmaWNhdGlvbnMubmV3KHN0cmluZy5mb3JtYXQoJ0ZhaWxlZCB0byBzYXZlICIkJXMkIiBkdWUgdG8gaW52YWxpZCBjaGFyYWN0ZXJzJywgbmFtZSksIDI1NSwgMTIwLCAxMjApCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAogICAgbG9jYWwgcHJvdGVjdGVkID0gZnVuY3Rpb24oKQogICAgICAgIHNhdmVDb25maWcobmFtZSkKICAgICAgICB1aS51cGRhdGUobWVudS5jb25maWdUYWIubGlzdCwgZ2V0Q29uZmlnTGlzdCgpKQogICAgZW5kCiAgICBpZiBwY2FsbChwcm90ZWN0ZWQpIHRoZW4KICAgICAgICBub3RpZmljYXRpb25zLm5ldyhzdHJpbmcuZm9ybWF0KCdTdWNjZXNzZnVsbHkgc2F2ZWQgIiQlcyQiJywgbmFtZSksIHIsIGcsIGIpCiAgICBlbmQKZW5kKQoKdWkuc2V0X2NhbGxiYWNrKG1lbnUuY29uZmlnVGFiLmRlbGV0ZSwgZnVuY3Rpb24oKQogICAgbG9jYWwgbmFtZSA9IHVpLmdldChtZW51LmNvbmZpZ1RhYi5uYW1lKQogICAgaWYgbmFtZSA9PSAiIiB0aGVuIHJldHVybiBlbmQKICAgIGlmIGRlbGV0ZUNvbmZpZyhuYW1lKSA9PSBmYWxzZSB0aGVuCiAgICAgICAgbm90aWZpY2F0aW9ucy5uZXcoc3RyaW5nLmZvcm1hdCgnRmFpbGVkIHRvIGRlbGV0ZSAiJCVzJCInLCBuYW1lKSwgMjU1LCAxMjAsIDEyMCkKICAgICAgICB1aS51cGRhdGUobWVudS5jb25maWdUYWIubGlzdCwgZ2V0Q29uZmlnTGlzdCgpKQogICAgICAgIHJldHVybgogICAgZW5kCgogICAgZm9yIGksIHYgaW4gcGFpcnMocHJlc2V0cykgZG8KICAgICAgICBpZiB2Lm5hbWUgPT0gbmFtZTpnc3ViKCcqJywgJycpIHRoZW4KICAgICAgICAgICAgbm90aWZpY2F0aW9ucy5uZXcoc3RyaW5nLmZvcm1hdCgnWW91IGNhbmB0IGRlbGV0ZSBidWlsdC1pbiBwcmVzZXQgIiQlcyQiJywgbmFtZTpnc3ViKCcqJywgJycpKSwgMjU1LCAxMjAsIDEyMCkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBsb2NhbCBwcm90ZWN0ZWQgPSBmdW5jdGlvbigpCiAgICAgICAgZGVsZXRlQ29uZmlnKG5hbWUpCiAgICBlbmQKCiAgICBpZiBwY2FsbChwcm90ZWN0ZWQpIHRoZW4KICAgICAgICB1aS51cGRhdGUobWVudS5jb25maWdUYWIubGlzdCwgZ2V0Q29uZmlnTGlzdCgpKQogICAgICAgIHVpLnNldChtZW51LmNvbmZpZ1RhYi5saXN0LCAjcHJlc2V0cyArICNkYXRhYmFzZS5yZWFkKGx1YS5kYXRhYmFzZS5jb25maWdzKSAtICNkYXRhYmFzZS5yZWFkKGx1YS5kYXRhYmFzZS5jb25maWdzKSkKICAgICAgICB1aS5zZXQobWVudS5jb25maWdUYWIubmFtZSwgI2RhdGFiYXNlLnJlYWQobHVhLmRhdGFiYXNlLmNvbmZpZ3MpID09IDAgYW5kICIiIG9yIGdldENvbmZpZ0xpc3QoKVsjcHJlc2V0cyArICNkYXRhYmFzZS5yZWFkKGx1YS5kYXRhYmFzZS5jb25maWdzKSAtICNkYXRhYmFzZS5yZWFkKGx1YS5kYXRhYmFzZS5jb25maWdzKSsxXSkKICAgICAgICBub3RpZmljYXRpb25zLm5ldyhzdHJpbmcuZm9ybWF0KCdTdWNjZXNzZnVsbHkgZGVsZXRlZCAiJCVzJCInLCBuYW1lKSwgciwgZywgYikKICAgIGVuZAplbmQpCgp1aS5zZXRfY2FsbGJhY2sobWVudS5jb25maWdUYWIuaW1wb3J0LCBmdW5jdGlvbigpCgogICAgbG9jYWwgcHJvdGVjdGVkID0gZnVuY3Rpb24oKQogICAgICAgIGltcG9ydFNldHRpbmdzKCkKICAgIGVuZAoKICAgIGlmIHBjYWxsKHByb3RlY3RlZCkgdGhlbgogICAgICAgIG5vdGlmaWNhdGlvbnMubmV3KHN0cmluZy5mb3JtYXQoJ1N1Y2Nlc3NmdWxseSBpbXBvcnRlZCBzZXR0aW5ncycsIG5hbWUpLCByLCBnLCBiKQogICAgZWxzZQogICAgICAgIG5vdGlmaWNhdGlvbnMubmV3KHN0cmluZy5mb3JtYXQoJ0ZhaWxlZCB0byBpbXBvcnQgc2V0dGluZ3MnLCBuYW1lKSwgMjU1LCAxMjAsIDEyMCkKICAgIGVuZAplbmQpCgp1aS5zZXRfY2FsbGJhY2sobWVudS5jb25maWdUYWIuZXhwb3J0LCBmdW5jdGlvbigpCiAgICBsb2NhbCBuYW1lID0gdWkuZ2V0KG1lbnUuY29uZmlnVGFiLm5hbWUpCiAgICBpZiBuYW1lID09ICIiIHRoZW4gcmV0dXJuIGVuZAoKICAgIGxvY2FsIHByb3RlY3RlZCA9IGZ1bmN0aW9uKCkKICAgICAgICBleHBvcnRTZXR0aW5ncyhuYW1lKQogICAgZW5kCiAgICBpZiBwY2FsbChwcm90ZWN0ZWQpIHRoZW4KICAgICAgICBub3RpZmljYXRpb25zLm5ldyhzdHJpbmcuZm9ybWF0KCdTdWNjZXNzZnVsbHkgZXhwb3J0ZWQgc2V0dGluZ3MnLCBuYW1lKSwgciwgZywgYikKICAgIGVsc2UKICAgICAgICBub3RpZmljYXRpb25zLm5ldyhzdHJpbmcuZm9ybWF0KCdGYWlsZWQgdG8gZXhwb3J0IHNldHRpbmdzJywgbmFtZSksIDI1NSwgMTIwLCAxMjApCiAgICBlbmQKZW5kKQotLSBAcmVnaW9uIFVJX0NBTExCQUNLUyBlbmQKCi0tIEByZWdpb24gVUlfUkVOREVSIHN0YXJ0CmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInBhaW50X3VpIiwgZnVuY3Rpb24oKQogICAgdmFycy5hY3RpdmVTdGF0ZSA9IHZhcnMuc1RvSW50W3VpLmdldChtZW51LmJ1aWxkZXJUYWIuc3RhdGUpXQogICAgbG9jYWwgaXNFbmFibGVkID0gdHJ1ZQogICAgdWkuc2V0X3Zpc2libGUodGFiUGlja2VyLCBpc0VuYWJsZWQpCiAgICB1aS5zZXRfdmlzaWJsZShhYVRhYnMsIHVpLmdldCh0YWJQaWNrZXIpID09ICJBbnRpLWFpbSIgYW5kIGlzRW5hYmxlZCkKICAgIHRyYXZlcnNlX3RhYmxlKGJpbmRzKQogICAgbG9jYWwgaXNBQVRhYiA9IHVpLmdldCh0YWJQaWNrZXIpID09ICJBbnRpLWFpbSIgYW5kIHVpLmdldChhYVRhYnMpID09ICJPdGhlciIKICAgIGxvY2FsIGlzQnVpbGRlclRhYiA9IHVpLmdldCh0YWJQaWNrZXIpID09ICJBbnRpLWFpbSIgYW5kIHVpLmdldChhYVRhYnMpID09ICJCdWlsZGVyIgogICAgbG9jYWwgaXNWaXN1YWxzVGFiID0gdWkuZ2V0KHRhYlBpY2tlcikgPT0gIlNldHRpbmdzIiAKICAgIGxvY2FsIGlzTWlzY1RhYiA9IHVpLmdldCh0YWJQaWNrZXIpID09ICJTZXR0aW5ncyIgCiAgICBsb2NhbCBpc0NGR1RhYiA9IHVpLmdldCh0YWJQaWNrZXIpID09ICJNYWluIgoKICAgIHVpLnNldChhYUJ1aWxkZXJbMV0uZW5hYmxlU3RhdGUsIHRydWUpCiAgICBmb3IgaSA9IDEsICN2YXJzLmFhU3RhdGVzIGRvCiAgICAgICAgbG9jYWwgc3RhdGVFbmFibGVkID0gdWkuZ2V0KGFhQnVpbGRlcltpXS5lbmFibGVTdGF0ZSkKICAgICAgICB1aS5zZXRfdmlzaWJsZShhYUJ1aWxkZXJbaV0uZW5hYmxlU3RhdGUsIHZhcnMuYWN0aXZlU3RhdGUgPT0gaSBhbmQgaX49MSBhbmQgaXNCdWlsZGVyVGFiIGFuZCBpc0VuYWJsZWQpCiAgICAgICAgdWkuc2V0X3Zpc2libGUoYWFCdWlsZGVyW2ldLmZvcmNlRGVmZW5zaXZlLCB2YXJzLmFjdGl2ZVN0YXRlID09IGkgYW5kIGlzQnVpbGRlclRhYiBhbmQgc3RhdGVFbmFibGVkIGFuZCBpc0VuYWJsZWQpCiAgICAgICAgdWkuc2V0X3Zpc2libGUoYWFCdWlsZGVyW2ldLnN0YXRlRGlzYWJsZXJzLCB2YXJzLmFjdGl2ZVN0YXRlID09IDkgYW5kIGkgPT0gOSBhbmQgaXNCdWlsZGVyVGFiIGFuZCB1aS5nZXQoYWFCdWlsZGVyWzldLmVuYWJsZVN0YXRlKSBhbmQgaXNFbmFibGVkKQogICAgICAgIHVpLnNldF92aXNpYmxlKGFhQnVpbGRlcltpXS5waXRjaCwgdmFycy5hY3RpdmVTdGF0ZSA9PSBpIGFuZCBpc0J1aWxkZXJUYWIgYW5kIHN0YXRlRW5hYmxlZCBhbmQgaXNFbmFibGVkKQogICAgICAgIHVpLnNldF92aXNpYmxlKGFhQnVpbGRlcltpXS5waXRjaFNsaWRlciAsIHZhcnMuYWN0aXZlU3RhdGUgPT0gaSBhbmQgaXNCdWlsZGVyVGFiIGFuZCBzdGF0ZUVuYWJsZWQgYW5kIHVpLmdldChhYUJ1aWxkZXJbaV0ucGl0Y2gpID09ICJDdXN0b20iIGFuZCBpc0VuYWJsZWQpCiAgICAgICAgdWkuc2V0X3Zpc2libGUoYWFCdWlsZGVyW2ldLnlhd0Jhc2UsIHZhcnMuYWN0aXZlU3RhdGUgPT0gaSBhbmQgaXNCdWlsZGVyVGFiIGFuZCBzdGF0ZUVuYWJsZWQgYW5kIGlzRW5hYmxlZCkKICAgICAgICB1aS5zZXRfdmlzaWJsZShhYUJ1aWxkZXJbaV0ueWF3LCB2YXJzLmFjdGl2ZVN0YXRlID09IGkgYW5kIGlzQnVpbGRlclRhYiBhbmQgc3RhdGVFbmFibGVkIGFuZCBpc0VuYWJsZWQpCiAgICAgICAgdWkuc2V0X3Zpc2libGUoYWFCdWlsZGVyW2ldLnN3aXRjaFRpY2tzLCB2YXJzLmFjdGl2ZVN0YXRlID09IGkgYW5kIGlzQnVpbGRlclRhYiBhbmQgc3RhdGVFbmFibGVkIGFuZCB1aS5nZXQoYWFCdWlsZGVyW2ldLnlhdykgPT0gIlNsb3cgSml0dGVyIiBhbmQgaXNFbmFibGVkKQogICAgICAgIHVpLnNldF92aXNpYmxlKGFhQnVpbGRlcltpXS55YXdTdGF0aWMsIHZhcnMuYWN0aXZlU3RhdGUgPT0gaSBhbmQgdWkuZ2V0KGFhQnVpbGRlcltpXS55YXcpIH49ICJPZmYiIGFuZCB1aS5nZXQoYWFCdWlsZGVyW2ldLnlhdykgfj0gIlNsb3cgSml0dGVyIiBhbmQgdWkuZ2V0KGFhQnVpbGRlcltpXS55YXcpIH49ICJMJlIiIGFuZCB1aS5nZXQoYWFCdWlsZGVyW2ldLnlhdykgfj0gIkRlbGF5IEppdHRlciIgYW5kIGlzQnVpbGRlclRhYiBhbmQgc3RhdGVFbmFibGVkIGFuZCBpc0VuYWJsZWQpCiAgICAgICAgdWkuc2V0X3Zpc2libGUoYWFCdWlsZGVyW2ldLnlhd0xlZnQsIHZhcnMuYWN0aXZlU3RhdGUgPT0gaSBhbmQgdWkuZ2V0KGFhQnVpbGRlcltpXS55YXcpIH49ICJPZmYiIGFuZCAodWkuZ2V0KGFhQnVpbGRlcltpXS55YXcpID09ICJTbG93IEppdHRlciIgb3IgdWkuZ2V0KGFhQnVpbGRlcltpXS55YXcpID09ICJMJlIiIG9yIHVpLmdldChhYUJ1aWxkZXJbaV0ueWF3KSA9PSAiRGVsYXkgSml0dGVyIikgYW5kIGlzQnVpbGRlclRhYiBhbmQgc3RhdGVFbmFibGVkIGFuZCBpc0VuYWJsZWQpCiAgICAgICAgdWkuc2V0X3Zpc2libGUoYWFCdWlsZGVyW2ldLnlhd1JpZ2h0LCB2YXJzLmFjdGl2ZVN0YXRlID09IGkgYW5kIHVpLmdldChhYUJ1aWxkZXJbaV0ueWF3KSB+PSAiT2ZmIiBhbmQgKHVpLmdldChhYUJ1aWxkZXJbaV0ueWF3KSA9PSAiU2xvdyBKaXR0ZXIiIG9yIHVpLmdldChhYUJ1aWxkZXJbaV0ueWF3KSA9PSAiTCZSIiBvciB1aS5nZXQoYWFCdWlsZGVyW2ldLnlhdykgPT0gIkRlbGF5IEppdHRlciIpIGFuZCBpc0J1aWxkZXJUYWIgYW5kIHN0YXRlRW5hYmxlZCBhbmQgaXNFbmFibGVkKQogICAgICAgIHVpLnNldF92aXNpYmxlKGFhQnVpbGRlcltpXS55YXdKaXR0ZXIsIHZhcnMuYWN0aXZlU3RhdGUgPT0gaSBhbmQgdWkuZ2V0KGFhQnVpbGRlcltpXS55YXcpIH49ICJPZmYiIGFuZCBpc0J1aWxkZXJUYWIgYW5kIHN0YXRlRW5hYmxlZCBhbmQgaXNFbmFibGVkKQogICAgICAgIHVpLnNldF92aXNpYmxlKGFhQnVpbGRlcltpXS53YXlGaXJzdCwgdmFycy5hY3RpdmVTdGF0ZSA9PSBpIGFuZCB1aS5nZXQoYWFCdWlsZGVyW2ldLnlhdykgfj0gIk9mZiIgYW5kIHVpLmdldChhYUJ1aWxkZXJbaV0ueWF3Sml0dGVyKSA9PSAiMy1XYXkiICBhbmQgaXNCdWlsZGVyVGFiIGFuZCBzdGF0ZUVuYWJsZWQgYW5kIGlzRW5hYmxlZCkKICAgICAgICB1aS5zZXRfdmlzaWJsZShhYUJ1aWxkZXJbaV0ud2F5U2Vjb25kLCB2YXJzLmFjdGl2ZVN0YXRlID09IGkgYW5kIHVpLmdldChhYUJ1aWxkZXJbaV0ueWF3KSB+PSAiT2ZmIiBhbmQgdWkuZ2V0KGFhQnVpbGRlcltpXS55YXdKaXR0ZXIpID09ICIzLVdheSIgIGFuZCBpc0J1aWxkZXJUYWIgYW5kIHN0YXRlRW5hYmxlZCBhbmQgaXNFbmFibGVkKQogICAgICAgIHVpLnNldF92aXNpYmxlKGFhQnVpbGRlcltpXS53YXlUaGlyZCwgdmFycy5hY3RpdmVTdGF0ZSA9PSBpIGFuZCB1aS5nZXQoYWFCdWlsZGVyW2ldLnlhdykgfj0gIk9mZiIgYW5kIHVpLmdldChhYUJ1aWxkZXJbaV0ueWF3Sml0dGVyKSA9PSAiMy1XYXkiICBhbmQgaXNCdWlsZGVyVGFiIGFuZCBzdGF0ZUVuYWJsZWQgYW5kIGlzRW5hYmxlZCkKICAgICAgICB1aS5zZXRfdmlzaWJsZShhYUJ1aWxkZXJbaV0ueWF3Sml0dGVyU3RhdGljLCB2YXJzLmFjdGl2ZVN0YXRlID09IGkgYW5kIHVpLmdldChhYUJ1aWxkZXJbaV0ueWF3KSB+PSAiT2ZmIiBhbmQgdWkuZ2V0KGFhQnVpbGRlcltpXS55YXdKaXR0ZXIpIH49ICJPZmYiIGFuZCB1aS5nZXQoYWFCdWlsZGVyW2ldLnlhd0ppdHRlcikgfj0gIkwmUiIgYW5kIHVpLmdldChhYUJ1aWxkZXJbaV0ueWF3Sml0dGVyKSB+PSAiMy1XYXkiIGFuZCBpc0J1aWxkZXJUYWIgYW5kIHN0YXRlRW5hYmxlZCBhbmQgaXNFbmFibGVkKQogICAgICAgIHVpLnNldF92aXNpYmxlKGFhQnVpbGRlcltpXS55YXdKaXR0ZXJMZWZ0LCB2YXJzLmFjdGl2ZVN0YXRlID09IGkgYW5kIHVpLmdldChhYUJ1aWxkZXJbaV0ueWF3KSB+PSAiT2ZmIiBhbmQgdWkuZ2V0KGFhQnVpbGRlcltpXS55YXdKaXR0ZXIpID09ICJMJlIiIGFuZCBpc0J1aWxkZXJUYWIgYW5kIHN0YXRlRW5hYmxlZCBhbmQgaXNFbmFibGVkKQogICAgICAgIHVpLnNldF92aXNpYmxlKGFhQnVpbGRlcltpXS55YXdKaXR0ZXJSaWdodCwgdmFycy5hY3RpdmVTdGF0ZSA9PSBpIGFuZCB1aS5nZXQoYWFCdWlsZGVyW2ldLnlhdykgfj0gIk9mZiIgYW5kIHVpLmdldChhYUJ1aWxkZXJbaV0ueWF3Sml0dGVyKSA9PSAiTCZSIiBhbmQgaXNCdWlsZGVyVGFiIGFuZCBzdGF0ZUVuYWJsZWQgYW5kIGlzRW5hYmxlZCkKICAgICAgICB1aS5zZXRfdmlzaWJsZShhYUJ1aWxkZXJbaV0uYm9keVlhdywgdmFycy5hY3RpdmVTdGF0ZSA9PSBpIGFuZCBpc0J1aWxkZXJUYWIgYW5kIHN0YXRlRW5hYmxlZCBhbmQgaXNFbmFibGVkKQogICAgICAgIHVpLnNldF92aXNpYmxlKGFhQnVpbGRlcltpXS5ib2R5WWF3U3RhdGljLCB2YXJzLmFjdGl2ZVN0YXRlID09IGkgYW5kIHVpLmdldChhYUJ1aWxkZXJbaV0uYm9keVlhdykgfj0gIk9mZiIgYW5kIHVpLmdldChhYUJ1aWxkZXJbaV0uYm9keVlhdykgfj0gIk9wcG9zaXRlIiBhbmQgdWkuZ2V0KGFhQnVpbGRlcltpXS5ib2R5WWF3KSB+PSAiQ3VzdG9tIERlc3luYyIgYW5kIGlzQnVpbGRlclRhYiBhbmQgc3RhdGVFbmFibGVkIGFuZCBpc0VuYWJsZWQpCiAgICAgICAgdWkuc2V0X3Zpc2libGUoYWFCdWlsZGVyW2ldLmZha2VZYXdMaW1pdCwgdmFycy5hY3RpdmVTdGF0ZSA9PSBpIGFuZCB1aS5nZXQoYWFCdWlsZGVyW2ldLmJvZHlZYXcpID09ICJDdXN0b20gRGVzeW5jIiBhbmQgaXNCdWlsZGVyVGFiIGFuZCBzdGF0ZUVuYWJsZWQgYW5kIGlzRW5hYmxlZCkKICAgICAgICB1aS5zZXRfdmlzaWJsZShhYUJ1aWxkZXJbaV0uZGVmZW5zaXZlQW50aUFpbSwgdmFycy5hY3RpdmVTdGF0ZSA9PSBpIGFuZCBpc0J1aWxkZXJUYWIgYW5kIHN0YXRlRW5hYmxlZCBhbmQgaXNFbmFibGVkKQoKICAgICAgICB1aS5zZXRfdmlzaWJsZShhYUJ1aWxkZXJbaV0uZGVmX3BpdGNoLCB1aS5nZXQoYWFCdWlsZGVyW2ldLmRlZmVuc2l2ZUFudGlBaW0pIGFuZCAodmFycy5hY3RpdmVTdGF0ZSA9PSBpIGFuZCBpc0J1aWxkZXJUYWIgYW5kIHN0YXRlRW5hYmxlZCBhbmQgaXNFbmFibGVkKSkKICAgICAgICB1aS5zZXRfdmlzaWJsZShhYUJ1aWxkZXJbaV0uZGVmX3BpdGNoU2xpZGVyICwgdWkuZ2V0KGFhQnVpbGRlcltpXS5kZWZlbnNpdmVBbnRpQWltKSBhbmQgKHZhcnMuYWN0aXZlU3RhdGUgPT0gaSBhbmQgaXNCdWlsZGVyVGFiIGFuZCBzdGF0ZUVuYWJsZWQgYW5kIHVpLmdldChhYUJ1aWxkZXJbaV0uZGVmX3BpdGNoKSA9PSAiQ3VzdG9tIiBhbmQgaXNFbmFibGVkKSkKICAgICAgICB1aS5zZXRfdmlzaWJsZShhYUJ1aWxkZXJbaV0uZGVmX3lhd0Jhc2UsIHVpLmdldChhYUJ1aWxkZXJbaV0uZGVmZW5zaXZlQW50aUFpbSkgYW5kICh2YXJzLmFjdGl2ZVN0YXRlID09IGkgYW5kIGlzQnVpbGRlclRhYiBhbmQgc3RhdGVFbmFibGVkIGFuZCBpc0VuYWJsZWQpKQogICAgICAgIHVpLnNldF92aXNpYmxlKGFhQnVpbGRlcltpXS5kZWZfeWF3LCB1aS5nZXQoYWFCdWlsZGVyW2ldLmRlZmVuc2l2ZUFudGlBaW0pIGFuZCAodmFycy5hY3RpdmVTdGF0ZSA9PSBpIGFuZCBpc0J1aWxkZXJUYWIgYW5kIHN0YXRlRW5hYmxlZCBhbmQgaXNFbmFibGVkKSkKICAgICAgICB1aS5zZXRfdmlzaWJsZShhYUJ1aWxkZXJbaV0uZGVmX3N3aXRjaFRpY2tzLCB1aS5nZXQoYWFCdWlsZGVyW2ldLmRlZmVuc2l2ZUFudGlBaW0pIGFuZCAodmFycy5hY3RpdmVTdGF0ZSA9PSBpIGFuZCBpc0J1aWxkZXJUYWIgYW5kIHN0YXRlRW5hYmxlZCBhbmQgdWkuZ2V0KGFhQnVpbGRlcltpXS5kZWZfeWF3KSA9PSAiU2xvdyBKaXR0ZXIiIGFuZCBpc0VuYWJsZWQpKQogICAgICAgIHVpLnNldF92aXNpYmxlKGFhQnVpbGRlcltpXS5kZWZfeWF3U3RhdGljLCB1aS5nZXQoYWFCdWlsZGVyW2ldLmRlZmVuc2l2ZUFudGlBaW0pIGFuZCAodmFycy5hY3RpdmVTdGF0ZSA9PSBpIGFuZCB1aS5nZXQoYWFCdWlsZGVyW2ldLmRlZl95YXcpIH49ICJPZmYiIGFuZCB1aS5nZXQoYWFCdWlsZGVyW2ldLmRlZl95YXcpIH49ICJTbG93IEppdHRlciIgYW5kIHVpLmdldChhYUJ1aWxkZXJbaV0uZGVmX3lhdykgfj0gIkwmUiIgYW5kIHVpLmdldChhYUJ1aWxkZXJbaV0uZGVmX3lhdykgfj0gIkRlbGF5IEppdHRlciIgYW5kIGlzQnVpbGRlclRhYiBhbmQgc3RhdGVFbmFibGVkIGFuZCBpc0VuYWJsZWQpKQogICAgICAgIHVpLnNldF92aXNpYmxlKGFhQnVpbGRlcltpXS5kZWZfeWF3TGVmdCwgdWkuZ2V0KGFhQnVpbGRlcltpXS5kZWZlbnNpdmVBbnRpQWltKSBhbmQgKHZhcnMuYWN0aXZlU3RhdGUgPT0gaSBhbmQgdWkuZ2V0KGFhQnVpbGRlcltpXS5kZWZfeWF3KSB+PSAiT2ZmIiBhbmQgKHVpLmdldChhYUJ1aWxkZXJbaV0uZGVmX3lhdykgPT0gIlNsb3cgSml0dGVyIiBvciB1aS5nZXQoYWFCdWlsZGVyW2ldLmRlZl95YXcpID09ICJMJlIiIG9yIHVpLmdldChhYUJ1aWxkZXJbaV0uZGVmX3lhdykgPT0gIkRlbGF5IEppdHRlciIpIGFuZCBpc0J1aWxkZXJUYWIgYW5kIHN0YXRlRW5hYmxlZCBhbmQgaXNFbmFibGVkKSkKICAgICAgICB1aS5zZXRfdmlzaWJsZShhYUJ1aWxkZXJbaV0uZGVmX3lhd1JpZ2h0LCB1aS5nZXQoYWFCdWlsZGVyW2ldLmRlZmVuc2l2ZUFudGlBaW0pIGFuZCAodmFycy5hY3RpdmVTdGF0ZSA9PSBpIGFuZCB1aS5nZXQoYWFCdWlsZGVyW2ldLmRlZl95YXcpIH49ICJPZmYiIGFuZCAodWkuZ2V0KGFhQnVpbGRlcltpXS5kZWZfeWF3KSA9PSAiU2xvdyBKaXR0ZXIiIG9yIHVpLmdldChhYUJ1aWxkZXJbaV0uZGVmX3lhdykgPT0gIkwmUiIgb3IgdWkuZ2V0KGFhQnVpbGRlcltpXS5kZWZfeWF3KSA9PSAiRGVsYXkgSml0dGVyIikgYW5kIGlzQnVpbGRlclRhYiBhbmQgc3RhdGVFbmFibGVkIGFuZCBpc0VuYWJsZWQpKQogICAgICAgIHVpLnNldF92aXNpYmxlKGFhQnVpbGRlcltpXS5kZWZfeWF3Sml0dGVyLCB1aS5nZXQoYWFCdWlsZGVyW2ldLmRlZmVuc2l2ZUFudGlBaW0pIGFuZCAodmFycy5hY3RpdmVTdGF0ZSA9PSBpIGFuZCB1aS5nZXQoYWFCdWlsZGVyW2ldLmRlZl95YXcpIH49ICJPZmYiIGFuZCBpc0J1aWxkZXJUYWIgYW5kIHN0YXRlRW5hYmxlZCBhbmQgaXNFbmFibGVkKSkKICAgICAgICB1aS5zZXRfdmlzaWJsZShhYUJ1aWxkZXJbaV0uZGVmX3dheUZpcnN0LCB1aS5nZXQoYWFCdWlsZGVyW2ldLmRlZmVuc2l2ZUFudGlBaW0pIGFuZCAodmFycy5hY3RpdmVTdGF0ZSA9PSBpIGFuZCB1aS5nZXQoYWFCdWlsZGVyW2ldLmRlZl95YXcpIH49ICJPZmYiIGFuZCB1aS5nZXQoYWFCdWlsZGVyW2ldLmRlZl95YXdKaXR0ZXIpID09ICIzLVdheSIgIGFuZCBpc0J1aWxkZXJUYWIgYW5kIHN0YXRlRW5hYmxlZCBhbmQgaXNFbmFibGVkKSkKICAgICAgICB1aS5zZXRfdmlzaWJsZShhYUJ1aWxkZXJbaV0uZGVmX3dheVNlY29uZCwgdWkuZ2V0KGFhQnVpbGRlcltpXS5kZWZlbnNpdmVBbnRpQWltKSBhbmQgKHZhcnMuYWN0aXZlU3RhdGUgPT0gaSBhbmQgdWkuZ2V0KGFhQnVpbGRlcltpXS5kZWZfeWF3KSB+PSAiT2ZmIiBhbmQgdWkuZ2V0KGFhQnVpbGRlcltpXS5kZWZfeWF3Sml0dGVyKSA9PSAiMy1XYXkiICBhbmQgaXNCdWlsZGVyVGFiIGFuZCBzdGF0ZUVuYWJsZWQgYW5kIGlzRW5hYmxlZCkpCiAgICAgICAgdWkuc2V0X3Zpc2libGUoYWFCdWlsZGVyW2ldLmRlZl93YXlUaGlyZCwgdWkuZ2V0KGFhQnVpbGRlcltpXS5kZWZlbnNpdmVBbnRpQWltKSBhbmQgKHZhcnMuYWN0aXZlU3RhdGUgPT0gaSBhbmQgdWkuZ2V0KGFhQnVpbGRlcltpXS5kZWZfeWF3KSB+PSAiT2ZmIiBhbmQgdWkuZ2V0KGFhQnVpbGRlcltpXS5kZWZfeWF3Sml0dGVyKSA9PSAiMy1XYXkiICBhbmQgaXNCdWlsZGVyVGFiIGFuZCBzdGF0ZUVuYWJsZWQgYW5kIGlzRW5hYmxlZCkpCiAgICAgICAgdWkuc2V0X3Zpc2libGUoYWFCdWlsZGVyW2ldLmRlZl95YXdKaXR0ZXJTdGF0aWMsIHVpLmdldChhYUJ1aWxkZXJbaV0uZGVmZW5zaXZlQW50aUFpbSkgYW5kICh2YXJzLmFjdGl2ZVN0YXRlID09IGkgYW5kIHVpLmdldChhYUJ1aWxkZXJbaV0uZGVmX3lhdykgfj0gIk9mZiIgYW5kIHVpLmdldChhYUJ1aWxkZXJbaV0uZGVmX3lhd0ppdHRlcikgfj0gIk9mZiIgYW5kIHVpLmdldChhYUJ1aWxkZXJbaV0uZGVmX3lhd0ppdHRlcikgfj0gIkwmUiIgYW5kIHVpLmdldChhYUJ1aWxkZXJbaV0uZGVmX3lhd0ppdHRlcikgfj0gIjMtV2F5IiBhbmQgaXNCdWlsZGVyVGFiIGFuZCBzdGF0ZUVuYWJsZWQgYW5kIGlzRW5hYmxlZCkpCiAgICAgICAgdWkuc2V0X3Zpc2libGUoYWFCdWlsZGVyW2ldLmRlZl95YXdKaXR0ZXJMZWZ0LCB1aS5nZXQoYWFCdWlsZGVyW2ldLmRlZmVuc2l2ZUFudGlBaW0pIGFuZCAodmFycy5hY3RpdmVTdGF0ZSA9PSBpIGFuZCB1aS5nZXQoYWFCdWlsZGVyW2ldLmRlZl95YXcpIH49ICJPZmYiIGFuZCB1aS5nZXQoYWFCdWlsZGVyW2ldLmRlZl95YXdKaXR0ZXIpID09ICJMJlIiIGFuZCBpc0J1aWxkZXJUYWIgYW5kIHN0YXRlRW5hYmxlZCBhbmQgaXNFbmFibGVkKSkKICAgICAgICB1aS5zZXRfdmlzaWJsZShhYUJ1aWxkZXJbaV0uZGVmX3lhd0ppdHRlclJpZ2h0LCB1aS5nZXQoYWFCdWlsZGVyW2ldLmRlZmVuc2l2ZUFudGlBaW0pIGFuZCAodmFycy5hY3RpdmVTdGF0ZSA9PSBpIGFuZCB1aS5nZXQoYWFCdWlsZGVyW2ldLmRlZl95YXcpIH49ICJPZmYiIGFuZCB1aS5nZXQoYWFCdWlsZGVyW2ldLmRlZl95YXdKaXR0ZXIpID09ICJMJlIiIGFuZCBpc0J1aWxkZXJUYWIgYW5kIHN0YXRlRW5hYmxlZCBhbmQgaXNFbmFibGVkKSkKICAgICAgICB1aS5zZXRfdmlzaWJsZShhYUJ1aWxkZXJbaV0uZGVmX2JvZHlZYXcsIHVpLmdldChhYUJ1aWxkZXJbaV0uZGVmZW5zaXZlQW50aUFpbSkgYW5kICh2YXJzLmFjdGl2ZVN0YXRlID09IGkgYW5kIGlzQnVpbGRlclRhYiBhbmQgc3RhdGVFbmFibGVkIGFuZCBpc0VuYWJsZWQpKQogICAgICAgIHVpLnNldF92aXNpYmxlKGFhQnVpbGRlcltpXS5kZWZfYm9keVlhd1N0YXRpYywgdWkuZ2V0KGFhQnVpbGRlcltpXS5kZWZlbnNpdmVBbnRpQWltKSBhbmQgKHZhcnMuYWN0aXZlU3RhdGUgPT0gaSBhbmQgdWkuZ2V0KGFhQnVpbGRlcltpXS5kZWZfYm9keVlhdykgfj0gIk9mZiIgYW5kIHVpLmdldChhYUJ1aWxkZXJbaV0uZGVmX2JvZHlZYXcpIH49ICJPcHBvc2l0ZSIgYW5kIHVpLmdldChhYUJ1aWxkZXJbaV0uZGVmX2JvZHlZYXcpIH49ICJDdXN0b20gRGVzeW5jIiBhbmQgaXNCdWlsZGVyVGFiIGFuZCBzdGF0ZUVuYWJsZWQgYW5kIGlzRW5hYmxlZCkpCiAgICAgICAgdWkuc2V0X3Zpc2libGUoYWFCdWlsZGVyW2ldLmRlZl9mYWtlWWF3TGltaXQsIHVpLmdldChhYUJ1aWxkZXJbaV0uZGVmZW5zaXZlQW50aUFpbSkgYW5kICh2YXJzLmFjdGl2ZVN0YXRlID09IGkgYW5kIHVpLmdldChhYUJ1aWxkZXJbaV0uZGVmX2JvZHlZYXcpID09ICJDdXN0b20gRGVzeW5jIiBhbmQgaXNCdWlsZGVyVGFiIGFuZCBzdGF0ZUVuYWJsZWQgYW5kIGlzRW5hYmxlZCkpCiAgICBlbmQKCiAgICBmb3IgaSwgZmVhdHVyZSBpbiBwYWlycyhtZW51LmFhVGFiKSBkbwogICAgICAgIGlmIHR5cGUoZmVhdHVyZSkgfj0gInRhYmxlIiB0aGVuCiAgICAgICAgICAgIHVpLnNldF92aXNpYmxlKGZlYXR1cmUsIGlzQUFUYWIgYW5kIGlzRW5hYmxlZCkKICAgICAgICBlbmQKCWVuZCAKCiAgICBmb3IgaSwgZmVhdHVyZSBpbiBwYWlycyhtZW51LmFhVGFiLm1hbnVhbFRhYikgZG8KICAgICAgICBpZiB0eXBlKGZlYXR1cmUpIH49ICJ0YWJsZSIgdGhlbgogICAgICAgICAgICB1aS5zZXRfdmlzaWJsZShmZWF0dXJlLCBpc0FBVGFiIGFuZCBpc0VuYWJsZWQgYW5kIHVpLmdldChtZW51LmFhVGFiLm1hbnVhbHMpIH49ICJPZmYiKQogICAgICAgIGVuZAoJZW5kIAoKICAgIGZvciBpLCBmZWF0dXJlIGluIHBhaXJzKG1lbnUuYnVpbGRlclRhYikgZG8KCQl1aS5zZXRfdmlzaWJsZShmZWF0dXJlLCBpc0J1aWxkZXJUYWIgYW5kIGlzRW5hYmxlZCkKCWVuZAoKICAgIGZvciBpLCBmZWF0dXJlIGluIHBhaXJzKG1lbnUudmlzdWFsc1RhYikgZG8KICAgICAgICBpZiB0eXBlKGZlYXR1cmUpIH49ICJ0YWJsZSIgdGhlbgogICAgICAgICAgICB1aS5zZXRfdmlzaWJsZShmZWF0dXJlLCBpc1Zpc3VhbHNUYWIgYW5kIGlzRW5hYmxlZCkKICAgICAgICBlbmQKCWVuZAogICAgCiAgICBmb3IgaSwgZmVhdHVyZSBpbiBwYWlycyhtZW51Lm1pc2NUYWIpIGRvCiAgICAgICAgaWYgdHlwZShmZWF0dXJlKSB+PSAidGFibGUiIHRoZW4KICAgICAgICAgICAgdWkuc2V0X3Zpc2libGUoZmVhdHVyZSwgaXNNaXNjVGFiIGFuZCBpc0VuYWJsZWQpCiAgICAgICAgZW5kCgllbmQKCiAgICB1aS5zZXRfdmlzaWJsZShtZW51Lm1pc2NUYWIuYW5pbWF0aW9ucywgdWkuZ2V0KG1lbnUubWlzY1RhYi5hbmltYXRpb25zRW5hYmxlZCkgYW5kIGlzTWlzY1RhYiBhbmQgaXNFbmFibGVkKQogICAgdWkuc2V0X3Zpc2libGUobWVudS5taXNjVGFiLnRyYXNoVGFsa192aWJvciwgdWkuZ2V0KG1lbnUubWlzY1RhYi50cmFzaFRhbGspIGFuZCAoaXNNaXNjVGFiIGFuZCBpc0VuYWJsZWQpKQogICAgdWkuc2V0X3Zpc2libGUobWVudS52aXN1YWxzVGFiLmluZGljYXRvcnNDbHIsIHVpLmdldChtZW51LnZpc3VhbHNUYWIuaW5kaWNhdG9yc1R5cGUpIGFuZCAoaXNWaXN1YWxzVGFiIGFuZCBpc0VuYWJsZWQpKQogICAgdWkuc2V0X3Zpc2libGUobWVudS52aXN1YWxzVGFiLmFycm93SW5kaWNhdG9yU3R5bGUsIHVpLmdldChtZW51LnZpc3VhbHNUYWIuYXJyb3dzaW5kZW5iKSBhbmQgKGlzVmlzdWFsc1RhYiBhbmQgaXNFbmFibGVkKSkKICAgIHVpLnNldF92aXNpYmxlKG1lbnUudmlzdWFsc1RhYi5hcnJvd0NsciwgdWkuZ2V0KG1lbnUudmlzdWFsc1RhYi5hcnJvd3NpbmRlbmIpIGFuZCB1aS5nZXQobWVudS52aXN1YWxzVGFiLmFycm93SW5kaWNhdG9yU3R5bGUpIGFuZCAoaXNWaXN1YWxzVGFiIGFuZCBpc0VuYWJsZWQpKQogICAgdWkuc2V0X3Zpc2libGUobWVudS52aXN1YWxzVGFiLmhpdGxvZ3Nfa3J1dGllLCB1aS5nZXQobWVudS52aXN1YWxzVGFiLmhpdGxvZ3NlbmIpIGFuZCAoaXNWaXN1YWxzVGFiIGFuZCBpc0VuYWJsZWQpKQogICAgdWkuc2V0X3Zpc2libGUobWVudS52aXN1YWxzVGFiLmhpdGxvZ3Nfa3J1dGllQ2xyLCB1aS5nZXQobWVudS52aXN1YWxzVGFiLmhpdGxvZ3NlbmIpIGFuZCAoaXNWaXN1YWxzVGFiIGFuZCBpc0VuYWJsZWQpKQogICAgdWkuc2V0X3Zpc2libGUobWVudS52aXN1YWxzVGFiLm1pbmltdW1fZGFtYWdlSW5kaWNhdG9yLCB1aS5nZXQobWVudS52aXN1YWxzVGFiLm1pbmltdW1fZGFtYWdlZW5iKSBhbmQgKGlzVmlzdWFsc1RhYiBhbmQgaXNFbmFibGVkKSkKICAgIHVpLnNldF92aXNpYmxlKG1lbnUudmlzdWFsc1RhYi5zaWRlSW5kaWNhdG9ycywgdWkuZ2V0KG1lbnUudmlzdWFsc1RhYi5zaWRlSW5kaWNhdG9yc2VuYikgYW5kIChpc1Zpc3VhbHNUYWIgYW5kIGlzRW5hYmxlZCkpCiAgICB1aS5zZXRfdmlzaWJsZShtZW51LmFhVGFiLm1hbnVhbHMsIHVpLmdldChtZW51LmFhVGFiLm1hbnVhbHNlbmIpIGFuZCAoaXNBQVRhYiBhbmQgaXNFbmFibGVkKSkgICAKCiAgICBmb3IgaSwgZmVhdHVyZSBpbiBwYWlycyhtZW51LmNvbmZpZ1RhYikgZG8KCQl1aS5zZXRfdmlzaWJsZShmZWF0dXJlLCBpc0NGR1RhYiBhbmQgaXNFbmFibGVkKQoJZW5kCgogICAgaWYgbm90IGlzRW5hYmxlZCBhbmQgbm90IHNhdmVkIHRoZW4KICAgICAgICBmdW5jLnJlc2V0QUFUYWIoKQogICAgICAgIHVpLnNldChyZWZzLmZzQm9keVlhdywgaXNFbmFibGVkKQogICAgICAgIHVpLnNldChyZWZzLmVuYWJsZWQsIGlzRW5hYmxlZCkKICAgICAgICBzYXZlZCA9IHRydWUKICAgIGVsc2VpZiBpc0VuYWJsZWQgYW5kIHNhdmVkIHRoZW4KICAgICAgICB1aS5zZXQocmVmcy5mc0JvZHlZYXcsIG5vdCBpc0VuYWJsZWQpCiAgICAgICAgdWkuc2V0KHJlZnMuZW5hYmxlZCwgaXNFbmFibGVkKQogICAgICAgIHNhdmVkID0gZmFsc2UKICAgIGVuZAogICAgZnVuYy5zZXRBQVRhYihub3QgaXNFbmFibGVkKQoKZW5kKQoKLS0gY2xhbnRhcmUKCmxvY2FsIGNsYW50YWdfYW5pbSA9IGZ1bmN0aW9uKHRleHQsIGluZGljZXMpCiAgICBsb2NhbCB0ZXh0X2FuaW0gPSAiICAgICAgICAgICAgICAgIiAuLiB0ZXh0IC4uICAgICAgICAgICAgICAgICAgICAgICAiIiAKICAgIGxvY2FsIHRpY2tpbnRlcnZhbCA9IGdsb2JhbHMudGlja2ludGVydmFsKCkKICAgIGxvY2FsIHRpY2tjb3VudCA9IGdsb2JhbHMudGlja2NvdW50KCkgKyBmdW5jLnRpbWVfdG9fdGlja3MoY2xpZW50LmxhdGVuY3koKSkKICAgIGxvY2FsIGkgPSB0aWNrY291bnQgLyBmdW5jLnRpbWVfdG9fdGlja3MoMC4yKQogICAgaSA9IG1hdGguZmxvb3IoaSAlICNpbmRpY2VzKQogICAgaSA9IGluZGljZXNbaSsxXSsxCiAgICByZXR1cm4gc3RyaW5nLnN1Yih0ZXh0X2FuaW0sIGksIGkrMTUpCmVuZAoKbG9jYWwgY2xhbnRhZyA9IHsKICAgIHN0ZWFtID0gc3RlYW13b3Jrcy5JU3RlYW1GcmllbmRzLAogICAgcHJldl9jdCA9ICIiLAogICAgb3JpZ19jdCA9ICIiLAogICAgZW5iID0gZmFsc2UsCn0KCmxvY2FsIGZ1bmN0aW9uIGdldF9vcmlnaW5hbF9jbGFudGFnKCkKICAgIGxvY2FsIGNsYW5faWQgPSBjdmFyLmNsX2NsYW5pZC5nZXRfaW50KCkKICAgIGlmIGNsYW5faWQgPT0gMCB0aGVuIHJldHVybiAiXDAiIGVuZAoKICAgIGxvY2FsIGNsYW5fY291bnQgPSBjbGFudGFnLnN0ZWFtLkdldENsYW5Db3VudCgpCiAgICBmb3IgaSA9IDAsIGNsYW5fY291bnQgZG8gCiAgICAgICAgbG9jYWwgZ3JvdXBfaWQgPSBjbGFudGFnLnN0ZWFtLkdldENsYW5CeUluZGV4KGkpCiAgICAgICAgaWYgZ3JvdXBfaWQgPT0gY2xhbl9pZCB0aGVuCiAgICAgICAgICAgIHJldHVybiBjbGFudGFnLnN0ZWFtLkdldENsYW5UYWcoZ3JvdXBfaWQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBjbGFudGFnX3NldCgpCiAgICBsb2NhbCBsdWFfbmFtZSA9ICJJbnZpbnNpYmxlLmx1YSIKICAgIGlmIHVpLmdldChtZW51Lm1pc2NUYWIuY2xhblRhZykgdGhlbgogICAgICAgIGlmIHVpLmdldCh1aS5yZWZlcmVuY2UoIk1pc2MiLCAiTWlzY2VsbGFuZW91cyIsICJDbGFuIHRhZyBzcGFtbWVyIikpIHRoZW4gcmV0dXJuIGVuZAoKCQlsb2NhbCBjbGFuX3RhZyA9IGNsYW50YWdfYW5pbShsdWFfbmFtZSwgezAsIDEsIDIsIDMsIDQsIDUsIDYsIDcsIDgsIDksIDEwLCAxMSwgMTEsIDExLCAxMSwgMTIsIDEzLCAxNCwgMTUsIDE2LCAxNywgMTgsIDE5LCAyMCwgMjEsIDIyLCAyMywgMjQsIDI1fSkKCiAgICAgICAgaWYgZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfZ2FtZV9ydWxlcygpLCAibV9nYW1lUGhhc2UiKSA9PSA1IHRoZW4KICAgICAgICAgICAgY2xhbl90YWcgPSBjbGFudGFnX2FuaW0oJ0ludmluc2libGUuZ3MnLCB7MTB9KQogICAgICAgICAgICBjbGllbnQuc2V0X2NsYW5fdGFnKGNsYW5fdGFnKQogICAgICAgIGVsc2VpZiBlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9nYW1lX3J1bGVzKCksICJtX3RpbWVVbnRpbE5leHRQaGFzZVN0YXJ0cyIpIH49IDAgdGhlbgogICAgICAgICAgICBjbGFuX3RhZyA9IGNsYW50YWdfYW5pbSgnSW52aW5zaWJsZS5ncycsIHsxMH0pCiAgICAgICAgICAgIGNsaWVudC5zZXRfY2xhbl90YWcoY2xhbl90YWcpCiAgICAgICAgZWxzZWlmIGNsYW5fdGFnIH49IGNsYW50YWcucHJldl9jdCAgdGhlbgogICAgICAgICAgICBjbGllbnQuc2V0X2NsYW5fdGFnKGNsYW5fdGFnKQogICAgICAgIGVuZAoKICAgICAgICBjbGFudGFnLnByZXZfY3QgPSBjbGFuX3RhZwogICAgICAgIGNsYW50YWcuZW5iID0gdHJ1ZQogICAgZWxzZWlmIGNsYW50YWcuZW5iID09IHRydWUgdGhlbgogICAgICAgIGNsaWVudC5zZXRfY2xhbl90YWcoZ2V0X29yaWdpbmFsX2NsYW50YWcoKSkKICAgICAgICBjbGFudGFnLmVuYiA9IGZhbHNlCiAgICBlbmQKZW5kCgpjbGFudGFnLnBhaW50ID0gZnVuY3Rpb24oKQogICAgaWYgZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSB+PSBuaWwgdGhlbgogICAgICAgIGlmIGdsb2JhbHMudGlja2NvdW50KCkgJSAyID09IDAgdGhlbgogICAgICAgICAgICBjbGFudGFnX3NldCgpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgpjbGFudGFnLnJ1bl9jb21tYW5kID0gZnVuY3Rpb24oZSkKICAgIGlmIGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkgfj0gbmlsIHRoZW4gCiAgICAgICAgaWYgZS5jaG9rZWRjb21tYW5kcyA9PSAwIHRoZW4KICAgICAgICAgICAgY2xhbnRhZ19zZXQoKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKY2xhbnRhZy5wbGF5ZXJfY29ubmVjdF9mdWxsID0gZnVuY3Rpb24oZSkKICAgIGlmIGNsaWVudC51c2VyaWRfdG9fZW50aW5kZXgoZS51c2VyaWQpID09IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkgdGhlbiAKICAgICAgICBjbGFudGFnLm9yaWdfY3QgPSBnZXRfb3JpZ2luYWxfY2xhbnRhZygpCiAgICBlbmQKZW5kCgpjbGFudGFnLnNodXRkb3duID0gZnVuY3Rpb24oKQogICAgY2xpZW50LnNldF9jbGFuX3RhZyhnZXRfb3JpZ2luYWxfY2xhbnRhZygpKQplbmQKCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInBhaW50IiwgY2xhbnRhZy5wYWludCkKY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygicnVuX2NvbW1hbmQiLCBjbGFudGFnLnJ1bl9jb21tYW5kKQpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJwbGF5ZXJfY29ubmVjdF9mdWxsIiwgY2xhbnRhZy5wbGF5ZXJfY29ubmVjdF9mdWxsKQpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJzaHV0ZG93biIsIGNsYW50YWcuc2h1dGRvd24pCgotLSBjbGFudGFnIGNsb3NlCgoKLS0gVW5zYWZlIGNoYXJnZQpsb2NhbCBmdW5jdGlvbiBpc192dWxuZXJhYmxlKCkKICAgIGZvciBfLCB2IGluIGlwYWlycyhlbnRpdHkuZ2V0X3BsYXllcnModHJ1ZSkpIGRvCiAgICAgICAgbG9jYWwgZmxhZ3MgPSAoZW50aXR5LmdldF9lc3BfZGF0YSh2KSkuZmxhZ3MKCiAgICAgICAgaWYgYml0LmJhbmQoZmxhZ3MsIGJpdC5sc2hpZnQoMSwgMTEpKSB+PSAwIHRoZW4KICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICBlbmQKICAgIGVuZAoKICAgIHJldHVybiBmYWxzZQplbmQKCmxvY2FsIGF1dG9fZGlzY2hhcmdlID0gZnVuY3Rpb24oY21kKQogICAgaWYgbm90IHVpLmdldChtZW51Lm1pc2NUYWIudW5zYWZlY2hhcmhnZSkgb3IgdWkuZ2V0KHJlZnMucXVpY2tQZWVrWzJdKSBvciBub3QgdWkuZ2V0KHJlZnMuZHRbMl0pIG9yIAogICAgKGVudGl0eS5nZXRfY2xhc3NuYW1lKGVudGl0eS5nZXRfcGxheWVyX3dlYXBvbihlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpKSkgfj0gIkNXZWFwb25TU0cwOCIgYW5kIGVudGl0eS5nZXRfY2xhc3NuYW1lKGVudGl0eS5nZXRfcGxheWVyX3dlYXBvbihlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpKSkgfj0gIkNXZWFwb25BV1AiKSB0aGVuIHJldHVybiBlbmQKCiAgICBsb2NhbCB2ZWxfMiA9IG1hdGguZmxvb3IoZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX3ZlY1ZlbG9jaXR5WzJdIikpCgogICAgaWYgaXNfdnVsbmVyYWJsZSgpIGFuZCB2ZWxfMiA+IDIwIHRoZW4KICAgICAgICBjbWQuaW5fanVtcCA9IGZhbHNlCiAgICAgICAgY21kLmRpc2NoYXJnZV9wZW5kaW5nID0gdHJ1ZQogICAgZW5kCmVuZAoKY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygic2V0dXBfY29tbWFuZCIsIGZ1bmN0aW9uKGNtZCkKICAgIGF1dG9fZGlzY2hhcmdlKGNtZCkKZW5kKQoKLS0gZW5kCmxvY2FsIGNoYXRfc3BhbW1lciA9IHt9CgpjaGF0X3NwYW1tZXIucGhyYXNlcyA9IHsKICAgIGtpbGwgPSB7CiAgICAgICAgeyJjamNiIFtlcSBuZGZobSIsICLRgdC+0YHQuCDRhdGD0Lkg0YLQstCw0YDRjCJ9LAogICAgICAgIHsi0LrQsNC6INGPINGC0LXQsdGPINGC0YDQsNGF0L3Rg9C7IiwgItC60YDRg9GC0YvRiNC60LAiLCAi0LvQuNCy0LDQuSDRgSDQv9C+0LfQvtGA0L7QvCJ9LAogICAgICAgIHsi0Y8g0L7Qv9GP0YLRjCDRgtC10LHRjyDQstGL0LXQsdCw0LsiLCAi0YMg0LzQtdC90Y8g0LDQsCDQsNGF0YPQtdC90L3Ri9C1IiwgItGF0YPQuSDQv9C+0L/QsNC00LXRiNGMIn0sCiAgICAgICAgeyLQtNC+0LvQsdC+0LXQsSDQvtC/0Y/RgtGMINC80LjRgdGB0L3Rg9C7IiwgIkludmluc2libGUg0L/QvtC80L7Qs9C70LAiLCAi0YEg0LTQtdGE0L7Qu9GCINC/0YDQtdGB0LXRgtC+0Lwg0LHQtdCz0LDRjiDQuCDQtdCx0YMg0YXQsNGF0LDQsNGF0LDRhSJ9LAogICAgICAgIHsiIOOAguKcsDMwMu+8n0ludmluc2libGXinLDjgIIifSwKICAgICAgICB7ItGB0L7RgNGA0Lgg0LfQsCDQt9GD0LHRiyIsICLQuNC00Lgg0YHQvtCx0LjRgNCw0LkifSwKICAgICAgICB7ItGB0L3QvtCy0LAg0YPQsdC40Lsg0L3Rg9Cx0LAifSwKICAgICAgICB7ItGB0YPQvdC00YPRh9C10Log0LIg0Y/QvdC00LXQutGBINC10LTRgyDRgdC+0LHRgNCw0Lsg0YPQttC1PyIsICLQsCDRgtC+INGPINC20YDQsNGC0Ywg0YXQvtGH0YMifSwKICAgICAgICB7ImZbZltmW2ZbW2ZbIiwgItCw0YXQsNGF0LDRhdCw0YXQsNGF0YXQsCIsICLQtNC+0LvQsdC+0LXQsSDQvdCw0LnRgSDQutGE0LMifSwKICAgICAgICB7ItCi0JXQodCiINCg0J7QodCf0KDQq9CW0JXQp9Ca0JggSW52aW5zaWJsZSBHQU1FU0VOU0UifSwKICAgICAgICB7ItGH0LvQtdC90Y/QutGDINC/0L7RgdC+0YHQsNC7IiwgItC+0L/Rj9GC0YwiLCAi0LXQsdCw0L3QsNGCINC60L7Qs9C00LAg0YPQttC1INC40LPRgNCw0YLRjCDQvdCw0YPRh9C40YjRjNGB0Y8ifSwKICAgICAgICB7IvCdlaTwnZWZ8J2VmvCdlaUg8J2VnfCdlabwnZWSIPCdlabwnZWk8J2VlvCdlaMg8J2Vl/CdlZrwnZWf8J2VlfCdlZbwnZWVIn0sCiAgICAgICAgeyLQkNCl0KXQkNCQ0KXQkCIsItCl0JDQpdCQ0KXQkNCl0JAiLCLQtdCx0LDRgtGMINGC0Ysg0L3QuNGJ0LjQuSDRhdGD0LXRgdC+0YEifSwKICAgICAgICB7InN0YXkgd2l0aCB1cyAtIEludmluc2libGUifSwKICAgICAgICB7ItCaINCbINCeINCfINCdINCVINCfINCrINCiINCQINCZINChINCvINCfINCeINCRINCVINCUINCYINCiINCsIn0sCiAgICAgICAgeyIxLiJ9LAogICAgfSwKCiAgICBkZWF0aCA9IHsKICAgICAgICB7InQsa2Z5IHJqeXh0eXNxIiwgItC10LHQu9Cw0L0g0LrQvtC90YfQtdC90YvQuSIsICLRgtGLINC60LDQuiDRg9Cx0LjQuyIsICLRjyDQvdCwINCy0LDQvdCy0LXQtSDQsdGL0LsifSwKICAgICAgICB7ItCx0LvRj9GC0Ywg0L7Qv9GP0YLRjCDQsNC90YDQtdCzIiwgItC10LHRg9GH0LjQuSDRgdC10YDQstC10YAiLCAi0Y8g0LfQsNC10LHQsNC70YHRjyDRg9C20LUifSwKICAgICAgICB7ItGH0LjRgiDQvNC40YHQvdGD0Lsg0YHQvdC+0LLQsCJ9LAogICAgICAgIHsi0YLRiyDQtdCx0LvQsNC9IiwgItC60LDQuiDRgtCw0Log0LjQs9GA0LDRgtGMINC80L7QttC90L4iLCAi0L/RgNC+0YHRgtC+INC/0L7QsdC10LbQsNGC0YwifSwKICAgICAgICB7ItC40LTQuCDQutC+0YDQvtCy0YMg0LTQvtC4IiwgItGC0LLQsNGA0Ywg0YHQtdC70YzRgdC60LDRjyIsICLQt9Cw0LXQsdCw0LvQsCDRg9C20LUg0LrQtCDQv9C+0YDRgtC40YLRjCJ9LAogICAgICAgIHsi0Lgg0Y3RgtC+INC80LXQvdGPINGD0LHQuNC70L4iLCAi0L/QuNC30LTQtdGGIn0sCiAgICAgICAgeyLQsdC70Y/RgtGMINC/0LjQt9C00LXRhiIsICLRgdC90L7QstCwINC00LDQu9Cx0LDRkdCxINGD0LHQuNC7In0sCiAgICAgICAgeyLQvtC9INC20LUiLCAi0L3QtSDQv9C+0L3QuNC80LDQtdGCIiwgItGH0YLQviDQtdC80YMg0L/QvtCy0LXQt9C70L4ifSwKICAgICAgICB7ItC/0LjQt9C00LXRhiIsICLRh9C40YLRg9C70Y8g0L7QsdC+0YHRgNCw0LvRgdGPIn0KICAgIH0KfQoKY2hhdF9zcGFtbWVyLnBocmFzZV9jb3VudCA9IHsKICAgIGRlYXRoID0gMCwKICAgIGtpbGwgPSAwLAp9CgpjaGF0X3NwYW1tZXIuaGFuZGxlID0gZnVuY3Rpb24oZSkKICAgIGlmIG5vdCB1aS5nZXQobWVudS5taXNjVGFiLnRyYXNoVGFsaykgdGhlbgogICAgICAgIHJldHVybgogICAgZW5kCgogICAgbG9jYWwgcGxheWVyID0gZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKQoKICAgIGlmIHBsYXllciA9PSBuaWwgdGhlbgogICAgICAgIHJldHVybgogICAgZW5kCgogICAgbG9jYWwgdmljdGltID0gY2xpZW50LnVzZXJpZF90b19lbnRpbmRleChlLnVzZXJpZCkKCiAgICBpZiB2aWN0aW0gPT0gbmlsIHRoZW4KICAgICAgICByZXR1cm4KICAgIGVuZAoKICAgIGxvY2FsIGF0dGFja2VyID0gY2xpZW50LnVzZXJpZF90b19lbnRpbmRleChlLmF0dGFja2VyKQoKICAgIGlmIGF0dGFja2VyID09IG5pbCB0aGVuCiAgICAgICAgcmV0dXJuCiAgICBlbmQKCiAgICBjaGF0X3NwYW1tZXIucGhyYXNlX2NvdW50LmRlYXRoID0gY2hhdF9zcGFtbWVyLnBocmFzZV9jb3VudC5kZWF0aCArIDEKICAgIGlmIGNoYXRfc3BhbW1lci5waHJhc2VfY291bnQuZGVhdGggPiAjY2hhdF9zcGFtbWVyLnBocmFzZXMuZGVhdGggdGhlbgogICAgICAgIGNoYXRfc3BhbW1lci5waHJhc2VfY291bnQuZGVhdGggPSAxCiAgICBlbmQKCiAgICBjaGF0X3NwYW1tZXIucGhyYXNlX2NvdW50LmtpbGwgPSBjaGF0X3NwYW1tZXIucGhyYXNlX2NvdW50LmtpbGwgKyAxCiAgICBpZiBjaGF0X3NwYW1tZXIucGhyYXNlX2NvdW50LmtpbGwgPiAjY2hhdF9zcGFtbWVyLnBocmFzZXMua2lsbCB0aGVuCiAgICAgICAgY2hhdF9zcGFtbWVyLnBocmFzZV9jb3VudC5raWxsID0gMQogICAgZW5kCgogICAgbG9jYWwgcGhyYXNlID0gewogICAgICAgIGRlYXRoID0gY2hhdF9zcGFtbWVyLnBocmFzZXMuZGVhdGhbY2hhdF9zcGFtbWVyLnBocmFzZV9jb3VudC5kZWF0aF0sCiAgICAgICAga2lsbCA9IGNoYXRfc3BhbW1lci5waHJhc2VzLmtpbGxbY2hhdF9zcGFtbWVyLnBocmFzZV9jb3VudC5raWxsXSwKICAgIH0KCiAgICBpZiBmdW5jLmluY2x1ZGVzKHVpLmdldChtZW51Lm1pc2NUYWIudHJhc2hUYWxrX3ZpYm9yKSwgIktpbGwiKSB0aGVuCiAgICAgICAgaWYgYXR0YWNrZXIgPT0gcGxheWVyIGFuZCB2aWN0aW0gfj0gcGxheWVyIHRoZW4KICAgICAgICAgICAgZm9yIGkgPSAxLCAjcGhyYXNlLmtpbGwgZG8KICAgICAgICAgICAgICAgIGNsaWVudC5kZWxheV9jYWxsKGkqMiwgZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIGNsaWVudC5leGVjKCgic2F5ICVzIik6Zm9ybWF0KHBocmFzZS5raWxsW2ldKSkKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBpZiBmdW5jLmluY2x1ZGVzKHVpLmdldChtZW51Lm1pc2NUYWIudHJhc2hUYWxrX3ZpYm9yKSwgIkRlYXRoIikgdGhlbgogICAgICAgIGlmIGF0dGFja2VyIH49IHBsYXllciBhbmQgdmljdGltID09IHBsYXllciB0aGVuCiAgICAgICAgICAgIGZvciBpID0gMSwgI3BocmFzZS5kZWF0aCBkbwogICAgICAgICAgICAgICAgY2xpZW50LmRlbGF5X2NhbGwoaSoyLCBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgY2xpZW50LmV4ZWMoKCJzYXkgJXMiKTpmb3JtYXQocGhyYXNlLmRlYXRoW2ldKSkKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgpsb2NhbCBub3RpZnlfbG9sID0ge30KCmZ1bmN0aW9uIG5vdGlmeV9yZW5kZXIoKSAKICAgIGxvY2FsIFgsIFkgPSBjbGllbnQuc2NyZWVuX3NpemUoKQogICAgZm9yIGksIGluZm9fbm90aSBpbiBpcGFpcnMobm90aWZ5X2xvbCkgZG8KICAgICAgICBpZiBpID4gNyB0aGVuCiAgICAgICAgICAgIHRhYmxlLnJlbW92ZShub3RpZnlfbG9sLCBpKQogICAgICAgIGVuZAogICAgICAgIGlmIGluZm9fbm90aS50ZXh0IH49IG5pbCBhbmQgaW5mb19ub3RpLnRleHQgfj0gIiIgdGhlbgogICAgICAgICAgICBsb2NhbCBjb2xvciA9IGluZm9fbm90aS5jb2xvcgogICAgICAgICAgICBpZiBpbmZvX25vdGkudGltZXIgKyAzLjcgPCBnbG9iYWxzLnJlYWx0aW1lKCkgdGhlbgogICAgICAgICAgICAgICAgaW5mb19ub3RpLnkgPSBmdW5jLmxlcnAoaW5mb19ub3RpLnksIFkgKyAxNTAsIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiAxLjUpCiAgICAgICAgICAgICAgICBpbmZvX25vdGkuYWxwaGEgPSBmdW5jLmxlcnAoaW5mb19ub3RpLmFscGhhLCAxMzUsIGdsb2JhbHMuZnJhbWV0aW1lKCkgKiA0LjUpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGluZm9fbm90aS55ID0gZnVuYy5sZXJwKGluZm9fbm90aS55LCBZIC0gMTAwLCBnbG9iYWxzLmZyYW1ldGltZSgpICogMS41KQogICAgICAgICAgICAgICAgaW5mb19ub3RpLmFscGhhID0gZnVuYy5sZXJwKGluZm9fbm90aS5hbHBoYSwgMTM1LCBnbG9iYWxzLmZyYW1ldGltZSgpICogNC41KQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgd2lkdGggPSB2ZWN0b3IocmVuZGVyZXIubWVhc3VyZV90ZXh0KCJjIiwgaW5mb19ub3RpLnRleHQpKQogICAgICAgIGxvY2FsIHIsZyxiLGEgPSB1aS5nZXQobWVudS52aXN1YWxzVGFiLmhpdGxvZ3Nfa3J1dGllQ2xyKQoKICAgICAgICBnbG93X21vZHVsZShYIC8yIC0gd2lkdGgueCAvMiAtIDEwLCBpbmZvX25vdGkueSAtIGkqMzUgLSA0OCAsd2lkdGgueCArIDIwLCB3aWR0aC55ICsgOCwgMjAsIDAsIHtyLGcsYixpbmZvX25vdGkuYWxwaGEgLSAyNTV9LCB7MTMsMTMsMTMsaW5mb19ub3RpLmFscGhhfSkKICAgICAgICByZW5kZXJlci50ZXh0KFggLyAyIC0gd2lkdGgueCAvMiwgaW5mb19ub3RpLnkgLSBpKjM1IC0gNDQsIDI1NSwyNTUsMjU1LGluZm9fbm90aS5hbHBoYSwgIiIsIG5pbCwgaW5mb19ub3RpLnRleHQpCgogICAgICAgIGlmIGluZm9fbm90aS50aW1lciArIDQuMCA8IGdsb2JhbHMucmVhbHRpbWUoKSB0aGVuCiAgICAgICAgICAgIHRhYmxlLnJlbW92ZShub3RpZnlfbG9sLGkpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgpmdW5jdGlvbiBuZXdfbm90aWZ5KHN0cmluZywgciwgZywgYiwgYSkKICAgIGxvY2FsIG5vdGlmaWNhdGlvbiA9IHsKICAgICAgICB0ZXh0ID0gc3RyaW5nLAogICAgICAgIHRpbWVyID0gZ2xvYmFscy5yZWFsdGltZSgpLAogICAgICAgIGNvbG9yID0geyByLCBnLCBiLCBhIH0sCiAgICAgICAgYWxwaGEgPSAwCiAgICB9CgogICAgbG9jYWwgWSA9IHNlbGVjdCgyLCBjbGllbnQuc2NyZWVuX3NpemUoKSkKCiAgICBpZiAjbm90aWZ5X2xvbCA9PSAwIHRoZW4KICAgICAgICBub3RpZmljYXRpb24ueSA9IFkgKyAyMAogICAgZWxzZQogICAgICAgIGxvY2FsIGxhc3ROb3RpZmljYXRpb24gPSBub3RpZnlfbG9sWyNub3RpZnlfbG9sXQogICAgICAgIG5vdGlmaWNhdGlvbi55ID0gbGFzdE5vdGlmaWNhdGlvbi55ICsgMjAgCiAgICBlbmQKCiAgICB0YWJsZS5pbnNlcnQobm90aWZ5X2xvbCwgbm90aWZpY2F0aW9uKQplbmQKCmxvY2FsIGhpdGdyb3VwX25hbWVzID0geyJnZW5lcmljIiwgImhlYWQiLCAiY2hlc3QiLCAic3RvbWFjaCIsICJsZWZ0IGFybSIsICJyaWdodCBhcm0iLCAibGVmdCBsZWciLCAicmlnaHQgbGVnIiwgIm5lY2siLCAiPyIsICJnZWFyIn0KCmxvY2FsIGZ1bmN0aW9uIGFpbV9oaXQoZSkKICAgIGxvY2FsIGdyb3VwID0gaGl0Z3JvdXBfbmFtZXNbZS5oaXRncm91cCArIDFdIG9yICI/IgoKICAgIC0taHR0cHM6Ly9kb2NzLmdhbWVzZW5zZS5ncy9kb2NzL2V2ZW50cy9haW1faGl0CiAgICBpZiBmdW5jLmluY2x1ZGVzKHVpLmdldChtZW51LnZpc3VhbHNUYWIuaGl0bG9nc19rcnV0aWUpLCAiSGl0IikgdGhlbgogICAgICAgIG5ld19ub3RpZnkoc3RyaW5nLmZvcm1hdCgiXGE3NURCNjdGRuKaoCB8ICBcYTc1REI2N0ZGSGl0IFxhRkZGRkZGRkYlcyBpbiB0aGUgJXMgZm9yIFxhNzVEQjY3RkYlZCBcYUZGRkZGRkZGZGFtYWdlICglZCBoZWFsdGggcmVtYWluaW5nKSIsIGVudGl0eS5nZXRfcGxheWVyX25hbWUoZS50YXJnZXQpLCBncm91cCwgZS5kYW1hZ2UsIGVudGl0eS5nZXRfcHJvcChlLnRhcmdldCwgIm1faUhlYWx0aCIpICksIDI1NSwyNTUsMjU1LDI1NSkgCiAgICBlbmQKZW5kCgpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJhaW1faGl0IiwgYWltX2hpdCkKCmxvY2FsIGZ1bmN0aW9uIGFpbV9taXNzKGUpCiAgICBsb2NhbCBncm91cCA9IGhpdGdyb3VwX25hbWVzW2UuaGl0Z3JvdXAgKyAxXSBvciAiPyIKCiAgICBpZiBmdW5jLmluY2x1ZGVzKHVpLmdldChtZW51LnZpc3VhbHNUYWIuaGl0bG9nc19rcnV0aWUpLCAiTWlzcyIpIHRoZW4KICAgICAgICBuZXdfbm90aWZ5KHN0cmluZy5mb3JtYXQoIlxhRTA1QzVDRkbimqAgfCAgXGFFMDVDNUNGRk1pc3NlZCBcYUZGRkZGRkZGJXMgKCVzKSBkdWUgdG8gXGFFMDVDNUNGRiVzIiwgZW50aXR5LmdldF9wbGF5ZXJfbmFtZShlLnRhcmdldCksIGdyb3VwLCBlLnJlYXNvbiksIDI1NSwyNTUsMjU1LDI1NSkKICAgIGVuZAplbmQKCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soImFpbV9taXNzIiwgYWltX21pc3MpCgpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCdwbGF5ZXJfZGVhdGgnLCBjaGF0X3NwYW1tZXIuaGFuZGxlKQoKY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygnc2h1dGRvd24nLCBmdW5jdGlvbiAoKQogICAgY2xpZW50LnNldF9jbGFuX3RhZygiXDAiKQogICAgdHJhdmVyc2VfdGFibGVfb24ocmVmcykKZW5kKQoKY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygncGFpbnRfdWknLCBmdW5jdGlvbiAoKQogICAgbG9jYWwgaXNBQVRhYiA9IHVpLmdldCh0YWJQaWNrZXIpID09ICJBbnRpLWFpbSIgYW5kIHVpLmdldChhYVRhYnMpID09ICJPdGhlciIKICAgIGlmIGlzQUFUYWIgdGhlbgogICAgICAgIHRyYXZlcnNlX3RhYmxlX29uKGJpbmRzKQogICAgICAgIGVsc2UKICAgICAgICAgICAgdHJhdmVyc2VfdGFibGUoYmluZHMpCiAgICBlbmQgCiAgICBub3RpZnlfcmVuZGVyKCkKICAgIGlmIChnbG9iYWxzLm1hcG5hbWUoKSB+PSB2YXJzLm1hcG5hbWUpIHRoZW4KICAgICAgICB2YXJzLmJyZWFrZXIuY21kID0gMAogICAgICAgIHZhcnMuYnJlYWtlci5kZWZlbnNpdmUgPSAwCiAgICAgICAgdmFycy5icmVha2VyLmRlZmVuc2l2ZV9jaGVjayA9IDAKICAgICAgICB2YXJzLm1hcG5hbWUgPSBnbG9iYWxzLm1hcG5hbWUoKQogICAgZW5kCmVuZCkKCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInJvdW5kX3N0YXJ0IiwgZnVuY3Rpb24oKQogICAgdmFycy5icmVha2VyLmNtZCA9IDAKICAgIHZhcnMuYnJlYWtlci5kZWZlbnNpdmUgPSAwCiAgICB2YXJzLmJyZWFrZXIuZGVmZW5zaXZlX2NoZWNrID0gMAplbmQpCgpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJwbGF5ZXJfY29ubmVjdF9mdWxsIiwgZnVuY3Rpb24oZSkKICAgIGxvY2FsIGVudCA9IGNsaWVudC51c2VyaWRfdG9fZW50aW5kZXgoZS51c2VyaWQpCiAgICBpZiBlbnQgPT0gZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSB0aGVuCiAgICAgICAgdmFycy5icmVha2VyLmNtZCA9IDAKICAgICAgICB2YXJzLmJyZWFrZXIuZGVmZW5zaXZlID0gMAogICAgICAgIHZhcnMuYnJlYWtlci5kZWZlbnNpdmVfY2hlY2sgPSAwCiAgICBlbmQKZW5kKQotLSBjbG9zZSB0cmFzaAoKLS0gQGNvbnNvbGUgZmlsdGVyCnVpLnNldF9jYWxsYmFjayhtZW51Lm1pc2NUYWIuZmlsdGVyY29ucywgZnVuY3Rpb24oKQogICAgaWYgbWVudS5taXNjVGFiLmZpbHRlcmNvbnMgdGhlbgogICAgICAgIGN2YXIuZGV2ZWxvcGVyOnNldF9pbnQoMCkKICAgICAgICBjdmFyLmNvbl9maWx0ZXJfZW5hYmxlOnNldF9pbnQoMSkKICAgICAgICBjdmFyLmNvbl9maWx0ZXJfdGV4dDpzZXRfc3RyaW5nKCJJcldMNTEwNlRaWktORlB6NFA0R2wzcFNOP0ozNzBmNWhpMzczWmpQZyVWT1ZoNmxOIikKICAgICAgICBjbGllbnQuZXhlYygiY29uX2ZpbHRlcl9lbmFibGUgMSIpCiAgICBlbHNlCiAgICAgICAgY3Zhci5jb25fZmlsdGVyX2VuYWJsZTpzZXRfaW50KDApCiAgICAgICAgY3Zhci5jb25fZmlsdGVyX3RleHQ6c2V0X3N0cmluZygiIikKICAgICAgICBjbGllbnQuZXhlYygiY29uX2ZpbHRlcl9lbmFibGUgMCIpCiAgICBlbmQKZW5kKQoKY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygic2h1dGRvd24iLCBmdW5jdGlvbigpCiAgICBjdmFyLmNvbl9maWx0ZXJfZW5hYmxlOnNldF9pbnQoMCkKICAgIGN2YXIuY29uX2ZpbHRlcl90ZXh0OnNldF9zdHJpbmcoIiIpCiAgICBjbGllbnQuZXhlYygiY29uX2ZpbHRlcl9lbmFibGUgMCIpCmVuZCkKCmxvY2FsIGZmaSA9IHJlcXVpcmUoImZmaSIpCmxvY2FsIHZlY3RvciA9IHJlcXVpcmUoInZlY3RvciIpCmZ1bmN0aW9uIENsYW1wKHZhbHVlLCBtaW4sIG1heCkgcmV0dXJuIG1hdGgubWluKG1hdGgubWF4KHZhbHVlLCBtaW4pLCBtYXgpIGVuZApsb2NhbCBmdW5jdGlvbiBBbmdsZU1vZGlmaWVyKGEpIHJldHVybiAoMzYwIC8gNjU1MzYpICogYml0LmJhbmQobWF0aC5mbG9vcihhICogKDY1NTM2IC8gMzYwKSksIDY1NTM1KSBlbmQKbG9jYWwgZnVuY3Rpb24gQXBwcm9hY2godGFyZ2V0LCB2YWx1ZSwgc3BlZWQpCgl0YXJnZXQgPSBBbmdsZU1vZGlmaWVyKHRhcmdldCkKCXZhbHVlID0gQW5nbGVNb2RpZmllcih2YWx1ZSkKCWxvY2FsIGRlbHRhID0gdGFyZ2V0IC0gdmFsdWUKCWlmIHNwZWVkIDwgMCB0aGVuIHNwZWVkID0gLXNwZWVkIGVuZAoJaWYgZGVsdGEgPCAtMTgwIHRoZW4gZGVsdGEgPSBkZWx0YSArIDM2MAoJZWxzZWlmIGRlbHRhID4gMTgwIHRoZW4gZGVsdGEgPSBkZWx0YSAtIDM2MCBlbmQKCWlmIGRlbHRhID4gc3BlZWQgdGhlbiB2YWx1ZSA9IHZhbHVlICsgc3BlZWQKCWVsc2VpZiBkZWx0YSA8IC1zcGVlZCB0aGVuIHZhbHVlID0gdmFsdWUgLSBzcGVlZAogICAgZWxzZSB2YWx1ZSA9IHRhcmdldAoJZW5kCglyZXR1cm4gdmFsdWUKZW5kCmxvY2FsIGZ1bmN0aW9uIE5vcm1hbGl6ZUFuZ2xlKGFuZ2xlKQogICAgaWYgYW5nbGUgPT0gbmlsIHRoZW4gcmV0dXJuIDAgZW5kCgl3aGlsZSBhbmdsZSA+IDE4MCBkbyBhbmdsZSA9IGFuZ2xlIC0gMzYwIGVuZAoJd2hpbGUgYW5nbGUgPCAtMTgwIGRvIGFuZ2xlID0gYW5nbGUgKyAzNjAgZW5kCglyZXR1cm4gYW5nbGUKZW5kCmxvY2FsIGZ1bmN0aW9uIEFuZ2xlRGlmZmVyZW5jZShkZXN0X2FuZ2xlLCBzcmNfYW5nbGUpCglsb2NhbCBkZWx0YSA9IG1hdGguZm1vZChkZXN0X2FuZ2xlIC0gc3JjX2FuZ2xlLCAzNjApCglpZiBkZXN0X2FuZ2xlID4gc3JjX2FuZ2xlIHRoZW4KCQlpZiBkZWx0YSA+PSAxODAgdGhlbiBkZWx0YSA9IGRlbHRhIC0gMzYwIGVuZAoJZWxzZQoJCWlmIGRlbHRhIDw9IC0xODAgdGhlbiBkZWx0YSA9IGRlbHRhICsgMzYwIGVuZAoJZW5kCglyZXR1cm4gZGVsdGEKZW5kCmxvY2FsIGZ1bmN0aW9uIEFuZ2xlVmVjdG9yKHBpdGNoLCB5YXcpCiAgICBpZiBwaXRjaCB+PSBuaWwgYW5kIHlhdyB+PSBuaWwgdGhlbiAKICAgICAgICBsb2NhbCBwLCB5ID0gbWF0aC5yYWQocGl0Y2gpLCBtYXRoLnJhZCh5YXcpCiAgICAgICAgbG9jYWwgc3AsIGNwLCBzeSwgY3kgPSBtYXRoLnNpbihwKSwgbWF0aC5jb3MocCksIG1hdGguc2luKHkpLCBtYXRoLmNvcyh5KQogICAgICAgIHJldHVybiBjcCpjeSwgY3Aqc3ksIC1zcAogICAgZW5kCiAgICByZXR1cm4gMCwwLDAKZW5kCmxvY2FsIGZ1bmN0aW9uIENhbGNBbmdsZShsb2NhbHBsYXllcnhwb3MsIGxvY2FscGxheWVyeXBvcywgZW5lbXl4cG9zLCBlbmVteXlwb3MpCiAgICBsb2NhbCByZWxhdGl2ZXlhdyA9IG1hdGguYXRhbiggKGxvY2FscGxheWVyeXBvcyAtIGVuZW15eXBvcykgLyAobG9jYWxwbGF5ZXJ4cG9zIC0gZW5lbXl4cG9zKSApCiAgICByZXR1cm4gcmVsYXRpdmV5YXcgKiAxODAgLyBtYXRoLnBpCmVuZApsb2NhbCBmdW5jdGlvbiBBbmdsZUZyb21WZWN0b3JzKGEsIGIpCiAgICBsb2NhbCBhbmdsZXMgPSB7fQogICAgbG9jYWwgZGVsdGEgPSBhIC0gYgogICAgbG9jYWwgaHlwID0gZGVsdGE6bGVuZ3RoMmQoKQogICAgYW5nbGVzLnkgPSBtYXRoLmF0YW4oZGVsdGEueSAvIGRlbHRhLngpICogNTcuMjk1Nzc5NTEzMQogICAgYW5nbGVzLnggPSBtYXRoLmF0YW4oZGVsdGEueiAvIGh5cCkgKiA1Ny4yOTU3Nzk1MTMxCiAgICBhbmdsZXMueiA9IDAuMAogICAgaWYgZGVsdGEueCA+PSAwLjAgdGhlbiBhbmdsZXMueSA9IGFuZ2xlcy55ICsgMTgwLjAgZW5kCiAgICByZXR1cm4gYW5nbGVzCmVuZApsb2NhbCBmdW5jdGlvbiBEZWdUb1JhZChEZWcpIHJldHVybiBEZWcgKiAobWF0aC5waSAvIDE4MCkgZW5kCmxvY2FsIGZ1bmN0aW9uIFJhZFRvRGVnKFJhZCkgcmV0dXJuIFJhZCAqICgxODAgLyBtYXRoLnBpKSBlbmQKbG9jYWwgTGVycCA9IGZ1bmN0aW9uKGEsIGIsIHQpIHJldHVybiBhICsgKGIgLSBhKSAqIHQgZW5kCgpsb2NhbCBWVGFibGUgPSB7CiAgICBFbnRyeSA9IGZ1bmN0aW9uKGluc3RhbmNlLCBpbmRleCwgdHlwZSkgcmV0dXJuIGZmaS5jYXN0KHR5cGUsIChmZmkuY2FzdCgidm9pZCoqKiIsIGluc3RhbmNlKVswXSlbaW5kZXhdKSBlbmQsCiAgICBCaW5kID0gZnVuY3Rpb24oc2VsZiwgbW9kdWxlLCBpbnRlcmZhY2UsIGluZGV4LCB0eXBlc3RyaW5nKQogICAgICAgIGxvY2FsIGluc3RhbmNlID0gY2xpZW50LmNyZWF0ZV9pbnRlcmZhY2UobW9kdWxlLCBpbnRlcmZhY2UpCiAgICAgICAgbG9jYWwgZm5wdHIgPSBzZWxmLkVudHJ5KGluc3RhbmNlLCBpbmRleCwgZmZpLnR5cGVvZih0eXBlc3RyaW5nKSkKICAgICAgICByZXR1cm4gZnVuY3Rpb24oLi4uKSByZXR1cm4gZm5wdHIoaW5zdGFuY2UsIC4uLikgZW5kCiAgICBlbmQKfQoKbG9jYWwgYW5pbXN0YXRlX3QgPSBmZmkudHlwZW9mICdzdHJ1Y3QgeyBjaGFyIHBhZDBbMHgxOF07IGZsb2F0IGFuaW1fdXBkYXRlX3RpbWVyOyBjaGFyIHBhZDFbMHhDXTsgZmxvYXQgc3RhcnRlZF9tb3ZpbmdfdGltZTsgZmxvYXQgbGFzdF9tb3ZlX3RpbWU7IGNoYXIgcGFkMlsweDEwXTsgZmxvYXQgbGFzdF9sYnlfdGltZTsgY2hhciBwYWQzWzB4OF07IGZsb2F0IHJ1bl9hbW91bnQ7IGNoYXIgcGFkNFsweDEwXTsgdm9pZCogZW50aXR5OyB2b2lkKiBhY3RpdmVfd2VhcG9uOyB2b2lkKiBsYXN0X2FjdGl2ZV93ZWFwb247IGZsb2F0IGxhc3RfY2xpZW50X3NpZGVfYW5pbWF0aW9uX3VwZGF0ZV90aW1lOyBpbnQJIGxhc3RfY2xpZW50X3NpZGVfYW5pbWF0aW9uX3VwZGF0ZV9mcmFtZWNvdW50OyBmbG9hdCBleWVfdGltZXI7IGZsb2F0IGV5ZV9hbmdsZXNfeTsgZmxvYXQgZXllX2FuZ2xlc194OyBmbG9hdCBnb2FsX2ZlZXRfeWF3OyBmbG9hdCBjdXJyZW50X2ZlZXRfeWF3OyBmbG9hdCB0b3Jzb195YXc7IGZsb2F0IGxhc3RfbW92ZV95YXc7IGZsb2F0IGxlYW5fYW1vdW50OyBjaGFyIHBhZDVbMHg0XTsgZmxvYXQgZmVldF9jeWNsZTsgZmxvYXQgZmVldF95YXdfcmF0ZTsgY2hhciBwYWQ2WzB4NF07IGZsb2F0IGR1Y2tfYW1vdW50OyBmbG9hdCBsYW5kaW5nX2R1Y2tfYW1vdW50OyBjaGFyIHBhZDdbMHg0XTsgZmxvYXQgY3VycmVudF9vcmlnaW5bM107IGZsb2F0IGxhc3Rfb3JpZ2luWzNdOyBmbG9hdCB2ZWxvY2l0eV94OyBmbG9hdCB2ZWxvY2l0eV95OyBjaGFyIHBhZDhbMHg0XTsgZmxvYXQgdW5rbm93bl9mbG9hdDE7IGNoYXIgcGFkOVsweDhdOyBmbG9hdCB1bmtub3duX2Zsb2F0MjsgZmxvYXQgdW5rbm93bl9mbG9hdDM7IGZsb2F0IHVua25vd247IGZsb2F0IG1fdmVsb2NpdHk7IGZsb2F0IGp1bXBfZmFsbF92ZWxvY2l0eTsgZmxvYXQgY2xhbXBlZF92ZWxvY2l0eTsgZmxvYXQgZmVldF9zcGVlZF9mb3J3YXJkc19vcl9zaWRld2F5czsgZmxvYXQgZmVldF9zcGVlZF91bmtub3duX2ZvcndhcmRzX29yX3NpZGV3YXlzOyBmbG9hdCBsYXN0X3RpbWVfc3RhcnRlZF9tb3Zpbmc7IGZsb2F0IGxhc3RfdGltZV9zdG9wcGVkX21vdmluZzsgYm9vbCBvbl9ncm91bmQ7IGJvb2wgaGl0X2luX2dyb3VuZF9hbmltYXRpb247IGNoYXIgcGFkMTBbMHg0XTsgZmxvYXQgdGltZV9zaW5jZV9pbl9haXI7IGZsb2F0IGxhc3Rfb3JpZ2luX3o7IGZsb2F0IGhlYWRfZnJvbV9ncm91bmRfZGlzdGFuY2Vfc3RhbmRpbmc7IGZsb2F0IHN0b3BfdG9fZnVsbF9ydW5uaW5nX2ZyYWN0aW9uOyBjaGFyIHBhZDExWzB4NF07IGZsb2F0IG1hZ2ljX2ZyYWN0aW9uOyBjaGFyIHBhZDEyWzB4M0NdOyBmbG9hdCB3b3JsZF9mb3JjZTsgY2hhciBwYWQxM1sweDFDQV07IGZsb2F0IG1pbl95YXc7IGZsb2F0IG1heF95YXc7IH0gKionCmxvY2FsIGFuaW1sYXllcl90ID0gZmZpLnR5cGVvZiAnc3RydWN0IHsgY2hhciBwYWRfMHgwMDAwWzB4MThdOyB1aW50MzJfdCBzZXF1ZW5jZTsgZmxvYXQgcHJldl9jeWNsZTsgZmxvYXQgd2VpZ2h0OyBmbG9hdCB3ZWlnaHRfZGVsdGFfcmF0ZTsgZmxvYXQgcGxheWJhY2tfcmF0ZTsgZmxvYXQgY3ljbGU7IHZvaWQgKmVudGl0eTtjaGFyIHBhZF8weDAwMzhbMHg0XTsgfSAqKicKbG9jYWwgTmF0aXZlR2V0Q2xpZW50RW50aXR5ID0gVlRhYmxlOkJpbmQoImNsaWVudC5kbGwiLCAiVkNsaWVudEVudGl0eUxpc3QwMDMiLCAzLCAidm9pZCooX190aGlzY2FsbCopKHZvaWQqLCBpbnQpIikKCmxvY2FsIE51bGxQdHIsIENoYXJQdHIsIENsYXNzUHRyID0gZmZpLm5ldyAidm9pZCoiLCBmZmkudHlwZW9mICJjaGFyKiIsIGZmaS50eXBlb2YgInZvaWQqKioiCgpsb2NhbCBFbmFibGVSZXNvbHZlciA9IHVpLm5ld19jaGVja2JveCgiUmFnZSIsICJPdGhlciIsICJcYUUwNUM1Q0ZG4pqgIEN1c3RvbSBSZXNvbHZlciBieSBJbnZpbnNpYmxlLmx1YSIpCgpsb2NhbCBHZXRBbmltU3RhdGUgPSBmdW5jdGlvbihlbnQpCiAgICBpZiBub3QgZW50IHRoZW4gcmV0dXJuIGZhbHNlIGVuZAogICAgbG9jYWwgQWRkcmVzcyA9IHR5cGUoZW50KSA9PSAiY2RhdGEiIGFuZCBlbnQgb3IgTmF0aXZlR2V0Q2xpZW50RW50aXR5KGVudCkKICAgIGlmIG5vdCBBZGRyZXNzIG9yIEFkZHJlc3MgPT0gZmZpLk5VTEwgdGhlbiByZXR1cm4gZmFsc2UgZW5kCiAgICBsb2NhbCBBZGRyZXNzVnRhYmxlID0gZmZpLmNhc3QoInZvaWQqKioiLCBBZGRyZXNzKQogICAgcmV0dXJuIGZmaS5jYXN0KGFuaW1zdGF0ZV90LCBmZmkuY2FzdCgiY2hhcioiLCBBZGRyZXNzVnRhYmxlKSArIDB4OTk2MClbMF0KZW5kCgpsb2NhbCBHZXRTaW11bGF0aW9uVGltZSA9IGZ1bmN0aW9uKGVudCkKICAgIGxvY2FsIHBvaW50ZXIgPSBOYXRpdmVHZXRDbGllbnRFbnRpdHkoZW50KQogICAgaWYgcG9pbnRlciB0aGVuIHJldHVybiBlbnRpdHkuZ2V0X3Byb3AoZW50LCAibV9mbFNpbXVsYXRpb25UaW1lIiksIGZmaS5jYXN0KCJmbG9hdCoiLCBmZmkuY2FzdCgidWludHB0cl90IiwgcG9pbnRlcikgKyAweDI2QylbMF0gZWxzZSByZXR1cm4gMCBlbmQKZW5kCgpsb2NhbCBHZXRBbmltbGF5ZXJzID0gZnVuY3Rpb24gKGVudCwgbGF5ZXIpCiAgICBsb2NhbCBwb2ludGVyID0gTmF0aXZlR2V0Q2xpZW50RW50aXR5KGVudCkKICAgIGlmIHBvaW50ZXIgdGhlbiByZXR1cm4gZmZpLmNhc3QoYW5pbWxheWVyX3QsIGZmaS5jYXN0KCdjaGFyKicsIGZmaS5jYXN0KCJ2b2lkKioqIiwgcG9pbnRlcikpICsgMHgzOTE0KVswXVtsYXllciBvciAwXSBlbmQKZW5kCgpsb2NhbCBJc1BsYXllclZhbGlkID0gZnVuY3Rpb24ocGxheWVyKQogICAgaWYgbm90IHBsYXllciB0aGVuIHJldHVybiBmYWxzZSBlbmQKICAgIGlmIG5vdCBlbnRpdHkuaXNfYWxpdmUocGxheWVyKSB0aGVuIHJldHVybiBmYWxzZSBlbmQKICAgIHJldHVybiB0cnVlCmVuZAoKbG9jYWwgR2V0TWF4RGVzeW5jID0gZnVuY3Rpb24ocGxheWVyKQogICAgbG9jYWwgQW5pbXN0YXRlID0gR2V0QW5pbVN0YXRlKHBsYXllcikKICAgIGlmIG5vdCBBbmltc3RhdGUgdGhlbiByZXR1cm4gMCBlbmQKICAgIGxvY2FsIHNwZWVkZmFjdG9yID0gQ2xhbXAoQW5pbXN0YXRlLmZlZXRfc3BlZWRfZm9yd2FyZHNfb3Jfc2lkZXdheXMsIDAsIDEpCiAgICBsb2NhbCBhdmdfc3BlZWRmYWN0b3IgPSAoQW5pbXN0YXRlLnN0b3BfdG9fZnVsbF9ydW5uaW5nX2ZyYWN0aW9uICogLTAuMyAtIDAuMikgKiBzcGVlZGZhY3RvciArIDEKICAgIGxvY2FsIGR1Y2tfYW1vdW50ID0gQW5pbXN0YXRlLmR1Y2tfYW1vdW50CiAgICBpZiBkdWNrX2Ftb3VudCA+IDAgdGhlbiBhdmdfc3BlZWRmYWN0b3IgPSBhdmdfc3BlZWRmYWN0b3IgKyAoKGR1Y2tfYW1vdW50ICogc3BlZWRmYWN0b3IpICogKDAuNSAtIGF2Z19zcGVlZGZhY3RvcikpIGVuZAogICAgcmV0dXJuIENsYW1wKGF2Z19zcGVlZGZhY3RvciwgLjUsIDEpCmVuZAoKbG9jYWwgSXNQbGF5ZXJBbmltYXRpbmcgPSBmdW5jdGlvbihwbGF5ZXIpCiAgICBsb2NhbCBDdXJyZW50U2ltdWxhdGlvblRpbWUsIFJlY29yZFNpbXVsYXRpb25UaW1lID0gR2V0U2ltdWxhdGlvblRpbWUocGxheWVyKQogICAgQ3VycmVudFNpbXVsYXRpb25UaW1lLCBSZWNvcmRTaW11bGF0aW9uVGltZSA9IHRvdGlja3MoQ3VycmVudFNpbXVsYXRpb25UaW1lKSwgdG90aWNrcyhSZWNvcmRTaW11bGF0aW9uVGltZSkKICAgIHJldHVybiB0b3RpY2tzKEN1cnJlbnRTaW11bGF0aW9uVGltZSkgfj0gbmlsIGFuZCB0b3RpY2tzKFJlY29yZFNpbXVsYXRpb25UaW1lKSB+PSBuaWwKZW5kCgpsb2NhbCBHZXRDaG9rZWRQYWNrZXRzID0gZnVuY3Rpb24ocGxheWVyKQogICAgaWYgbm90IElzUGxheWVyQW5pbWF0aW5nKHBsYXllcikgdGhlbiByZXR1cm4gMCBlbmQKICAgIGxvY2FsIEN1cnJlbnRTaW11bGF0aW9uVGltZSwgUHJldmlvdXNTaW11bGF0aW9uVGltZSA9IEdldFNpbXVsYXRpb25UaW1lKHBsYXllcikKICAgIGxvY2FsIFNpbXVsYXRpb25UaW1lRGlmZmVyZW5jZSA9IGdsb2JhbHMuY3VydGltZSgpIC0gQ3VycmVudFNpbXVsYXRpb25UaW1lCiAgICBsb2NhbCBDaG9rZWRDb21tYW5kcyA9IENsYW1wKHRvdGlja3MobWF0aC5tYXgoMC4wLCBTaW11bGF0aW9uVGltZURpZmZlcmVuY2UgLSBjbGllbnQubGF0ZW5jeSgpKSksIDAsIGN2YXIuc3ZfbWF4dXNyY21kcHJvY2Vzc3RpY2tzOmdldF9zdHJpbmcoKSAtIDIpCiAgICByZXR1cm4gQ2hva2VkQ29tbWFuZHMKZW5kCgpmdW5jdGlvbiBSZWJ1aWxkU2VydmVyWWF3KHBsYXllcikKICAgIGxvY2FsIEFuaW1zdGF0ZSA9IEdldEFuaW1TdGF0ZShwbGF5ZXIpCiAgICBpZiBub3QgQW5pbXN0YXRlIHRoZW4gcmV0dXJuIDAgZW5kCiAgICAKICAgIGxvY2FsIG1fZmxHb2FsRmVldFlhdyA9IEFuaW1zdGF0ZS5nb2FsX2ZlZXRfeWF3CiAgICBsb2NhbCBleWVfZmVldF9kZWx0YSA9IEFuZ2xlRGlmZmVyZW5jZShBbmltc3RhdGUuZXllX2FuZ2xlc195LCBBbmltc3RhdGUuZ29hbF9mZWV0X3lhdykKICAgIGxvY2FsIGZsUnVubmluZ1NwZWVkID0gQ2xhbXAoQW5pbXN0YXRlLmZlZXRfc3BlZWRfZm9yd2FyZHNfb3Jfc2lkZXdheXMsIDAuMCwgMS4wKQogICAgCiAgICBsb2NhbCBmbFlhd01vZGlmaWVyID0gKCgoQW5pbXN0YXRlLnN0b3BfdG9fZnVsbF9ydW5uaW5nX2ZyYWN0aW9uICogLTAuMykgLSAwLjIpICogZmxSdW5uaW5nU3BlZWQpICsgMS4wCiAgICBpZiBBbmltc3RhdGUuZHVja19hbW91bnQgPiAwLjAgdGhlbgogICAgICAgIGxvY2FsIGZsRHVja2luZ1NwZWVkID0gQ2xhbXAoQW5pbXN0YXRlLmZlZXRfc3BlZWRfZm9yd2FyZHNfb3Jfc2lkZXdheXMsIDAuMCwgMS4wKQogICAgICAgIGZsWWF3TW9kaWZpZXIgPSBmbFlhd01vZGlmaWVyICsgKChBbmltc3RhdGUuZHVja19hbW91bnQgKiBmbER1Y2tpbmdTcGVlZCkgKiAoMC41IC0gZmxZYXdNb2RpZmllcikpCiAgICBlbmQKICAgCiAgICBsb2NhbCBmbE1heFlhd01vZGlmaWVyID0gZmxZYXdNb2RpZmllciAqIEFuaW1zdGF0ZS5tYXhfeWF3CiAgICBsb2NhbCBmbE1pbllhd01vZGlmaWVyID0gZmxZYXdNb2RpZmllciAqIEFuaW1zdGF0ZS5taW5feWF3CiAgIAogICAgaWYgZXllX2ZlZXRfZGVsdGEgPD0gZmxNYXhZYXdNb2RpZmllciB0aGVuCiAgICAgICAgaWYgZmxNaW5ZYXdNb2RpZmllciA+IGV5ZV9mZWV0X2RlbHRhIHRoZW4KICAgICAgICAgICAgbV9mbEdvYWxGZWV0WWF3ID0gbWF0aC5hYnMoZmxNaW5ZYXdNb2RpZmllcikgKyBBbmltc3RhdGUuZXllX2FuZ2xlc195CiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgbV9mbEdvYWxGZWV0WWF3ID0gQW5pbXN0YXRlLmV5ZV9hbmdsZXNfeSAtIG1hdGguYWJzKGZsTWF4WWF3TW9kaWZpZXIpCiAgICBlbmQKCglyZXR1cm4gTm9ybWFsaXplQW5nbGUobV9mbEdvYWxGZWV0WWF3KQplbmQKCmxvY2FsIENhY2hlID0ge30KCmxvY2FsIEppdHRlckJ1ZmZlciA9IDYKbG9jYWwgUmVzb2x2ZXIgPSB7IAogICAgSml0dGVyID0geyBKaXR0ZXJpbmcgPSBmYWxzZSwgSml0dGVyVGlja3MgPSAwLCBTdGF0aWNUaWNrcyA9IDAsIFlhd0NhY2hlID0ge30sIEppdHRlckNhY2hlID0gMCwgRGlmZmVyZW5jZSA9IDAgfSwKICAgIE1haW4gPSB7IE1vZGUgPSAwLCBTaWRlID0gMCwgQW5nbGVzID0gMCB9Cn0KCmxvY2FsIENhY2hlID0ge30KCmxvY2FsIENEZXRlY3RKaXR0ZXIgPSBmdW5jdGlvbihwbGF5ZXIpCiAgICBsb2NhbCBEYXRhID0gUmVzb2x2ZXIuSml0dGVyCiAgICBsb2NhbCBFeWVBbmdsZXNYLCBFeWVBbmdsZXNZLCBFeWVBbmdsZXNaID0gZW50aXR5LmdldF9wcm9wKHBsYXllciwgIm1fYW5nRXllQW5nbGVzIikKICAgIERhdGEuWWF3Q2FjaGVbRGF0YS5KaXR0ZXJDYWNoZSAlIEppdHRlckJ1ZmZlcl0gPSBFeWVBbmdsZXNZCiAgICBpZiBEYXRhLkppdHRlckNhY2hlID49IEppdHRlckJ1ZmZlciArIDEgdGhlbgogICAgICAgIERhdGEuSml0dGVyQ2FjaGUgPSAwCiAgICBlbHNlCiAgICAgICAgRGF0YS5KaXR0ZXJDYWNoZSA9IERhdGEuSml0dGVyQ2FjaGUgKyAxCiAgICBlbmQKICAgIGZvciBpID0gMCwgSml0dGVyQnVmZmVyLCAxIGRvCiAgICAgICAgaWYgaSA8IEppdHRlckJ1ZmZlciB0aGVuCiAgICAgICAgICAgIGxvY2FsIERpZmZlcmVuY2UgPSAoRGF0YS5ZYXdDYWNoZVtpIC0gRGF0YS5KaXR0ZXJDYWNoZSAlIEppdHRlckJ1ZmZlcl0gfj0gbmlsIGFuZCBEYXRhLllhd0NhY2hlW0RhdGEuSml0dGVyQ2FjaGUgJSBKaXR0ZXJCdWZmZXJdIH49IG5pbCkgYW5kIG1hdGguYWJzKERhdGEuWWF3Q2FjaGVbaSAtIERhdGEuSml0dGVyQ2FjaGUgJSBKaXR0ZXJCdWZmZXJdIC0gRGF0YS5ZYXdDYWNoZVtEYXRhLkppdHRlckNhY2hlICUgSml0dGVyQnVmZmVyXSkgb3IgMAogICAgICAgICAgICBpZiBEaWZmZXJlbmNlIH49IG5pbCBhbmQgRGlmZmVyZW5jZSB+PSAwLjAgdGhlbgogICAgICAgICAgICAgICAgTm9ybWFsaXplQW5nbGUoRGlmZmVyZW5jZSkKICAgICAgICAgICAgICAgIERhdGEuSml0dGVyaW5nID0gRGlmZmVyZW5jZSA+PSAoNDUuMCAqIEdldE1heERlc3luYyhwbGF5ZXIpKSBhbmQgdHJ1ZSBvciBmYWxzZQogICAgICAgICAgICAgICAgRGF0YS5EaWZmZXJlbmNlID0gRGlmZmVyZW5jZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmxvY2FsIENQcm9jZXNzSW1wYWN0ID0gZnVuY3Rpb24ocGxheWVyKSByZXR1cm4gUmVzb2x2ZXIuSml0dGVyLkppdHRlcmluZyBhbmQgMSBvciAwIGVuZAoKbG9jYWwgQ0dldFBvaW50RGlyZWN0aW9uID0gZnVuY3Rpb24ocGxheWVyKQogICAgbG9jYWwgZncgPSB2ZWN0b3IoKQogICAgbG9jYWwgTG9jYWxPcmlnaW5YLCBMb2NhbE9yaWdpblksIExvY2FsT3JpZ2luWiA9IGVudGl0eS5nZXRfcHJvcChlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCAibV92ZWNPcmlnaW4iKQogICAgbG9jYWwgTG9jYWxPcmlnaW4gPSB2ZWN0b3IoTG9jYWxPcmlnaW5YLCBMb2NhbE9yaWdpblkpCiAgICBsb2NhbCBQbGF5ZXJPcmlnaW5YLCBQbGF5ZXJPcmlnaW5ZLCBQbGF5ZXJPcmlnaW5aID0gZW50aXR5LmdldF9wcm9wKHBsYXllciwgIm1fdmVjT3JpZ2luIikKICAgIGxvY2FsIFBsYXllck9yaWdpbiA9IHZlY3RvcihQbGF5ZXJPcmlnaW5YLCBQbGF5ZXJPcmlnaW5ZKQogICAgbG9jYWwgQXRUYXJnZXQgPSBBbmdsZUZyb21WZWN0b3JzKExvY2FsT3JpZ2luLCBQbGF5ZXJPcmlnaW4pLnkKICAgIEFuZ2xlVmVjdG9yKEF0VGFyZ2V0WCwgQXRUYXJnZXRZKQogICAgcmV0dXJuIGZ3CmVuZAoKbG9jYWwgQ0RldGVjdERlc3luY1NpZGUgPSBmdW5jdGlvbihwbGF5ZXIpCiAgICBsb2NhbCBBbmltc3RhdGUgPSBHZXRBbmltU3RhdGUocGxheWVyKQogICAgaWYgbm90IEFuaW1zdGF0ZSB0aGVuIHJldHVybiAwIGVuZAogICAgbG9jYWwgRXllQW5nbGVzWCwgRXllQW5nbGVzWSwgRXllQW5nbGVzWiA9IGVudGl0eS5nZXRfcHJvcChwbGF5ZXIsICJtX2FuZ0V5ZUFuZ2xlcyIpCiAgICBsb2NhbCBJbnZlcnNlU2lkZSA9IGZ1bmN0aW9uKHBsYXllcikKICAgICAgICBsb2NhbCBWZWNPcmlnaW5YLCBWZWNPcmlnaW5ZLCBWZWNPcmlnaW5aID0gZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX3ZlY09yaWdpbiIpCiAgICAgICAgbG9jYWwgQWJzT3JpZ2luWCwgQWJzT3JpZ2luWSwgQWJzT3JpZ2luWiA9IGVudGl0eS5nZXRfcHJvcChlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCAibV92ZWNBYnNPcmlnaW4iKQogICAgICAgIGxvY2FsIEV5ZUFuZ2xlc1gsIEV5ZUFuZ2xlc1ksIEV5ZUFuZ2xlc1ogPSBlbnRpdHkuZ2V0X3Byb3AocGxheWVyLCAibV9hbmdFeWVBbmdsZXMiKQogICAgICAgIAogICAgICAgIGxvY2FsIFZlY09yaWdpbiA9IHZlY3RvcihWZWNPcmlnaW5YLCBWZWNPcmlnaW5ZLCBWZWNPcmlnaW5aKQogICAgICAgIGxvY2FsIEFic09yaWdpbiA9IHZlY3RvcihBYnNPcmlnaW5YLCBBYnNPcmlnaW5ZLCBBYnNPcmlnaW5aKQogICAgICAgIGxvY2FsIEV5ZUFuZ2xlcyA9IHZlY3RvcihFeWVBbmdsZXNYLCBFeWVBbmdsZXNZLCBFeWVBbmdsZXNaKQogICAgICAgIAogICAgICAgIGxvY2FsIEF0VGFyZ2V0ID0gTm9ybWFsaXplQW5nbGUoQW5nbGVGcm9tVmVjdG9ycyhWZWNPcmlnaW4sIEFic09yaWdpbikueSkKICAgICAgICBsb2NhbCBBbmdsZSA9IE5vcm1hbGl6ZUFuZ2xlKEV5ZUFuZ2xlcy55KQogICAgICAgIGxvY2FsIFNpZGV3YXlzTGVmdCA9IG1hdGguYWJzKE5vcm1hbGl6ZUFuZ2xlKEFuZ2xlIC0gTm9ybWFsaXplQW5nbGUoQXRUYXJnZXQgLSA5MC4wKSkpIDwgNDUuMAogICAgICAgIGxvY2FsIFNpZGV3YXlzUmlnaHQgPSBtYXRoLmFicyhOb3JtYWxpemVBbmdsZShBbmdsZSAtIE5vcm1hbGl6ZUFuZ2xlKEF0VGFyZ2V0ICsgOTAuMCkpKSA8IDQ1LjAKICAgICAgICBsb2NhbCBGb3J3YXJkID0gbWF0aC5hYnMoTm9ybWFsaXplQW5nbGUoQW5nbGUgLSBOb3JtYWxpemVBbmdsZShBdFRhcmdldCArIDE4MC4wKSkpIDwgNDUuMAogICAgICAgIHJldHVybiBGb3J3YXJkIGFuZCBub3QgKFNpZGV3YXlzTGVmdCBvciBTaWRld2F5c1JpZ2h0KQogICAgZW5kCgogICAgaWYgUmVzb2x2ZXIuSml0dGVyLkppdHRlcmluZyBhbmQgR2V0Q2hva2VkUGFja2V0cyhwbGF5ZXIpIDwgMyB0aGVuCiAgICAgICAgQ2FjaGUuRmlyc3ROb3JtYWxpemVkQW5nbGUgPSBOb3JtYWxpemVBbmdsZShSZXNvbHZlci5KaXR0ZXIuWWF3Q2FjaGVbSml0dGVyQnVmZmVyIC0gMV0pCiAgICAgICAgQ2FjaGUuU2Vjb25kTm9ybWFsaXplZEFuZ2xlID0gTm9ybWFsaXplQW5nbGUoUmVzb2x2ZXIuSml0dGVyLllhd0NhY2hlW0ppdHRlckJ1ZmZlciAtIDJdKQoKICAgICAgICBDYWNoZS5GaXJzdFNpbkFuZ2xlID0gbWF0aC5zaW4oRGVnVG9SYWQoQ2FjaGUuRmlyc3ROb3JtYWxpemVkQW5nbGUpKQogICAgICAgIENhY2hlLlNlY29uZFNpbkFuZ2xlID0gbWF0aC5zaW4oRGVnVG9SYWQoQ2FjaGUuU2Vjb25kTm9ybWFsaXplZEFuZ2xlKSkKCiAgICAgICAgQ2FjaGUuRmlyc3RDb3NBbmdsZSA9IG1hdGguY29zKERlZ1RvUmFkKENhY2hlLkZpcnN0Tm9ybWFsaXplZEFuZ2xlKSkKICAgICAgICBDYWNoZS5TZWNvbmRDb3NBbmdsZSA9IG1hdGguY29zKERlZ1RvUmFkKENhY2hlLlNlY29uZE5vcm1hbGl6ZWRBbmdsZSkpCgogICAgICAgIENhY2hlLkFWR1lhdyA9IE5vcm1hbGl6ZUFuZ2xlKFJhZFRvRGVnKG1hdGguYXRhbjIoKENhY2hlLkZpcnN0U2luQW5nbGUgKyBDYWNoZS5TZWNvbmRTaW5BbmdsZSkgLyAyLjAsIChDYWNoZS5GaXJzdENvc0FuZ2xlICsgQ2FjaGUuU2Vjb25kQ29zQW5nbGUpIC8gMi4wKSkpCiAgICAgICAgQ2FjaGUuRGlmZmVyZW5jZSA9IE5vcm1hbGl6ZUFuZ2xlKEFuaW1zdGF0ZS5leWVfYW5nbGVzX3kgLSBDYWNoZS5BVkdZYXcpCiAgICAgICAgaWYgQ2FjaGUuRGlmZmVyZW5jZSB+PSAwLjAgdGhlbiBSZXNvbHZlci5NYWluLlNpZGUgPSBDYWNoZS5EaWZmZXJlbmNlID4gMC4wIGFuZCAxIG9yIC0xIGVsc2UgUmVzb2x2ZXIuTWFpbi5TaWRlID0gMCBlbmQKICAgIGVuZAoKICAgIHJldHVybiBSZXNvbHZlci5NYWluLlNpZGUKZW5kCgpsb2NhbCBDUmVzb2x2ZXJJbnN0YW5jZSA9IGZ1bmN0aW9uKHBsYXllcikKICAgIGxvY2FsIEFuaW1zdGF0ZSA9IEdldEFuaW1TdGF0ZShwbGF5ZXIpCiAgICBpZiBub3QgQW5pbXN0YXRlIHRoZW4gcmV0dXJuIGVuZAoKICAgIENQcm9jZXNzSW1wYWN0KHBsYXllcikKICAgIENEZXRlY3RKaXR0ZXIocGxheWVyKQogICAgQ0RldGVjdERlc3luY1NpZGUocGxheWVyKQoKICAgIGxvY2FsIENob2tlZFBhY2tldHMgPSBHZXRDaG9rZWRQYWNrZXRzKHBsYXllcikKICAgIGxvY2FsIFNpbXVsYXRpb25UaW1lLCBQcmV2aW91c1NpbXVsYXRpb25UaW1lID0gR2V0U2ltdWxhdGlvblRpbWUocGxheWVyKQogICAgZm9yIGkgPSAwLCBDaG9rZWRQYWNrZXRzLCAxIGRvCiAgICAgICAgbG9jYWwgTm90U2VudFRpY2sgPSBpID09IENob2tlZFBhY2tldHMgLSAxCiAgICAgICAgbG9jYWwgQmFja3VwU2ltdWxhdGlvblRpbWUgPSBTaW11bGF0aW9uVGltZQogICAgICAgIGlmIElzUGxheWVyQW5pbWF0aW5nKHBsYXllcikgdGhlbiBCYWNrdXBTaW11bGF0aW9uVGltZSA9IFNpbXVsYXRpb25UaW1lIC0gdG90aW1lKENob2tlZFBhY2tldHMgLSBpIC0gMSkgZW5kCiAgICAgICAgaWYgUmVzb2x2ZXIuSml0dGVyLkppdHRlcmluZyBhbmQgbm90IE5vdFNlbnRUaWNrIHRoZW4KICAgICAgICAgICAgUmVzb2x2ZXIuTWFpbi5BbmdsZXMgPSBDYWNoZS5EaWZmZXJlbmNlIH49IG5pbCBhbmQgKENhY2hlLkRpZmZlcmVuY2UgKiBHZXRNYXhEZXN5bmMocGxheWVyKSkgKiBSZXNvbHZlci5NYWluLlNpZGUgb3IgKDQ1LjAgKiBHZXRNYXhEZXN5bmMocGxheWVyKSkgKiBSZXNvbHZlci5NYWluLlNpZGUKICAgICAgICAgICAgUmVzb2x2ZXIuTWFpbi5Nb2RlID0gMQogICAgICAgIGVsc2UKICAgICAgICAgICAgUmVzb2x2ZXIuTWFpbi5BbmdsZXMgPSAwCiAgICAgICAgICAgIFJlc29sdmVyLk1haW4uTW9kZSA9IDAKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soIm5ldF91cGRhdGVfZW5kIiwgZnVuY3Rpb24oKQogICAgaWYgbm90IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkgdGhlbiByZXR1cm4gZW5kCiAgICBpZiBub3QgZW50aXR5LmlzX2FsaXZlKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkpIHRoZW4gUmVzb2x2ZXIuTWFpbi5Nb2RlID0gMCByZXR1cm4gZW5kCiAgICBsb2NhbCBQbGF5ZXJzID0gZW50aXR5LmdldF9wbGF5ZXJzKCkgY2xpZW50LnVwZGF0ZV9wbGF5ZXJfbGlzdCgpCiAgICBmb3IgaSA9IDEsICNQbGF5ZXJzIGRvCiAgICAgICAgbG9jYWwgaWR4ID0gUGxheWVyc1tpXQogICAgICAgIGlmIGVudGl0eS5pc19lbmVteShpZHgpIGFuZCBJc1BsYXllckFuaW1hdGluZyhpZHgpIGFuZCB1aS5nZXQoRW5hYmxlUmVzb2x2ZXIpIHRoZW4KICAgICAgICAgICAgQ1Jlc29sdmVySW5zdGFuY2UoaWR4KQogICAgICAgICAgICBwbGlzdC5zZXQoaWR4LCAiRm9yY2UgYm9keSB5YXcgdmFsdWUiLCBSZXNvbHZlci5NYWluLk1vZGUgfj0gMCBhbmQgUmVzb2x2ZXIuTWFpbi5BbmdsZXMgb3IgMCkKICAgICAgICAgICAgcGxpc3Quc2V0KGlkeCwgIkZvcmNlIGJvZHkgeWF3IiwgUmVzb2x2ZXIuTWFpbi5Nb2RlIH49IDApCiAgICAgICAgZWxzZQogICAgICAgICAgICBwbGlzdC5zZXQoaWR4LCAiRm9yY2UgYm9keSB5YXciLCBmYWxzZSkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpjbGllbnQucmVnaXN0ZXJfZXNwX2ZsYWcoIkpJVFRFUiIsIDIwMCwgMjAwLCAyMDAsIGZ1bmN0aW9uKGUpIHJldHVybiAoZW50aXR5LmlzX2VuZW15KGUpIGFuZCB1aS5nZXQoRW5hYmxlUmVzb2x2ZXIpIGFuZCBSZXNvbHZlci5NYWluLk1vZGUgPT0gMSkgYW5kIHRydWUgb3IgZmFsc2UgZW5kKQotLS1AIFVuc2FmZSBjaGFyZ2UgaW4gdmlzaWJsZSBlbmVteQ=="}