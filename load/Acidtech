{"status":200,"content":"LS0tIGNvbnN0CmxvY2FsIE9CRVggPSBvYmV4X2ZldGNoIGFuZCBvYmV4X2ZldGNoKCkgb3IgewogICAgZGlzY29yZCA9ICJNb25zdHJ5IiwKICAgIHVzZXJuYW1lID0gIk1vbnN0cnkiLAogICAgYnVpbGQgPSAiYmV0YSIKfQoKaWYgbm90IExQSF9PQkZVU0NBVEVEIHRoZW4KICAgIExQSF9OT19WSVJUVUFMSVpFID0gZnVuY3Rpb24oLi4uKSByZXR1cm4gLi4uIGVuZAplbmQKCkxQSF9OT19WSVJUVUFMSVpFKGZ1bmN0aW9uICgpCiAgICBsb2NhbCBVU0VSTkFNRSA9IE9CRVgudXNlcm5hbWUKICAgIGxvY2FsIEJVSUxEID0gT0JFWC5idWlsZCA9PSAnVXNlcicgYW5kICdiZXRhJyBvciAnc3RhYmxlJwogICAgCiAgICAtLS0gZGVjbGFyYXRpb25zCiAgICBsb2NhbCBtZXJnZSA9IHRhYmxlLmNvbmNhdAogICAgbG9jYWwgZiA9IHN0cmluZy5mb3JtYXQKICAgIAogICAgLS0tIG1vZHVsZXMKICAgIGxvY2FsIGZmaSA9IHJlcXVpcmUgImZmaSIKICAgIGxvY2FsIHZlY3RvciA9IHJlcXVpcmUgInZlY3RvciIKICAgIGxvY2FsIGh0dHAgPSByZXF1aXJlICJnYW1lc2Vuc2UvaHR0cCIKICAgIGxvY2FsIGluc3BlY3QgPSByZXF1aXJlICdnYW1lc2Vuc2UvaW5zcGVjdCcKICAgIGxvY2FsIGJhc2U2NCA9IHJlcXVpcmUgImdhbWVzZW5zZS9iYXNlNjQiCiAgICBsb2NhbCB3ZWJzb2NrZXRzID0gcmVxdWlyZSAnZ2FtZXNlbnNlL3dlYnNvY2tldHMnCiAgICBsb2NhbCBjX2VudGl0eSA9IHJlcXVpcmUgImdhbWVzZW5zZS9lbnRpdHkiCiAgICBsb2NhbCBjc2dvX3dlYXBvbnMgPSByZXF1aXJlICJnYW1lc2Vuc2UvY3Nnb193ZWFwb25zIgogICAgCiAgICBsb2NhbCBjbGlwYm9hcmQgZG8KICAgICAgICBjbGlwYm9hcmQgPSB7IH0KICAgIAogICAgICAgIGxvY2FsIEdldENsaXBib2FyZFRleHRDb3VudCA9IHZ0YWJsZV9iaW5kKCd2Z3VpMi5kbGwnLCAnVkdVSV9TeXN0ZW0wMTAnLCA3LCAnaW50KF9fdGhpc2NhbGwqKSh2b2lkKiknKQogICAgICAgIGxvY2FsIFNldENsaXBib2FyZFRleHQgPSB2dGFibGVfYmluZCgndmd1aTIuZGxsJywgJ1ZHVUlfU3lzdGVtMDEwJywgOSwgJ3ZvaWQoX190aGlzY2FsbCopKHZvaWQqLCBjb25zdCBjaGFyKiwgaW50KScpCiAgICAgICAgbG9jYWwgR2V0Q2xpcGJvYXJkVGV4dCA9IHZ0YWJsZV9iaW5kKCd2Z3VpMi5kbGwnLCAnVkdVSV9TeXN0ZW0wMTAnLCAxMSwgJ2ludChfX3RoaXNjYWxsKikodm9pZCosIGludCwgY29uc3QgY2hhciosIGludCknKQogICAgCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gc2V0KC4uLikKICAgICAgICAgICAgbG9jYWwgdGV4dCA9IHRvc3RyaW5nKHRhYmxlLmNvbmNhdCh7IC4uLiB9KSkKICAgIAogICAgICAgICAgICBTZXRDbGlwYm9hcmRUZXh0KHRleHQsIHN0cmluZy5sZW4odGV4dCkpCiAgICAgICAgZW5kCiAgICAKICAgICAgICBsb2NhbCBmdW5jdGlvbiBnZXQoKQogICAgICAgICAgICBsb2NhbCBsZW4gPSBHZXRDbGlwYm9hcmRUZXh0Q291bnQoKQogICAgCiAgICAgICAgICAgIGlmIGxlbiA+IDAgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgY2hhcl9hcnIgPSBmZmkudHlwZW9mKCdjaGFyWz9dJykobGVuKQogICAgICAgICAgICAgICAgR2V0Q2xpcGJvYXJkVGV4dCgwLCBjaGFyX2FyciwgbGVuKQogICAgICAgICAgICAgICAgbG9jYWwgdGV4dCA9IGZmaS5zdHJpbmcoY2hhcl9hcnIsIGxlbiAtIDEpCiAgICAKICAgICAgICAgICAgICAgIGxvY2FsIHRleHRfZW5kIGRvCiAgICAgICAgICAgICAgICAgICAgdGV4dF9lbmQgPSB0ZXh0OmZpbmQoJ19hY2lkJykKICAgIAogICAgICAgICAgICAgICAgICAgIGlmIHRleHRfZW5kIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHRleHQ6c3ViKDEsIHRleHRfZW5kKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgICAgIHJldHVybiB0ZXh0CiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgCiAgICAgICAgY2xpcGJvYXJkLnNldCA9IHNldAogICAgICAgIGNsaXBib2FyZC5nZXQgPSBnZXQKICAgIGVuZAogICAgCiAgICBsb2NhbCBvcHJpbnQgPSBwcmludAogICAgbG9jYWwgZnVuY3Rpb24gcHJpbnQoLi4uKQogICAgICAgIGxvY2FsIHJlcyA9ICIiCiAgICAKICAgICAgICBmb3IgXywgc3RyIGluIGlwYWlycyh7Li4ufSkgZG8KICAgICAgICAgICAgcmVzID0gcmVzIC4uIHRvc3RyaW5nKHN0cikgLi4gIlx0IgogICAgICAgIGVuZAogICAgCiAgICAgICAgb3ByaW50KHJlcykKICAgIGVuZAogICAgCiAgICBsb2NhbCBmdW5jdGlvbiBwcmludF9yYXcociwgZywgYiwgLi4uKQogICAgICAgIGNsaWVudC5jb2xvcl9sb2cociwgZywgYiwgJ0FjaWRUZWNoXDAnKQogICAgICAgIGNsaWVudC5jb2xvcl9sb2coMTUwLCAxNTAsIDE1MCwgJyDCtyBcMCcpCiAgICAgICAgY2xpZW50LmNvbG9yX2xvZygyNTUsIDI1NSwgMjU1LCBmKC4uLikpCiAgICBlbmQKICAgIAogICAgLS0tIGRlZmluZXMKICAgIGxvY2FsIGZ1bmN0aW9uIGNvbnRhaW5zKGxpc3QsIHZhbHVlKQogICAgICAgIGZvciBpID0gMSwgI2xpc3QgZG8KICAgICAgICAgICAgaWYgbGlzdFtpXSA9PSB2YWx1ZSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIAogICAgICAgIHJldHVybiBmYWxzZQogICAgZW5kCiAgICAKICAgIC0tLSBlbnVtZXJhdGlvbnMKICAgIGxvY2FsIGVfc3RhdGVtZW50ID0gewogICAgICAgIFswXSAgPSAiTWFpbiIsCiAgICAgICAgWzFdICA9ICJTdGFuZGluZyIsCiAgICAgICAgWzJdICA9ICJNb3ZpbmciLAogICAgICAgIFszXSAgPSAiU2xvdyBXYWxrIiwKICAgICAgICBbNF0gID0gIkNyb3VjaGVkIiwKICAgICAgICBbNV0gID0gIk1vdmUgQ3JvdWNoZWQiLAogICAgICAgIFs2XSAgPSAiQWlyIiwKICAgICAgICBbN10gID0gIkFpciBDcm91Y2hlZCIsCiAgICAgICAgWzhdICA9ICJGYWtlIExhZyIKICAgIH0KICAgIAogICAgbG9jYWwgZV9ob3RrZXlfbW9kZSA9IHsKICAgICAgICBbMF0gPSAiQWx3YXlzIG9uIiwKICAgICAgICBbMV0gPSAiT24gaG90a2V5IiwKICAgICAgICBbMl0gPSAiVG9nZ2xlIiwKICAgICAgICBbM10gPSAiT2ZmIGhvdGtleSIKICAgIH0KICAgIAogICAgbG9jYWwgZV9oaXRncm91cCA9IHsKICAgICAgICBbMF0gID0gImdlbmVyaWMiLAogICAgICAgIFsxXSAgPSAiaGVhZCIsCiAgICAgICAgWzJdICA9ICJjaGVzdCIsCiAgICAgICAgWzNdICA9ICJzdG9tYWNoIiwKICAgICAgICBbNF0gID0gImxlZnQgYXJtIiwKICAgICAgICBbNV0gID0gInJpZ2h0IGFybSIsCiAgICAgICAgWzZdICA9ICJsZWZ0IGxlZyIsCiAgICAgICAgWzddICA9ICJyaWdodCBsZWciLAogICAgICAgIFs4XSAgPSAibmVjayIsCiAgICAgICAgWzEwXSA9ICJnZWFyIgogICAgfQogICAgCiAgICAtLS0gcmVnaW9ucwogICAgbG9jYWwgdXRpbHMgPSB7IH0KICAgIGxvY2FsIHNvZnR3YXJlID0geyB9CiAgICBsb2NhbCBvdmVycmlkZSA9IHsgfQogICAgCiAgICBsb2NhbCBpZW5naW5lY2xpZW50ID0geyB9CiAgICBsb2NhbCBpbmV0Y2hhbm5lbCA9IHsgfQogICAgCiAgICBsb2NhbCBjZWFzYXIgPSB7IH0KICAgIAogICAgbG9jYWwgbWVudSA9IHsgfQogICAgbG9jYWwgZ3VpID0geyB9CiAgICAKICAgIGxvY2FsIG1vdGlvbiA9IHsgfQogICAgbG9jYWwgd2luZG93cyA9IHsgfQogICAgCiAgICBsb2NhbCBncmFwaGljcyA9IHsgfQogICAgbG9jYWwgZGVjb3JhdGlvbnMgPSB7IH0KICAgIAogICAgbG9jYWwgZXhwbG9pdCA9IHsgfQogICAgbG9jYWwgbG9jYWxwbGF5ZXIgPSB7IH0KICAgIGxvY2FsIHN0YXRlbWVudCA9IHsgfQogICAgCiAgICBsb2NhbCBhbnRpYWltID0geyB9CiAgICBsb2NhbCB3aWRnZXRzID0geyB9CiAgICBsb2NhbCBzZXR0aW5ncyA9IHsgfQogICAgCiAgICBsb2NhbCBhbmdsZXMgPSB7IH0KICAgIGxvY2FsIGRlZmVuc2l2ZSA9IHsgfQogICAgbG9jYWwgZmFzdF9sYWRkZXIgPSB7IH0KICAgIGxvY2FsIGFuaW1fYnJlYWtlcnMgPSB7IH0KICAgIAogICAgbG9jYWwgZGlzYWJsZXJzID0geyB9CiAgICBsb2NhbCBhdm9pZF9iYWNrc3RhYiA9IHsgfQogICAgbG9jYWwgYWlyX2V4cGxvaXQgPSB7IH0KICAgIGxvY2FsIHNhZmVfaGVhZCA9IHsgfQogICAgbG9jYWwgZnNfZGlzYWJsZXJzID0geyB9CiAgICBsb2NhbCBkZWxheV9kYXRhX2FsbCA9IHsgfQogICAgCiAgICBsb2NhbCB5YXdfZGlyZWN0aW9uID0geyB9CiAgICBsb2NhbCBtYW51YWxfZGlyZWN0aW9uID0geyB9CiAgICBsb2NhbCBoaXRjaGFuY2UgPSB7IH0KICAgIGxvY2FsIGxvZ19haW1ib3Rfc2hvdHMgPSB7IH0KICAgIAogICAgbG9jYWwgYWFfdHdlYWtzID0geyB9CiAgICBsb2NhbCBldmVudGxvZ3MgPSB7IH0KICAgIGxvY2FsIHdhdGVybWFyayA9IHsgfQogICAgbG9jYWwga2V5YmluZHMgPSB7IH0KICAgIGxvY2FsIGluZGljYXRvcnMgPSB7IH0KICAgIGxvY2FsIGFycm93cyA9IHsgfQogICAgbG9jYWwgdmVsb2NpdHlfd2FybmluZyA9IHsgfQogICAgbG9jYWwgY29uX2ZpbHRlcl90ZXh0ID0geyB9CiAgICBsb2NhbCBjdHhfYmVicmEgPSB7IH0KICAgIGxvY2FsIGN1c3RvbV9zY29wZSA9IHsgfQogICAgCiAgICBsb2NhbCBjbGllbnRzaWRlX25pY2tuYW1lID0geyB9CiAgICBsb2NhbCB0cmFzaHRhbGsgPSB7IH0KICAgIGxvY2FsIHRhYl90b19nYW1lID0geyB9CiAgICBsb2NhbCBidXlfYm90ID0geyB9CiAgICBsb2NhbCBhdXRvX3BlZWsgPSB7IH0KICAgIGxvY2FsIGhpdF9tYXJrZXIgPSB7IH0KICAgIGxvY2FsIHVubXV0ZSA9IHsgfQogICAgbG9jYWwgc2hhcmVkID0geyB9CgogICAgLS0tIHJlZ2lvbiB1dGlscwogICAgZG8KICAgICAgICBsb2NhbCBlc2NhcGUgPSB7CiAgICAgICAgICAgIFsiPSJdID0gdHJ1ZSwKICAgICAgICAgICAgWyIwIl0gPSB0cnVlLAogICAgICAgICAgICBbIjEiXSA9IHRydWUsCiAgICAgICAgICAgIFsiMiJdID0gdHJ1ZSwKICAgICAgICAgICAgWyIzIl0gPSB0cnVlLAogICAgICAgICAgICBbIjQiXSA9IHRydWUsCiAgICAgICAgICAgIFsiNSJdID0gdHJ1ZSwKICAgICAgICAgICAgWyI2Il0gPSB0cnVlLAogICAgICAgICAgICBbIjciXSA9IHRydWUsCiAgICAgICAgICAgIFsiOCJdID0gdHJ1ZSwKICAgICAgICAgICAgWyI5Il0gPSB0cnVlCiAgICAgICAgfQoKICAgICAgICBsb2NhbCBjb2xvcnMgPSB7CiAgICAgICAgICAgIFsnYmxhY2snXSA9IHsgMCwgMCwgMCwgMCB9LAogICAgICAgICAgICBbJ25pY2snXSA9IHsgMjU1LCA2MiwgNjIsIDI1NSB9LAogICAgICAgICAgICBbJ2RlZmF1bHQnXSA9IHsgMTk4LCAyMDMsIDIwOSwgMjU1IH0sCiAgICAgICAgICAgIFsnaGlnaGxpZ2h0J10gPSB7IDE1MSwgMTc3LCAxODcsIDI1NSB9LAogICAgICAgICAgICBbJ21pc3MnXSA9IHsgMTU0LCAyNTUsIDE1NCwgMjU1IH0sCiAgICAgICAgICAgIFsnaWRsZSddID0geyAxMzcsIDEzNywgMTM3LCAyNTUgfQogICAgICAgIH0KCiAgICAgICAgdXRpbHMudW5tdXRlID0gdnRhYmxlX2JpbmQoJ2NsaWVudC5kbGwnLCAnR2FtZUNsaWVudEV4cG9ydHMwMDEnLCAzLCAndm9pZChfX3RoaXNjYWxsKikodm9pZCosIGludCknKQoKICAgICAgICBmdW5jdGlvbiB1dGlscy5rZXlzKGxpc3QpCiAgICAgICAgICAgIGxvY2FsIGtleXMgPSB7IH0KCiAgICAgICAgICAgIGZvciBrLCB2IGluIHBhaXJzKGxpc3QpIGRvCiAgICAgICAgICAgICAgICBrZXlzW3ZdID0gawogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiBrZXlzCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIHV0aWxzLmNvbGxlY3Rfa2V5cyh0YmwsIGluaXQpCiAgICAgICAgICAgIGxvY2FsIGtleXMgPSBpbml0IG9yIHsgfQogICAgICAgICAgICBmb3IgaXRlbSwgdmFsdWUgaW4gbmV4dCwgdGJsIGRvCiAgICAgICAgICAgICAgICBrZXlzWyNrZXlzKzFdID0gaXRlbQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiBrZXlzCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIHV0aWxzLmNsYW1wKHgsIG1pbiwgbWF4KQogICAgICAgICAgICByZXR1cm4gbWF0aC5tYXgobWluLCBtYXRoLm1pbih4LCBtYXgpKQogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiB1dGlscy5yb3VuZCh4KQogICAgICAgICAgICBpZiB4IDwgMCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gbWF0aC5jZWlsKHggLSAwLjUpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuIG1hdGguZmxvb3IoeCArIDAuNSkKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gdXRpbHMubGVycChhLCBiLCB0KQogICAgICAgICAgICByZXR1cm4gYSArIHQgKiAoYiAtIGEpCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIHV0aWxzLmludmVyc2VfbGVycChhLCBiLCB2KQogICAgICAgICAgICByZXR1cm4gKHYgLSBhKSAvIChiIC0gYSkKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gdXRpbHMudG9faGV4KHIsIGcsIGIsIGEpCiAgICAgICAgICAgIHJldHVybiBmKCIlMDJ4JTAyeCUwMnglMDJ4IiwgciwgZywgYiwgYSkKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gdXRpbHMuZm9ybWF0KHN0ciwgciwgZywgYiwgYSkKICAgICAgICAgICAgaWYgdHlwZShzdHIpIH49ICdzdHJpbmcnIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBzdHIKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBzdHIgPSBzdHJpbmcuZ3N1YihzdHIsICdbXHZccl0nLCB7CiAgICAgICAgICAgICAgICBbJ1x2J10gPSAnXGEnIC4uIHV0aWxzLnRvX2hleChyLCBnLCBiLCBhKSwKICAgICAgICAgICAgICAgIFsnXHInXSA9ICdcYUZGRkZGRkZGJwogICAgICAgICAgICB9KQoKICAgICAgICAgICAgc3RyID0gc3RyaW5nLmdzdWIoc3RyLCAiXGElWyguLSklXSIsIGZ1bmN0aW9uIChjb2wpCiAgICAgICAgICAgICAgICBsb2NhbCByLCBnLCBiLCBhID0gdW5wYWNrKGNvbG9yc1tjb2xdKQogICAgICAgICAgICAgICAgcmV0dXJuICdcYScgLi4gdXRpbHMudG9faGV4KHIsIGcsIGIsIGEpCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIHJldHVybiBzdHIKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gdXRpbHMubWFwKHYsIGluX2EsIGluX2IsIG91dF9hLCBvdXRfYiwgY2xhbXBlZCkKICAgICAgICAgICAgaWYgY2xhbXBlZCB0aGVuCiAgICAgICAgICAgICAgICB2ID0gdXRpbHMuY2xhbXAodiwgaW5fYSwgaW5fYikKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICByZXR1cm4gdXRpbHMubGVycChvdXRfYSwgb3V0X2IsIHV0aWxzLmludmVyc2VfbGVycChpbl9hLCBpbl9iLCB2KSkKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gdXRpbHMubm9ybWFsaXplKHgsIG1pbiwgbWF4KQogICAgICAgICAgICBsb2NhbCBkZWx0YSA9IG1heCAtIG1pbgoKICAgICAgICAgICAgd2hpbGUgeCA8IG1pbiBkbwogICAgICAgICAgICAgICAgeCA9IHggKyBkZWx0YQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHdoaWxlIHggPiBtYXggZG8KICAgICAgICAgICAgICAgIHggPSB4IC0gZGVsdGEKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICByZXR1cm4geAogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiB1dGlscy5ub3JtYWxpemVfeWF3KHgpCiAgICAgICAgICAgIHJldHVybiB1dGlscy5ub3JtYWxpemUoeCwgLTE4MCwgMTgwKQogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiB1dGlscy5icmVhdGhlKHgpCiAgICAgICAgICAgIHggPSB4ICUgMi4wCgogICAgICAgICAgICBpZiB4ID4gMS4wIHRoZW4KICAgICAgICAgICAgICAgIHggPSAyLjAgLSB4CiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuIHgKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gdXRpbHMuY29sb3JfbGVycChyMSwgZzEsIGIxLCBhMSwgcjIsIGcyLCBiMiwgYTIsIHQpCiAgICAgICAgICAgIGxvY2FsIHIgPSB1dGlscy5sZXJwKHIxLCByMiwgdCkKICAgICAgICAgICAgbG9jYWwgZyA9IHV0aWxzLmxlcnAoZzEsIGcyLCB0KQogICAgICAgICAgICBsb2NhbCBiID0gdXRpbHMubGVycChiMSwgYjIsIHQpCiAgICAgICAgICAgIGxvY2FsIGEgPSB1dGlscy5sZXJwKGExLCBhMiwgdCkKCiAgICAgICAgICAgIHJldHVybiByLCBnLCBiLCBhCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIHV0aWxzLndpbjExX2ZpeChpbnB1dCkKICAgICAgICAgICAgbG9jYWwgcmVzdWx0ID0gIiIKCiAgICAgICAgICAgIGZvciBpID0gMSwgI2lucHV0IGRvCiAgICAgICAgICAgICAgICBsb2NhbCBjaGFyID0gaW5wdXQ6c3ViKGksIGkpCiAgICAgICAgICAgICAgICBsb2NhbCBieXRlID0gc3RyaW5nLmJ5dGUoY2hhcikKCiAgICAgICAgICAgICAgICBpZiBlc2NhcGVbY2hhcl0gb3IgKGJ5dGUgPj0gNjUgYW5kIGJ5dGUgPD0gMTIyKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0IC4uIGNoYXIKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiByZXN1bHQKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gdXRpbHMuZ2V0X2V5ZV9wb3NpdGlvbihlbnQpCiAgICAgICAgICAgIGxvY2FsIHgxLCB5MSwgejEgPSBlbnRpdHkuZ2V0X29yaWdpbihlbnQpCiAgICAgICAgICAgIGlmIHgxID09IG5pbCB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgICAgIGxvY2FsIHgyLCB5MiwgejIgPSBlbnRpdHkuZ2V0X3Byb3AoZW50LCAibV92ZWNWaWV3T2Zmc2V0IikKICAgICAgICAgICAgaWYgeDIgPT0gbmlsIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICAgICAgcmV0dXJuIHgxICsgeDIsIHkxICsgeTIsIHoxICsgejIKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGxvY2FsIG1lbW9yeSBkbwogICAgICAgIG1lbW9yeSA9IHsgfQoKICAgICAgICBmdW5jdGlvbiBtZW1vcnkucGF0dGVybl9zY2FuKG1vZHVsZSwgc2lnbmF0dXJlLCBhZGQpCiAgICAgICAgICAgIGxvY2FsIGJ1ZmYgPSBmZmkubmV3KCJjaGFyWzEwMjRdIikKCiAgICAgICAgICAgIGxvY2FsIGMgPSAwCgogICAgICAgICAgICBmb3IgY2hhciBpbiBzdHJpbmcuZ21hdGNoKHNpZ25hdHVyZSwgIi4uJXM/IikgZG8KICAgICAgICAgICAgICAgIGlmIGNoYXIgPT0gIj8gIiBvciBjaGFyID09ICI/PyAiIHRoZW4KICAgICAgICAgICAgICAgICAgICBidWZmW2NdID0gMHhjYwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGJ1ZmZbY10gPSB0b251bWJlcigiMHgiIC4uIGNoYXIpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBjID0gYyArIDEKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCByZXN1bHQgPSBmZmkuY2FzdCgidWludHB0cl90IiwgY2xpZW50LmZpbmRfc2lnbmF0dXJlKG1vZHVsZSwgZmZpLnN0cmluZyhidWZmKSkpCgogICAgICAgICAgICBpZiBhZGQgYW5kIHRvbnVtYmVyKHJlc3VsdCkgfj0gMCB0aGVuCiAgICAgICAgICAgICAgICByZXN1bHQgPSBmZmkuY2FzdCgidWludHB0cl90IiwgdG9udW1iZXIocmVzdWx0KSArIGFkZCkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICByZXR1cm4gcmVzdWx0CiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIG1lbW9yeS5yZWxfam1wKGFkZHIsIHBhdHRlcm4pCiAgICAgICAgICAgIGlmIHBhdHRlcm4gdGhlbgogICAgICAgICAgICAgICAgYWRkciA9IG1lbW9yeS5wYXR0ZXJuX3NjYW4oYWRkciwgcGF0dGVybikKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBhZGRyID0gZmZpLmNhc3QoInVpbnQ4X3QqIiwgYWRkcikKCiAgICAgICAgICAgIGxvY2FsIGptcF9hZGRyID0gZmZpLmNhc3QoInVpbnRwdHJfdCIsIGFkZHIpCiAgICAgICAgICAgIGxvY2FsIGptcF9kaXNwID0gZmZpLmNhc3QoImludDMyX3QqIiwgam1wX2FkZHIgKyAweDEpWzBdCgogICAgICAgICAgICByZXR1cm4gZmZpLmNhc3QoInVpbnRwdHJfdCIsIGptcF9hZGRyICsgMHg1ICsgam1wX2Rpc3ApCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIG1lbW9yeS5hZGRyX3RvX251bShpbl9hZGRyKQogICAgICAgICAgICByZXR1cm4gdG9udW1iZXIoZmZpLmNhc3QoImludCIsIGluX2FkZHIpKQogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBqbXBfZWN4ID0gY2xpZW50LmZpbmRfc2lnbmF0dXJlKCJlbmdpbmUuZGxsIiwgIlx4RkZceEUxIikKICAgICAgICBsb2NhbCBmbkdldE1vZHVsZUhhbmRsZSA9IGZmaS5jYXN0KCJ1aW50MzJfdChfX2Zhc3RjYWxsKikodW5zaWduZWQgaW50LCB1bnNpZ25lZCBpbnQsIGNvbnN0IGNoYXIqKSIsIGptcF9lY3gpCiAgICAgICAgbG9jYWwgZm5HZXRQcm9jQWRkcmVzcyA9IGZmaS5jYXN0KCJ1aW50MzJfdChfX2Zhc3RjYWxsKikodW5zaWduZWQgaW50LCB1bnNpZ25lZCBpbnQsIHVpbnQzMl90LCBjb25zdCBjaGFyKikiLCBqbXBfZWN4KQoKICAgICAgICBsb2NhbCBwR2V0UHJvY0FkZHJlc3MgPSBmZmkuY2FzdCgidWludDMyX3QqKiIsIGZmaS5jYXN0KCJ1aW50MzJfdCIsIGNsaWVudC5maW5kX3NpZ25hdHVyZSgiZW5naW5lLmRsbCIsICJceEZGXHgxNVx4Q0NceENDXHhDQ1x4Q0NceEEzXHhDQ1x4Q0NceENDXHhDQ1x4RUJceDA1IikpICsgMilbMF1bMF0KICAgICAgICBsb2NhbCBwR2V0TW9kdWxlSGFuZGxlID0gZmZpLmNhc3QoInVpbnQzMl90KioiLCBmZmkuY2FzdCgidWludDMyX3QiLCBjbGllbnQuZmluZF9zaWduYXR1cmUoImVuZ2luZS5kbGwiLCAiXHhGRlx4MTVceENDXHhDQ1x4Q0NceENDXHg4NVx4QzBceDc0XHgwQiIpKSArIDIpWzBdWzBdCgogICAgICAgIGZ1bmN0aW9uIG1lbW9yeS5nZXRfZXhwb3J0KG1vZHVsZSwgZnVuYywgdHlwZWRlZikKICAgICAgICAgICAgbG9jYWwgY3R5cGUgPSBmZmkudHlwZW9mKHR5cGVkZWYpCgogICAgICAgICAgICBsb2NhbCBmbiA9IGZuR2V0UHJvY0FkZHJlc3MocEdldFByb2NBZGRyZXNzLCAwLCBmbkdldE1vZHVsZUhhbmRsZShwR2V0TW9kdWxlSGFuZGxlLCAwLCBtb2R1bGUpLCBmdW5jKQoKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICguLi4pCiAgICAgICAgICAgICAgICByZXR1cm4gZmZpLmNhc3QoY3R5cGUsIGptcF9lY3gpKGZuLCAwLCAuLi4pCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCgogICAgZG8KICAgICAgICBzb2Z0d2FyZS5yYWdlID0gewogICAgICAgICAgICB3ZWFwb24gPSB7CiAgICAgICAgICAgICAgICB3ZWFwb25fdHlwZSA9IHVpLnJlZmVyZW5jZSgiUmFnZSIsICJXZWFwb24gdHlwZSIsICJXZWFwb24gdHlwZSIpCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBhaW1ib3QgPSB7CiAgICAgICAgICAgICAgICBlbmFibGVkID0geyB1aS5yZWZlcmVuY2UoIlJhZ2UiLCAiQWltYm90IiwgIkVuYWJsZWQiKSB9LAogICAgICAgICAgICAgICAgdGFyZ2V0X3NlbGVjdGlvbiA9IHVpLnJlZmVyZW5jZSgiUmFnZSIsICJBaW1ib3QiLCAiVGFyZ2V0IHNlbGVjdGlvbiIpLAogICAgICAgICAgICAgICAgbWluaW11bV9kYW1hZ2UgPSB1aS5yZWZlcmVuY2UoIlJhZ2UiLCAiQWltYm90IiwgIk1pbmltdW0gZGFtYWdlIiksCiAgICAgICAgICAgICAgICBoaXRjaGFuY2UgPSB1aS5yZWZlcmVuY2UoJ1JhZ2UnLCAnQWltYm90JywgJ01pbmltdW0gaGl0IGNoYW5jZScpLAogICAgICAgICAgICAgICAgYXV0b19zY29wZSA9IHVpLnJlZmVyZW5jZSgnUmFnZScsICdBaW1ib3QnLCAnQXV0b21hdGljIFNjb3BlJyksCiAgICAgICAgICAgICAgICBtaW5pbXVtX2RhbWFnZV9vdmVycmlkZSA9IHsgdWkucmVmZXJlbmNlKCJSYWdlIiwgIkFpbWJvdCIsICJNaW5pbXVtIGRhbWFnZSBvdmVycmlkZSIpIH0sCiAgICAgICAgICAgICAgICBwcmVmZXJfc2FmZV9wb2ludCA9IHVpLnJlZmVyZW5jZSgiUmFnZSIsICJBaW1ib3QiLCAiUHJlZmVyIHNhZmUgcG9pbnQiKSwKICAgICAgICAgICAgICAgIGZvcmNlX3NhZmVfcG9pbnQgPSB1aS5yZWZlcmVuY2UoIlJhZ2UiLCAiQWltYm90IiwgIkZvcmNlIHNhZmUgcG9pbnQiKSwKICAgICAgICAgICAgICAgIGZvcmNlX2JvZHlfYWltID0gdWkucmVmZXJlbmNlKCJSYWdlIiwgIkFpbWJvdCIsICJGb3JjZSBib2R5IGFpbSIpLAogICAgICAgICAgICAgICAgZG91YmxlX3RhcCA9IHsgdWkucmVmZXJlbmNlKCJSYWdlIiwgIkFpbWJvdCIsICJEb3VibGUgdGFwIikgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgb3RoZXIgPSB7CiAgICAgICAgICAgICAgICBxdWlja19wZWVrX2Fzc2lzdCA9IHsgdWkucmVmZXJlbmNlKCJSYWdlIiwgIk90aGVyIiwgIlF1aWNrIHBlZWsgYXNzaXN0IikgfSwKICAgICAgICAgICAgICAgIGR1Y2tfcGVla19hc3Npc3QgPSB1aS5yZWZlcmVuY2UoIlJhZ2UiLCAiT3RoZXIiLCAiRHVjayBwZWVrIGFzc2lzdCIpCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHNvZnR3YXJlLmFhID0gewogICAgICAgICAgICBhbmdsZXMgPSB7CiAgICAgICAgICAgICAgICBlbmFibGVkID0gdWkucmVmZXJlbmNlKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiRW5hYmxlZCIpLAogICAgICAgICAgICAgICAgcGl0Y2ggPSB7IHVpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIlBpdGNoIikgfSwKICAgICAgICAgICAgICAgIHlhd19iYXNlID0gdWkucmVmZXJlbmNlKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiWWF3IGJhc2UiKSwKICAgICAgICAgICAgICAgIHlhdyA9IHsgdWkucmVmZXJlbmNlKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiWWF3IikgfSwKICAgICAgICAgICAgICAgIHlhd19qaXR0ZXIgPSB7IHVpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIllhdyBqaXR0ZXIiKSB9LAogICAgICAgICAgICAgICAgYm9keV95YXcgPSB7IHVpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIkJvZHkgeWF3IikgfSwKICAgICAgICAgICAgICAgIGZyZWVzdGFuZGluZ19ib2R5X3lhdyA9IHVpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIkZyZWVzdGFuZGluZyBib2R5IHlhdyIpLAogICAgICAgICAgICAgICAgZWRnZV95YXcgPSB1aS5yZWZlcmVuY2UoIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJFZGdlIHlhdyIpLAogICAgICAgICAgICAgICAgZnJlZXN0YW5kaW5nID0geyB1aS5yZWZlcmVuY2UoIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJGcmVlc3RhbmRpbmciKSB9LAogICAgICAgICAgICAgICAgcm9sbCA9IHVpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIlJvbGwiKQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgZmFrZWxhZyA9IHsKICAgICAgICAgICAgICAgIGVuYWJsZWQgPSB7IHVpLnJlZmVyZW5jZSgiQUEiLCAiRmFrZSBsYWciLCAiRW5hYmxlZCIpIH0sCiAgICAgICAgICAgICAgICBhbW91bnQgPSB1aS5yZWZlcmVuY2UoIkFBIiwgIkZha2UgbGFnIiwgIkFtb3VudCIpLAogICAgICAgICAgICAgICAgdmFyaWFuY2UgPSB1aS5yZWZlcmVuY2UoIkFBIiwgIkZha2UgbGFnIiwgIlZhcmlhbmNlIiksCiAgICAgICAgICAgICAgICBsaW1pdCA9IHVpLnJlZmVyZW5jZSgiQUEiLCAiRmFrZSBsYWciLCAiTGltaXQiKQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgb3RoZXIgPSB7CiAgICAgICAgICAgICAgICBzbG93X21vdGlvbiA9IHsgdWkucmVmZXJlbmNlKCJBQSIsICJPdGhlciIsICJTbG93IG1vdGlvbiIpIH0sCiAgICAgICAgICAgICAgICBsZWdfbW92ZW1lbnQgPSB1aS5yZWZlcmVuY2UoIkFBIiwgIk90aGVyIiwgIkxlZyBtb3ZlbWVudCIpLAogICAgICAgICAgICAgICAgb25fc2hvdF9hbnRpYWltID0geyB1aS5yZWZlcmVuY2UoIkFBIiwgIk90aGVyIiwgIk9uIHNob3QgYW50aS1haW0iKSB9LAogICAgICAgICAgICAgICAgZmFrZV9wZWVrID0geyB1aS5yZWZlcmVuY2UoIkFBIiwgIk90aGVyIiwgIkZha2UgcGVlayIpIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgc29mdHdhcmUudmlzdWFscyA9IHsKICAgICAgICAgICAgc2NvcGVfb3ZlcmxheSA9IHVpLnJlZmVyZW5jZSgnVklTVUFMUycsICdFZmZlY3RzJywgJ1JlbW92ZSBzY29wZSBvdmVybGF5JykKICAgICAgICB9CgogICAgICAgIHNvZnR3YXJlLm1pc2MgPSB7CiAgICAgICAgICAgIG1pc2NlbGxhbmVvdXMgPSB7CiAgICAgICAgICAgICAgICBjbGFuX3RhZ19zcGFtbWVyID0geyB1aS5yZWZlcmVuY2UoIk1pc2MiLCAiTWlzY2VsbGFuZW91cyIsICJDbGFuIHRhZyBzcGFtbWVyIikgfSwKICAgICAgICAgICAgICAgIHBpbmdfc3Bpa2UgPSB7IHVpLnJlZmVyZW5jZSgiTWlzYyIsICJNaXNjZWxsYW5lb3VzIiwgIlBpbmcgc3Bpa2UiKSB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzZXR0aW5ncyA9IHsKICAgICAgICAgICAgICAgIG1lbnVfY29sb3IgPSB1aS5yZWZlcmVuY2UoIk1pc2MiLCAiU2V0dGluZ3MiLCAiTWVudSBjb2xvciIpLAogICAgICAgICAgICAgICAgb3V0cHV0ID0gdWkucmVmZXJlbmNlKCJNaXNjIiwgIk1pc2NlbGxhbmVvdXMiLCAiRHJhdyBjb25zb2xlIG91dHB1dCIpLAogICAgICAgICAgICAgICAgZHBpX3NjYWxlID0gdWkucmVmZXJlbmNlKCJNaXNjIiwgIlNldHRpbmdzIiwgIkRQSSBzY2FsZSIpLAogICAgICAgICAgICAgICAgc3ZfbWF4dXNyY21kcHJvY2Vzc3RpY2tzID0gdWkucmVmZXJlbmNlKCJNaXNjIiwgIlNldHRpbmdzIiwgInN2X21heHVzcmNtZHByb2Nlc3N0aWNrczIiKQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzb2Z0d2FyZS5pc19kb3VibGVfdGFwKCkKICAgICAgICAgICAgcmV0dXJuIHVpLmdldChzb2Z0d2FyZS5yYWdlLmFpbWJvdC5kb3VibGVfdGFwWzFdKQogICAgICAgICAgICAgICAgYW5kIHVpLmdldChzb2Z0d2FyZS5yYWdlLmFpbWJvdC5kb3VibGVfdGFwWzJdKQogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBzb2Z0d2FyZS5pc19taW5pbXVtX2RhbWFnZV9vdmVycmlkZSgpCiAgICAgICAgICAgIHJldHVybiB1aS5nZXQoc29mdHdhcmUucmFnZS5haW1ib3QubWluaW11bV9kYW1hZ2Vfb3ZlcnJpZGVbMV0pCiAgICAgICAgICAgICAgICBhbmQgdWkuZ2V0KHNvZnR3YXJlLnJhZ2UuYWltYm90Lm1pbmltdW1fZGFtYWdlX292ZXJyaWRlWzJdKQogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBzb2Z0d2FyZS5pc19mb3JjZV9ib2R5X2FpbSgpCiAgICAgICAgICAgIHJldHVybiB1aS5nZXQoc29mdHdhcmUucmFnZS5haW1ib3QuZm9yY2VfYm9keV9haW0pCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIHNvZnR3YXJlLmlzX2ZvcmNlX3NhZmVfcG9pbnQoKQogICAgICAgICAgICByZXR1cm4gdWkuZ2V0KHNvZnR3YXJlLnJhZ2UuYWltYm90LmZvcmNlX3NhZmVfcG9pbnQpCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIHNvZnR3YXJlLmlzX3F1aWNrX3BlZWtfYXNzaXN0KCkKICAgICAgICAgICAgcmV0dXJuIHVpLmdldChzb2Z0d2FyZS5yYWdlLm90aGVyLnF1aWNrX3BlZWtfYXNzaXN0WzFdKQogICAgICAgICAgICAgICAgYW5kIHVpLmdldChzb2Z0d2FyZS5yYWdlLm90aGVyLnF1aWNrX3BlZWtfYXNzaXN0WzJdKQogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBzb2Z0d2FyZS5pc19mcmVlc3RhbmRpbmcoKQogICAgICAgICAgICByZXR1cm4gdWkuZ2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy5mcmVlc3RhbmRpbmdbMV0pCiAgICAgICAgICAgICAgICBhbmQgdWkuZ2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy5mcmVlc3RhbmRpbmdbMl0pCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIHNvZnR3YXJlLmlzX2R1Y2tfcGVla19hc3Npc3QoKQogICAgICAgICAgICByZXR1cm4gdWkuZ2V0KHNvZnR3YXJlLnJhZ2Uub3RoZXIuZHVja19wZWVrX2Fzc2lzdCkKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gc29mdHdhcmUuaXNfb25fc2hvdF9hbnRpYWltKCkKICAgICAgICAgICAgcmV0dXJuIHVpLmdldChzb2Z0d2FyZS5hYS5vdGhlci5vbl9zaG90X2FudGlhaW1bMV0pCiAgICAgICAgICAgICAgICBhbmQgdWkuZ2V0KHNvZnR3YXJlLmFhLm90aGVyLm9uX3Nob3RfYW50aWFpbVsyXSkKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gc29mdHdhcmUuaXNfc2xvd19tb3Rpb24oKQogICAgICAgICAgICByZXR1cm4gdWkuZ2V0KHNvZnR3YXJlLmFhLm90aGVyLnNsb3dfbW90aW9uWzFdKQogICAgICAgICAgICAgICAgYW5kIHVpLmdldChzb2Z0d2FyZS5hYS5vdGhlci5zbG93X21vdGlvblsyXSkKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gc29mdHdhcmUuaXNfZWRnZSgpCiAgICAgICAgICAgIHJldHVybiB1aS5nZXQoc29mdHdhcmUuYWEuYW5nbGVzLmVkZ2VfeWF3KQogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBzb2Z0d2FyZS5nZXRfY29sb3IoKQogICAgICAgICAgICByZXR1cm4gdWkuZ2V0KHNvZnR3YXJlLm1pc2Muc2V0dGluZ3MubWVudV9jb2xvcikKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gc29mdHdhcmUuZ2V0X2RwaV9zY2FsZSgpCiAgICAgICAgICAgIGxvY2FsIHZhbHVlID0gdWkuZ2V0KHNvZnR3YXJlLm1pc2Muc2V0dGluZ3MuZHBpX3NjYWxlKQogICAgICAgICAgICBsb2NhbCB1bml0ID0gc3RyaW5nLm1hdGNoKHZhbHVlLCAiKCVkKyklJSIpCgogICAgICAgICAgICByZXR1cm4gdW5pdCAqIDAuMDEKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gc29mdHdhcmUuZ2V0X21pbmltdW1fZGFtYWdlKCkKICAgICAgICAgICAgaWYgc29mdHdhcmUuaXNfbWluaW11bV9kYW1hZ2Vfb3ZlcnJpZGUoKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gdWkuZ2V0KHNvZnR3YXJlLnJhZ2UuYWltYm90Lm1pbmltdW1fZGFtYWdlX292ZXJyaWRlWzNdKSwgdHJ1ZQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiB1aS5nZXQoc29mdHdhcmUucmFnZS5haW1ib3QubWluaW11bV9kYW1hZ2UpLCBmYWxzZQogICAgICAgIGVuZAogICAgZW5kCgogICAgLS0tIHJlZ2lvbiBvdmVycmlkZQogICAgZG8KICAgICAgICBsb2NhbCBkYXRhID0geyB9CgogICAgICAgIGxvY2FsIGZ1bmN0aW9uIGdldF92YWx1ZShyZWYpCiAgICAgICAgICAgIGxvY2FsIHZhbHVlID0geyB1aS5nZXQocmVmKSB9CiAgICAgICAgICAgIGxvY2FsIHR5cGVvZiA9IHVpLnR5cGUocmVmKQoKICAgICAgICAgICAgaWYgdHlwZW9mID09ICJob3RrZXkiIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiB7IGVfaG90a2V5X21vZGVbdmFsdWVbMl1dIH0KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICByZXR1cm4gdmFsdWUKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gb3ZlcnJpZGUuZ2V0KHJlZiwgLi4uKQogICAgICAgICAgICBsb2NhbCB2YWx1ZSA9IGRhdGFbcmVmXQoKICAgICAgICAgICAgaWYgdmFsdWUgPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiB1bnBhY2sodmFsdWUpCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIG92ZXJyaWRlLnNldChyZWYsIC4uLikKICAgICAgICAgICAgaWYgZGF0YVtyZWZdID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICBkYXRhW3JlZl0gPSBnZXRfdmFsdWUocmVmKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHVpLnNldChyZWYsIC4uLikKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gb3ZlcnJpZGUudW5zZXQocmVmKQogICAgICAgICAgICBpZiBkYXRhW3JlZl0gPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHVpLnNldChyZWYsIHVucGFjayhkYXRhW3JlZl0pKQogICAgICAgICAgICBkYXRhW3JlZl0gPSBuaWwKICAgICAgICBlbmQKICAgIGVuZAoKICAgIC0tLSByZWdpb24gaWVuZ2luZWNsaWVudAogICAgZG8KICAgICAgICBsb2NhbCBuYXRpdmVfR2V0TmV0Q2hhbm5lbEluZm8gPSB2dGFibGVfYmluZCgiZW5naW5lLmRsbCIsICJWRW5naW5lQ2xpZW50MDE0IiwgNzgsICJ2b2lkKihfX3RoaXNjYWxsKikodm9pZCopIikKCiAgICAgICAgZnVuY3Rpb24gaWVuZ2luZWNsaWVudC5nZXRfbmV0X2NoYW5uZWxfaW5mbygpCiAgICAgICAgICAgIHJldHVybiBuYXRpdmVfR2V0TmV0Q2hhbm5lbEluZm8oKQogICAgICAgIGVuZAogICAgZW5kCgogICAgLS0tIHJlZ2lvbiBpbmV0Y2hhbm5lbAogICAgZG8KICAgICAgICBsb2NhbCBuYXRpdmVfSXNMb29wYmFjayA9IHZ0YWJsZV90aHVuayg2LCAiYm9vbChfX3RoaXNjYWxsKikodm9pZCopIikKICAgICAgICBsb2NhbCBuYXRpdmVfSXNUaW1pbmdPdXQgPSB2dGFibGVfdGh1bmsoNywgImJvb2woX190aGlzY2FsbCopKHZvaWQqKSIpCgogICAgICAgIGxvY2FsIG5hdGl2ZV9HZXRMYXRlbmN5ID0gdnRhYmxlX3RodW5rKDksICJmbG9hdChfX3RoaXNjYWxsKikodm9pZCosIGludCBmbG93KSIpCiAgICAgICAgbG9jYWwgbmF0aXZlX0dldEF2Z0xhdGVuY3kgPSB2dGFibGVfdGh1bmsoMTAsICJmbG9hdChfX3RoaXNjYWxsKikodm9pZCosIGludCBmbG93KSIpCgogICAgICAgIGxvY2FsIG5hdGl2ZV9HZXRSZW1vdGVGcmFtZXJhdGUgPSB2dGFibGVfdGh1bmsoMjUsICJ2b2lkKF9fdGhpc2NhbGwqKSh2b2lkKiwgZmxvYXQgKnBmbEZyYW1lVGltZSwgZmxvYXQgKnBmbEZyYW1lVGltZVN0ZERldmlhdGlvbiwgZmxvYXQgKnBmbEZyYW1lU3RhcnRUaW1lU3RkRGV2aWF0aW9uKSIpCgogICAgICAgIGxvY2FsIHBmbEZyYW1lVGltZSA9IGZmaS5uZXcgImZsb2F0WzFdIgogICAgICAgIGxvY2FsIHBmbEZyYW1lVGltZVN0ZERldmlhdGlvbiA9IGZmaS5uZXcgImZsb2F0WzFdIgogICAgICAgIGxvY2FsIHBmbEZyYW1lU3RhcnRUaW1lU3RkRGV2aWF0aW9uID0gZmZpLm5ldyAiZmxvYXRbMV0iCgogICAgICAgIGxvY2FsIGZ1bmN0aW9uIGdldF9yZW1vdGVfZnJhbWVyYXRlKGluZXRjaGFubmVsaW5mbykKICAgICAgICAgICAgaWYgaW5ldGNoYW5uZWxpbmZvID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gMCwgMAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIHNlcnZlcl92YXIgPSAwCiAgICAgICAgICAgIGxvY2FsIHNlcnZlcl9mcmFtZXJhdGUgPSAwCgogICAgICAgICAgICBuYXRpdmVfR2V0UmVtb3RlRnJhbWVyYXRlKGluZXRjaGFubmVsaW5mbywgcGZsRnJhbWVUaW1lLCBwZmxGcmFtZVRpbWVTdGREZXZpYXRpb24sIHBmbEZyYW1lU3RhcnRUaW1lU3RkRGV2aWF0aW9uKQoKICAgICAgICAgICAgaWYgcGZsRnJhbWVUaW1lWzBdID4gMCB0aGVuCiAgICAgICAgICAgICAgICBzZXJ2ZXJfZnJhbWVyYXRlID0gcGZsRnJhbWVUaW1lWzBdICogMTAwMAogICAgICAgICAgICAgICAgc2VydmVyX3ZhciA9IHBmbEZyYW1lU3RhcnRUaW1lU3RkRGV2aWF0aW9uWzBdICogMTAwMAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiBzZXJ2ZXJfZnJhbWVyYXRlLCBzZXJ2ZXJfdmFyCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIGluZXRjaGFubmVsLmlzX2xvb3BiYWNrKGluZXRjaGFubmVsaW5mbykKICAgICAgICAgICAgcmV0dXJuIG5hdGl2ZV9Jc0xvb3BiYWNrKGluZXRjaGFubmVsaW5mbykKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gaW5ldGNoYW5uZWwuaXNfdGltaW5nX291dChpbmV0Y2hhbm5lbGluZm8pCiAgICAgICAgICAgIHJldHVybiBuYXRpdmVfSXNUaW1pbmdPdXQoaW5ldGNoYW5uZWxpbmZvKQogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBpbmV0Y2hhbm5lbC5nZXRfbGF0ZW5jeShpbmV0Y2hhbm5lbGluZm8sIGZsb3cpCiAgICAgICAgICAgIHJldHVybiBuYXRpdmVfR2V0TGF0ZW5jeShpbmV0Y2hhbm5lbGluZm8sIGZsb3cpCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIGluZXRjaGFubmVsLmdldF9hdmdfbGF0ZW5jeShpbmV0Y2hhbm5lbGluZm8sIGZsb3cpCiAgICAgICAgICAgIHJldHVybiBuYXRpdmVfR2V0QXZnTGF0ZW5jeShpbmV0Y2hhbm5lbGluZm8sIGZsb3cpCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIGluZXRjaGFubmVsLmdldF9yZW1vdGVfZnJhbWVyYXRlKGluZXRjaGFubmVsaW5mbykKICAgICAgICAgICAgcmV0dXJuIGdldF9yZW1vdGVfZnJhbWVyYXRlKGluZXRjaGFubmVsaW5mbykKICAgICAgICBlbmQKICAgIGVuZAoKICAgIC0tLSByZWdpb24gY2Vhc2VyCiAgICBkbwogICAgICAgIGxvY2FsIGZ1bmN0aW9uIGFzY2lpX2Jhc2UocykKICAgICAgICAgICAgaWYgc3RyaW5nLmxvd2VyKHMpID09IHMgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIHN0cmluZy5ieXRlKCJhIikKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICByZXR1cm4gc3RyaW5nLmJ5dGUoIkEiKQogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBjZWFzYXIuY2lwaGVyKHMsIGtleSkKICAgICAgICAgICAgbG9jYWwgcmVzdWx0ID0gc3RyaW5nLmdzdWIocywgIiVhIiwgZnVuY3Rpb24oY2hhcikKICAgICAgICAgICAgICAgIGxvY2FsIGJhc2UgPSBhc2NpaV9iYXNlKHMpCiAgICAgICAgICAgICAgICBsb2NhbCBieXRlID0gc3RyaW5nLmJ5dGUoY2hhcikKCiAgICAgICAgICAgICAgICByZXR1cm4gc3RyaW5nLmNoYXIoYmFzZSArIChieXRlIC0gYmFzZSArIGtleSkgJSAyNikKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBjZWFzYXIuZGVjaXBoZXIocywga2V5KQogICAgICAgICAgICByZXR1cm4gY2Vhc2FyLmNpcGhlcihzLCAta2V5KQogICAgICAgIGVuZAogICAgZW5kCgogICAgLS0tIHJlZ2lvbiBtZW51CiAgICBkbwogICAgICAgIGxvY2FsIGl0ZW1zID0geyB9CiAgICAgICAgbG9jYWwgcmVjb3JkcyA9IHsgfQoKICAgICAgICBsb2NhbCBjYWxsYmFja3MgPSB7IH0KCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gZ2V0X3ZhbHVlKHJlZikKICAgICAgICAgICAgbG9jYWwgdmFsdWUgPSB7IHBjYWxsKHVpLmdldCwgcmVmKSB9CiAgICAgICAgICAgIGlmIG5vdCB2YWx1ZVsxXSB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgICAgIHJldHVybiB1bnBhY2sodmFsdWUsIDIpCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIGZ1bmN0aW9uIGdldF9rZXlzKHZhbHVlKQogICAgICAgICAgICBpZiB0eXBlKHZhbHVlWzFdKSA9PSAidGFibGUiIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiB1dGlscy5rZXlzKHZhbHVlWzFdKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiB7IH0KICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gdXBkYXRlX2l0ZW1zKCkKICAgICAgICAgICAgZm9yIGkgPSAxLCAjY2FsbGJhY2tzIGRvCiAgICAgICAgICAgICAgICBjYWxsYmFja3NbaV0oKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZvciBpID0gMSwgI2l0ZW1zIGRvCiAgICAgICAgICAgICAgICBsb2NhbCBpdGVtID0gaXRlbXNbaV0KCiAgICAgICAgICAgICAgICB1aS5zZXRfdmlzaWJsZShpdGVtLnJlZiwgaXRlbS5pc192aXNpYmxlKQogICAgICAgICAgICAgICAgaXRlbS5pc192aXNpYmxlID0gZmFsc2UKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIGNfaXRlbSA9IHsgfSBkbwogICAgICAgICAgICBmdW5jdGlvbiBjX2l0ZW06bmV3KCkKICAgICAgICAgICAgICAgIHJldHVybiBzZXRtZXRhdGFibGUoeyB9LCBzZWxmKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIGNfaXRlbTppbml0KCkKICAgICAgICAgICAgICAgIGxvY2FsIGZ1bmN0aW9uIGNhbGxiYWNrKHJlZikKICAgICAgICAgICAgICAgICAgICBzZWxmOnVwZGF0ZV92YWx1ZShyZWYpCiAgICAgICAgICAgICAgICAgICAgc2VsZjppbnZva2VfY2FsbGJhY2socmVmKQoKICAgICAgICAgICAgICAgICAgICB1cGRhdGVfaXRlbXMoKQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgdWkuc2V0X2NhbGxiYWNrKHNlbGYucmVmLCBjYWxsYmFjaykKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmdW5jdGlvbiBjX2l0ZW06Z2V0KCkKICAgICAgICAgICAgICAgIHJldHVybiB1bnBhY2soc2VsZi52YWx1ZSkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmdW5jdGlvbiBjX2l0ZW06c2V0KC4uLikKICAgICAgICAgICAgICAgIGxvY2FsIHJlZiA9IHNlbGYucmVmCgogICAgICAgICAgICAgICAgdWkuc2V0KHJlZiwgLi4uKQogICAgICAgICAgICAgICAgc2VsZjp1cGRhdGVfdmFsdWUocmVmKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIGNfaXRlbTpoYXZlX2tleShrZXkpCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5rZXlzW2tleV0gfj0gbmlsCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgZnVuY3Rpb24gY19pdGVtOnJhd2dldCgpCiAgICAgICAgICAgICAgICByZXR1cm4gdWkuZ2V0KHNlbGYucmVmKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIGNfaXRlbTpyZXNldCgpCiAgICAgICAgICAgICAgICBwY2FsbCh1aS5zZXQsIHNlbGYucmVmLCB1bnBhY2soc2VsZi5kZWZhdWx0KSkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmdW5jdGlvbiBjX2l0ZW06cmVjb3JkKHRhYiwgbmFtZSkKICAgICAgICAgICAgICAgIGlmIHJlY29yZHNbdGFiXSA9PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgICAgIHJlY29yZHNbdGFiXSA9IHsgfQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgc2VsZi5pc19yZWNvcmRlZCA9IHRydWUKICAgICAgICAgICAgICAgIHJlY29yZHNbdGFiXVtuYW1lXSA9IHNlbGYKCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIGNfaXRlbTpzYXZlKCkKICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLmlzX3JlY29yZGVkIHRoZW4KICAgICAgICAgICAgICAgICAgICBlcnJvcigidW5hYmxlIHRvIHNhdmUgdW5yZWNvcmRlZCBpdGVtIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIHNlbGYuaXNfc2F2ZWQgPSB0cnVlCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIGNfaXRlbTpkaXNwbGF5KCkKICAgICAgICAgICAgICAgIHNlbGYuaXNfdmlzaWJsZSA9IHRydWUKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmdW5jdGlvbiBjX2l0ZW06Y29uZmlnX2lnbm9yZSgpCiAgICAgICAgICAgICAgICBzZWxmLnNhdmVhYmxlID0gZmFsc2UKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgZnVuY3Rpb24gY19pdGVtOnNldF9jYWxsYmFjayhjYWxsYmFjaykKICAgICAgICAgICAgICAgIHNlbGYuY2FsbGJhY2tzWyNzZWxmLmNhbGxiYWNrcyArIDFdID0gY2FsbGJhY2sKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmdW5jdGlvbiBjX2l0ZW06dXBkYXRlX3ZhbHVlKHJlZikKICAgICAgICAgICAgICAgIGxvY2FsIHZhbHVlID0geyBnZXRfdmFsdWUocmVmKSB9CiAgICAgICAgICAgICAgICBzZWxmLmtleXMgPSBnZXRfa2V5cyh2YWx1ZSkKCiAgICAgICAgICAgICAgICBzZWxmLnZhbHVlID0gdmFsdWUKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmdW5jdGlvbiBjX2l0ZW06aW52b2tlX2NhbGxiYWNrKC4uLikKICAgICAgICAgICAgICAgIGZvciBpID0gMSwgI3NlbGYuY2FsbGJhY2tzIGRvCiAgICAgICAgICAgICAgICAgICAgc2VsZi5jYWxsYmFja3NbaV0oLi4uKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgZnVuY3Rpb24gY19pdGVtOmdldF9yZWYoKQogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYucmVmCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgY19pdGVtLl9faW5kZXggPSBjX2l0ZW0KICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gbWVudS5uZXdfaXRlbShmbiwgLi4uKQogICAgICAgICAgICBsb2NhbCByZWYgPSBmbiguLi4pCgogICAgICAgICAgICBsb2NhbCB2YWx1ZSA9IHsgZ2V0X3ZhbHVlKHJlZikgfQogICAgICAgICAgICBsb2NhbCB0eXBlb2YgPSB1aS50eXBlKHJlZikKCiAgICAgICAgICAgIGxvY2FsIGl0ZW0gPSBjX2l0ZW06bmV3KCkKCiAgICAgICAgICAgIGl0ZW0ucmVmID0gcmVmCiAgICAgICAgICAgIGl0ZW0ubmFtZSA9IHNlbGVjdCgzLCAuLi4pCgogICAgICAgICAgICBpdGVtLnZhbHVlID0gdmFsdWUKICAgICAgICAgICAgaXRlbS5kZWZhdWx0ID0gdmFsdWUKCiAgICAgICAgICAgIGl0ZW0ua2V5cyA9IGdldF9rZXlzKHZhbHVlKQogICAgICAgICAgICBpdGVtLmNhbGxiYWNrcyA9IHsgfQoKICAgICAgICAgICAgaXRlbS5pc19zYXZlZCA9IGZhbHNlCiAgICAgICAgICAgIGl0ZW0uaXNfdmlzaWJsZSA9IGZhbHNlCiAgICAgICAgICAgIGl0ZW0uaXNfcmVjb3JkZWQgPSBmYWxzZQoKICAgICAgICAgICAgaXRlbS5zYXZlYWJsZSA9IHRydWUKCiAgICAgICAgICAgIGlmIHR5cGVvZiA9PSAiYnV0dG9uIiB0aGVuCiAgICAgICAgICAgICAgICBpdGVtLmNhbGxiYWNrc1sjaXRlbS5jYWxsYmFja3MgKyAxXSA9IHNlbGVjdCg0LCAuLi4pCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaXRlbTppbml0KCkKICAgICAgICAgICAgaXRlbXNbI2l0ZW1zICsgMV0gPSBpdGVtCgogICAgICAgICAgICByZXR1cm4gaXRlbQogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBtZW51LmdldF9pdGVtcygpCiAgICAgICAgICAgIHJldHVybiBpdGVtcwogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBtZW51LmdldF9yZWNvcmRzKCkKICAgICAgICAgICAgcmV0dXJuIHJlY29yZHMKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gbWVudS5zZXRfY2FsbGJhY2soY2FsbGJhY2spCiAgICAgICAgICAgIGNhbGxiYWNrc1sjY2FsbGJhY2tzICsgMV0gPSBjYWxsYmFjawogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBtZW51LnVwZGF0ZSgpCiAgICAgICAgICAgIHVwZGF0ZV9pdGVtcygpCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIG1lbnUuZ2V0X2l0ZW1zKCkKICAgICAgICAgICAgcmV0dXJuIGl0ZW1zCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBsb2NhbCBxaG91c3NfY29uZmlnX3N5c3RlbSBkbwogICAgICAgIHFob3Vzc19jb25maWdfc3lzdGVtID0geyB9CiAgICAKICAgICAgICBsb2NhbCBmdW5jdGlvbiByZXNvbHZlX2l0ZW1fZXhwb3J0KGl0ZW0pCiAgICAgICAgICAgIGlmIG5vdCBpdGVtLnNhdmVhYmxlIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICBpZiB1aS50eXBlKGl0ZW0ucmVmKSA9PSAibGFiZWwiIG9yIHVpLnR5cGUoaXRlbS5yZWYpID09ICJob3RrZXkiIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICByZXR1cm4gaXRlbS52YWx1ZQogICAgICAgIGVuZAogICAgCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gcmVzb2x2ZV9pdGVtX2ltcG9ydChpdGVtLCBkYXRhKQogICAgICAgICAgICBpZiB1aS50eXBlKGl0ZW0ucmVmKSA9PSAibGFiZWwiIG9yIHVpLnR5cGUoaXRlbS5yZWYpID09ICJob3RrZXkiIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgIGlmIG5vdCBpdGVtLnNhdmVhYmxlIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgIGlmIGRhdGEgPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICBpdGVtOnNldCh1bnBhY2soZGF0YSkpCiAgICAKICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICBlbmQKICAgIAogICAgICAgIGZ1bmN0aW9uIHFob3Vzc19jb25maWdfc3lzdGVtLmV4cG9ydF90b19zdHIoKQogICAgICAgICAgICBsb2NhbCBjb25maWdfcmVzdWx0ID0geyB9CiAgICAKICAgICAgICAgICAgZm9yIF8sIGl0ZW0gaW4gaXBhaXJzKG1lbnUuZ2V0X2l0ZW1zKCkpIGRvCiAgICAgICAgICAgICAgICBjb25maWdfcmVzdWx0W2l0ZW0ubmFtZV0gPSByZXNvbHZlX2l0ZW1fZXhwb3J0KGl0ZW0pCiAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgIGN2YXIucGxheTppbnZva2VfY2FsbGJhY2soImJ1dHRvbnNcXGJsaXAxIikKICAgIAogICAgICAgICAgICByZXR1cm4gYmFzZTY0LmVuY29kZShqc29uLnN0cmluZ2lmeShjb25maWdfcmVzdWx0KSkgLi4gJ19hY2lkJwogICAgICAgIGVuZAogICAgCiAgICAgICAgZnVuY3Rpb24gcWhvdXNzX2NvbmZpZ19zeXN0ZW0uaW1wb3J0X2Zyb21fc3RyKHN0cikKICAgICAgICAgICAgc3RyID0gc3RyOmdzdWIoJ19hY2lkJywgJycpCiAgICAgICAgICAgIGxvY2FsIHN0YXR1cywgY29uZmlnID0gcGNhbGwoYmFzZTY0LmRlY29kZSwgc3RyKQogICAgICAgICAgICBpZiBub3Qgc3RhdHVzIHRoZW4KICAgICAgICAgICAgICAgIHByaW50X3JhdygyNTUsIDEwMCwgMTAwLCAiRmFpbGVkIHRvIGRlY29kZSBjb25maWciKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgIHN0YXR1cywgY29uZmlnID0gcGNhbGwoanNvbi5wYXJzZSwgY29uZmlnKQogICAgICAgICAgICBpZiBub3Qgc3RhdHVzIHRoZW4KICAgICAgICAgICAgICAgIHByaW50X3JhdygyNTUsIDEwMCwgMTAwLCAiRmFpbGVkIHRvIHBhcnNlIGNvbmZpZyIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgZm9yIF8sIGl0ZW0gaW4gaXBhaXJzKG1lbnUuZ2V0X2l0ZW1zKCkpIGRvCiAgICAgICAgICAgICAgICBsb2NhbCBpbXBvcnRlZCA9IHJlc29sdmVfaXRlbV9pbXBvcnQoaXRlbSwgY29uZmlnW2l0ZW0ubmFtZV0pCiAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBpbXBvcnRlZCB0aGVuCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgY3Zhci5wbGF5Omludm9rZV9jYWxsYmFjaygiYnV0dG9uc1xcYmxpcDIiKQogICAgICAgIGVuZAogICAgZW5kCgogICAgLS0tIHJlZ2lvbiBndWkKICAgIGRvCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gc2V0X25hdGl2ZV91aSh2aXNpYmxlKQogICAgICAgICAgICBsb2NhbCBwaXRjaF92YWwgPSB1aS5nZXQoc29mdHdhcmUuYWEuYW5nbGVzLnBpdGNoWzFdKQogICAgICAgICAgICBsb2NhbCB5YXdfdmFsID0gdWkuZ2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy55YXdbMV0pCiAgICAgICAgICAgIGxvY2FsIHlhd19qaXR0ZXJfdmFsID0gdWkuZ2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy55YXdfaml0dGVyWzFdKQogICAgICAgICAgICBsb2NhbCBib2R5X3lhd192YWwgPSB1aS5nZXQoc29mdHdhcmUuYWEuYW5nbGVzLmJvZHlfeWF3WzFdKQoKICAgICAgICAgICAgdWkuc2V0X3Zpc2libGUoc29mdHdhcmUuYWEuYW5nbGVzLmVuYWJsZWQsIHZpc2libGUpCiAgICAgICAgICAgIHVpLnNldF92aXNpYmxlKHNvZnR3YXJlLmFhLmFuZ2xlcy5waXRjaFsxXSwgdmlzaWJsZSkKICAgICAgICAgICAgdWkuc2V0X3Zpc2libGUoc29mdHdhcmUuYWEuYW5nbGVzLnlhd19iYXNlLCB2aXNpYmxlKQogICAgICAgICAgICB1aS5zZXRfdmlzaWJsZShzb2Z0d2FyZS5hYS5hbmdsZXMueWF3WzFdLCB2aXNpYmxlKQogICAgICAgICAgICB1aS5zZXRfdmlzaWJsZShzb2Z0d2FyZS5hYS5hbmdsZXMuYm9keV95YXdbMV0sIHZpc2libGUpCiAgICAgICAgICAgIHVpLnNldF92aXNpYmxlKHNvZnR3YXJlLmFhLmFuZ2xlcy5lZGdlX3lhdywgdmlzaWJsZSkKICAgICAgICAgICAgdWkuc2V0X3Zpc2libGUoc29mdHdhcmUuYWEuYW5nbGVzLmZyZWVzdGFuZGluZ1sxXSwgdmlzaWJsZSkKICAgICAgICAgICAgdWkuc2V0X3Zpc2libGUoc29mdHdhcmUuYWEuYW5nbGVzLmZyZWVzdGFuZGluZ1syXSwgdmlzaWJsZSkKICAgICAgICAgICAgdWkuc2V0X3Zpc2libGUoc29mdHdhcmUuYWEuYW5nbGVzLnJvbGwsIHZpc2libGUpCgogICAgICAgICAgICBpZiBwaXRjaF92YWwgPT0gIkN1c3RvbSIgdGhlbgogICAgICAgICAgICAgICAgdWkuc2V0X3Zpc2libGUoc29mdHdhcmUuYWEuYW5nbGVzLnBpdGNoWzJdLCB2aXNpYmxlKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIHlhd192YWwgfj0gIk9mZiIgdGhlbgogICAgICAgICAgICAgICAgdWkuc2V0X3Zpc2libGUoc29mdHdhcmUuYWEuYW5nbGVzLnlhd1syXSwgdmlzaWJsZSkKICAgICAgICAgICAgICAgIHVpLnNldF92aXNpYmxlKHNvZnR3YXJlLmFhLmFuZ2xlcy55YXdfaml0dGVyWzFdLCB2aXNpYmxlKQoKICAgICAgICAgICAgICAgIGlmIHlhd19qaXR0ZXJfdmFsIH49ICJPZmYiIHRoZW4KICAgICAgICAgICAgICAgICAgICB1aS5zZXRfdmlzaWJsZShzb2Z0d2FyZS5hYS5hbmdsZXMueWF3X2ppdHRlclsyXSwgdmlzaWJsZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIGJvZHlfeWF3X3ZhbCB+PSAiT2ZmIiB0aGVuCiAgICAgICAgICAgICAgICBpZiBib2R5X3lhd192YWwgfj0gIk9wcG9zaXRlIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0X3Zpc2libGUoc29mdHdhcmUuYWEuYW5nbGVzLmJvZHlfeWF3WzJdLCB2aXNpYmxlKQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgdWkuc2V0X3Zpc2libGUoc29mdHdhcmUuYWEuYW5nbGVzLmZyZWVzdGFuZGluZ19ib2R5X3lhdywgdmlzaWJsZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIGRvCiAgICAgICAgICAgIGd1aS5lbmFibGVkID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfY2hlY2tib3gsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCBzdHJpbmcuZm9ybWF0KCdcYSVzQWNpZFRlY2gnLCB1dGlscy50b19oZXgoMTgyLCAxODIsIDEwMSwgMjU1KSkpCiAgICAgICAgICAgIDogcmVjb3JkKCJndWkiLCAiZW5hYmxlZCIpCgogICAgICAgICAgICBndWkuZW5hYmxlZDpzZXQodHJ1ZSkKICAgICAgICBlbmQKCiAgICAgICAgLS0gc2hhcmVkLm9ubGluZV9sYWJlbCA9IG1lbnUubmV3X2l0ZW0odWkubmV3X2xhYmVsLCAnQUEnLCAnQW50aS1haW1ib3QgYW5nbGVzJywgJ0Nvbm5lY3RpbmcuLi4nKQoKICAgICAgICBndWkuc2VsZWN0aW9uID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfY29tYm9ib3gsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCBtZXJnZSB7ICJcbiIsICJndWkuc2VsZWN0aW9uIiB9LCB7ICJIb21lIiwgIlNldHRpbmdzIiwgIkFudGktYWltIiB9KQogICAgICAgIDogcmVjb3JkKCJndWkiLCAic2VsZWN0aW9uIikKCiAgICAgICAgZnVuY3Rpb24gZ3VpLnNodXRkb3duKCkKICAgICAgICAgICAgc2V0X25hdGl2ZV91aSh0cnVlKQogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBndWkuZnJhbWUoKQogICAgICAgICAgICBzZXRfbmF0aXZlX3VpKG5vdCBndWkuZW5hYmxlZDpnZXQoKSkKICAgICAgICBlbmQKICAgIGVuZAoKICAgIC0tLSByZWdpb24gbW90aW9uCiAgICBkbwogICAgICAgIGxvY2FsIGZ1bmN0aW9uIGxpbmVhcih0LCBiLCBjLCBkKQogICAgICAgICAgICByZXR1cm4gYyAqIHQgLyBkICsgYgogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBmdW5jdGlvbiBnZXRfZGVsdGF0aW1lKCkKICAgICAgICAgICAgcmV0dXJuIGdsb2JhbHMuZnJhbWV0aW1lKCkKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gc29sdmUoZWFzaW5nX2ZuLCBwcmV2LCBuZXcsIGNsb2NrLCBkdXJhdGlvbikKICAgICAgICAgICAgaWYgY2xvY2sgPD0gMCB0aGVuIHJldHVybiBuZXcgZW5kCiAgICAgICAgICAgIGlmIGNsb2NrID49IGR1cmF0aW9uIHRoZW4gcmV0dXJuIG5ldyBlbmQKCiAgICAgICAgICAgIHByZXYgPSBlYXNpbmdfZm4oY2xvY2ssIHByZXYsIG5ldyAtIHByZXYsIGR1cmF0aW9uKQoKICAgICAgICAgICAgaWYgdHlwZShwcmV2KSA9PSAibnVtYmVyIiB0aGVuCiAgICAgICAgICAgICAgICBpZiBtYXRoLmFicyhuZXcgLSBwcmV2KSA8IDAuMDAxIHRoZW4KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3CiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBsb2NhbCByZW1haW5kZXIgPSBtYXRoLmZtb2QocHJldiwgMS4wKQoKICAgICAgICAgICAgICAgIGlmIHJlbWFpbmRlciA8IDAuMDAxIHRoZW4KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWF0aC5mbG9vcihwcmV2KQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgcmVtYWluZGVyID4gMC45OTkgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybiBtYXRoLmNlaWwocHJldikKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiBwcmV2CiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIG1vdGlvbi5pbnRlcnAoYSwgYiwgdCwgZWFzaW5nX2ZuKQogICAgICAgICAgICBlYXNpbmdfZm4gPSBlYXNpbmdfZm4gb3IgbGluZWFyCgogICAgICAgICAgICBpZiB0eXBlKGIpID09ICJib29sZWFuIiB0aGVuCiAgICAgICAgICAgICAgICBiID0gYiBhbmQgMSBvciAwCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuIHNvbHZlKGVhc2luZ19mbiwgYSwgYiwgZ2V0X2RlbHRhdGltZSgpLCB0KQogICAgICAgIGVuZAogICAgZW5kCgogICAgLS0tIHJlZ2lvbiB3aW5kb3dzCiAgICBkbwogICAgICAgIGxvY2FsIGRhdGEgPSB7IH0KICAgICAgICBsb2NhbCBxdWV1ZSA9IHsgfQogICAgCiAgICAgICAgbG9jYWwgbW91c2VfcG9zID0gdmVjdG9yKCkKICAgICAgICBsb2NhbCBtb3VzZV9wb3NfcHJldiA9IHZlY3RvcigpCiAgICAKICAgICAgICBsb2NhbCBtb3VzZV9kb3duID0gZmFsc2UKICAgICAgICBsb2NhbCBtb3VzZV9jbGlja2VkID0gZmFsc2UKICAgIAogICAgICAgIGxvY2FsIG1vdXNlX2Rvd25fZHVyYXRpb24gPSAwCiAgICAgICAgbG9jYWwgZHJhZ2dpbmdfc210aCA9IGZhbHNlCiAgICAKICAgICAgICBsb2NhbCBtb3VzZV9kZWx0YSA9IHZlY3RvcigpCiAgICAgICAgbG9jYWwgbW91c2VfY2xpY2tlZF9wb3MgPSB2ZWN0b3IoKQogICAgCiAgICAgICAgbG9jYWwgaG92ZXJlZF93aW5kb3cKICAgICAgICBsb2NhbCBmb3JlZ3JvdW5kX3dpbmRvdwogICAgCiAgICAgICAgbG9jYWwgY193aW5kb3cgPSB7IH0gZG8KICAgICAgICAgICAgZnVuY3Rpb24gY193aW5kb3c6bmV3KG5hbWUpCiAgICAgICAgICAgICAgICBsb2NhbCB3aW5kb3cgPSB7IH0KICAgIAogICAgICAgICAgICAgICAgd2luZG93Lm5hbWUgPSBuYW1lCiAgICAKICAgICAgICAgICAgICAgIHdpbmRvdy5wb3MgPSB2ZWN0b3IoKQogICAgICAgICAgICAgICAgd2luZG93LnNpemUgPSB2ZWN0b3IoKQogICAgCiAgICAgICAgICAgICAgICB3aW5kb3cuYW5jaG9yID0gdmVjdG9yKDAuMCwgMC4wKQogICAgCiAgICAgICAgICAgICAgICB3aW5kb3cudXBkYXRlZCA9IGZhbHNlCiAgICAgICAgICAgICAgICB3aW5kb3cuZHJhZ2dpbmcgPSBmYWxzZQogICAgCiAgICAgICAgICAgICAgICBkYXRhW25hbWVdID0gd2luZG93CiAgICAgICAgICAgICAgICBxdWV1ZVsjcXVldWUgKyAxXSA9IHdpbmRvdwogICAgCiAgICAgICAgICAgICAgICBzZXRtZXRhdGFibGUod2luZG93LCBzZWxmKQogICAgICAgICAgICAgICAgcmV0dXJuIHdpbmRvdwogICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICBmdW5jdGlvbiBjX3dpbmRvdzpzZXRfcG9zKHBvcykKICAgICAgICAgICAgICAgIGxvY2FsIHNjcmVlbiA9IHZlY3RvcihjbGllbnQuc2NyZWVuX3NpemUoKSkKICAgICAgICAgICAgICAgIGxvY2FsIG5ld19wb3MgPSBwb3M6Y2xvbmUoKQogICAgCiAgICAgICAgICAgICAgICBuZXdfcG9zLnggPSB1dGlscy5jbGFtcChuZXdfcG9zLngsIDAsIHNjcmVlbi54IC0gc2VsZi5zaXplLngpCiAgICAgICAgICAgICAgICBuZXdfcG9zLnkgPSB1dGlscy5jbGFtcChuZXdfcG9zLnksIDAsIHNjcmVlbi55IC0gc2VsZi5zaXplLnkpCiAgICAKICAgICAgICAgICAgICAgIHNlbGYucG9zID0gbmV3X3BvcwogICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICBmdW5jdGlvbiBjX3dpbmRvdzpzZXRfc2l6ZShzaXplKQogICAgICAgICAgICAgICAgbG9jYWwgc2l6ZV9kZWx0YSA9IHNpemUgLSBzZWxmLnNpemUKICAgIAogICAgICAgICAgICAgICAgc2VsZi5zaXplID0gc2l6ZQogICAgICAgICAgICAgICAgc2VsZjpzZXRfcG9zKHNlbGYucG9zIC0gc2l6ZV9kZWx0YSAqIHNlbGYuYW5jaG9yKQogICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICBmdW5jdGlvbiBjX3dpbmRvdzpzZXRfYW5jaG9yKGFuY2hvcikKICAgICAgICAgICAgICAgIHNlbGYuYW5jaG9yID0gYW5jaG9yCiAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgIGZ1bmN0aW9uIGNfd2luZG93OmlzX2hvdmVyaW5nKCkKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmhvdmVyaW5nCiAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgIGZ1bmN0aW9uIGNfd2luZG93OmlzX2RyYWdnaW5nKCkKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmRyYWdnaW5nCiAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgIGZ1bmN0aW9uIGNfd2luZG93OnVwZGF0ZSgpCiAgICAgICAgICAgICAgICBzZWxmLnVwZGF0ZWQgPSB0cnVlCiAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgIGNfd2luZG93Ll9faW5kZXggPSBjX3dpbmRvdwogICAgICAgIGVuZAogICAgCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gaXNfY29sbGlkZWQocG9pbnQsIGEsIGIpCiAgICAgICAgICAgIHJldHVybiBwb2ludC54ID49IGEueCBhbmQgcG9pbnQueSA+PSBhLnkKICAgICAgICAgICAgICAgIGFuZCBwb2ludC54IDw9IGIueCBhbmQgcG9pbnQueSA8PSBiLnkKICAgICAgICBlbmQKICAgIAogICAgICAgIGxvY2FsIGZ1bmN0aW9uIHVwZGF0ZV9tb3VzZV9pbnB1dHMoKQogICAgICAgICAgICBsb2NhbCBjdXJzb3IgPSB2ZWN0b3IodWkubW91c2VfcG9zaXRpb24oKSkKICAgICAgICAgICAgbG9jYWwgaXNfZG93biA9IGNsaWVudC5rZXlfc3RhdGUoMHgwMSkKICAgIAogICAgICAgICAgICBsb2NhbCBkZWx0YV90aW1lID0gZ2xvYmFscy5mcmFtZXRpbWUoKQogICAgCiAgICAgICAgICAgIG1vdXNlX3BvcyA9IGN1cnNvcgogICAgICAgICAgICBtb3VzZV9kZWx0YSA9IG1vdXNlX3BvcyAtIG1vdXNlX3Bvc19wcmV2CiAgICAKICAgICAgICAgICAgbW91c2VfcG9zX3ByZXYgPSBtb3VzZV9wb3MKICAgIAogICAgICAgICAgICBtb3VzZV9kb3duID0gaXNfZG93bgogICAgICAgICAgICBtb3VzZV9jbGlja2VkID0gaXNfZG93biBhbmQgbW91c2VfZG93bl9kdXJhdGlvbiA8IDAKICAgIAogICAgICAgICAgICBtb3VzZV9kb3duX2R1cmF0aW9uID0gaXNfZG93biBhbmQgKG1vdXNlX2Rvd25fZHVyYXRpb24gPCAwIGFuZCAwIG9yIG1vdXNlX2Rvd25fZHVyYXRpb24gKyBkZWx0YV90aW1lKSBvciAtMQogICAgCiAgICAgICAgICAgIGlmIG1vdXNlX2NsaWNrZWQgdGhlbgogICAgICAgICAgICAgICAgbW91c2VfY2xpY2tlZF9wb3MgPSBtb3VzZV9wb3MKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAKICAgICAgICBsb2NhbCBmdW5jdGlvbiBhcHBlYXJfYWxsX3dpbmRvd3MoKQogICAgICAgICAgICBmb3IgaSA9IDEsICNxdWV1ZSBkbwogICAgICAgICAgICAgICAgbG9jYWwgd2luZG93ID0gcXVldWVbaV0KICAgIAogICAgICAgICAgICAgICAgbG9jYWwgcG9zID0gd2luZG93LnBvcwogICAgICAgICAgICAgICAgbG9jYWwgc2l6ZSA9IHdpbmRvdy5zaXplCiAgICAKICAgICAgICAgICAgICAgIGxvY2FsIHIsIGcsIGIsIGEgPSAwLCAwLCAwLCAyNTUKICAgIAogICAgICAgICAgICAgICAgcmVuZGVyZXIucmVjdGFuZ2xlKHBvcy54LCBwb3MueSwgc2l6ZS54LCBzaXplLnksIHIsIGcsIGIsIGEpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gZmluZF9ob3ZlcmVkX3dpbmRvdygpCiAgICAgICAgICAgIGxvY2FsIGZvdW5kX3dpbmRvdyA9IG5pbAogICAgCiAgICAgICAgICAgIGlmIHVpLmlzX21lbnVfb3BlbigpIHRoZW4KICAgICAgICAgICAgICAgIGZvciBpID0gMSwgI3F1ZXVlIGRvCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgd2luZG93ID0gcXVldWVbaV0KICAgIAogICAgICAgICAgICAgICAgICAgIGxvY2FsIHBvcyA9IHdpbmRvdy5wb3MKICAgICAgICAgICAgICAgICAgICBsb2NhbCBzaXplID0gd2luZG93LnNpemUKICAgIAogICAgICAgICAgICAgICAgICAgIGlmIG5vdCB3aW5kb3cudXBkYXRlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gY29udGludWUKICAgICAgICAgICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpc19jb2xsaWRlZChtb3VzZV9wb3MsIHBvcywgcG9zICsgc2l6ZSkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgICAgICAgICBmb3VuZF93aW5kb3cgPSB3aW5kb3cKICAgICAgICAgICAgICAgICAgICA6OmNvbnRpbnVlOjoKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICBob3ZlcmVkX3dpbmRvdyA9IGZvdW5kX3dpbmRvdwogICAgICAgIGVuZAogICAgCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gZmluZF9mb3JlZ3JvdW5kX3dpbmRvdygpCiAgICAgICAgICAgIGlmIG1vdXNlX2Rvd24gdGhlbgogICAgICAgICAgICAgICAgaWYgbW91c2VfY2xpY2tlZCBhbmQgaG92ZXJlZF93aW5kb3cgfj0gbmlsIHRoZW4KICAgICAgICAgICAgICAgICAgICBmb3IgaSA9IDEsICNxdWV1ZSBkbwogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB3aW5kb3cgPSBxdWV1ZVtpXQogICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHdpbmRvdyA9PSBob3ZlcmVkX3dpbmRvdyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5yZW1vdmUocXVldWUsIGkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQocXVldWUsIHdpbmRvdykKICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgICAgICAgICBmb3JlZ3JvdW5kX3dpbmRvdyA9IGhvdmVyZWRfd2luZG93CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgIGZvcmVncm91bmRfd2luZG93ID0gbmlsCiAgICAgICAgZW5kCiAgICAKICAgICAgICBsb2NhbCBmdW5jdGlvbiB1cGRhdGVfYWxsX3dpbmRvd3MoKQogICAgICAgICAgICBmb3IgaSA9IDEsICNxdWV1ZSBkbwogICAgICAgICAgICAgICAgbG9jYWwgd2luZG93ID0gcXVldWVbaV0KICAgIAogICAgICAgICAgICAgICAgd2luZG93LnVwZGF0ZWQgPSBmYWxzZQogICAgCiAgICAgICAgICAgICAgICB3aW5kb3cuaG92ZXJpbmcgPSBmYWxzZQogICAgICAgICAgICAgICAgd2luZG93LmRyYWdnaW5nID0gZmFsc2UKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAKICAgICAgICBsb2NhbCBmdW5jdGlvbiB1cGRhdGVfaG92ZXJlZF93aW5kb3coKQogICAgICAgICAgICBpZiBob3ZlcmVkX3dpbmRvdyA9PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgIGhvdmVyZWRfd2luZG93LmhvdmVyaW5nID0gdHJ1ZQogICAgICAgIGVuZAogICAgCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gdXBkYXRlX2ZvcmVncm91bmRfd2luZG93KCkKICAgICAgICAgICAgZHJhZ2dpbmdfc210aCA9IGZhbHNlCiAgICAgICAgICAgIGlmIGZvcmVncm91bmRfd2luZG93ID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgbG9jYWwgbmV3X3Bvc2l0aW9uID0gZm9yZWdyb3VuZF93aW5kb3cucG9zICsgbW91c2VfZGVsdGEKICAgIAogICAgICAgICAgICBmb3JlZ3JvdW5kX3dpbmRvdzpzZXRfcG9zKG5ld19wb3NpdGlvbikKICAgICAgICAgICAgZm9yZWdyb3VuZF93aW5kb3cuZHJhZ2dpbmcgPSB0cnVlCiAgICAgICAgICAgIGRyYWdnaW5nX3NtdGggPSB0cnVlCiAgICAgICAgZW5kCiAgICAKICAgICAgICBmdW5jdGlvbiB3aW5kb3dzLm5ldyhuYW1lLCB4LCB5KQogICAgICAgICAgICBsb2NhbCB3aW5kb3cgPSBkYXRhW25hbWVdCiAgICAgICAgICAgICAgICBvciBjX3dpbmRvdzpuZXcobmFtZSkKICAgIAogICAgICAgICAgICBsb2NhbCBzY3JlZW4gPSB2ZWN0b3IoY2xpZW50LnNjcmVlbl9zaXplKCkpCiAgICAgICAgICAgIHdpbmRvdzpzZXRfcG9zKHNjcmVlbiAqIHZlY3Rvcih4LCB5KSkKICAgIAogICAgICAgICAgICByZXR1cm4gd2luZG93CiAgICAgICAgZW5kCiAgICAKICAgICAgICBmdW5jdGlvbiB3aW5kb3dzLmZyYW1lKCkKICAgICAgICAgICAgLS0gYXBwZWFyX2FsbF93aW5kb3dzKCkKICAgICAgICAgICAgdXBkYXRlX21vdXNlX2lucHV0cygpCiAgICAKICAgICAgICAgICAgZmluZF9ob3ZlcmVkX3dpbmRvdygpCiAgICAgICAgICAgIGZpbmRfZm9yZWdyb3VuZF93aW5kb3coKQogICAgCiAgICAgICAgICAgIHVwZGF0ZV9hbGxfd2luZG93cygpCiAgICAKICAgICAgICAgICAgdXBkYXRlX2hvdmVyZWRfd2luZG93KCkKICAgICAgICAgICAgdXBkYXRlX2ZvcmVncm91bmRfd2luZG93KCkKICAgICAgICBlbmQKICAgIAogICAgICAgIGNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soJ3NldHVwX2NvbW1hbmQnLCBmdW5jdGlvbiAoY21kKQogICAgICAgICAgICBpZiBkcmFnZ2luZ19zbXRoIG9yIGhvdmVyZWRfd2luZG93IHRoZW4KICAgICAgICAgICAgICAgIGNtZC5pbl9hdHRhY2sgPSBmYWxzZQogICAgICAgICAgICAgICAgY21kLmluX2F0dGFjazIgPSBmYWxzZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKCiAgICAtLS0gcmVnaW9uIGdyYXBoaWNzCiAgICBkbwogICAgICAgIGxvY2FsIGFscGhhX3VuaXQgPSAxIC8gMjU1CgogICAgICAgIGxvY2FsIGZ1bmN0aW9uIHN0cmluZ19hbHBoYV9tb2QocywgYWxwaGEpCiAgICAgICAgICAgIGxvY2FsIHJlc3VsdCA9IHM6Z3N1YigiXGEoJXgleCV4JXgleCV4KSgleCV4KSIsIGZ1bmN0aW9uKHJnYiwgYSkKICAgICAgICAgICAgICAgIHJldHVybiBmKCJcYSVzJTAyeCIsIHJnYiwgdG9udW1iZXIoYSwgMTYpICogYWxwaGEpCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIHJldHVybiByZXN1bHQKICAgICAgICBlbmQKCiAgICAgICAgZ3JhcGhpY3MuY29uZmlnX2V4cG9ydCA9IG1lbnUubmV3X2l0ZW0odWkubmV3X2J1dHRvbiwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJFeHBvcnQgQ29uZmlndXJhdGlvbiIsIGZ1bmN0aW9uICgpCiAgICAgICAgICAgIGNsaXBib2FyZC5zZXQocWhvdXNzX2NvbmZpZ19zeXN0ZW0uZXhwb3J0X3RvX3N0cigpKQogICAgICAgIGVuZCk6Y29uZmlnX2lnbm9yZSgpCgogICAgICAgIGdyYXBoaWNzLmNvbmZpZ19pbXBvcnQgPSBtZW51Lm5ld19pdGVtKHVpLm5ld19idXR0b24sICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiSW1wb3J0IENvbmZpZ3VyYXRpb24iLCBmdW5jdGlvbiAoKQogICAgICAgICAgICBxaG91c3NfY29uZmlnX3N5c3RlbS5pbXBvcnRfZnJvbV9zdHIoY2xpcGJvYXJkLmdldCgpKQogICAgICAgIGVuZCk6Y29uZmlnX2lnbm9yZSgpCgogICAgICAgIGdyYXBoaWNzLmNvbmZpZ19kZWZhdWx0ID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfYnV0dG9uLCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIkRlZmF1bHQgQ29uZmlndXJhdGlvbiIsIGZ1bmN0aW9uICgpCiAgICAgICAgICAgIHFob3Vzc19jb25maWdfc3lzdGVtLmltcG9ydF9mcm9tX3N0cigKICAgICAgICAgICAgICAgICdleUpDYjJSNUlIbGhkMXh1WTNWemRHOXRYMkp2WkhsZmVXRjNYMU4wWVc1a2FXNW5JanBiSWs5bVppSmRMQ0pWZEdsc2FYUjVJSGRsWVhCdmJpSTZXM3Q5WFN3aVhHNWpkWE4wYjIxZmVXRjNYekU0TUd4eVgyMXZaR1ZmUm1GclpTQk1ZV2NpT2xzaVUybGtaU0JpWVhObFpDSmRMQ0l0SUU5d2RHbHZibk1pT2x0YklrUnBjMkZpYkdVZ2IyNGdWMkZ5YlhWd0lpd2lSR2x6WVdKc1pTQlhhR2xzWlNCT2J5QkZibVZ0YVdWeklpd2lRWFp2YVdRZ1FtRmphM04wWVdJaUxDSkdZWE4wSUV4aFpHUmxjaUlzSWtWa1oyVWdXV0YzSUc5dUlFWkVJbDFkTENKWllYY2dZbUZ6WlZ4dVkzVnpkRzl0WDNsaGQxOWlZWE5sWDBaaGEyVWdUR0ZuSWpwYklreHZZMkZzSUhacFpYY2lYU3dpWEc1UWIzTnBkR2x2YmlJNld6VXdYU3dpTFNCVGRHRjBaVnh1WkdWbVpXNXphWFpsT2pwemRHRjBaU0k2VzFzaVFXbHlJaXdpVTNSaGJtUnBibWNpTENKRGNtOTFZMmhsWkNKZFhTd2lYRzVqZFhOMGIyMWZlV0YzWDI5bVpuTmxkRjlUZEdGdVpHbHVaeUk2V3pCZExDSkVaV3hoZVZ4dVkzVnpkRzl0WDBSbGJHRjVYME55YjNWamFHVmtJanBiTlYwc0lsSnBaMmgwSUc5bVpuTmxkRnh1WTNWemRHOXRYM2xoZDE5eWFXZG9kRjlUZEdGdVpHbHVaeUk2V3pCZExDSmNibU4xYzNSdmJWOTVZWGRmTVRnd2JISmZiVzlrWlY5TllXbHVJanBiSWxOcFpHVWdZbUZ6WldRaVhTd2lVbUZ1Wkc5dGFYcGhkR2x2Ymx4dVkzVnpkRzl0WDJwcGRIUmxjbDl5WVc1a2IyMXBlbUYwYVc5dVgxTjBZVzVrYVc1bklqcGJNRjBzSWxsaGQxeHVZM1Z6ZEc5dFgzbGhkMTlOYjNacGJtY2lPbHNpVDJabUlsMHNJbHh1WTNWemRHOXRYM2xoZDE5dlptWnpaWFJmVTJ4dmR5QlhZV3hySWpwYk1GMHNJbHh1WjNWcExuTmxiR1ZqZEdsdmJpSTZXeUpJYjIxbElsMHNJbHh1WTNWemRHOXRYMkp2WkhsZmVXRjNYMjltWm5ObGRGOUdZV3RsSUV4aFp5STZXekJkTENKUWFYUmphRnh1WTNWemRHOXRYM0JwZEdOb1gwMXZkbWx1WnlJNld5SlBabVlpWFN3aVJHVnNZWGxjYm1OMWMzUnZiVjlFWld4aGVWOU5iM1pwYm1jaU9sczFYU3dpVW1sbmFIUWdiMlptYzJWMFhHNWpkWE4wYjIxZmVXRjNYM0pwWjJoMFgwTnliM1ZqYUdWa0lqcGJNRjBzSWkwZ1NYUmxiWE5jYm5kcFpHZGxkSE02T21sMFpXMXpJanBiV3lKWFlYUmxjbTFoY21zaUxDSkxaWGxpYVc1a2N5SXNJbFpsYkc5amFYUjVJRmRoY201cGJtY2lMQ0pEY205emMyaGhhWElnU1c1a2FXTmhkRzl5SWl3aVJHRnRZV2RsSUVsdVpHbGpZWFJ2Y2lJc0lrOXVMVk5qY21WbGJpQk1iMmR6SWl3aVNHbDBJRkpoZEdVaVhWMHNJa3hsWm5RZ2IyWm1jMlYwWEc1amRYTjBiMjFmZVdGM1gyeGxablJmUm1GclpTQk1ZV2NpT2xzd1hTd2lVbUZ1Wkc5dGFYcGhkR2x2Ymx4dVkzVnpkRzl0WDJwcGRIUmxjbDl5WVc1a2IyMXBlbUYwYVc5dVgwRnBjaUJEY205MVkyaGxaQ0k2V3pCZExDSlpZWGRjYm1OMWMzUnZiVjk1WVhkZlUzUmhibVJwYm1jaU9sc2lUMlptSWwwc0lseHVZM1Z6ZEc5dFgzbGhkMTl2Wm1aelpYUmZUVzkyYVc1bklqcGJNRjBzSWx4dVkzVnpkRzl0WDNsaGQxOXZabVp6WlhSZlFXbHlJanBiTUYwc0lseHVZM1Z6ZEc5dFgycHBkSFJsY2w5dGIyUmxYMU5zYjNjZ1YyRnNheUk2V3lJeUxWZGhlU0pkTENKWllYY2dZbUZ6WlZ4dVkzVnpkRzl0WDNsaGQxOWlZWE5sWDBOeWIzVmphR1ZrSWpwYklreHZZMkZzSUhacFpYY2lYU3dpV1dGM0lHcHBkSFJsY2x4dVkzVnpkRzl0WDNsaGQxOXFhWFIwWlhKZlUzUmhibVJwYm1jaU9sc2lUMlptSWwwc0lrcHBkSFJsY2lCdlptWnpaWFJjYm1OMWMzUnZiVjlxYVhSMFpYSmZiMlptYzJWMFgwRnBjaUJEY205MVkyaGxaQ0k2V3pCZExDSmNibU4xYzNSdmJWOWliMlI1WDNsaGQxOXZabVp6WlhSZlEzSnZkV05vWldRaU9sc3dYU3dpVjJsa1oyVjBjeUk2VzNSeWRXVmRMQ0pjYm1OMWMzUnZiVjl3YVhSamFGOXZabVp6WlhSZlRXOTJaU0JEY205MVkyaGxaQ0k2V3pCZExDSk5ZVzUxWVd3Z1EyOXNiM0lpT2xzeE1UTXNNVFV5TERJMU5Td3lOVFZkTENJdElGQnBkR05vWEc1a1pXWmxibk5wZG1VNk9uQnBkR05vSWpwYklsVndJRk4zYVhSamFDSmRMQ0pjYm1OMWMzUnZiVjlxYVhSMFpYSmZiVzlrWlY5QmFYSWlPbHNpTWkxWFlYa2lYU3dpUkdWc1lYbGNibU4xYzNSdmJWOUVaV3hoZVY5QmFYSWdRM0p2ZFdOb1pXUWlPbHMxWFN3aVZIZGxZV3R6SWpwYmRISjFaVjBzSWtKdlpIa2dlV0YzWEc1amRYTjBiMjFmWW05a2VWOTVZWGRmVTJ4dmR5QlhZV3hySWpwYklrOW1aaUpkTENKUWFYUmphRnh1WTNWemRHOXRYM0JwZEdOb1gxTjBZVzVrYVc1bklqcGJJazltWmlKZExDSk1aV1owSUc5bVpuTmxkRnh1WTNWemRHOXRYM2xoZDE5c1pXWjBYMU4wWVc1a2FXNW5JanBiTUYwc0lsTmhabVVnU0dWaFpDSTZXM1J5ZFdWZExDSkNiMlI1SUhsaGQxeHVZM1Z6ZEc5dFgySnZaSGxmZVdGM1gwRnBjaUk2V3lKUFptWWlYU3dpVTJoaGNtVmtJRXh2WjI4aU9sdDBjblZsWFN3aVdXRjNYRzVqZFhOMGIyMWZlV0YzWDFOc2IzY2dWMkZzYXlJNld5SlBabVlpWFN3aVJuSmxaWE4wWVc1a2FXNW5JR0p2WkhrZ2VXRjNYRzVqZFhOMGIyMWZabkpsWlhOMFlXNWthVzVuWDJKdlpIbGZlV0YzWDFOc2IzY2dWMkZzYXlJNlcyWmhiSE5sWFN3aVdXRjNJR3BwZEhSbGNseHVZM1Z6ZEc5dFgzbGhkMTlxYVhSMFpYSmZRV2x5SWpwYklrOW1aaUpkTENKUWFYUmphRnh1WTNWemRHOXRYM0JwZEdOb1gwRnBjaUk2V3lKUFptWWlYU3dpV1dGM0lHSmhjMlZjYm1OMWMzUnZiVjk1WVhkZlltRnpaVjlOWVdsdUlqcGJJa3h2WTJGc0lIWnBaWGNpWFN3aVRHVm1kQ0J2Wm1aelpYUmNibU4xYzNSdmJWOTVZWGRmYkdWbWRGOVRiRzkzSUZkaGJHc2lPbHN3WFN3aVUzUmhkR1VpT2xzaVRXRnBiaUpkTENJdElFUnBjMkZpYkdVZ1QyNWNibVp6WDJScGMyRmliR1Z5Y3pvNmMzUmhkR1Z6SWpwYmUzMWRMQ0pOWVc1MVlXd2dXV0YzSWpwYmRISjFaVjBzSWtOdmJHOXlJanBiTWpVMUxESTFOU3d5TlRVc01qVTFYU3dpV1dGM1hHNWpkWE4wYjIxZmVXRjNYMDF2ZG1VZ1EzSnZkV05vWldRaU9sc2lUMlptSWwwc0lrVnVZV0pzWlNCVGJHOTNJRmRoYkdzaU9sdG1ZV3h6WlYwc0lreGxablFnYjJabWMyVjBYRzVqZFhOMGIyMWZlV0YzWDJ4bFpuUmZRM0p2ZFdOb1pXUWlPbHN3WFN3aVhHNWpkWE4wYjIxZmVXRjNYekU0TUd4eVgyMXZaR1ZmUTNKdmRXTm9aV1FpT2xzaVUybGtaU0JpWVhObFpDSmRMQ0pHY21WbGMzUmhibVJwYm1jZ1ltOWtlU0I1WVhkY2JtTjFjM1J2YlY5bWNtVmxjM1JoYm1ScGJtZGZZbTlrZVY5NVlYZGZUVzkyYVc1bklqcGJabUZzYzJWZExDSmNibU4xYzNSdmJWOXdhWFJqYUY5dlptWnpaWFJmUm1GclpTQk1ZV2NpT2xzd1hTd2lRbTlrZVNCNVlYZGNibU4xYzNSdmJWOWliMlI1WDNsaGQxOU5ZV2x1SWpwYklrOW1aaUpkTENKTVpXWjBJRzltWm5ObGRGeHVZM1Z6ZEc5dFgzbGhkMTlzWldaMFgwMXZkbVVnUTNKdmRXTm9aV1FpT2xzd1hTd2lVbWxuYUhRZ2IyWm1jMlYwWEc1amRYTjBiMjFmZVdGM1gzSnBaMmgwWDAxdmRtVWdRM0p2ZFdOb1pXUWlPbHN3WFN3aVRHVm1kQ0J2Wm1aelpYUmNibU4xYzNSdmJWOTVZWGRmYkdWbWRGOUJhWElnUTNKdmRXTm9aV1FpT2xzd1hTd2lVR2wwWTJoY2JtTjFjM1J2YlY5d2FYUmphRjlOYjNabElFTnliM1ZqYUdWa0lqcGJJazltWmlKZExDSkxaWGxpYVc1a2N5STZXMlpoYkhObFhTd2lVbUZ1Wkc5dGFYcGhkR2x2Ymx4dVkzVnpkRzl0WDJwcGRIUmxjbDl5WVc1a2IyMXBlbUYwYVc5dVgwMWhhVzRpT2xzd1hTd2lSR1ZzWVhsY2JtTjFjM1J2YlY5RVpXeGhlVjlCYVhJaU9sczFYU3dpVFc5a1pTSTZXeUpFWldaaGRXeDBJbDBzSWtWdVlXSnNaU0JHWVd0bElFeGhaeUk2VzJaaGJITmxYU3dpUW05a2VTQjVZWGRjYm1OMWMzUnZiVjlpYjJSNVgzbGhkMTlOYjNacGJtY2lPbHNpVDJabUlsMHNJbGxoZDF4dVkzVnpkRzl0WDNsaGQxOU5ZV2x1SWpwYklrOW1aaUpkTENKR2NtVmxjM1JoYm1ScGJtY2dZbTlrZVNCNVlYZGNibU4xYzNSdmJWOW1jbVZsYzNSaGJtUnBibWRmWW05a2VWOTVZWGRmUVdseUlFTnliM1ZqYUdWa0lqcGJabUZzYzJWZExDSlNhV2RvZENCdlptWnpaWFJjYm1OMWMzUnZiVjk1WVhkZmNtbG5hSFJmUVdseUlFTnliM1ZqYUdWa0lqcGJNRjBzSWx4dVkzVnpkRzl0WDJwcGRIUmxjbDl0YjJSbFgwMXZkbVVnUTNKdmRXTm9aV1FpT2xzaU1pMVhZWGtpWFN3aVEzVnpkRzl0SUU1aGJXVWlPbHRtWVd4elpWMHNJa1p5WldWemRHRnVaR2x1WnlCaWIyUjVJSGxoZDF4dVkzVnpkRzl0WDJaeVpXVnpkR0Z1WkdsdVoxOWliMlI1WDNsaGQxOUdZV3RsSUV4aFp5STZXMlpoYkhObFhTd2lYRzVqZFhOMGIyMWZZbTlrZVY5NVlYZGZiMlptYzJWMFgwMXZkbWx1WnlJNld6QmRMQ0pjYm1OMWMzUnZiVjlxYVhSMFpYSmZiVzlrWlY5RGNtOTFZMmhsWkNJNld5SXlMVmRoZVNKZExDSkthWFIwWlhJZ2IyWm1jMlYwWEc1amRYTjBiMjFmYW1sMGRHVnlYMjltWm5ObGRGOU5ZV2x1SWpwYk1GMHNJa0p2WkhrZ2VXRjNYRzVqZFhOMGIyMWZZbTlrZVY5NVlYZGZSbUZyWlNCTVlXY2lPbHNpVDJabUlsMHNJbGxoZHlCcWFYUjBaWEpjYm1OMWMzUnZiVjk1WVhkZmFtbDBkR1Z5WDBaaGEyVWdUR0ZuSWpwYklrOW1aaUpkTENKU1lXNWtiMjFwZW1GMGFXOXVYRzVqZFhOMGIyMWZhbWwwZEdWeVgzSmhibVJ2YldsNllYUnBiMjVmUm1GclpTQk1ZV2NpT2xzd1hTd2lSbkpsWlhOMFlXNWthVzVuSUdKdlpIa2dlV0YzWEc1amRYTjBiMjFmWm5KbFpYTjBZVzVrYVc1blgySnZaSGxmZVdGM1gxTjBZVzVrYVc1bklqcGJabUZzYzJWZExDSkthWFIwWlhJZ2IyWm1jMlYwWEc1amRYTjBiMjFmYW1sMGRHVnlYMjltWm5ObGRGOU5iM1psSUVOeWIzVmphR1ZrSWpwYk1GMHNJa3BwZEhSbGNpQnZabVp6WlhSY2JtTjFjM1J2YlY5cWFYUjBaWEpmYjJabWMyVjBYMFpoYTJVZ1RHRm5JanBiTUYwc0lseHVZM1Z6ZEc5dFgycHBkSFJsY2w5dGIyUmxYMFpoYTJVZ1RHRm5JanBiSWpJdFYyRjVJbDBzSWxCcGRHTm9YRzVqZFhOMGIyMWZjR2wwWTJoZlJtRnJaU0JNWVdjaU9sc2lUMlptSWwwc0lrTnNhV1Z1ZEMxVGFXUmxJRTVwWTJ0dVlXMWxJanBiWm1Gc2MyVmRMQ0pjYm1OMWMzUnZiVjl3YVhSamFGOXZabVp6WlhSZlFXbHlJRU55YjNWamFHVmtJanBiTUYwc0lsSnBaMmgwSUc5bVpuTmxkRnh1WTNWemRHOXRYM2xoZDE5eWFXZG9kRjlHWVd0bElFeGhaeUk2V3pCZExDSlNZVzVrYjIxcGVtRjBhVzl1WEc1amRYTjBiMjFmYW1sMGRHVnlYM0poYm1SdmJXbDZZWFJwYjI1ZlEzSnZkV05vWldRaU9sc3dYU3dpUTNWemRHOXRJRk5qYjNCbElFOTJaWEpzWVhraU9sdG1ZV3h6WlYwc0lseHVZM1Z6ZEc5dFgycHBkSFJsY2w5dGIyUmxYMEZwY2lCRGNtOTFZMmhsWkNJNld5SXlMVmRoZVNKZExDSlpZWGRjYm1OMWMzUnZiVjk1WVhkZlJtRnJaU0JNWVdjaU9sc2lUMlptSWwwc0lsTmxZMjl1WkdGeWVTQjNaV0Z3YjI0aU9sc2lUbTl1WlNKZExDSkJjSEJzZVNJNmUzMHNJbHh1WTNWemRHOXRYM0JwZEdOb1gyOW1abk5sZEY5QmFYSWlPbHN3WFN3aVhHNWpkWE4wYjIxZlltOWtlVjk1WVhkZmIyWm1jMlYwWDBGcGNpQkRjbTkxWTJobFpDSTZXekJkTENKQ2IyUjVJSGxoZDF4dVkzVnpkRzl0WDJKdlpIbGZlV0YzWDBGcGNpQkRjbTkxWTJobFpDSTZXeUpQWm1ZaVhTd2lYRzVqZFhOMGIyMWZlV0YzWDI5bVpuTmxkRjlOWVdsdUlqcGJNRjBzSWx4dVkzVnpkRzl0WDNsaGQxOHhPREJzY2w5dGIyUmxYMU4wWVc1a2FXNW5JanBiSWxOcFpHVWdZbUZ6WldRaVhTd2lXV0YzSUdwcGRIUmxjbHh1WTNWemRHOXRYM2xoZDE5cWFYUjBaWEpmVFc5MlpTQkRjbTkxWTJobFpDSTZXeUpQWm1ZaVhTd2lXV0YzSUdwcGRIUmxjbHh1WTNWemRHOXRYM2xoZDE5cWFYUjBaWEpmUVdseUlFTnliM1ZqYUdWa0lqcGJJazltWmlKZExDSkNiMlI1SUhsaGQxeHVZM1Z6ZEc5dFgySnZaSGxmZVdGM1gwTnliM1ZqYUdWa0lqcGJJazltWmlKZExDSkdjbVZsYzNSaGJtUnBibWNnWW05a2VTQjVZWGRjYm1OMWMzUnZiVjltY21WbGMzUmhibVJwYm1kZlltOWtlVjk1WVhkZlFXbHlJanBiWm1Gc2MyVmRMQ0pjYm1OMWMzUnZiVjk1WVhkZmIyWm1jMlYwWDBGcGNpQkRjbTkxWTJobFpDSTZXekJkTENKQmJtbHRZWFJwYjI0Z1FuSmxZV3RsY25NaU9sdDBjblZsWFN3aUxTQkRiMnh2Y2x4dWQybGtaMlYwY3pvNlkyOXNiM0pmY0dsamEyVnlJanBiTVRFekxERTFNaXd5TlRVc01qVTFYU3dpU21sMGRHVnlJRzltWm5ObGRGeHVZM1Z6ZEc5dFgycHBkSFJsY2w5dlptWnpaWFJmUTNKdmRXTm9aV1FpT2xzd1hTd2lYRzVqZFhOMGIyMWZlV0YzWDI5bVpuTmxkRjlOYjNabElFTnliM1ZqYUdWa0lqcGJNRjBzSWxsaGQxeHVZM1Z6ZEc5dFgzbGhkMTlCYVhJZ1EzSnZkV05vWldRaU9sc2lUMlptSWwwc0lsbGhkeUJpWVhObFhHNWpkWE4wYjIxZmVXRjNYMkpoYzJWZlRXOTJaU0JEY205MVkyaGxaQ0k2V3lKTWIyTmhiQ0IyYVdWM0lsMHNJbGxoZHlCaVlYTmxYRzVqZFhOMGIyMWZlV0YzWDJKaGMyVmZRV2x5SWpwYklreHZZMkZzSUhacFpYY2lYU3dpWEc1amRYTjBiMjFmYW1sMGRHVnlYMjF2WkdWZlUzUmhibVJwYm1jaU9sc2lNaTFYWVhraVhTd2lVbUZ1Wkc5dGFYcGhkR2x2Ymx4dVkzVnpkRzl0WDJwcGRIUmxjbDl5WVc1a2IyMXBlbUYwYVc5dVgwMXZkbWx1WnlJNld6QmRMQ0pTYVdkb2RDQnZabVp6WlhSY2JtTjFjM1J2YlY5NVlYZGZjbWxuYUhSZlFXbHlJanBiTUYwc0lsQnBkR05vWEc1amRYTjBiMjFmY0dsMFkyaGZRV2x5SUVOeWIzVmphR1ZrSWpwYklrOW1aaUpkTENKS2FYUjBaWElnYjJabWMyVjBYRzVqZFhOMGIyMWZhbWwwZEdWeVgyOW1abk5sZEY5VGRHRnVaR2x1WnlJNld6QmRMQ0pjYm1OMWMzUnZiVjk1WVhkZk1UZ3diSEpmYlc5a1pWOU5iM1psSUVOeWIzVmphR1ZrSWpwYklsTnBaR1VnWW1GelpXUWlYU3dpTFNCVGRHRjBaWE5jYm5OaFptVmZhR1ZoWkRvNmMzUmhkR1Z6SWpwYld5SkJhWElnUzI1cFptVWlMQ0pUZEdGdVpHbHVaeUlzSWtOeWIzVmphR1ZrSWwxZExDSkZibUZpYkdVZ1FXbHlJRU55YjNWamFHVmtJanBiWm1Gc2MyVmRMQ0pFWldabGJuTnBkbVVnUVVFaU9sdDBjblZsWFN3aVJXNWhZbXhsSUVOeWIzVmphR1ZrSWpwYlptRnNjMlZkTENKY2JtTjFjM1J2YlY5NVlYZGZNVGd3YkhKZmJXOWtaVjlCYVhJZ1EzSnZkV05vWldRaU9sc2lVMmxrWlNCaVlYTmxaQ0pkTENKY2JtTjFjM1J2YlY5NVlYZGZNVGd3YkhKZmJXOWtaVjlCYVhJaU9sc2lVMmxrWlNCaVlYTmxaQ0pkTENKWllYZGNibU4xYzNSdmJWOTVZWGRmUVdseUlqcGJJazltWmlKZExDSlNZVzVrYjIxcGVtRjBhVzl1WEc1amRYTjBiMjFmYW1sMGRHVnlYM0poYm1SdmJXbDZZWFJwYjI1ZlFXbHlJanBiTUYwc0lsQnlhVzFoY25rZ2QyVmhjRzl1SWpwYklrNXZibVVpWFN3aVdXRjNJR0poYzJWY2JtTjFjM1J2YlY5NVlYZGZZbUZ6WlY5QmFYSWdRM0p2ZFdOb1pXUWlPbHNpVEc5allXd2dkbWxsZHlKZExDSlpZWGNnWW1GelpWeHVZM1Z6ZEc5dFgzbGhkMTlpWVhObFgxTnNiM2NnVjJGc2F5STZXeUpNYjJOaGJDQjJhV1YzSWwwc0lpMGdXV0YzWEc1a1pXWmxibk5wZG1VNk9ubGhkeUk2V3lJMUxWZGhlU0pkTENKTVpXWjBJRzltWm5ObGRGeHVZM1Z6ZEc5dFgzbGhkMTlzWldaMFgwRnBjaUk2V3pCZExDSmNibU4xYzNSdmJWOWliMlI1WDNsaGQxOXZabVp6WlhSZlRXOTJaU0JEY205MVkyaGxaQ0k2V3pCZExDSmNibU4xYzNSdmJWOWliMlI1WDNsaGQxOXZabVp6WlhSZlFXbHlJanBiTUYwc0lrVnVZV0pzWlNCQmFYSWlPbHRtWVd4elpWMHNJaTBnVFc5a1pWeHVaR1ZtWlc1emFYWmxPanB0YjJSbElqcGJXeUpQYmlCVGFHOTBJRUZ1ZEdrZ1FXbHRJaXdpUkc5MVlteGxJRlJoY0NKZFhTd2lYRzVqZFhOMGIyMWZjR2wwWTJoZmIyWm1jMlYwWDAxaGFXNGlPbHN3WFN3aVJuSmxaWE4wWVc1a2FXNW5JR0p2WkhrZ2VXRjNYRzVqZFhOMGIyMWZabkpsWlhOMFlXNWthVzVuWDJKdlpIbGZlV0YzWDAxdmRtVWdRM0p2ZFdOb1pXUWlPbHRtWVd4elpWMHNJbHh1WTNWemRHOXRYM0JwZEdOb1gyOW1abk5sZEY5VGJHOTNJRmRoYkdzaU9sc3dYU3dpVW1GdVpHOXRhWHBoZEdsdmJseHVZM1Z6ZEc5dFgycHBkSFJsY2w5eVlXNWtiMjFwZW1GMGFXOXVYMDF2ZG1VZ1EzSnZkV05vWldRaU9sc3dYU3dpTFNCR2RXNWpkR2x2Ym5OY2JuTmxkSFJwYm1kek9qcDBkMlZoYTNNaU9sdGJJa3h2WnlCQmFXMWliM1FnVTJodmRITWlMQ0pVY21GemFIUmhiR3NpTENKVmJtMTFkR1VnVTJsc1pXNWpaV1FnVUd4aGVXVnljeUlzSWtOdmJuTnZiR1VnUm1sc2RHVnlJaXdpUkdGdFlXZGxJRTFoY210bGNpSmRYU3dpUkdWc1lYbGNibU4xYzNSdmJWOUVaV3hoZVY5R1lXdGxJRXhoWnlJNld6VmRMQ0l0SUU5d2RHbHZibk5jYm0xaGJuVmhiRjlrYVhKbFkzUnBiMjQ2T205d2RHbHZibk1pT2x0YklrUnBjMkZpYkdVZ1dXRjNJRTF2WkdsbWFXVnljeUlzSWtaeVpXVnpkR0Z1WkdsdVp5QkNiMlI1SUZsaGR5SXNJa1IxWTJzZ1JYaHdiRzlwZENKZFhTd2lSR1ZzWVhsY2JtTjFjM1J2YlY5RVpXeGhlVjlOYjNabElFTnliM1ZqYUdWa0lqcGJOVjBzSWtSbGJHRjVYRzVqZFhOMGIyMWZSR1ZzWVhsZlUyeHZkeUJYWVd4cklqcGJOVjBzSWxsaGR5QmlZWE5sWEc1amRYTjBiMjFmZVdGM1gySmhjMlZmVTNSaGJtUnBibWNpT2xzaVRHOWpZV3dnZG1sbGR5SmRMQ0pDZFhrZ1FtOTBJanBiWm1Gc2MyVmRMQ0pGYm1GaWJHVWdUVzkyYVc1bklqcGJabUZzYzJWZExDSk1aV1owSUc5bVpuTmxkRnh1WTNWemRHOXRYM2xoZDE5c1pXWjBYMDF2ZG1sdVp5STZXekJkTENKU2FXZG9kQ0J2Wm1aelpYUmNibU4xYzNSdmJWOTVZWGRmY21sbmFIUmZUV0ZwYmlJNld6QmRMQ0pjYm1OMWMzUnZiVjlpYjJSNVgzbGhkMTl2Wm1aelpYUmZVMnh2ZHlCWFlXeHJJanBiTUYwc0lrUmxiR0Y1WEc1amRYTjBiMjFmUkdWc1lYbGZVM1JoYm1ScGJtY2lPbHMxWFN3aVhHNVBabVp6WlhRaU9sc3hNRjBzSWxsaGR5QnFhWFIwWlhKY2JtTjFjM1J2YlY5NVlYZGZhbWwwZEdWeVgwMWhhVzRpT2xzaVQyWm1JbDBzSWtSbGJHRjVYRzVqZFhOMGIyMWZSR1ZzWVhsZlRXRnBiaUk2V3pWZExDSlpZWGNnWW1GelpWeHVZM1Z6ZEc5dFgzbGhkMTlpWVhObFgwMXZkbWx1WnlJNld5Sk1iMk5oYkNCMmFXVjNJbDBzSWtWdVlXSnNaU0JUZEdGdVpHbHVaeUk2VzJaaGJITmxYU3dpVW1sbmFIUWdiMlptYzJWMFhHNWpkWE4wYjIxZmVXRjNYM0pwWjJoMFgxTnNiM2NnVjJGc2F5STZXekJkTENKTllXNTFZV3dnUVhKeWIzZHpJanBiZEhKMVpWMHNJa0Z1ZEdrZ1FXbHRJRUoxYVd4a1pYSWlPbHNpVW1WamIyMXRaVzVrWldRaVhTd2lYRzVqZFhOMGIyMWZlV0YzWHpFNE1HeHlYMjF2WkdWZlUyeHZkeUJYWVd4cklqcGJJbE5wWkdVZ1ltRnpaV1FpWFN3aVVHbDBZMmhjYm1OMWMzUnZiVjl3YVhSamFGOURjbTkxWTJobFpDSTZXeUpQWm1ZaVhTd2lVbWxuYUhRZ2IyWm1jMlYwWEc1amRYTjBiMjFmZVdGM1gzSnBaMmgwWDAxdmRtbHVaeUk2V3pCZExDSlpZWGNnYW1sMGRHVnlYRzVqZFhOMGIyMWZlV0YzWDJwcGRIUmxjbDlOYjNacGJtY2lPbHNpVDJabUlsMHNJazVwWTJ0dVlXMWxJanBiSWlKZExDSlpZWGNnYW1sMGRHVnlYRzVqZFhOMGIyMWZlV0YzWDJwcGRIUmxjbDlEY205MVkyaGxaQ0k2V3lKUFptWWlYU3dpU21sMGRHVnlJRzltWm5ObGRGeHVZM1Z6ZEc5dFgycHBkSFJsY2w5dlptWnpaWFJmVFc5MmFXNW5JanBiTUYwc0lsQnBkR05vWEc1amRYTjBiMjFmY0dsMFkyaGZUV0ZwYmlJNld5SlBabVlpWFN3aVhHNWpkWE4wYjIxZmVXRjNYekU0TUd4eVgyMXZaR1ZmVFc5MmFXNW5JanBiSWxOcFpHVWdZbUZ6WldRaVhTd2lYRzVqZFhOMGIyMWZlV0YzWDI5bVpuTmxkRjlHWVd0bElFeGhaeUk2V3pCZExDSXRJRVJwYzNCc1lYbGNibmRwWkdkbGRITTZPbVJwYzNCc1lYa2lPbHRiSWxWelpYSnVZVzFsSWl3aVRHRjBaVzVqZVNJc0lsUnBiV1VpTENKR1VGTWlMQ0pUWlhKMlpYSWdabkpoYldWMGFXMWxJbDFkTENKR2NtVmxjM1JoYm1ScGJtY2dZbTlrZVNCNVlYZGNibU4xYzNSdmJWOW1jbVZsYzNSaGJtUnBibWRmWW05a2VWOTVZWGRmVFdGcGJpSTZXMlpoYkhObFhTd2lVbUZ1Wkc5dGFYcGhkR2x2Ymx4dVkzVnpkRzl0WDJwcGRIUmxjbDl5WVc1a2IyMXBlbUYwYVc5dVgxTnNiM2NnVjJGc2F5STZXekJkTENKY2JtTjFjM1J2YlY5d2FYUmphRjl2Wm1aelpYUmZUVzkyYVc1bklqcGJNRjBzSWt4bFpuUWdiMlptYzJWMFhHNWpkWE4wYjIxZmVXRjNYMnhsWm5SZlRXRnBiaUk2V3pCZExDSXRJRXhsWnlCTmIzWmxiV1Z1ZENJNld5SlRkR0YwYVdNaVhTd2lYRzVqZFhOMGIyMWZZbTlrZVY5NVlYZGZiMlptYzJWMFgxTjBZVzVrYVc1bklqcGJNRjBzSWtwcGRIUmxjaUJ2Wm1aelpYUmNibU4xYzNSdmJWOXFhWFIwWlhKZmIyWm1jMlYwWDBGcGNpSTZXekJkTENKY2JtTjFjM1J2YlY5aWIyUjVYM2xoZDE5dlptWnpaWFJmVFdGcGJpSTZXekJkTENKQ2IyUjVJSGxoZDF4dVkzVnpkRzl0WDJKdlpIbGZlV0YzWDAxdmRtVWdRM0p2ZFdOb1pXUWlPbHNpVDJabUlsMHNJa1psWVhSMWNtVnpJanBiZEhKMVpWMHNJbGxoZDF4dVkzVnpkRzl0WDNsaGQxOURjbTkxWTJobFpDSTZXeUpQWm1ZaVhTd2lYRzVqZFhOMGIyMWZjR2wwWTJoZmIyWm1jMlYwWDFOMFlXNWthVzVuSWpwYk1GMHNJbHh1WTNWemRHOXRYMnBwZEhSbGNsOXRiMlJsWDAxaGFXNGlPbHNpTWkxWFlYa2lYU3dpWEc1amRYTjBiMjFmYW1sMGRHVnlYMjF2WkdWZlRXOTJhVzVuSWpwYklqSXRWMkY1SWwwc0lrcHBkSFJsY2lCdlptWnpaWFJjYm1OMWMzUnZiVjlxYVhSMFpYSmZiMlptYzJWMFgxTnNiM2NnVjJGc2F5STZXekJkTENKY2RUQXdNRGRpTm1JMk5qVm1aa0ZqYVdSVVpXTm9JanBiZEhKMVpWMHNJbGxoZHlCcWFYUjBaWEpjYm1OMWMzUnZiVjk1WVhkZmFtbDBkR1Z5WDFOc2IzY2dWMkZzYXlJNld5SlBabVlpWFN3aVhHNWpkWE4wYjIxZmVXRjNYMjltWm5ObGRGOURjbTkxWTJobFpDSTZXekJkTENKY2JtTjFjM1J2YlY5d2FYUmphRjl2Wm1aelpYUmZRM0p2ZFdOb1pXUWlPbHN3WFN3aUxTQkpiaUJCYVhJaU9sc2lVM1JoZEdsaklsMHNJbEJwZEdOb1hHNWpkWE4wYjIxZmNHbDBZMmhmVTJ4dmR5QlhZV3hySWpwYklrOW1aaUpkTENKR2NtVmxjM1JoYm1ScGJtY2dZbTlrZVNCNVlYZGNibU4xYzNSdmJWOW1jbVZsYzNSaGJtUnBibWRmWW05a2VWOTVZWGRmUTNKdmRXTm9aV1FpT2x0bVlXeHpaVjBzSWtWdVlXSnNaU0JOYjNabElFTnliM1ZqYUdWa0lqcGJabUZzYzJWZGZRPT1fYWNpZCcKICAgICAgICAgICAgKQogICAgICAgIGVuZCk6Y29uZmlnX2lnbm9yZSgpCgogICAgICAgIGZ1bmN0aW9uIGdyYXBoaWNzLnRleHQoeCwgeSwgciwgZywgYiwgYSwgZmxhZ3MsIG1heF93aWR0aCwgLi4uKQogICAgICAgICAgICBsb2NhbCB0ZXh0ID0gc3RyaW5nX2FscGhhX21vZChtZXJnZSB7Li4ufSwgYSAqIGFscGhhX3VuaXQpCiAgICAgICAgICAgIHJlbmRlcmVyLnRleHQoeCwgeSwgciwgZywgYiwgYSwgZmxhZ3MsIG1heF93aWR0aCwgdGV4dCkKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gZ3JhcGhpY3MucmVjdGFuZ2xlKHgsIHksIHcsIGgsIHIsIGcsIGIsIGEsIHJhZGl1cykKICAgICAgICAgICAgaWYgcmFkaXVzIH49IG5pbCBhbmQgcmFkaXVzID4gMSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBvZmZzZXQgPSByYWRpdXMgKiAyCgogICAgICAgICAgICAgICAgcmVuZGVyZXIucmVjdGFuZ2xlKHggKyByYWRpdXMsIHksIHcgLSBvZmZzZXQsIGgsIHIsIGcsIGIsIGEpCgogICAgICAgICAgICAgICAgcmVuZGVyZXIucmVjdGFuZ2xlKHgsIHkgKyByYWRpdXMsIHJhZGl1cywgaCAtIG9mZnNldCwgciwgZywgYiwgYSkKICAgICAgICAgICAgICAgIHJlbmRlcmVyLnJlY3RhbmdsZSh4ICsgdywgeSArIHJhZGl1cywgLXJhZGl1cywgaCAtIG9mZnNldCwgciwgZywgYiwgYSkKCiAgICAgICAgICAgICAgICByZW5kZXJlci5jaXJjbGUoeCArIHJhZGl1cywgeSArIHJhZGl1cywgciwgZywgYiwgYSwgcmFkaXVzLCAxODAsIDAuMjUpCiAgICAgICAgICAgICAgICByZW5kZXJlci5jaXJjbGUoeCArIHJhZGl1cywgeSArIGggLSByYWRpdXMsIHIsIGcsIGIsIGEsIHJhZGl1cywgMjcwLCAwLjI1KQogICAgICAgICAgICAgICAgcmVuZGVyZXIuY2lyY2xlKHggKyB3IC0gcmFkaXVzLCB5ICsgaCAtIHJhZGl1cywgciwgZywgYiwgYSwgcmFkaXVzLCAwLCAwLjI1KQogICAgICAgICAgICAgICAgcmVuZGVyZXIuY2lyY2xlKHggKyB3IC0gcmFkaXVzLCB5ICsgcmFkaXVzLCByLCBnLCBiLCBhLCByYWRpdXMsIDkwLCAwLjI1KQoKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJlbmRlcmVyLnJlY3RhbmdsZSh4LCB5LCB3LCBoLCByLCBnLCBiLCBhKQogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBncmFwaGljcy5yZWN0YW5nbGVfb3V0bGluZSh4LCB5LCB3LCBoLCByLCBnLCBiLCBhLCByYWRpdXMsIHRoaWNrbmVzcykKICAgICAgICAgICAgcmFkaXVzID0gcmFkaXVzIG9yIDAKICAgICAgICAgICAgdGhpY2tuZXNzID0gdGhpY2tuZXNzIG9yIDEKCiAgICAgICAgICAgIHJlbmRlcmVyLnJlY3RhbmdsZSh4ICsgcmFkaXVzLCB5LCB3IC0gcmFkaXVzICogMiwgdGhpY2tuZXNzLCByLCBnLCBiLCBhKQogICAgICAgICAgICByZW5kZXJlci5yZWN0YW5nbGUoeCArIHJhZGl1cywgeSArIGggLSB0aGlja25lc3MsIHcgLSByYWRpdXMgKiAyLCB0aGlja25lc3MsIHIsIGcsIGIsIGEpCgogICAgICAgICAgICByZW5kZXJlci5yZWN0YW5nbGUoeCwgeSArIHJhZGl1cywgdGhpY2tuZXNzLCBoIC0gcmFkaXVzICogMiwgciwgZywgYiwgYSkKICAgICAgICAgICAgcmVuZGVyZXIucmVjdGFuZ2xlKHggKyB3IC0gdGhpY2tuZXNzLCB5ICsgcmFkaXVzLCB0aGlja25lc3MsIGggLSByYWRpdXMgKiAyLCByLCBnLCBiLCBhKQoKICAgICAgICAgICAgcmVuZGVyZXIuY2lyY2xlX291dGxpbmUoeCArIHJhZGl1cywgeSArIHJhZGl1cywgciwgZywgYiwgYSwgcmFkaXVzLCAxODAsIDAuMjUsIHRoaWNrbmVzcykKICAgICAgICAgICAgcmVuZGVyZXIuY2lyY2xlX291dGxpbmUoeCArIHJhZGl1cywgeSArIGggLSByYWRpdXMsIHIsIGcsIGIsIGEsIHJhZGl1cywgOTAsIDAuMjUsIHRoaWNrbmVzcykKICAgICAgICAgICAgcmVuZGVyZXIuY2lyY2xlX291dGxpbmUoeCArIHcgLSByYWRpdXMsIHkgKyBoIC0gcmFkaXVzLCByLCBnLCBiLCBhLCByYWRpdXMsIDAsIDAuMjUsIHRoaWNrbmVzcykKICAgICAgICAgICAgcmVuZGVyZXIuY2lyY2xlX291dGxpbmUoeCArIHcgLSByYWRpdXMsIHkgKyByYWRpdXMsIHIsIGcsIGIsIGEsIHJhZGl1cywgMjcwLCAwLjI1LCB0aGlja25lc3MpCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIGdyYXBoaWNzLmJsdXIoeCwgeSwgdywgaCkKICAgICAgICAgICAgLS0gaWYgdHJ1ZSB0aGVuCiAgICAgICAgICAgIC0tICAgICByZXR1cm4KICAgICAgICAgICAgLS0gZW5kCgogICAgICAgICAgICAtLSByZW5kZXJlci5ibHVyKHgsIHksIHcsIGgpCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIGdyYXBoaWNzLmhlYWRlcih4LCB5LCB3LCB0aGlja25lc3MsIHJvdW5kaW5nLCByLCBnLCBiLCBhKQogICAgICAgICAgICByZW5kZXJlci5yZWN0YW5nbGUoeCArIHJvdW5kaW5nLCB5IC0gdGhpY2tuZXNzLCB3IC0gKHJvdW5kaW5nICsgdGhpY2tuZXNzKSwgdGhpY2tuZXNzLCByLCBnLCBiLCBhKQoKICAgICAgICAgICAgaWYgcm91bmRpbmcgfj0gMCB0aGVuCiAgICAgICAgICAgICAgICAtLSBvdXRlciByb3VuZGluZwogICAgICAgICAgICAgICAgbG9jYWwgYWRkX3JvdW5kaW5nID0gdmVjdG9yKHJvdW5kaW5nLCByb3VuZGluZykKICAgICAgICAgICAgICAgIHJlbmRlcmVyLmNpcmNsZV9vdXRsaW5lKHggKyByb3VuZGluZywgeSArIHJvdW5kaW5nLCByLCBnLCBiLCBhLCByb3VuZGluZyArIHRoaWNrbmVzcywgLTE4MCwgMC4yNSwgdGhpY2tuZXNzKQogICAgICAgICAgICAgICAgcmVuZGVyZXIuY2lyY2xlX291dGxpbmUoeCArIHcgLSByb3VuZGluZywgeSArIHJvdW5kaW5nLCByLCBnLCBiLCBhLCByb3VuZGluZyArIHRoaWNrbmVzcywgLTkwLCAwLjI1LCB0aGlja25lc3MpCgogICAgICAgICAgICAgICAgLS0gZ3JhZGllbnQgbGluZXMKICAgICAgICAgICAgICAgIGxvY2FsIHRoaWNrbmVzc19kdiA9IHRoaWNrbmVzcyAvIDIgLSAxCiAgICAgICAgICAgICAgICByZW5kZXJlci5ncmFkaWVudCh4IC0gdGhpY2tuZXNzLCB5ICsgcm91bmRpbmcsIHRoaWNrbmVzcywgcm91bmRpbmcgKyA3LCByLCBnLCBiLCBhLCByLCBnLCBiLCAwLCBmYWxzZSkKICAgICAgICAgICAgICAgIHJlbmRlcmVyLmdyYWRpZW50KHggKyB3LCB5ICsgcm91bmRpbmcsIHRoaWNrbmVzcywgcm91bmRpbmcgKyA3LCByLCBnLCBiLCBhLCByLCBnLCBiLCAwLCBmYWxzZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIGdyYXBoaWNzLmdsb3coeCwgeSwgdywgaCwgciwgZywgYiwgYSwgdGhpY2tuZXNzLCByYWRpdXMpCiAgICAgICAgICAgIC0tIGlmIGdyYXBoaWNzLmxvd19mcHNfbWl0aWdhdGlvbnM6aGF2ZV9rZXkoIkdsb3ciKSB0aGVuCiAgICAgICAgICAgIC0tIGlmIHRydWUgdGhlbgogICAgICAgICAgICAtLSAgICAgcmV0dXJuCiAgICAgICAgICAgIC0tIGVuZAoKICAgICAgICAgICAgLS0gaWYgcmFkaXVzID09IG5pbCB0aGVuCiAgICAgICAgICAgIC0tICAgICByZXR1cm4KICAgICAgICAgICAgLS0gZW5kCgogICAgICAgICAgICAtLSBpZiByYWRpdXMgPCAxIHRoZW4KICAgICAgICAgICAgLS0gICAgIHJhZGl1cyA9IDEKICAgICAgICAgICAgLS0gZW5kCgogICAgICAgICAgICAtLSB0aGlja25lc3MgPSB0aGlja25lc3MgLyAyCgogICAgICAgICAgICAtLSBsb2NhbCB0ID0gMS4wCiAgICAgICAgICAgIC0tIGxvY2FsIHN0ZXAgPSAxIC8gKHRoaWNrbmVzcyAtIDEpCgogICAgICAgICAgICAtLSBsb2NhbCBvZmZzZXQgPSByYWRpdXMgKiAyCgogICAgICAgICAgICAtLSByZW5kZXJlci5ncmFkaWVudCh4ICsgcmFkaXVzLCB5LCB3IC0gb2Zmc2V0LCAtdGhpY2tuZXNzLCByLCBnLCBiLCBhLCByLCBnLCBiLCAwLCBmYWxzZSkKICAgICAgICAgICAgLS0gcmVuZGVyZXIuZ3JhZGllbnQoeCArIHJhZGl1cywgeSArIGgsIHcgLSBvZmZzZXQsIHRoaWNrbmVzcywgciwgZywgYiwgYSwgciwgZywgYiwgMCwgZmFsc2UpCiAgICAgICAgICAgIC0tIHJlbmRlcmVyLmdyYWRpZW50KHgsIHkgKyByYWRpdXMsIC10aGlja25lc3MsIGggLSBvZmZzZXQsIHIsIGcsIGIsIGEsIHIsIGcsIGIsIDAsIHRydWUpCiAgICAgICAgICAgIC0tIHJlbmRlcmVyLmdyYWRpZW50KHggKyB3LCB5ICsgcmFkaXVzLCB0aGlja25lc3MsIGggLSBvZmZzZXQsIHIsIGcsIGIsIGEsIHIsIGcsIGIsIDAsIHRydWUpCgogICAgICAgICAgICAtLSBmb3IgaSA9IDEsIHRoaWNrbmVzcyBkbwogICAgICAgICAgICAtLSAgICAgbG9jYWwgb3BhY2l0eSA9IGEgKiB0CgogICAgICAgICAgICAtLSAgICAgcmVuZGVyZXIuY2lyY2xlX291dGxpbmUoeCArIHcgLSByYWRpdXMsIHkgKyBoIC0gcmFkaXVzLCByLCBnLCBiLCBvcGFjaXR5LCByYWRpdXMgKyBpLCAwLCAwLjI1LCAxKQogICAgICAgICAgICAtLSAgICAgcmVuZGVyZXIuY2lyY2xlX291dGxpbmUoeCArIHJhZGl1cywgeSArIGggLSByYWRpdXMsIHIsIGcsIGIsIG9wYWNpdHksIHJhZGl1cyArIGksIDkwLCAwLjI1LCAxKQogICAgICAgICAgICAtLSAgICAgcmVuZGVyZXIuY2lyY2xlX291dGxpbmUoeCArIHJhZGl1cywgeSArIHJhZGl1cywgciwgZywgYiwgb3BhY2l0eSwgcmFkaXVzICsgaSwgMTgwLCAwLjI1LCAxKQogICAgICAgICAgICAtLSAgICAgcmVuZGVyZXIuY2lyY2xlX291dGxpbmUoeCArIHcgLSByYWRpdXMsIHkgKyByYWRpdXMsIHIsIGcsIGIsIG9wYWNpdHksIHJhZGl1cyArIGksIDI3MCwgMC4yNSwgMSkKCiAgICAgICAgICAgIC0tICAgICB0ID0gdCAtIHN0ZXAKICAgICAgICAgICAgLS0gZW5kCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICAtLS0gcmVnaW9uIGRlY29yYXRpb25zCiAgICBkbwogICAgICAgIGxvY2FsIGZ1bmN0aW9uIHU4KHMpCiAgICAgICAgICAgIHJldHVybiBzdHJpbmcuZ3N1YihzLCAiW1wxMjgtXDE5MV0iLCAiIikKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gZGVjb3JhdGlvbnMud2F2ZShzLCBjbG9jaywgcjEsIGcxLCBiMSwgYTEsIHIyLCBnMiwgYjIsIGEyKQogICAgICAgICAgICBsb2NhbCBidWZmZXIgPSB7IH0KCiAgICAgICAgICAgIGxvY2FsIGxlbiA9ICN1OChzKQogICAgICAgICAgICBsb2NhbCBkaXYgPSAxIC8gKGxlbiAtIDEpCgogICAgICAgICAgICBsb2NhbCBhZGRfciA9IHIyIC0gcjEKICAgICAgICAgICAgbG9jYWwgYWRkX2cgPSBnMiAtIGcxCiAgICAgICAgICAgIGxvY2FsIGFkZF9iID0gYjIgLSBiMQogICAgICAgICAgICBsb2NhbCBhZGRfYSA9IGEyIC0gYTEKCiAgICAgICAgICAgIGZvciBjaGFyIGluIHN0cmluZy5nbWF0Y2gocywgIi5bXDEyOC1cMTkxXSoiKSBkbwogICAgICAgICAgICAgICAgbG9jYWwgdCA9IHV0aWxzLmJyZWF0aGUoY2xvY2spCgogICAgICAgICAgICAgICAgbG9jYWwgciA9IHIxICsgYWRkX3IgKiB0CiAgICAgICAgICAgICAgICBsb2NhbCBnID0gZzEgKyBhZGRfZyAqIHQKICAgICAgICAgICAgICAgIGxvY2FsIGIgPSBiMSArIGFkZF9iICogdAogICAgICAgICAgICAgICAgbG9jYWwgYSA9IGExICsgYWRkX2EgKiB0CgogICAgICAgICAgICAgICAgYnVmZmVyWyNidWZmZXIgKyAxXSA9ICJcYSIKICAgICAgICAgICAgICAgIGJ1ZmZlclsjYnVmZmVyICsgMV0gPSB1dGlscy50b19oZXgociwgZywgYiwgYSkKICAgICAgICAgICAgICAgIGJ1ZmZlclsjYnVmZmVyICsgMV0gPSBjaGFyCgogICAgICAgICAgICAgICAgY2xvY2sgPSBjbG9jayArIGRpdgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiBtZXJnZShidWZmZXIpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICAtLS0gcmVnaW9uIGV4cGxvaXQKICAgIGRvCiAgICAgICAgbG9jYWwgTEFHX0NPTVBFTlNBVElPTl9URUxFUE9SVEVEX0RJU1RBTkNFX1NRUiA9IDY0ICogNjQKCiAgICAgICAgbG9jYWwgZGF0YSA9IHsKICAgICAgICAgICAgb2xkX29yaWdpbiA9IHZlY3RvcigpLAogICAgICAgICAgICBvbGRfc2ltdGltZSA9IDAuMCwKCiAgICAgICAgICAgIHNoaWZ0ID0gZmFsc2UsCiAgICAgICAgICAgIGJyZWFraW5nX2xjID0gZmFsc2UsCgogICAgICAgICAgICBkZWZlbnNpdmUgPSB7CiAgICAgICAgICAgICAgICBiZWdpbiA9IDAsCiAgICAgICAgICAgICAgICBkdXJhdGlvbiA9IDAKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGxhZ2NvbXBlbnNhdGlvbiA9IHsKICAgICAgICAgICAgICAgIGRpc3RhbmNlID0gMC4wLAogICAgICAgICAgICAgICAgdGVsZXBvcnQgPSBmYWxzZQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgZGVmZW5zaXZlX3RrID0gMAogICAgICAgIH0KCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gdXBkYXRlX3RpY2tiYXNlKG1lKQogICAgICAgICAgICBsb2NhbCB0aWNrY291bnQgPSBnbG9iYWxzLnRpY2tjb3VudCgpCiAgICAgICAgICAgIGxvY2FsIG1fblRpY2tCYXNlID0gZW50aXR5LmdldF9wcm9wKG1lLCAibV9uVGlja0Jhc2UiKQoKICAgICAgICAgICAgZGF0YS5zaGlmdCA9IHRpY2tjb3VudCA+IG1fblRpY2tCYXNlCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIGZ1bmN0aW9uIHVwZGF0ZV9kZWZlbnNpdmUodGljaykKICAgICAgICAgICAgZGF0YS5icmVha2luZ19sYyA9IHRydWUKCiAgICAgICAgICAgIGRhdGEuZGVmZW5zaXZlLmJlZ2luID0gZ2xvYmFscy50aWNrY291bnQoKQogICAgICAgICAgICBkYXRhLmRlZmVuc2l2ZS5kdXJhdGlvbiA9IHRpY2sKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gdXBkYXRlX3RlbGVwb3J0KG9sZF9vcmlnaW4sIG5ld19vcmlnaW4pCiAgICAgICAgICAgIGxvY2FsIGRlbHRhID0gbmV3X29yaWdpbiAtIG9sZF9vcmlnaW4KICAgICAgICAgICAgbG9jYWwgZGlzdGFuY2UgPSBkZWx0YTpsZW5ndGhzcXIoKQoKICAgICAgICAgICAgbG9jYWwgaXNfdGVsZXBvcnQgPSBkaXN0YW5jZSA+IExBR19DT01QRU5TQVRJT05fVEVMRVBPUlRFRF9ESVNUQU5DRV9TUVIKCiAgICAgICAgICAgIGRhdGEuYnJlYWtpbmdfbGMgPSBpc190ZWxlcG9ydAoKICAgICAgICAgICAgZGF0YS5sYWdjb21wZW5zYXRpb24uZGlzdGFuY2UgPSBkaXN0YW5jZQogICAgICAgICAgICBkYXRhLmxhZ2NvbXBlbnNhdGlvbi50ZWxlcG9ydCA9IGlzX3RlbGVwb3J0CiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIGZ1bmN0aW9uIHVwZGF0ZV9sYWdjb21wZW5zYXRpb24obWUpCiAgICAgICAgICAgIGxvY2FsIG9sZF9vcmlnaW4gPSBkYXRhLm9sZF9vcmlnaW4KICAgICAgICAgICAgbG9jYWwgb2xkX3NpbXRpbWUgPSBkYXRhLm9sZF9zaW10aW1lCgogICAgICAgICAgICBsb2NhbCBvcmlnaW4gPSB2ZWN0b3IoZW50aXR5LmdldF9vcmlnaW4obWUpKQogICAgICAgICAgICBsb2NhbCBzaW10aW1lID0gdG90aWNrcyhlbnRpdHkuZ2V0X3Byb3AobWUsICJtX2ZsU2ltdWxhdGlvblRpbWUiKSkKCiAgICAgICAgICAgIGlmIG9sZF9zaW10aW1lIH49IG5pbCB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBkZWx0YSA9IHNpbXRpbWUgLSBvbGRfc2ltdGltZQoKICAgICAgICAgICAgICAgIGlmIGRlbHRhIDwgMCBvciBkZWx0YSA+IDAgYW5kIGRlbHRhIDw9IDY0IHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCB0aWNrID0gZGVsdGEgLSAxCgogICAgICAgICAgICAgICAgICAgIHVwZGF0ZV90ZWxlcG9ydChvbGRfb3JpZ2luLCBvcmlnaW4pCgogICAgICAgICAgICAgICAgICAgIGlmIGRlbHRhIDwgMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZV9kZWZlbnNpdmUobWF0aC5hYnModGljaykpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBkYXRhLm9sZF9vcmlnaW4gPSBvcmlnaW4KICAgICAgICAgICAgZGF0YS5vbGRfc2ltdGltZSA9IHNpbXRpbWUKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gZXhwbG9pdC5nZXQoKQogICAgICAgICAgICByZXR1cm4gZGF0YQogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBleHBsb2l0LnNldHVwX2NvbW1hbmQoY21kKQogICAgICAgICAgICBsb2NhbCBtZSA9IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkKICAgICAgICAgICAgdXBkYXRlX3RpY2tiYXNlKG1lKQogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBleHBsb2l0Lm5ldF91cGRhdGUoKQogICAgICAgICAgICBsb2NhbCBtZSA9IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkKCiAgICAgICAgICAgIGlmIG1lID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICB1cGRhdGVfbGFnY29tcGVuc2F0aW9uKG1lKQogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBuYXRpdmVfR2V0Q2xpZW50RW50aXR5ID0gdnRhYmxlX2JpbmQoJ2NsaWVudC5kbGwnLCAnVkNsaWVudEVudGl0eUxpc3QwMDMnLCAzLCAndm9pZCooX190aGlzY2FsbCopKHZvaWQqLCBpbnQpJykKCiAgICAgICAgZnVuY3Rpb24gZXhwbG9pdC5oYW5kbGVfZGVmZW5zaXZlKCkKICAgICAgICAgICAgbG9jYWwgbHAgPSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpCgogICAgICAgICAgICBpZiBscCA9PSBuaWwgb3Igbm90IGVudGl0eS5pc19hbGl2ZShscCkgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgRW50aXR5ID0gbmF0aXZlX0dldENsaWVudEVudGl0eShscCkKICAgICAgICAgICAgbG9jYWwgbV9mbE9sZFNpbXVsYXRpb25UaW1lID0gZmZpLmNhc3QoImZsb2F0KiIsIGZmaS5jYXN0KCJ1aW50cHRyX3QiLCBFbnRpdHkpICsgMHgyNkMpWzBdCiAgICAgICAgICAgIGxvY2FsIG1fZmxTaW11bGF0aW9uVGltZSA9IGVudGl0eS5nZXRfcHJvcChscCwgIm1fZmxTaW11bGF0aW9uVGltZSIpCgogICAgICAgICAgICBsb2NhbCBkZWx0YSA9IG1fZmxPbGRTaW11bGF0aW9uVGltZSAtIG1fZmxTaW11bGF0aW9uVGltZQoKICAgICAgICAgICAgaWYgZGVsdGEgPiAwIHRoZW4KICAgICAgICAgICAgICAgIGRhdGEuZGVmZW5zaXZlX3RrID0gZ2xvYmFscy50aWNrY291bnQoKSArIHRvdGlja3MoZGVsdGEgLSBjbGllbnQucmVhbF9sYXRlbmN5KCkpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICAtLS0gcmVnaW9uIGxvY2FscGxheWVyCiAgICBkbwogICAgICAgIGxvY2FsIE1PVklOR19MSU1JVCA9IDEuMSAqIDMuMwogICAgICAgIGxvY2FsIERVQ0tfUEVFS19MSU1JVCA9IDAuNzkKCiAgICAgICAgbG9jYWwgcHJlX2ZsYWdzID0gMAogICAgICAgIGxvY2FsIHBvc3RfZmxhZ3MgPSAwCgogICAgICAgIGxvY2FsIGZ1bmN0aW9uIGdldF9ib2R5X3lhdyhhbmltc3RhdGUpCiAgICAgICAgICAgIGxvY2FsIGJvZHlfeWF3ID0gYW5pbXN0YXRlLmV5ZV9hbmdsZXNfeSAtIGFuaW1zdGF0ZS5nb2FsX2ZlZXRfeWF3CiAgICAgICAgICAgIGJvZHlfeWF3ID0gdXRpbHMubm9ybWFsaXplX3lhdyhib2R5X3lhdykKCiAgICAgICAgICAgIHJldHVybiBib2R5X3lhdwogICAgICAgIGVuZAoKICAgICAgICBsb2NhbHBsYXllci5mbGFncyA9IDAKICAgICAgICBsb2NhbHBsYXllci5wYWNrZXRzID0gMAogICAgICAgIGxvY2FscGxheWVyLmNob2tpbmcgPSAxCiAgICAgICAgbG9jYWxwbGF5ZXIuY2hva2luZ19ib29sID0gZmFsc2UKCiAgICAgICAgbG9jYWxwbGF5ZXIuYm9keV95YXcgPSAwCiAgICAgICAgbG9jYWxwbGF5ZXIuZHVja19hbW91bnQgPSAwCgogICAgICAgIGxvY2FscGxheWVyLm1vdmV0eXBlID0gMAogICAgICAgIGxvY2FscGxheWVyLnZlbG9jaXR5ID0gMAoKICAgICAgICBsb2NhbHBsYXllci5pc19vbmdyb3VuZCA9IGZhbHNlCiAgICAgICAgbG9jYWxwbGF5ZXIuaXNfY3JvdWNoZWQgPSBmYWxzZQoKICAgICAgICBsb2NhbHBsYXllci5pc19tb3ZpbmcgPSBmYWxzZQogICAgICAgIGxvY2FscGxheWVyLmlzX2xhbmRpbmcgPSBmYWxzZQogICAgICAgIGxvY2FscGxheWVyLmlzX2FpcmJvcm5lID0gZmFsc2UKCiAgICAgICAgZnVuY3Rpb24gbG9jYWxwbGF5ZXIucHJlX3ByZWRpY3RfY29tbWFuZChlKQogICAgICAgICAgICBsb2NhbCBtZSA9IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkKICAgICAgICAgICAgcHJlX2ZsYWdzID0gZW50aXR5LmdldF9wcm9wKG1lLCAibV9mRmxhZ3MiKQogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBsb2NhbHBsYXllci5wcmVkaWN0X2NvbW1hbmQoZSkKICAgICAgICAgICAgbG9jYWwgbWUgPSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpCiAgICAgICAgICAgIHBvc3RfZmxhZ3MgPSBlbnRpdHkuZ2V0X3Byb3AobWUsICJtX2ZGbGFncyIpCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIGxvY2FscGxheWVyLm5ldF91cGRhdGUoKQogICAgICAgICAgICBsb2NhbCBtZSA9IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkKICAgICAgICAgICAgaWYgbWUgPT0gbmlsIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICAgICAgbG9jYWwgbXlfZGF0YSA9IGNfZW50aXR5KG1lKQogICAgICAgICAgICBpZiBteV9kYXRhID09IG5pbCB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgICAgIGxvY2FsIGFuaW1zdGF0ZSA9IGNfZW50aXR5LmdldF9hbmltX3N0YXRlKG15X2RhdGEpCiAgICAgICAgICAgIGlmIGFuaW1zdGF0ZSA9PSBuaWwgdGhlbiByZXR1cm4gZW5kCgogICAgICAgICAgICBsb2NhbCBjaG9rZWRjb21tYW5kcyA9IGdsb2JhbHMuY2hva2VkY29tbWFuZHMoKQoKICAgICAgICAgICAgbG9jYWwgbV9mRmxhZ3MgPSBlbnRpdHkuZ2V0X3Byb3AobWUsICJtX2ZGbGFncyIpCiAgICAgICAgICAgIGxvY2FsIG1fbW92ZXR5cGUgPSBlbnRpdHkuZ2V0X3Byb3AobWUsICJtX21vdmV0eXBlIikKICAgICAgICAgICAgbG9jYWwgbV9mbER1Y2tBbW91bnQgPSBlbnRpdHkuZ2V0X3Byb3AobWUsICJtX2ZsRHVja0Ftb3VudCIpCgogICAgICAgICAgICBsb2NhbHBsYXllci5mbGFncyA9IG1fZkZsYWdzCiAgICAgICAgICAgIGxvY2FscGxheWVyLm1vdmV0eXBlID0gbV9tb3ZldHlwZQogICAgICAgICAgICBsb2NhbHBsYXllci52ZWxvY2l0eSA9IGFuaW1zdGF0ZS5tX3ZlbG9jaXR5CgogICAgICAgICAgICBpZiBjaG9rZWRjb21tYW5kcyA9PSAwIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FscGxheWVyLnBhY2tldHMgPSBsb2NhbHBsYXllci5wYWNrZXRzICsgMQogICAgICAgICAgICAgICAgbG9jYWxwbGF5ZXIuY2hva2luZyA9IGxvY2FscGxheWVyLmNob2tpbmcgKiAtMQogICAgICAgICAgICAgICAgbG9jYWxwbGF5ZXIuY2hva2luZ19ib29sID0gbm90IGxvY2FscGxheWVyLmNob2tpbmdfYm9vbAoKICAgICAgICAgICAgICAgIGxvY2FscGxheWVyLmJvZHlfeWF3ID0gZ2V0X2JvZHlfeWF3KGFuaW1zdGF0ZSkKICAgICAgICAgICAgICAgIGxvY2FscGxheWVyLmR1Y2tfYW1vdW50ID0gbV9mbER1Y2tBbW91bnQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbHBsYXllci5pc19vbmdyb3VuZCA9IGFuaW1zdGF0ZS5vbl9ncm91bmQKICAgICAgICAgICAgbG9jYWxwbGF5ZXIuaXNfY3JvdWNoZWQgPSBsb2NhbHBsYXllci5kdWNrX2Ftb3VudCA+IERVQ0tfUEVFS19MSU1JVAoKICAgICAgICAgICAgbG9jYWxwbGF5ZXIuaXNfbW92aW5nID0gbG9jYWxwbGF5ZXIudmVsb2NpdHkgPiBNT1ZJTkdfTElNSVQKICAgICAgICAgICAgbG9jYWxwbGF5ZXIuaXNfbGFuZGluZyA9IGFuaW1zdGF0ZS5oaXRfaW5fZ3JvdW5kX2FuaW1hdGlvbgogICAgICAgICAgICBsb2NhbHBsYXllci5pc19haXJib3JuZSA9IGJpdC5iYW5kKHByZV9mbGFncywgcG9zdF9mbGFncywgMSkgPT0gMAogICAgICAgIGVuZAogICAgZW5kCgogICAgLS0tIHJlZ2lvbiBzdGF0ZW1lbnQKICAgIGRvCiAgICAgICAgbG9jYWwgbGlzdCA9IHsgfQoKICAgICAgICBsb2NhbCBmdW5jdGlvbiBhZGQoc3RhdGUpCiAgICAgICAgICAgIGxpc3RbI2xpc3QgKyAxXSA9IHN0YXRlCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIGZ1bmN0aW9uIHVwZGF0ZV9vbmdyb3VuZCgpCiAgICAgICAgICAgIGlmIGxvY2FscGxheWVyLmlzX21vdmluZyB0aGVuCiAgICAgICAgICAgICAgICBhZGQgIk1vdmluZyIKCiAgICAgICAgICAgICAgICBpZiBsb2NhbHBsYXllci5pc19jcm91Y2hlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiBsb2NhbHBsYXllci5pc19haXJib3JuZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiBzb2Z0d2FyZS5pc19zbG93X21vdGlvbigpIHRoZW4KICAgICAgICAgICAgICAgICAgICBhZGQgIlNsb3cgV2FsayIKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGFkZCAiU3RhbmRpbmciCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIGZ1bmN0aW9uIHVwZGF0ZV9jcm91Y2hlZCgpCiAgICAgICAgICAgIGlmIG5vdCBsb2NhbHBsYXllci5pc19jcm91Y2hlZCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBhZGQgIkNyb3VjaGVkIgoKICAgICAgICAgICAgaWYgbG9jYWxwbGF5ZXIuaXNfbW92aW5nIHRoZW4KICAgICAgICAgICAgICAgIGFkZCAiTW92ZSBDcm91Y2hlZCIKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIGZ1bmN0aW9uIHVwZGF0ZV9haXJib3JuZSgpCiAgICAgICAgICAgIGlmIG5vdCBsb2NhbHBsYXllci5pc19haXJib3JuZSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBhZGQgIkFpciIKCiAgICAgICAgICAgIGlmIGxvY2FscGxheWVyLmlzX2Nyb3VjaGVkIHRoZW4KICAgICAgICAgICAgICAgIGFkZCAiQWlyIENyb3VjaGVkIgogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gdXBkYXRlX2V4cGxvaXQoKQogICAgICAgICAgICBpZiBleHBsb2l0LmdldCgpLnNoaWZ0IG9yIChzb2Z0d2FyZS5pc19kb3VibGVfdGFwKCkgb3Igc29mdHdhcmUuaXNfb25fc2hvdF9hbnRpYWltKCkpIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGFkZCAiRmFrZSBMYWciCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIHN0YXRlbWVudC5nZXQoKQogICAgICAgICAgICByZXR1cm4gbGlzdAogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBzdGF0ZW1lbnQuYWRkKHN0YXRlKQogICAgICAgICAgICBhZGQoc3RhdGUpCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIHN0YXRlbWVudC5zZXR1cF9jb21tYW5kKCkKICAgICAgICAgICAgdGFibGUuY2xlYXIobGlzdCkKCiAgICAgICAgICAgIHVwZGF0ZV9vbmdyb3VuZCgpCiAgICAgICAgICAgIHVwZGF0ZV9jcm91Y2hlZCgpCiAgICAgICAgICAgIHVwZGF0ZV9haXJib3JuZSgpCiAgICAgICAgICAgIHVwZGF0ZV9leHBsb2l0KCkKICAgICAgICBlbmQKICAgIGVuZAoKICAgIC0tLSByZWdpb24gYW50aWFpbQogICAgZG8KICAgICAgICBsb2NhbCBjdHggPSB7IH0KCiAgICAgICAgbG9jYWwgYWNpZHlhd193YXlzID0gewogICAgICAgICAgICBbIjItV2F5Il0gPSB7IC0wLjUsIDAuNSB9LAogICAgICAgICAgICBbIjMtV2F5Il0gPSB7IC0wLjUsIDAsIDAuNSB9LAogICAgICAgICAgICBbIjUtV2F5Il0gPSB7IC0wLjc1LCAxLCAwLCAwLjQsIC0wLjI1IH0KICAgICAgICB9CgogICAgICAgIGxvY2FsIGZ1bmN0aW9uIGNhbGN1bGF0ZV9qaXR0ZXJfd2F5KG4sIG9mZnNldCkKICAgICAgICAgICAgbG9jYWwgZm1vZCA9IGxvY2FscGxheWVyLnBhY2tldHMgJSBuCiAgICAgICAgICAgIGxvY2FsIGNlbnRlciA9IG4gLyAyCgogICAgICAgICAgICBpZiBuICUgMiB+PSAwIHRoZW4KICAgICAgICAgICAgICAgIGNlbnRlciA9IG1hdGguZmxvb3IoY2VudGVyKQogICAgICAgICAgICBlbHNlaWYgZm1vZCA+PSBjZW50ZXIgdGhlbgogICAgICAgICAgICAgICAgZm1vZCA9IGZtb2QgKyAxCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgZGVsdGEgPSBmbW9kIC0gY2VudGVyCiAgICAgICAgICAgIGxvY2FsIHdlaWdodCA9IGRlbHRhIC8gY2VudGVyCgogICAgICAgICAgICBpZiB3ZWlnaHQgfj0gd2VpZ2h0IG9yIHdlaWdodCA9PSAwIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuIG9mZnNldCAqIHdlaWdodAogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBmdW5jdGlvbiBnZXRfc3RhdGVtZW50KCkKICAgICAgICAgICAgaWYgbm90IGV4cGxvaXQuZ2V0KCkuc2hpZnQgYW5kIG5vdCAoc29mdHdhcmUuaXNfZG91YmxlX3RhcCgpIG9yIHNvZnR3YXJlLmlzX29uX3Nob3RfYW50aWFpbSgpKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gJ0Zha2UgTGFnJwogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIGxvY2FscGxheWVyLmlzX2FpcmJvcm5lIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBsb2NhbHBsYXllci5pc19jcm91Y2hlZCBhbmQgIkFpciBDcm91Y2hlZCIgb3IgJ0FpcicKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBsb2NhbHBsYXllci5pc19jcm91Y2hlZCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gbG9jYWxwbGF5ZXIuaXNfbW92aW5nIGFuZCAiTW92ZSBDcm91Y2hlZCIgb3IgJ0Nyb3VjaGVkJwogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIGxvY2FscGxheWVyLmlzX21vdmluZyB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gc29mdHdhcmUuaXNfc2xvd19tb3Rpb24oKSBhbmQgJ1Nsb3cgV2Fsaycgb3IgIk1vdmluZyIKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICByZXR1cm4gJ1N0YW5kaW5nJwogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBmdW5jdGlvbiBtb2RpZnlfeWF3KCkKICAgICAgICAgICAgaWYgY3R4LnlhdyA9PSAiMTgwIExSIiB0aGVuCiAgICAgICAgICAgICAgICBjdHgueWF3ID0gIjE4MCIKCiAgICAgICAgICAgICAgICBpZiBjdHgueWF3X2xlZnQgPT0gbmlsIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgaWYgY3R4Lnlhd19yaWdodCA9PSBuaWwgdGhlbiByZXR1cm4gZW5kCgogICAgICAgICAgICAgICAgaWYgY3R4Lnlhd19vZmZzZXQgPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgICAgICBjdHgueWF3X29mZnNldCA9IDAKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGxvY2FsIGludmVydGVkID0gbG9jYWxwbGF5ZXIuYm9keV95YXcgPCAwCgogICAgICAgICAgICAgICAgaWYgY3R4Lnlhd18xODBscl9tb2RlID09ICJTd2l0Y2ggZGVsYXkiIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBkZWxheSA9IGN0eC55YXdfZGVsYXkKICAgICAgICAgICAgICAgICAgICBsb2NhbCB0YXJnZXQgPSBkZWxheSAqIDIKCiAgICAgICAgICAgICAgICAgICAgaW52ZXJ0ZWQgPSAobG9jYWxwbGF5ZXIucGFja2V0cyAlIHRhcmdldCkgPj0gZGVsYXkKCiAgICAgICAgICAgICAgICAgICAgY3R4LmJvZHlfeWF3ID0gIlN0YXRpYyIKICAgICAgICAgICAgICAgICAgICBjdHguYm9keV95YXdfb2Zmc2V0ID0gaW52ZXJ0ZWQgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgIDEgb3IgLTEKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGxvY2FsIHlhd19hZGQgPSBpbnZlcnRlZCBhbmQKICAgICAgICAgICAgICAgICAgICBjdHgueWF3X3JpZ2h0IG9yIGN0eC55YXdfbGVmdAoKICAgICAgICAgICAgICAgIGN0eC55YXdfb2Zmc2V0ID0gY3R4Lnlhd19vZmZzZXQgKyB5YXdfYWRkCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIHNhZmVfaGVhZF9wcmVzZXRzID0gewogICAgICAgICAgICBbMV0gPSB7CiAgICAgICAgICAgICAgICBbM10gPSB7CiAgICAgICAgICAgICAgICAgICAgLS0gYmFzZSA9ICJBdCBUYXJnZXQiICEhIQogICAgICAgICAgICAgICAgICAgIG9mZnNldCA9IDE1LAoKICAgICAgICAgICAgICAgICAgICBpbnZlcnRlciA9IGZhbHNlLAoKICAgICAgICAgICAgICAgICAgICBsZWZ0X2xpbWl0ID0gMjQsCiAgICAgICAgICAgICAgICAgICAgcmlnaHRfbGltaXQgPSAyNAogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICBbMl0gPSB7CiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gMTUsCgogICAgICAgICAgICAgICAgICAgIGludmVydGVyID0gZmFsc2UsCgogICAgICAgICAgICAgICAgICAgIGxlZnRfbGltaXQgPSAyNCwKICAgICAgICAgICAgICAgICAgICByaWdodF9saW1pdCA9IDI0CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgfQoKICAgICAgICBsb2NhbCByYW5kb21pemVkCiAgICAgICAgbG9jYWwgdmFsID0gMTgwCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gbW9kaWZ5X2ppdHRlcigpCiAgICAgICAgICAgIGlmIGN0eC5qaXR0ZXJfcmFuZG9taXphdGlvbiB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgaWYgbG9jYWxwbGF5ZXIucGFja2V0cyAlIDIgPT0gMCBvciByYW5kb21pemVkID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmFuZG9taXplZCA9IGNsaWVudC5yYW5kb21faW50KDAsIChjdHguaml0dGVyX29mZnNldCA+IDAgYW5kIDEgb3IgLTEpICogY3R4LmppdHRlcl9yYW5kb21pemF0aW9uKQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgY3R4LmppdHRlcl9vZmZzZXQgPSB1dGlscy5ub3JtYWxpemVfeWF3KGN0eC5qaXR0ZXJfb2Zmc2V0ICsgcmFuZG9taXplZCkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBjdHguYm9keV95YXcgPT0gJ1JhbmRvbWl6ZSBKaXR0ZXInIHRoZW4KICAgICAgICAgICAgICAgIGN0eC5ib2R5X3lhdyA9ICdTdGF0aWMnCgogICAgICAgICAgICAgICAgaWYgbG9jYWxwbGF5ZXIuY2hva2luZ19ib29sIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCByYW5kID0gY2xpZW50LnJhbmRvbV9pbnQoMCwgMSkKICAgICAgICAgICAgICAgICAgICB2YWwgPSByYW5kID09IDEgYW5kIDE4MCBvciAtMTgwCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBjdHguYm9keV95YXdfb2Zmc2V0ID0gdmFsCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgY3R4Lnlhd19qaXR0ZXIgPT0gIkFjaWRUZWNoIiB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCB5YXcgPSBjdHgueWF3X29mZnNldAogICAgICAgICAgICAgICAgbG9jYWwgc3RhdGUgPSBnZXRfc3RhdGVtZW50KCkKICAgICAgICAgICAgICAgIGxvY2FsIGRlbGF5X2RhdGEgPSBkZWxheV9kYXRhX2FsbFtzdGF0ZV0KCiAgICAgICAgICAgICAgICBkZWxheV9kYXRhLnRpY2tzID0gZGVsYXlfZGF0YS50aWNrcyArIDEKCiAgICAgICAgICAgICAgICBsb2NhbCBhY2lkX21vZGUgID0gY3R4LmppdHRlcl9tb2RlCiAgICAgICAgICAgICAgICBsb2NhbCBhY2lkX2N5Y2xlID0gY3R4LmFjaWRfY3ljbGUKICAgICAgICAgICAgICAgIGxvY2FsIGFjaWRfZGVsYXkgPSBjdHguYWNpZF9kZWxheQoKICAgICAgICAgICAgICAgIGxvY2FsIHdheXMgPSBhY2lkeWF3X3dheXNbYWNpZF9tb2RlXQogICAgICAgICAgICAgICAgbG9jYWwgd2F5ID0gd2F5c1sobG9jYWxwbGF5ZXIucGFja2V0cyAlICN3YXlzKSArIDFdCgogICAgICAgICAgICAgICAgLS0gZ29kICggcWhvc2UgKSBmb3JnaXZlIG1lIGZvciB0aGUgcGllY2Ugb2YgY29kZSBiZWxvdwogICAgICAgICAgICAgICAgLS0tIHJlZ2lvbiBsdWx6IGRpYWdub3N0aWNzIGRpc2FibGVACgogICAgICAgICAgICAgICAgbG9jYWwgYnlhdyA9IGxvY2FscGxheWVyLmJvZHlfeWF3CgogICAgICAgICAgICAgICAgaWYgYWNpZF9jeWNsZSB+PSA0IGFuZCBub3QgZGVsYXlfZGF0YS5pc19kZWxheSBhbmQgZGVsYXlfZGF0YS50aWNrcyAlIGFjaWRfY3ljbGUgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgZGVsYXlfZGF0YS5pc19kZWxheSA9IHRydWUKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGxvY2FsIGlnbm9yZV95YXcgPSBmYWxzZQogICAgICAgICAgICAgICAgaWYgZGVsYXlfZGF0YS5pc19kZWxheSB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgZGVsYXlfZGF0YS5jdXJyZW50IDwgYWNpZF9kZWxheSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5X2RhdGEuY3VycmVudCA9IGRlbGF5X2RhdGEuY3VycmVudCArIDEKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGN0eC5hY2lkX3NhZmUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgbHAgPSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBjdXJyZW50X3ByZXNldCA9IHNhZmVfaGVhZF9wcmVzZXRzWzFdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBwcmVzZXRfZm9yX3RlYW0gPSBjdXJyZW50X3ByZXNldFtlbnRpdHkuZ2V0X3Byb3AobHAsICdtX2lUZWFtTnVtJyldCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgeWF3ID0gMCAtLXByZXNldF9mb3JfdGVhbS5vZmZzZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5ib2R5X3lhdyA9ICdTdGF0aWMnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguYm9keV95YXdfb2Zmc2V0ID0gMAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlnbm9yZV95YXcgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICB5YXcgPSB5YXcKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5X2RhdGEuaXNfZGVsYXkgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICBkZWxheV9kYXRhLnRpY2tzID0gMAogICAgICAgICAgICAgICAgICAgICAgICBkZWxheV9kYXRhLmN1cnJlbnQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5X2RhdGEucHJldmlvdXNfYW5nbGUgPSAwCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYW5nbGUgPSAwCiAgICAgICAgICAgICAgICAgICAgaWYgYWNpZF9tb2RlID09ICIyLVdheSIgYW5kIChjdHguYm9keV95YXcgPT0gIkppdHRlciIgb3IgY3R4LmJvZHlfeWF3ID09ICdSYW5kb21pemUgSml0dGVyJykgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBhbmdsZSA9IHV0aWxzLm5vcm1hbGl6ZV95YXcoeWF3ICsgKGJ5YXcgPCAwIGFuZCBjdHguaml0dGVyX29mZnNldCAvIDIgb3IgY3R4LmppdHRlcl9vZmZzZXQgKiAtMSAvIDIpKQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgYW5nbGUgPSB1dGlscy5ub3JtYWxpemVfeWF3KHlhdyArIGN0eC5qaXR0ZXJfb2Zmc2V0ICogd2F5KQogICAgICAgICAgICAgICAgICAgIGVuZAoKCiAgICAgICAgICAgICAgICAgICAgZGVsYXlfZGF0YS5wcmV2aW91c19hbmdsZSA9IGFuZ2xlCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiBub3QgaWdub3JlX3lhdyB0aGVuCiAgICAgICAgICAgICAgICAgICAgeWF3ID0gZGVsYXlfZGF0YS5wcmV2aW91c19hbmdsZQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgY3R4Lnlhd19vZmZzZXQgPSB5YXcKICAgICAgICAgICAgICAgIGN0eC55YXdfaml0dGVyID0gJ09mZicKICAgICAgICAgICAgZW5kCgogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBmdW5jdGlvbiBzaHV0ZG93bigpCiAgICAgICAgICAgIG92ZXJyaWRlLnVuc2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy5lbmFibGVkKQogICAgICAgICAgICBvdmVycmlkZS51bnNldChzb2Z0d2FyZS5hYS5hbmdsZXMucGl0Y2hbMV0pCiAgICAgICAgICAgIG92ZXJyaWRlLnVuc2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy5waXRjaFsyXSkKCiAgICAgICAgICAgIG92ZXJyaWRlLnVuc2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy55YXdfYmFzZSkKCiAgICAgICAgICAgIG92ZXJyaWRlLnVuc2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy55YXdbMV0pCiAgICAgICAgICAgIG92ZXJyaWRlLnVuc2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy55YXdbMl0pCgogICAgICAgICAgICBvdmVycmlkZS51bnNldChzb2Z0d2FyZS5hYS5hbmdsZXMueWF3X2ppdHRlclsxXSkKICAgICAgICAgICAgb3ZlcnJpZGUudW5zZXQoc29mdHdhcmUuYWEuYW5nbGVzLnlhd19qaXR0ZXJbMl0pCgogICAgICAgICAgICBvdmVycmlkZS51bnNldChzb2Z0d2FyZS5hYS5hbmdsZXMuYm9keV95YXdbMV0pCiAgICAgICAgICAgIG92ZXJyaWRlLnVuc2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy5ib2R5X3lhd1syXSkKCiAgICAgICAgICAgIG92ZXJyaWRlLnVuc2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy5mcmVlc3RhbmRpbmdfYm9keV95YXcpCgogICAgICAgICAgICBvdmVycmlkZS51bnNldChzb2Z0d2FyZS5hYS5hbmdsZXMuZWRnZV95YXcpCgogICAgICAgICAgICBvdmVycmlkZS51bnNldChzb2Z0d2FyZS5hYS5hbmdsZXMuZnJlZXN0YW5kaW5nWzFdKQogICAgICAgICAgICBvdmVycmlkZS51bnNldChzb2Z0d2FyZS5hYS5hbmdsZXMuZnJlZXN0YW5kaW5nWzJdKQoKICAgICAgICAgICAgb3ZlcnJpZGUudW5zZXQoc29mdHdhcmUuYWEuYW5nbGVzLnJvbGwpCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIGZ1bmN0aW9uIHNldHVwKCkKICAgICAgICAgICAgeWF3X2RpcmVjdGlvbi5pc19mcmVlc3RhbmRpbmcgPSBmYWxzZQogICAgICAgICAgICBpZiBjdHguZW5hYmxlZCB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgb3ZlcnJpZGUuc2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy5lbmFibGVkLCBjdHguZW5hYmxlZCkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgb3ZlcnJpZGUuc2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy5lbmFibGVkLCB0cnVlKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIGN0eC5waXRjaCB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgb3ZlcnJpZGUuc2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy5waXRjaFsxXSwgY3R4LnBpdGNoKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIGN0eC55YXdfYmFzZSB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgb3ZlcnJpZGUuc2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy55YXdfYmFzZSwgY3R4Lnlhd19iYXNlKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIGN0eC55YXcgfj0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIG92ZXJyaWRlLnNldChzb2Z0d2FyZS5hYS5hbmdsZXMueWF3WzFdLCBjdHgueWF3KQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIGN0eC5ib2R5X3lhdyB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgb3ZlcnJpZGUuc2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy5ib2R5X3lhd1sxXSwgY3R4LmJvZHlfeWF3KQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIGN0eC5lZGdlX3lhdyB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgb3ZlcnJpZGUuc2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy5lZGdlX3lhdywgY3R4LmVkZ2VfeWF3KQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIGN0eC5mcmVlc3RhbmRpbmcgfj0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIHlhd19kaXJlY3Rpb24uaXNfZnJlZXN0YW5kaW5nID0gY3R4LmZyZWVzdGFuZGluZwogICAgICAgICAgICAgICAgb3ZlcnJpZGUuc2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy5mcmVlc3RhbmRpbmdbMV0sIGN0eC5mcmVlc3RhbmRpbmcpCiAgICAgICAgICAgICAgICBvdmVycmlkZS5zZXQoc29mdHdhcmUuYWEuYW5nbGVzLmZyZWVzdGFuZGluZ1syXSwgY3R4LmZyZWVzdGFuZGluZyBhbmQKICAgICAgICAgICAgICAgICAgICAiQWx3YXlzIG9uIiBvciAiT24gaG90a2V5IikKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBjdHgucm9sbCB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgb3ZlcnJpZGUuc2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy5yb2xsLCBjdHgucm9sbCkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBwaXRjaF92YWx1ZSA9IHVpLmdldChzb2Z0d2FyZS5hYS5hbmdsZXMucGl0Y2hbMV0pCiAgICAgICAgICAgIGxvY2FsIHlhd192YWx1ZSA9IHVpLmdldChzb2Z0d2FyZS5hYS5hbmdsZXMueWF3WzFdKQogICAgICAgICAgICBsb2NhbCBib2R5X3lhd192YWx1ZSA9IHVpLmdldChzb2Z0d2FyZS5hYS5hbmdsZXMuYm9keV95YXdbMV0pCgogICAgICAgICAgICBpZiBwaXRjaF92YWx1ZSA9PSAiQ3VzdG9tIiB0aGVuCiAgICAgICAgICAgICAgICBpZiBjdHgucGl0Y2hfb2Zmc2V0IH49IG5pbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgb3ZlcnJpZGUuc2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy5waXRjaFsyXSwgdXRpbHMuY2xhbXAoY3R4LnBpdGNoX29mZnNldCwgLTg5LCA4OSkpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiB5YXdfdmFsdWUgfj0gIk9mZiIgdGhlbgogICAgICAgICAgICAgICAgaWYgY3R4Lnlhd19vZmZzZXQgfj0gbmlsIHRoZW4KICAgICAgICAgICAgICAgICAgICBvdmVycmlkZS5zZXQoc29mdHdhcmUuYWEuYW5nbGVzLnlhd1syXSwgdXRpbHMubm9ybWFsaXplX3lhdyhjdHgueWF3X29mZnNldCkpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiBjdHgueWF3X2ppdHRlciB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgICAgIG92ZXJyaWRlLnNldChzb2Z0d2FyZS5hYS5hbmdsZXMueWF3X2ppdHRlclsxXSwgY3R4Lnlhd19qaXR0ZXIpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBsb2NhbCB5YXdfaml0dGVyX3ZhbCA9IHVpLmdldChzb2Z0d2FyZS5hYS5hbmdsZXMueWF3X2ppdHRlclsxXSkKCiAgICAgICAgICAgICAgICBpZiB5YXdfaml0dGVyX3ZhbCB+PSAiT2ZmIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgY3R4LmppdHRlcl9vZmZzZXQgfj0gbmlsIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcnJpZGUuc2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy55YXdfaml0dGVyWzJdLCB1dGlscy5ub3JtYWxpemVfeWF3KGN0eC5qaXR0ZXJfb2Zmc2V0KSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIGJvZHlfeWF3X3ZhbHVlIH49ICJPZmYiIHRoZW4KICAgICAgICAgICAgICAgIGlmIGJvZHlfeWF3X3ZhbHVlIH49ICJPcHBvc2l0ZSIgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIGN0eC5ib2R5X3lhd19vZmZzZXQgfj0gbmlsIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcnJpZGUuc2V0KHNvZnR3YXJlLmFhLmFuZ2xlcy5ib2R5X3lhd1syXSwgdXRpbHMubm9ybWFsaXplX3lhdyhjdHguYm9keV95YXdfb2Zmc2V0KSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIGN0eC5mcmVlc3RhbmRpbmdfYm9keV95YXcgfj0gbmlsIHRoZW4KICAgICAgICAgICAgICAgICAgICBvdmVycmlkZS5zZXQoc29mdHdhcmUuYWEuYW5nbGVzLmZyZWVzdGFuZGluZ19ib2R5X3lhdywgY3R4LmZyZWVzdGFuZGluZ19ib2R5X3lhdykKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gdGhpbmsoZSkKICAgICAgICAgICAgLS0gYnJlYWtfbGMudGhpbmsoZSkKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gdXBkYXRlKGUpCiAgICAgICAgICAgIGFuZ2xlcy51cGRhdGUoY3R4KQogICAgICAgICAgICB5YXdfZGlyZWN0aW9uLnVwZGF0ZShjdHgpCiAgICAgICAgICAgIGF1dG9fcGVlay5wZXJmb3JtKGN0eCkKICAgICAgICAgICAgbWFudWFsX2RpcmVjdGlvbi51cGRhdGUoY3R4KQoKICAgICAgICAgICAgc2FmZV9oZWFkLnVwZGF0ZShlLCBjdHgpCiAgICAgICAgICAgIGRlZmVuc2l2ZS5oYW5kbGUoZSwgY3R4KQogICAgICAgICAgICBhaXJfZXhwbG9pdC5oYW5kbGUoY3R4LCBlKQogICAgICAgICAgICBhdm9pZF9iYWNrc3RhYi51cGRhdGUoY3R4KQogICAgICAgICAgICBkaXNhYmxlcnMudXBkYXRlKGUsIGN0eCkKICAgICAgICAgICAgZnNfZGlzYWJsZXJzLnVwZGF0ZShjdHgpCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIGFudGlhaW0uc2h1dGRvd24oKQogICAgICAgICAgICBzaHV0ZG93bigpCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIGFudGlhaW0uc2V0dXBfY29tbWFuZChlKQogICAgICAgICAgICBpZiBub3QgZ3VpLmVuYWJsZWQ6Z2V0KCkgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgdGFibGUuY2xlYXIoY3R4KQogICAgICAgICAgICBzaHV0ZG93bigpCgogICAgICAgICAgICB0aGluayhlKQogICAgICAgICAgICB1cGRhdGUoZSkKCiAgICAgICAgICAgIG1vZGlmeV95YXcoKQogICAgICAgICAgICBtb2RpZnlfaml0dGVyKCkKCiAgICAgICAgICAgIHNldHVwKCkKICAgICAgICBlbmQKCiAgICAgICAgZ3VpLmVuYWJsZWQ6c2V0X2NhbGxiYWNrKGZ1bmN0aW9uKGl0ZW0pCiAgICAgICAgICAgIGlmIG5vdCB1aS5nZXQoaXRlbSkgdGhlbgogICAgICAgICAgICAgICAgc2h1dGRvd24oKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKCiAgICAtLS1yZWdpb24gc2V0dGluZ3MgdHdlYWtzCiAgICBkbwogICAgICAgIHNldHRpbmdzLnR3ZWFrc19lbmFibGUgPSBtZW51Lm5ld19pdGVtKHVpLm5ld19jaGVja2JveCwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJGZWF0dXJlcyIpCiAgICAgICAgOiByZWNvcmQoInNldHRpbmdzIiwgInNldHRpbmdzOjp0d2Vha3NfZW5hYmxlIikKICAgICAgICA6IHNhdmUoKQoKICAgICAgICBzZXR0aW5ncy50d2Vha3MgPSBtZW51Lm5ld19pdGVtKHVpLm5ld19tdWx0aXNlbGVjdCwgJ0FBJywgJ0FudGktYWltYm90IGFuZ2xlcycsIG1lcmdlIHsgIi0gRnVuY3Rpb25zIiwgIlxuIiwgInNldHRpbmdzOjp0d2Vha3MiIH0sIHsgJ0xvZyBBaW1ib3QgU2hvdHMnLCAnVHJhc2h0YWxrJywgJ1VubXV0ZSBTaWxlbmNlZCBQbGF5ZXJzJywgJ0NvbnNvbGUgRmlsdGVyJywgJ0RhbWFnZSBNYXJrZXInIH0pCiAgICAgICAgOiByZWNvcmQoInNldHRpbmdzIiwgInNldHRpbmdzOjp0d2Vha3MiKQogICAgICAgIDogc2F2ZSgpCiAgICBlbmQKCiAgICAtLS0gcmVnaW9uIHdpZGdldHMKICAgIGRvCiAgICAgICAgd2lkZ2V0cy5lbmFibGVkID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfY2hlY2tib3gsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiV2lkZ2V0cyIpCiAgICAgICAgOiByZWNvcmQoInZpc3VhbHMiLCAid2lkZ2V0czo6ZW5hYmxlZCIpCiAgICAgICAgOiBzYXZlKCkKCiAgICAgICAgd2lkZ2V0cy5jb2xvcl9waWNrZXIgPSBtZW51Lm5ld19pdGVtKHVpLm5ld19jb2xvcl9waWNrZXIsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCBtZXJnZSB7ICItIENvbG9yIiwgIlxuIiwgIndpZGdldHM6OmNvbG9yX3BpY2tlciIgfSwgMTEzLCAxNTIsIDI1NSwgMjU1KQogICAgICAgIDogcmVjb3JkKCJ2aXN1YWxzIiwgImtleWJpbmRzOjpjb2xvcl9waWNrZXIiKQogICAgICAgIDogc2F2ZSgpCgogICAgICAgIHdpZGdldHMuaXRlbXMgPSBtZW51Lm5ld19pdGVtKHVpLm5ld19tdWx0aXNlbGVjdCwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsIG1lcmdlIHsgIi0gSXRlbXMiLCAiXG4iLCAid2lkZ2V0czo6aXRlbXMiIH0sIHsgIldhdGVybWFyayIsICJLZXliaW5kcyIsICJWZWxvY2l0eSBXYXJuaW5nIiwgIkNyb3NzaGFpciBJbmRpY2F0b3IiLCAiRGFtYWdlIEluZGljYXRvciIsICJPbi1TY3JlZW4gTG9ncyIsICdIaXQgUmF0ZScgfSkKICAgICAgICA6IHJlY29yZCgidmlzdWFscyIsICJ3aWRnZXRzOjppdGVtcyIpCiAgICAgICAgOiBzYXZlKCkKCiAgICAgICAgd2lkZ2V0cy5kaXNwbGF5ID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfbXVsdGlzZWxlY3QsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCBtZXJnZSB7ICItIERpc3BsYXkiLCAiXG4iLCAid2lkZ2V0czo6ZGlzcGxheSIgfSwgeyAiVXNlcm5hbWUiLCAiTGF0ZW5jeSIsICJUaW1lIiwgIkZQUyIsICJTZXJ2ZXIgZnJhbWV0aW1lIiB9KQogICAgICAgIDogcmVjb3JkKCJ2aXN1YWxzIiwgIndpZGdldHM6OmRpc3BsYXkiKQogICAgICAgIDogc2F2ZSgpCgogICAgICAgIHdpZGdldHMuY3VzdG9tX25hbWUgPSBtZW51Lm5ld19pdGVtKHVpLm5ld19jaGVja2JveCwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJDdXN0b20gTmFtZSIsIHsgIlVzZXJuYW1lIiwgIkxhdGVuY3kiLCAiVGltZSIsICJGUFMiLCAiU2VydmVyIGZyYW1ldGltZSIgfSkKICAgICAgICA6IHJlY29yZCgidmlzdWFscyIsICJ3aWRnZXRzOjpjdXN0b21fbmFtZSIpCiAgICAgICAgOiBzYXZlKCkKCiAgICAgICAgd2lkZ2V0cy5jdXN0b21fbmFtZV92YWx1ZSA9IG1lbnUubmV3X2l0ZW0odWkubmV3X3RleHRib3gsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiTmlja25hbWUiKQogICAgICAgIDogcmVjb3JkKCJ2aXN1YWxzIiwgIndpZGdldHM6OmN1c3RvbV9uYW1lX3ZhbHVlIikKICAgICAgICA6IHNhdmUoKQogICAgZW5kCgogICAgLS0tIHJlZ2lvbiBmYXN0IGxhZGRlcgogICAgZG8KICAgICAgICBhYV90d2Vha3MuZW5hYmxlID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfY2hlY2tib3gsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiVHdlYWtzIikKICAgICAgICA6IHJlY29yZCgic2V0dGluZ3MiLCAiYWFfdHdlYWtzOjplbmFibGUiKQogICAgICAgIDogc2F2ZSgpCgogICAgICAgIGFhX3R3ZWFrcy5pdGVtcyA9IG1lbnUubmV3X2l0ZW0odWkubmV3X211bHRpc2VsZWN0LCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIi0gT3B0aW9ucyIsIHsgJ0Rpc2FibGUgb24gV2FybXVwJywgJ0Rpc2FibGUgV2hpbGUgTm8gRW5lbWllcycsICdBdm9pZCBCYWNrc3RhYicsICdGYXN0IExhZGRlcicsICdFZGdlIFlhdyBvbiBGRCcsICJBdXRvIFBlZWsgSW1wcm92ZW1lbnRzIiB9KQogICAgICAgIDogcmVjb3JkKCJhYSIsICJhYV90d2Vha3M6Oml0ZW1zIikKICAgICAgICA6IHNhdmUoKQoKICAgICAgICBjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCdzZXR1cF9jb21tYW5kJywgZnVuY3Rpb24gKGNtZCkKICAgICAgICAgICAgaWYgbm90IGFhX3R3ZWFrcy5lbmFibGU6Z2V0KCkgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgbm90IGFhX3R3ZWFrcy5pdGVtczpoYXZlX2tleSgnRmFzdCBMYWRkZXInKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBscCA9IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkKICAgICAgICAgICAgaWYgbHAgPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIGVudGl0eS5nZXRfcHJvcChscCwgJ21fTW92ZVR5cGUnKSB+PSA5IHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIHdlYXBvbiA9IGVudGl0eS5nZXRfcGxheWVyX3dlYXBvbihscCkKICAgICAgICAgICAgaWYgd2VhcG9uID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCB0aHJvd190aW1lID0gZW50aXR5LmdldF9wcm9wKHdlYXBvbiwgJ21fZlRocm93VGltZScpCgogICAgICAgICAgICBpZiB0aHJvd190aW1lIH49IG5pbCBhbmQgdGhyb3dfdGltZSB+PSAwIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIGNtZC5mb3J3YXJkbW92ZSA+IDAgdGhlbgogICAgICAgICAgICAgICAgaWYgY21kLnBpdGNoIDwgNDUgdGhlbgogICAgICAgICAgICAgICAgICAgIGNtZC5waXRjaCA9IDg5CiAgICAgICAgICAgICAgICAgICAgY21kLmluX21vdmVyaWdodCA9IDEKICAgICAgICAgICAgICAgICAgICBjbWQuaW5fbW92ZWxlZnQgPSAwCiAgICAgICAgICAgICAgICAgICAgY21kLmluX2ZvcndhcmQgPSAwCiAgICAgICAgICAgICAgICAgICAgY21kLmluX2JhY2sgPSAxCgogICAgICAgICAgICAgICAgICAgIGlmIGNtZC5zaWRlbW92ZSA9PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgY21kLnlhdyA9IGNtZC55YXcgKyA5MAogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBpZiBjbWQuc2lkZW1vdmUgPCAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgY21kLnlhdyA9IGNtZC55YXcgKyAxNTAKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgaWYgY21kLnNpZGVtb3ZlID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGNtZC55YXcgPSBjbWQueWF3ICsgMzAKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbHNlaWYgY21kLmZvcndhcmRtb3ZlIDwgMCB0aGVuCiAgICAgICAgICAgICAgICBjbWQucGl0Y2ggPSA4OQogICAgICAgICAgICAgICAgY21kLmluX21vdmVsZWZ0ID0gMQogICAgICAgICAgICAgICAgY21kLmluX21vdmVyaWdodCA9IDAKICAgICAgICAgICAgICAgIGNtZC5pbl9mb3J3YXJkID0gMQogICAgICAgICAgICAgICAgY21kLmluX2JhY2sgPSAwCgogICAgICAgICAgICAgICAgaWYgY21kLnNpZGVtb3ZlID09IDAgdGhlbgogICAgICAgICAgICAgICAgICAgIGNtZC55YXcgPSBjbWQueWF3ICsgOTAKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIGNtZC5zaWRlbW92ZSA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgIGNtZC55YXcgPSBjbWQueWF3ICsgMTUwCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiBjbWQuc2lkZW1vdmUgPCAwIHRoZW4KICAgICAgICAgICAgICAgICAgICBjbWQueWF3ID0gY21kLnlhdyArIDMwCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCgogICAgLS0tIHJlZ2lvbiBpZGlvdAogICAgZG8KICAgICAgICBhaXJfZXhwbG9pdC5lbmFibGVkID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfY2hlY2tib3gsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQWlyIExhZyBFeHBsb2l0IiwgMSwgMzAsIDE4LCB0cnVlLCAndCcpCiAgICAgICAgOiByZWNvcmQoImFhIiwgImFpcl9leHBsb2l0OjplbmFibGVkIikKICAgICAgICA6IHNhdmUoKQoKICAgICAgICBhaXJfZXhwbG9pdC5rZXkgPSBtZW51Lm5ld19pdGVtKHVpLm5ld19ob3RrZXksICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiXG5BaXIgTGFnIEV4cGxvaXQiLCB0cnVlKQogICAgICAgIDogcmVjb3JkKCJhYSIsICJhaXJfZXhwbG9pdDo6a2V5IikKICAgICAgICA6IHNhdmUoKQoKICAgICAgICBhaXJfZXhwbG9pdC50aWNrcyA9IG1lbnUubmV3X2l0ZW0odWkubmV3X3NsaWRlciwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICItIFRpY2tzIiwgMSwgMzAsIDEwLCB0cnVlLCAndCcpCiAgICAgICAgOiByZWNvcmQoImFhIiwgImFpcl9leHBsb2l0Ojp0aWNrcyIpCiAgICAgICAgOiBzYXZlKCkKCgogICAgICAgIGFpcl9leHBsb2l0LnJlc2V0ID0gZmFsc2UKCiAgICAgICAgbG9jYWwgd2VhcG9ucyA9IHsgIkdsb2JhbCIsICJHM1NHMSAvIFNDQVItMjAiLCAiU1NHIDA4IiwgIkFXUCIsICJSOCBSZXZvbHZlciIsICJEZXNlcnQgRWFnbGUiLCAiUGlzdG9sIiwgIlpldXMiLCAiUmlmbGUiLCAiU2hvdGd1biIsICJTTUciLCAiTWFjaGluZSBndW4iIH0KCiAgICAgICAgZnVuY3Rpb24gYWlyX2V4cGxvaXQuYmFja3VwcygpCiAgICAgICAgICAgIGlmIGFpcl9leHBsb2l0LnJlc2V0IHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIHByZXYgPSB1aS5nZXQoc29mdHdhcmUucmFnZS53ZWFwb24ud2VhcG9uX3R5cGUpCgogICAgICAgICAgICAgICAgZm9yIF8sIHdlYXBvbiBpbiBuZXh0LCB3ZWFwb25zIGRvCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHNvZnR3YXJlLnJhZ2Uud2VhcG9uLndlYXBvbl90eXBlLCB3ZWFwb24pCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHNvZnR3YXJlLnJhZ2UuYWltYm90LmVuYWJsZWRbMV0sIHRydWUpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICB1aS5zZXQoc29mdHdhcmUucmFnZS53ZWFwb24ud2VhcG9uX3R5cGUsIHByZXYpCgogICAgICAgICAgICAgICAgb3ZlcnJpZGUudW5zZXQoc29mdHdhcmUucmFnZS5vdGhlci5kdWNrX3BlZWtfYXNzaXN0KQogICAgICAgICAgICAgICAgb3ZlcnJpZGUudW5zZXQoc29mdHdhcmUuYWEuZmFrZWxhZy5saW1pdCkKICAgICAgICAgICAgICAgIG92ZXJyaWRlLnVuc2V0KHNvZnR3YXJlLm1pc2Muc2V0dGluZ3Muc3ZfbWF4dXNyY21kcHJvY2Vzc3RpY2tzKQogICAgICAgICAgICAgICAgYWlyX2V4cGxvaXQucmVzZXQgPSBmYWxzZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gYWlyX2V4cGxvaXQuaGFuZGxlKGN0eCwgY21kKQogICAgICAgICAgICBpZiBub3QgYWlyX2V4cGxvaXQuZW5hYmxlZDpnZXQoKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gYWlyX2V4cGxvaXQuYmFja3VwcygpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgaXNfYWN0aXZlID0gYWlyX2V4cGxvaXQua2V5OnJhd2dldCgpCiAgICAgICAgICAgIGlmIG5vdCBpc19hY3RpdmUgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIGFpcl9leHBsb2l0LmJhY2t1cHMoKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIG5vdCBzb2Z0d2FyZS5pc19kb3VibGVfdGFwKCkgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIGFpcl9leHBsb2l0LmJhY2t1cHMoKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIG5vdCBsb2NhbHBsYXllci5pc19haXJib3JuZSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gYWlyX2V4cGxvaXQuYmFja3VwcygpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgZXhwbG9pdCA9IGV4cGxvaXQuZ2V0KCkKCiAgICAgICAgICAgIG92ZXJyaWRlLnNldChzb2Z0d2FyZS5taXNjLnNldHRpbmdzLnN2X21heHVzcmNtZHByb2Nlc3N0aWNrcywgMTkpCiAgICAgICAgICAgIG92ZXJyaWRlLnNldChzb2Z0d2FyZS5hYS5mYWtlbGFnLmxpbWl0LCAxNykKCiAgICAgICAgICAgIGlmIGV4cGxvaXQuc2hpZnQgdGhlbgogICAgICAgICAgICAgICAgdWkuc2V0KHNvZnR3YXJlLnJhZ2UuYWltYm90LmVuYWJsZWRbMV0sIHRydWUpCiAgICAgICAgICAgICAgICBjbWQuZGlzY2hhcmdlX3BlbmRpbmcgPSB0cnVlCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHVpLnNldChzb2Z0d2FyZS5yYWdlLmFpbWJvdC5lbmFibGVkWzFdLCBmYWxzZSkKICAgICAgICAgICAgICAgIG92ZXJyaWRlLnNldChzb2Z0d2FyZS5yYWdlLm90aGVyLmR1Y2tfcGVla19hc3Npc3QsIGdsb2JhbHMudGlja2NvdW50KCkgJSBhaXJfZXhwbG9pdC50aWNrczpnZXQoKSA9PSAwIGFuZCAnQWx3YXlzIG9uJyBvciAnT24gaG90a2V5JykKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBhaXJfZXhwbG9pdC5yZXNldCA9IHRydWUKICAgICAgICBlbmQKICAgIGVuZAoKICAgIC0tLSByZWdpb24gZGVmZW5zaXZlCiAgICBkbwogICAgICAgIGxvY2FsIGZ1bmN0aW9uIGdldF9zdGF0ZW1lbnQoKQogICAgICAgICAgICBpZiBsb2NhbHBsYXllci5pc19haXJib3JuZSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gIkFpciI7CiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgbG9jYWxwbGF5ZXIuaXNfY3JvdWNoZWQgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuICJDcm91Y2hlZCI7CiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgbG9jYWxwbGF5ZXIuaXNfbW92aW5nIHRoZW4KICAgICAgICAgICAgICAgIGlmIHNvZnR3YXJlLmlzX3Nsb3dfbW90aW9uKCkgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybiAiU2xvdyBXYWxrIjsKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIHJldHVybiAiTW92aW5nIjsKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICByZXR1cm4gIlN0YW5kaW5nIgogICAgICAgIGVuZAoKICAgICAgICBkZWZlbnNpdmUuZW5hYmxlZCA9IG1lbnUubmV3X2l0ZW0odWkubmV3X2NoZWNrYm94LCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIkRlZmVuc2l2ZSBBQSIpCiAgICAgICAgOiByZWNvcmQoImFhIiwgImRlZmVuc2l2ZTo6ZW5hYmxlZCIpCiAgICAgICAgOiBzYXZlKCkKCiAgICAgICAgZGVmZW5zaXZlLm1vZGUgPSBtZW51Lm5ld19pdGVtKHVpLm5ld19tdWx0aXNlbGVjdCwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsIG1lcmdlIHsgIi0gTW9kZSIsICJcbiIsICJkZWZlbnNpdmU6Om1vZGUiIH0sIHsgIk9uIFNob3QgQW50aSBBaW0iLCAiRG91YmxlIFRhcCIgfSkKICAgICAgICA6IHJlY29yZCgiYWEiLCAiZGVmZW5zaXZlOjptb2RlIikKICAgICAgICA6IHNhdmUoKQoKICAgICAgICBkZWZlbnNpdmUuc3RhdGUgPSBtZW51Lm5ld19pdGVtKHVpLm5ld19tdWx0aXNlbGVjdCwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsIG1lcmdlIHsgIi0gU3RhdGUiLCAiXG4iLCAiZGVmZW5zaXZlOjpzdGF0ZSIgfSwgeyAiQWlyIiwgIlN0YW5kaW5nIiwgIk1vdmluZyIsICJTbG93IFdhbGsiLCAiQ3JvdWNoZWQiLCAiT24gUGVlayIgfSkKICAgICAgICA6IHJlY29yZCgiYWEiLCAiZGVmZW5zaXZlOjpzdGF0ZSIpCiAgICAgICAgOiBzYXZlKCkKCiAgICAgICAgZGVmZW5zaXZlLnBpdGNoID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfY29tYm9ib3gsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCBtZXJnZSB7ICItIFBpdGNoIiwgIlxuIiwgImRlZmVuc2l2ZTo6cGl0Y2giIH0sIHsgIkRlZmF1bHQiLCAiWmVybyIsICJVcCIsICJVcCBTd2l0Y2giLCAiRG93biBTd2l0Y2giLCAiUmFuZG9tIiB9KQogICAgICAgIDogcmVjb3JkKCJhYSIsICJkZWZlbnNpdmU6OnBpdGNoIikKICAgICAgICA6IHNhdmUoKQoKICAgICAgICBkZWZlbnNpdmUueWF3ID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfY29tYm9ib3gsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCBtZXJnZSB7ICItIFlhdyIsICJcbiIsICJkZWZlbnNpdmU6OnlhdyIgfSwgeyAiRGVmYXVsdCIsICJTaWRld2F5cyIsICJGb3J3YXJkIiwgIlNwaW5ib3QiLCAiMy1XYXkiLCAiNS1XYXkiLCAiUmFuZG9tIiB9KQogICAgICAgIDogcmVjb3JkKCJhYSIsICJkZWZlbnNpdmU6OnBpdGNoIikKICAgICAgICA6IHNhdmUoKQoKICAgICAgICBsb2NhbCBtb2RlcyA9IHsKICAgICAgICAgICAgWydEb3VibGUgVGFwJ10gPSBzb2Z0d2FyZS5pc19kb3VibGVfdGFwLAogICAgICAgICAgICBbJ09uIFNob3QgQW50aSBBaW0nXSA9IHNvZnR3YXJlLmlzX29uX3Nob3RfYW50aWFpbQogICAgICAgIH0KCiAgICAgICAgbG9jYWwgbWFudWFsX2JlYnJhID0gewogICAgICAgICAgICBbMF0gPSA5MCwKICAgICAgICAgICAgWzFdID0gLTkwLAogICAgICAgICAgICBbMl0gPSAwCiAgICAgICAgfQoKICAgICAgICBsb2NhbCBkZWZlbnNpdmVfM193YXkgPSB7IDkwLCAxODAsIC05MCwgMTgwLCA5MCB9CiAgICAgICAgbG9jYWwgZGVmZW5zaXZlXzVfd2F5ID0geyA5MCwgMTM1LCAxODAsIDIyNSwgMjcwIH0KCiAgICAgICAgZnVuY3Rpb24gZGVmZW5zaXZlLmhhbmRsZShjbWQsIGN0eCkKICAgICAgICAgICAgaWYgbm90IGRlZmVuc2l2ZS5lbmFibGVkOmdldCgpIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIGxwID0gZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKQogICAgICAgICAgICBpZiBscCA9PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgd29ya19vbl9tb2RlID0gZmFsc2UKICAgICAgICAgICAgZm9yIGlkeCwgbW9kZSBpbiBuZXh0LCBkZWZlbnNpdmUubW9kZTpnZXQoKSBkbwogICAgICAgICAgICAgICAgaWYgbW9kZXNbIG1vZGUgXSBhbmQgbW9kZXNbIG1vZGUgXSgpIHRoZW4KICAgICAgICAgICAgICAgICAgICB3b3JrX29uX21vZGUgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIGRvdWJsZV90YXAgPSBleHBsb2l0LmdldCgpCiAgICAgICAgICAgIGlmIG5vdCB3b3JrX29uX21vZGUgb3Igbm90IGRvdWJsZV90YXAuc2hpZnQgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgbHBfc3RhdGUgPSBnZXRfc3RhdGVtZW50KCkKCiAgICAgICAgICAgIGxvY2FsIHNob3VsZF93b3JrID0gZmFsc2UKICAgICAgICAgICAgbG9jYWwgb25fcGVlayA9IGZhbHNlCiAgICAgICAgICAgIGZvciBfLCBjb25kaXRpb24gaW4gbmV4dCwgZGVmZW5zaXZlLnN0YXRlOmdldCgpIGRvCiAgICAgICAgICAgICAgICBpZiBjb25kaXRpb24gPT0gJ09uIFBlZWsnIHRoZW4KICAgICAgICAgICAgICAgICAgICBzaG91bGRfd29yayA9IHRydWUKICAgICAgICAgICAgICAgICAgICBvbl9wZWVrID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgaWYgY29uZGl0aW9uID09IGxwX3N0YXRlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgc2hvdWxkX3dvcmsgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBub3Qgc2hvdWxkX3dvcmsgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgd2VhcG9uID0gZW50aXR5LmdldF9wbGF5ZXJfd2VhcG9uKGxwKQogICAgICAgICAgICBpZiB3ZWFwb24gPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIHdwbl9pbmZvID0gY3Nnb193ZWFwb25zKHdlYXBvbikKICAgICAgICAgICAgaWYgd3BuX2luZm8gPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIHdwbl9pbmZvLmlzX3Jldm9sdmVyIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIG5vdCBvbl9wZWVrIHRoZW4KICAgICAgICAgICAgICAgIGNtZC5mb3JjZV9kZWZlbnNpdmUgPSB0cnVlCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgZnJlZXN0YW5kaW5nID0geWF3X2RpcmVjdGlvbi5pc19mcmVlc3RhbmRpbmcKICAgICAgICAgICAgbG9jYWwgbWFudWFsX3lhdyA9IG1hbnVhbF9kaXJlY3Rpb24uZ2V0KCkKICAgICAgICAgICAgbG9jYWwgc2hvdWxkX2ZsaWNrID0gbHBfc3RhdGUgPT0gJ0Nyb3VjaGVkJyBhbmQgbWFudWFsX2RpcmVjdGlvbi5vcHRpb25zOmhhdmVfa2V5KCdEdWNrIEV4cGxvaXQnKQogICAgICAgICAgICBsb2NhbCBzaG91bGRfaWdub3JlID0gZnJlZXN0YW5kaW5nIG9yIChtYW51YWxfeWF3IH49IG5pbCBhbmQgbm90IHNob3VsZF9mbGljaykKCiAgICAgICAgICAgIGlmIHNob3VsZF9mbGljayB0aGVuCiAgICAgICAgICAgICAgICBjdHguYm9keV95YXcgPSAnU3RhdGljJwogICAgICAgICAgICAgICAgY3R4LmJvZHlfeWF3X29mZnNldCA9IDE4MAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIHBpdGNoX3ZhbHVlLCBwaXRjaF9tb2RlID0gMCwgJ0RlZmF1bHQnCiAgICAgICAgICAgIGRvCiAgICAgICAgICAgICAgICBsb2NhbCB2YWwgPSBkZWZlbnNpdmUucGl0Y2g6Z2V0KCkKICAgICAgICAgICAgICAgIGlmIHZhbCA9PSAnWmVybycgdGhlbgogICAgICAgICAgICAgICAgICAgIHBpdGNoX3ZhbHVlLCBwaXRjaF9tb2RlID0gMCwgJ0N1c3RvbScKICAgICAgICAgICAgICAgIGVsc2VpZiB2YWwgPT0gJ1VwJyB0aGVuCiAgICAgICAgICAgICAgICAgICAgcGl0Y2hfdmFsdWUsIHBpdGNoX21vZGUgPSAwLCAnVXAnCiAgICAgICAgICAgICAgICBlbHNlaWYgdmFsID09ICdVcCBTd2l0Y2gnIHRoZW4KICAgICAgICAgICAgICAgICAgICBwaXRjaF92YWx1ZSwgcGl0Y2hfbW9kZSA9IGNsaWVudC5yYW5kb21fZmxvYXQoNDUsIDYwKSAqIC0xLCAnQ3VzdG9tJwogICAgICAgICAgICAgICAgZWxzZWlmIHZhbCA9PSAnRG93biBTd2l0Y2gnIHRoZW4KICAgICAgICAgICAgICAgICAgICBwaXRjaF92YWx1ZSwgcGl0Y2hfbW9kZSA9IGNsaWVudC5yYW5kb21fZmxvYXQoNDUsIDYwKSwgJ0N1c3RvbScKICAgICAgICAgICAgICAgIGVsc2VpZiB2YWwgPT0gJ1JhbmRvbScgdGhlbgogICAgICAgICAgICAgICAgICAgIHBpdGNoX3ZhbHVlLCBwaXRjaF9tb2RlID0gY2xpZW50LnJhbmRvbV9mbG9hdCgtODksIDg5KSwgJ0N1c3RvbScKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIG1hbnVhbF95YXcgfj0gbmlsIGFuZCBzaG91bGRfZmxpY2sgdGhlbgogICAgICAgICAgICAgICAgICAgIHBpdGNoX3ZhbHVlLCBwaXRjaF9tb2RlID0gY2xpZW50LnJhbmRvbV9mbG9hdCgtNSwgMTApLCAnQ3VzdG9tJwogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgeWF3X3ZhbHVlLCB5YXdfbW9kZSA9IDAsICcxODAnCiAgICAgICAgICAgIGRvCiAgICAgICAgICAgICAgICBsb2NhbCB2YWwgPSBkZWZlbnNpdmUueWF3OmdldCgpCiAgICAgICAgICAgICAgICBpZiB2YWwgPT0gJ1NpZGV3YXlzJyB0aGVuCiAgICAgICAgICAgICAgICAgICAgeWF3X3ZhbHVlID0gbG9jYWxwbGF5ZXIuY2hva2luZyAqIDkwICsgY2xpZW50LnJhbmRvbV9mbG9hdCgtMzAsIDMwKQogICAgICAgICAgICAgICAgZWxzZWlmIHZhbCA9PSAnRm9yd2FyZCcgdGhlbgogICAgICAgICAgICAgICAgICAgIHlhd192YWx1ZSA9IGxvY2FscGxheWVyLmNob2tpbmcgKiAxODAgKyBjbGllbnQucmFuZG9tX2Zsb2F0KC0zMCwgMzApCiAgICAgICAgICAgICAgICBlbHNlaWYgdmFsID09ICdTcGluYm90JyB0aGVuCiAgICAgICAgICAgICAgICAgICAgeWF3X3ZhbHVlID0gLTE4MCArIChnbG9iYWxzLnRpY2tjb3VudCgpICUgOSkgKiA0MCArIGNsaWVudC5yYW5kb21fZmxvYXQoLTMwLCAzMCkKICAgICAgICAgICAgICAgIGVsc2VpZiB2YWwgPT0gJzMtV2F5JyB0aGVuCiAgICAgICAgICAgICAgICAgICAgeWF3X3ZhbHVlID0gZGVmZW5zaXZlXzNfd2F5W2xvY2FscGxheWVyLnBhY2tldHMgJSA1ICsgMV0gKyBjbGllbnQucmFuZG9tX2Zsb2F0KC0xNSwgMTUpCiAgICAgICAgICAgICAgICBlbHNlaWYgdmFsID09ICc1LVdheScgdGhlbgogICAgICAgICAgICAgICAgICAgIHlhd192YWx1ZSA9IGRlZmVuc2l2ZV81X3dheVtsb2NhbHBsYXllci5wYWNrZXRzICUgNSArIDFdICsgY2xpZW50LnJhbmRvbV9mbG9hdCgtMTUsIDE1KQogICAgICAgICAgICAgICAgZWxzZWlmIHZhbCA9PSAnUmFuZG9tJyB0aGVuCiAgICAgICAgICAgICAgICAgICAgeWF3X3ZhbHVlID0gdXRpbHMubm9ybWFsaXplKG1hdGgucmFuZG9tKC0xODAsIDE4MCksIC0xODAsIDE4MCkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIG1hbnVhbF95YXcgfj0gbmlsIGFuZCBzaG91bGRfZmxpY2sgdGhlbgogICAgICAgICAgICAgICAgICAgIHlhd192YWx1ZSA9IG1hbnVhbF9iZWJyYVsgbWFudWFsX3lhdyBdICsgY2xpZW50LnJhbmRvbV9mbG9hdCgwLCAxMCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIC0tIGNsaWVudC5jb2xvcl9sb2coMjU1LCAyNTUsIDI1NSwgZignXG5EZWZlbnNpdmU6ICVzXG5TaG91bGQgSWdub3JlOiAlc1xuQXZvaWQgQmFja3N0YWI6ICVzXG5Gb3JjZSBEZWZlbnNpdmU6ICVzXG5GcmVlc3RhbmRpbmc6ICVzJywgZ2xvYmFscy50aWNrY291bnQoKSA+IGRvdWJsZV90YXAuZGVmZW5zaXZlX3RrIC0gMiwgc2hvdWxkX2lnbm9yZSwgYXZvaWRfYmFja3N0YWIuZ2V0KCksIGNtZC5mb3JjZV9kZWZlbnNpdmUsIHNvZnR3YXJlLmlzX2ZyZWVzdGFuZGluZygpKSkKCiAgICAgICAgICAgIGlmIGdsb2JhbHMudGlja2NvdW50KCkgPiBkb3VibGVfdGFwLmRlZmVuc2l2ZV90ayAtIDIgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgYXZvaWRfYmFja3N0YWIuZ2V0KCkgb3Igc2hvdWxkX2lnbm9yZSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBjdHgucGl0Y2ggPSBwaXRjaF9tb2RlCiAgICAgICAgICAgIGN0eC5waXRjaF9vZmZzZXQgPSBwaXRjaF92YWx1ZQogICAgICAgICAgICBjdHgueWF3ID0geWF3X21vZGUKICAgICAgICAgICAgY3R4Lnlhd19vZmZzZXQgPSB5YXdfdmFsdWUKICAgICAgICBlbmQKICAgIGVuZAoKICAgIC0tLXJlZ2lvbiBkaXNhYmxlIG9uIHdhcm11cAogICAgZG8KCiAgICAgICAgZnVuY3Rpb24gZGlzYWJsZXJzLmNvdW50X2FsaXZlKCkKICAgICAgICAgICAgbG9jYWwgYWxpdmUgPSAwCgogICAgICAgICAgICBmb3IgaSA9IDEsIGdsb2JhbHMubWF4cGxheWVycygpIGRvCiAgICAgICAgICAgICAgICBpZiBlbnRpdHkuZ2V0X2NsYXNzbmFtZShpKSB+PSAnQ0NTUGxheWVyJyB0aGVuCiAgICAgICAgICAgICAgICAgICAgZ290byBza2lwCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiBub3QgZW50aXR5LmlzX2FsaXZlKGkpIG9yIG5vdCBlbnRpdHkuaXNfZW5lbXkoaSkgdGhlbgogICAgICAgICAgICAgICAgICAgIGdvdG8gc2tpcAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgYWxpdmUgPSBhbGl2ZSArIDEKICAgICAgICAgICAgICAgIDo6c2tpcDo6CiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuIGFsaXZlCiAgICAgICAgZW5kCgoKICAgICAgICBmdW5jdGlvbiBkaXNhYmxlcnMudXBkYXRlKGNtZCwgY3R4KQogICAgICAgICAgICBsb2NhbCBscCA9IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkKICAgICAgICAgICAgaWYgbHAgPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIG5vdCBhYV90d2Vha3MuZW5hYmxlOmdldCgpIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIGdhbWVfcnVsZXMgPSBlbnRpdHkuZ2V0X2dhbWVfcnVsZXMoKQogICAgICAgICAgICBpZiBnYW1lX3J1bGVzID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBzaG91bGRfZGlzYWJsZSA9IGZhbHNlCgogICAgICAgICAgICBpZiBhYV90d2Vha3MuaXRlbXM6aGF2ZV9rZXkoJ0Rpc2FibGUgb24gV2FybXVwJykgYW5kIGVudGl0eS5nZXRfcHJvcChnYW1lX3J1bGVzLCAnbV9iV2FybXVwUGVyaW9kJykgPT0gMSB0aGVuCiAgICAgICAgICAgICAgICBzaG91bGRfZGlzYWJsZSA9IHRydWUKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBwbGF5ZXJzID0gZGlzYWJsZXJzLmNvdW50X2FsaXZlKCkKCiAgICAgICAgICAgIGlmIGFhX3R3ZWFrcy5pdGVtczpoYXZlX2tleSgnRGlzYWJsZSBXaGlsZSBObyBFbmVtaWVzJykgYW5kIHBsYXllcnMgPT0gMCBhbmQgY21kLmluX3VzZSB+PSAxIHRoZW4KICAgICAgICAgICAgICAgIHNob3VsZF9kaXNhYmxlID0gdHJ1ZQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIG5vdCBzaG91bGRfZGlzYWJsZSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBjdHguZW5hYmxlZCA9IGZhbHNlCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgLS0tIHJlZ2lvbiBhdm9pZF9iYWNrc3RhYgogICAgZG8KICAgICAgICBsb2NhbCBpc19hY3RpdmUgPSBmYWxzZQogICAgICAgIGxvY2FsIEFWT0lEX0JBQ0tTVEFCX01BWF9ESVNUQU5DRV9TUVIgPSAyMjAgKiAyMjAKCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gZ2V0X2VuZW1pZXNfd2l0aF9rbmlmZSgpCiAgICAgICAgICAgIGxvY2FsIGVuZW1pZXMgPSBlbnRpdHkuZ2V0X3BsYXllcnModHJ1ZSkKICAgICAgICAgICAgaWYgbmV4dChlbmVtaWVzKSA9PSBuaWwgdGhlbiByZXR1cm4geyB9IGVuZAoKICAgICAgICAgICAgbG9jYWwgbGlzdCA9IHsgfQoKICAgICAgICAgICAgZm9yIGkgPSAxLCAjZW5lbWllcyBkbwogICAgICAgICAgICAgICAgbG9jYWwgZW5lbXkgPSBlbmVtaWVzW2ldCiAgICAgICAgICAgICAgICBsb2NhbCB3cG4gPSBlbnRpdHkuZ2V0X3BsYXllcl93ZWFwb24oZW5lbXkpCgogICAgICAgICAgICAgICAgaWYgd3BuID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgZ290byBjb250aW51ZQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgbG9jYWwgd3BuX2NsYXNzID0gZW50aXR5LmdldF9jbGFzc25hbWUod3BuKQoKICAgICAgICAgICAgICAgIGlmIHdwbl9jbGFzcyA9PSAiQ0tuaWZlIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgbGlzdFsjbGlzdCArIDFdID0gZW5lbXkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIDo6Y29udGludWU6OgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiBsaXN0CiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIGZ1bmN0aW9uIGdldF9jbG9zZXN0X3RhcmdldChtZSkKICAgICAgICAgICAgbG9jYWwgdGFyZ2V0cyA9IGdldF9lbmVtaWVzX3dpdGhfa25pZmUoKQogICAgICAgICAgICBpZiBuZXh0KHRhcmdldHMpID09IG5pbCB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgICAgIGxvY2FsIGJlc3RfZGVsdGEKICAgICAgICAgICAgbG9jYWwgYmVzdF90YXJnZXQKCiAgICAgICAgICAgIGxvY2FsIG15X29yaWdpbiA9IHZlY3RvcihlbnRpdHkuZ2V0X29yaWdpbihtZSkpCiAgICAgICAgICAgIGxvY2FsIGJlc3RfZGlzdGFuY2UgPSBBVk9JRF9CQUNLU1RBQl9NQVhfRElTVEFOQ0VfU1FSCgogICAgICAgICAgICBmb3IgaSA9IDEsICN0YXJnZXRzIGRvCiAgICAgICAgICAgICAgICBsb2NhbCB0YXJnZXQgPSB0YXJnZXRzW2ldCgogICAgICAgICAgICAgICAgbG9jYWwgb3JpZ2luID0gdmVjdG9yKGVudGl0eS5nZXRfb3JpZ2luKHRhcmdldCkpCiAgICAgICAgICAgICAgICBsb2NhbCBkZWx0YSA9IG9yaWdpbiAtIG15X29yaWdpbgoKICAgICAgICAgICAgICAgIGxvY2FsIGRpc3RhbmNlID0gZGVsdGE6bGVuZ3Roc3FyKCkKCiAgICAgICAgICAgICAgICBpZiBkaXN0YW5jZSA8IGJlc3RfZGlzdGFuY2UgdGhlbgogICAgICAgICAgICAgICAgICAgIGJlc3RfZGVsdGEgPSBkZWx0YQogICAgICAgICAgICAgICAgICAgIGJlc3RfdGFyZ2V0ID0gdGFyZ2V0CgogICAgICAgICAgICAgICAgICAgIGJlc3RfZGlzdGFuY2UgPSBkaXN0YW5jZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuIGJlc3RfdGFyZ2V0LCBiZXN0X2RlbHRhCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIGF2b2lkX2JhY2tzdGFiLmdldCgpCiAgICAgICAgICAgIHJldHVybiBpc19hY3RpdmUKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gYXZvaWRfYmFja3N0YWIudXBkYXRlKGN0eCkKICAgICAgICAgICAgaXNfYWN0aXZlID0gZmFsc2UKICAgICAgICAgICAgaWYgbm90IGFhX3R3ZWFrcy5lbmFibGU6Z2V0KCkgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgbm90IGFhX3R3ZWFrcy5pdGVtczpoYXZlX2tleSgnQXZvaWQgQmFja3N0YWInKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBtZSA9IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkKICAgICAgICAgICAgbG9jYWwgdGFyZ2V0LCBkZWx0YSA9IGdldF9jbG9zZXN0X3RhcmdldChtZSkKCiAgICAgICAgICAgIGlmIHRhcmdldCA9PSBuaWwgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgIGlmIGRlbHRhID09IG5pbCB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgICAgIGxvY2FsIHZpZXcgPSB2ZWN0b3IoY2xpZW50LmNhbWVyYV9hbmdsZXMoKSkKICAgICAgICAgICAgbG9jYWwgYW5nbGUgPSB2ZWN0b3IoZGVsdGE6YW5nbGVzKCkpCgogICAgICAgICAgICBsb2NhbCB5YXcgPSBhbmdsZS55IC0gdmlldy55ICsgMTgwCgogICAgICAgICAgICBpZiBjdHgueWF3X29mZnNldCA9PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgY3R4Lnlhd19vZmZzZXQgPSAwCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgY3R4Lnlhd19iYXNlID0gIkxvY2FsIHZpZXciCiAgICAgICAgICAgIGN0eC55YXdfb2Zmc2V0ID0gY3R4Lnlhd19vZmZzZXQgKyB5YXcKCiAgICAgICAgICAgIGN0eC5lZGdlX3lhdyA9IGZhbHNlCiAgICAgICAgICAgIGN0eC5mcmVlc3RhbmRpbmcgPSBmYWxzZQogICAgICAgICAgICBpc19hY3RpdmUgPSB0cnVlCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICAtLS0gcmVnaW9uIHNhZmVfaGVhZAogICAgZG8KICAgICAgICBsb2NhbCBpc19hY3RpdmUgPSBmYWxzZQoKICAgICAgICBsb2NhbCBwcmVzZXRzID0gewogICAgICAgICAgICBbIlN0YW5kaW5nIl0gPSB7CiAgICAgICAgICAgICAgICBbMl0gPSBmdW5jdGlvbihlLCBjdHgsIG1lKQogICAgICAgICAgICAgICAgICAgIGN0eC55YXdfb2Zmc2V0ID0gLTYKCiAgICAgICAgICAgICAgICAgICAgY3R4LmJvZHlfeWF3ID0gIlN0YXRpYyIKICAgICAgICAgICAgICAgICAgICBjdHguYm9keV95YXdfb2Zmc2V0ID0gMAogICAgICAgICAgICAgICAgZW5kLAoKICAgICAgICAgICAgICAgIFszXSA9IGZ1bmN0aW9uKGUsIGN0eCwgbWUpCiAgICAgICAgICAgICAgICAgICAgY3R4Lnlhd19vZmZzZXQgPSA4CgogICAgICAgICAgICAgICAgICAgIGN0eC5ib2R5X3lhdyA9ICJTdGF0aWMiCiAgICAgICAgICAgICAgICAgICAgY3R4LmJvZHlfeWF3X29mZnNldCA9IDAKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICB9LAoKICAgICAgICAgICAgWyJDcm91Y2hlZCJdID0gewogICAgICAgICAgICAgICAgWzJdID0gZnVuY3Rpb24oZSwgY3R4LCBtZSkKICAgICAgICAgICAgICAgICAgICBjdHgueWF3X29mZnNldCA9IDAKCiAgICAgICAgICAgICAgICAgICAgY3R4LmJvZHlfeWF3ID0gIlN0YXRpYyIKICAgICAgICAgICAgICAgICAgICBjdHguYm9keV95YXdfb2Zmc2V0ID0gMAogICAgICAgICAgICAgICAgZW5kLAoKICAgICAgICAgICAgICAgIFszXSA9IGZ1bmN0aW9uKGUsIGN0eCwgbWUpCiAgICAgICAgICAgICAgICAgICAgY3R4Lnlhd19vZmZzZXQgPSA0MAoKICAgICAgICAgICAgICAgICAgICBjdHguYm9keV95YXcgPSAiU3RhdGljIgogICAgICAgICAgICAgICAgICAgIGN0eC5ib2R5X3lhd19vZmZzZXQgPSAxODAKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICB9LAoKICAgICAgICAgICAgWyJDcm91Y2hlZCBBaXIiXSA9IHsKICAgICAgICAgICAgICAgIFsyXSA9IGZ1bmN0aW9uKGUsIGN0eCwgbWUpCiAgICAgICAgICAgICAgICAgICAgY3R4Lnlhd19vZmZzZXQgPSAwCgogICAgICAgICAgICAgICAgICAgIGN0eC5ib2R5X3lhdyA9ICJTdGF0aWMiCiAgICAgICAgICAgICAgICAgICAgY3R4LmJvZHlfeWF3X29mZnNldCA9IC0xMjAKICAgICAgICAgICAgICAgIGVuZCwKCiAgICAgICAgICAgICAgICBbM10gPSBmdW5jdGlvbihlLCBjdHgsIG1lKQogICAgICAgICAgICAgICAgICAgIGN0eC55YXdfb2Zmc2V0ID0gMAoKICAgICAgICAgICAgICAgICAgICBjdHguYm9keV95YXcgPSAiU3RhdGljIgogICAgICAgICAgICAgICAgICAgIGN0eC5ib2R5X3lhd19vZmZzZXQgPSAxMjAKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICB9LAoKICAgICAgICAgICAgWyJBaXIgS25pZmUiXSA9IHsKICAgICAgICAgICAgICAgIFsyXSA9IGZ1bmN0aW9uKGUsIGN0eCwgbWUpCiAgICAgICAgICAgICAgICAgICAgY3R4Lnlhd19vZmZzZXQgPSA0NQoKICAgICAgICAgICAgICAgICAgICBjdHguYm9keV95YXcgPSAiU3RhdGljIgogICAgICAgICAgICAgICAgICAgIGN0eC5ib2R5X3lhd19vZmZzZXQgPSAxODAKICAgICAgICAgICAgICAgIGVuZCwKCiAgICAgICAgICAgICAgICBbM10gPSBmdW5jdGlvbihlLCBjdHgsIG1lKQogICAgICAgICAgICAgICAgICAgIGN0eC55YXdfb2Zmc2V0ID0gMzUKCiAgICAgICAgICAgICAgICAgICAgY3R4LmJvZHlfeWF3ID0gIlN0YXRpYyIKICAgICAgICAgICAgICAgICAgICBjdHguYm9keV95YXdfb2Zmc2V0ID0gMTgwCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIFsiQWlyIFpldXMiXSA9IHsKICAgICAgICAgICAgICAgIFsyXSA9IGZ1bmN0aW9uKGUsIGN0eCwgbWUpCiAgICAgICAgICAgICAgICAgICAgY3R4Lnlhd19vZmZzZXQgPSAyMwoKICAgICAgICAgICAgICAgICAgICBjdHguYm9keV95YXcgPSAiU3RhdGljIgogICAgICAgICAgICAgICAgICAgIGN0eC5ib2R5X3lhd19vZmZzZXQgPSAwCiAgICAgICAgICAgICAgICBlbmQsCgogICAgICAgICAgICAgICAgWzNdID0gZnVuY3Rpb24oZSwgY3R4LCBtZSkKICAgICAgICAgICAgICAgICAgICBjdHgueWF3X29mZnNldCA9IDEwCgogICAgICAgICAgICAgICAgICAgIGN0eC5ib2R5X3lhdyA9ICJTdGF0aWMiCiAgICAgICAgICAgICAgICAgICAgY3R4LmJvZHlfeWF3X29mZnNldCA9IDAKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBsb2NhbCBzdl9ncmF2aXR5ID0gY3Zhci5zdl9ncmF2aXR5CiAgICAgICAgbG9jYWwgZnVuY3Rpb24gZXh0cmFwb2xhdGVfZW50aXR5KGVudCwgcG9zKQogICAgICAgICAgICBsb2NhbCB0aWNrX2ludGVydmFsID0gZ2xvYmFscy50aWNraW50ZXJ2YWwoKQoKICAgICAgICAgICAgbG9jYWwgdmVsb2NpdHkgPSB2ZWN0b3IoZW50aXR5LmdldF9wcm9wKGVudCwgIm1fdmVjVmVsb2NpdHkiKSkKICAgICAgICAgICAgbG9jYWwgbmV3X3BvcyA9IHBvczpjbG9uZSgpCgogICAgICAgICAgICBsb2NhbCB0aWNrcyA9IDI1CiAgICAgICAgICAgIGlmICN2ZWxvY2l0eSA8IDMyIHRoZW4KICAgICAgICAgICAgICAgIHRpY2tzID0gNDAKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBuZXdfcG9zLnggPSBuZXdfcG9zLnggKyB2ZWxvY2l0eS54ICogdGlja19pbnRlcnZhbCAqIHRpY2tzCiAgICAgICAgICAgIG5ld19wb3MueSA9IG5ld19wb3MueSArIHZlbG9jaXR5LnkgKiB0aWNrX2ludGVydmFsICogdGlja3MKCiAgICAgICAgICAgIGlmIGVudGl0eS5nZXRfcHJvcChlbnQsICJtX2hHcm91bmRFbnRpdHkiKSA9PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgbmV3X3Bvcy56ID0gbmV3X3Bvcy56ICsgdmVsb2NpdHkueiAqIHRpY2tfaW50ZXJ2YWwgKiB0aWNrcyAtIHN2X2dyYXZpdHk6Z2V0X2Zsb2F0KCkgKiB0aWNrX2ludGVydmFsCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuIG5ld19wb3MKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gZ2V0X3N0YXRlbWVudChtZSkKICAgICAgICAgICAgaWYgbG9jYWxwbGF5ZXIuaXNfYWlyYm9ybmUgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgd3BuID0gZW50aXR5LmdldF9wbGF5ZXJfd2VhcG9uKG1lKQogICAgICAgICAgICAgICAgaWYgd3BuID09IG5pbCB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgICAgICAgICBsb2NhbCBjbGFzc25hbWUgPSBlbnRpdHkuZ2V0X2NsYXNzbmFtZSh3cG4pCgogICAgICAgICAgICAgICAgaWYgY2xhc3NuYW1lID09ICJDS25pZmUiIHRoZW4KICAgICAgICAgICAgICAgICAgICByZXR1cm4gIkFpciBLbmlmZSIKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIGNsYXNzbmFtZSA9PSAiQ1dlYXBvblRhc2VyIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJBaXIgWmV1cyIKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIGxvY2FscGxheWVyLmR1Y2tfYW1vdW50ID09IDEuMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJDcm91Y2hlZCBBaXIiCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICByZXR1cm4gbmlsCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgbG9jYWxwbGF5ZXIuaXNfY3JvdWNoZWQgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuICJDcm91Y2hlZCIKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBub3QgbG9jYWxwbGF5ZXIuaXNfbW92aW5nIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiAiU3RhbmRpbmciCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuIG5pbAogICAgICAgIGVuZAoKICAgICAgICBzYWZlX2hlYWQuZW5hYmxlZCA9IG1lbnUubmV3X2l0ZW0odWkubmV3X2NoZWNrYm94LCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIlNhZmUgSGVhZCIpCiAgICAgICAgOiByZWNvcmQoImFhIiwgInNhZmVfaGVhZDo6ZW5hYmxlZCIpCiAgICAgICAgOiBzYXZlKCkKCiAgICAgICAgc2FmZV9oZWFkLnN0YXRlcyA9IG1lbnUubmV3X2l0ZW0odWkubmV3X211bHRpc2VsZWN0LCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgbWVyZ2UgeyAiLSBTdGF0ZXMiLCAiXG4iLCAic2FmZV9oZWFkOjpzdGF0ZXMiIH0sIHsgIkFpciBLbmlmZSIsICJBaXIgWmV1cyIsICJTdGFuZGluZyIsICJDcm91Y2hlZCIsICJDcm91Y2hlZCBBaXIiIH0pCiAgICAgICAgOiByZWNvcmQoImFhIiwgInNhZmVfaGVhZDo6c3RhdGVzIikKICAgICAgICA6IHNhdmUoKQoKICAgICAgICBmdW5jdGlvbiBzYWZlX2hlYWQuZ2V0KCkKICAgICAgICAgICAgcmV0dXJuIGlzX2FjdGl2ZQogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBzYWZlX2hlYWQudXBkYXRlKGUsIGN0eCkKICAgICAgICAgICAgaXNfYWN0aXZlID0gZmFsc2UKCiAgICAgICAgICAgIGlmIG5vdCBzYWZlX2hlYWQuZW5hYmxlZDpnZXQoKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBtZSA9IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkKCiAgICAgICAgICAgIGlmIG1hbnVhbF9kaXJlY3Rpb24uZ2V0KCkgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgdGVhbSA9IGVudGl0eS5nZXRfcHJvcChtZSwgIm1faVRlYW1OdW0iKQogICAgICAgICAgICBpZiB0ZWFtID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCB3cG4gPSBlbnRpdHkuZ2V0X3BsYXllcl93ZWFwb24obWUpCiAgICAgICAgICAgIGlmIHdwbiA9PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgdGhyZWF0ID0gY2xpZW50LmN1cnJlbnRfdGhyZWF0KCkKICAgICAgICAgICAgaWYgdGhyZWF0ID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBzdGF0ZW1lbnQgPSBnZXRfc3RhdGVtZW50KG1lKQogICAgICAgICAgICBpZiBzdGF0ZW1lbnQgPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIG5vdCBzYWZlX2hlYWQuc3RhdGVzOmhhdmVfa2V5KHN0YXRlbWVudCkgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgc2hvdWxkX2NvbnRpbnVlID0gZmFsc2UKICAgICAgICAgICAgaWYgc3RhdGVtZW50ID09ICJBaXIgWmV1cyIgb3Igc3RhdGVtZW50ID09ICJBaXIgS25pZmUiIHRoZW4KICAgICAgICAgICAgICAgIHNob3VsZF9jb250aW51ZSA9IHRydWUKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgbG9jYWwgZXllX3BvcyA9IGV4dHJhcG9sYXRlX2VudGl0eSh0aHJlYXQsIHZlY3Rvcih1dGlscy5nZXRfZXllX3Bvc2l0aW9uKHRocmVhdCkpKQogICAgICAgICAgICAgICAgbG9jYWwgaGVhZF9wb3MgPSB2ZWN0b3IoZW50aXR5LmhpdGJveF9wb3NpdGlvbihtZSwgMCkpCgogICAgICAgICAgICAgICAgZXllX3Bvcy56ID0gZXllX3Bvcy56ICsgNQoKICAgICAgICAgICAgICAgIGlmIGhlYWRfcG9zLnogPiBleWVfcG9zLnogdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGVudGluZGV4LCBkYW1hZ2UgPSBjbGllbnQudHJhY2VfYnVsbGV0KHRocmVhdCwgZXllX3Bvcy54LCBleWVfcG9zLnksIGV5ZV9wb3MueiwgaGVhZF9wb3MueCwgaGVhZF9wb3MueSwgaGVhZF9wb3MueiArIDYsIHRocmVhdCkKCiAgICAgICAgICAgICAgICAgICAgc2hvdWxkX2NvbnRpbnVlID0gZGFtYWdlID4gMAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgbm90IHNob3VsZF9jb250aW51ZSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBwcmVzZXQgPSBwcmVzZXRzW3N0YXRlbWVudF0KICAgICAgICAgICAgaWYgcHJlc2V0ID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBmbiA9IHByZXNldFt0ZWFtXQogICAgICAgICAgICBpZiBmbiA9PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgY3R4LnBpdGNoID0gIkRlZmF1bHQiCiAgICAgICAgICAgIGN0eC55YXdfYmFzZSA9ICJBdCB0YXJnZXRzIgoKICAgICAgICAgICAgY3R4LnlhdyA9ICIxODAiCiAgICAgICAgICAgIGN0eC55YXdfb2Zmc2V0ID0gMjIKCiAgICAgICAgICAgIGN0eC55YXdfaml0dGVyID0gIk9mZiIKCiAgICAgICAgICAgIGN0eC5ib2R5X3lhdyA9ICJTdGF0aWMiCiAgICAgICAgICAgIGN0eC5ib2R5X3lhd19vZmZzZXQgPSAxMjAKCiAgICAgICAgICAgIGN0eC5mcmVlc3RhbmRpbmdfYm9keV95YXcgPSBmYWxzZQoKICAgICAgICAgICAgZm4oZSwgY3R4LCBtZSkKCiAgICAgICAgICAgIGlzX2FjdGl2ZSA9IHRydWUKICAgICAgICBlbmQKICAgIGVuZAoKICAgIC0tLSByZWdpb24gbWFudWFsX3lhdwogICAgZG8KICAgICAgICBsb2NhbCBMRUZUICAgID0gMAogICAgICAgIGxvY2FsIFJJR0hUICAgPSAxCiAgICAgICAgbG9jYWwgRk9SV0FSRCA9IDIKCiAgICAgICAgbG9jYWwgaWR4CiAgICAgICAgbG9jYWwgZGF0YSA9IHsgfQoKICAgICAgICBsb2NhbCBkaXJlY3Rpb25zID0gewogICAgICAgICAgICBbTEVGVF0gICAgPSAtOTAsCiAgICAgICAgICAgIFtSSUdIVF0gICA9IDkwLAogICAgICAgICAgICBbRk9SV0FSRF0gPSAxODAKICAgICAgICB9CgogICAgICAgIGxvY2FsIGZ1bmN0aW9uIGdldF92YWx1ZShyZWYpCiAgICAgICAgICAgIGxvY2FsIHByZXZfYWN0aXZlID0gZGF0YVtyZWZdCiAgICAgICAgICAgIGxvY2FsIGFjdGl2ZSwgbW9kZSwga2V5ID0gdWkuZ2V0KHJlZikKCiAgICAgICAgICAgIGlmIHByZXZfYWN0aXZlID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICBkYXRhW3JlZl0gPSBhY3RpdmUKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIG1vZGUgPT0gMCB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgaWYgbW9kZSA9PSAzIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICBpZiBrZXkgPT0gbmlsIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICAgICAgaWYgcHJldl9hY3RpdmUgfj0gYWN0aXZlIHRoZW4KICAgICAgICAgICAgICAgIGRhdGFbcmVmXSA9IGFjdGl2ZQogICAgICAgICAgICAgICAgcmV0dXJuIGFjdGl2ZSwgbW9kZSwga2V5CiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBmdW5jdGlvbiB1cGRhdGVfaG90a2V5KHJlZiwgdmFsdWUpCiAgICAgICAgICAgIGxvY2FsIGFjdGl2ZSwgbW9kZSA9IGdldF92YWx1ZShyZWYpCiAgICAgICAgICAgIGlmIGFjdGl2ZSA9PSBuaWwgdGhlbiByZXR1cm4gZW5kCgogICAgICAgICAgICBpZiBtb2RlID09IDEgdGhlbgogICAgICAgICAgICAgICAgaWYgbm90IGFjdGl2ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWR4ID0gbmlsCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZHggPSB2YWx1ZQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgbW9kZSA9PSAyIHRoZW4KICAgICAgICAgICAgICAgIGlmIGlkeCA9PSB2YWx1ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWR4ID0gbmlsCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZHggPSB2YWx1ZQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBmdW5jdGlvbiB0aGluaygpCiAgICAgICAgICAgIGlmIGdldF92YWx1ZShtYW51YWxfZGlyZWN0aW9uLmRpc2FibGVkX21hbnVhbC5yZWYpIH49IG5pbCB0aGVuCiAgICAgICAgICAgICAgICBpZHggPSBuaWwKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHVwZGF0ZV9ob3RrZXkobWFudWFsX2RpcmVjdGlvbi5sZWZ0X21hbnVhbC5yZWYsIExFRlQpCiAgICAgICAgICAgIHVwZGF0ZV9ob3RrZXkobWFudWFsX2RpcmVjdGlvbi5yaWdodF9tYW51YWwucmVmLCBSSUdIVCkKICAgICAgICAgICAgdXBkYXRlX2hvdGtleShtYW51YWxfZGlyZWN0aW9uLmZvcndhcmRfbWFudWFsLnJlZiwgRk9SV0FSRCkKICAgICAgICBlbmQKCiAgICAgICAgbWFudWFsX2RpcmVjdGlvbi5lbmFibGVkID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfY2hlY2tib3gsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiTWFudWFsIFlhdyIpCiAgICAgICAgOiByZWNvcmQoImFhIiwgIm1hbnVhbF9kaXJlY3Rpb246OmVuYWJsZWQiKQoKICAgICAgICBtYW51YWxfZGlyZWN0aW9uLmFycm93cyA9IG1lbnUubmV3X2l0ZW0odWkubmV3X2NoZWNrYm94LCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIk1hbnVhbCBBcnJvd3MiKQogICAgICAgIDogcmVjb3JkKCJhYSIsICJtYW51YWxfZGlyZWN0aW9uOjphcnJvd3MiKQogICAgICAgIDogc2F2ZSgpCgogICAgICAgIG1hbnVhbF9kaXJlY3Rpb24uY29sb3IgPSBtZW51Lm5ld19pdGVtKHVpLm5ld19jb2xvcl9waWNrZXIsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiTWFudWFsIENvbG9yIikKICAgICAgICA6IHJlY29yZCgiYWEiLCAibWFudWFsX2RpcmVjdGlvbjo6Y29sb3IiKQogICAgICAgIDogc2F2ZSgpCgogICAgICAgIG1hbnVhbF9kaXJlY3Rpb24ub3B0aW9ucyA9IG1lbnUubmV3X2l0ZW0odWkubmV3X211bHRpc2VsZWN0LCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgbWVyZ2UgeyAiLSBPcHRpb25zIiwgIlxuIiwgIm1hbnVhbF9kaXJlY3Rpb246Om9wdGlvbnMiIH0sIHsKICAgICAgICAgICAgIkRpc2FibGUgWWF3IE1vZGlmaWVycyIsCiAgICAgICAgICAgICJGcmVlc3RhbmRpbmcgQm9keSBZYXciLAogICAgICAgICAgICAnRHVjayBFeHBsb2l0JwogICAgICAgIH0pCiAgICAgICAgOiByZWNvcmQoImFhIiwgIm1hbnVhbF9kaXJlY3Rpb246Om9wdGlvbnMiKQogICAgICAgIDogc2F2ZSgpCgogICAgICAgIG1hbnVhbF9kaXJlY3Rpb24ubGVmdF9tYW51YWwgPSBtZW51Lm5ld19pdGVtKHVpLm5ld19ob3RrZXksICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCBtZXJnZSB7ICItIExlZnQgTWFudWFsIiwgIlxuIiwgIm1hbnVhbF9kaXJlY3Rpb246OmxlZnRfbWFudWFsIiB9KQogICAgICAgIDogcmVjb3JkKCJhYSIsICJtYW51YWxfZGlyZWN0aW9uOjpsZWZ0X21hbnVhbCIpCgogICAgICAgIG1hbnVhbF9kaXJlY3Rpb24ucmlnaHRfbWFudWFsID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfaG90a2V5LCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgbWVyZ2UgeyAiLSBSaWdodCBNYW51YWwiLCAiXG4iLCAibWFudWFsX2RpcmVjdGlvbjo6cmlnaHRfbWFudWFsIiB9KQogICAgICAgIDogcmVjb3JkKCJhYSIsICJtYW51YWxfZGlyZWN0aW9uOjpyaWdodF9tYW51YWwiKQoKICAgICAgICBtYW51YWxfZGlyZWN0aW9uLmZvcndhcmRfbWFudWFsID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfaG90a2V5LCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgbWVyZ2UgeyAiLSBGb3J3YXJkIE1hbnVhbCIsICJcbiIsICJtYW51YWxfZGlyZWN0aW9uOjpmb3J3YXJkX21hbnVhbCIgfSkKICAgICAgICA6IHJlY29yZCgiYWEiLCAibWFudWFsX2RpcmVjdGlvbjo6Zm9yd2FyZF9tYW51YWwiKQoKICAgICAgICBtYW51YWxfZGlyZWN0aW9uLmRpc2FibGVkX21hbnVhbCA9IG1lbnUubmV3X2l0ZW0odWkubmV3X2hvdGtleSwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsIG1lcmdlIHsgIi0gRGlzYWJsZWQgTWFudWFsIiwgIlxuIiwgIm1hbnVhbF9kaXJlY3Rpb246OmRpc2FibGVkX21hbnVhbCIgfSkKICAgICAgICA6IHJlY29yZCgiYWEiLCAibWFudWFsX2RpcmVjdGlvbjo6ZGlzYWJsZWRfbWFudWFsIikKCiAgICAgICAgbWFudWFsX2RpcmVjdGlvbi5sZWZ0X21hbnVhbDpzZXQoIlRvZ2dsZSIpCiAgICAgICAgbWFudWFsX2RpcmVjdGlvbi5yaWdodF9tYW51YWw6c2V0KCJUb2dnbGUiKQogICAgICAgIG1hbnVhbF9kaXJlY3Rpb24uZm9yd2FyZF9tYW51YWw6c2V0KCJUb2dnbGUiKQogICAgICAgIG1hbnVhbF9kaXJlY3Rpb24uZGlzYWJsZWRfbWFudWFsOnNldCgiVG9nZ2xlIikKCiAgICAgICAgZnVuY3Rpb24gbWFudWFsX2RpcmVjdGlvbi5nZXQoKQogICAgICAgICAgICByZXR1cm4gaWR4CiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIG1hbnVhbF9kaXJlY3Rpb24uZnJhbWUoKQogICAgICAgICAgICB0aGluaygpCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIG1hbnVhbF9kaXJlY3Rpb24udXBkYXRlKGN0eCkKICAgICAgICAgICAgaWYgaWR4ID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBhdm9pZF9iYWNrc3RhYi5nZXQoKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBvZmZzZXQgPSBkaXJlY3Rpb25zW2lkeF0KCiAgICAgICAgICAgIGlmIG9mZnNldCA9PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgY3R4Lnlhd19vZmZzZXQgPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIGN0eC55YXdfb2Zmc2V0ID0gMAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGN0eC55YXdfYmFzZSA9ICJMb2NhbCB2aWV3IgogICAgICAgICAgICBjdHgueWF3X29mZnNldCA9IG9mZnNldAoKICAgICAgICAgICAgaWYgbWFudWFsX2RpcmVjdGlvbi5vcHRpb25zOmhhdmVfa2V5KCJEaXNhYmxlIFlhdyBNb2RpZmllcnMiKSB0aGVuCiAgICAgICAgICAgICAgICBjdHgueWF3X2ppdHRlciA9ICJPZmYiCiAgICAgICAgICAgICAgICBjdHguYm9keV95YXcgPSAiU3RhdGljIgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIG1hbnVhbF9kaXJlY3Rpb24ub3B0aW9uczpoYXZlX2tleSgiRnJlZXN0YW5kaW5nIEJvZHkgWWF3IikgdGhlbgogICAgICAgICAgICAgICAgY3R4LmJvZHlfeWF3ID0gIlN0YXRpYyIKICAgICAgICAgICAgICAgIGN0eC5ib2R5X3lhd19vZmZzZXQgPSAxMjAKCiAgICAgICAgICAgICAgICBjdHguZnJlZXN0YW5kaW5nX2JvZHlfeWF3ID0gdHJ1ZQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGN0eC5lZGdlX3lhdyA9IGZhbHNlCiAgICAgICAgICAgIGN0eC5mcmVlc3RhbmRpbmcgPSBmYWxzZQoKICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICBlbmQKICAgIGVuZAoKICAgIC0tLSByZWdpb24gbG9nX2FpbWJvdF9zaG90cwogICAgZG8KICAgICAgICBsb2NhbCBEVVJBVElPTiA9IDcuMAoKICAgICAgICBsb2NhbCBpbmZlcm5vID0geyB9CiAgICAgICAgbG9jYWwgcmVndWxhciA9IHsgfQoKICAgICAgICBsb2NhbCBmdW5jdGlvbiBkcmF3X2V2ZW50X2xvZyguLi4pCiAgICAgICAgICAgIGlmIG5vdCBzZXR0aW5ncy50d2Vha3NfZW5hYmxlOmdldCgpIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGV2ZW50bG9ncy5hZGQoLi4uKQogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBmdW5jdGlvbiBwdXNoX2V2ZW50X2xvZyhkYXRhKQogICAgICAgICAgICBpZiAjcmVndWxhciA+IDggdGhlbgogICAgICAgICAgICAgICAgdGFibGUucmVtb3ZlKHJlZ3VsYXIsIDEpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmVndWxhclsjcmVndWxhciArIDFdID0gZGF0YQogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBmdW5jdGlvbiB3ZWFwb25fdG9fYWN0aW9uKHdlYXBvbikKICAgICAgICAgICAgaWYgd2VhcG9uID09ICJrbmlmZSIgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuICJLbmlmZWQiCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgd2VhcG9uID09ICJoZWdyZW5hZGUiIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiAiTmFkZWQiCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuICJIaXQiCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIGZ1bmN0aW9uIGZpbmRfaW5mZXJub19pbmZvKGVudCkKICAgICAgICAgICAgZm9yIGkgPSAxLCAjaW5mZXJubyBkbwogICAgICAgICAgICAgICAgbG9jYWwgZGF0YSA9IGluZmVybm9baV0KCiAgICAgICAgICAgICAgICBpZiBkYXRhLmVudGl0eSA9PSBlbnQgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICByZXR1cm4gbmlsCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIGZ1bmN0aW9uIGdldF9taXNzX2NvbG9yKHJlYXNvbikKICAgICAgICAgICAgaWYgcmVhc29uID09ICJzcHJlYWQiIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBldmVudGxvZ3Muc3ByZWFkX2NvbG9yX3BpY2tlcjpyYXdnZXQoKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIHJlYXNvbiA9PSAiZGVhdGgiIG9yIHJlYXNvbiA9PSAidW5yZWdpc3RlcmVkIHNob3QiIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBldmVudGxvZ3MudW5yZWdpc3RlcmVkX2NvbG9yX3BpY2tlcjpyYXdnZXQoKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiBldmVudGxvZ3MubWlzc19jb2xvcl9waWNrZXI6cmF3Z2V0KCkKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gY3JlYXRlX2V2ZW50X21lc3NhZ2UoYWN0aW9uLCBoaXRncm91cCwgZW50LCBkYW1hZ2UpCiAgICAgICAgICAgIGxvY2FsIG5hbWUgPSBlbnRpdHkuZ2V0X3BsYXllcl9uYW1lKGVudCkKICAgICAgICAgICAgbG9jYWwgaGl0Z3JvdXBfbmFtZSA9IGVfaGl0Z3JvdXBbaGl0Z3JvdXBdCgogICAgICAgICAgICBpZiBhY3Rpb24gPT0gIkhpdCIgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIGYoCiAgICAgICAgICAgICAgICAgICAgIiVzICR7JXN9IGluIHRoZSAkeyVzfSBmb3IgJHslc30gZGFtYWdlIiwKICAgICAgICAgICAgICAgICAgICBhY3Rpb24sIG5hbWUsIGhpdGdyb3VwX25hbWUsIGRhbWFnZQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiBmKAogICAgICAgICAgICAgICAgIiVzICR7JXN9IGZvciAkeyVzfSBkYW1hZ2UiLAogICAgICAgICAgICAgICAgYWN0aW9uLCBuYW1lLCBkYW1hZ2UKICAgICAgICAgICAgKQogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBmdW5jdGlvbiBjcmVhdGVfaW5mZXJub19pbmZvKGVudCwgZGFtYWdlKQogICAgICAgICAgICBsb2NhbCBkYXRhID0geyB9CgogICAgICAgICAgICBkYXRhLmVudGl0eSA9IGVudAogICAgICAgICAgICBkYXRhLmRhbWFnZSA9IGRhbWFnZQoKICAgICAgICAgICAgZGF0YS5hbHBoYSA9IDAuMAogICAgICAgICAgICBkYXRhLmR1cmF0aW9uID0gNy4wCgogICAgICAgICAgICBkYXRhLmZsYXNoX2Ftb3VudCA9IDEuMAoKICAgICAgICAgICAgcmV0dXJuIGRhdGEKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gY3JlYXRlX2V2ZW50X2luZm8oYWN0aW9uLCBoaXRncm91cCwgZW50LCBkYW1hZ2UpCiAgICAgICAgICAgIGxvY2FsIGRhdGEgPSB7IH0KCiAgICAgICAgICAgIGRhdGEubXNnID0gY3JlYXRlX2V2ZW50X21lc3NhZ2UoYWN0aW9uLCBoaXRncm91cCwgZW50LCBkYW1hZ2UpCgogICAgICAgICAgICBkYXRhLmFscGhhID0gMC4wCiAgICAgICAgICAgIGRhdGEuZHVyYXRpb24gPSA3LjAKCiAgICAgICAgICAgIHJldHVybiBkYXRhCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIGZ1bmN0aW9uIGNyZWF0ZV9taXNzX2luZm8ocmVhc29uKQogICAgICAgICAgICBpZiByZWFzb24gPT0gIj8iIHRoZW4KICAgICAgICAgICAgICAgIHJlYXNvbiA9ICJjb3JyZWN0aW9uIgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIGRhdGEgPSB7IH0KCiAgICAgICAgICAgIGRhdGEubXNnID0gZigKICAgICAgICAgICAgICAgICJNaXNzZWQgc2hvdCBkdWUgdG8gJHslc30iLAogICAgICAgICAgICAgICAgcmVhc29uCiAgICAgICAgICAgICkKCiAgICAgICAgICAgIGRhdGEucmVhc29uID0gcmVhc29uCgogICAgICAgICAgICBkYXRhLmFscGhhID0gMC4wCiAgICAgICAgICAgIGRhdGEuZHVyYXRpb24gPSA3LjAKCiAgICAgICAgICAgIHJldHVybiBkYXRhCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIGZ1bmN0aW9uIHVwZGF0ZV9pbmZlcm5vX2xvZ3MoZHQpCiAgICAgICAgICAgIGxvY2FsIHIsIGcsIGIgPSB3aWRnZXRzLmNvbG9yX3BpY2tlcjpyYXdnZXQoKQoKICAgICAgICAgICAgZm9yIGkgPSAjaW5mZXJubywgMSwgLTEgZG8KICAgICAgICAgICAgICAgIGxvY2FsIGRhdGEgPSBpbmZlcm5vW2ldCgogICAgICAgICAgICAgICAgZGF0YS5kdXJhdGlvbiA9IG1hdGgubWF4KDAsIGRhdGEuZHVyYXRpb24gLSBkdCkKICAgICAgICAgICAgICAgIGRhdGEuYWxwaGEgPSBtb3Rpb24uaW50ZXJwKGRhdGEuYWxwaGEsIGRhdGEuZHVyYXRpb24gPiAwLCAwLjA0NSkKCiAgICAgICAgICAgICAgICBpZiBkYXRhLmFscGhhIDw9IDAgdGhlbgogICAgICAgICAgICAgICAgICAgIHRhYmxlLnJlbW92ZShpbmZlcm5vLCBpKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgZm9yIGkgPSAxLCAjaW5mZXJubyBkbwogICAgICAgICAgICAgICAgbG9jYWwgZGF0YSA9IGluZmVybm9baV0KCiAgICAgICAgICAgICAgICBsb2NhbCBuYW1lID0gZW50aXR5LmdldF9wbGF5ZXJfbmFtZShkYXRhLmVudGl0eSkKICAgICAgICAgICAgICAgIGxvY2FsIGRhbWFnZSA9IGRhdGEuZGFtYWdlCgogICAgICAgICAgICAgICAgZHJhd19ldmVudF9sb2cociwgZywgYiwgMjU1ICogZGF0YS5hbHBoYSwgZigiQnVybmVkICR7JXN9IGZvciAkeyVkfSBkYW1hZ2UiLCBuYW1lLCBkYW1hZ2UpKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gdXBkYXRlX3JlZ3VsYXJfbG9ncyhkdCkKICAgICAgICAgICAgbG9jYWwgciwgZywgYiA9IHdpZGdldHMuY29sb3JfcGlja2VyOnJhd2dldCgpCgogICAgICAgICAgICBmb3IgaSA9ICNyZWd1bGFyLCAxLCAtMSBkbwogICAgICAgICAgICAgICAgbG9jYWwgZGF0YSA9IHJlZ3VsYXJbaV0KCiAgICAgICAgICAgICAgICBkYXRhLmR1cmF0aW9uID0gbWF0aC5tYXgoMCwgZGF0YS5kdXJhdGlvbiAtIGR0KQogICAgICAgICAgICAgICAgZGF0YS5hbHBoYSA9IG1vdGlvbi5pbnRlcnAoZGF0YS5hbHBoYSwgZGF0YS5kdXJhdGlvbiA+IDAsIDAuMDQ1KQoKICAgICAgICAgICAgICAgIGlmIGRhdGEuYWxwaGEgPD0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGFibGUucmVtb3ZlKHJlZ3VsYXIsIGkpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmb3IgaSA9IDEsICNyZWd1bGFyIGRvCiAgICAgICAgICAgICAgICBsb2NhbCBkYXRhID0gcmVndWxhcltpXQoKICAgICAgICAgICAgICAgIGxvY2FsIGNvbF9yID0gcgogICAgICAgICAgICAgICAgbG9jYWwgY29sX2cgPSBnCiAgICAgICAgICAgICAgICBsb2NhbCBjb2xfYiA9IGIKCiAgICAgICAgICAgICAgICBpZiBkYXRhLnJlYXNvbiB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgICAgIGNvbF9yLCBjb2xfZywgY29sX2IgPSBnZXRfbWlzc19jb2xvcihkYXRhLnJlYXNvbikKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGRyYXdfZXZlbnRfbG9nKGNvbF9yLCBjb2xfZywgY29sX2IsIDI1NSAqIGRhdGEuYWxwaGEsIGRhdGEubXNnKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gaGFuZGxlX2lucHV0KCkKICAgICAgICAgICAgaWYgbm90IHNldHRpbmdzLnR3ZWFrc19lbmFibGU6Z2V0KCkgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgc2V0dGluZ3MudHdlYWtzOmhhdmVfa2V5KCdMb2cgQWltYm90IFNob3RzJykgdGhlbgogICAgICAgICAgICAgICAgb3ZlcnJpZGUuc2V0KHNvZnR3YXJlLm1pc2Muc2V0dGluZ3Mub3V0cHV0LCBmYWxzZSkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgb3ZlcnJpZGUudW5zZXQoc29mdHdhcmUubWlzYy5zZXR0aW5ncy5vdXRwdXQpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBzZXR0aW5ncy50d2Vha3M6c2V0X2NhbGxiYWNrKGhhbmRsZV9pbnB1dCkKICAgICAgICBzZXR0aW5ncy50d2Vha3NfZW5hYmxlOnNldF9jYWxsYmFjayhoYW5kbGVfaW5wdXQpCiAgICAgICAgdWkuc2V0X2NhbGxiYWNrKHNvZnR3YXJlLm1pc2Muc2V0dGluZ3Mub3V0cHV0LCBoYW5kbGVfaW5wdXQpCiAgICAgICAgaGFuZGxlX2lucHV0KCkKCiAgICAgICAgZnVuY3Rpb24gbG9nX2FpbWJvdF9zaG90cy5wbGF5ZXJfaHVydChlKQogICAgICAgICAgICBpZiBub3Qgc2V0dGluZ3MudHdlYWtzX2VuYWJsZTpnZXQoKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBtZSA9IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkKCiAgICAgICAgICAgIGxvY2FsIHVzZXJpZCA9IGNsaWVudC51c2VyaWRfdG9fZW50aW5kZXgoZS51c2VyaWQpCiAgICAgICAgICAgIGxvY2FsIGF0dGFja2VyID0gY2xpZW50LnVzZXJpZF90b19lbnRpbmRleChlLmF0dGFja2VyKQoKICAgICAgICAgICAgbG9jYWwgd2VhcG9uID0gZVsid2VhcG9uIl0KICAgICAgICAgICAgbG9jYWwgZGFtYWdlID0gZVsiZG1nX2hlYWx0aCJdCgogICAgICAgICAgICBsb2NhbCBoaXRncm91cCA9IGVbImhpdGdyb3VwIl0KCiAgICAgICAgICAgIGlmIHVzZXJpZCA9PSBtZSBvciBhdHRhY2tlciB+PSBtZSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiB3ZWFwb24gPT0gImluZmVybm8iIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGRhdGEgPSBmaW5kX2luZmVybm9faW5mbyh1c2VyaWQpCgogICAgICAgICAgICAgICAgaWYgZGF0YSB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgICAgIGRhdGEuZGFtYWdlID0gZGF0YS5kYW1hZ2UgKyBkYW1hZ2UKICAgICAgICAgICAgICAgICAgICBkYXRhLmR1cmF0aW9uID0gRFVSQVRJT04KCiAgICAgICAgICAgICAgICAgICAgZGF0YS5mbGFzaF9hbW91bnQgPSAxLjAKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpbmZlcm5vWyNpbmZlcm5vICsgMV0gPSBjcmVhdGVfaW5mZXJub19pbmZvKHVzZXJpZCwgZGFtYWdlKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgYWN0aW9uID0gd2VhcG9uX3RvX2FjdGlvbih3ZWFwb24pCiAgICAgICAgICAgIHB1c2hfZXZlbnRfbG9nKGNyZWF0ZV9ldmVudF9pbmZvKGFjdGlvbiwgaGl0Z3JvdXAsIHVzZXJpZCwgZGFtYWdlKSkKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gbG9nX2FpbWJvdF9zaG90cy5haW1fbWlzcyhlKQogICAgICAgICAgICBpZiBub3Qgc2V0dGluZ3MudHdlYWtzX2VuYWJsZTpnZXQoKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBwdXNoX2V2ZW50X2xvZyhjcmVhdGVfbWlzc19pbmZvKGUucmVhc29uKSkKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gbG9nX2FpbWJvdF9zaG90cy5mcmFtZSgpCiAgICAgICAgICAgIGxvY2FsIGR0ID0gZ2xvYmFscy5mcmFtZXRpbWUoKQoKICAgICAgICAgICAgdXBkYXRlX2luZmVybm9fbG9ncyhkdCkKICAgICAgICAgICAgdXBkYXRlX3JlZ3VsYXJfbG9ncyhkdCkKICAgICAgICBlbmQKICAgIGVuZAoKICAgIC0tLSByZWdpb24gZXZlbnRsb2dzCiAgICBkbwogICAgICAgIGxvY2FsIEFMUEhBX1VOSVQgPSAxIC8gMjU1CgogICAgICAgIGxvY2FsIHF1ZXVlID0geyB9CiAgICAgICAgbG9jYWwgcHJldmlld19hbHBoYSA9IDAuMAoKICAgICAgICBsb2NhbCBmdW5jdGlvbiByZXBsYWNlbWVudChzLCBjb2xfYSwgY29sX2IpCiAgICAgICAgICAgIGxvY2FsIGhleF9hID0gdXRpbHMudG9faGV4KHVucGFjayhjb2xfYSkpCiAgICAgICAgICAgIGxvY2FsIGhleF9iID0gdXRpbHMudG9faGV4KHVucGFjayhjb2xfYikpCgogICAgICAgICAgICBsb2NhbCByZXBsID0gZigiXGElcyUlMVxhJXMiLCBoZXhfYSwgaGV4X2IpCiAgICAgICAgICAgIGxvY2FsIHJlc3VsdCA9IHN0cmluZy5nc3ViKHMsICIkeyguLSl9IiwgcmVwbCkKCiAgICAgICAgICAgIHJldHVybiByZXN1bHQKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gdXBkYXRlX3ByZXZpZXcoKQogICAgICAgICAgICBsb2NhbCBjYW5fc2hvd19wcmV2aWV3ID0gd2lkZ2V0cy5lbmFibGVkOmdldCgpIGFuZCB1aS5pc19tZW51X29wZW4oKSBhbmQgI3F1ZXVlID09IDAKICAgICAgICAgICAgcHJldmlld19hbHBoYSA9IG1vdGlvbi5pbnRlcnAocHJldmlld19hbHBoYSwgY2FuX3Nob3dfcHJldmlldywgMC4wNDUpCgogICAgICAgICAgICBpZiBwcmV2aWV3X2FscGhhID4gMC4wIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGFscGhhID0gMjU1ICogcHJldmlld19hbHBoYQoKICAgICAgICAgICAgICAgIC0tIGhpdCBleGFtcGxlCiAgICAgICAgICAgICAgICBkbwogICAgICAgICAgICAgICAgICAgIGxvY2FsIHIsIGcsIGIgPSB3aWRnZXRzLmNvbG9yX3BpY2tlcjpyYXdnZXQoKQoKICAgICAgICAgICAgICAgICAgICBldmVudGxvZ3MuYWRkKHIsIGcsIGIsIGFscGhhLCAiSGl0ICR7dmxhZGlzbGF2fSBmb3IgJHsxMH0gZGFtYWdlIikKICAgICAgICAgICAgICAgICAgICBldmVudGxvZ3MuYWRkKHIsIGcsIGIsIGFscGhhLCAiSGl0ICR7bW9uc3Rlcn0gaW4gdGhlICR7aGVhZH0gZm9yICR7MTAzfSBkYW1hZ2UiKQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgLS0gbWlzcyBleGFtcGxlCiAgICAgICAgICAgICAgICBkbwogICAgICAgICAgICAgICAgICAgIGxvY2FsIHIsIGcsIGIgPSBldmVudGxvZ3MubWlzc19jb2xvcl9waWNrZXI6cmF3Z2V0KCkKCiAgICAgICAgICAgICAgICAgICAgZXZlbnRsb2dzLmFkZChyLCBnLCBiLCBhbHBoYSwgIk1pc3NlZCBzaG90IGR1ZSB0byAke2NvcnJlY3Rpb259IikKICAgICAgICAgICAgICAgICAgICBldmVudGxvZ3MuYWRkKHIsIGcsIGIsIGFscGhhLCAiTWlzc2VkIHNob3QgZHVlIHRvICR7cHJlZGljdGlvbiBlcnJvcn0iKQogICAgICAgICAgICAgICAgICAgIGV2ZW50bG9ncy5hZGQociwgZywgYiwgYWxwaGEsICJNaXNzZWQgc2hvdCBkdWUgdG8gJHtsYWdjb21wIGZhaWx1cmV9IikKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIC0tIHNwcmVhZCBleGFtcGxlCiAgICAgICAgICAgICAgICBkbwogICAgICAgICAgICAgICAgICAgIGxvY2FsIHIsIGcsIGIgPSBldmVudGxvZ3Muc3ByZWFkX2NvbG9yX3BpY2tlcjpyYXdnZXQoKQoKICAgICAgICAgICAgICAgICAgICBldmVudGxvZ3MuYWRkKHIsIGcsIGIsIGFscGhhLCAiTWlzc2VkIHNob3QgZHVlIHRvICR7c3ByZWFkfSIpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAtLSBuZXR3b3JrIGV4YW1wbGUKICAgICAgICAgICAgICAgIGRvCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgciwgZywgYiA9IGV2ZW50bG9ncy51bnJlZ2lzdGVyZWRfY29sb3JfcGlja2VyOnJhd2dldCgpCgogICAgICAgICAgICAgICAgICAgIGV2ZW50bG9ncy5hZGQociwgZywgYiwgYWxwaGEsICJNaXNzZWQgc2hvdCBkdWUgdG8gJHt1bnJlZ2lzdGVyZWQgc2hvdH0iKQogICAgICAgICAgICAgICAgICAgIGV2ZW50bG9ncy5hZGQociwgZywgYiwgYWxwaGEsICJNaXNzZWQgc2hvdCBkdWUgdG8gJHtwbGF5ZXIgZGVhdGh9IikKICAgICAgICAgICAgICAgICAgICBldmVudGxvZ3MuYWRkKHIsIGcsIGIsIGFscGhhLCAiTWlzc2VkIHNob3QgZHVlIHRvICR7ZGVhdGh9IikKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgd2lkZ2V0ID0gd2luZG93cy5uZXcoIiMjRXZlbnQgTG9ncyIsIC41NSwgMC43OCkKICAgICAgICB3aWRnZXQ6c2V0X3NpemUodmVjdG9yKDMzMCwgMTI1KSkKCiAgICAgICAgbG9jYWwgaG92ZXJlZF9hbHBoYSA9IDAKCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gZHJhd19ldmVudGxvZ3MoKQogICAgICAgICAgICBpZiBub3Qgd2lkZ2V0cy5lbmFibGVkOmdldCgpIG9yIG5vdCB3aWRnZXRzLml0ZW1zOmhhdmVfa2V5KCJPbi1TY3JlZW4gTG9ncyIpIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIHNjcmVlbiA9IHZlY3RvcihjbGllbnQuc2NyZWVuX3NpemUoKSkKICAgICAgICAgICAgbG9jYWwgZmxhZ3MgPSAiZCIKCiAgICAgICAgICAgIGxvY2FsIHdpbmRvdyA9IHdpZGdldAogICAgICAgICAgICB3aW5kb3cucG9zLnggPSBzY3JlZW4ueCAqIC41IC0gMTY1CgogICAgICAgICAgICBsb2NhbCBwb3MgPSB3aW5kb3cucG9zOmNsb25lKCkKICAgICAgICAgICAgbG9jYWwgc2l6ZSA9IHdpbmRvdy5zaXplOmNsb25lKCkKCiAgICAgICAgICAgIGxvY2FsIHBvc2l0aW9uID0gdmVjdG9yKHBvcy54ICsgc2l6ZS54IC8gMiwgcG9zLnkpCgogICAgICAgICAgICBob3ZlcmVkX2FscGhhID0gbW90aW9uLmludGVycChob3ZlcmVkX2FscGhhLCB1aS5pc19tZW51X29wZW4oKSBhbmQgd2luZG93OmlzX2hvdmVyaW5nKCksIDAuMDk1KQogICAgICAgICAgICBpZiBob3ZlcmVkX2FscGhhIH49IDAgdGhlbgogICAgICAgICAgICAgICAgcmVuZGVyZXIudGV4dChwb3MueCArIHNpemUueCAqIC41LCBwb3MueSAtIDEwLCAyNTUsIDI1NSwgMjU1LCAyNTUgKiBob3ZlcmVkX2FscGhhLCAnYycsIG5pbCwgJ1lvdSBjYW4gZHJhZyB3aWRnZXQgdmVydGljYWxseS4nKQogICAgICAgICAgICAgICAgcmVuZGVyZXIucmVjdGFuZ2xlKHBvcy54ICsgNTAsIHBvcy55IC0gMiwgc2l6ZS54IC0gMTAzLCAxLCAyNTUsIDI1NSwgMjU1LCAxMDAgKiBob3ZlcmVkX2FscGhhKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZvciBpID0gMSwgI3F1ZXVlIGRvCiAgICAgICAgICAgICAgICBsb2NhbCBsb2cgPSBxdWV1ZVtpXQoKICAgICAgICAgICAgICAgIGxvY2FsIHIsIGcsIGIsIGEgPSBsb2cuciwgbG9nLmcsIGxvZy5iLCBsb2cuYQogICAgICAgICAgICAgICAgbG9jYWwgYWxwaGEgPSBhICogQUxQSEFfVU5JVAoKICAgICAgICAgICAgICAgIGxvY2FsIHRleHQgPSBsb2cubXNnIGRvCiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHJlcGxhY2VtZW50KHRleHQsIHsgciwgZywgYiwgMjU1IH0sIHsgMjU1LCAyNTUsIDI1NSwgMjU1IH0pCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBsb2NhbCB0ZXh0X3NpemUgPSB2ZWN0b3IocmVuZGVyZXIubWVhc3VyZV90ZXh0KGZsYWdzLCB0ZXh0KSkKICAgICAgICAgICAgICAgIGxvY2FsIHJlY3Rfc2l6ZSA9IHZlY3Rvcih0ZXh0X3NpemUueCwgdGV4dF9zaXplLnkpCgogICAgICAgICAgICAgICAgbG9jYWwgdGV4dF9wb3NpdGlvbiA9IHZlY3Rvcihwb3NpdGlvbi54IC0gdGV4dF9zaXplLnggKiAwLjUsIHBvc2l0aW9uLnkpCiAgICAgICAgICAgICAgICAtLSBsb2NhbCByZWN0X3Bvc2l0aW9uID0gdmVjdG9yKHBvc2l0aW9uLnggLSByZWN0X3NpemUueCAqIDAuNSwgcG9zaXRpb24ueSArIHRleHRfc2l6ZS55ICogMC41KQoKICAgICAgICAgICAgICAgIC0tIGdyYXBoaWNzLmdsb3cocmVjdF9wb3NpdGlvbi54LCByZWN0X3Bvc2l0aW9uLnkgLSAyLCByZWN0X3NpemUueCwgNCwgciwgZywgYiwgYSAqIDAuMSwgMTAsIDEpCiAgICAgICAgICAgICAgICAtLSByZW5kZXJlci5yZWN0YW5nbGUocmVjdF9wb3NpdGlvbi54LCByZWN0X3Bvc2l0aW9uLnkgLSAyLCByZWN0X3NpemUueCwgNCwgciwgZywgYiwgYSAqIDAuMSkKCiAgICAgICAgICAgICAgICBncmFwaGljcy50ZXh0KHRleHRfcG9zaXRpb24ueCwgdGV4dF9wb3NpdGlvbi55LCAyNTUsIDI1NSwgMjU1LCAyNTUgKiBhbHBoYSwgZmxhZ3MsIDAsIHRleHQpCgogICAgICAgICAgICAgICAgcG9zaXRpb24ueSA9IHBvc2l0aW9uLnkgKyAodGV4dF9zaXplLnkgKyAxKSAqIGFscGhhCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgd2luZG93OnVwZGF0ZSgpCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIGZ1bmN0aW9uIGdldF9jb2xvcihzZWxmKQogICAgICAgICAgICByZXR1cm4gc2VsZi5yLCBzZWxmLmcsIHNlbGYuYgogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCB3ciwgd2csIHdiID0gd2lkZ2V0cy5jb2xvcl9waWNrZXI6cmF3Z2V0KCkKCiAgICAgICAgZXZlbnRsb2dzLmhpdF9jb2xvcl9waWNrZXIgPSB7CiAgICAgICAgICAgIHIgPSB3ciwgZyA9IHdnLCBiID0gd2IsCgogICAgICAgICAgICByYXdnZXQgPSBnZXRfY29sb3IKICAgICAgICB9CgogICAgICAgIGV2ZW50bG9ncy5zcHJlYWRfY29sb3JfcGlja2VyID0gewogICAgICAgICAgICByID0gMjU1LCBnID0gMjI1LCBiID0gMTE1LAoKICAgICAgICAgICAgcmF3Z2V0ID0gZ2V0X2NvbG9yCiAgICAgICAgfQoKICAgICAgICBldmVudGxvZ3MubWlzc19jb2xvcl9waWNrZXIgPSB7CiAgICAgICAgICAgIHIgPSAyNTUsIGcgPSA5OCwgYiA9IDk4LAoKICAgICAgICAgICAgcmF3Z2V0ID0gZ2V0X2NvbG9yCiAgICAgICAgfQoKICAgICAgICBldmVudGxvZ3MudW5yZWdpc3RlcmVkX2NvbG9yX3BpY2tlciA9IHsKICAgICAgICAgICAgciA9IDEwMCwgZyA9IDEwMCwgYiA9IDI1NSwKCiAgICAgICAgICAgIHJhd2dldCA9IGdldF9jb2xvcgogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZXZlbnRsb2dzLmFkZChyLCBnLCBiLCBhLCB0ZXh0KQogICAgICAgICAgICBsb2NhbCBsb2cgPSB7IH0KCiAgICAgICAgICAgIGxvZy5yID0gcgogICAgICAgICAgICBsb2cuZyA9IGcKICAgICAgICAgICAgbG9nLmIgPSBiCiAgICAgICAgICAgIGxvZy5hID0gYQoKICAgICAgICAgICAgbG9nLm1zZyA9IHRleHQKCiAgICAgICAgICAgIHRhYmxlLmluc2VydChxdWV1ZSwgbG9nKQogICAgICAgICAgICByZXR1cm4gbG9nCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIGV2ZW50bG9ncy5wcmVfZnJhbWUoKQogICAgICAgICAgICB0YWJsZS5jbGVhcihxdWV1ZSkKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gZXZlbnRsb2dzLnBvc3RfZnJhbWUoKQogICAgICAgICAgICB1cGRhdGVfcHJldmlldygpCiAgICAgICAgICAgIGRyYXdfZXZlbnRsb2dzKCkKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGxvY2FsIHByaW50X2RldiBkbwogICAgICAgIHByaW50X2RldiA9IHsKICAgICAgICAgICAgZGF0YSA9IHsgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcHJpbnRfZGV2LmFkZCh0ZXh0LCB0aW1lKQogICAgICAgICAgICBwcmludF9kZXYuZGF0YVsjcHJpbnRfZGV2LmRhdGErMV0gPSB7CiAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dCwKICAgICAgICAgICAgICAgIHRpbWUgPSB0aW1lICsgZ2xvYmFscy5yZWFsdGltZSgpLAogICAgICAgICAgICAgICAgYWxwaGEgPSAwLjAxLAogICAgICAgICAgICAgICAgb2Zmc2V0ID0gMAogICAgICAgICAgICB9CiAgICAgICAgZW5kCiAgICAKICAgICAgICBjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCdwYWludCcsIGZ1bmN0aW9uICgpCiAgICAgICAgICAgIGxvY2FsIHJlYWx0aW1lID0gZ2xvYmFscy5yZWFsdGltZSgpCiAgICAgICAgICAgIGxvY2FsIGZyYW1ldGltZSA9IGdsb2JhbHMuZnJhbWV0aW1lKCkKICAgICAgICAgICAgbG9jYWwgb2Zmc2V0ID0gMAogICAgCiAgICAgICAgICAgIGZvciBpID0gI3ByaW50X2Rldi5kYXRhLCAxLCAtMSBkbwogICAgICAgICAgICAgICAgbG9jYWwgbG9nID0gcHJpbnRfZGV2LmRhdGFbaV0KICAgICAgICAgICAgICAgIGlmIG5vdCBsb2cgdGhlbgogICAgICAgICAgICAgICAgICAgIGdvdG8gc2tpcAogICAgICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgICAgIGlmIGxvZy5vZmZzZXQgfj0gb2Zmc2V0IHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2cub2Zmc2V0ID0gdXRpbHMuY2xhbXAobG9nLm9mZnNldCA8IG9mZnNldCBhbmQgbG9nLm9mZnNldCArICgyMDAgKiBmcmFtZXRpbWUpIG9yIG9mZnNldCwgMCwgb2Zmc2V0KQogICAgICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgICAgIGxvY2FsIGRpZmZlcmVuY2UgPSBsb2cudGltZSAtIHJlYWx0aW1lCiAgICAgICAgICAgICAgICBsb2cuYWxwaGEgPSBtb3Rpb24uaW50ZXJwKGxvZy5hbHBoYSwgZGlmZmVyZW5jZSA+IDAsIDAuMDQ1KQogICAgICAgICAgICAgICAgaWYgbG9nLmFscGhhIDw9IDAgYW5kIGRpZmZlcmVuY2UgPCAwIHRoZW4KICAgICAgICAgICAgICAgICAgICB0YWJsZS5yZW1vdmUocHJpbnRfZGV2LmRhdGEsIGkpCiAgICAgICAgICAgICAgICAgICAgZ290byBza2lwCiAgICAgICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICAgICAgbG9jYWwgdGV4dF9zeiA9IHZlY3RvcihyZW5kZXJlci5tZWFzdXJlX3RleHQoJ2QnLCBsb2cudGV4dCkpCiAgICAKICAgICAgICAgICAgICAgIGdyYXBoaWNzLnRleHQoOCwgNSArIGxvZy5vZmZzZXQsIDI1NSwgMjU1LCAyNTUsIDI1NSAqIGxvZy5hbHBoYSwgJ2QnLCBuaWwsIGxvZy50ZXh0KQogICAgCiAgICAgICAgICAgICAgICBvZmZzZXQgPSBvZmZzZXQgKyB0ZXh0X3N6LnkgKyAxCiAgICAgICAgICAgICAgICA6OnNraXA6OgogICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICBmb3IgaSA9IDEsICNwcmludF9kZXYuZGF0YSBkbwogICAgICAgICAgICAgICAgbG9jYWwgbG9nX2NvdW50ID0gI3ByaW50X2Rldi5kYXRhIC0gaQogICAgCiAgICAgICAgICAgICAgICBpZiBsb2dfY291bnQgPiA3IHRoZW4KICAgICAgICAgICAgICAgICAgICBwcmludF9kZXYuZGF0YVsgaSBdLnRpbWUgPSAwCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgCiAgICAgICAgY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygncm91bmRfcHJlc3RhcnQnLCBmdW5jdGlvbiAoKQogICAgICAgICAgICBwcmludF9kZXYuZGF0YSA9IHsgfQogICAgICAgIGVuZCkKICAgIAogICAgICAgIHNldG1ldGF0YWJsZShwcmludF9kZXYsIHsKICAgICAgICAgICAgX19jYWxsID0gZnVuY3Rpb24gKHNlbGYsIC4uLikKICAgICAgICAgICAgICAgIHByaW50X2Rldi5hZGQoLi4uKQogICAgICAgICAgICBlbmQKICAgICAgICB9KQogICAgZW5kCgogICAgLS0tcmVnaW9uIGxvZyBhaW0gNG90cwogICAgZG8KICAgICAgICBsb2NhbCBoaXRncm91cF9zdHIgPSB7CiAgICAgICAgICAgIFswXSA9ICdnZW5lcmljJywKICAgICAgICAgICAgJ2hlYWQnLCAnY2hlc3QnLCAnc3RvbWFjaCcsCiAgICAgICAgICAgICdsZWZ0IGFybScsICdyaWdodCBhcm0nLAogICAgICAgICAgICAnbGVmdCBsZWcnLCAncmlnaHQgbGVnJywKICAgICAgICAgICAgJ25lY2snLCAnZ2VuZXJpYycsICdnZWFyJwogICAgICAgIH0KCiAgICAgICAgbG9jYWwgd2VhcG9uX3ZlcmIgPSB7CiAgICAgICAgICAgIFsnaGVncmVuYWRlJ10gPSAnTmFkZWQnLAogICAgICAgICAgICBbJ2luZmVybm8nXSA9ICdCdXJuZWQnLAogICAgICAgICAgICBbJ2tuaWZlJ10gPSAnS25pZmVkJywKICAgICAgICB9CgogICAgICAgIGxvY2FsIGhleF90b19yZ2IgPSBmdW5jdGlvbiggaGV4ICkKICAgICAgICAgICAgaGV4ID0gaGV4OmdzdWIoJyMnLCAnJykKICAgICAgICAgICAgcmV0dXJuIHRvbnVtYmVyKCcweCcgLi4gaGV4OnN1YigxLCAyKSksIHRvbnVtYmVyKCcweCcgLi4gaGV4OnN1YigzLCA0KSksIHRvbnVtYmVyKCcweCcgLi4gaGV4OnN1Yig1LCA2KSkKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gY2xlYW5fdXAoc3RyKQogICAgICAgICAgICBsb2NhbCB0ZXh0ID0gc3RyOmdzdWIoJyhcYSV4JXgleCV4JXgleCkleCV4JywgJyUxJykKICAgICAgICAgICAgcmV0dXJuIHRleHQKICAgICAgICBlbmQKCiAgICAJbG9jYWwgZnVuY3Rpb24gcHJpbnRjKC4uLikKICAgIAkJZm9yIGksIHYgaW4gaXBhaXJzey4uLn0gZG8KICAgIAkJCWxvY2FsIHIgPSAiXGFEOUQ5RDkiIC4uIHYKICAgIAkJCWZvciBjb2wsIHRleHQgaW4gcjpnbWF0Y2goIlxhKCV4JXgleCV4JXgleCkoW15cYV0qKSIpIGRvCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgciwgZywgYiA9IGhleF90b19yZ2IoY29sKQogICAgCQkJCWNsaWVudC5jb2xvcl9sb2cociwgZywgYiwgc3RyaW5nLmZvcm1hdCgnJXNcMCcsIHRleHQpKQogICAgCQkJZW5kCiAgICAgICAgICAgICAgICBjbGllbnQuY29sb3JfbG9nKDI1NSwgMjU1LCAyNTUsICdcblwwJykKICAgIAkJZW5kCiAgICAJZW5kCgogICAgICAgIGxvY2FsIHdhbnRlZF9kYW1hZ2UsIHdhbnRlZF9oaXRncm91cCwgYmFja3RyYWNrID0gMCwgMCwgMAoKICAgICAgICBjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJhaW1fZmlyZSIsIGZ1bmN0aW9uIChlKQogICAgICAgICAgICBpZiBub3Qgc2V0dGluZ3MudHdlYWtzX2VuYWJsZTpnZXQoKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBub3Qgc2V0dGluZ3MudHdlYWtzOmhhdmVfa2V5KCdMb2cgQWltYm90IFNob3RzJykgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgd2FudGVkX2RhbWFnZSA9IGUuZGFtYWdlCiAgICAgICAgICAgIHdhbnRlZF9oaXRncm91cCA9IGUuaGl0Z3JvdXAKICAgICAgICAgICAgYmFja3RyYWNrID0gZ2xvYmFscy50aWNrY291bnQoKSAtIGUudGljawogICAgICAgIGVuZCkKCiAgICAgICAgY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygnYWltX2hpdCcsIGZ1bmN0aW9uIChzaG90KQogICAgICAgICAgICBpZiBub3Qgc2V0dGluZ3MudHdlYWtzX2VuYWJsZTpnZXQoKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBub3Qgc2V0dGluZ3MudHdlYWtzOmhhdmVfa2V5KCdMb2cgQWltYm90IFNob3RzJykgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgdGFyZ2V0ID0gc2hvdC50YXJnZXQKICAgICAgICAgICAgaWYgdGFyZ2V0ID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBpbmZvID0gewogICAgICAgICAgICAgICAgJ1xySGl0ICcsCiAgICAgICAgICAgICAgICBmKCdcYVtuaWNrXSVzXHJcJ3MgJywgZW50aXR5LmdldF9wbGF5ZXJfbmFtZSh0YXJnZXQpKSwKICAgICAgICAgICAgICAgICdpbiB0aGUgJywKICAgICAgICAgICAgICAgIHNob3QuaGl0Z3JvdXAgfj0gd2FudGVkX2hpdGdyb3VwIGFuZCBmKCdcYVtoaWdobGlnaHRdJXNccihcYVtoaWdobGlnaHRdJXNccikgJywgaGl0Z3JvdXBfc3RyWyBzaG90LmhpdGdyb3VwIF0sIGhpdGdyb3VwX3N0clsgd2FudGVkX2hpdGdyb3VwIF0pIG9yIGYoJ1xhW2hpZ2hsaWdodF0lc1xyICcsIGhpdGdyb3VwX3N0clsgc2hvdC5oaXRncm91cCBdKSwKICAgICAgICAgICAgICAgICdmb3IgJywKICAgICAgICAgICAgICAgIHNob3QuZGFtYWdlIH49IHdhbnRlZF9kYW1hZ2UgYW5kIGYoJ1xhW2hpZ2hsaWdodF0lZFxyKFxhW2hpZ2hsaWdodF0lZFxyKSAnLCBzaG90LmRhbWFnZSwgd2FudGVkX2RhbWFnZSkgb3IgZignXGFbaGlnaGxpZ2h0XSVkXHIgJywgc2hvdC5kYW1hZ2UpLAogICAgICAgICAgICAgICAgJ2RhbWFnZSAnLAogICAgICAgICAgICAgICAgZignKGhjOiBcYVtoaWdobGlnaHRdJWQlJSBcYVtpZGxlXcK3IFxyaGlzdG9yeTogXGFbaGlnaGxpZ2h0XSVkdFxyKScsIHNob3QuaGl0X2NoYW5jZSwgYmFja3RyYWNrKQogICAgICAgICAgICB9CgogICAgICAgICAgICBsb2NhbCBzdHIgPSB1dGlscy5mb3JtYXQodGFibGUuY29uY2F0KGluZm8sICcnKSwgMjU1LCAyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICBwcmludGMoZignXGFCNkU3MTdbZ2FtZXNlbnNlXSBcYUZGRkZGRiVzJywgY2xlYW5fdXAoc3RyKSkpCiAgICAgICAgICAgIHByaW50X2RldihzdHIsIDgpCiAgICAgICAgZW5kKQoKICAgICAgICBjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCdhaW1fbWlzcycsIGZ1bmN0aW9uIChzaG90KQogICAgICAgICAgICBpZiBub3Qgc2V0dGluZ3MudHdlYWtzX2VuYWJsZTpnZXQoKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBub3Qgc2V0dGluZ3MudHdlYWtzOmhhdmVfa2V5KCdMb2cgQWltYm90IFNob3RzJykgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgdGFyZ2V0ID0gc2hvdC50YXJnZXQKICAgICAgICAgICAgaWYgdGFyZ2V0ID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBpbmZvID0gewogICAgICAgICAgICAgICAgJ1xyTWlzc2VkICcsCiAgICAgICAgICAgICAgICBmKCdcYVtuaWNrXSVzXHJcJ3MgJywgZW50aXR5LmdldF9wbGF5ZXJfbmFtZSh0YXJnZXQpKSwKICAgICAgICAgICAgICAgIGYoJ1xhW2hpZ2hsaWdodF0lc1xyICcsIGhpdGdyb3VwX3N0clsgc2hvdC5oaXRncm91cCBdKSwKICAgICAgICAgICAgICAgICdkdWUgdG8gJywKICAgICAgICAgICAgICAgIGYoJ1xhW21pc3NdJXNcciAnLCBzaG90LnJlYXNvbiksCiAgICAgICAgICAgICAgICBmKCcoaGM6IFxhW2hpZ2hsaWdodF0lZCUlIFxhW2lkbGVdwrcgXHJoaXN0b3J5OiBcYVtoaWdobGlnaHRdJWR0XHIpJywgc2hvdC5oaXRfY2hhbmNlLCBiYWNrdHJhY2spCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxvY2FsIHN0ciA9IHV0aWxzLmZvcm1hdCh0YWJsZS5jb25jYXQoaW5mbywgJycpLCAyNTUsIDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgIHByaW50YyhmKCdcYUI2RTcxN1tnYW1lc2Vuc2VdIFxhRkZGRkZGJXMnLCBjbGVhbl91cChzdHIpKSkKICAgICAgICAgICAgcHJpbnRfZGV2KHN0ciwgOCkKICAgICAgICBlbmQpCgogICAgICAgIGNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soJ3BsYXllcl9odXJ0JywgZnVuY3Rpb24gKGUpCiAgICAgICAgICAgIGlmIG5vdCBzZXR0aW5ncy50d2Vha3NfZW5hYmxlOmdldCgpIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIG5vdCBzZXR0aW5ncy50d2Vha3M6aGF2ZV9rZXkoJ0xvZyBBaW1ib3QgU2hvdHMnKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBscCA9IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkKICAgICAgICAgICAgbG9jYWwgdmljdGltID0gY2xpZW50LnVzZXJpZF90b19lbnRpbmRleChlLnVzZXJpZCkKICAgICAgICAgICAgbG9jYWwgYXR0YWNrZXIgPSBjbGllbnQudXNlcmlkX3RvX2VudGluZGV4KGUuYXR0YWNrZXIpCiAgICAgICAgICAgIGlmIHZpY3RpbSA9PSBuaWwgb3IgYXR0YWNrZXIgPT0gbmlsIG9yIHZpY3RpbSA9PSBscCBvciBhdHRhY2tlciB+PSBscCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBoaXRncm91cCA9IGhpdGdyb3VwX3N0clsgZS5oaXRncm91cCBdCgogICAgICAgICAgICBsb2NhbCB2ZXJiID0gd2VhcG9uX3ZlcmJbIGUud2VhcG9uIF0KICAgICAgICAgICAgaWYgdmVyYiA9PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgaW5mbyA9IHsKICAgICAgICAgICAgICAgICdccicgLi4gdmVyYiwKICAgICAgICAgICAgICAgIGYoJyBcYVtuaWNrXSVzXHIgJywgZW50aXR5LmdldF9wbGF5ZXJfbmFtZSh2aWN0aW0pKSwKICAgICAgICAgICAgICAgICdmb3IgJywKICAgICAgICAgICAgICAgIGYoJ1xhW2hpZ2hsaWdodF0lZCBccmRhbWFnZSAnLCBlLmRtZ19oZWFsdGggb3IgMCksCiAgICAgICAgICAgICAgICBmKCcoXGFbaGlnaGxpZ2h0XSVkIFxyaGVhbHRoIHJlbWFpbmluZyknLCBlLmhlYWx0aCBvciAwKQogICAgICAgICAgICB9CgogICAgICAgICAgICBsb2NhbCBzdHIgPSB1dGlscy5mb3JtYXQodGFibGUuY29uY2F0KGluZm8sICcnKSwgMjU1LCAyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICBwcmludGMoZignXGFCNkU3MTdbZ2FtZXNlbnNlXSBcYUZGRkZGRiVzJywgY2xlYW5fdXAoc3RyKSkpCiAgICAgICAgICAgIHByaW50X2RldihzdHIsIDgpCiAgICAgICAgZW5kKQogICAgZW5kCgogICAgLS0tcmVnaW9uINC90LXQvtC/0L7Qt9C90LDQvQogICAgZG8KICAgICAgICBsb2NhbCBzaG90cyBkbwogICAgICAgICAgICBzaG90cyA9IHsKICAgICAgICAgICAgICAgIHRvdGFsID0gMCwKICAgICAgICAgICAgICAgIGhpdHMgPSAwLAoKICAgICAgICAgICAgICAgIHJlYXNvbnMgPSB7CiAgICAgICAgICAgICAgICAgICAgWydwcmVkaWN0aW9uIGVycm9yJ10gPSB0cnVlLAogICAgICAgICAgICAgICAgICAgIFsnZGVhdGgnXSA9IHRydWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygnYWltX2ZpcmUnLCBmdW5jdGlvbiAoc2hvdCkKICAgICAgICAgICAgICAgIHNob3RzLnRvdGFsID0gc2hvdHMudG90YWwgKyAxCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIGNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soJ2FpbV9oaXQnLCBmdW5jdGlvbiAoc2hvdCkKICAgICAgICAgICAgICAgIHNob3RzLmhpdHMgPSBzaG90cy5oaXRzICsgMQogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCdwbGF5ZXJfY29ubmVjdF9mdWxsJywgZnVuY3Rpb24gKGUpCiAgICAgICAgICAgICAgICBpZiBjbGllbnQudXNlcmlkX3RvX2VudGluZGV4KGVbJ3VzZXJpZCddKSB+PSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpIHRoZW4KICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIHNob3RzLmhpdHMgPSAwCiAgICAgICAgICAgICAgICBzaG90cy50b3RhbCA9IDAKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAoKICAgICAgICBjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCdwYWludF91aScsIGZ1bmN0aW9uICgpCiAgICAgICAgICAgIGxvY2FsIGxwID0gZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKQogICAgICAgICAgICBpZiBscCA9PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgbm90IHdpZGdldHMuZW5hYmxlZDpnZXQoKSBvciBub3Qgd2lkZ2V0cy5pdGVtczpoYXZlX2tleSgnSGl0IFJhdGUnKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBoaXRfcmF0ZSA9IHNob3RzLnRvdGFsIH49IDAgYW5kIChzaG90cy5oaXRzIC8gc2hvdHMudG90YWwgKiAxMDApIG9yIDEwMAoKICAgICAgICAgICAgcmVuZGVyZXIuaW5kaWNhdG9yKDI1NSwgMjU1LCAyNTUsIDIwMCwgZignJXMlZCUlJywgaGl0X3JhdGUgPD0gNTAgYW5kICfil6Nf4peiICcgb3IgJycsIGhpdF9yYXRlKSkKICAgICAgICBlbmQpCiAgICBlbmQKCiAgICAtLS1yZWdpb24gdHJhc2h0YWxrCiAgICBkbwogICAgICAgIGxvY2FsIHBocmFzZXMgPSB7CiAgICAgICAgICAgICLigoEiLCAi77yRIiwgIvCdn7ciLCAi8J2frSIsICLwnZ+PIiwgJyjimJ4gzaHCsCDNnMqWIM2hwrAp4pieIDEg4pml4pmlJywgJ+KctC7Ct8K0wq9gwrcuwrfimIUgIPCfjoAx8J+OgCAg4piFwrcuwrdgwq/CtMK3LuKctCcsICfinZrilojilZDilZAx4pWQ4pWQ4paI4p2aJywKICAgICAgICAgICAgJ8K7wrvCuyDwnZ+tIMKvXFxfKOODhClfL8KvJywgJ8KvYMK3LsK4wrguwrfCtMKvYMK3LsK4wrguMS7CuMK4LsK3YMKvwrTCty7CuMK4LsK3YMKv8J+SoycsICfCu8K7wrvCuzHCu8K7wrvCuycsICfiiJniiJnCt+KWq+KWq+G1kuG0vOG1kuKWq+KCkuKCkuKWq+G1kuG0vOKRoOG0vOG1kuKWq+KCkuKCkuKWq+G1kuG0vOG1kuKWq+KWq8K34oiZ4oiZJwogICAgICAgIH0KCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gdGFsaygpCiAgICAgICAgICAgIGNsaWVudC5leGVjKCJzYXkgIiAuLiBwaHJhc2VzW2dsb2JhbHMudGlja2NvdW50KCkgJSAjcGhyYXNlcyArIDFdKQogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBteV9raWxsZXIgPSAtMQogICAgICAgIGNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soJ3BsYXllcl9kZWF0aCcsIGZ1bmN0aW9uIChldmVudCkKICAgICAgICAgICAgaWYgbm90IHNldHRpbmdzLnR3ZWFrc19lbmFibGU6Z2V0KCkgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgbm90IHNldHRpbmdzLnR3ZWFrczpoYXZlX2tleSgnVHJhc2h0YWxrJykgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgZ2FtZV9ydWxlcyA9IGVudGl0eS5nZXRfZ2FtZV9ydWxlcygpCiAgICAgICAgICAgIGlmIG5vdCBnYW1lX3J1bGVzIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIGVudGl0eS5nZXRfcHJvcChnYW1lX3J1bGVzLCAnbV9iV2FybXVwUGVyaW9kJykgPT0gMSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBscCA9IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkKICAgICAgICAgICAgaWYgbHAgPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIHZpY3RpbSwgYXR0YWNrZXIgPSBjbGllbnQudXNlcmlkX3RvX2VudGluZGV4KGV2ZW50WyJ1c2VyaWQiXSksIGNsaWVudC51c2VyaWRfdG9fZW50aW5kZXgoZXZlbnRbImF0dGFja2VyIl0pCiAgICAgICAgICAgIGlmIHZpY3RpbSA9PSBhdHRhY2tlciB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBkbwogICAgICAgICAgICAgICAgaWYgdmljdGltID09IGxwIHRoZW4KICAgICAgICAgICAgICAgICAgICBteV9raWxsZXIgPSBhdHRhY2tlcgogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgbXlfa2lsbGVyIH49IC0xIGFuZCBhdHRhY2tlciB+PSBscCB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgbXlfa2lsbGVyID09IHZpY3RpbSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHRhbGsoKQogICAgICAgICAgICAgICAgICAgICAgICBteV9raWxsZXIgPSAtMQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgYXR0YWNrZXIgPT0gbHAgdGhlbgogICAgICAgICAgICAgICAgdGFsaygpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKCiAgICAgICAgY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygncm91bmRfcHJlc3RhcnQnLCBmdW5jdGlvbiAoKQogICAgICAgICAgICBteV9raWxsZXIgPSAtMQogICAgICAgIGVuZCkKICAgIGVuZAoKICAgIC0tLSByZWdpb24gdW5tdXRlCiAgICBkbwogICAgICAgIGxvY2FsIGZ1bmN0aW9uIGhhbmRsZV91bm11dGUoKQogICAgICAgICAgICBpZiBub3Qgc2V0dGluZ3MudHdlYWtzX2VuYWJsZTpnZXQoKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBub3Qgc2V0dGluZ3MudHdlYWtzOmhhdmVfa2V5KCdVbm11dGUgU2lsZW5jZWQgUGxheWVycycpIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZvciBpID0gMSwgZ2xvYmFscy5tYXhwbGF5ZXJzKCkgZG8KICAgICAgICAgICAgICAgIGlmIGVudGl0eS5nZXRfY2xhc3NuYW1lKGkpIH49ICdDQ1NQbGF5ZXInIHRoZW4KICAgICAgICAgICAgICAgICAgICBnb3RvIHNraXAKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIHV0aWxzLnVubXV0ZShpKQogICAgICAgICAgICAgICAgOjpza2lwOjoKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIHNldHRpbmdzLnR3ZWFrczpzZXRfY2FsbGJhY2soaGFuZGxlX3VubXV0ZSkKICAgICAgICBzZXR0aW5ncy50d2Vha3NfZW5hYmxlOnNldF9jYWxsYmFjayhoYW5kbGVfdW5tdXRlKQogICAgICAgIGNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soJ3BsYXllcl9jb25uZWN0X2Z1bGwnLCBoYW5kbGVfdW5tdXRlKQogICAgZW5kCgogICAgLS0tcmVnaW9uIGF1dG9wZWVrCiAgICBkbwogICAgICAgIGZ1bmN0aW9uIGF1dG9fcGVlay5wZXJmb3JtKGN0eCkKICAgICAgICAgICAgaWYgbm90IGFhX3R3ZWFrcy5lbmFibGU6Z2V0KCkgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgbm90IGFhX3R3ZWFrcy5pdGVtczpoYXZlX2tleSgnQXV0byBQZWVrIEltcHJvdmVtZW50cycpICB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBub3Qgc29mdHdhcmUuaXNfcXVpY2tfcGVla19hc3Npc3QoKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBjdHgueWF3X29mZnNldCA9IDAKICAgICAgICAgICAgY3R4Lnlhd19qaXR0ZXIgPSAnT2ZmJwogICAgICAgICAgICBjdHguYm9keV95YXcgPSAnT2ZmJwogICAgICAgICAgICBjdHguZnJlZXN0YW5kaW5nID0gdHJ1ZQogICAgICAgIGVuZAogICAgZW5kCgogICAgLS0tIHJlZ2lvbiB3YXRlcm1hcmsKICAgIGRvCiAgICAgICAgbG9jYWwgRlJBTUVSQVRFX0FWR19GUkFDID0gMC45CiAgICAgICAgCiAgICAgICAgbG9jYWwgY2xfdXBkYXRlcmF0ZSA9IGN2YXJbImNsX3VwZGF0ZXJhdGUiXQogICAgICAgIAogICAgICAgIGxvY2FsIGFscGhhID0gMC4wCiAgICAgICAgbG9jYWwgb2Zmc2V0ID0gdmVjdG9yKDYsIDUpCiAgICAgICAgCiAgICAgICAgbG9jYWwgdGltZXIgPSAwLjAKICAgICAgICBsb2NhbCBmcmFtZXJhdGUgPSAwLjAKICAgICAgICAKICAgICAgICBsb2NhbCBsYXN0X3BpbmcgPSAwLjAKICAgICAgICBsb2NhbCBsYXN0X2ZyYW1lcmF0ZSA9IDEgLyBnbG9iYWxzLmFic29sdXRlZnJhbWV0aW1lKCkKICAgICAgICAKICAgICAgICBsb2NhbCBsYXN0X3NlcnZlcl9mcmFtZXJhdGUgPSAwLjAKICAgICAgICBsb2NhbCBsYXN0X3NlcnZlcl92YXIgPSAwLjAKICAgICAgICAKICAgICAgICBsb2NhbCB0ZXh0dXJlIGRvCiAgICAgICAgICAgIGh0dHAuZ2V0KCJodHRwczovL2kuaW1ndXIuY29tLzZ2aU45VDIucG5nIiwgZnVuY3Rpb24oc3RhdHVzLCByZXNwb25zZSkKICAgICAgICAgICAgICAgIGlmIG5vdCBzdGF0dXMgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBjb2RlID0gcmVzcG9uc2Uuc3RhdHVzCiAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBjb2RlID49IDIwMCBhbmQgY29kZSA8IDMwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGV4dHVyZSA9IHJlbmRlcmVyLmxvYWRfcG5nKHJlc3BvbnNlLmJvZHksIDIyLCAyMikKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gZ2V0X2ZsYWdzKCkKICAgICAgICAgICAgcmV0dXJuICJkIgogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIGxvY2FsIGZ1bmN0aW9uIGdldF9waW5nKG5jaSkKICAgICAgICAgICAgaWYgaW5ldGNoYW5uZWwuaXNfbG9vcGJhY2sobmNpKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gbmlsCiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICBsb2NhbCBwaW5nID0gbWF0aC5tYXgoMCwgbGFzdF9waW5nICogMTAwMCkKICAgICAgICAgICAgcGluZyA9IG1hdGguZmxvb3IocGluZykKICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIGYoIiVkbXMiLCBwaW5nKQogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIGxvY2FsIGZ1bmN0aW9uIGdldF9mcmFtZXJhdGUoKQogICAgICAgICAgICBmcmFtZXJhdGUgPSBGUkFNRVJBVEVfQVZHX0ZSQUMgKiBmcmFtZXJhdGUgKyAoMS4wIC0gRlJBTUVSQVRFX0FWR19GUkFDKSAqIGdsb2JhbHMuYWJzb2x1dGVmcmFtZXRpbWUoKQogICAgICAgICAgICByZXR1cm4gbGFzdF9mcmFtZXJhdGUKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBsb2NhbCBmdW5jdGlvbiBnZXRfcmVtb3RlX2ZyYW1lcmF0ZSgpCiAgICAgICAgICAgIHJldHVybiBsYXN0X3NlcnZlcl9mcmFtZXJhdGUsIGxhc3Rfc2VydmVyX3ZhcgogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIGxvY2FsIGZ1bmN0aW9uIHVwZGF0ZV90aW1lcihuY2ksIGR0KQogICAgICAgICAgICB0aW1lciA9IHRpbWVyIC0gZHQKICAgICAgICAgICAgaWYgdGltZXIgPiAwIHRoZW4gcmV0dXJuIGVuZAogICAgICAgIAogICAgICAgICAgICBkbwogICAgICAgICAgICAgICAgbG9jYWwgbGF0ZW5jeSA9IGluZXRjaGFubmVsLmdldF9sYXRlbmN5KG5jaSwgMCkKICAgICAgICAgICAgICAgIGxvY2FsIHVwZGF0ZV9yYXRlID0gY2xfdXBkYXRlcmF0ZTpnZXRfZmxvYXQoKQogICAgICAgIAogICAgICAgICAgICAgICAgaWYgdXBkYXRlX3JhdGUgPiAwLjAwMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYWRqdXN0bWVudCA9IC0wLjUgLyB1cGRhdGVfcmF0ZQogICAgICAgICAgICAgICAgICAgIGxhdGVuY3kgPSBsYXRlbmN5ICsgYWRqdXN0bWVudAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgICAgICBsYXN0X3BpbmcgPSBsYXRlbmN5CiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICBsYXN0X3NlcnZlcl9mcmFtZXJhdGUsIGxhc3Rfc2VydmVyX3ZhciA9IGluZXRjaGFubmVsLmdldF9yZW1vdGVfZnJhbWVyYXRlKG5jaSkKICAgICAgICAgICAgbGFzdF9mcmFtZXJhdGUgPSBmcmFtZXJhdGUgPiAwIGFuZCBmcmFtZXJhdGUgb3IgMQogICAgICAgIAogICAgICAgICAgICB0aW1lciA9IHRpbWVyICsgMS4wCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gd2F0ZXJtYXJrLmZyYW1lKCkKICAgICAgICAgICAgbG9jYWwgY2FuX3Nob3dfd2F0ZXJtYXJrID0gd2lkZ2V0cy5lbmFibGVkOmdldCgpIGFuZCB3aWRnZXRzLml0ZW1zOmhhdmVfa2V5KCJXYXRlcm1hcmsiKQogICAgICAgICAgICBhbHBoYSA9IG1vdGlvbi5pbnRlcnAoYWxwaGEsIGNhbl9zaG93X3dhdGVybWFyaywgMC4wNDUpCiAgICAgICAgCiAgICAgICAgICAgIGlmIGFscGhhIDw9IDAgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICBsb2NhbCBscCA9IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkKICAgICAgICAgICAgaWYgbHAgPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgbG9jYWwgbmNpID0gaWVuZ2luZWNsaWVudC5nZXRfbmV0X2NoYW5uZWxfaW5mbygpCiAgICAgICAgICAgIHVwZGF0ZV90aW1lcihuY2ksIGdsb2JhbHMuZnJhbWV0aW1lKCkpCiAgICAgICAgCiAgICAgICAgICAgIGlmIG5jaSA9PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICBsb2NhbCBzY3JlZW4gPSB2ZWN0b3IoY2xpZW50LnNjcmVlbl9zaXplKCkpCiAgICAgICAgICAgIGxvY2FsIHBvcyA9IHZlY3RvcihzY3JlZW4ueCAtIDksIDkpCiAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIGZsYWdzID0gZ2V0X2ZsYWdzKCkKICAgICAgICAgICAgbG9jYWwgciwgZywgYiA9IHdpZGdldHMuY29sb3JfcGlja2VyOnJhd2dldCgpCiAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIGEgPSAyNTUKICAgICAgICAKICAgICAgICAgICAgbG9jYWwgcmFkaXVzID0gNQogICAgICAgIAogICAgICAgICAgICBsb2NhbCBkcmF3bGlzdCA9IHsgfQogICAgICAgIAogICAgICAgICAgICBkbwogICAgICAgICAgICAgICAgbG9jYWwgbGFiZWwgPSAiQWNpZFRlY2giCiAgICAgICAgICAgICAgICBsb2NhbCBidWlsZCA9IEJVSUxECiAgICAgICAgCiAgICAgICAgICAgICAgICBpZiB0ZXh0dXJlIH49IG5pbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgbGFiZWwgPSAiIgogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBidWlsZCA9PSAnYmV0YScgdGhlbiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgYnVpbGQgPSBmKCJbJXNdIiwgYnVpbGQpCiAgICAgICAgICAgICAgICAgICAgYnVpbGQgPSBkZWNvcmF0aW9ucy53YXZlKGJ1aWxkLCBnbG9iYWxzLnJlYWx0aW1lKCksIDI1NSwgMjU1LCAyNTUsIDI1NSwgciwgZywgYiwgYSkKICAgICAgICAgICAgICAgICAgICBidWlsZCA9IGYoIiVzXGFmZmZmZmZmZiIsIGJ1aWxkKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGRyYXdsaXN0WyNkcmF3bGlzdCArIDFdID0gbWVyZ2UoeyBsYWJlbCwgYnVpbGQgfSwgIlx4MjAiKQogICAgICAgICAgICAgICAgZWxzZSAgICAKICAgICAgICAgICAgICAgICAgICBkcmF3bGlzdFsjZHJhd2xpc3QgKyAxXSA9IGxhYmVsCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgIGlmIHdpZGdldHMuZGlzcGxheTpoYXZlX2tleSgiVXNlcm5hbWUiKSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBuaWNrbmFtZSA9IFVTRVJOQU1FCiAgICAgICAgCiAgICAgICAgICAgICAgICBpZiB3aWRnZXRzLmN1c3RvbV9uYW1lOmdldCgpIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBjaG9zZW5fbmlja25hbWUgPSB1aS5nZXQod2lkZ2V0cy5jdXN0b21fbmFtZV92YWx1ZTpnZXRfcmVmKCkpCiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgI2Nob3Nlbl9uaWNrbmFtZSB+PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbmlja25hbWUgPSBjaG9zZW5fbmlja25hbWUKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICAgICAgZHJhd2xpc3RbI2RyYXdsaXN0ICsgMV0gPSBuaWNrbmFtZQogICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgaWYgd2lkZ2V0cy5kaXNwbGF5OmhhdmVfa2V5KCJMYXRlbmN5IikgdGhlbgogICAgICAgICAgICAgICAgZHJhd2xpc3RbI2RyYXdsaXN0ICsgMV0gPSBnZXRfcGluZyhuY2kpCiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICBpZiB3aWRnZXRzLmRpc3BsYXk6aGF2ZV9rZXkoIkZQUyIpIHRoZW4KICAgICAgICAgICAgICAgIGRyYXdsaXN0WyNkcmF3bGlzdCArIDFdID0gZigiJWRmcHMiLCAxIC8gZ2V0X2ZyYW1lcmF0ZSgpKQogICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgaWYgd2lkZ2V0cy5kaXNwbGF5OmhhdmVfa2V5KCJTZXJ2ZXIgZnJhbWV0aW1lIikgdGhlbgogICAgICAgICAgICAgICAgZHJhd2xpc3RbI2RyYXdsaXN0ICsgMV0gPSBmKCJzdjogJS4xZiAoJS4xZm1zKSIsIGdldF9yZW1vdGVfZnJhbWVyYXRlKCkpCiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICBpZiB3aWRnZXRzLmRpc3BsYXk6aGF2ZV9rZXkoIlRpbWUiKSB0aGVuCiAgICAgICAgICAgICAgICBkcmF3bGlzdFsjZHJhd2xpc3QgKyAxXSA9IGYoIiUwMmQ6JTAyZCIsIGNsaWVudC5zeXN0ZW1fdGltZSgpKQogICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgbG9jYWwgbGVmdF9wYWRkaW5nID0gMAogICAgICAgIAogICAgICAgICAgICBpZiB0ZXh0dXJlIH49IG5pbCB0aGVuCiAgICAgICAgICAgICAgICBsZWZ0X3BhZGRpbmcgPSAyMAogICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgbG9jYWwgdGV4dCA9IG1lcmdlKGRyYXdsaXN0LCAiIOKImSAiKQogICAgICAgICAgICBsb2NhbCB0ZXh0X3NpemUgPSB2ZWN0b3IocmVuZGVyZXIubWVhc3VyZV90ZXh0KGZsYWdzLCB0ZXh0KSkKICAgICAgICAKICAgICAgICAgICAgbG9jYWwgcmVjdF9zaXplID0gdmVjdG9yKHRleHRfc2l6ZS54ICsgb2Zmc2V0LnggKiAyLCB0ZXh0X3NpemUueSArIG9mZnNldC55ICogMikKICAgICAgICAgICAgcmVjdF9zaXplLnggPSByZWN0X3NpemUueCArIGxlZnRfcGFkZGluZwogICAgICAgIAogICAgICAgICAgICBwb3MueCA9IHBvcy54IC0gcmVjdF9zaXplLngKICAgICAgICAKICAgICAgICAgICAgZ3JhcGhpY3MuaGVhZGVyKHBvcy54LCBwb3MueSwgcmVjdF9zaXplLngsIDIsIDUsIHIsIGcsIGIsIGEgKiBhbHBoYSkKICAgICAgICAgICAgLS1ncmFwaGljcy5nbG93KHBvcy54LCBwb3MueSwgcmVjdF9zaXplLngsIHJlY3Rfc2l6ZS55LCByLCBnLCBiLCBhICogMC4zICogYWxwaGEsIHRoaWNrbmVzcywgcmFkaXVzKQogICAgICAgICAgICBncmFwaGljcy5yZWN0YW5nbGUocG9zLngsIHBvcy55LCByZWN0X3NpemUueCwgcmVjdF9zaXplLnksIDAsIDAsIDAsIDEwMCAqIGFscGhhLCByYWRpdXMpCiAgICAgICAgCiAgICAgICAgICAgIGlmIHRleHR1cmUgfj0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIHJlbmRlcmVyLnRleHR1cmUodGV4dHVyZSwgcG9zLnggKyBvZmZzZXQueCAtIDEsIHBvcy55ICsgKHJlY3Rfc2l6ZS55IC0gMjEpICogMC41LCAyMiwgMjIsIDI1NSwgMjU1LCAyNTUsIDI1NSAqIGFscGhhLCAiZiIpCiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICBncmFwaGljcy50ZXh0KAogICAgICAgICAgICAgICAgcG9zLnggKyBsZWZ0X3BhZGRpbmcgKyBvZmZzZXQueCAtIDEsCiAgICAgICAgICAgICAgICBwb3MueSArIChyZWN0X3NpemUueSAtIHRleHRfc2l6ZS55KSAqIDAuNSwKICAgICAgICAgICAgICAgIDI1NSwgMjU1LCAyNTUsIDI1NSAqIGFscGhhLAogICAgICAgICAgICAgICAgZmxhZ3MsIDAsIHRleHQKICAgICAgICAgICAgKQogICAgICAgIGVuZAogICAgZW5kCgogICAgLS0tIHJlZ2lvbiBrZXliaW5kcwogICAgZG8KICAgICAgICBsb2NhbCBhbHBoYSA9IDAuMAogICAgICAgIGxvY2FsIHdpZHRoID0gMC4wCiAgICAgICAgbG9jYWwgaG9sZGluZyA9IDAuMAogICAgICAgIAogICAgICAgIGxvY2FsIGFsbF9ob3RrZXlzID0gewogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICByZWYgPSB7IHVpLnJlZmVyZW5jZSgiTGVnaXQiLCAiQWltYm90IiwgIkVuYWJsZWQiKSB9LAogICAgICAgICAgICAgICAgbmFtZSA9ICJMZWdpdCBBaW1ib3QiLAogICAgICAgICAgICAgICAgb2Zmc2V0ID0gMgogICAgICAgICAgICB9LAogICAgICAgIAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICByZWYgPSB7IHVpLnJlZmVyZW5jZSgiTGVnaXQiLCAiVHJpZ2dlcmJvdCIsICJFbmFibGVkIikgfSwKICAgICAgICAgICAgICAgIG5hbWUgPSAiTGVnaXQgVHJpZ2dlcmJvdCIsCiAgICAgICAgICAgICAgICBvZmZzZXQgPSAyCiAgICAgICAgICAgIH0sCiAgICAgICAgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJlZiA9IHsgdWkucmVmZXJlbmNlKCJSYWdlIiwgIkFpbWJvdCIsICJFbmFibGVkIikgfSwKICAgICAgICAgICAgICAgIG5hbWUgPSAiUmFnZSBBaW1ib3QiLAogICAgICAgICAgICAgICAgb2Zmc2V0ID0gMgogICAgICAgICAgICB9LAogICAgICAgIAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICByZWYgPSB7IHVpLnJlZmVyZW5jZSgiUmFnZSIsICJBaW1ib3QiLCAiTWluaW11bSBkYW1hZ2Ugb3ZlcnJpZGUiKSB9LAogICAgICAgICAgICAgICAgbmFtZSA9ICJNaW5pbXVtIERhbWFnZSIsCiAgICAgICAgICAgICAgICBvZmZzZXQgPSAyCiAgICAgICAgICAgIH0sCiAgICAgICAgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJlZiA9IHsgdWkucmVmZXJlbmNlKCJSYWdlIiwgIkFpbWJvdCIsICJGb3JjZSBzYWZlIHBvaW50IikgfSwKICAgICAgICAgICAgICAgIG5hbWUgPSAiU2FmZSBQb2ludCIsCiAgICAgICAgICAgICAgICBvZmZzZXQgPSAxCiAgICAgICAgICAgIH0sCiAgICAgICAgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJlZiA9IHsgdWkucmVmZXJlbmNlKCJSYWdlIiwgIkFpbWJvdCIsICJGb3JjZSBib2R5IGFpbSIpIH0sCiAgICAgICAgICAgICAgICBuYW1lID0gIkZvcmNlIEJvZHkgQWltIiwKICAgICAgICAgICAgICAgIG9mZnNldCA9IDEKICAgICAgICAgICAgfSwKICAgICAgICAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmVmID0geyB1aS5yZWZlcmVuY2UoIlJhZ2UiLCAiQWltYm90IiwgIkRvdWJsZSB0YXAiKSB9LAogICAgICAgICAgICAgICAgbmFtZSA9ICJEb3VibGUgVGFwIiwKICAgICAgICAgICAgICAgIG9mZnNldCA9IDIKICAgICAgICAgICAgfSwKICAgICAgICAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmVmID0geyB1aS5yZWZlcmVuY2UoIlJhZ2UiLCAiQWltYm90IiwgIlF1aWNrIHN0b3AiKSB9LAogICAgICAgICAgICAgICAgbmFtZSA9ICJRdWljayBTdG9wIiwKICAgICAgICAgICAgICAgIG9mZnNldCA9IDIKICAgICAgICAgICAgfSwKICAgICAgICAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmVmID0geyB1aS5yZWZlcmVuY2UoIlJhZ2UiLCAiT3RoZXIiLCAiUXVpY2sgcGVlayBhc3Npc3QiKSB9LAogICAgICAgICAgICAgICAgbmFtZSA9ICJRdWljayBQZWVrIEFzc2lzdCIsCiAgICAgICAgICAgICAgICBvZmZzZXQgPSAyCiAgICAgICAgICAgIH0sCiAgICAgICAgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJlZiA9IHsgdWkucmVmZXJlbmNlKCJSYWdlIiwgIk90aGVyIiwgIkR1Y2sgcGVlayBhc3Npc3QiKSB9LAogICAgICAgICAgICAgICAgbmFtZSA9ICJEdWNrIFBlZWsgQXNzaXN0IiwKICAgICAgICAgICAgICAgIG9mZnNldCA9IDEKICAgICAgICAgICAgfSwKICAgICAgICAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmVmID0geyB1aS5yZWZlcmVuY2UoIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJGcmVlc3RhbmRpbmciKSB9LAogICAgICAgICAgICAgICAgbmFtZSA9ICJGcmVlc3RhbmRpbmciLAogICAgICAgICAgICAgICAgb2Zmc2V0ID0gMgogICAgICAgICAgICB9LAogICAgICAgIAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICByZWYgPSB7IHVpLnJlZmVyZW5jZSgiQUEiLCAiT3RoZXIiLCAiU2xvdyBtb3Rpb24iKSB9LAogICAgICAgICAgICAgICAgbmFtZSA9ICJTbG93IE1vdGlvbiIsCiAgICAgICAgICAgICAgICBvZmZzZXQgPSAyCiAgICAgICAgICAgIH0sCiAgICAgICAgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJlZiA9IHsgdWkucmVmZXJlbmNlKCJBQSIsICJPdGhlciIsICJPbiBzaG90IGFudGktYWltIikgfSwKICAgICAgICAgICAgICAgIG5hbWUgPSAiT24gU2hvdCBBbnRpLWFpbSIsCiAgICAgICAgICAgICAgICBvZmZzZXQgPSAyCiAgICAgICAgICAgIH0sCiAgICAgICAgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJlZiA9IHsgdWkucmVmZXJlbmNlKCJBQSIsICJPdGhlciIsICJGYWtlIHBlZWsiKSB9LAogICAgICAgICAgICAgICAgbmFtZSA9ICJGYWtlIFBlZWsiLAogICAgICAgICAgICAgICAgb2Zmc2V0ID0gMgogICAgICAgICAgICB9LAogICAgICAgIAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICByZWYgPSB7IHVpLnJlZmVyZW5jZSgiTWlzYyIsICJNb3ZlbWVudCIsICJaLUhvcCIpIH0sCiAgICAgICAgICAgICAgICBuYW1lID0gIlotSG9wIiwKICAgICAgICAgICAgICAgIG9mZnNldCA9IDIKICAgICAgICAgICAgfSwKICAgICAgICAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmVmID0geyB1aS5yZWZlcmVuY2UoIk1pc2MiLCAiTW92ZW1lbnQiLCAiUHJlLXNwZWVkIikgfSwKICAgICAgICAgICAgICAgIG5hbWUgPSAiUHJlLXNwZWVkIiwKICAgICAgICAgICAgICAgIG9mZnNldCA9IDIKICAgICAgICAgICAgfSwKICAgICAgICAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmVmID0geyB1aS5yZWZlcmVuY2UoIk1pc2MiLCAiTW92ZW1lbnQiLCAiQmxvY2tib3QiKSB9LAogICAgICAgICAgICAgICAgbmFtZSA9ICJCbG9ja2JvdCIsCiAgICAgICAgICAgICAgICBvZmZzZXQgPSAyCiAgICAgICAgICAgIH0sCiAgICAgICAgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJlZiA9IHsgdWkucmVmZXJlbmNlKCJNaXNjIiwgIk1vdmVtZW50IiwgIkp1bXAgYXQgZWRnZSIpIH0sCiAgICAgICAgICAgICAgICBuYW1lID0gIkp1bXAgQXQgRWRnZSIsCiAgICAgICAgICAgICAgICBvZmZzZXQgPSAyCiAgICAgICAgICAgIH0sCiAgICAgICAgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJlZiA9IHsgdWkucmVmZXJlbmNlKCJNaXNjIiwgIk1pc2NlbGxhbmVvdXMiLCAiTGFzdCBzZWNvbmQgZGVmdXNlIikgfSwKICAgICAgICAgICAgICAgIG5hbWUgPSAiTGFzdCBTZWNvbmQgRGVmdXNlIiwKICAgICAgICAgICAgICAgIG9mZnNldCA9IDEKICAgICAgICAgICAgfSwKICAgICAgICAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmVmID0geyB1aS5yZWZlcmVuY2UoIk1pc2MiLCAiTWlzY2VsbGFuZW91cyIsICJGcmVlIGxvb2siKSB9LAogICAgICAgICAgICAgICAgbmFtZSA9ICJGcmVlIExvb2siLAogICAgICAgICAgICAgICAgb2Zmc2V0ID0gMQogICAgICAgICAgICB9LAogICAgICAgIAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICByZWYgPSB7IHVpLnJlZmVyZW5jZSgiTWlzYyIsICJNaXNjZWxsYW5lb3VzIiwgIlBpbmcgc3Bpa2UiKSB9LAogICAgICAgICAgICAgICAgbmFtZSA9ICJQaW5nIFNwaWtlIiwKICAgICAgICAgICAgICAgIG9mZnNldCA9IDIKICAgICAgICAgICAgfSwKICAgICAgICAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmVmID0geyB1aS5yZWZlcmVuY2UoIk1pc2MiLCAiTWlzY2VsbGFuZW91cyIsICJBdXRvbWF0aWMgZ3JlbmFkZSByZWxlYXNlIikgfSwKICAgICAgICAgICAgICAgIG5hbWUgPSAiR3JlbmFkZSBSZWxlYXNlIiwKICAgICAgICAgICAgICAgIG9mZnNldCA9IDIKICAgICAgICAgICAgfSwKICAgICAgICAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmVmID0geyB1aS5yZWZlcmVuY2UoIlZpc3VhbHMiLCAiUGxheWVyIEVTUCIsICJBY3RpdmF0aW9uIHR5cGUiKSB9LAogICAgICAgICAgICAgICAgbmFtZSA9ICJWaXN1YWxzIiwKICAgICAgICAgICAgICAgIG9mZnNldCA9IDEKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBsb2NhbCBhY3RpdmVfa2V5cyA9IHsgfQogICAgICAgIGxvY2FsIGhvdGtleV9tb2RlcyA9IHsgImhvbGRpbmciLCAidG9nZ2xlZCIsICJkaXNhYmxlZCIgfQogICAgICAgIAogICAgICAgIGxvY2FsIGZ1bmN0aW9uIGdldF9mbGFncygpCiAgICAgICAgICAgIHJldHVybiAiZCIKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBsb2NhbCBmdW5jdGlvbiBnZXRfaGFuZGxlKCkKICAgICAgICAgICAgbG9jYWwgZmxhZ3MgPSBnZXRfZmxhZ3MoKQogICAgICAgICAgICBsb2NhbCBleGlzdGVudF9rZXlzID0geyB9CiAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIGFsbF9hY3RpdmUgPSBmYWxzZQogICAgICAgICAgICBsb2NhbCBuYW1lX3dpZHRoLCBtb2RlX3dpZHRoID0gMCwgMAogICAgICAgIAogICAgICAgICAgICBmb3IgaSA9IDEsICNhbGxfaG90a2V5cyBkbwogICAgICAgICAgICAgICAgbG9jYWwgaG90a2V5ID0gYWxsX2hvdGtleXNbaV0KICAgICAgICAgICAgICAgIGxvY2FsIHVuaXF1ZV9pZCA9IGhvdGtleS5yZWZbMV0KICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIG5hbWUgPSBob3RrZXkubmFtZQogICAgICAgICAgICAgICAgbG9jYWwgb2Zmc2V0ID0gaG90a2V5Lm9mZnNldCBvciAxCiAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBhY3RpdmUgPSB0cnVlCiAgICAgICAgICAgICAgICBsb2NhbCBjb2xsZWN0ZWQgPSB7IH0KICAgICAgICAKICAgICAgICAgICAgICAgIGZvciBqID0gMSwgb2Zmc2V0IGRvCiAgICAgICAgICAgICAgICAgICAgY29sbGVjdGVkW2pdID0gaG90a2V5LnJlZltqXQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgICAgICBmb3IgaiA9IDEsIG9mZnNldCBkbwogICAgICAgICAgICAgICAgICAgIGlmIG5vdCB1aS5nZXQoY29sbGVjdGVkW2pdKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGFjdGl2ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgZXhpc3RlbnRfa2V5c1t1bmlxdWVfaWRdID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIGFsbF9hY3RpdmUgPSB0cnVlCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIF8sIG1vZGUgPSB1aS5nZXQoY29sbGVjdGVkWyNjb2xsZWN0ZWRdKQogICAgICAgICAgICAgICAgaWYgbW9kZSA9PSAwIHRoZW4gZ290byBjb250aW51ZSBlbmQKICAgICAgICAKICAgICAgICAgICAgICAgIG1vZGUgPSBob3RrZXlfbW9kZXNbbW9kZV0gb3IgIn4iCiAgICAgICAgICAgICAgICBtb2RlID0gbWVyZ2UgeyAiWyIsIG1vZGUsICJdIiB9CiAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBhY3RpdmVfa2V5c1t1bmlxdWVfaWRdID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgYWN0aXZlX2tleXNbdW5pcXVlX2lkXSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgYWxwaGEgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQgPSAwLAogICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBuYW1lX3dpZHRoID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgbW9kZV93aWR0aCA9IDAsCiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICBtb2RlID0gbW9kZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgdmFsdWUgPSBhY3RpdmVfa2V5c1t1bmlxdWVfaWRdIGRvCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgbmFtZV9zaXplID0gdmVjdG9yKHJlbmRlcmVyLm1lYXN1cmVfdGV4dChmbGFncywgbmFtZSkpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgbW9kZV93aWR0aCA9IHZlY3RvcihyZW5kZXJlci5tZWFzdXJlX3RleHQoZmxhZ3MsIG1vZGUpKQogICAgICAgIAogICAgICAgICAgICAgICAgICAgIHZhbHVlLm5hbWUgPSBuYW1lCiAgICAgICAgICAgICAgICAgICAgdmFsdWUubW9kZSA9IG1vZGUKICAgICAgICAKICAgICAgICAgICAgICAgICAgICB2YWx1ZS5oZWlnaHQgPSBtYXRoLm1heChuYW1lX3NpemUueSwgbW9kZV93aWR0aC55KQogICAgICAgIAogICAgICAgICAgICAgICAgICAgIHZhbHVlLm5hbWVfd2lkdGggPSBuYW1lX3NpemUueAogICAgICAgICAgICAgICAgICAgIHZhbHVlLm1vZGVfd2lkdGggPSBtb2RlX3dpZHRoLngKICAgICAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICAgICAgOjpjb250aW51ZTo6CiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICBmb3IgaywgdiBpbiBwYWlycyhhY3RpdmVfa2V5cykgZG8KICAgICAgICAgICAgICAgIGxvY2FsIGFjdGl2ZSA9IGV4aXN0ZW50X2tleXNba10gfj0gbmlsCiAgICAgICAgCiAgICAgICAgICAgICAgICB2LmFscGhhID0gbW90aW9uLmludGVycCh2LmFscGhhLCBhY3RpdmUsIDAuMDQ1KQogICAgICAgIAogICAgICAgICAgICAgICAgaWYgdi5hbHBoYSA8PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICBhY3RpdmVfa2V5c1trXSA9IG5pbAogICAgICAgICAgICAgICAgZWxzZWlmIGFjdGl2ZSBvciB2LmFscGhhID49IDAuMjUgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIG5hbWVfd2lkdGggPCB2Lm5hbWVfd2lkdGggdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBuYW1lX3dpZHRoID0gdi5uYW1lX3dpZHRoCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgbW9kZV93aWR0aCA8IHYubW9kZV93aWR0aCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVfd2lkdGggPSB2Lm1vZGVfd2lkdGgKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIGFjdGl2ZV9rZXlzLCBhbGxfYWN0aXZlLCBuYW1lX3dpZHRoLCBtb2RlX3dpZHRoCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAga2V5YmluZHMuZW5hYmxlZCA9IG1lbnUubmV3X2l0ZW0odWkubmV3X2NoZWNrYm94LCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIktleWJpbmRzIikKICAgICAgICA6IHJlY29yZCgidmlzdWFscyIsICJrZXliaW5kczo6ZW5hYmxlZCIpCiAgICAgICAgOiBzYXZlKCkKICAgICAgICAKICAgICAgICBrZXliaW5kcy53aW5kb3cgPSB3aW5kb3dzLm5ldygiIyNrZXliaW5kcyIsIDAuMDI1LCAwLjQxNSkKICAgICAgICBrZXliaW5kcy53aW5kb3c6c2V0X3NpemUodmVjdG9yKDEyNSwgMjIpKQogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIGtleWJpbmRzLmZyYW1lKCkKICAgICAgICAgICAgbG9jYWwgbWUgPSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpCiAgICAgICAgICAgIGlmIG1lID09IG5pbCB0aGVuIHJldHVybiBlbmQKICAgICAgICAKICAgICAgICAgICAgbG9jYWwgd2luZG93ID0ga2V5YmluZHMud2luZG93CiAgICAgICAgICAgIGxvY2FsIGhvdGtleXMsIGFsbF9hY3RpdmUsIG5hbWVfd2lkdGgsIG1vZGVfd2lkdGggPSBnZXRfaGFuZGxlKCkKICAgICAgICAKICAgICAgICAgICAgbG9jYWwgbWVudV9jaGVjayA9IHVpLmlzX21lbnVfb3BlbigpIG9yIChuZXh0KGhvdGtleXMpIH49IG5pbCBhbmQgYWxsX2FjdGl2ZSkKICAgICAgICAgICAgbG9jYWwgY2FuX3Nob3dfaG90a2V5cyA9IHdpZGdldHMuZW5hYmxlZDpnZXQoKSBhbmQgd2lkZ2V0cy5pdGVtczpoYXZlX2tleSgiS2V5YmluZHMiKSBhbmQgbWVudV9jaGVjawogICAgICAgIAogICAgICAgICAgICBhbHBoYSA9IG1vdGlvbi5pbnRlcnAoYWxwaGEsIGNhbl9zaG93X2hvdGtleXMsIDAuMDQ1KQogICAgICAgICAgICBob2xkaW5nID0gbW90aW9uLmludGVycChob2xkaW5nLCAoY2FuX3Nob3dfaG90a2V5cyBhbmQgd2luZG93OmlzX2RyYWdnaW5nKCkpIGFuZCAwLjYgb3IgMS4wLCAwLjA0NSkKICAgICAgICAKICAgICAgICAgICAgaWYgYWxwaGEgPD0gMCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIGZsYWdzID0gZ2V0X2ZsYWdzKCkKICAgICAgICAgICAgbG9jYWwgciwgZywgYiA9IHdpZGdldHMuY29sb3JfcGlja2VyOmdldCgpCiAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIGEgPSAyNTUKICAgICAgICAKICAgICAgICAgICAgbG9jYWwgcmFkaXVzID0gNQogICAgICAgICAgICBsb2NhbCB0aGlja25lc3MgPSAxMAogICAgICAgIAogICAgICAgICAgICBsb2NhbCBvZmZzZXRfaW5zID0gdmVjdG9yKDEwLCA1KQogICAgICAgIAogICAgICAgICAgICBsb2NhbCBrZXl2YWxfZ2FwID0gMjAKICAgICAgICAgICAgbG9jYWwga2V5dmFsX3JvdW5kaW5nID0gbWF0aC5mbG9vcihyYWRpdXMgKiAuNSkKICAgICAgICAKICAgICAgICAgICAgLS0gaGVhZGVyCiAgICAgICAgICAgIGxvY2FsIHBvcyA9IHdpbmRvdy5wb3MKICAgICAgICAKICAgICAgICAgICAgbG9jYWwgdGV4dCA9ICJrZXliaW5kcyIKICAgICAgICAgICAgbG9jYWwgdGV4dF9zaXplID0gdmVjdG9yKHJlbmRlcmVyLm1lYXN1cmVfdGV4dChmbGFncywgdGV4dCkpCiAgICAgICAgICAgIGxvY2FsIHRleHRfc2l6ZV9iYXNlID0gdmVjdG9yKHJlbmRlcmVyLm1lYXN1cmVfdGV4dChmbGFncywgIlx2IikpCiAgICAgICAgCiAgICAgICAgICAgIHdpZHRoID0gbW90aW9uLmludGVycCh3aWR0aCwgbWF0aC5tYXgoCiAgICAgICAgICAgICAgICBvZmZzZXRfaW5zLnggKiA0ICsgdGV4dF9zaXplLnggKiAodGV4dF9zaXplLnkgLyB0ZXh0X3NpemVfYmFzZS55KSwKICAgICAgICAgICAgICAgIGtleXZhbF9yb3VuZGluZyAqIDIgKyBuYW1lX3dpZHRoICsgbW9kZV93aWR0aCArIGtleXZhbF9nYXAsCiAgICAgICAgICAgICAgICAxMjUKICAgICAgICAgICAgKSwgMC4wNDUpCiAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIG1heF93aWR0aCA9IG1hdGguZmxvb3Iod2lkdGggKyAwLjg1KQogICAgICAgICAgICBsb2NhbCByZWN0X3NpemUgPSB2ZWN0b3IobWF4X3dpZHRoLCB0ZXh0X3NpemUueSArIG9mZnNldF9pbnMueSAqIDIpCiAgICAgICAgCiAgICAgICAgICAgIGlmIGFscGhhID4gMC41IHRoZW4KICAgICAgICAgICAgICAgIGdyYXBoaWNzLmJsdXIocG9zLngsIHBvcy55LCByZWN0X3NpemUueCwgcmVjdF9zaXplLnkpCiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICBncmFwaGljcy5oZWFkZXIocG9zLngsIHBvcy55LCByZWN0X3NpemUueCwgMiwgNSwgciwgZywgYiwgYSAqIGFscGhhICogaG9sZGluZykKICAgICAgICAgICAgZ3JhcGhpY3MuZ2xvdyhwb3MueCwgcG9zLnksIHJlY3Rfc2l6ZS54LCByZWN0X3NpemUueSwgciwgZywgYiwgYSAqIDAuMyAqIGFscGhhICogaG9sZGluZywgdGhpY2tuZXNzLCByYWRpdXMpCiAgICAgICAgICAgIGdyYXBoaWNzLnJlY3RhbmdsZShwb3MueCwgcG9zLnksIHJlY3Rfc2l6ZS54LCByZWN0X3NpemUueSwgMCwgMCwgMCwgMTAwICogYWxwaGEgKiBob2xkaW5nLCByYWRpdXMpCiAgICAgICAgCiAgICAgICAgICAgIHJlbmRlcmVyLnRleHQoCiAgICAgICAgICAgICAgICBwb3MueCArIChyZWN0X3NpemUueCAtIHRleHRfc2l6ZS54KSAqIDAuNSwKICAgICAgICAgICAgICAgIHBvcy55ICsgKHJlY3Rfc2l6ZS55IC0gdGV4dF9zaXplLnkpICogMC41LAogICAgICAgICAgICAgICAgMjU1LCAyNTUsIDI1NSwgMjU1ICogYWxwaGEgKiBob2xkaW5nLAogICAgICAgICAgICAgICAgZmxhZ3MsIDAsIHRleHQKICAgICAgICAgICAgKQogICAgICAgIAogICAgICAgICAgICAtLSBjb250ZW50cwogICAgICAgICAgICBsb2NhbCBvZmZzZXQgPSAyCiAgICAgICAgCiAgICAgICAgICAgIGZvciBfLCB2IGluIHBhaXJzKGFjdGl2ZV9rZXlzKSBkbwogICAgICAgICAgICAgICAgbG9jYWwgYWxwaGEgPSBhbHBoYSAqIHYuYWxwaGEKICAgICAgICAgICAgICAgIGxvY2FsIHRleHRfc2l6ZSwgdGV4dF9hbHBoYSA9IHZlY3Rvcih2Lm5hbWVfd2lkdGgsIHYuaGVpZ2h0KSwgMAogICAgICAgIAogICAgICAgICAgICAgICAgaWYgYWxwaGEgPj0gMC4yNSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGV4dF9hbHBoYSA9IG1hdGgubWluKDEuMCwgdXRpbHMubWFwKGFscGhhLCAwLjI1LCAxLjAsIDAuMCwgMS4yKSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgdGV4dF9wb3NpdGlvbiA9IHZlY3Rvcihwb3MueCArIGtleXZhbF9yb3VuZGluZywgcG9zLnkgKyByZWN0X3NpemUueSArIDQgKyBvZmZzZXQpCiAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCB2YWx1ZV9zdGFydCA9IHJlY3Rfc2l6ZS54IC0gdi5tb2RlX3dpZHRoCiAgICAgICAgICAgICAgICBsb2NhbCB2YWx1ZV9hbHBoYSA9IHV0aWxzLm1hcCh2YWx1ZV9zdGFydCAtIHYubmFtZV93aWR0aCwgMC4wLCBrZXl2YWxfZ2FwLCAwLjAsIDEuMCwgdHJ1ZSkKICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIGhfYWxwaGEgPSB0ZXh0X2FscGhhICogaG9sZGluZwogICAgICAgIAogICAgICAgICAgICAgICAgcmVuZGVyZXIudGV4dCh0ZXh0X3Bvc2l0aW9uLngsIHRleHRfcG9zaXRpb24ueSwgMjU1LCAyNTUsIDI1NSwgMjU1ICogaF9hbHBoYSwgZmxhZ3MsIDAsIHYubmFtZSkKICAgICAgICAgICAgICAgIHJlbmRlcmVyLnRleHQodGV4dF9wb3NpdGlvbi54ICsgcmVjdF9zaXplLnggLSBrZXl2YWxfcm91bmRpbmcgKiAyIC0gdi5tb2RlX3dpZHRoLCB0ZXh0X3Bvc2l0aW9uLnksIDI1NSwgMjU1LCAyNTUsIDI1NSAqIGhfYWxwaGEgKiB2YWx1ZV9hbHBoYSwgZmxhZ3MsIDAsIHYubW9kZSkKICAgICAgICAKICAgICAgICAgICAgICAgIG9mZnNldCA9IG9mZnNldCArIHRleHRfYWxwaGEgKiAodGV4dF9zaXplLnkgKyB0ZXh0X3NpemUueSAqIDAuMzUpCiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICB3aW5kb3c6c2V0X3NpemUocmVjdF9zaXplKQogICAgICAgICAgICB3aW5kb3c6dXBkYXRlKCkKICAgICAgICBlbmQKICAgIGVuZAoKICAgIC0tLSByZWdpb24gaW5kaWNhdG9ycwogICAgZG8KICAgICAgICBsb2NhbCBhbHBoYSA9IDAuMAogICAgICAgIGxvY2FsIGFsaWduID0gMC4wCiAgICAgICAgCiAgICAgICAgbG9jYWwgZGFtYWdlX2FscGhhID0gMC4wCiAgICAgICAgbG9jYWwgZGFtYWdlX3ZhbHVlID0gMC4wCiAgICAgICAgbG9jYWwgZGFtYWdlX21vdmluZyA9IDAuMAogICAgICAgIGxvY2FsIGRhbWFnZV9ob2xkaW5nID0gMC4wCiAgICAgICAgCiAgICAgICAgbG9jYWwgc2NyZWVuID0gdmVjdG9yKGNsaWVudC5zY3JlZW5fc2l6ZSgpKQogICAgICAgIGxvY2FsIHdpbmRvdyA9IHdpbmRvd3MubmV3KCIjI2RhbWFnZSIsIDAuNSArIDE1IC8gc2NyZWVuLngsIDAuNSAtIDE1IC8gc2NyZWVuLnkpCiAgICAgICAgCiAgICAgICAgd2luZG93OnNldF9hbmNob3IodmVjdG9yKDAuMCwgMS4wKSkKICAgICAgICB3aW5kb3c6c2V0X3NpemUodmVjdG9yKDIyLCAyMikpCiAgICAgICAgCiAgICAgICAgbG9jYWwgZmVhdHVyZXMgPSB7CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGdldCA9IHNvZnR3YXJlLmlzX2RvdWJsZV90YXAsCiAgICAgICAgICAgICAgICB0ZXh0ID0gIkRUIiwKICAgICAgICAgICAgICAgIGFscGhhID0gMAogICAgICAgICAgICB9LAogICAgICAgIAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBnZXQgPSBzb2Z0d2FyZS5pc19vbl9zaG90X2FudGlhaW0sCiAgICAgICAgICAgICAgICB0ZXh0ID0gIkhTIiwKICAgICAgICAgICAgICAgIGFscGhhID0gMAogICAgICAgICAgICB9LAogICAgICAgIAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBnZXQgPSBzb2Z0d2FyZS5pc19kdWNrX3BlZWtfYXNzaXN0LAogICAgICAgICAgICAgICAgdGV4dCA9ICJGRCIsCiAgICAgICAgICAgICAgICBhbHBoYSA9IDAKICAgICAgICAgICAgfSwKICAgICAgICAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgZ2V0ID0gc29mdHdhcmUuaXNfbWluaW11bV9kYW1hZ2Vfb3ZlcnJpZGUsCiAgICAgICAgICAgICAgICB0ZXh0ID0gIkRNRyIsCiAgICAgICAgICAgICAgICBhbHBoYSA9IDAKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBsb2NhbCBmdW5jdGlvbiBnZXRfc3RhdGVtZW50KCkKICAgICAgICAgICAgaWYgc29mdHdhcmUuaXNfZWRnZSgpIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiAnRURHRScKICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgIGlmIHNhZmVfaGVhZC5nZXQoKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gIlNBRkUiCiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICBpZiBsb2NhbHBsYXllci5pc19haXJib3JuZSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gIkFJUiIKICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgIGlmIGxvY2FscGxheWVyLmlzX2Nyb3VjaGVkIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiAiQ1JPVUNIIgogICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgaWYgbG9jYWxwbGF5ZXIuaXNfbW92aW5nIHRoZW4KICAgICAgICAgICAgICAgIGlmIHNvZnR3YXJlLmlzX3Nsb3dfbW90aW9uKCkgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybiAiUy5XQUxLIgogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gIlJVTiIKICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgIHJldHVybiAiU1RBTkQiCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgY3R4X2JlYnJhLmNvbmRpdGlvbiA9IGdldF9zdGF0ZW1lbnQKICAgICAgICAKICAgICAgICBmdW5jdGlvbiBpbmRpY2F0b3JzLmZyYW1lKCkKICAgICAgICAgICAgbG9jYWwgbWUgPSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpCiAgICAgICAgICAgIGlmIG1lID09IG5pbCB0aGVuIHJldHVybiBlbmQKICAgICAgICAKICAgICAgICAgICAgbG9jYWwgd3BuID0gZW50aXR5LmdldF9wbGF5ZXJfd2VhcG9uKG1lKQogICAgICAgICAgICBpZiB3cG4gPT0gbmlsIHRoZW4gcmV0dXJuIGVuZAogICAgICAgIAogICAgICAgICAgICBsb2NhbCB3cG5faW5mbyA9IGNzZ29fd2VhcG9ucyh3cG4pCiAgICAgICAgICAgIGlmIHdwbl9pbmZvID09IG5pbCB0aGVuIHJldHVybiBlbmQKICAgICAgICAKICAgICAgICAgICAgbG9jYWwgbWVudV9jaGVjayA9IHVpLmlzX21lbnVfb3BlbigpCiAgICAgICAgICAgIGxvY2FsIGFsaXZlX2NoZWNrID0gZW50aXR5LmlzX2FsaXZlKG1lKQogICAgICAgIAogICAgICAgICAgICBsb2NhbCBzY29wZWRfY2hlY2sgPSBlbnRpdHkuZ2V0X3Byb3AobWUsICJtX2JJc1Njb3BlZCIpCiAgICAgICAgICAgIGxvY2FsIGdyZW5hZGVfY2hlY2sgPSB3cG5faW5mby53ZWFwb25fdHlwZV9pbnQgPT0gOQogICAgICAgIAogICAgICAgICAgICBsb2NhbCBkYW1hZ2UgPSBzb2Z0d2FyZS5nZXRfbWluaW11bV9kYW1hZ2UoKQogICAgICAgIAogICAgICAgICAgICBsb2NhbCBjYW5fc2hvd19pbmRpY2F0b3JzID0gd2lkZ2V0cy5lbmFibGVkOmdldCgpIGFuZCB3aWRnZXRzLml0ZW1zOmhhdmVfa2V5KCJDcm9zc2hhaXIgSW5kaWNhdG9yIikgYW5kIGFsaXZlX2NoZWNrCiAgICAgICAgICAgIGxvY2FsIGNhbl9tb3ZlX2luZGljYXRvcnMgPSBjYW5fc2hvd19pbmRpY2F0b3JzIGFuZCBzY29wZWRfY2hlY2sgPT0gMQogICAgICAgIAogICAgICAgICAgICBsb2NhbCBjYW5fc2hvd19kYW1hZ2UgPSB3aWRnZXRzLmVuYWJsZWQ6Z2V0KCkgYW5kIHdpZGdldHMuaXRlbXM6aGF2ZV9rZXkoIkRhbWFnZSBJbmRpY2F0b3IiKSBhbmQgbm90ICh3cG5faW5mby53ZWFwb25fdHlwZV9pbnQgPT0gMCBvciB3cG5faW5mby53ZWFwb25fdHlwZV9pbnQgPT0gOSkKICAgICAgICAgICAgbG9jYWwgY2FuX21vdmVfZGFtYWdlID0gY2FuX3Nob3dfZGFtYWdlIGFuZCBtZW51X2NoZWNrCiAgICAgICAgCiAgICAgICAgICAgIGFscGhhID0gbW90aW9uLmludGVycChhbHBoYSwgY2FuX3Nob3dfaW5kaWNhdG9ycyBhbmQgKGdyZW5hZGVfY2hlY2sgYW5kIDAuNCBvciAxLjApIG9yIDAuMCwgMC4wNDUpCiAgICAgICAgICAgIGFsaWduID0gbW90aW9uLmludGVycChhbGlnbiwgY2FuX21vdmVfaW5kaWNhdG9ycywgMC4wNDUpCiAgICAgICAgCiAgICAgICAgICAgIGRhbWFnZV9hbHBoYSA9IG1vdGlvbi5pbnRlcnAoZGFtYWdlX2FscGhhLCBjYW5fc2hvd19kYW1hZ2UsIDAuMDQ1KQogICAgICAgICAgICBkYW1hZ2VfdmFsdWUgPSBtb3Rpb24uaW50ZXJwKGRhbWFnZV92YWx1ZSwgZGFtYWdlLCAwLjA0NSkKICAgICAgICAgICAgZGFtYWdlX21vdmluZyA9IG1vdGlvbi5pbnRlcnAoZGFtYWdlX21vdmluZywgY2FuX21vdmVfZGFtYWdlLCAwLjA0NSkKICAgICAgICAgICAgZGFtYWdlX2hvbGRpbmcgPSBtb3Rpb24uaW50ZXJwKGRhbWFnZV9ob2xkaW5nLCAoY2FuX21vdmVfZGFtYWdlIGFuZCB3aW5kb3c6aXNfZHJhZ2dpbmcoKSkgYW5kIDAuNiBvciAxLjAsIDAuMDQ1KQogICAgICAgIAogICAgICAgICAgICBsb2NhbCBmbGFncyA9ICItZCIKICAgICAgICAgICAgbG9jYWwgY2xvY2sgPSBnbG9iYWxzLnJlYWx0aW1lKCkKICAgICAgICAKICAgICAgICAgICAgbG9jYWwgc2NyZWVuID0gdmVjdG9yKGNsaWVudC5zY3JlZW5fc2l6ZSgpKQogICAgICAgICAgICBsb2NhbCBjZW50ZXIgPSBzY3JlZW4gKiAwLjUKICAgICAgICAKICAgICAgICAgICAgbG9jYWwgcjEsIGcxLCBiMSA9IHdpZGdldHMuY29sb3JfcGlja2VyOnJhd2dldCgpCiAgICAgICAgICAgIGxvY2FsIHIyLCBnMiwgYjIsIGEyID0gMjU1LCAyNTUsIDI1NSwgMjU1CiAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIHIsIGcsIGIsIGEgPSB1dGlscy5jb2xvcl9sZXJwKAogICAgICAgICAgICAgICAgcjEsIGcxLCBiMSwgMjU1LAogICAgICAgICAgICAgICAgcjIsIGcyLCBiMiwgYTIsCiAgICAgICAgICAgICAgICB1dGlscy5icmVhdGhlKGNsb2NrICsgMC41IC0gMC41ICogYWxpZ24pCiAgICAgICAgICAgICkKICAgICAgICAKICAgICAgICAgICAgLS0gZGFtYWdlCiAgICAgICAgICAgIGlmIGRhbWFnZV9hbHBoYSA+IDAgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgdmFsdWUgPSB1dGlscy5yb3VuZChkYW1hZ2VfdmFsdWUpCiAgICAgICAgICAgICAgICBsb2NhbCB0ZXh0ID0gZigiJWQiLCB2YWx1ZSkKICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGRhbWFnZSA9PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gIkFVVE8iCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHZhbHVlID4gMTAwIHRoZW4KICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gZigiSFAgKyVkIiwgdmFsdWUgLSAxMDApCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIG1lYXN1cmUgPSB2ZWN0b3IocmVuZGVyZXIubWVhc3VyZV90ZXh0KGZsYWdzLCB0ZXh0KSkKICAgICAgICAgICAgICAgIG1lYXN1cmUueCA9IG1lYXN1cmUueCArIDEKICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIHBvcyA9IHdpbmRvdy5wb3M6Y2xvbmUoKQogICAgICAgICAgICAgICAgbG9jYWwgcmVjdF9zaXplID0gdmVjdG9yKG1lYXN1cmUueCArIDE4LCBtZWFzdXJlLnkgKyAxNikKICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIHRleHRfcG9zaXRpb24gPSBwb3M6Y2xvbmUoKQogICAgICAgIAogICAgICAgICAgICAgICAgdGV4dF9wb3NpdGlvbi54ID0gdGV4dF9wb3NpdGlvbi54ICsgKHJlY3Rfc2l6ZS54IC0gbWVhc3VyZS54KSAqIDAuNQogICAgICAgICAgICAgICAgdGV4dF9wb3NpdGlvbi55ID0gdGV4dF9wb3NpdGlvbi55ICsgKHJlY3Rfc2l6ZS55IC0gbWVhc3VyZS55KSAqIDAuNQogICAgICAgIAogICAgICAgICAgICAgICAgaWYgZGFtYWdlX21vdmluZyA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgIGdyYXBoaWNzLnJlY3RhbmdsZV9vdXRsaW5lKHBvcy54LCBwb3MueSwgcmVjdF9zaXplLngsIHJlY3Rfc2l6ZS55LCAyNTUsIDI1NSwgMjU1LCAxMjggKiBkYW1hZ2VfbW92aW5nICogZGFtYWdlX2hvbGRpbmcsIDcpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIHIzLCBnMywgYjMgPSByLCBnLCBiCiAgICAgICAgICAgICAgICBpZiBub3QgY2FuX3Nob3dfaW5kaWNhdG9ycyB0aGVuCiAgICAgICAgICAgICAgICAgICAgcjMgPSByMQogICAgICAgICAgICAgICAgICAgIGczID0gZzEKICAgICAgICAgICAgICAgICAgICBiMyA9IGIxCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgICAgIHJlbmRlcmVyLnRleHQodGV4dF9wb3NpdGlvbi54IC0gMSwgdGV4dF9wb3NpdGlvbi55LCByMywgZzMsIGIzLCBhICogZGFtYWdlX2FscGhhICogZGFtYWdlX2hvbGRpbmcsIGZsYWdzLCAwLCB0ZXh0KQogICAgICAgIAogICAgICAgICAgICAgICAgd2luZG93OnNldF9zaXplKHJlY3Rfc2l6ZSkKICAgICAgICAgICAgICAgIHdpbmRvdzp1cGRhdGUoKQogICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgaWYgYWxwaGEgPD0gMCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgIC0tIGhlYWRlcgogICAgICAgICAgICBsb2NhbCBwb3MgPSBjZW50ZXI6Y2xvbmUoKQogICAgICAgIAogICAgICAgICAgICBwb3MueCA9IHBvcy54ICsgdXRpbHMucm91bmQoMTAgKiBhbGlnbikKICAgICAgICAgICAgcG9zLnkgPSBwb3MueSArIDIwCiAgICAgICAgCiAgICAgICAgICAgIGRvCiAgICAgICAgICAgICAgICBsb2NhbCB0ZXh0ID0gIkEgQyBJIEQgVCBFIEMgSCIKICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIG1lYXN1cmUgPSB2ZWN0b3IocmVuZGVyZXIubWVhc3VyZV90ZXh0KGZsYWdzLCB0ZXh0KSkKICAgICAgICAgICAgICAgIG1lYXN1cmUueCA9IG1lYXN1cmUueCArIDEKICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIHRleHRfcG9zaXRpb24gPSBwb3M6Y2xvbmUoKQogICAgICAgICAgICAgICAgbG9jYWwgdGV4dF9vZmZzZXQgPSAobWVhc3VyZS54ICogMC41KSAqICgxIC0gYWxpZ24pCiAgICAgICAgCiAgICAgICAgICAgICAgICB0ZXh0X3Bvc2l0aW9uLnggPSB0ZXh0X3Bvc2l0aW9uLnggLSB1dGlscy5yb3VuZCh0ZXh0X29mZnNldCkKICAgICAgICAKICAgICAgICAgICAgICAgIC0tIGdyYXBoaWNzLmdsb3codGV4dF9wb3NpdGlvbi54ICsgMSwgdGV4dF9wb3NpdGlvbi55ICsgMiwgbWVhc3VyZS54LCA0LCByLCBnLCBiLCBhICogYWxwaGEgKiAwLjEsIDEwLCAxKQogICAgICAgICAgICAgICAgLS0gcmVuZGVyZXIucmVjdGFuZ2xlKHRleHRfcG9zaXRpb24ueCArIDEsIHRleHRfcG9zaXRpb24ueSArIDIsIG1lYXN1cmUueCwgNCwgciwgZywgYiwgYSAqIGFscGhhICogMC4xKQogICAgICAgIAogICAgICAgICAgICAgICAgdGV4dCA9IGRlY29yYXRpb25zLndhdmUodGV4dCwgY2xvY2ssIHIxLCBnMSwgYjEsIDI1NSwgcjIsIGcyLCBiMiwgYTIpCiAgICAgICAgICAgICAgICBncmFwaGljcy50ZXh0KHRleHRfcG9zaXRpb24ueCwgdGV4dF9wb3NpdGlvbi55LCByLCBnLCBiLCBhICogYWxwaGEsIGZsYWdzLCAwLCB0ZXh0KQogICAgICAgIAogICAgICAgICAgICAgICAgcG9zLnkgPSBwb3MueSArIG1lYXN1cmUueQogICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgZG8KICAgICAgICAgICAgICAgIGxvY2FsIHRleHQgPSBnZXRfc3RhdGVtZW50KCkKICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIG1lYXN1cmUgPSB2ZWN0b3IocmVuZGVyZXIubWVhc3VyZV90ZXh0KGZsYWdzLCB0ZXh0KSkKICAgICAgICAgICAgICAgIG1lYXN1cmUueCA9IG1lYXN1cmUueCArIDEKICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIHRleHRfcG9zaXRpb24gPSBwb3M6Y2xvbmUoKQogICAgICAgICAgICAgICAgbG9jYWwgdGV4dF9vZmZzZXQgPSAobWVhc3VyZS54ICogMC41KSAqICgxIC0gYWxpZ24pCiAgICAgICAgCiAgICAgICAgICAgICAgICB0ZXh0X3Bvc2l0aW9uLnggPSB0ZXh0X3Bvc2l0aW9uLnggLSB1dGlscy5yb3VuZCh0ZXh0X29mZnNldCkKICAgICAgICAKICAgICAgICAgICAgICAgIHJlbmRlcmVyLnRleHQodGV4dF9wb3NpdGlvbi54LCB0ZXh0X3Bvc2l0aW9uLnksIHIsIGcsIGIsIGEgKiBhbHBoYSwgZmxhZ3MsIDAsIHRleHQpCiAgICAgICAgICAgICAgICBwb3MueSA9IHBvcy55ICsgbWVhc3VyZS55CiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICBmb3IgaSA9IDEsICNmZWF0dXJlcyBkbwogICAgICAgICAgICAgICAgbG9jYWwgZmVhdHVyZSA9IGZlYXR1cmVzW2ldCiAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCB2YWx1ZV9jaGVjayA9IGZlYXR1cmUuZ2V0KCkKICAgICAgICAgICAgICAgIGxvY2FsIGNhbl9zaG93X2ZlYXR1cmUgPSBjYW5fc2hvd19pbmRpY2F0b3JzIGFuZCB2YWx1ZV9jaGVjawogICAgICAgIAogICAgICAgICAgICAgICAgZmVhdHVyZS5hbHBoYSA9IG1vdGlvbi5pbnRlcnAoZmVhdHVyZS5hbHBoYSwgY2FuX3Nob3dfZmVhdHVyZSwgMC4wNDUpCiAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBmZWF0dXJlLmFscGhhIDw9IDAgdGhlbgogICAgICAgICAgICAgICAgICAgIGdvdG8gY29udGludWUKICAgICAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgdGV4dCA9IGZlYXR1cmUudGV4dAogICAgICAgICAgICAgICAgbG9jYWwgYWxwaGEgPSBmZWF0dXJlLmFscGhhICogYWxwaGEKICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIG1lYXN1cmUgPSB2ZWN0b3IocmVuZGVyZXIubWVhc3VyZV90ZXh0KGZsYWdzLCB0ZXh0KSkKICAgICAgICAgICAgICAgIG1lYXN1cmUueCA9IG1lYXN1cmUueCArIDEKICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIHRleHRfcG9zaXRpb24gPSBwb3M6Y2xvbmUoKQogICAgICAgICAgICAgICAgbG9jYWwgdGV4dF9vZmZzZXQgPSAobWVhc3VyZS54ICogMC41KSAqICgxIC0gYWxpZ24pCiAgICAgICAgCiAgICAgICAgICAgICAgICB0ZXh0X3Bvc2l0aW9uLnggPSB0ZXh0X3Bvc2l0aW9uLnggLSB1dGlscy5yb3VuZCh0ZXh0X29mZnNldCkKICAgICAgICAKICAgICAgICAgICAgICAgIHJlbmRlcmVyLnRleHQodGV4dF9wb3NpdGlvbi54LCB0ZXh0X3Bvc2l0aW9uLnksIHIsIGcsIGIsIGEgKiBhbHBoYSwgZmxhZ3MsIDAsIHRleHQpCiAgICAgICAgICAgICAgICBwb3MueSA9IHBvcy55ICsgdXRpbHMucm91bmQobWVhc3VyZS55ICogZmVhdHVyZS5hbHBoYSkKICAgICAgICAKICAgICAgICAgICAgICAgIDo6Y29udGludWU6OgogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAoKICAgIC0tLXJlZ2lvbiBhcnJvd3MKICAgIGRvCiAgICAgICAgbG9jYWwgYWxwaGEgPSAwCiAgICAgICAgbG9jYWwgbGVmdF9hbHBoYSA9IDAKICAgICAgICBsb2NhbCByaWdodF9hbHBoYSA9IDAKICAgICAgICAKICAgICAgICBsb2NhbCBzY3JlZW4gPSB2ZWN0b3IoY2xpZW50LnNjcmVlbl9zaXplKCkpICogLjUKICAgICAgICAKICAgICAgICBmdW5jdGlvbiBhcnJvd3MuZnJhbWUoKQogICAgICAgICAgICBsb2NhbCBscCA9IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkKICAgICAgICAgICAgaWYgbHAgPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgbG9jYWwgd3BuID0gZW50aXR5LmdldF9wbGF5ZXJfd2VhcG9uKGxwKQogICAgICAgICAgICBpZiB3cG4gPT0gbmlsIHRoZW4gcmV0dXJuIGVuZAogICAgICAgIAogICAgICAgICAgICBsb2NhbCB3cG5faW5mbyA9IGNzZ29fd2VhcG9ucyh3cG4pCiAgICAgICAgICAgIGlmIHdwbl9pbmZvID09IG5pbCB0aGVuIHJldHVybiBlbmQKICAgICAgICAKICAgICAgICAgICAgbG9jYWwgY2FuX3Nob3dfYXJyb3dzID0gbWFudWFsX2RpcmVjdGlvbi5lbmFibGVkOmdldCgpIGFuZCBtYW51YWxfZGlyZWN0aW9uLmFycm93czpnZXQoKSBhbmQgZW50aXR5LmlzX2FsaXZlKGxwKQogICAgICAgICAgICBsb2NhbCBjYW5fbW92ZV9pbmRpY2F0b3JzID0gY2FuX3Nob3dfaW5kaWNhdG9ycyBhbmQgc2NvcGVkX2NoZWNrID09IDEKICAgICAgICAKICAgICAgICAgICAgYWxwaGEgPSBtb3Rpb24uaW50ZXJwKGFscGhhLCBjYW5fc2hvd19hcnJvd3MgYW5kICh3cG5faW5mby53ZWFwb25fdHlwZV9pbnQgPT0gOSBhbmQgMC40IG9yIDEuMCkgb3IgMC4wLCAwLjA0NSkKICAgICAgICAgICAgaWYgYWxwaGEgPD0gMCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIHIsIGcsIGIsIGEgPSBtYW51YWxfZGlyZWN0aW9uLmNvbG9yOnJhd2dldCgpCiAgICAgICAgICAgIGEgPSAyNTUgKiBhbHBoYQogICAgICAgIAogICAgICAgICAgICBsb2NhbCBtYW51YWxfZGlyZWN0aW9uID0gbWFudWFsX2RpcmVjdGlvbi5nZXQoKQogICAgICAgIAogICAgICAgICAgICBsZWZ0X2FscGhhID0gbW90aW9uLmludGVycChsZWZ0X2FscGhhLCBtYW51YWxfZGlyZWN0aW9uID09IDAgYW5kIDEgb3IgMCwgMC4wNDUpCiAgICAgICAgICAgIGlmIGxlZnRfYWxwaGEgfj0gMCB0aGVuCiAgICAgICAgICAgICAgICByZW5kZXJlci50ZXh0KHNjcmVlbi54IC0gNTAsIHNjcmVlbi55IC0gMTYsIHIsIGcsIGIsIGEgKiBsZWZ0X2FscGhhLCAnKycsIG5pbCwgJzwnKQogICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgcmlnaHRfYWxwaGEgPSBtb3Rpb24uaW50ZXJwKHJpZ2h0X2FscGhhLCBtYW51YWxfZGlyZWN0aW9uID09IDEgYW5kIDEgb3IgMCwgMC4wNDUpCiAgICAgICAgICAgIGlmIHJpZ2h0X2FscGhhIH49IDAgdGhlbgogICAgICAgICAgICAgICAgcmVuZGVyZXIudGV4dChzY3JlZW4ueCArIDM5LCBzY3JlZW4ueSAtIDE2LCByLCBnLCBiLCBhICogcmlnaHRfYWxwaGEsICcrJywgbmlsLCAnPicpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCgogICAgLS0tIHJlZ2lvbiB2ZWxvY2l0eV93YXJuaW5nCiAgICBkbwogICAgICAgIGxvY2FsIGFscGhhID0gMC4wCiAgICAgICAgbG9jYWwgaG9sZGluZyA9IDAuMAogICAgICAgIGxvY2FsIGhvdmVyaW5nID0gMC4wCgogICAgICAgIGxvY2FsIGZ1bmN0aW9uIHJlbmRlcmVyX2Jhcih4LCB5LCB3LCBoLCByLCBnLCBiLCBhLCBwY3QpCiAgICAgICAgICAgIC0tZ3JhcGhpY3MuZ2xvdyh4LCB5LCB3LCBoLCByLCBnLCBiLCBhICogMC4xNSwgMjIyLCBoICogMC41KQogICAgICAgICAgICByZW5kZXJlci5yZWN0YW5nbGUoeCwgeSwgdywgaCwgMCwgMCwgMCwgYSkKICAgICAgICAgICAgcmVuZGVyZXIucmVjdGFuZ2xlKHggKyAxLCB5ICsgMSwgKHcgLSAyKSAqIHBjdCwgaCAtIDIsIHIsIGcsIGIsIGEpCiAgICAgICAgZW5kCgogICAgICAgIHZlbG9jaXR5X3dhcm5pbmcud2luZG93ID0gd2luZG93cy5uZXcoIiMjdmVsb2NpdHlfd2FybmluZyIsIDAuNSwgMC4zKQoKICAgICAgICB2ZWxvY2l0eV93YXJuaW5nLndpbmRvdzpzZXRfYW5jaG9yKHZlY3RvcigwLjUsIDAuMCkpCiAgICAgICAgdmVsb2NpdHlfd2FybmluZy53aW5kb3c6c2V0X3NpemUodmVjdG9yKDE4MCwgNCkpCgogICAgICAgIGZ1bmN0aW9uIHZlbG9jaXR5X3dhcm5pbmcuZnJhbWUoKQogICAgICAgICAgICBsb2NhbCBtZSA9IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkKICAgICAgICAgICAgaWYgbWUgPT0gbmlsIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICAgICAgbG9jYWwgd2luZG93ID0gdmVsb2NpdHlfd2FybmluZy53aW5kb3cKICAgICAgICAgICAgbG9jYWwgbW9kaWZpZXIgPSBlbnRpdHkuZ2V0X3Byb3AobWUsICJtX2ZsVmVsb2NpdHlNb2RpZmllciIpCgogICAgICAgICAgICBsb2NhbCBtZW51X2NoZWNrID0gdWkuaXNfbWVudV9vcGVuKCkKCiAgICAgICAgICAgIGxvY2FsIGFsaXZlX2NoZWNrID0gZW50aXR5LmlzX2FsaXZlKG1lKQogICAgICAgICAgICBsb2NhbCB2ZWxvY2l0eV9jaGVjayA9IG1vZGlmaWVyIDwgMS4wCgogICAgICAgICAgICBsb2NhbCBpc19kcmFnZ2luZyA9IHdpbmRvdzppc19kcmFnZ2luZygpCiAgICAgICAgICAgIGxvY2FsIGlzX2hvdmVyaW5nID0gd2luZG93OmlzX2hvdmVyaW5nKCkKCiAgICAgICAgICAgIGxvY2FsIGNhbl9zaG93X3dhcm5pbmcgPSB3aWRnZXRzLmVuYWJsZWQ6Z2V0KCkgYW5kIHdpZGdldHMuaXRlbXM6aGF2ZV9rZXkoIlZlbG9jaXR5IFdhcm5pbmciKSBhbmQgKChhbGl2ZV9jaGVjayBhbmQgdmVsb2NpdHlfY2hlY2spIG9yIG1lbnVfY2hlY2spCgogICAgICAgICAgICBhbHBoYSA9IG1vdGlvbi5pbnRlcnAoYWxwaGEsIGNhbl9zaG93X3dhcm5pbmcsIDAuMDQ1KQogICAgICAgICAgICBob2xkaW5nID0gbW90aW9uLmludGVycChob2xkaW5nLCAoY2FuX3Nob3dfd2FybmluZyBhbmQgaXNfZHJhZ2dpbmcpIGFuZCAwLjYgb3IgMS4wLCAwLjA0NSkKICAgICAgICAgICAgaG92ZXJpbmcgPSBtb3Rpb24uaW50ZXJwKGhvdmVyaW5nLCAoY2FuX3Nob3dfd2FybmluZyBhbmQgaXNfaG92ZXJpbmcgYW5kIG5vdCBpc19kcmFnZ2luZykgYW5kIDEuMCBvciAwLjAsIDAuMDQ1KQoKICAgICAgICAgICAgaWYgYWxwaGEgPD0gMCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBtZW51X2NoZWNrIGFuZCAobm90IHZlbG9jaXR5X2NoZWNrIG9yIG5vdCBhbGl2ZV9jaGVjaykgdGhlbgogICAgICAgICAgICAgICAgbW9kaWZpZXIgPSBtYXRoLm1pbigxLCBnbG9iYWxzLnRpY2tjb3VudCgpICUgMjAwIC8gMTUwKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIGZsYWdzID0gImQiCiAgICAgICAgICAgIGxvY2FsIHBlcmNlbnQgPSAoMSAtIG1vZGlmaWVyKSAqIDEwMAoKICAgICAgICAgICAgbG9jYWwgciwgZywgYiA9IHdpZGdldHMuY29sb3JfcGlja2VyOmdldCgpCgogICAgICAgICAgICBsb2NhbCBhID0gMjU1CgogICAgICAgICAgICBpZiBtb2RpZmllciA8IDEuMCB0aGVuCiAgICAgICAgICAgICAgICByID0gdXRpbHMubGVycCgyNTUsIHIsIG1vZGlmaWVyKQogICAgICAgICAgICAgICAgZyA9IHV0aWxzLmxlcnAoNzUsIGcsIG1vZGlmaWVyKQogICAgICAgICAgICAgICAgYiA9IHV0aWxzLmxlcnAoNzUsIGIsIG1vZGlmaWVyKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIC0tIGluZGljYXRpb24KICAgICAgICAgICAgbG9jYWwgcG9zID0gd2luZG93LnBvczpjbG9uZSgpCiAgICAgICAgICAgIGxvY2FsIHNpemUgPSB3aW5kb3cuc2l6ZTpjbG9uZSgpCgogICAgICAgICAgICBsb2NhbCB0ZXh0ID0gZigiTWF4IHZlbG9jaXR5IHdhcyByZWR1Y2VkIGJ5ICVkJSUiLCBwZXJjZW50KQogICAgICAgICAgICBsb2NhbCB0ZXh0X3NpemUgPSB2ZWN0b3IocmVuZGVyZXIubWVhc3VyZV90ZXh0KGZsYWdzLCB0ZXh0KSkKCiAgICAgICAgICAgIHJlbmRlcmVyLnRleHQoCiAgICAgICAgICAgICAgICBwb3MueCArIChzaXplLnggLSB0ZXh0X3NpemUueCkgKiAwLjUsCiAgICAgICAgICAgICAgICBwb3MueSwKICAgICAgICAgICAgICAgIDI1NSwgMjU1LCAyNTUsIDI1NSAqIGFscGhhICogaG9sZGluZywKICAgICAgICAgICAgICAgIGZsYWdzLCAwLCB0ZXh0CiAgICAgICAgICAgICkKCiAgICAgICAgICAgIHBvcy55ID0gcG9zLnkgKyB0ZXh0X3NpemUueQogICAgICAgICAgICBwb3MueSA9IHBvcy55ICsgNQoKICAgICAgICAgICAgbG9jYWwgYmFyX3BvcyA9IHBvczpjbG9uZSgpCiAgICAgICAgICAgIGxvY2FsIGJhcl9zaXplID0gdmVjdG9yKHRleHRfc2l6ZS54ICsgMjgsIDQpCgogICAgICAgICAgICByZW5kZXJlcl9iYXIoYmFyX3Bvcy54LCBiYXJfcG9zLnksIGJhcl9zaXplLngsIGJhcl9zaXplLnksIHIsIGcsIGIsIGEgKiBhbHBoYSAqIGhvbGRpbmcsIG1vZGlmaWVyKQogICAgICAgICAgICBwb3MueSA9IHBvcy55ICsgYmFyX3NpemUueSArIDUKCiAgICAgICAgICAgIGlmIGhvdmVyaW5nID4gMCB0aGVuCiAgICAgICAgICAgICAgICByZW5kZXJlci50ZXh0KAogICAgICAgICAgICAgICAgICAgIHBvcy54LAogICAgICAgICAgICAgICAgICAgIHBvcy55LAogICAgICAgICAgICAgICAgICAgIDI1NSwgMjU1LCAyNTUsIDI1NSAqIGFscGhhICogaG92ZXJpbmcsCiAgICAgICAgICAgICAgICAgICAgZmxhZ3MsIDAsICJQcmVzcyBNMiB0byBjZW50ZXIuIgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIHdpbmRvd19zaXplID0gdmVjdG9yKG1hdGgubWF4KHRleHRfc2l6ZS54LCBiYXJfc2l6ZS54KSwgdGV4dF9zaXplLnkgKyBiYXJfc2l6ZS55ICsgNSkKCiAgICAgICAgICAgIGlmIGlzX2hvdmVyaW5nIGFuZCBub3QgaXNfZHJhZ2dpbmcgYW5kIGNsaWVudC5rZXlfc3RhdGUoMHgwMikgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgc2NyZWVuID0gdmVjdG9yKGNsaWVudC5zY3JlZW5fc2l6ZSgpKQoKICAgICAgICAgICAgICAgIHdpbmRvdzpzZXRfcG9zKHZlY3RvcigKICAgICAgICAgICAgICAgICAgICAoc2NyZWVuLnggLSBzaXplLngpICogMC41LAogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5wb3MueQogICAgICAgICAgICAgICAgKSkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICB3aW5kb3c6c2V0X3NpemUod2luZG93X3NpemUpCiAgICAgICAgICAgIHdpbmRvdzp1cGRhdGUoKQogICAgICAgIGVuZAogICAgZW5kCgogICAgLS0tIHJlZ2lvbiBjdXN0b20gc2NvcGUKICAgIGRvCiAgICAgICAgY3VzdG9tX3Njb3BlLmVuYWJsZWQgPSBtZW51Lm5ld19pdGVtKHVpLm5ld19jaGVja2JveCwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJDdXN0b20gU2NvcGUgT3ZlcmxheSIpCiAgICAgICAgOiByZWNvcmQoImFhIiwgImN1c3RvbV9zY29wZTo6ZW5hYmxlZCIpCiAgICAgICAgOiBzYXZlKCkKICAgICAgICAKICAgICAgICBjdXN0b21fc2NvcGUuY29sb3IgPSBtZW51Lm5ld19pdGVtKHVpLm5ld19jb2xvcl9waWNrZXIsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQ29sb3IiLCAyNTUsIDI1NSwgMjU1LCAyNTUpCiAgICAgICAgOiByZWNvcmQoImFhIiwgImN1c3RvbV9zY29wZTo6Y29sb3IiKQogICAgICAgIDogc2F2ZSgpCiAgICAgICAgCiAgICAgICAgY3VzdG9tX3Njb3BlLm1vZGUgPSBtZW51Lm5ld19pdGVtKHVpLm5ld19jb21ib2JveCwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJNb2RlIiwgeyAnRGVmYXVsdCcsICdUJyB9KQogICAgICAgIDogcmVjb3JkKCJhYSIsICJjdXN0b21fc2NvcGU6Om1vZGUiKQogICAgICAgIDogc2F2ZSgpCiAgICAgICAgCiAgICAgICAgY3VzdG9tX3Njb3BlLnBvc2l0aW9uID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfc2xpZGVyLCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIlxuUG9zaXRpb24iLCAwLCA1MDAsIDUwLCB0cnVlLCAncHgnKQogICAgICAgIDogcmVjb3JkKCJhYSIsICJjdXN0b21fc2NvcGU6OnBvc2l0aW9uIikKICAgICAgICA6IHNhdmUoKQogICAgICAgIAogICAgICAgIGN1c3RvbV9zY29wZS5vZmZzZXQgPSBtZW51Lm5ld19pdGVtKHVpLm5ld19zbGlkZXIsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiXG5PZmZzZXQiLCAwLCA1MDAsIDEwLCB0cnVlLCAncHgnKQogICAgICAgIDogcmVjb3JkKCJhYSIsICJjdXN0b21fc2NvcGU6Om9mZnNldCIpCiAgICAgICAgOiBzYXZlKCkKICAgICAgICAKICAgICAgICBsb2NhbCBhbHBoYSA9IDAKICAgICAgICBjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCdwYWludF91aScsIGZ1bmN0aW9uICgpCiAgICAgICAgICAgIHVpLnNldChzb2Z0d2FyZS52aXN1YWxzLnNjb3BlX292ZXJsYXksIHRydWUpCiAgICAgICAgZW5kKQogICAgICAgIAogICAgICAgIGNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soJ3BhaW50JywgZnVuY3Rpb24gKCkKICAgICAgICAgICAgaWYgbm90IGN1c3RvbV9zY29wZS5lbmFibGVkOmdldCgpIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgdWkuc2V0KHNvZnR3YXJlLnZpc3VhbHMuc2NvcGVfb3ZlcmxheSwgZmFsc2UpCiAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIGxwID0gZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKQogICAgICAgICAgICBpZiBscCA9PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICBsb2NhbCB3aWR0aCwgaGVpZ2h0ID0gY2xpZW50LnNjcmVlbl9zaXplKCkKICAgICAgICAgICAgbG9jYWwgb2Zmc2V0LCBwb3NpdGlvbiA9IGN1c3RvbV9zY29wZS5vZmZzZXQ6Z2V0KCkgKiBoZWlnaHQgLyAxMDgwLCBjdXN0b21fc2NvcGUucG9zaXRpb246Z2V0KCkgKiBoZWlnaHQgLyAxMDgwCiAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIGNvbmRpdGlvbiA9IGVudGl0eS5nZXRfcHJvcChscCwgJ21fYklzU2NvcGVkJykgPT0gMSBhbmQgZW50aXR5LmdldF9wcm9wKGxwLCAnbV9iUmVzdW1lWm9vbScpID09IDAKICAgICAgICAgICAgYWxwaGEgPSBtb3Rpb24uaW50ZXJwKGFscGhhLCBjb25kaXRpb24sIDAuMDQ1KQogICAgICAgICAgICBpZiBhbHBoYSA8IDAuMDAxIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgbG9jYWwgY2xyID0geyBjdXN0b21fc2NvcGUuY29sb3I6cmF3Z2V0KCkgfQogICAgICAgIAogICAgICAgICAgICBsb2NhbCBjbHIxID0geyBjbHJbMV0sIGNsclsyXSwgY2xyWzNdLCAwIH0KICAgICAgICAgICAgbG9jYWwgY2xyMiA9IHsgY2xyWzFdLCBjbHJbMl0sIGNsclszXSwgY2xyWzRdICogYWxwaGEgfQogICAgICAgICAgICBsb2NhbCBtb2RlID0gY3VzdG9tX3Njb3BlLm1vZGU6Z2V0KCkKICAgICAgICAKICAgICAgICAgICAgaWYgbW9kZSB+PSAnVCcgdGhlbgogICAgICAgICAgICAgICAgcmVuZGVyZXIuZ3JhZGllbnQoCiAgICAgICAgICAgICAgICAgICAgd2lkdGggLyAyLCBoZWlnaHQgLyAyIC0gcG9zaXRpb24gKyAyLAogICAgICAgICAgICAgICAgICAgIDEsIHBvc2l0aW9uIC0gb2Zmc2V0LAogICAgICAgICAgICAgICAgICAgIGNscjFbMV0sIGNscjFbMl0sIGNscjFbM10sIGNscjFbNF0sCiAgICAgICAgICAgICAgICAgICAgY2xyMlsxXSwgY2xyMlsyXSwgY2xyMlszXSwgY2xyMls0XSwKICAgICAgICAgICAgICAgICAgICBmYWxzZQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgcmVuZGVyZXIuZ3JhZGllbnQoCiAgICAgICAgICAgICAgICB3aWR0aCAvIDIsIGhlaWdodCAvIDIgKyBvZmZzZXQsCiAgICAgICAgICAgICAgICAxLCBwb3NpdGlvbiAtIG9mZnNldCwKICAgICAgICAgICAgICAgIGNscjJbMV0sIGNscjJbMl0sIGNscjJbM10sIGNscjJbNF0sCiAgICAgICAgICAgICAgICBjbHIxWzFdLCBjbHIxWzJdLCBjbHIxWzNdLCBjbHIxWzRdLAogICAgICAgICAgICAgICAgZmFsc2UKICAgICAgICAgICAgKQogICAgICAgIAogICAgICAgICAgICByZW5kZXJlci5ncmFkaWVudCgKICAgICAgICAgICAgICAgIHdpZHRoIC8gMiAtIHBvc2l0aW9uICsgMiwgaGVpZ2h0IC8gMiwKICAgICAgICAgICAgICAgIHBvc2l0aW9uIC0gb2Zmc2V0LCAxLAogICAgICAgICAgICAgICAgY2xyMVsxXSwgY2xyMVsyXSwgY2xyMVszXSwgY2xyMVs0XSwKICAgICAgICAgICAgICAgIGNscjJbMV0sIGNscjJbMl0sIGNscjJbM10sIGNscjJbNF0sCiAgICAgICAgICAgICAgICB0cnVlCiAgICAgICAgICAgICkKICAgICAgICAKICAgICAgICAgICAgcmVuZGVyZXIuZ3JhZGllbnQoCiAgICAgICAgICAgICAgICB3aWR0aCAvIDIgKyBvZmZzZXQsIGhlaWdodCAvIDIsCiAgICAgICAgICAgICAgICBwb3NpdGlvbiAtIG9mZnNldCwgMSwKICAgICAgICAgICAgICAgIGNscjJbMV0sIGNscjJbMl0sIGNscjJbM10sIGNscjJbNF0sCiAgICAgICAgICAgICAgICBjbHIxWzFdLCBjbHIxWzJdLCBjbHIxWzNdLCBjbHIxWzRdLAogICAgICAgICAgICAgICAgdHJ1ZQogICAgICAgICAgICApCiAgICAgICAgZW5kKQogICAgICAgIAogICAgICAgIGRlZmVyKGZ1bmN0aW9uICgpCiAgICAgICAgICAgIHVpLnNldF92aXNpYmxlKHNvZnR3YXJlLnZpc3VhbHMuc2NvcGVfb3ZlcmxheSwgdHJ1ZSkKICAgICAgICBlbmQpCiAgICBlbmQKCiAgICAtLS0gaGl0IG1hcmtlciBhY2lkdGVjaAogICAgZG8KICAgICAgICBsb2NhbCBjdHggPSB7CiAgICAgICAgICAgIHRhcmdldCA9IDAsCiAgICAgICAgICAgIHBvcyA9IHZlY3RvcigpCiAgICAgICAgfQoKICAgICAgICBsb2NhbCBwZW5kaW5nX21hcmtlcnMgPSB7IH0KCiAgICAgICAgZnVuY3Rpb24gaGl0X21hcmtlci5mcmFtZSgpCiAgICAgICAgICAgIGlmIG5vdCBzZXR0aW5ncy50d2Vha3NfZW5hYmxlOmdldCgpIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIG5vdCBzZXR0aW5ncy50d2Vha3M6aGF2ZV9rZXkoJ0RhbWFnZSBNYXJrZXInKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCByZWFsdGltZSA9IGdsb2JhbHMucmVhbHRpbWUoKQogICAgICAgICAgICBmb3IgaSwgZGF0YSBpbiBpcGFpcnMocGVuZGluZ19tYXJrZXJzKSBkbwogICAgICAgICAgICAgICAgbG9jYWwgZGlmZiA9IGRhdGFbM10gLSByZWFsdGltZQoKICAgICAgICAgICAgICAgIGxvY2FsIGFscGhhID0gbWF0aC5taW4oMSwgZGlmZiktLWRpZmYgPCAxIGFuZCBtYXRoLm1heCgwLCBkaWZmKSBvciAxCgogICAgICAgICAgICAgICAgbG9jYWwgeCwgeSA9IHJlbmRlcmVyLndvcmxkX3RvX3NjcmVlbihkYXRhWzFdLngsIGRhdGFbMV0ueSwgZGF0YVsxXS56KQoKICAgICAgICAgICAgICAgIGxvY2FsIHIsIGcsIGIgPSB1bnBhY2soZGF0YVs0XSkKICAgICAgICAgICAgICAgIHJlbmRlcmVyLnRleHQoeCwgeSwgciwgZywgYiwgMjU1ICogYWxwaGEsICJjIiwgbmlsLCBkYXRhWzJdKQoKICAgICAgICAgICAgICAgIGlmIGRhdGFbM10gPCByZWFsdGltZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGFibGUucmVtb3ZlKHBlbmRpbmdfbWFya2VycywgaSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gaGl0X21hcmtlci5haW1fZmlyZShlKQogICAgICAgICAgICBpZiBub3Qgc2V0dGluZ3MudHdlYWtzX2VuYWJsZTpnZXQoKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBub3Qgc2V0dGluZ3MudHdlYWtzOmhhdmVfa2V5KCdEYW1hZ2UgTWFya2VyJykgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgY3R4LnRhcmdldCA9IGUudGFyZ2V0CiAgICAgICAgICAgIGN0eC5wb3MgPSB2ZWN0b3IoZS54LCBlLnksIGUueikKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gaGl0X21hcmtlci5haW1faGl0KGUpCiAgICAgICAgICAgIGlmIG5vdCBzZXR0aW5ncy50d2Vha3NfZW5hYmxlOmdldCgpIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIG5vdCBzZXR0aW5ncy50d2Vha3M6aGF2ZV9rZXkoJ0RhbWFnZSBNYXJrZXInKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBjdHgudGFyZ2V0ID09IGUudGFyZ2V0IHRoZW4KICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydCgKICAgICAgICAgICAgICAgICAgICBwZW5kaW5nX21hcmtlcnMsCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjdHgucG9zLCB0b3N0cmluZyhlLmRhbWFnZSksCiAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbHMucmVhbHRpbWUoKSArIDMsCiAgICAgICAgICAgICAgICAgICAgICAgIGUuaGl0Z3JvdXAgPT0gMSBhbmQgeyB3aWRnZXRzLmNvbG9yX3BpY2tlcjpyYXdnZXQoKSB9IG9yIHsgMjQwLCAyNDAsIDI0MCB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gaGl0X21hcmtlci5yb3VuZF9wcmVzdGFydCgpCiAgICAgICAgICAgIHRhYmxlLmNsZWFyKHBlbmRpbmdfbWFya2VycykKICAgICAgICBlbmQKICAgIGVuZAoKICAgIC0tLXJlZ2lvbiBhZHZlcnRpc2UKICAgIGRvCiAgICAgICAgbG9jYWwga2lsbHMgPSAwCiAgICAgICAgCiAgICAgICAgY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygncGxheWVyX2RlYXRoJywgZnVuY3Rpb24gKGUpCiAgICAgICAgICAgIGlmIGNsaWVudC51c2VyaWRfdG9fZW50aW5kZXgoZS5hdHRhY2tlcikgfj0gZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgIGtpbGxzID0ga2lsbHMgKyAxCiAgICAgICAgZW5kKQogICAgICAgIAogICAgICAgIGxvY2FsIHgsIHkgPSBjbGllbnQuc2NyZWVuX3NpemUoKQogICAgICAgIAogICAgICAgIGNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soJ3BhaW50JywgZnVuY3Rpb24gKCkKICAgICAgICAgICAgbG9jYWwgZW5hYmxlZCA9IHdpZGdldHMuZW5hYmxlZDpnZXQoKSBhbmQgKHdpZGdldHMuaXRlbXM6aGF2ZV9rZXkoJ1dhdGVybWFyaycpIG9yIHdpZGdldHMuaXRlbXM6aGF2ZV9rZXkoJ0Nyb3NzaGFpciBJbmRpY2F0b3InKSkKICAgICAgICAgICAgaWYgZW5hYmxlZCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgIGlmIGtpbGxzIDwgMiB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIHIsIGcsIGIsIGEgPSB3aWRnZXRzLmNvbG9yX3BpY2tlcjpyYXdnZXQoKQogICAgICAgIAogICAgICAgICAgICBsb2NhbCBzdHIgPSBkZWNvcmF0aW9ucy53YXZlKCdBY2lkVGVjaCcsIGdsb2JhbHMucmVhbHRpbWUoKSwgciwgZywgYiwgMjAwLCAyNTUsIDI1NSwgMjU1LCAyMDApCiAgICAgICAgCiAgICAgICAgICAgIHJlbmRlcmVyLnRleHQoeCAqIC41LCB5IC0gMTUsIDI1NSwgMjU1LCAyNTUsIGEsICdjZCcsIG5pbCwgc3RyKQogICAgICAgIGVuZCkKICAgICAgICAKICAgICAgICBjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCdyb3VuZF9lbmQnLCBmdW5jdGlvbiAoZSkKICAgICAgICAgICAga2lsbHMgPSAwCiAgICAgICAgZW5kKQogICAgZW5kCgogICAgLS0tIHJlZ2lvbiBjb25zb2xlIGZpbHRlcgogICAgZG8KICAgICAgICBjdmFyLmNvbl9maWx0ZXJfdGV4dDpzZXRfc3RyaW5nKCJbZ2FtZXNlbnNlXSIpCgogICAgICAgIGxvY2FsIGZ1bmN0aW9uIGFwcGx5X2Nvbl9maWx0ZXIoKQogICAgICAgICAgICBjdmFyLmNvbl9maWx0ZXJfZW5hYmxlOnNldF9yYXdfaW50KAogICAgICAgICAgICAgICAgKHNldHRpbmdzLnR3ZWFrc19lbmFibGU6Z2V0KCkgYW5kIHNldHRpbmdzLnR3ZWFrczpoYXZlX2tleSgnQ29uc29sZSBGaWx0ZXInKSkKICAgICAgICAgICAgICAgICAgICBhbmQgMSBvciAwCiAgICAgICAgICAgICkKICAgICAgICBlbmQKCiAgICAgICAgc2V0dGluZ3MudHdlYWtzOnNldF9jYWxsYmFjayhhcHBseV9jb25fZmlsdGVyKQogICAgICAgIHNldHRpbmdzLnR3ZWFrc19lbmFibGU6c2V0X2NhbGxiYWNrKGFwcGx5X2Nvbl9maWx0ZXIpCiAgICAgICAgYXBwbHlfY29uX2ZpbHRlcigpCgogICAgICAgIGRlZmVyKGZ1bmN0aW9uICgpCiAgICAgICAgICAgIGN2YXIuY29uX2ZpbHRlcl9lbmFibGU6c2V0X3Jhd19pbnQoMCkKICAgICAgICBlbmQpCiAgICBlbmQKICAgIAogICAgLS0tcmVnaW9uIGFuaW1fYnJlYWtlcnMKICAgIGRvCiAgICAgICAgYW5pbV9icmVha2Vycy5lbmFibGVkID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfY2hlY2tib3gsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQW5pbWF0aW9uIEJyZWFrZXJzIikKICAgICAgICA6IHJlY29yZCgiYWEiLCAiYW5pbV9icmVha2Vyczo6ZW5hYmxlZCIpCiAgICAgICAgOiBzYXZlKCkKCiAgICAgICAgYW5pbV9icmVha2Vycy5ncm91bmQgPSBtZW51Lm5ld19pdGVtKHVpLm5ld19jb21ib2JveCwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICctIExlZyBNb3ZlbWVudCcsIHsgIkRlZmF1bHQiLCAnU3RhdGljJywgJ1dhbGtpbmcnIH0pCiAgICAgICAgOiByZWNvcmQoImFhIiwgImFuaW1fYnJlYWtlcnM6Omdyb3VuZCIpCiAgICAgICAgOiBzYXZlKCkKCiAgICAgICAgYW5pbV9icmVha2Vycy5haXIgPSBtZW51Lm5ld19pdGVtKHVpLm5ld19jb21ib2JveCwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICctIEluIEFpcicsIHsgIkRlZmF1bHQiLCAnU3RhdGljJywgJ1dhbGtpbmcnIH0pCiAgICAgICAgOiByZWNvcmQoImFhIiwgImFuaW1fYnJlYWtlcnM6OmFpciIpCiAgICAgICAgOiBzYXZlKCkKCiAgICAgICAgbG9jYWwgbmF0aXZlX0dldENsaWVudEVudGl0eSA9IHZ0YWJsZV9iaW5kKCdjbGllbnQuZGxsJywgJ1ZDbGllbnRFbnRpdHlMaXN0MDAzJywgMywgJ3ZvaWQqKF9fdGhpc2NhbGwqKSh2b2lkKiwgaW50KScpCgogICAgICAgIGxvY2FsIGNoYXJfcHRyID0gZmZpLnR5cGVvZignY2hhcionKQogICAgICAgIGxvY2FsIG51bGxwdHIgPSBmZmkubmV3KCd2b2lkKicpCiAgICAgICAgbG9jYWwgY2xhc3NfcHRyID0gZmZpLnR5cGVvZigndm9pZCoqKicpCgogICAgICAgIGxvY2FsIGFuaW1hdGlvbl9sYXllcl90ID0gZmZpLnR5cGVvZihbWwogICAgICAgICAgICBzdHJ1Y3QgewkJCQkJCQkJCQljaGFyIHBhZDBbMHgxOF07CiAgICAgICAgICAgICAgICB1aW50MzJfdAlzZXF1ZW5jZTsKICAgICAgICAgICAgICAgIGZsb2F0CQlwcmV2X2N5Y2xlOwogICAgICAgICAgICAgICAgZmxvYXQJCXdlaWdodDsKICAgICAgICAgICAgICAgIGZsb2F0CQl3ZWlnaHRfZGVsdGFfcmF0ZTsKICAgICAgICAgICAgICAgIGZsb2F0CQlwbGF5YmFja19yYXRlOwogICAgICAgICAgICAgICAgZmxvYXQJCWN5Y2xlOwogICAgICAgICAgICAgICAgdm9pZAkJKmVudGl0eTsJCQkJCQljaGFyIHBhZDFbMHg0XTsKICAgICAgICAgICAgfSAqKgogICAgICAgIF1dKQoKICAgICAgICBjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCduZXRfdXBkYXRlX2VuZCcsIGZ1bmN0aW9uICgpCiAgICAgICAgICAgIGlmIG5vdCBhbmltX2JyZWFrZXJzLmVuYWJsZWQ6Z2V0KCkgdGhlbgogICAgICAgICAgICAgICAgb3ZlcnJpZGUudW5zZXQoc29mdHdhcmUuYWEub3RoZXIubGVnX21vdmVtZW50KQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgbHAgPSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpCiAgICAgICAgICAgIGlmIGxwID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBwbGF5ZXJfcHRyID0gZmZpLmNhc3QoY2xhc3NfcHRyLCBuYXRpdmVfR2V0Q2xpZW50RW50aXR5KGxwKSkKICAgICAgICAgICAgaWYgcGxheWVyX3B0ciA9PSBudWxscHRyIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIGFuaW1fbGF5ZXJzID0gZmZpLmNhc3QoYW5pbWF0aW9uX2xheWVyX3QsIGZmaS5jYXN0KGNoYXJfcHRyLCBwbGF5ZXJfcHRyKSArIDB4Mjk5MClbMF0KCiAgICAgICAgICAgIGRvCiAgICAgICAgICAgICAgICBsb2NhbCBtb2RlID0gYW5pbV9icmVha2Vycy5ncm91bmQ6Z2V0KCkKICAgICAgICAgICAgICAgIGlmIG1vZGUgfj0gJ0Rpc2FibGVkJyB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgbW9kZSA9PSAnU3RhdGljJyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGVudGl0eS5zZXRfcHJvcChscCwgJ21fZmxQb3NlUGFyYW1ldGVyJywgMSwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcnJpZGUuc2V0KHNvZnR3YXJlLmFhLm90aGVyLmxlZ19tb3ZlbWVudCwgJ0Fsd2F5cyBzbGlkZScpCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmIG1vZGUgPT0gJ1dhbGtpbmcnIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZW50aXR5LnNldF9wcm9wKGxwLCAnbV9mbFBvc2VQYXJhbWV0ZXInLCAwLjUsIDcpCiAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJyaWRlLnNldChzb2Z0d2FyZS5hYS5vdGhlci5sZWdfbW92ZW1lbnQsICdOZXZlciBzbGlkZScpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgb3ZlcnJpZGUudW5zZXQoc29mdHdhcmUuYWEub3RoZXIubGVnX21vdmVtZW50KQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgZG8KICAgICAgICAgICAgICAgIGxvY2FsIG1vZGUgPSBhbmltX2JyZWFrZXJzLmFpcjpnZXQoKQogICAgICAgICAgICAgICAgaWYgbW9kZSB+PSAnRGlzYWJsZWQnIGFuZCBjdHhfYmVicmEuY29uZGl0aW9uKCkgPT0gJ0FJUicgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIG1vZGUgPT0gJ1N0YXRpYycgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHkuc2V0X3Byb3AobHAsICdtX2ZsUG9zZVBhcmFtZXRlcicsIDEsIDYpCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmIG1vZGUgPT0gJ1dhbGtpbmcnIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgYW5pbV9sYXllcnNbNl1bJ3dlaWdodCddID0gMQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAoKICAgIC0tLXJlZ2lvbiBib21ic2l0ZSBmaXgKICAgIGRvCiAgICAgICAgY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygnc2V0dXBfY29tbWFuZCcsIGZ1bmN0aW9uIChjbWQpCiAgICAgICAgICAgIGxvY2FsIGxwID0gZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKQogICAgICAgICAgICBpZiBscCA9PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICBsb2NhbCB3ZWFwb24gPSBlbnRpdHkuZ2V0X3BsYXllcl93ZWFwb24obHApCiAgICAgICAgICAgIGlmIHdlYXBvbiA9PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICBpZiBlbnRpdHkuZ2V0X2NsYXNzbmFtZSh3ZWFwb24pID09ICdDQzQnIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgaWYgZW50aXR5LmdldF9wcm9wKGxwLCAnbV9iSW5Cb21iWm9uZScpID09IDEgdGhlbgogICAgICAgICAgICAgICAgY21kLmluX3VzZSA9IDAKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCgogICAgLS0tIHJlZ2lvbiBhbmdsZXMKICAgIGRvCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gc2V0X2N1c3RvbV9saXN0KGN0eCwgbGlzdCkKICAgICAgICAgICAgaWYgbGlzdC5waXRjaCB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgY3R4LnBpdGNoID0gbGlzdC5waXRjaDpnZXQoKQogICAgICAgICAgICAgICAgY3R4LnBpdGNoX29mZnNldCA9IGxpc3QucGl0Y2hfb2Zmc2V0OmdldCgpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgbGlzdC55YXdfYmFzZSB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgY3R4Lnlhd19iYXNlID0gbGlzdC55YXdfYmFzZTpnZXQoKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGN0eC55YXcgPSBsaXN0LnlhdzpnZXQoKQogICAgICAgICAgICBjdHgueWF3X29mZnNldCA9IGxpc3QueWF3X29mZnNldDpnZXQoKQoKICAgICAgICAgICAgaWYgY3R4LnlhdyA9PSAiMTgwIExSIiB0aGVuCiAgICAgICAgICAgICAgICBjdHgueWF3X29mZnNldCA9IDAKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBjdHgueWF3XzE4MGxyX21vZGUgPSBsaXN0Lnlhd18xODBscl9tb2RlOmdldCgpCiAgICAgICAgICAgIGN0eC55YXdfZGVsYXkgPSBsaXN0Lnlhd19kZWxheTpnZXQoKQogICAgICAgICAgICBjdHgueWF3X2xlZnQgPSBsaXN0Lnlhd19sZWZ0OmdldCgpCiAgICAgICAgICAgIGN0eC55YXdfcmlnaHQgPSBsaXN0Lnlhd19yaWdodDpnZXQoKQoKICAgICAgICAgICAgY3R4Lnlhd19qaXR0ZXIgPSBsaXN0Lnlhd19qaXR0ZXI6Z2V0KCkKICAgICAgICAgICAgY3R4LmppdHRlcl9tb2RlID0gbGlzdC5qaXR0ZXJfbW9kZTpnZXQoKQogICAgICAgICAgICBjdHguYWNpZF9jeWNsZSA9IGxpc3QuYWNpZF9jeWNsZTpnZXQoKQogICAgICAgICAgICBjdHguYWNpZF9kZWxheSA9IGxpc3QuYWNpZF9kZWxheTpnZXQoKQogICAgICAgICAgICBjdHguYWNpZF9zYWZlID0gbGlzdC5hY2lkX3NhZmU6Z2V0KCkKICAgICAgICAgICAgY3R4LmppdHRlcl9vZmZzZXQgPSBsaXN0LmppdHRlcl9vZmZzZXQ6Z2V0KCkKICAgICAgICAgICAgY3R4LmppdHRlcl9yYW5kb21pemF0aW9uID0gbGlzdC5qaXR0ZXJfcmFuZG9taXphdGlvbjpnZXQoKQoKICAgICAgICAgICAgY3R4LmJvZHlfeWF3ID0gbGlzdC5ib2R5X3lhdzpnZXQoKQogICAgICAgICAgICBjdHguYm9keV95YXdfb2Zmc2V0ID0gbGlzdC5ib2R5X3lhd19vZmZzZXQ6Z2V0KCkKICAgICAgICAgICAgY3R4LmZyZWVzdGFuZGluZ19ib2R5X3lhdyA9IGxpc3QuZnJlZXN0YW5kaW5nX2JvZHlfeWF3OmdldCgpCiAgICAgICAgZW5kCgogICAgICAgIGFuZ2xlcy50eXBlID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfY29tYm9ib3gsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQW50aSBBaW0gQnVpbGRlciIsIHsKICAgICAgICAgICAgIk9mZiIsCiAgICAgICAgICAgICJDdXN0b20iLAogICAgICAgICAgICAiUmVjb21tZW5kZWQiCiAgICAgICAgfSkKICAgICAgICA6IHJlY29yZCgiYWEiLCAiYW5nbGVzOjp0eXBlIikKICAgICAgICA6IHNhdmUoKQoKICAgICAgICBsb2NhbCBjb25kcyA9IHsgJ1N0YW5kaW5nJywgJ01vdmluZycsICdTbG93IFdhbGsnLCAnQ3JvdWNoZWQnLCAnTW92ZSBDcm91Y2hlZCcsICdBaXInLCAnQWlyIENyb3VjaGVkJywgJ0Zha2UgTGFnJ30KCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gcmVzZXRfZGVsYXkoKQogICAgICAgICAgICBmb3IgXywgY29uZGl0aW9uIGluIG5leHQsIGNvbmRzIGRvCiAgICAgICAgICAgICAgICBkZWxheV9kYXRhX2FsbFtjb25kaXRpb25dID0gewogICAgICAgICAgICAgICAgICAgIHRpY2tzID0gMCwKICAgICAgICAgICAgICAgICAgICBpc19hY3RpdmUgPSBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBjdXJyZW50ID0gMCwKICAgICAgICAgICAgICAgICAgICBwcmV2aW91c19hbmdsZSA9IDAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIHJlc2V0X2RlbGF5KCkKCiAgICAgICAgYW5nbGVzLmN1c3RvbSA9IHsgfSBkbwogICAgICAgICAgICBhbmdsZXMuY3VzdG9tLnN0YXRlID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfY29tYm9ib3gsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiU3RhdGUiLCB7IHVucGFjayhlX3N0YXRlbWVudCwgMCkgfSkKICAgICAgICAgICAgOiByZWNvcmQoImFhIiwgImN1c3RvbTo6c3RhdGUiKQoKICAgICAgICAgICAgZm9yIGkgPSAwLCAjZV9zdGF0ZW1lbnQgZG8KICAgICAgICAgICAgICAgIGxvY2FsIGxpc3QgPSB7IH0KICAgICAgICAgICAgICAgIGxvY2FsIHN0YXRlID0gZV9zdGF0ZW1lbnRbaV0KCiAgICAgICAgICAgICAgICBpZiBpIH49IDAgdGhlbgogICAgICAgICAgICAgICAgICAgIGxpc3QuZW5hYmxlZCA9IG1lbnUubmV3X2l0ZW0odWkubmV3X2NoZWNrYm94LCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgbWVyZ2UgeyAiRW5hYmxlIiwgIlx4MjAiLCBzdGF0ZSB9KQogICAgICAgICAgICAgICAgICAgIDogcmVjb3JkKCJhYSIsIG1lcmdlIHsgImN1c3RvbSIsICI6OiIsIHN0YXRlLCAiOjoiLCAiZW5hYmxlZCIgfSkKICAgICAgICAgICAgICAgICAgICA6IHNhdmUoKQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgaSB+PSAxMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcGl0Y2hfbGlzdCA9IHsgIk9mZiIsICJEZWZhdWx0IiwgIlVwIiwgIkRvd24iLCAiTWluaW1hbCIsICJSYW5kb20iLCAiQ3VzdG9tIiB9CgogICAgICAgICAgICAgICAgICAgIGxpc3QucGl0Y2ggPSBtZW51Lm5ld19pdGVtKHVpLm5ld19jb21ib2JveCwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsIG1lcmdlIHsgIlBpdGNoIiwgIlxuIiwgImN1c3RvbV8iLCAicGl0Y2hfIiwgc3RhdGUgfSwgcGl0Y2hfbGlzdCkKICAgICAgICAgICAgICAgICAgICA6IHJlY29yZCgiYWEiLCBtZXJnZSB7ICJjdXN0b20iLCAiOjoiLCBzdGF0ZSwgIjo6IiwgInBpdGNoIiB9KQogICAgICAgICAgICAgICAgICAgIDogc2F2ZSgpCgogICAgICAgICAgICAgICAgICAgIGxpc3QucGl0Y2hfb2Zmc2V0ID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfc2xpZGVyLCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgbWVyZ2UgeyAiXG4iLCAiY3VzdG9tXyIsICJwaXRjaF9vZmZzZXRfIiwgc3RhdGUgfSwgLTg5LCA4OSwgMCwgdHJ1ZSwgIsKwIikKICAgICAgICAgICAgICAgICAgICA6IHJlY29yZCgiYWEiLCBtZXJnZSB7ICJjdXN0b20iLCAiOjoiLCBzdGF0ZSwgIjo6IiwgInBpdGNoX29mZnNldCIgfSkKICAgICAgICAgICAgICAgICAgICA6IHNhdmUoKQoKICAgICAgICAgICAgICAgICAgICBsaXN0Lnlhd19iYXNlID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfY29tYm9ib3gsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCBtZXJnZSB7ICJZYXcgYmFzZSIsICJcbiIsICJjdXN0b21fIiwgInlhd19iYXNlXyIsIHN0YXRlIH0sIHsgIkxvY2FsIHZpZXciLCAiQXQgdGFyZ2V0cyIgfSkKICAgICAgICAgICAgICAgICAgICA6IHJlY29yZCgiYWEiLCBtZXJnZSB7ICJjdXN0b20iLCAiOjoiLCBzdGF0ZSwgIjo6IiwgInlhd19iYXNlIiB9KQogICAgICAgICAgICAgICAgICAgIDogc2F2ZSgpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBsaXN0LnlhdyA9IG1lbnUubmV3X2l0ZW0odWkubmV3X2NvbWJvYm94LCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgbWVyZ2UgeyAiWWF3IiwgIlxuIiwgImN1c3RvbV8iLCAieWF3XyIsIHN0YXRlIH0sIHsgIk9mZiIsICIxODAiLCAiU3BpbiIsICJTdGF0aWMiLCAiMTgwIFoiLCAiQ3Jvc3NoYWlyIiwgIjE4MCBMUiIgfSkKICAgICAgICAgICAgICAgIDogcmVjb3JkKCJhYSIsIG1lcmdlIHsgImN1c3RvbSIsICI6OiIsIHN0YXRlLCAiOjoiLCAieWF3IiB9KQogICAgICAgICAgICAgICAgOiBzYXZlKCkKCiAgICAgICAgICAgICAgICBsaXN0Lnlhd19vZmZzZXQgPSBtZW51Lm5ld19pdGVtKHVpLm5ld19zbGlkZXIsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCBtZXJnZSB7ICJcbiIsICJjdXN0b21fIiwgInlhd19vZmZzZXRfIiwgc3RhdGUgfSwgLTE4MCwgMTgwLCAwLCB0cnVlLCAiwrAiKQogICAgICAgICAgICAgICAgOiByZWNvcmQoImFhIiwgbWVyZ2UgeyAiY3VzdG9tIiwgIjo6Iiwgc3RhdGUsICI6OiIsICJ5YXdfb2Zmc2V0IiB9KQogICAgICAgICAgICAgICAgOiBzYXZlKCkKCiAgICAgICAgICAgICAgICBsaXN0Lnlhd18xODBscl9tb2RlID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfY29tYm9ib3gsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCBtZXJnZSB7ICJcbiIsICJjdXN0b21fIiwgInlhd18xODBscl9tb2RlXyIsIHN0YXRlIH0sIHsgIlNpZGUgYmFzZWQiLCAiU3dpdGNoIGRlbGF5IiB9KQogICAgICAgICAgICAgICAgOiByZWNvcmQoImFhIiwgbWVyZ2UgeyAiY3VzdG9tIiwgIjo6Iiwgc3RhdGUsICI6OiIsICJ5YXdfMTgwbHJfbW9kZSIgfSkKICAgICAgICAgICAgICAgIDogc2F2ZSgpCgogICAgICAgICAgICAgICAgbGlzdC55YXdfbGVmdCA9IG1lbnUubmV3X2l0ZW0odWkubmV3X3NsaWRlciwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsIG1lcmdlIHsgIkxlZnQgb2Zmc2V0IiwgIlxuIiwgImN1c3RvbV8iLCAieWF3X2xlZnRfIiwgc3RhdGUgfSwgLTE4MCwgMTgwLCAwLCB0cnVlLCAiwrAiKQogICAgICAgICAgICAgICAgOiByZWNvcmQoImFhIiwgbWVyZ2UgeyAiY3VzdG9tIiwgIjo6Iiwgc3RhdGUsICI6OiIsICJ5YXdfbGVmdCIgfSkKICAgICAgICAgICAgICAgIDogc2F2ZSgpCgogICAgICAgICAgICAgICAgbGlzdC55YXdfcmlnaHQgPSBtZW51Lm5ld19pdGVtKHVpLm5ld19zbGlkZXIsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCBtZXJnZSB7ICJSaWdodCBvZmZzZXQiLCAiXG4iLCAiY3VzdG9tXyIsICJ5YXdfcmlnaHRfIiwgc3RhdGUgfSwgLTE4MCwgMTgwLCAwLCB0cnVlLCAiwrAiKQogICAgICAgICAgICAgICAgOiByZWNvcmQoImFhIiwgbWVyZ2UgeyAiY3VzdG9tIiwgIjo6Iiwgc3RhdGUsICI6OiIsICJ5YXdfcmlnaHQiIH0pCiAgICAgICAgICAgICAgICA6IHNhdmUoKQoKICAgICAgICAgICAgICAgIGxpc3QueWF3X2RlbGF5ID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfc2xpZGVyLCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgbWVyZ2UgeyAiRGVsYXkiLCAiXG4iLCAiY3VzdG9tXyIsICJEZWxheV8iLCBzdGF0ZSB9LCAyLCAxMCwgNSwgdHJ1ZSwgInQiKQogICAgICAgICAgICAgICAgOiByZWNvcmQoImFhIiwgbWVyZ2UgeyAiY3VzdG9tIiwgIjo6Iiwgc3RhdGUsICI6OiIsICJ5YXdfZGVsYXkiIH0pCiAgICAgICAgICAgICAgICA6IHNhdmUoKQoKICAgICAgICAgICAgICAgIGxpc3QueWF3X2ppdHRlciA9IG1lbnUubmV3X2l0ZW0odWkubmV3X2NvbWJvYm94LCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgbWVyZ2UgeyAiWWF3IGppdHRlciIsICJcbiIsICJjdXN0b21fIiwgInlhd19qaXR0ZXJfIiwgc3RhdGUgfSwgeyAiT2ZmIiwgIk9mZnNldCIsICJDZW50ZXIiLCAiUmFuZG9tIiwgIlNraXR0ZXIiLCAiQWNpZFRlY2giIH0pCiAgICAgICAgICAgICAgICA6IHJlY29yZCgiYWEiLCBtZXJnZSB7ICJjdXN0b20iLCAiOjoiLCBzdGF0ZSwgIjo6IiwgInlhd19qaXR0ZXIiIH0pCiAgICAgICAgICAgICAgICA6IHNhdmUoKQoKICAgICAgICAgICAgICAgIGxpc3Quaml0dGVyX21vZGUgPSBtZW51Lm5ld19pdGVtKHVpLm5ld19jb21ib2JveCwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsIG1lcmdlIHsgIlxuIiwgImN1c3RvbV8iLCAiaml0dGVyX21vZGVfIiwgc3RhdGUgfSwgeyAiMi1XYXkiLCAiMy1XYXkiLCAiNS1XYXkiIH0pCiAgICAgICAgICAgICAgICA6IHJlY29yZCgiYWEiLCBtZXJnZSB7ICJjdXN0b20iLCAiOjoiLCBzdGF0ZSwgIjo6IiwgImppdHRlcl9tb2RlIiB9KQogICAgICAgICAgICAgICAgOiBzYXZlKCkKCiAgICAgICAgICAgICAgICBsaXN0LmppdHRlcl9vZmZzZXQgPSBtZW51Lm5ld19pdGVtKHVpLm5ld19zbGlkZXIsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCBtZXJnZSB7ICJcbkppdHRlciBvZmZzZXQiLCAiXG4iLCAiY3VzdG9tXyIsICJqaXR0ZXJfb2Zmc2V0XyIsIHN0YXRlIH0sIC0xODAsIDE4MCwgMCwgdHJ1ZSwgIsKwIikKICAgICAgICAgICAgICAgIDogcmVjb3JkKCJhYSIsIG1lcmdlIHsgImN1c3RvbSIsICI6OiIsIHN0YXRlLCAiOjoiLCAiaml0dGVyX29mZnNldCIgfSkKICAgICAgICAgICAgICAgIDogc2F2ZSgpCgogICAgICAgICAgICAgICAgbGlzdC5qaXR0ZXJfcmFuZG9taXphdGlvbiA9IG1lbnUubmV3X2l0ZW0odWkubmV3X3NsaWRlciwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsIG1lcmdlIHsgIlJhbmRvbWl6YXRpb24iLCAiXG4iLCAiY3VzdG9tXyIsICJqaXR0ZXJfcmFuZG9taXphdGlvbl8iLCBzdGF0ZSB9LCAwLCAxODAsIDAsIHRydWUsICLCsCIsIDEsIHsgWzBdID0gIk9mZiIgfSkKICAgICAgICAgICAgICAgIDogcmVjb3JkKCJhYSIsIG1lcmdlIHsgImN1c3RvbSIsICI6OiIsIHN0YXRlLCAiOjoiLCAiaml0dGVyX3JhbmRvbWl6YXRpb24iIH0pCiAgICAgICAgICAgICAgICA6IHNhdmUoKQoKICAgICAgICAgICAgICAgIGxpc3QuYWNpZF9jeWNsZSA9IG1lbnUubmV3X2l0ZW0odWkubmV3X3NsaWRlciwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsIG1lcmdlIHsgIkRlbGF5IEN5Y2xlIiwgIlxuIiwgImN1c3RvbV8iLCAiZGVsYXlfY3ljbGVfIiwgc3RhdGUgfSwgNSwgMjAwLCA1MCwgdHJ1ZSwgJycsIDEsIHsgWzVdID0gIk9mZiIgfSkKICAgICAgICAgICAgICAgIDogcmVjb3JkKCJhYSIsIG1lcmdlIHsgImN1c3RvbSIsICI6OiIsIHN0YXRlLCAiOjoiLCAiYWNpZF9jeWNsZSIgfSkKICAgICAgICAgICAgICAgIDogc2F2ZSgpCgogICAgICAgICAgICAgICAgbGlzdC5hY2lkX2RlbGF5ID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfc2xpZGVyLCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgbWVyZ2UgeyAiRGVsYXkgVGltZSIsICJcbiIsICJjdXN0b21fIiwgImFjaWRfZGVsYXkiLCBzdGF0ZSB9LCA1LCAzMCwgMTUpCiAgICAgICAgICAgICAgICA6IHJlY29yZCgiYWEiLCBtZXJnZSB7ICJjdXN0b20iLCAiOjoiLCBzdGF0ZSwgIjo6IiwgImFjaWRfZGVsYXkiIH0pCiAgICAgICAgICAgICAgICA6IHNhdmUoKQoKICAgICAgICAgICAgICAgIGxpc3QuYWNpZF9zYWZlID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfY2hlY2tib3gsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCBtZXJnZSB7ICJTYWZlIFlhdyIsICJcbiIsICJjdXN0b21fIiwgInNhZmVfeWF3XyIsIHN0YXRlIH0pCiAgICAgICAgICAgICAgICA6IHJlY29yZCgiYWEiLCBtZXJnZSB7ICJjdXN0b20iLCAiOjoiLCBzdGF0ZSwgIjo6IiwgImFjaWRfc2FmZSIgfSkKICAgICAgICAgICAgICAgIDogc2F2ZSgpCgogICAgICAgICAgICAgICAgbGlzdC5ib2R5X3lhdyA9IG1lbnUubmV3X2l0ZW0odWkubmV3X2NvbWJvYm94LCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgbWVyZ2UgeyAiQm9keSB5YXciLCAiXG4iLCAiY3VzdG9tXyIsICJib2R5X3lhd18iLCBzdGF0ZSB9LCB7ICJPZmYiLCAiT3Bwb3NpdGUiLCAiSml0dGVyIiwgIlN0YXRpYyIsICdSYW5kb21pemUgSml0dGVyJyB9KQogICAgICAgICAgICAgICAgOiByZWNvcmQoImFhIiwgbWVyZ2UgeyAiY3VzdG9tIiwgIjo6Iiwgc3RhdGUsICI6OiIsICJib2R5X3lhdyIgfSkKICAgICAgICAgICAgICAgIDogc2F2ZSgpCgogICAgICAgICAgICAgICAgbGlzdC5ib2R5X3lhd19vZmZzZXQgPSBtZW51Lm5ld19pdGVtKHVpLm5ld19zbGlkZXIsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCBtZXJnZSB7ICJcbiIsICJjdXN0b21fIiwgImJvZHlfeWF3X29mZnNldF8iLCBzdGF0ZSB9LCAtMTgwLCAxODAsIDAsIHRydWUsICLCsCIpCiAgICAgICAgICAgICAgICA6IHJlY29yZCgiYWEiLCBtZXJnZSB7ICJjdXN0b20iLCAiOjoiLCBzdGF0ZSwgIjo6IiwgImJvZHlfeWF3X29mZnNldCIgfSkKICAgICAgICAgICAgICAgIDogc2F2ZSgpCgogICAgICAgICAgICAgICAgbGlzdC5mcmVlc3RhbmRpbmdfYm9keV95YXcgPSBtZW51Lm5ld19pdGVtKHVpLm5ld19jaGVja2JveCwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsIG1lcmdlIHsgIkZyZWVzdGFuZGluZyBib2R5IHlhdyIsICJcbiIsICJjdXN0b21fIiwgImZyZWVzdGFuZGluZ19ib2R5X3lhd18iLCBzdGF0ZSB9KQogICAgICAgICAgICAgICAgOiByZWNvcmQoImFhIiwgbWVyZ2UgeyAiY3VzdG9tIiwgIjo6Iiwgc3RhdGUsICI6OiIsICJmcmVlc3RhbmRpbmdfYm9keV95YXciIH0pCiAgICAgICAgICAgICAgICA6IHNhdmUoKQoKCiAgICAgICAgICAgICAgICBsaXN0LmFjaWRfc2FmZTpzZXRfY2FsbGJhY2socmVzZXRfZGVsYXkpCiAgICAgICAgICAgICAgICBsaXN0LmFjaWRfZGVsYXk6c2V0X2NhbGxiYWNrKHJlc2V0X2RlbGF5KQogICAgICAgICAgICAgICAgbGlzdC5hY2lkX2N5Y2xlOnNldF9jYWxsYmFjayhyZXNldF9kZWxheSkKCiAgICAgICAgICAgICAgICBhbmdsZXMuY3VzdG9tW3N0YXRlXSA9IGxpc3QKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIGFuZ2xlcy5yZWNvbW1lbmRlZCA9IHsKICAgICAgICAgICAgWydTdGFuZGluZyddID0gZnVuY3Rpb24gKGN0eCkKICAgICAgICAgICAgICAgIGN0eC5waXRjaCA9ICdEZWZhdWx0JwogICAgICAgICAgICAgICAgY3R4Lnlhd19iYXNlID0gJ0F0IHRhcmdldHMnCiAgICAgICAgICAgICAgICBjdHgueWF3ID0gJzE4MCcKICAgICAgICAgICAgICAgIGN0eC55YXdfb2Zmc2V0ID0gMTAKICAgICAgICAgICAgICAgIGN0eC55YXdfaml0dGVyID0gJ1NraXR0ZXInCiAgICAgICAgICAgICAgICBjdHguaml0dGVyX29mZnNldCA9IDM1CiAgICAgICAgICAgICAgICBjdHguYm9keV95YXcgPSAnSml0dGVyJwogICAgICAgICAgICAgICAgY3R4LmJvZHlfeWF3X29mZnNldCA9IC00MAogICAgICAgICAgICBlbmQsCgogICAgICAgICAgICBbJ01vdmluZyddID0gZnVuY3Rpb24gKGN0eCkKICAgICAgICAgICAgICAgIGN0eC5waXRjaCA9ICdEZWZhdWx0JwogICAgICAgICAgICAgICAgY3R4Lnlhd19iYXNlID0gJ0F0IHRhcmdldHMnCiAgICAgICAgICAgICAgICBjdHgueWF3ID0gJzE4MCcKICAgICAgICAgICAgICAgIGN0eC55YXdfb2Zmc2V0ID0gMTAKICAgICAgICAgICAgICAgIGN0eC55YXdfaml0dGVyID0gJ0NlbnRlcicKICAgICAgICAgICAgICAgIGN0eC5qaXR0ZXJfb2Zmc2V0ID0gNjAKICAgICAgICAgICAgICAgIGN0eC5ib2R5X3lhdyA9ICdKaXR0ZXInCiAgICAgICAgICAgICAgICBjdHguYm9keV95YXdfb2Zmc2V0ID0gLTQwCiAgICAgICAgICAgIGVuZCwKCiAgICAgICAgICAgIFsnU2xvdyBXYWxrJ10gPSBmdW5jdGlvbiAoY3R4KQogICAgICAgICAgICAgICAgY3R4LnBpdGNoID0gJ0RlZmF1bHQnCiAgICAgICAgICAgICAgICBjdHgueWF3X2Jhc2UgPSAnQXQgdGFyZ2V0cycKICAgICAgICAgICAgICAgIGN0eC55YXcgPSAnMTgwJwogICAgICAgICAgICAgICAgY3R4Lnlhd19vZmZzZXQgPSAxMAogICAgICAgICAgICAgICAgY3R4Lnlhd19qaXR0ZXIgPSAnQWNpZFRlY2gnCiAgICAgICAgICAgICAgICBjdHguaml0dGVyX21vZGUgPSAnMi1XYXknCiAgICAgICAgICAgICAgICBjdHguaml0dGVyX29mZnNldCA9IDYwCiAgICAgICAgICAgICAgICBjdHguaml0dGVyX3JhbmRvbWl6YXRpb24gPSAxNQogICAgICAgICAgICAgICAgY3R4LmFjaWRfY3ljbGUgPSAzMgogICAgICAgICAgICAgICAgY3R4LmFjaWRfZGVsYXkgPSAxOAogICAgICAgICAgICAgICAgY3R4LmFjaWRfc2FmZSA9IHRydWUKICAgICAgICAgICAgICAgIGN0eC5ib2R5X3lhdyA9ICdKaXR0ZXInCiAgICAgICAgICAgICAgICBjdHguYm9keV95YXdfb2Zmc2V0ID0gLTQwCiAgICAgICAgICAgIGVuZCwKCiAgICAgICAgICAgIFsnQ3JvdWNoZWQnXSA9IGZ1bmN0aW9uIChjdHgpCiAgICAgICAgICAgICAgICBjdHgucGl0Y2ggPSAnRGVmYXVsdCcKICAgICAgICAgICAgICAgIGN0eC55YXdfYmFzZSA9ICdBdCB0YXJnZXRzJwogICAgICAgICAgICAgICAgY3R4LnlhdyA9ICcxODAnCiAgICAgICAgICAgICAgICBjdHgueWF3X29mZnNldCA9IDEwCiAgICAgICAgICAgICAgICBjdHgueWF3X2ppdHRlciA9ICdDZW50ZXInCiAgICAgICAgICAgICAgICBjdHguaml0dGVyX29mZnNldCA9IDcwCiAgICAgICAgICAgICAgICBjdHguYm9keV95YXcgPSAnSml0dGVyJwogICAgICAgICAgICAgICAgY3R4LmJvZHlfeWF3X29mZnNldCA9IC00MAogICAgICAgICAgICBlbmQsCgogICAgICAgICAgICBbJ01vdmUgQ3JvdWNoZWQnXSA9IGZ1bmN0aW9uIChjdHgpCiAgICAgICAgICAgICAgICBjdHgucGl0Y2ggPSAnRGVmYXVsdCcKICAgICAgICAgICAgICAgIGN0eC55YXdfYmFzZSA9ICdBdCB0YXJnZXRzJwogICAgICAgICAgICAgICAgY3R4LnlhdyA9ICcxODAnCiAgICAgICAgICAgICAgICBjdHgueWF3X29mZnNldCA9IDEwCiAgICAgICAgICAgICAgICBjdHgueWF3X2ppdHRlciA9ICdDZW50ZXInCiAgICAgICAgICAgICAgICBjdHguaml0dGVyX29mZnNldCA9IDYwCiAgICAgICAgICAgICAgICBjdHguYm9keV95YXcgPSAnSml0dGVyJwogICAgICAgICAgICAgICAgY3R4LmJvZHlfeWF3X29mZnNldCA9IC00MAogICAgICAgICAgICBlbmQsCgogICAgICAgICAgICBbJ0FpciddID0gZnVuY3Rpb24gKGN0eCkKICAgICAgICAgICAgICAgIGN0eC5waXRjaCA9ICdEZWZhdWx0JwogICAgICAgICAgICAgICAgY3R4Lnlhd19iYXNlID0gJ0F0IHRhcmdldHMnCiAgICAgICAgICAgICAgICBjdHgueWF3ID0gJzE4MCcKICAgICAgICAgICAgICAgIGN0eC55YXdfb2Zmc2V0ID0gMAogICAgICAgICAgICAgICAgY3R4Lnlhd19qaXR0ZXIgPSAnT2ZmJwogICAgICAgICAgICAgICAgY3R4LmppdHRlcl9vZmZzZXQgPSAwCiAgICAgICAgICAgICAgICBjdHguYm9keV95YXcgPSAnT3Bwb3NpdGUnCiAgICAgICAgICAgICAgICBjdHguYm9keV95YXdfb2Zmc2V0ID0gMAogICAgICAgICAgICAgICAgY3R4LmZyZWVzdGFuZGluZ19ib2R5X3lhdyA9IHRydWUKICAgICAgICAgICAgZW5kLAoKICAgICAgICAgICAgWydBaXIgQ3JvdWNoZWQnXSA9IGZ1bmN0aW9uIChjdHgpCiAgICAgICAgICAgICAgICBjdHgucGl0Y2ggPSAnRGVmYXVsdCcKICAgICAgICAgICAgICAgIGN0eC55YXdfYmFzZSA9ICdBdCB0YXJnZXRzJwogICAgICAgICAgICAgICAgY3R4LnlhdyA9ICcxODAnCiAgICAgICAgICAgICAgICBjdHgueWF3X29mZnNldCA9IDAKICAgICAgICAgICAgICAgIGN0eC55YXdfaml0dGVyID0gJ09mZicKICAgICAgICAgICAgICAgIGN0eC5qaXR0ZXJfb2Zmc2V0ID0gMAogICAgICAgICAgICAgICAgY3R4LmJvZHlfeWF3ID0gJ09wcG9zaXRlJwogICAgICAgICAgICAgICAgY3R4LmJvZHlfeWF3X29mZnNldCA9IDAKICAgICAgICAgICAgICAgIGN0eC5mcmVlc3RhbmRpbmdfYm9keV95YXcgPSB0cnVlCiAgICAgICAgICAgIGVuZCwKCiAgICAgICAgICAgIFsnRmFrZSBMYWcnXSA9IGZ1bmN0aW9uIChjdHgpCiAgICAgICAgICAgICAgICBjdHgucGl0Y2ggPSAnRGVmYXVsdCcKICAgICAgICAgICAgICAgIGN0eC55YXdfYmFzZSA9ICdBdCB0YXJnZXRzJwogICAgICAgICAgICAgICAgY3R4LnlhdyA9ICcxODAnCiAgICAgICAgICAgICAgICBjdHgueWF3X29mZnNldCA9IDAKICAgICAgICAgICAgICAgIGN0eC55YXdfaml0dGVyID0gJ09mZicKICAgICAgICAgICAgICAgIGN0eC5qaXR0ZXJfb2Zmc2V0ID0gMAogICAgICAgICAgICAgICAgY3R4LmJvZHlfeWF3ID0gJ09wcG9zaXRlJwogICAgICAgICAgICAgICAgY3R4LmJvZHlfeWF3X29mZnNldCA9IDAKICAgICAgICAgICAgICAgIGN0eC5mcmVlc3RhbmRpbmdfYm9keV95YXcgPSB0cnVlCiAgICAgICAgICAgIGVuZAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYW5nbGVzLnNldChjdHgsIHN0YXRlKQogICAgICAgICAgICBpZiBhbmdsZXMudHlwZTpnZXQoKSA9PSAiQ3VzdG9tIiB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBsaXN0ID0gYW5nbGVzLmN1c3RvbVtzdGF0ZV0KCiAgICAgICAgICAgICAgICBpZiBsaXN0IH49IG5pbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgLS0gaWYgbm90IGVuYWJsZWQgaW4gbWVudQogICAgICAgICAgICAgICAgICAgIGlmIGxpc3QuZW5hYmxlZCB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgbGlzdC5lbmFibGVkOmdldCgpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgc2V0X2N1c3RvbV9saXN0KGN0eCwgbGlzdCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgYW5nbGVzLnR5cGU6Z2V0KCkgPT0gIlJlY29tbWVuZGVkIiB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBmbiA9IGFuZ2xlcy5yZWNvbW1lbmRlZFtzdGF0ZV0KCiAgICAgICAgICAgICAgICBpZiBmbiB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgICAgIGZuKGN0eCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIGFuZ2xlcy51cGRhdGUoY3R4KQogICAgICAgICAgICBsb2NhbCBsaXN0ID0gc3RhdGVtZW50LmdldCgpCgogICAgICAgICAgICBmb3IgaSA9ICNsaXN0LCAxLCAtMSBkbwogICAgICAgICAgICAgICAgbG9jYWwgc3RhdGUgPSBsaXN0W2ldCgogICAgICAgICAgICAgICAgaWYgYW5nbGVzLnNldChjdHgsIHN0YXRlKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBhbmdsZXMuc2V0KGN0eCwgIk1haW4iKQogICAgICAgIGVuZAogICAgZW5kCgogICAgLS0tIHJlZ2lvbiB5YXdfZGlyZWN0aW9uCiAgICBkbwoKICAgICAgICB5YXdfZGlyZWN0aW9uLmVkZ2VfeWF3ID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfaG90a2V5LCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgbWVyZ2UgeyAiRWRnZSBZYXciLCAiXG4iLCAieWF3X2RpcmVjdGlvbjo6ZWRnZV95YXciIH0pCiAgICAgICAgOiByZWNvcmQoImFhIiwgInlhd19kaXJlY3Rpb246OmVkZ2VfeWF3IikKCiAgICAgICAgeWF3X2RpcmVjdGlvbi5mcmVlc3RhbmRpbmcgPSBtZW51Lm5ld19pdGVtKHVpLm5ld19ob3RrZXksICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCBtZXJnZSB7ICJGcmVlc3RhbmRpbmciLCAiXG4iLCAieWF3X2RpcmVjdGlvbjo6ZnJlZXN0YW5kaW5nIiB9KQogICAgICAgIDogcmVjb3JkKCJhYSIsICJ5YXdfZGlyZWN0aW9uOjpmcmVlc3RhbmRpbmciKQoKICAgICAgICBmc19kaXNhYmxlcnMuc3RhdGVzID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfbXVsdGlzZWxlY3QsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCBtZXJnZSB7ICItIERpc2FibGUgT24iLCAiXG4iLCAiZnNfZGlzYWJsZXJzOjpzdGF0ZXMiIH0sIHsiU3RhbmRpbmciLCAiTW92aW5nIiwgIlNsb3cgV2FsayIsICJDcm91Y2hlZCIsICJBaXIiIH0pCiAgICAgICAgOiByZWNvcmQoImFhIiwgImZzX2Rpc2FibGVyczo6c3RhdGVzIikKICAgICAgICA6IHNhdmUoKQoKICAgICAgICBmdW5jdGlvbiB5YXdfZGlyZWN0aW9uLnVwZGF0ZShjdHgpCiAgICAgICAgICAgIGlmIG5vdCBhYV90d2Vha3MuZW5hYmxlOmdldCgpIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIGFhX3R3ZWFrcy5pdGVtczpoYXZlX2tleSgnRWRnZSBZYXcgb24gRkQnKSBhbmQgc29mdHdhcmUuaXNfZHVja19wZWVrX2Fzc2lzdCgpIHRoZW4KICAgICAgICAgICAgICAgIGN0eC5lZGdlX3lhdyA9IHRydWUsIDEKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgY3R4LmVkZ2VfeWF3ID0geWF3X2RpcmVjdGlvbi5lZGdlX3lhdzpyYXdnZXQoKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGN0eC5mcmVlc3RhbmRpbmcgPSB5YXdfZGlyZWN0aW9uLmZyZWVzdGFuZGluZzpyYXdnZXQoKQogICAgICAgIGVuZAogICAgZW5kCgogICAgLS0tIHJlZ2lvbiBmcmVlc3RxYW5kIGRpc2FibGVycwogICAgZG8KICAgICAgICBsb2NhbCBmdW5jdGlvbiBnZXRfc3RhdGVtZW50KCkKICAgICAgICAgICAgaWYgbG9jYWxwbGF5ZXIuaXNfYWlyYm9ybmUgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuICJBaXIiCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgbG9jYWxwbGF5ZXIuaXNfY3JvdWNoZWQgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuICJDcm91Y2hlZCIKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBsb2NhbHBsYXllci5pc19tb3ZpbmcgdGhlbgogICAgICAgICAgICAgICAgaWYgc29mdHdhcmUuaXNfc2xvd19tb3Rpb24oKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJTbG93IFdhbGsiCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICByZXR1cm4gIk1vdmluZyIKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICByZXR1cm4gIlN0YW5kaW5nIgogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBmc19kaXNhYmxlcnMudXBkYXRlKGN0eCkKICAgICAgICAgICAgbG9jYWwgc3RhdGUgPSBnZXRfc3RhdGVtZW50KCkKICAgICAgICAgICAgaWYgc3RhdGUgPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIG5vdCBmc19kaXNhYmxlcnMuc3RhdGVzOmhhdmVfa2V5KHN0YXRlKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBjdHguZnJlZXN0YW5kaW5nID0gZmFsc2UKICAgICAgICBlbmQKICAgIGVuZAoKICAgIC0tLSBjbGllbnRzaWRlIG5pY2tuYW1lCiAgICBkbwogICAgICAgIGNsaWVudHNpZGVfbmlja25hbWUuZW5hYmxlZCA9IG1lbnUubmV3X2l0ZW0odWkubmV3X2NoZWNrYm94LCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIkNsaWVudC1TaWRlIE5pY2tuYW1lIikKICAgICAgICA6IHJlY29yZCgidmlzdWFscyIsICJjbGllbnRzaWRlX25pY2tuYW1lOjplbmFibGVkIikKICAgICAgICA6IHNhdmUoKQoKICAgICAgICBjbGllbnRzaWRlX25pY2tuYW1lLm5pY2tuYW1lID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfdGV4dGJveCwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJOaWNrbmFtZSIpCiAgICAgICAgOiByZWNvcmQoInZpc3VhbHMiLCAiY2xpZW50c2lkZV9uaWNrbmFtZTo6bmlja25hbWUiKQogICAgICAgIDogc2F2ZSgpCgogICAgICAgIGxvY2FsIHBhbm9yYW1hID0gcGFub3JhbWEub3BlbigpCgogICAgICAgIGxvY2FsIG5hdGl2ZV9CYXNlTG9jYWxDbGllbnRfYmFzZSA9IGZmaS5jYXN0KCJ1aW50cHRyX3QqKiIsIG1lbW9yeS5wYXR0ZXJuX3NjYW4oImVuZ2luZS5kbGwiLCAiQTEgPyA/ID8gPyAwRiAyOCBDMSBGMyAwRiA1QyA4MCA/ID8gPyA/IEYzIDBGIDExIDQ1ID8gQTEgPyA/ID8gPyA1NiA4NSBDMCA3NSAwNCAzMyBGNiBFQiAyNiA4MCA3OCAxNCAwMCA3NCBGNiA4QiA0RCAwOCAzMyBEMiBFOCA/ID8gPyA/IDhCIEYwIDg1IEY2IiwgMSkpCgogICAgICAgIGxvY2FsIHBsYXllcl9pbmZvX3QgPSBmZmkudHlwZW9mKFtbCiAgICAgICAgICAgIHN0cnVjdCB7CiAgICAgICAgICAgICAgICBpbnQ2NF90ICAgICAgICAgdW5rbm93bjsKICAgICAgICAgICAgICAgIGludDY0X3QgICAgICAgICBzdGVhbUlENjQ7CiAgICAgICAgICAgICAgICBjaGFyICAgICAgICAgICAgc3pOYW1lWzEyOF07CiAgICAgICAgICAgICAgICBpbnQgICAgICAgICAgICAgdXNlcklkOwogICAgICAgICAgICAgICAgY2hhciAgICAgICAgICAgIHN6U3RlYW1JRFsyMF07CiAgICAgICAgICAgICAgICBjaGFyICAgICAgICAgICAgcGFkXzB4MDBBOFsweDEwXTsKICAgICAgICAgICAgICAgIHVuc2lnbmVkIGxvbmcgICBpU3RlYW1JRDsKICAgICAgICAgICAgICAgIGNoYXIgICAgICAgICAgICBzekZyaWVuZHNOYW1lWzEyOF07CiAgICAgICAgICAgICAgICBib29sICAgICAgICAgICAgZmFrZXBsYXllcjsKICAgICAgICAgICAgICAgIGJvb2wgICAgICAgICAgICBpc2hsdHY7CiAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgICAgY3VzdG9tZmlsZXNbNF07CiAgICAgICAgICAgICAgICB1bnNpZ25lZCBjaGFyICAgZmlsZXNkb3dubG9hZGVkOwogICAgICAgICAgICB9CiAgICAgICAgXV0pCgogICAgICAgIGxvY2FsIG5hdGl2ZV9HZXRTdHJpbmdVc2VyRGF0YSA9IHZ0YWJsZV90aHVuaygxMSwgZmZpLnR5cGVvZigiJCooX190aGlzY2FsbCopKHZvaWQqLCBpbnQsIGludCopIiwgcGxheWVyX2luZm9fdCkpCgogICAgICAgIGxvY2FsIHByZXZpb3VzX25hbWUKICAgICAgICBsb2NhbCBmdW5jdGlvbiBhcHBseV9uaWNrbmFtZShuYW1lKQogICAgICAgICAgICBsb2NhbCBsb2NhbF9wbGF5ZXIgPSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpCiAgICAgICAgICAgIGlmIG5vdCBsb2NhbF9wbGF5ZXIgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgbmF0aXZlX0Jhc2VMb2NhbENsaWVudCA9IG5hdGl2ZV9CYXNlTG9jYWxDbGllbnRfYmFzZVswXVswXQogICAgICAgICAgICBpZiBub3QgbmF0aXZlX0Jhc2VMb2NhbENsaWVudCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBuYXRpdmVfVXNlckluZm9UYWJsZSA9IGZmaS5jYXN0KCJ2b2lkKioqIiwgbmF0aXZlX0Jhc2VMb2NhbENsaWVudCArIDB4NTJDMClbMF0KICAgICAgICAgICAgaWYgbm90IG5hdGl2ZV9Vc2VySW5mb1RhYmxlIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIGRhdGEgPSBuYXRpdmVfR2V0U3RyaW5nVXNlckRhdGEobmF0aXZlX1VzZXJJbmZvVGFibGUsIGxvY2FsX3BsYXllciAtIDEsIG5pbCkKICAgICAgICAgICAgaWYgbm90IGRhdGEgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgdGhpc19uYW1lID0gZmZpLnN0cmluZyhkYXRhWzBdLnN6TmFtZSkKICAgICAgICAgICAgaWYgbmFtZSB+PSB0aGlzX25hbWUgYW5kIHByZXZpb3VzX25hbWUgPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIHByZXZpb3VzX25hbWUgPSB0aGlzX25hbWUKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBkYXRhWzBdLnN6TmFtZSA9IGZmaS5uZXcoImNoYXJbMTI4XSIsIG5hbWUpCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIHdhc19hcHBsaWVkID0gZmFsc2UKICAgICAgICBsb2NhbCBmdW5jdGlvbiBjYWxsYmFjaygpCiAgICAgICAgICAgIGxvY2FsIGNob3Nlbl9uaWNrID0gdWkuZ2V0KGNsaWVudHNpZGVfbmlja25hbWUubmlja25hbWU6Z2V0X3JlZigpKTpzdWIoMCwgMzIpCiAgICAgICAgICAgIGNsaWVudHNpZGVfbmlja25hbWUubmlja25hbWU6c2V0KGNob3Nlbl9uaWNrKQoKICAgICAgICAgICAgaWYgbm90IGNsaWVudHNpZGVfbmlja25hbWUuZW5hYmxlZDpnZXQoKSBvciAjY2hvc2VuX25pY2sgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICBpZiB3YXNfYXBwbGllZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgd2FzX2FwcGxpZWQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIGFwcGx5X25pY2tuYW1lKHByZXZpb3VzX25hbWUgb3IgcGFub3JhbWFbIk15UGVyc29uYUFQSSJdWyJHZXROYW1lIl0oKSkKICAgICAgICAgICAgICAgICAgICBwcmV2aW91c19uYW1lID0gbmlsCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICB3YXNfYXBwbGllZCA9IHRydWUKCiAgICAgICAgICAgIGFwcGx5X25pY2tuYW1lKGNob3Nlbl9uaWNrKQogICAgICAgIGVuZAoKICAgICAgICBjbGllbnRzaWRlX25pY2tuYW1lLmFwcGx5ID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfYnV0dG9uLCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIkFwcGx5IiwgY2FsbGJhY2spCiAgICAgICAgOiByZWNvcmQoInZpc3VhbHMiLCAiY2xpZW50c2lkZV9uaWNrbmFtZTo6YXBwbHkiKQoKICAgICAgICBjbGllbnRzaWRlX25pY2tuYW1lLmVuYWJsZWQ6c2V0X2NhbGxiYWNrKGNhbGxiYWNrKQoKICAgICAgICBjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCdyb3VuZF9wcmVzdGFydCcsIGNhbGxiYWNrKQogICAgICAgIGNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soJ3BsYXllcl9jb25uZWN0X2Z1bGwnLCBjYWxsYmFjaykKCiAgICAgICAgY2FsbGJhY2soKQogICAgZW5kCgogICAgLS0gLS0tIHJlZ2lvbiBzaGFyZWQKICAgIC0tIGRvCiAgICAtLSAgICAgc2hhcmVkLmVuYWJsZWQgPSBtZW51Lm5ld19pdGVtKHVpLm5ld19jaGVja2JveCwgJ0FBJywgJ0FudGktYWltYm90IGFuZ2xlcycsICdTaGFyZWQgTG9nbycpCiAgICAtLSAgICAgOnJlY29yZCgnc2V0dGluZ3MnLCAnc2hhcmVkOjplbmFibGVkJykKICAgIC0tICAgICA6c2F2ZSgpCgogICAgLS0gICAgIHNoYXJlZC5zb2NrZXQgPSBuaWwKICAgIC0tICAgICBzaGFyZWQuZGF0YSA9IHsgfQogICAgLS0gICAgIHNoYXJlZC5pY29uX2RhdGEgPSB7IH0KICAgIC0tICAgICBzaGFyZWQubGluayA9ICJ3c3M6Ly9taXNoa2F0LmNsb3VkL2FjaWQvd3MiCiAgICAtLSAgICAgc2hhcmVkLmZhaWxlZF9jb25uZWN0aW9ucyA9IDAKCiAgICAtLSAgICAgbG9jYWwgc2NvcmVib2FyZCA9IHBhbm9yYW1hLmxvYWRzdHJpbmcoW1sKICAgIC0tICAgICAgICAgbGV0IF9nZXRfeHVpZCA9IGZ1bmN0aW9uKGVudGl0eV9pbmRleCkgewogICAgLS0gICAgICAgICAgICAgbGV0IHh1aWQgPSBHYW1lU3RhdGVBUEkuR2V0UGxheWVyWHVpZFN0cmluZ0Zyb21FbnRJbmRleChlbnRpdHlfaW5kZXgpOwogICAgLS0gICAgICAgICAgICAgcmV0dXJuIHh1aWQ7CiAgICAtLSAgICAgICAgIH0KCiAgICAtLSAgICAgICAgIGxldCBfc2V0X2ljb24gPSBmdW5jdGlvbihlbnRpdHlfaW5kZXgsIGljb24pIHsKICAgIC0tICAgICAgICAgICAgIGxldCB4dWlkID0gR2FtZVN0YXRlQVBJLkdldFBsYXllclh1aWRTdHJpbmdGcm9tRW50SW5kZXgoZW50aXR5X2luZGV4KTsKICAgIC0tICAgICAgICAgICAgIGxldCBjb250ZXh0X3BhbmVsID0gJC5HZXRDb250ZXh0UGFuZWwoKTsKICAgIC0tICAgICAgICAgICAgIGxldCBjdHggPSBjb250ZXh0X3BhbmVsLkZpbmRDaGlsZFRyYXZlcnNlKCdTY29yZWJvYXJkQ29udGFpbmVyJykuRmluZENoaWxkVHJhdmVyc2UoJ1Njb3JlYm9hcmQnKSB8fCBjb250ZXh0X3BhbmVsLkZpbmRDaGlsZFRyYXZlcnNlKCdpZC1lb20tc2NvcmVib2FyZC1jb250YWluZXInKS5GaW5kQ2hpbGRUcmF2ZXJzZSgnU2NvcmVib2FyZCcpCiAgICAtLSAgICAgICAgICAgICBpZiAoY3R4ID09IG51bGwpCiAgICAtLSAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgIC0tICAgICAgICAgICAgIGN0eC5GaW5kQ2hpbGRyZW5XaXRoQ2xhc3NUcmF2ZXJzZSgnc2Itcm93JykuZm9yRWFjaChmdW5jdGlvbihlKSB7CiAgICAtLSAgICAgICAgICAgICAgICAgaWYgKGUubV94dWlkICE9IHh1aWQpCiAgICAtLSAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAtLSAgICAgICAgICAgICAgICAgZS5DaGlsZHJlbigpLmZvckVhY2goZnVuY3Rpb24oY2hpbGQpIHsKICAgIC0tICAgICAgICAgICAgICAgICAgICAgbGV0IGF0dHJpYnV0ZSA9IGNoaWxkLkdldEF0dHJpYnV0ZVN0cmluZygnZGF0YS1zdGF0JywgJycpOwogICAgLS0gICAgICAgICAgICAgICAgICAgICBpZiAoYXR0cmlidXRlICE9ICdyYW5rJykKICAgIC0tICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAtLSAgICAgICAgICAgICAgICAgICAgIHZhciBpbWFnZSA9IGNoaWxkLkZpbmRDaGlsZFRyYXZlcnNlKCdpbWFnZScpOwogICAgLS0gICAgICAgICAgICAgICAgICAgICBpZiAoIWltYWdlIHx8ICFpbWFnZS5Jc1ZhbGlkKCkpCiAgICAtLSAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgLS0gICAgICAgICAgICAgICAgICAgICBpbWFnZS5TZXRJbWFnZShpY29uID09PSBudWxsID8gJycgOiBpY29uKQogICAgLS0gICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIC0tICAgICAgICAgICAgICAgICB9KQogICAgLS0gICAgICAgICAgICAgfSkKCiAgICAtLSAgICAgICAgICAgICByZXR1cm4geHVpZDsKICAgIC0tICAgICAgICAgfQoKICAgIC0tICAgICAgICAgcmV0dXJuIHsKICAgIC0tICAgICAgICAgICAgIHh1aWQ6IF9nZXRfeHVpZCwKICAgIC0tICAgICAgICAgICAgIHNldF9pY29uOiBfc2V0X2ljb24KICAgIC0tICAgICAgICAgfQogICAgLS0gICAgIF1dLCAnQ1NHT0h1ZCcpKCkKCiAgICAtLSAgICAgbG9jYWwgcGFub3JhbWEgPSBwYW5vcmFtYS5vcGVuKCkKCiAgICAtLSAgICAgc2hhcmVkLnJldHJpZXZlID0gZnVuY3Rpb24gKCkKICAgIC0tICAgICAgICAgbG9jYWwgaW5mbyA9IGpzb24uc3RyaW5naWZ5KHsKICAgIC0tICAgICAgICAgICAgIHN0ZWFtID0gdG9zdHJpbmcocGFub3JhbWEuTXlQZXJzb25hQVBJLkdldFh1aWQoKSksCiAgICAtLSAgICAgICAgICAgICBsb2dvID0gJ2JlYnJhJwogICAgLS0gICAgICAgICB9KQoKICAgIC0tICAgICAgICAgcmV0dXJuIGJhc2U2NC5lbmNvZGUoaW5mbykKICAgIC0tICAgICBlbmQKCiAgICAtLSAgICAgc2hhcmVkLmNhbGxiYWNrcyA9IHsKICAgIC0tICAgICAgICAgb3BlbiA9IGZ1bmN0aW9uKHdzKQogICAgLS0gICAgICAgICAgICAgd3M6c2VuZChzaGFyZWQucmV0cmlldmUoKSkKCiAgICAtLSAgICAgICAgICAgICBzaGFyZWQuc29ja2V0ID0gd3MKICAgIC0tICAgICAgICAgZW5kLAoKICAgIC0tICAgICAgICAgbWVzc2FnZSA9IGZ1bmN0aW9uKHdzLCBkYXRhKQogICAgLS0gICAgICAgICAgICAgbG9jYWwgc3VjY2VzcywgZGF0YSA9IHBjYWxsKGJhc2U2NC5kZWNvZGUsIGRhdGEpCiAgICAtLSAgICAgICAgICAgICBpZiBub3Qgc3VjY2VzcyBvciB0eXBlKGRhdGEpIH49ICdzdHJpbmcnIHRoZW4KICAgIC0tICAgICAgICAgICAgICAgICByZXR1cm4KICAgIC0tICAgICAgICAgICAgIGVuZAoKICAgIC0tICAgICAgICAgICAgIGxvY2FsIHN1Y2Nlc3MsIGRhdGEgPSBwY2FsbChqc29uLnBhcnNlLCBkYXRhKQogICAgLS0gICAgICAgICAgICAgaWYgbm90IHN1Y2Nlc3MgdGhlbgogICAgLS0gICAgICAgICAgICAgICAgIHJldHVybgogICAgLS0gICAgICAgICAgICAgZW5kCgogICAgLS0gICAgICAgICAgICAgbG9jYWwgb25saW5lID0gMAoKICAgIC0tICAgICAgICAgICAgIGZvciBfLCBvYmplY3QgaW4gbmV4dCwgZGF0YSBkbwogICAgLS0gICAgICAgICAgICAgICAgIGlmIHR5cGUob2JqZWN0KSA9PSAnc3RyaW5nJyB0aGVuCiAgICAtLSAgICAgICAgICAgICAgICAgICAgIG9ubGluZSA9IG9ubGluZSArIDEKICAgIC0tICAgICAgICAgICAgICAgICBlbmQKICAgIC0tICAgICAgICAgICAgIGVuZAoKICAgIC0tICAgICAgICAgICAgIHNoYXJlZC5vbmxpbmVfbGFiZWw6c2V0KHN0cmluZy5mb3JtYXQoJ0N1cnJlbnQgT25saW5lOiAlZCcsIG9ubGluZSkpCgogICAgLS0gICAgICAgICAgICAgc2hhcmVkLmRhdGEgPSBkYXRhCiAgICAtLSAgICAgICAgIGVuZCwKCiAgICAtLSAgICAgICAgIGNsb3NlID0gZnVuY3Rpb24gKHdzKQogICAgLS0gICAgICAgICAgICAgc2hhcmVkLnNvY2tldCA9IG5pbAogICAgLS0gICAgICAgICAgICAgY2xpZW50LmRlbGF5X2NhbGwoMTAsIHdlYnNvY2tldHMuY29ubmVjdCwgc2hhcmVkLmxpbmssIHNoYXJlZC5jYWxsYmFja3MpCiAgICAtLSAgICAgICAgIGVuZAogICAgLS0gICAgIH0KCiAgICAtLSAgICAgc2hhcmVkLnNlbmQgPSBmdW5jdGlvbiAoKQogICAgLS0gICAgICAgICBpZiBub3Qgc2hhcmVkLnNvY2tldCB0aGVuCiAgICAtLSAgICAgICAgICAgICByZXR1cm4KICAgIC0tICAgICAgICAgZW5kCgogICAgLS0gICAgICAgICBzaGFyZWQuc29ja2V0OnNlbmQoc2hhcmVkLnJldHJpZXZlKCkpCiAgICAtLSAgICAgZW5kCgogICAgLS0gICAgIHNoYXJlZC5hdHRhY2ggPSBmdW5jdGlvbiAoY29uZGl0aW9uKQogICAgLS0gICAgICAgICBsb2NhbCBlbmFibGVkID0gc2hhcmVkLmVuYWJsZWQ6Z2V0KCkgYW5kIG5vdCBjb25kaXRpb24KCiAgICAtLSAgICAgICAgIGZvciBpID0gMSwgZ2xvYmFscy5tYXhwbGF5ZXJzKCkgZG8KICAgIC0tICAgICAgICAgICAgIGlmIGVudGl0eS5nZXRfY2xhc3NuYW1lKGkpIH49ICdDQ1NQbGF5ZXInIHRoZW4KICAgIC0tICAgICAgICAgICAgICAgICBnb3RvIHNraXAKICAgIC0tICAgICAgICAgICAgIGVuZAoKICAgIC0tICAgICAgICAgICAgIGxvY2FsIHN0ZWFtX2lkID0gc2NvcmVib2FyZC54dWlkKGkpCgogICAgLS0gICAgICAgICAgICAgaWYgbm90IGVuYWJsZWQgdGhlbgogICAgLS0gICAgICAgICAgICAgICAgIGlmIG5vdCBzaGFyZWQuaWNvbl9kYXRhWyBzdGVhbV9pZCBdIHRoZW4KICAgIC0tICAgICAgICAgICAgICAgICAgICAgc2NvcmVib2FyZC5zZXRfaWNvbihpKQogICAgLS0gICAgICAgICAgICAgICAgICAgICBzaGFyZWQuaWNvbl9kYXRhWyBzdGVhbV9pZCBdID0gdHJ1ZQogICAgLS0gICAgICAgICAgICAgICAgIGVuZAoKICAgIC0tICAgICAgICAgICAgICAgICBnb3RvIHNraXAKICAgIC0tICAgICAgICAgICAgIGVuZAoKICAgIC0tICAgICAgICAgICAgIGxvY2FsIGxvZ29faWQgPSBzaGFyZWQuZGF0YVsgc3RlYW1faWQgXQoKICAgIC0tICAgICAgICAgICAgIGlmIGxvZ29faWQgdGhlbgogICAgLS0gICAgICAgICAgICAgICAgIHNjb3JlYm9hcmQuc2V0X2ljb24oaSwgc3RyaW5nLmZvcm1hdCgiaHR0cHM6Ly9taXNoa2F0LmNsb3VkL2FjaWQvaWNvbnMvJXMucG5nIiwgbG9nb19pZCkpCiAgICAtLSAgICAgICAgICAgICAgICAgc2hhcmVkLmljb25fZGF0YVsgc3RlYW1faWQgXSA9IGZhbHNlCiAgICAtLSAgICAgICAgICAgICBlbHNlCiAgICAtLSAgICAgICAgICAgICAgICAgaWYgbm90IHNoYXJlZC5pY29uX2RhdGFbIHN0ZWFtX2lkIF0gdGhlbgogICAgLS0gICAgICAgICAgICAgICAgICAgICBzY29yZWJvYXJkLnNldF9pY29uKGkpCiAgICAtLSAgICAgICAgICAgICAgICAgICAgIHNoYXJlZC5pY29uX2RhdGFbIHN0ZWFtX2lkIF0gPSB0cnVlCiAgICAtLSAgICAgICAgICAgICAgICAgZW5kCiAgICAtLSAgICAgICAgICAgICBlbmQKCiAgICAtLSAgICAgICAgICAgICA6OnNraXA6OgogICAgLS0gICAgICAgICBlbmQKICAgIC0tICAgICBlbmQKCiAgICAtLSAgICAgc2hhcmVkLmluaXQgPSBmdW5jdGlvbiAoKQogICAgLS0gICAgICAgICB3ZWJzb2NrZXRzLmNvbm5lY3Qoc2hhcmVkLmxpbmssIHNoYXJlZC5jYWxsYmFja3MpCgogICAgLS0gICAgICAgICBzaGFyZWQuc2VuZCgpCiAgICAtLSAgICAgICAgIHNoYXJlZC5lbmFibGVkOnNldF9jYWxsYmFjayhzaGFyZWQuc2VuZCkKICAgIC0tICAgICAgICAgY2xpZW50LmRlbGF5X2NhbGwoMiwgc2hhcmVkLnNlbmQpCgogICAgLS0gICAgICAgICBjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCdwYWludCcsIGZ1bmN0aW9uICgpCiAgICAtLSAgICAgICAgICAgICBzaGFyZWQuYXR0YWNoKCkKICAgIC0tICAgICAgICAgZW5kKQoKICAgIC0tICAgICAgICAgY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygnc2h1dGRvd24nLCBmdW5jdGlvbiAoKQogICAgLS0gICAgICAgICAgICAgc2hhcmVkLmF0dGFjaCh0cnVlKQogICAgLS0gICAgICAgICBlbmQpCiAgICAtLSAgICAgZW5kCgogICAgLS0gICAgIHNoYXJlZC5pbml0KCkKICAgIC0tIGVuZAoKICAgIC0tLSByZWdpb24gYnV5IGJvdAogICAgZG8KICAgICAgICBsb2NhbCBwcmltYXJ5X2NvbnNvbGUgPSB7CiAgICAgICAgICAgIFsiQXV0b3NuaXBlcnMiXSA9ICJzY2FyMjAiLAogICAgICAgICAgICBbIlNjb3V0Il0gPSAic3NnMDgiLAogICAgICAgICAgICBbIkFXUCJdID0gImF3cCIsCiAgICAgICAgICAgIFsiQUstNDcgLyBNNCJdICA9ICJhazQ3IiwKICAgICAgICAgICAgWyJBVUcgLyBTRzU1MyJdID0gInNnNTU2IiwKICAgICAgICAgICAgWydGYW1hcyddID0gJ2ZhbWFzJywKICAgICAgICAgICAgWyJOZWdldiJdID0gIm5lZ2V2IiwKICAgICAgICAgICAgWydNMjQ5J10gPSAnbTI0OScsCiAgICAgICAgICAgIFsnTVA3IC8gTVA1J10gPSAnbXA3JywKICAgICAgICAgICAgWydNUDkgLyBNYWMtMTAnXSA9ICdtcDknLAogICAgICAgICAgICBbJ1VNUC00NSddID0gJ3VtcDQ1JywKICAgICAgICAgICAgWydQOTAnXSA9ICdwOTAnLAogICAgICAgICAgICBbJ0Jpem9uJ10gPSAnYml6b24nLAogICAgICAgICAgICBbJ05vdmEnXSA9ICdub3ZhJywKICAgICAgICAgICAgWydYTTEwMTQnXSA9ICdYTTEwMTQnLAogICAgICAgICAgICBbJ01hZzcgLyBTYXdlZC1PZmYnXSA9ICdtYWc3JwogICAgICAgIH0KCiAgICAgICAgbG9jYWwgc2Vjb25kYXJ5X2NvbnNvbGUgPSB7CiAgICAgICAgICAgIFsiUjggLyBEZWFnbGUiXSA9ICJkZWFnbGUiLAogICAgICAgICAgICBbIlRlYy05IC8gRml2ZS1TIC8gQ1otNzUiXSA9ICJ0ZWM5IiwKICAgICAgICAgICAgWyJQLTI1MCJdID0gInAyNTAiLAogICAgICAgICAgICBbIkR1YWxzIl0gPSAiZWxpdGUiCiAgICAgICAgfQoKICAgICAgICBsb2NhbCB1dGlsaXR5X2NvbnNvbGUgPSB7CiAgICAgICAgICAgIFsiS2V2bGFyIl0gPSAidmVzdCIsCiAgICAgICAgICAgIFsnSGVsbWV0J10gPSAndmVzdGhlbG0nLAogICAgICAgICAgICBbIkRlZnVzZXIiXSA9ICJkZWZ1c2VyIiwKICAgICAgICAgICAgWyJUYXNlciJdID0gInRhc2VyIiwKICAgICAgICAgICAgWyJIRSJdID0gImhlZ3JlbmFkZSIsCiAgICAgICAgICAgIFsiTW9sb3RvdiJdID0gIm1vbG90b3YiLAogICAgICAgICAgICBbIlNtb2tlIl0gPSAic21va2VncmVuYWRlIiwKICAgICAgICAgICAgWyJGbGFzaGJhbmciXSA9ICJmbGFzaGJhbmciLAogICAgICAgICAgICBbIkRlY295Il0gPSAiZGVjb3kiCiAgICAgICAgfQoKICAgICAgICBidXlfYm90LmVuYWJsZWQgPSBtZW51Lm5ld19pdGVtKHVpLm5ld19jaGVja2JveCwgIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJCdXkgQm90IikKICAgICAgICA6IHJlY29yZCgic2V0dGluZ3MiLCAiYnV5X2JvdDo6ZW5hYmxlZCIpCiAgICAgICAgOiBzYXZlKCkKCiAgICAgICAgYnV5X2JvdC5wcmltYXJ5ID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfY29tYm9ib3gsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAnUHJpbWFyeSB3ZWFwb24nLCB7ICdOb25lJywgJ0F1dG9zbmlwZXJzJywgJ1Njb3V0JywgJ0FXUCcsICdBSy00NyAvIE00JywgICdBVUcgLyBTRzU1MycsICdGYW1hcycsICdOZWdldicsICdNMjQ5JywgJ01QNyAvIE1QNScsICdNUDkgLyBNYWMtMTAnLCAnVU1QLTQ1JywgJ1A5MCcsICdCaXpvbicsICdOb3ZhJywgJ1hNMTAxNCcsICdNYWc3IC8gU2F3ZWQtT2ZmJyB9KQogICAgICAgIDogcmVjb3JkKCJzZXR0aW5ncyIsICJidXlfYm90OjpwcmltYXJ5IikKICAgICAgICA6IHNhdmUoKQoKICAgICAgICBidXlfYm90LnNlY29uZGFyeSA9IG1lbnUubmV3X2l0ZW0odWkubmV3X2NvbWJvYm94LCAiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgJ1NlY29uZGFyeSB3ZWFwb24nLCB7ICdOb25lJywgJ1I4IC8gRGVhZ2xlJywgJ1RlYy05IC8gRml2ZS1TIC8gQ1otNzUnLCAnUC0yNTAnLCAnRHVhbHMnIH0pCiAgICAgICAgOiByZWNvcmQoInNldHRpbmdzIiwgImJ1eV9ib3Q6OnNlY29uZGFyeSIpCiAgICAgICAgOiBzYXZlKCkKCiAgICAgICAgYnV5X2JvdC51dGlsaXR5ID0gbWVudS5uZXdfaXRlbSh1aS5uZXdfbXVsdGlzZWxlY3QsICJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAnVXRpbGl0eSB3ZWFwb24nLCB7ICdLZXZsYXInLCAnSGVsbWV0JywgJ0RlZnVzZXInLCAnVGFzZXInLCAnSEUnLCAnTW9sb3RvdicsICdTbW9rZScsICdGbGFzaGJhbmcnLCAnRGVjb3knIH0pCiAgICAgICAgOiByZWNvcmQoInNldHRpbmdzIiwgImJ1eV9ib3Q6OnV0aWxpdHkiKQogICAgICAgIDogc2F2ZSgpCgogICAgICAgIGNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInBsYXllcl9zcGF3biIsIGZ1bmN0aW9uIChlKQogICAgICAgICAgICBpZiBjbGllbnQudXNlcmlkX3RvX2VudGluZGV4KGUudXNlcmlkKSB+PSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGNsaWVudC5kZWxheV9jYWxsKDAuNSwgZnVuY3Rpb24gKCkKICAgICAgICAgICAgICAgIGxvY2FsIG1vbmV5ID0gZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX2lBY2NvdW50IikKCiAgICAgICAgICAgICAgICBpZiBub3QgYnV5X2JvdC5lbmFibGVkOmdldCgpIG9yIG1vbmV5IDw9IDgwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICAgICAgbG9jYWwgYnV5ID0gJycKICAgICAgICAgICAgICAgIGxvY2FsIHByaW1hcnkgPSBidXlfYm90LnByaW1hcnk6Z2V0KCkKICAgICAgICAgICAgICAgIGxvY2FsIHNlY29uZGFyeSA9IGJ1eV9ib3Quc2Vjb25kYXJ5OmdldCgpCiAgICAgICAgICAgICAgICBsb2NhbCB1dGlsID0gYnV5X2JvdC51dGlsaXR5OmdldCgpCiAgICAKICAgICAgICAgICAgICAgIGJ1eSA9IHByaW1hcnkgPT0gJ05vbmUnIGFuZCBidXkgb3IgYnV5IC4uICdidXkgJyAuLiBwcmltYXJ5X2NvbnNvbGVbcHJpbWFyeV0gLi4gJzsgJwogICAgICAgICAgICAgICAgYnV5ID0gc2Vjb25kYXJ5ID09ICdOb25lJyBhbmQgYnV5IG9yIGJ1eSAuLiAnYnV5ICcgLi4gc2Vjb25kYXJ5X2NvbnNvbGVbc2Vjb25kYXJ5XSAuLiAnOyAnCiAgICAKICAgICAgICAgICAgICAgIGZvciBpID0gMSwgI3V0aWwgZG8KICAgICAgICAgICAgICAgICAgICBsb2NhbCBpdGVtID0gdXRpbGl0eV9jb25zb2xlWyB1dGlsW2ldIF0KICAgICAgICAgICAgICAgICAgICBidXkgPSBidXkgLi4gImJ1eSAiIC4uIGl0ZW0gLi4gIjsgIgogICAgICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgICAgIGlmIGJ1eSA9PSAnJyB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICAgICAgY2xpZW50LmV4ZWMoYnV5KQogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kKQogICAgZW5kCgogICAgY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygibmV0X3VwZGF0ZV9lbmQiLCBleHBsb2l0LmhhbmRsZV9kZWZlbnNpdmUpCiAgICBjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJuZXRfdXBkYXRlX2VuZCIsIGV4cGxvaXQubmV0X3VwZGF0ZSkKICAgIGNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soIm5ldF91cGRhdGVfZW5kIiwgbG9jYWxwbGF5ZXIubmV0X3VwZGF0ZSkKICAgIGNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInNodXRkb3duIiwgZ3VpLnNodXRkb3duKQogICAgY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygic2h1dGRvd24iLCBhbnRpYWltLnNodXRkb3duKQoKICAgIGNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInBhaW50X3VpIiwgZ3VpLmZyYW1lKQogICAgY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygicGFpbnRfdWkiLCB3aW5kb3dzLmZyYW1lKQoKICAgIGNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInBhaW50X3VpIiwgbWFudWFsX2RpcmVjdGlvbi5mcmFtZSkKCiAgICBjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJwYWludF91aSIsIHdhdGVybWFyay5mcmFtZSkKICAgIGNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInBhaW50X3VpIiwga2V5YmluZHMuZnJhbWUpCiAgICBjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJwYWludF91aSIsIGluZGljYXRvcnMuZnJhbWUpCiAgICBjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJwYWludF91aSIsIGFycm93cy5mcmFtZSkKICAgIGNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInBhaW50X3VpIiwgdmVsb2NpdHlfd2FybmluZy5mcmFtZSkKICAgIGNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInBhaW50X3VpIiwgaGl0X21hcmtlci5mcmFtZSkKCiAgICBjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJwYWludF91aSIsIGV2ZW50bG9ncy5wcmVfZnJhbWUpCiAgICBjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJwYWludF91aSIsIGxvZ19haW1ib3Rfc2hvdHMuZnJhbWUpCiAgICBjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJwYWludF91aSIsIGV2ZW50bG9ncy5wb3N0X2ZyYW1lKQoKICAgIGNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInByZV9wcmVkaWN0X2NvbW1hbmQiLCBsb2NhbHBsYXllci5wcmVfcHJlZGljdF9jb21tYW5kKQogICAgY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygicHJlZGljdF9jb21tYW5kIiwgbG9jYWxwbGF5ZXIucHJlZGljdF9jb21tYW5kKQoKICAgIGNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInNldHVwX2NvbW1hbmQiLCBleHBsb2l0LnNldHVwX2NvbW1hbmQpCiAgICBjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJzZXR1cF9jb21tYW5kIiwgc3RhdGVtZW50LnNldHVwX2NvbW1hbmQpCiAgICBjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJzZXR1cF9jb21tYW5kIiwgYW50aWFpbS5zZXR1cF9jb21tYW5kKQoKICAgIGNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soImFpbV9taXNzIiwgbG9nX2FpbWJvdF9zaG90cy5haW1fbWlzcykKCiAgICBjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJhaW1faGl0IiwgaGl0X21hcmtlci5haW1faGl0KQogICAgY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygiYWltX2ZpcmUiLCBoaXRfbWFya2VyLmFpbV9maXJlKQoKICAgIGNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInBsYXllcl9odXJ0IiwgbG9nX2FpbWJvdF9zaG90cy5wbGF5ZXJfaHVydCkKICAgIGNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInJvdW5kX3ByZXN0YXJ0IiwgaGl0X21hcmtlci5yb3VuZF9wcmVzdGFydCkKCiAgICBtZW51LnNldF9jYWxsYmFjayhmdW5jdGlvbigpCiAgICAgICAgZ3VpLmVuYWJsZWQ6ZGlzcGxheSgpCiAgICAKICAgICAgICBpZiBub3QgZ3VpLmVuYWJsZWQ6Z2V0KCkgdGhlbgogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKICAgIAogICAgICAgIC0tIHNoYXJlZC5vbmxpbmVfbGFiZWw6ZGlzcGxheSgpCiAgICAgICAgZ3VpLnNlbGVjdGlvbjpkaXNwbGF5KCkKICAgIAogICAgICAgIGlmIGd1aS5zZWxlY3Rpb246Z2V0KCkgPT0gIkhvbWUiIHRoZW4KICAgIAogICAgICAgICAgICBncmFwaGljcy5jb25maWdfZXhwb3J0OmRpc3BsYXkoKQogICAgICAgICAgICBncmFwaGljcy5jb25maWdfaW1wb3J0OmRpc3BsYXkoKQogICAgICAgICAgICBncmFwaGljcy5jb25maWdfZGVmYXVsdDpkaXNwbGF5KCkKICAgICAgICBlbmQKICAgIAogICAgICAgIGlmIGd1aS5zZWxlY3Rpb246Z2V0KCkgPT0gIlNldHRpbmdzIiB0aGVuCiAgICAKICAgICAgICAgICAgYWlyX2V4cGxvaXQuZW5hYmxlZDpkaXNwbGF5KCkKICAgIAogICAgICAgICAgICBpZiBhaXJfZXhwbG9pdC5lbmFibGVkOmdldCgpIHRoZW4KICAgICAgICAgICAgICAgIGFpcl9leHBsb2l0LmtleTpkaXNwbGF5KCkKICAgICAgICAgICAgICAgIGFpcl9leHBsb2l0LnRpY2tzOmRpc3BsYXkoKQogICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICBzZXR0aW5ncy50d2Vha3NfZW5hYmxlOmRpc3BsYXkoKQogICAgCiAgICAgICAgICAgIGlmIHNldHRpbmdzLnR3ZWFrc19lbmFibGU6Z2V0KCkgdGhlbgogICAgICAgICAgICAgICAgc2V0dGluZ3MudHdlYWtzOmRpc3BsYXkoKQogICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICAtLSBkbwogICAgICAgICAgICAtLSAgICAgaGl0Y2hhbmNlLmVuYWJsZWQ6ZGlzcGxheSgpCiAgICAKICAgICAgICAgICAgLS0gICAgIGlmIGhpdGNoYW5jZS5lbmFibGVkOmdldCgpIHRoZW4KICAgICAgICAgICAgLS0gICAgICAgICBoaXRjaGFuY2Uud2VhcG9uX2xpc3Q6ZGlzcGxheSgpCiAgICAKICAgICAgICAgICAgLS0gICAgICAgICBmb3IgXywgd2VhcG9uIGluIG5leHQsIGhpdGNoYW5jZS53ZWFwb25zIGRvCiAgICAgICAgICAgIC0tICAgICAgICAgICAgIGlmIGhpdGNoYW5jZS53ZWFwb25fbGlzdDpnZXQoKSA9PSB3ZWFwb24gdGhlbgogICAgICAgICAgICAtLSAgICAgICAgICAgICAgICAgaGl0Y2hhbmNlWydFbmFibGVkXycgLi4gd2VhcG9uXTpkaXNwbGF5KCkKICAgIAogICAgICAgICAgICAtLSAgICAgICAgICAgICAgICAgaWYgaGl0Y2hhbmNlWydFbmFibGVkXycgLi4gd2VhcG9uXTpnZXQoKSB0aGVuCiAgICAgICAgICAgIC0tICAgICAgICAgICAgICAgICAgICAgaGl0Y2hhbmNlWydNb2Rlc18nIC4uIHdlYXBvbl06ZGlzcGxheSgpCiAgICAKICAgICAgICAgICAgLS0gICAgICAgICAgICAgICAgICAgICBpZiBoaXRjaGFuY2VbJ01vZGVzXycgLi4gd2VhcG9uXTpoYXZlX2tleSgnTm8gU2NvcGUnKSB0aGVuCiAgICAgICAgICAgIC0tICAgICAgICAgICAgICAgICAgICAgICAgIGhpdGNoYW5jZVsnRGlzdGFuY2VfJyAuLiB3ZWFwb25dOmRpc3BsYXkoKQogICAgICAgICAgICAtLSAgICAgICAgICAgICAgICAgICAgICAgICBoaXRjaGFuY2VbJ05vIFNjb3BlXycgLi4gd2VhcG9uXTpkaXNwbGF5KCkKICAgICAgICAgICAgLS0gICAgICAgICAgICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICAtLSAgICAgICAgICAgICAgICAgICAgIGlmIGhpdGNoYW5jZVsnTW9kZXNfJyAuLiB3ZWFwb25dOmhhdmVfa2V5KCdJbiBBaXInKSB0aGVuCiAgICAgICAgICAgIC0tICAgICAgICAgICAgICAgICAgICAgICAgIGhpdGNoYW5jZVsnSW4gQWlyXycgLi4gd2VhcG9uXTpkaXNwbGF5KCkKICAgICAgICAgICAgLS0gICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgLS0gICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAtLSAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgLS0gICAgICAgICBlbmQKICAgICAgICAgICAgLS0gICAgIGVuZAogICAgICAgICAgICAtLSBlbmQKICAgIAogICAgICAgICAgICAtLSBzaGFyZWQuZW5hYmxlZDpkaXNwbGF5KCkKICAgIAogICAgICAgICAgICB3aWRnZXRzLmVuYWJsZWQ6ZGlzcGxheSgpCiAgICAKICAgICAgICAgICAgaWYgd2lkZ2V0cy5lbmFibGVkOmdldCgpIHRoZW4KICAgICAgICAgICAgICAgIHdpZGdldHMuaXRlbXM6ZGlzcGxheSgpCiAgICAKICAgICAgICAgICAgICAgIGlmIHdpZGdldHMuaXRlbXM6aGF2ZV9rZXkoIldhdGVybWFyayIpIHRoZW4KICAgICAgICAgICAgICAgICAgICB3aWRnZXRzLmRpc3BsYXk6ZGlzcGxheSgpCiAgICAgICAgICAgICAgICAgICAgd2lkZ2V0cy5jdXN0b21fbmFtZTpkaXNwbGF5KCkKICAgIAogICAgICAgICAgICAgICAgICAgIGlmIHdpZGdldHMuY3VzdG9tX25hbWU6Z2V0KCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB3aWRnZXRzLmN1c3RvbV9uYW1lX3ZhbHVlOmRpc3BsYXkoKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgICAgIGlmICN3aWRnZXRzLml0ZW1zOmdldCgpID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgd2lkZ2V0cy5jb2xvcl9waWNrZXI6ZGlzcGxheSgpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgY3VzdG9tX3Njb3BlLmVuYWJsZWQ6ZGlzcGxheSgpCiAgICAKICAgICAgICAgICAgaWYgY3VzdG9tX3Njb3BlLmVuYWJsZWQ6Z2V0KCkgdGhlbgogICAgICAgICAgICAgICAgY3VzdG9tX3Njb3BlLmNvbG9yOmRpc3BsYXkoKQogICAgICAgICAgICAgICAgY3VzdG9tX3Njb3BlLm1vZGU6ZGlzcGxheSgpCiAgICAgICAgICAgICAgICBjdXN0b21fc2NvcGUucG9zaXRpb246ZGlzcGxheSgpCiAgICAgICAgICAgICAgICBjdXN0b21fc2NvcGUub2Zmc2V0OmRpc3BsYXkoKQogICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICBidXlfYm90LmVuYWJsZWQ6ZGlzcGxheSgpCiAgICAKICAgICAgICAgICAgaWYgYnV5X2JvdC5lbmFibGVkOmdldCgpIHRoZW4KICAgICAgICAgICAgICAgIGJ1eV9ib3QucHJpbWFyeTpkaXNwbGF5KCkKICAgICAgICAgICAgICAgIGJ1eV9ib3Quc2Vjb25kYXJ5OmRpc3BsYXkoKQogICAgICAgICAgICAgICAgYnV5X2JvdC51dGlsaXR5OmRpc3BsYXkoKQogICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICBjbGllbnRzaWRlX25pY2tuYW1lLmVuYWJsZWQ6ZGlzcGxheSgpCiAgICAKICAgICAgICAgICAgaWYgY2xpZW50c2lkZV9uaWNrbmFtZS5lbmFibGVkOmdldCgpIHRoZW4KICAgICAgICAgICAgICAgIGNsaWVudHNpZGVfbmlja25hbWUubmlja25hbWU6ZGlzcGxheSgpCiAgICAgICAgICAgICAgICBjbGllbnRzaWRlX25pY2tuYW1lLmFwcGx5OmRpc3BsYXkoKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIAogICAgICAgIGlmIGd1aS5zZWxlY3Rpb246Z2V0KCkgPT0gIkFudGktYWltIiB0aGVuCiAgICAKICAgICAgICAgICAgc2FmZV9oZWFkLmVuYWJsZWQ6ZGlzcGxheSgpCiAgICAKICAgICAgICAgICAgYWFfdHdlYWtzLmVuYWJsZTpkaXNwbGF5KCkKICAgICAgICAgICAgaWYgYWFfdHdlYWtzLmVuYWJsZTpnZXQoKSB0aGVuCiAgICAgICAgICAgICAgICBhYV90d2Vha3MuaXRlbXM6ZGlzcGxheSgpCiAgICAgICAgICAgIGVuZAogICAgCiAgICAKICAgICAgICAgICAgZnNfZGlzYWJsZXJzLnN0YXRlczpkaXNwbGF5KCkKICAgIAogICAgICAgICAgICBpZiBzYWZlX2hlYWQuZW5hYmxlZDpnZXQoKSB0aGVuCiAgICAgICAgICAgICAgICBzYWZlX2hlYWQuc3RhdGVzOmRpc3BsYXkoKQogICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICB5YXdfZGlyZWN0aW9uLmVkZ2VfeWF3OmRpc3BsYXkoKQogICAgICAgICAgICB5YXdfZGlyZWN0aW9uLmZyZWVzdGFuZGluZzpkaXNwbGF5KCkKICAgIAogICAgICAgICAgICBtYW51YWxfZGlyZWN0aW9uLmVuYWJsZWQ6ZGlzcGxheSgpCiAgICAKICAgICAgICAgICAgaWYgbWFudWFsX2RpcmVjdGlvbi5lbmFibGVkOmdldCgpIHRoZW4KICAgICAgICAgICAgICAgIG1hbnVhbF9kaXJlY3Rpb24ub3B0aW9uczpkaXNwbGF5KCkKICAgICAgICAgICAgICAgIG1hbnVhbF9kaXJlY3Rpb24uYXJyb3dzOmRpc3BsYXkoKQogICAgCiAgICAgICAgICAgICAgICBpZiBtYW51YWxfZGlyZWN0aW9uLmFycm93czpnZXQoKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbWFudWFsX2RpcmVjdGlvbi5jb2xvcjpkaXNwbGF5KCkKICAgICAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgICAgICBtYW51YWxfZGlyZWN0aW9uLmxlZnRfbWFudWFsOmRpc3BsYXkoKQogICAgICAgICAgICAgICAgbWFudWFsX2RpcmVjdGlvbi5yaWdodF9tYW51YWw6ZGlzcGxheSgpCiAgICAgICAgICAgICAgICBtYW51YWxfZGlyZWN0aW9uLmZvcndhcmRfbWFudWFsOmRpc3BsYXkoKQogICAgICAgICAgICAgICAgbWFudWFsX2RpcmVjdGlvbi5kaXNhYmxlZF9tYW51YWw6ZGlzcGxheSgpCiAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgIGRlZmVuc2l2ZS5lbmFibGVkOmRpc3BsYXkoKQogICAgICAgICAgICBhbmltX2JyZWFrZXJzLmVuYWJsZWQ6ZGlzcGxheSgpCiAgICAKICAgIAogICAgICAgICAgICBpZiBhbmltX2JyZWFrZXJzLmVuYWJsZWQ6Z2V0KCkgdGhlbgogICAgICAgICAgICAgICAgYW5pbV9icmVha2Vycy5ncm91bmQ6ZGlzcGxheSgpCiAgICAgICAgICAgICAgICBhbmltX2JyZWFrZXJzLmFpcjpkaXNwbGF5KCkKICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgaWYgZGVmZW5zaXZlLmVuYWJsZWQ6Z2V0KCkgdGhlbgogICAgICAgICAgICAgICAgZGVmZW5zaXZlLm1vZGU6ZGlzcGxheSgpCiAgICAgICAgICAgICAgICBkZWZlbnNpdmUuc3RhdGU6ZGlzcGxheSgpCiAgICAgICAgICAgICAgICBkZWZlbnNpdmUucGl0Y2g6ZGlzcGxheSgpCiAgICAgICAgICAgICAgICBkZWZlbnNpdmUueWF3OmRpc3BsYXkoKQogICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICBhbmdsZXMudHlwZTpkaXNwbGF5KCkKICAgIAogICAgICAgICAgICBpZiBhbmdsZXMudHlwZTpnZXQoKSA9PSAiQ3VzdG9tIiB0aGVuCiAgICAgICAgICAgICAgICBhbmdsZXMuY3VzdG9tLnN0YXRlOmRpc3BsYXkoKQogICAgCiAgICAgICAgICAgICAgICBsb2NhbCBzdGF0ZSA9IGFuZ2xlcy5jdXN0b20uc3RhdGU6Z2V0KCkKICAgICAgICAgICAgICAgIGxvY2FsIGxpc3QgPSBhbmdsZXMuY3VzdG9tW3N0YXRlXQogICAgCiAgICAgICAgICAgICAgICBpZiBsaXN0LmVuYWJsZWQgfj0gbmlsIHRoZW4KICAgICAgICAgICAgICAgICAgICBsaXN0LmVuYWJsZWQ6ZGlzcGxheSgpCiAgICAKICAgICAgICAgICAgICAgICAgICBpZiBub3QgbGlzdC5lbmFibGVkOmdldCgpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZ290byBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgICAgIGlmIGxpc3QucGl0Y2ggfj0gbmlsIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBwaXRjaCA9IGxpc3QucGl0Y2g6Z2V0KCkKICAgICAgICAgICAgICAgICAgICBsaXN0LnBpdGNoOmRpc3BsYXkoKQogICAgCiAgICAgICAgICAgICAgICAgICAgaWYgcGl0Y2ggPT0gIkN1c3RvbSIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsaXN0LnBpdGNoX29mZnNldDpkaXNwbGF5KCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgICAgICBpZiBsaXN0Lnlhd19iYXNlIH49IG5pbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgbGlzdC55YXdfYmFzZTpkaXNwbGF5KCkKICAgICAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgICAgICBsb2NhbCB5YXdfdmFsdWUgPSBsaXN0LnlhdzpnZXQoKQogICAgICAgICAgICAgICAgbGlzdC55YXc6ZGlzcGxheSgpCiAgICAKICAgICAgICAgICAgICAgIGlmIHlhd192YWx1ZSB+PSAiT2ZmIiB0aGVuCiAgICAKICAgICAgICAgICAgICAgICAgICBpZiB5YXdfdmFsdWUgPT0gJzE4MCBMUicgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsaXN0Lnlhd18xODBscl9tb2RlOmRpc3BsYXkoKQogICAgICAgICAgICAgICAgICAgICAgICBsaXN0Lnlhd19sZWZ0OmRpc3BsYXkoKQogICAgICAgICAgICAgICAgICAgICAgICBsaXN0Lnlhd19yaWdodDpkaXNwbGF5KCkKICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBsaXN0Lnlhd18xODBscl9tb2RlOmdldCgpID09ICdTd2l0Y2ggZGVsYXknIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QueWF3X2RlbGF5OmRpc3BsYXkoKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QueWF3X29mZnNldDpkaXNwbGF5KCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICAgICAgICAgIGxpc3QueWF3X2ppdHRlcjpkaXNwbGF5KCkKICAgIAogICAgICAgICAgICAgICAgICAgIGlmIGxpc3QueWF3X2ppdHRlcjpnZXQoKSB+PSAiT2ZmIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3Quaml0dGVyX29mZnNldDpkaXNwbGF5KCkKICAgICAgICAgICAgICAgICAgICAgICAgbGlzdC5qaXR0ZXJfcmFuZG9taXphdGlvbjpkaXNwbGF5KCkKICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBsaXN0Lnlhd19qaXR0ZXI6Z2V0KCkgPT0gIkFjaWRUZWNoIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0LmppdHRlcl9tb2RlOmRpc3BsYXkoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdC5hY2lkX3NhZmU6ZGlzcGxheSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0LmFjaWRfY3ljbGU6ZGlzcGxheSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0LmFjaWRfZGVsYXk6ZGlzcGxheSgpCiAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpLnNldF9lbmFibGVkKGxpc3QuYWNpZF9kZWxheS5yZWYsIGxpc3QuYWNpZF9jeWNsZTpnZXQoKSB+PSA1KQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgICAgICBsb2NhbCBib2R5X3lhdyA9IGxpc3QuYm9keV95YXc6Z2V0KCkKICAgICAgICAgICAgICAgIGxpc3QuYm9keV95YXc6ZGlzcGxheSgpCiAgICAKICAgICAgICAgICAgICAgIGlmIGJvZHlfeWF3IH49ICJPZmYiIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBib2R5X3lhdyB+PSAiT3Bwb3NpdGUiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbGlzdC5ib2R5X3lhd19vZmZzZXQ6ZGlzcGxheSgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgICAgICAgICBsaXN0LmZyZWVzdGFuZGluZ19ib2R5X3lhdzpkaXNwbGF5KCkKICAgICAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgICAgICA6OmNvbnRpbnVlOjoKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCiAgICAKICAgIG1lbnUudXBkYXRlKCkKZW5kKSgp"}